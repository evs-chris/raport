<label><span title="Width of the {{.type}} in rem, if a number, a percentage of the parent, grow/fill, or an expression, defaulting to 100%">Width <button class-hide /><button class-ico on-click="@context.set('.width', typeof .width === 'number' || .width === undefined ? { percent: .width } : typeof .width === 'object' && 'percent' in .width ? { x: '' } : typeof .width === 'object' && 'x' in .width ? 'grow' : .width.percent)" title="{{typeof .width === 'number' || .width === undefined ? 'Change to percent' : typeof .width === 'object' && 'percent' in .width ? 'Change to Expression' : typeof .width === 'object' && 'x' in .width ? 'Change to Fill/Grow' : 'Change to REM'}}">
      {{>switch}}
    </button>
    {{#if typeof .width === 'object' && 'x' in .width}}<button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.width.x'), false">&#9998;</button>{{/if}}
  </span>
  <span>
    {{#if typeof .width === 'number' || .width === undefined}}
      <div><input type="number" value="{{.width}}" style-width="calc(100% - 2rem)" /><span class-unit>rem</span></div>
    {{elseif typeof .width === 'object' && 'percent' in .width}}
      <div><input type="number" value="{{.width.percent}}" style-width="calc(100% - 2rem)" /><span class-unit>%</span></div>
    {{elseif .width === 'grow'}}
      <div>Fill/Grow</div>
    {{else}}
      <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.width.x}} tabout /></div>
    {{/if}}
  </span>
</label>
<label><span title="Height of the {{.type}} in rem, if a number, a percentage of the parent, or an expression, fill/grow, default to{{#if type === 'label'}}the largest font size or{{/if}} 1">Height <button class-hide /><button class-ico on-click="@context.set('.height', typeof .height === 'number' || .height  === undefined ? { percent: .height } : typeof .height === 'object' && 'percent' in .height ? { x: '' } : typeof .height === 'object' && 'x' in .height ? 'grow' : .height.percent)" title="{{typeof .height === 'number' || .height  === undefined ? 'Change to percent' : typeof .height === 'object' && 'percent' in .height ? 'Change to Expression' : typeof .height === 'object' && 'x' in .height ? 'Change to Fill/Grow' : 'Change to REM'}}">
    {{>switch}}
    {{#if typeof .height === 'object' && 'x' in .height}}<button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.height.x'), false">&#9998;</button>{{/if}}
  </button></span>
  <span>
    {{#if typeof .height === 'number' || .height === undefined}}
      <div><input type="number" value="{{.height}}" style-width="calc(100% - 2rem)" /><span class-unit>rem</span></div>
    {{elseif typeof .height === 'object' && 'percent' in .height}}
      <div><input type="number" value="{{.height.percent}}" style-width="calc(100% - 2rem)" /><span class-unit>%</span></div>
    {{elseif .height === 'grow'}}
      <div>Fill/Grow</div>
    {{else}}
      <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.height.x}} tabout /></div>
    {{/if}}
  </span>
</label>
{{#with ~/[@.split(~/temp.widget, 2)]}}
  {{#if Array.isArray(.layout)}}
    <label><span>X</span><span><input type="number" value="{{.layout[@.lastKey(~/temp.widget)][0]}}" /></span></label>
    <label><span>Y</span><span><input type="number" value="{{.layout[@.lastKey(~/temp.widget)][1]}}" /></span></label>
  {{else}}
    <label><span title="Cause the next widget to start on the next line in an automatic layout">Break? <button class-ico on-click="@context.set('^^/br', typeof ^^/br === 'object' ? false : { x: ''})" title="{{typeof ^^/br === 'object' ? 'Change to Boolean' : 'Change to Expression'}}">
    {{>switch}}
    {{#if typeof ^^/br === 'object' && 'x' in ^^/br}}<button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.hide'), false">&#9998;</button>{{/if}}
  </button></span><span>
      {{#if typeof ^^/br !== 'object'}}
        <input type=checkbox checked="{{^^/br}}" />
      {{elseif typeof ^^/br === 'object'}}
        <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{^^/br.x}} tabout /></div>
      {{/if}}
    </span></label>
  {{/if}}
{{/with}}
<label><span title="If this evaluates to true, the widget will be hidden and not affect automatic layouts">Hidden <button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.hide')">&#9998;</button></span><span>
    <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.hide}} tabout /></div>
  </span></label>
<label><span>
    Margin
    {{#if typeof .margin === 'object' && 'x' in .margin}}<button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.margin.x'), false">&#9998;</button>{{/if}}
  </span><span>
  <div class=toggles>
    <span class-toggle class-active="typeof .margin === 'undefined'" {{#if typeof .margin !== 'undefined'}}on-click="@context.set('.margin', undefined)"{{/if}}>None</span>
    <span class-toggle class-active="typeof .margin === 'number'" {{#if typeof .margin !== 'number'}}on-click="@context.set('.margin', 1)"{{/if}}>All</span>
    <span class-toggle class-active=".margin.length === 2" {{#if .margin.length !== 2}}on-click="@context.set('.margin', [1, 1])"{{/if}}>Paired</span>
    <span class-toggle class-active=".margin.length === 4" {{#if .margin.length !== 4}}on-click="@context.set('.margin', [1, 1, 1, 1])"{{/if}}>Individual</span>
    <span class-toggle class-active="typeof .margin === 'object' && 'x' in .margin" {{#if !.margin || .margin.x === undefined}}on-click="@context.set('.margin', { x: '' })"{{/if}}>Expression</span>
  </div>
  {{#if typeof .margin === 'number'}}
    <input type=number value="{{.margin}}" />
  {{elseif .margin.length === 2}}
    <div class=sides>
      <span /><input type=number value="{{.margin[0]}}" /><span />
      <span /><div class=square /><input type=number value="{{.margin[1]}}" />
      <span /><span /><span />
    </div>
  {{elseif .margin.length === 4}}
    <div class=sides>
      <span /><input type=number value="{{.margin[0]}}" /><span />
      <input type=number value="{{.margin[3]}}" /><div class=square /><input type=number value="{{.margin[1]}}" />
      <span /><input type=number value="{{.margin[2]}}" /><span />
    </div>
  {{elseif .margin.x !== undefined}}
    <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.margin.x}} tabout /></div>
  {{/if}}
</span></label>
<label><span title="Setting box to contain will make the margins fit within the designated size. Setting box to expand will expand the width to include the margin. The default depends on the type of sizing, with contain for percentages and expand for others.">Box</span><span>
  <select value="{{.box}}">
    <option value="{{undefined}}">Default</option>
    <option value="contain">Contain</option>
    <option value="expand">Expand</option>
  </select>
</span></label>
<label><span>Border {{#if typeof .border === 'string'}}<button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.border')">&#9998;</button>{{/if}}</span><span>
  <div class=toggles>
    <span class-toggle class-active="typeof .border === 'undefined'" {{#if typeof .border !== 'undefined'}}on-click="@context.set('.border', undefined)"{{/if}}>None</span>
    <span class-toggle class-active="typeof .border === 'number'" {{#if typeof .border !== 'number'}}on-click="@context.set('.border', 1)"{{/if}}>Bottom</span>
    <span class-toggle class-active=".border.length === 1" {{#if .border.length !== 1}}on-click="@context.set('.border', [1])"{{/if}}>All</span>
    <span class-toggle class-active=".border.length === 2" {{#if .border.length !== 2}}on-click="@context.set('.border', [1, 1])"{{/if}}>Paired</span>
    <span class-toggle class-active=".border.length === 4" {{#if .border.length !== 2}}on-click="@context.set('.border', [1, 1, 1, 1])"{{/if}}>Individual</span>
    <span class-toggle class-active="typeof .border === 'string'" {{#if typeof .border !== 'string'}}on-click="@context.set('.border', '')"{{/if}}>Expression</span>
  </div>
  {{#if typeof .border === 'number'}}
    <input type=number value="{{.border}}" />
  {{elseif typeof .border === 'string'}}
    <textarea>{{.border}}</textarea>
  {{elseif .border.length === 1}}
    <input type=number value="{{.border[0]}}" />
  {{elseif .border.length === 2}}
    <div class=sides>
      <span /><input type=number value="{{.border[0]}}" /><span />
      <span /><div class=square /><input type=number value="{{.border[1]}}" />
      <span /><span /><span />
    </div>
  {{elseif .border.length === 4}}
    <div class=sides>
      <span /><input type=number value="{{.border[0]}}" /><span />
      <input type=number value="{{.border[3]}}" /><div class=square /><input type=number value="{{.border[1]}}" />
      <span /><input type=number value="{{.border[2]}}" /><span />
    </div>
  {{/if}}
</span></label>
{{#if .type !== 'image'}}
<label><span>Alignment</span><span>
  <select value="{{.font.align}}">
    <option value="{{undefined}}">(default)</option>
    <option>left</option>
    <option>center</option>
    <option>right</option>
  </select>
</span></label>
{{/if}}
{{#unless .type === 'measured' || .type === 'image'}}
<label><span title="Display all whitespace, including newlines, within the content of the {{.type}}?">Significant Space?</span><span><input type=checkbox twoway=false checked="{{.font.pre}}" on-change="@context.set('.font.pre', @node.checked ? true : undefined)" /></span></label>
{{/unless}}
{{#if .type !== 'image'}}
<label><span>Prevent Overflow?</span><span><input type=checkbox twoway=false checked="{{.font.clamp}}" on-change="@context.set('.font.clamp', @node.checked ? true : undefined)" /></span></label>
<label><span>Text Size</span><span><input type=number value="{{.font.size}}" /></span></label>
{{/if}}
{{#unless .type === 'measured' || .type === 'image'}}
<label><span>Line Height</span><span><input type=number value="{{.font.line}}" /></span></label>
{{/unless}}
{{#if .type !== 'image'}}
<label><span>Font Family</span><span><input value="{{.font.family}}" /></span></label>
<label><span>Text Color</span><span><input value="{{.font.color}}" /></span></label>
<label><span>Weight</span><span>
  <select value="{{.font.weight}}">
    <option value="{{undefined}}">(default)</option>
    <option value="400">light</option>
    <option value="500">normal</option>
    <option value="600">bold</option>
    <option value="700">bolder</option>
  </select>
</span></label>
{{/if}}
{{#if !.margin}}
<label><span title="Padding to add to the right side of the {{.type}}, which is useful for right-aligned text">Right Pad</span><span><input type=number value="{{.font.right}}" /></span></label>
{{/if}}

<template id="page-props">
</template>

<template id="sure" src="./test.ractive.html" />

<template id="label-props">
  <label><span>Text <button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.text', { label: true })">&#9998;</button></span><span>{{#if Array.isArray(.text)}}<button class-plain on-click="@context.set('.text', @.getPartStrings(.text)), @.editExpr('.text', { label: true })">Convert to Text</button>{{else}}
      <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.text}} tabout /></div>
    {{/if}}</span></label>
  {{#if @.inRepeater(~/temp.widget)}}
    <label><span>ID {{#if .id != null}}
        <button class-ico class-large title="Remove aggregate id" on-click="@context.set('.id', undefined)">&times;</button>
      {{else}}
        <button class-ico class-large title="Add aggregate id" on-click="@context.set('.id', '')">+</button>
      {{/if}}
    </span><span>{{#if .id != null}}<input value="{{.id}}" />{{/if}}</span></label>
  {{/if}}
  <label><span>Format <button class-hide />{{#if .format != null}}
      <button class-ico class-large title="Remove format" on-click="@context.set('.format', undefined)">&times;</button>
    {{else}}
      <button class-ico class-large title="Add format" on-click="@context.set('.format', {})">+</button>
    {{/if}}
  </span><span>{{#if .format != null}}
    <input value="{{.format.name}}" style-width="80%" />
    <button class-ico class-large title="Add parameter" on-click="@context.push('.format.args', '')">+</button>
    {{#each .format.args}}
      <input value="{{.}}" style-width="80%" /><button class-ico class-large title="Remove parameter" on-click="@context.splice('../', @index)">&times;</button>
    {{/each}}
  {{/if}}</span></label>
</template>

<template id="html-props">
  <label><span>HTML <button title="Edit in Expression Editor" class-ico on-click="@.editExpr('.html', { html: true })">&#9998;</button></span><span>
      <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.html}} tabout template /></div>
    </span></label>
</template>

<template id="container-props">
  {{#with ~/[@.split(~/temp.widget, 2)] as repeater, @.lastKey(~/temp.widget) as index}}
  {{#if repeater.footer && repeater.group[index]}}
    <label><span>Show Footer?</span><span><input type=checkbox checked="{{repeater.groupEnds[repeater.group.length - 1 - index]}}" /></span></label>
  {{/if}}
  {{/with}}
  <label><span>Layout</span><span>
    <select twoway="false" value="{{Array.isArray(.layout) ? 'manual' : 'auto'}}" on-change="@context.set('.layout', @node.value === 'manual' ? [] : undefined)">
      <option value="auto">Auto</option>
      <option value="manual">Manual</option>
    </select>
  </span></label>
  <label><span title="If bridging is enabled, the container can span multiple pages.">Bridge Breaks?</span><span><input type=checkbox checked="{{.bridge}}" /></span></label>
</template>

<template id="measured-props">
  <label><span>Text <button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.text')">&#9998;</button></span><span>
    <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.text}} tabout /></div>
  </span></label>
  <label><span title="">Metric</span><span><input type="number" value="{{.font.metric}}" /></span></label>
</template>

<template id="repeater-props">
  <label><span>Source <button class-ico on-click="typeof .source === 'string' ? @.editExpr(@keypath + '.source') : @.editReportSrc(@context, '.source')">&#9998;</button></span><span>
    <div class=toggles>
      <span class-toggle class-active="typeof .source === 'string'" {{#if typeof .source !== 'string'}}on-click="@context.set('.source', '')"{{/if}}>Expression</span>
      <span class-toggle class-active="typeof .source !== 'string'" {{#if typeof .source === 'string'}}on-click="@context.set('.source', { source: '' })"{{/if}}>Source</span>
    </div>
    {{#if typeof .source === 'string'}}<input value="{{.source}}" />{{/if}}
    {{#if typeof .source !== 'string'}}<select value="{{.source.source}}"><option value="">(None)</option>{{#each ~/report.sources}}<option value="{{.name || .source}}">{{.label || .name || .source}}</option>{{/each}}</select>{{/if}}
  </span></label>
  {{#with ~/[@.split(~/temp.widget)] as repeater}}
  {{#if repeater.footer && repeater.group.length}}
    <label><span>Show Footer?</span><span><input type=checkbox checked="{{repeater.groupEnds[repeater.group.length]}}" /></span></label>
  {{/if}}
  {{/with}}
</template>

<template id="image-props">
  <label><span>URL <button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.url')">&#9998;</button></span><span>
    <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.url}} tabout /></div>
  </span></label>
  <label><span>Fit
      <button class-ico on-click="@context.set('.fit', !.fit || typeof .fit === 'string' ? { x: '' } : undefined)" title="Sitch to {{.fit && typeof .fit !== 'object' ? 'Expression' : 'Value'}}">{{>switch}}</button>
    {{#if typeof .fit === 'object' && 'x' in .fit}}<button class-ico title="Edit in Expression Editor" on-click="@.editExpr('.fit.x'), false">&#9998;</button>{{/if}}
    </span><span>
    {{#if !.fit || typeof .fit === 'string'}}
      <select value="{{.fit}}">
        <option value="{{undefined}}">Contain</option>
        <option value="cover">Cover</option>
        <option value="stretch">Stretch</option>
      </select>
    {{else}}
      <div style="padding: 0; overflow: auto; max-height: 5em;"><Editor src={{.fit.x}} tabout /></div>
    {{/if}}
  </span></label>
</template>

<style>
  .unit {
    font-size: 0.6rem;
    margin-left: 1em;
  }
</style>
