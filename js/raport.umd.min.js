!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Raport={})}(this,(function(e){"use strict";const t=[];let n=0;const r=[0,""],o=[0,""];function i(){return r}function a(){return r.slice()}function s(e,i,a,s){return r[0]=e,r[1]=i||"",r[2]=a,r[3]=s,1&n&&r[0]>=o[0]&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3]),t}function l(e,t){let n=1;for(;~(t=e.lastIndexOf("\n",t));)n++,t--;return n}function u(e,t,n){const r=[],o=e[0];let i=o,a=i=t.lastIndexOf("\n",i),s=t.lastIndexOf("\n",i-1);for(let e=0;e<n&&~i;e++)r.unshift(t.substring(s+1,i)),i=s,s=t.lastIndexOf("\n",i-1);const c=r.length+1;s=a,i=t.indexOf("\n",s+1),-1===i&&s<t.length&&(i=t.length);for(let e=0;e<=n&&~i;e++)r.push(t.substring(s+1,i)),s=i,i=t.indexOf("\n",s+1),-1===i&&s<t.length&&(i=t.length);const f=r[c-1];let p="";const g=o-(~a?a:-1)-1;for(let e=0;e<g;e++)p+="\t"===f[e]?"\t":" ";return p+="^--",{context:r,column:o-a,line:l(t,o),position:o,source:f,message:e[1],marked:`${r.slice(0,c).join("\n")}\n${p}\n${r.slice(c).join("\n")}`,cause:e[2]&&u(e[2],t,n),causes:e[3]&&e[3].map((e=>u(e,t,n)))}}function c(e){let t=e;if(e[2]){const n=c(e[2]);n[0]>t[0]&&(t=n)}if(e[3])for(let n=0;n<e[3].length;n++){const r=c(e[3][n]);r[0]>t[0]&&(t=r)}return o[0]>=r[0]&&o[1]!==e[1]?o:t}function f(e,t){let r;const a=t,l=t?(t.detailed?1:0)+(t.causes?2:0):0,f=t&&t.consumeAll;return function(t,p){const h=p?(p.detailed?1:0)+(p.causes?2:0):l;let m=[null,0];if(1&h&&(o[0]=0,o[1]="",o[2]=void 0,o[3]=void 0),h!==n){const o=n;n=h,m=(r||(r=g(e))).parse(t,0,m),n=o}else m=(r||(r=g(e))).parse(t,0,m);if(m.length&&(p&&"consumeAll"in p?p.consumeAll:f)&&m[1]<t.length&&(m=s(m[1],1&h&&`expected to consume all input, but only ${m[1]} chars consumed`)),m.length)return m[0];{const e=i(),n=(p&&"contextLines"in p?p.contextLines:a&&a.contextLines)||0,r=u(d(e[3]||[],e),t,n),o=c(e);if(e!==o&&(r.latest=u(o,t,n)),p&&"throw"in p?p.throw:a&&a.throw){const e=new Error(r.message);throw Object.assign(e,r)}return r}}}const p={parse:(e,t)=>s(t,1&n&&"uninitialized lazy parser")};function g(e){return e.parser||e||p}function h(e){let t="";const n=e.length;for(let r=0;r<n;r++)e[r]&&(t=t.concat(e[r]));return t}function d(e,t){let n,r=t[0];t[3]=e;const o=e||[];for(let e=0;e<o.length;e++)o[e][0]>r&&(n=o[e],r=n[0]);return n?[n[0],n[1],t]:t}function m(){return!1}function y(e,t){return e===t}function v(e,t){return e[0]===t||e[1]===t}function b(e,t){return e[0]===t||e[1]===t||e[2]===t}function $(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t}function x(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t}function w(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t}function A(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t}function j(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t}function k(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t}function M(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t||e[9]===t}function D(e,t){const n=e.length;for(let r=0;r<n;r++)if(e[r]===t)return!0;return!1}function X(e,t){let n,r,o=e.length-1,i=0;if(t<e[0]||t>e[o])return!1;for(;i<=o;){if(n=i+o>>1,r=e[n],r===t)return!0;r<t?i=n+1:o=n-1}}function Y(e,t=!0){const n=e.length;return 0===n?m:1===n?y:2===n?v:3===n?b:4===n?$:5===n?x:6===n?w:7===n?A:8===n?j:9===n?k:10===n?M:t?X:D}function O(e){let t="";const n=e.split("").sort().join("");for(let e=0;e<n.length;e++)~t.indexOf(n[e])||(t+=n[e]);return t}function z(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(!r(n,e[i]))return i;return o}function C(e){const t=O(e),n=Y(e);return{parse(e,r,o){o=o||["",0];const i=z(e,r,t,n);return o[0]=e.substring(r,i),o[1]=i,o}}}function H(e){const t=O(e),r=Y(e);return{parse(o,i,a){a=a||["",0];const l=z(o,i,t,r);return l===i?s(i,1&n&&"expected one of "+e):(a[0]=o.substring(i,l),a[1]=l,a)}}}function N(e,t){const r=t&&O(t),o=Y(r||"");return{parse(t,i,a){if(t.length-i>=e){a=a||["",0];const l=t.substr(i,e);if(r)for(let t=0;t<e;t++)if(!o(r,l[t]))return s(i+t,1&n&&"unexpected char");return a[0]=l,a[1]=i+e,a}return s(i,1&n&&"unexpected end of input")}}}function T(e,t){const r=O(e),o=Y(e);return{parse(i,a,l){l=l||["",0];const u=function(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(r(n,e[i]))return i;return o}(i,a,r,o);return!t&&u>=i.length?s(u-1,1&n&&`expected one of '${e}' before end of input`):(l[0]=u?i.substring(a,u):"",l[1]=u,l)}}}function S(e,t){const r=T(e,t);return{parse(e,t,o){o=o||["",0];const i=r.parse(e,t,o);return i.length?i[1]>t?i:s(t,1&n&&"expected at least one character"):i}}}function U(...e){const t=e.length;if(1===t){const t=e[0],r=t.length;if(1===r)return{parse:(e,r,o)=>e[r]===t?((o=o||["",0])[0]=t,o[1]=r+1,o):s(r,1&n&&"expected "+t)};if(2===r)return{parse:(e,r,o)=>e[r]===t[0]&&e[r+1]===t[1]?((o=o||["",0])[0]=t,o[1]=r+2,o):s(r,1&n&&"expected "+t)};{let e,o;return{parse(i,a,l){for(e=0,o=a+e;e<r;e++,o++)if(t[e]!==i[o])return s(a,1&n&&"expected "+t);return(l=l||["",0])[0]=t,l[1]=a+r,l}}}}return{parse(r,o,i){e:for(let n=0;n<t;n++){const t=e[n],a=t.length;if(1!==a){for(let e=0;e<a;e++)if(t[e]!==r[o+e])continue e;return(i=i||["",0])[0]=t,i[1]=o+a,i}if(r[o]===t)return[t,o+a]}return s(o,1&n&&`expected ${e.length>1?"one of ":""}${e.map((e=>""+e)).join(", ")}`)}}}function q(...e){const t=e.slice(),r=H(t.map((e=>e.toLowerCase()+e.toUpperCase())).join("")),o=t.map((e=>e.toLowerCase()));return{parse(e,i,a){const l=r.parse(e,i,a||["",0]);if(!l.length)return l;const u=o.indexOf(l[0].toLowerCase());return~u?(l[0]=t[u],l):s(i,1&n&&`expected ${t.length>1?"one of ":""}${t.map((e=>""+e)).join(", ")}`)}}}function E(e){let t,n;function r(e,n,r){r=r||[null,0];const o=t.parse(e,n,r);return o.length?o:(r[0]=null,r[1]=n,r)}return n={parse:(o,i,a)=>(t=g(e),n.parse=r,r(o,i,a))},n}function F(e,...t){const r="string"==typeof e?e:"alternate",o="string"==typeof e?t:(e?[e]:[]).concat(t);let i;const l=o.length;function u(e,t,o){let u;o=o||[null,0];for(let r=0;r<l;r++){const s=i[r].parse(e,t,o);if(s.length)return s;2&n&&(u||(u=[])).push(a())}if(2&n){const e=d(u,[t,"expected "+r]);return s(e[0],e[1],e[2],e[3])}return s(t,1&n&&"expected "+r)}let c;return c={parse:(e,t,n)=>(i=o.map((e=>g(e))),c.parse=u,u(e,t,n))},c}function L(e,t){let n,r;function o(e,r,o){o=o||[null,0];const i=n.parse(e,r,o);return i.length?(i[0]=t(i[0]),i):i}return r={parse:(t,i,a)=>(n=g(e),r.parse=o,o(t,i,a))},r}function I(e){let t;const r=[];function o(e,o,i){let s;i=i||[null,0];let l,u=o;if(l=t.parse(e,u,i),!l.length)return i[0]=r,i[1]=u,2&n&&(i[2]=a()),i;for(u=l[1],s=[l[0]];;){if(l=t.parse(e,u,i),!l.length)return[s||[],u,2&n&&a()];s.push(l[0]),u=l[1]}}let i;return i={parse:(n,r,a)=>(t=g(e),i.parse=o,o(n,r,a))},i}function R(e,t){let r,o;function i(e,o,i){let l;i=i||[null,0];let u,c=o;if(u=r.parse(e,c,i),!u.length)return s(c,1&n&&"expected at least one "+(t||"item"),2&n&&a());for((l=[]).push(u[0]),c=u[1];;){if(u=r.parse(e,c,i),!u.length)return i[0]=l,i[1]=c,2&n&&(i[2]=a()),i;l.push(u[0]),c=u[1]}}return o={parse:(t,n,a)=>(r=g(e),o.parse=i,i(t,n,a))},o}function _(e,t,r="disallow"){let o,l;const u=[];function c(e,t,c){let f;c=c||[null,0];let p,g,h,d=t,m=t;if(g=o.parse(e,d,c),!g.length)return c[0]=u,c[1]=t,2&n&&(c[2]=a()),c;if(p=g[0],m=d,d=g[1],h=l.parse(e,d,c),!h.length)return"require"===r?s(m,1&n&&"expected separator"):(c[0]=[p],c[1]=d,c);for(d=h[1],f=[p];;){if(g=o.parse(e,d,c),!g.length){if("disallow"===r&&f&&f.length){if(2&n){const e=i();return s(e[0],e[1],[d,"unexpected separator"])}return s(d,1&n&&"unexpected separator")}break}if(m=d,d=g[1],p=g[0],h=l.parse(e,d,c),!h.length){if("require"===r)return s(m,1&n&&"expected separator");f.push(p);break}d=h[1],f.push(p)}return[f,d,2&n&&a()]}let f;return f={parse:(n,r,i)=>(o=g(e),l=g(t),f.parse=c,c(n,r,i))},f}function J(e,t,r,o="disallow"){let i,l,u;function c(e,t,u){let c;u=u||[null,0];let f,p=t,g=p;if(f=i.parse(e,p,u),!f.length)return s(p,1&n&&"expected at least one "+(r||"item"));{(c=[]).push(f[0]),g=p=f[1];const t=l.parse(e,p,u);if(t.length)for(p=t[1];;){if(f=i.parse(e,p,u),!f.length){if("disallow"===o&&c&&c.length)return u[0]=c,u[1]=g,u;break}{c.push(f[0]),g=p=f[1];const t=l.parse(e,p,u);if(!t.length){if("require"===o)return s(p,1&n&&"expected separator");break}p=t[1]}}else if("require"===o)return s(p,1&n&&"expected separator")}return u[0]=c,u[1]=p,2&n&&(u[2]=a()),u}return u={parse:(n,r,o)=>(i=g(e),l=g(t),u.parse=c,c(n,r,o))},u}function P(e,t,o){if(Array.isArray(e)){let r,o;const a=e.length;function i(e,t,i){let l,u;i=i||[null,0];for(let n=0;n<a;n++){if(r[n].parse(e,t,i).length){u=r[n];break}}if(!u)return s(t,1&n&&"expected opening bracket");const c=o.parse(e,i[1],i);if(!c.length)return c;2&n&&(l=c[2]);const f=c[0],p=c[1];return u.parse(e,p,i).length?(i[0]=f,i):s(p,1&n&&"expected matching end bracket",2&n&&l)}let l;return l={parse:(n,a,s)=>(o=g(t),r=e.map((e=>g(e))),l.parse=i,i(n,a,s))},l}{let a,s,l,u;function i(e,t,o){let i;o=o||[null,0];const u=a.parse(e,t,o);if(!u.length)return u;const c=s.parse(e,u[1],o);if(!c.length)return c;2&n&&c[2]&&(i=c[2]);const f=c[0],p=l.parse(e,c[1],o);return p.length?(o[0]=f,o):(2&n&&i&&function(e){(r[3]||(r[3]=[])).push(e)}(i),p)}return u={parse:(n,r,c)=>(a=g(e),s=g(t),l=g(o),u.parse=i,i(n,r,c))},u}}function W(...e){let t;const r=e.length;function o(e,o,i){let l;i=i||[null,0];let u,c,f=o;if(c=t[0].parse(e,f,i),!c.length){if(2&n){const e=d(u,a());return s(e[0],e[1],e[2],e[3])}return c}2&n&&c[2]&&(u||(u=[])).push(c[2]),(l=[]).push(c[0]),f=c[1];for(let o=1;o<r;o++){if(c=t[o].parse(e,f,i),!c.length){if(2&n){const e=d(u,a());return s(e[0],e[1],e[2],e[3])}return c}2&n&&c[2]&&(u||(u=[])).push(c[2]),l.push(c[0]),f=c[1]}return i[0]=l,i[1]=f,2&n&&(i[2]=[o,"error in seq",null,u]),i}let i;return i={parse:(n,r,a)=>(t=e.map(g),i.parse=o,o(n,r,a))},i}function Z(...e){let t;const r=e.length;function o(e,o,i){i=i||[null,0];let l,u,c=o;if(u=t[0].parse(e,c,i),!u.length){if(2&n){const e=d(l,a());return s(e[0],e[1],e[2],e[3])}return u}2&n&&u[2]&&(l||(l=[])).push(u[2]),c=u[1];for(let o=1;o<r;o++){if(u=t[o].parse(e,c,i),!u.length){if(2&n){const e=d(l,a());return s(e[0],e[1],e[2],e[3])}return u}2&n&&u[2]&&(l||(l=[])).push(u[2]),c=u[1]}return i[0]=null,i[1]=c,i}let i;return i={parse:(n,r,a)=>(t=e.map(g),i.parse=o,o(n,r,a))},i}const B="abcdefABCDEF",G="0123456789",V=B+"abcdefABCDEFghijklmnopqrstuvwxyzGHIJKLMNOPQRSTUVWXYZ$_",K=B+G,Q={b:"\b",r:"\r",n:"\n","'":"'",'"':'"',t:"\t","\\":"\\"},ee=/_/g,te=L(W(E(U("-","+")),H(G),C(G+"_"),E(U(".")),C(G+"_"),L(E(W(U("e","E"),E(U("+","-")),H(G+"_"))),(e=>e&&h(e)))),(e=>+h(e).replace(ee,""))),ne=L(W(U("\\"),function(e,t){const r=O(t),o=Y(r);return{parse(t,i,a){if(t.length-i>=e){a=a||["",0];const l=t.substr(i,e);for(let t=0;t<e;t++)if(o(r,l[t]))return s(i+t,1&n&&"unexpected char");return a[0]=l,a[1]=i+e,a}return s(i,1&n&&"unexpected end of input")}}}(1,"xu")),(e=>Q[e[1]]||e[1])),re=L(W(U("\\u"),N(4,K)),(e=>String.fromCharCode(parseInt(e[1],16)))),oe=L(W(U("\\x"),N(2,K)),(e=>String.fromCharCode(parseInt(e[1],16)))),ie=F(P(U('"'),L(I(F("string part",S('"\\'),re,oe,ne)),(e=>h(e))),U('"')),P(U("'"),L(I(F("string part",S("'\\"),re,oe,ne)),(e=>h(e))),U("'"))),ae=L(U("true","false"),(e=>"true"===e)),se=L(U("null"),(()=>null)),le=L(W(H(V),E(C(V+G))),(([e,t])=>null!==t?e+t:e)),ue=function(e){const t=O(e),n=Y(e);return{parse:(e,r,o)=>((o=o||["",0])[1]=z(e,r,t,n),o)}}(" \t\n\r"),ce={},fe={},pe=F("value",ie,ce,fe,te,ae,se),ge=L(W(ue,F("key",ie,le),Z(ue,U(":"),ue),pe),(e=>[e[1],e[3]]));ce.parser=P(Z(U("["),ue),_(pe,Z(ue,U(","),ue),"allow"),Z(ue,U("]"))),fe.parser=L(P(Z(U("{"),ue),_(ge,Z(ue,U(","),ue),"allow"),Z(ue,U("}"))),(e=>{const t=e.length,n={};for(let r=0;r<t;r++){const t=e[r];n[t[0]]=t[1]}return n}));f(L(W(ue,pe,ue),(e=>e[1])));const he={y:0,m:0,w:0,d:864e5,h:36e5,mm:6e4,s:1e3};he.w=7*he.d,he.y=Math.floor(365.25*he.d),he.m=Math.floor(30.45*he.d);const de=" \r\n\t",me=" \r\n\t():{}[],\"'`\\;&#.",ye=function(e){const t=O(e),r=Y(e);return{parse:(o,i,a)=>((a=a||["",0])[1]=z(o,i,t,r),a[1]===i?s(i,1&n&&"expected at least one of "+JSON.stringify(e)):a)}}(de),ve=L(U("null","true","false","undefined"),(e=>{switch(e){case"null":return null;case"true":return!0;case"false":return!1;case"undefined":return}})),be=S(me,!0),$e={},xe={},we={},Ae={},je={},ke={n:"\n",r:"\r",t:"\t",b:"\b"},Me=L(W(U("\\"),N(1)),(([,e])=>ke[e]||e)),De=L(R(F("ref part",S(me+"=/",!0),Me)),(e=>e.join(""))),Xe=L(W(U("."),De),(([,e])=>e)),Ye=P(W(U("["),ue),Ae,W(ue,U("]"))),Oe=L(W(F("ref sigil",U("!","~","*"),W(C("^"),E(U("@",".")))),F("keypath",De,Ye),I(F("keypath",Xe,Ye))),(([e,t,n])=>{const r={k:[t].concat(n).map((e=>"object"!=typeof e||!("v"in e)||"string"!=typeof e.v&&"number"!=typeof e.v?e:e.v))};return Array.isArray(e)?(e[0]&&(r.u=e[0].length),"@"===e[1]&&(r.p="@")):e&&(r.p=e),r})),ze=f(Oe),Ce=L(Oe,(e=>({r:e})));function He(e){const t=e.reduce(((e,t)=>(e.length&&"v"in t&&"v"in e[e.length-1]&&"string"==typeof t.v&&"string"==typeof e[e.length-1].v?e[e.length-1].v+=t.v:e.push(t),e)),[]);return t.length>0&&(!("v"in t[0])||"string"!=typeof t[0].v)&&t.unshift({v:""}),0===t.length?{v:""}:1===t.length?t[0]:{op:"+",args:t}}const Ne=L(J(W(te,ue,q("years","year","y","months","month","minutes","minute","milliseconds","millisecond","mm","ms","m","weeks","week","w","days","day","d","hours","hour","h","seconds","second","s")),ue),(e=>{const t={y:0,m:0,d:0,h:0,mm:0,s:0,ms:0};for(let n=0;n<e.length;n++)"y"===e[n][2][0]?t.y+=e[n][0]:"m"===e[n][2]||"months"===e[n][2]||"month"===e[n][2]?t.m+=e[n][0]:"d"===e[n][2][0]?t.d+=e[n][0]:"w"===e[n][2][0]?t.d+=7*e[n][0]:"s"===e[n][2][0]?t.s+=e[n][0]:"mm"===e[n][2]||"minutes"===e[n][2]||"minute"===e[n][2]?t.mm+=e[n][0]:"ms"!==e[n][2]&&"milliseconds"!==e[n][2]&&"millisecond"!==e[n][2]||(t.ms+=e[n][0]);if(t.y||t.m){const e=[];return t.y&&(e[0]=t.y),t.m&&(e[1]=t.m),t.d&&(e[2]=t.d),t.mm&&(e[4]=t.mm),t.s&&(e[5]=t.s),t.ms&&(e[6]=t.ms),{d:e}}{delete t.y,delete t.m;let e=0;for(const n in t)e+=t[n]*(he[n]||1);return e}})),Te=E(W(ue,U(">"))),Se=F("date",L(W(q("last","this","next"),ye,q("week","month","year"),E(W(ye,q("to"),ye,q("date"))),Te),(([e,,t,n,r])=>({f:"w"===t[0]?"w":"m"===t[0]?"m":"y",o:"last"===e?-1:"this"===e?0:1,d:n?1:void 0,e:r?1:void 0}))),L(W(q("yesterday","today","tomorrow","now"),Te),(([e,t])=>"now"===e?{f:"n",o:0}:{f:"d",o:"yesterday"===e?-1:"today"===e?0:1,e:t?1:void 0})),L(W(Ne,ye,F("relative time anchor",q("ago"),W(q("from"),ye,q("now")))),(([e,,t])=>"number"==typeof e?{f:"n",o:e*("ago"===t?-1:1)}:{f:"n",o:e.d,d:"ago"===t?-1:void 0})));function Ue(e,t,n){return null==n||(e[t]=n),e}const qe=L(W(N(4,G),E(W(N(1,"-/"),H(G),E(W(N(1,"-/"),H(G),E(W(N(1," T"),H(G),E(W(U(":"),N(2,G),E(W(U(":"),N(2,G),E(W(U("."),N(3,G))))))))))))),E(W(ue,F("timezone",U("Z"),E(W(N(1,"+-"),H(G),E(W(U(":"),N(2,G)))))))),Te),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=r&&e[1][2][2]&&e[1][2][2][1],i=o&&e[1][2][2][2]&&e[1][2][2][2][1],a=i&&e[1][2][2][2][2]&&e[1][2][2][2][2][1],s=a&&e[1][2][2][2][2][2]&&e[1][2][2][2][2][2][1],l=e[2]&&e[2][1]&&("string"==typeof e[2][1]?0:(60*+e[2][1][1]+(+e[2][1][2]||0))*("+"===e[2][1][0]?-1:1)),u=e[3]?1:void 0;if(n){if(r){if(o){if(i){if(null!=l){const e=new Date(Date.UTC(+t,+n-1,+r,+o,+i,a&&+a||0,s&&+s||0));return l&&e.setUTCHours(e.getUTCHours()+Math.floor(l/60)),l%60&&e.setUTCMinutes(e.getUTCMinutes()+l%60),e}return new Date(+t,+n-1,+r,+o,+i,a&&+a||0,s&&+s||0)}return{f:Ue([+t,+n-1,+r,+o],7,l),e:u}}return{f:Ue([+t,+n-1,+r],7,l),e:u}}return{f:Ue([+t,+n-1],7,l),e:u}}return{f:Ue([+t],7,l),e:u}})),Ee=P(U("#"),F("date",qe,Se,Ne),U("#")),Fe=F("string",L(W(U(":"),S(me.replace(".",""),!0)),(e=>({v:e[1]}))),L(P(U('"'),I(F("string part",S('\\"'),ne,re,oe)),U('"')),(e=>({v:"".concat(...e)}))),L(P(U("'"),I(F("string part",L(S("'\\$",!0),(e=>({v:e}))),L(U("\\$","$$"),(()=>({v:"$"}))),P(U("${"),Ae,U("}")),L(U("$"),(e=>({v:e}))),L(re,(e=>({v:e}))),L(oe,(e=>({v:e}))),L(ne,(e=>({v:e}))))),U("'")),He),L(P(U("`"),I(F("string part",L(S("`\\$",!0),(e=>({v:e}))),L(U("\\$","$$"),(()=>({v:"$"}))),P(U("${"),Ae,U("}")),L(U("$"),(e=>({v:e}))),L(re,(e=>({v:e}))),L(oe,(e=>({v:e}))),L(ne,(e=>({v:e}))))),U("`")),He)),Le=L(F("literal",te,ve,Ee),(e=>({v:e}))),Ie=L(P(Z(U("("),ue),W(be,ue,$e),Z(ue,U(")"))),(([e,,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n}));function Re(e){return P(W(U("("),ue),e,W(ue,U(")")))}const _e={},Je={},Pe=L(W(H("abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789"),Re($e)),(([e,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n})),We=function(e){return L(W(e,E(W(U("#"),be,E(W(U(","),J(Ae,U(","))))))),(([e,t])=>t?t[2]?{op:"fmt",args:[e,{v:t[1]},...t[2][1]]}:{op:"fmt",args:[e,{v:t[1]}]}:e))}(function(e){return L(W(e,I(F("keypath",Xe,Ye))),(([e,t])=>t.length?{op:"get",args:[e,{v:{k:t}}]}:e))}(F("operand",Re(Je),function(e,t){let n,r;function o(e,r,o){o=o||[null,0];const i=n.parse(e,r,o);if(!i.length)return i;const a=t(i[0]);return!0===a?i:s(i[1],a)}return r={parse:(t,i,a)=>(n=g(e),r.parse=o,o(t,i,a))},r}(Re(_e),(e=>"op"in e||"expected bracketed op")),Ie,je))),Ze=L(W(U("not ","+"),We),(([e,t])=>({op:"+"===e?e:"not",args:[t]})));function Be(e,[,t,,n]){return{op:t,args:[e,n]}}const Ge=L(W(We,I(W(ye,U("**"),ye,We))),(([e,t])=>t.length?function(e,t){if(1===t.length)return{op:t[0][1],args:[e,t[0][3]]};const n=t.pop();let r=t[t.length-1][1];const o={op:n[1],args:[t.pop()[3],n[3]]},i=t.reverse().reduce(((e,t)=>{const n={op:r,args:[t[3],e]};return r=t[1],n}),o);return{op:r,args:[e,i]}}(e,t):e)),Ve=L(W(Ge,I(W(ye,U("*","/%","/","%"),ye,Ge))),(([e,t])=>t.length?t.reduce(Be,e):e)),Ke=L(W(Ve,I(W(ye,U("+","-"),ye,Ve))),(([e,t])=>t.length?t.reduce(Be,e):e)),Qe=L(W(Ke,I(W(ye,U(">=",">","<=","<","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain"),ye,Ke))),(([e,t])=>t.length?t.reduce(Be,e):e)),et=L(W(Qe,I(W(ye,U("is","is-not","==","!="),ye,Qe))),(([e,t])=>t.length?t.reduce(Be,e):e)),tt=L(W(et,I(W(ye,U("and","&&"),ye,et))),(([e,t])=>t.length?t.reduce(Be,e):e)),nt=L(W(tt,I(W(ye,U("or","||"),ye,tt))),(([e,t])=>t.length?t.reduce(Be,e):e));_e.parser=nt,Je.parser=L(W(U("if"),ye,Ae,ye,U("then"),ye,Ae,I(W(ye,U("else if","elseif","elsif","elif"),ye,Ae,ye,U("then"),ye,Ae)),E(W(ye,U("else"),ye,Ae))),(([,,e,,,,t,n,r])=>{const o={op:"if",args:[e,t]};for(const[,,,e,,,,t]of n)o.args.push(e,t);return r&&o.args.push(r[3]),o}));const rt=F("expression",Je,_e),ot=L(W(F("key",Fe,L(be,(e=>({v:e})))),ue,U(":"),ue,Ae),(e=>[e[0],e[4]]));function it(e){return e.filter((e=>!("v"in e[0]&&"v"in e[1]))).length?{op:"object",args:e.reduce(((e,t)=>(e.push(t[0],t[1]),e)),[])}:{v:e.reduce(((e,t)=>(e[t[0].v]=t[1].v,e)),{})}}xe.parser=L(P(Z(ue,U("["),ue),_(Ae,H(" \r\n\t,"),"allow"),Z(ue,U("]"))),(e=>e.filter((e=>!("v"in e))).length?{op:"array",args:e}:{v:e.map((e=>e.v))})),we.parser=L(P(Z(ue,U("{"),ue),_(ot,H(" \r\n\t,"),"allow"),Z(ue,U("}"))),it),Ae.parser=rt;const at=L(W(be,U(":"),ue,Ae),(([e,,,t])=>[{v:e},t])),st=L(W(U("=>"),ue,Ae),(([,,e])=>({a:e})));$e.parser=L(_(F("argument",at,Ae),H(" \r\n\t,"),"allow"),(e=>{const[t,n]=e.reduce(((e,t)=>(Array.isArray(t)?e[1].push(t):e[0].push(t),e)),[[],[]]);return n.length&&t.push(it(n)),t})),je.parser=F("expression",xe,we,Le,Fe,st,Ze,Pe,Ce);const lt=f(Ae);function ut(e,t){return lt(e.trim(),Object.assign({detailed:!1,consumeAll:!0},t))}function ct(e,t){if(!t)return e.value;const n="string"==typeof t?ze(t):t;if(!("error"in n)&&"k"in n){const t=n.k,r=n.p;let o=0,i=e,a=e.value;for(let e=0;e<n.u;e++)i&&(i=i.parent);if(a=i?i.value:void 0,r){if("!"===r)a=e.root.parameters;else if("~"===r)a=e.root.value;else if("*"===r)a=e.root.sources[t[o++]],a&&o<t.length+1&&"value"!==t[o]&&(a=a.value);else if("@"===r){const n=t[o++];if("value"!==n){for(;i&&(!i.special||!(n in i.special));)i=i.parent;a=i&&i.special[n],a&&"source"===n&&void 0!==t[o]&&"value"!==t[o]&&a.value&&(a=a.value),a||"date"!==n||(a=e.root.special.date=new Date)}}}else"_"===t[0]&&t.shift();for(let e=o;e<t.length;e++){const n=t[e];if("object"!=typeof n)a=a&&a[n];else{const e=pt(i,n);a=a&&a[e]}if(null==a)return}return a}}const ft={};function pt(e,t,n){let r,o,i=ft;return vt(e)?(r=new $t,o=e,arguments.length>1&&(i=t)):bt(e)?(r=e,o=t,arguments.length>2&&(i=n)):e&&"context"in e&&bt(e.context)?(r=e.context,o=t,arguments.length>2&&(i=n)):vt(t)?(r=new $t(e),o=t,arguments.length>2&&(i=n)):(r=new $t,o=e,arguments.length>1&&(i=n)),"string"==typeof o&&(o=r.root.exprs[o]||(r.root.exprs[o]=(r.parser||ut)(o))),"object"!=typeof o&&(o={v:o}),o&&"r"in o?ct(r,o.r):o&&"v"in o?o.v:o&&"op"in o?yt(r,o):o&&"a"in o?i===ft?o.a:pt(xt(r,{value:i}),o.a):void 0}const gt={};function ht(...e){for(const t of e)for(const e of t.names)gt[e]=t}function dt(e,t,n,r,o){if(!e||!Array.isArray(e.value))return e;o=o?xt(o,{special:{source:e.value}}):new $t(e.value,{special:{source:e}});const i=t?[]:e.value.slice();if(t){let n="string"==typeof t?ut(t):t;"m"in n&&(n={v:!0}),e.value.forEach(((e,t)=>{pt(xt(o,{value:e,special:{value:e,index:t}}),n)&&i.push(e)}))}const a=function(e,t){let n;if(Array.isArray(t))n=t;else{const r=pt(e,t);Array.isArray(r)?n=r:"string"==typeof r&&(n=[{v:r}])}if(n)for(let e=0;e<n.length;e++){const t=n[e];"string"==typeof t&&("-"===t[0]?n[e]={by:t.substr(1),desc:!0}:n[e]={by:"+"===t[0]?t.substr(1):t})}return n}(o,n);if(a&&a.length){const e=a.map((e=>"object"!=typeof e||!("by"in e)||("boolean"==typeof e.desc?e.desc:pt(o,e.desc))));i.sort(((t,n)=>{for(let r=0;r<a.length;r++){const i=a[r],s=e[r],l="string"==typeof i?i:"by"in i?i.by:i,u=pt(xt(o,{value:t}),l),c=pt(xt(o,{value:n}),l),f=null==u&&null!=c?-1:null!=u&&null==c?1:u<c==c<u?0:u<c?-1:u>c?1:0;if(f)return(s?-1:1)*f}return 0}))}return Array.isArray(r)||(r=pt(o,r)),Array.isArray(r)&&r.length?{value:{schema:e.schema,grouped:r.length,level:0,value:mt(i,r,o,1),all:i}}:{schema:e.schema,value:i}}function mt(e,t,n,r=0){const o={},i=[],a=[];for(const r of e){const e=""+pt(xt(n,{value:r}),t[0]);o[e]||(a.push(e),o[e]=[]),o[e].push(r)}for(const e of a)i.push({group:e,grouped:t.length-1,value:t.length>1?mt(o[e],t.slice(1),n,r+1):o[e],all:o[e],level:r});return i}function yt(e,t){const n=gt[t.op];if(!n)return!0;let r;if("checked"===n.type){r=[];const o=t.args||[];for(let i=0;i<o.length;i++){const a=o[i],s=pt(e,a),l=n.checkArg(t.op,i,o.length-1,s,e);if("continue"===l)r.push(s);else if("skip"in l)i+=l.skip,"value"in l&&r.push(l.value);else if("result"in l)return l.result}return n.apply(t.op,r,e)}if("value"===n.type)return r=(t.args||[]).map((t=>pt(e,t))),n.apply(t.op,r,e);{let r;const o=(t.args||[]).slice(),i=pt(e,o[0]);if(Array.isArray(i)?(o.shift(),r=i):"object"==typeof i&&"value"in i&&Array.isArray(i.value)&&(o.shift(),r=i.value),!r){const t=pt(e,{r:"@source"});r=Array.isArray(t)?t:"object"==typeof t&&"value"in t&&Array.isArray(t.value)?t.values:[]}return n.apply(t.op,r,o,e)}}function vt(e){return"string"==typeof e||"object"==typeof e&&e&&("r"in e&&"string"==typeof e.r||"op"in e&&"string"==typeof e.op||"v"in e||"a"in e)}function bt(e){return"object"==typeof e&&"string"==typeof e.path&&"object"==typeof e.root&&"value"in e&&("object"==typeof e.parent||e.root===e)}class $t{constructor(e={},t){this.root=this,this.parameters={},this.sources={},this.special={},this.exprs={},this.path="",this.value=e,t&&(Object.assign(this.parameters,t.parameters),Object.assign(this.special,t.special))}}function xt(e,t){return{parent:e,root:e.root,path:"",value:"value"in t?t.value:e.value,special:t.special||{},parser:t.parser}}const wt={};function At(e,t){wt[e]=t}function jt(e){const t=[null,null];let n=new Date,r="d"in e&&e.d?new Date:void 0;if(n.setHours(0,0,0,0),e instanceof Date)return[e,e];if("n"===e.f)return n="number"==typeof e.o?new Date(+new Date+e.o):Xt(new Date,{d:e.o},1),[n,n];if("d"===e.f?(n.setDate(n.getDate()+e.o),r||(r=new Date(n))):"w"===e.f?(n.setDate(n.getDate()-(n.getDay()+(-1===e.o?7:1===e.o?-7:0))),r||(r=new Date(n),r.setDate(n.getDate()+6))):"m"===e.f?(n.setDate(1),n.setMonth(n.getMonth()+e.o),r||(r=new Date(n),r.setMonth(n.getMonth()+1),r.setDate(0))):"y"===e.f&&(n.setDate(1),n.setMonth(0),n.setDate(1),r||(r=new Date(n),r.setFullYear(n.getFullYear()+1),r.setDate(0))),Array.isArray(e.f)){const t=e.f.slice();null!=t[7]?(n=new Date(Date.UTC(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)),t[7]&&n.setUTCHours(n.getUTCHours()+Math.floor(t[7]/60)),t[7]%60&&n.setUTCMinutes(n.getUTCMinutes()+t[7]%60)):n=new Date(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0);for(let e=1;e<7;e++)if(null==t[e]){t[e-1]++;break}null!=t[7]?(r=new Date(Date.UTC(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)),t[7]&&r.setUTCHours(r.getUTCHours()+Math.floor(t[7]/60)),t[7]%60&&r.setUTCMinutes(r.getUTCMinutes()+t[7]%60)):r=new Date(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0),r.setMilliseconds(-1)}else"d"in e&&e.d||r.setHours(23,59,59,999);return t[0]=n,t[1]=r,t}function kt(e){return"object"==typeof e&&("f"in e&&(Array.isArray(e.f)||"o"in e)||e instanceof Date)}function Mt(e){const t=jt(e);return"e"in e&&null!=e.e?t[1]:t[0]}function Dt(e){return"number"==typeof e||"object"==typeof e&&Array.isArray(e.d)}function Xt(e,t,n){if("number"==typeof t)return new Date(+e+t*n);{let r=new Date(e);return t.d[0]&&r.setFullYear(r.getFullYear()+t.d[0]*n),t.d[1]&&r.setMonth(r.getMonth()+t.d[1]*n),t.d[2]&&r.setDate(r.getDate()+t.d[2]*n),t.d[3]&&r.setHours(r.getHours()+t.d[3]*n),t.d[4]&&r.setMinutes(r.getMinutes()+t.d[4]*n),t.d[5]&&r.setSeconds(r.getSeconds()+t.d[5]*n),t.d[6]&&r.setMilliseconds(r.getMilliseconds()+t.d[6]*n),r}}function Yt(e,t,n){e.styles[t]||(e.styles[t]=n)}function Ot(e,t){return{report:e.report,context:xt(e.context,t),styles:e.styles,styleMap:e.styleMap}}const zt=/\>\<\&/g,Ct={"<":"&lt;",">":"&gt;","&":"&amp;"};function Ht(e){return e.replace(zt,(e=>Ct[e]||""))}const Nt={};function Tt(e,t,n){Nt[e]="function"==typeof t?{render:t}:t,n&&Object.assign(Nt[e],n)}const St=7.4,Ut=6.7,qt=7.85,Et=5.9;let Ft=function(e,t,n){const r=n&&n.family||"sans",o=n&&n.size||.83,i=n&&n.line||1,a=("mono"===r||/fixed|mono/i.test(r)?qt:"narrow"===r||/narrow|condensed/i.test(r)?Et:"sans"===r||/sans/i.test(r)?St:Ut)*o/16;return e.split(/\r?\n/g).reduce(((e,n)=>{const[r,o]=n.split(/\s/g).reduce(((e,n)=>{const r=(n.length+1)*a;return e[0]+r>t?(e[0]=r,e[1]++):e[0]+=r,e}),[0,0]);return e+(o+(r>0?1:0)||1)}),0)*i};function Lt(e,t,n,r){const o=Nt[e.type];if(!o||e.hide&&pt(t,e.hide))return{output:""};!("height"in e)&&o.container&&(e.height="auto");const i=Wt(e,n);if(n.maxY&&!isNaN(i)&&i>n.maxY)return Yt(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2};if(n.availableY&&i>n.availableY)return{output:"",continue:{offset:0},cancel:!0};let a=0;if(e.margin){const t=Gt(e);a+=t[0]+t[2],n.availableX&&(n.availableX-=t[1]+t[3]),n.availableY&&(n.availableY-=t[0]+t[2])}const s=o.render(e,t,n,r);return"string"==typeof s?{output:s,height:i,width:Jt(e,n)}:n.maxY&&s.height>n.maxY?(Yt(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2}):isNaN(i)&&n.availableY&&s.height>n.availableY?{output:"",continue:{offset:0},height:s.height,cancel:!0}:(s.height+=a,s)}const It={};function Rt(e,t){It[e]=t}function _t(e,t){const n=e.width;return n?"number"==typeof n?n:n.percent/100*(t.maxX||51):t.maxX||51}function Jt(e,t){let n=_t(e,t);if(e.margin){const t=Gt(e);n+=t[1]+t[3]}else e.font&&e.font.right&&(n+=e.font.right);return n}function Pt(e,t,n){let r=1;if("number"==typeof e.height)r=e.height;else if("object"==typeof e.height&&e.height.percent&&t.availableY)r=t.availableY*(e.height.percent/100);else if("auto"===e.height||n&&!e.height)return n||NaN;return r}function Wt(e,t,n){let r=Pt(e,t,n);if(e.margin){const t=Gt(e);r+=t[0]+t[2]}return r}function Zt(e){return e.reduce(((e,t)=>e>t[1]+t[3]?e:t[1]+t[3]),0)}function Bt(e){return e.reduce(((e,t)=>e>t[0]+t[2]?e:t[0]+t[2]),0)}function Gt(e){if(e.margin){const t=e.margin;if(Array.isArray(t)){if(4===t.length)return t.map((e=>+e));if(2===t.length)return[+t[0],+t[1],+t[0],+t[1]]}else if("number"==typeof t)return[t,t,t,t]}return[0,0,0,0]}function Vt(e,t,n){if(!t)return"";const r=e.styleMap.styles[t];if(r)return r;const o=`${n}${function(e,t){return e.styleMap.ids[t]||(e.styleMap.ids[t]=0),e.styleMap.ids[t]++}(e,n)}`;return e.styleMap.styles[t]=o}function Kt(e,t,[n,r],o,i){if(e.report.classifyStyles){const a=[];return r&&a.push(Vt(e,r,"h")),a.push(Vt(e,n,i||"s")),` class="${t.concat(a).join(" ")}"${o?` style="${o}"`:""}`}{const e=`${n}${o||""}${r||""}`;return`${""+(t.length?` class="${t.join(" ")}"`:"")}${e?` style="${e}"`:""}`}}function Qt(e,t,n,r){let o=`left:${t.x||0}rem;top:${t.y||0}rem;`,i="";e.width?"number"!=typeof e.width&&"percent"in e.width?o+=`width:${e.width.percent}%;`:o+=`width:${Jt(e,t)}rem;`:o+=`right:${(e.margin||{})[1]||0}rem;`;const a=Wt(e,t,r&&r.computedHeight)||1;if(r&&r.container&&r.computedHeight?i=`height:${a}rem;`:o+=`height:${a}rem;`,e.font&&0===e.font.line?o+="line-height: initial;":o+=""+(!r||!r.container||e.font&&e.font.line?`line-height:${e.font&&e.font.line||Pt(e,t,r&&r.computedHeight)}rem;`:""),e.margin){const t=Gt(e);(t[0]||t[1]||t[2]||t[3])&&(o+=`padding: ${t[0]}rem ${t[1]}rem ${t[2]}rem ${t[3]}rem;`)}else e.font&&e.font.right&&(o+=`padding-right:${e.font.right}rem;`);return(r&&r.font||e.font)&&(o+=en(r&&r.font||e.font)),e.border&&(o+=function(e,t){("string"==typeof e||"object"==typeof e&&("v"in e||"r"in e||"op"in e))&&(e=pt(t,e));if("number"==typeof e)return`border-bottom:${.0625*e}rem solid;`;if(function(e){return"object"==typeof e&&("top"in e||"bottom"in e||"left"in e||"right"in e)}(e))return`border-style:solid;border-width:${.0625*(e.top||0)}rem ${.0625*(e.right||0)}rem ${.0625*(e.bottom||0)}rem ${.0625*(e.left||0)}rem;`;if(Array.isArray(e)){if(1===e.length)return`border:${.0625*(+e[0]||0)}rem solid;`;if(2===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(3===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(4===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[3]||0)}rem;`}}(e.border,n)),[o,i]}function en(e){let t="";return e.family&&(t+=`font-family:${e.family};`),e.color&&(t+=`color:${e.color};`),e.align&&(t+=`text-align:${e.align};`),e.size&&(t+=`font-size:${e.size}rem;`),e.weight&&(t+=`font-weight:${e.weight};`),e.pre&&(t+="white-space:pre-wrap;"),e.clamp&&(t+="white-space:nowrap;overflow:hidden;"),t}Rt("row",((e,t,n,r,o)=>{let i;const a=Jt(e,r);return e.br||r.availableX&&o[0][0]+o[0][2]+a>r.availableX?i={x:n[3],y:Zt(o),availableX:r.availableX&&r.availableX-n[3],maxX:r.maxX}:(i={x:o[0][0]+o[0][2],y:o[0][1],maxX:r.maxX},r.availableX&&(i.availableX=r.availableX-(o[0][0]+o[0][2])-a)),i.y-=t,r.availableY&&(i.availableY=r.availableY-o[0][1]),i}));function tn(e,t,n){let r=n[t.source||t.name]||{value:[]};t.base&&(r={value:pt(xt(e,{value:r.value,special:{source:r}}),t.base)}),t.filter||t.sort||t.group?e.sources[t.name||t.source]=dt(r,t.filter,t.sort,t.group,e):e.sources[t.name||t.source]=r}const nn=F(L(U("\\{{"),(()=>"{{")),L(W(U("\\"),N(1)),(([,e])=>e))),rn=L(R(F(S("\\{",!0),nn,function(e,t){let r,o,i;function a(e,t,i){i=i||[null,0];const a=r.parse(e,t,i);if(!a.length)return a;const l=a[1];return o.parse(e,l,i).length?s(l,1&n&&"unexpected "+e.slice(l,a[1])):a}return i={parse:(n,s,l)=>(r=g(e),o=g(t),i.parse=a,a(n,s,l))},i}(U("{"),U("{")))),(e=>({v:e.join("")})));function on(e){return L(W(U("{{"),ue,U(...e),ye,Ae,ue,U("}}")),(e=>[e[2],e[4]]))}const an=Z(W(U("{{/"),T("}"),U("}}"))),sn={};function ln(e,t){return t?L(on(e),(([e,t])=>({name:e,value:t}))):L(W(U("{{"),ue,U(...e),ue,U("}}")),(([,,e])=>({name:e})))}function un(e){return L(e,(e=>e.length<1?[{v:""}]:e))}const cn=ln(["else"]),fn=ln(["else if","elseif","elsif","elif"],!0),pn=L(W(on(["each"]),un(I(F(fn,cn,sn))),an),(([e,t])=>({op:"each",args:[e[1]].concat(yn(vn(t)))}))),gn=L(W(on(["if"]),un(I(F(fn,cn,sn))),an),(([e,t])=>({op:"if",args:[e[1]].concat(vn(t))}))),hn=L(W(on(["with"]),un(I(F(cn,sn))),an),(([e,t])=>({op:"with",args:[e[1]].concat(yn(vn(t)))}))),dn=L(W(on(["unless"]),un(I(sn)),an),(([e,t])=>({op:"unless",args:[e[1]].concat(bn(t))}))),mn=L(W(U("{{"),ue,Ae,ue,U("}}")),(([,,e])=>({op:"string",args:[e]})));function yn(e){return e.length&&(e[0]={a:e[0]}),e}function vn(e){const t=[];let n=[],r=!1;for(let o=0;o<e.length;o++){const i=e[o];"name"in i?(r=!0,n.length?t.push(bn(n)):t.push({v:""}),i.value&&t.push(i.value),n=[]):n.push(i)}return n.length?t.push(bn(n)):r&&t.push({v:""}),t.length%2&&t.push({v:""}),t}function bn(e){return 1===e.length?e[0]:{op:"+",args:e}}sn.parser=F(rn,pn,gn,hn,dn,mn);const $n=f(L(R(sn),(e=>bn(e))));function xn(e,t){return e?$n(e,Object.assign({detailed:!1,consumeAll:!0},t)):{v:""}}Tt("label",((e,t,n)=>{Yt(t,"label",".label { position: absolute; box-sizing: border-box; }");const r=(Array.isArray(e.text)?e.text:[e.text]).map((n=>{let r=pt(t,"object"==typeof n&&"text"in n?n.text:n);if(e.id){let n=t.context;for(;n;)n.special&&n.special.values&&(n.special.values[e.id]||(n.special.values[e.id]=[])).push(r),n=n.parent}return e.format&&e.format.name&&(r=pt(t,{op:"format",args:[r,`'${e.format.name}'`].concat(e.format.args||[])})),"object"==typeof n&&"text"in n?`<span${Kt(t,[],[en(n.font),""])}>${r}</span>`:r})).join("");return`<span${Kt(t,["label"],Qt(e,n,t))}>${Ht(r)}</span>`})),Tt("container",((e,t,n,r)=>{let o;Yt(t,"container",".container { position: absolute; box-sizing: border-box; }"),e.height?"number"==typeof e.height&&(o=Wt(e,n)):e.height="auto";const i=e.context?Ot(t,{value:pt(t,e.context)}):t,a=_t(e,n)||n.availableX,s=function(e,t,n,r,o){if(Array.isArray(e.widgets)){let i="";const a=(r||{offset:0}).offset,s=[[0,a,0,0]],l=Gt(e);s[0][0]+=l[3],s[0][1]+=l[0];for(let u=r&&r.state&&r.state.last||0;u<e.widgets.length;u++){const c=e.widgets[u];if(c.hide&&pt(t,c.hide))continue;let f=n&&Wt(c,n);if(f>n.maxY&&(f=1),n&&n.availableY&&f>n.availableY)return(r=r||{offset:Zt(s)}).last=u,{output:i,continue:r,height:f+s.map((([e,t])=>e+t)).reduce(((e,t)=>t>e?t:e),0)};{const e=Array.isArray(o)&&o[u];let f=Array.isArray(e)?{x:e[0]+l[3],y:e[1]+l[0],maxX:n.maxX}:e||n;o&&"string"!=typeof o||(f=(o&&It[o]||It.row)(c,a,l,n,s)),f.maxX=f.maxX||n.maxX,f.maxY=f.maxY||n.maxY;const{x:p,y:g}=f,h=Lt(c,t,f,r&&r.child);if("string"==typeof h&&!h||!h.cancel&&!h.output&&!h.height)continue;if("string"==typeof h)i+=h,s.unshift([p,g,Jt(c,n),Wt(c,n)]);else{if(h.cancel&&!s.length)return{output:"",cancel:!0};if(i+=h.output,s.unshift([p,g,h.width||Jt(c,n),h.height||Wt(c,n)]),h.continue)return(r=r||{offset:0}).child=h.continue,r.last=u,r.offset=Zt(s),{output:i,continue:r,height:Zt(s),width:Bt(s)}}}}return{output:i,height:Wt(e,n)||Zt(s)-l[0],width:Jt(e,n)||Bt(s)-l[3]}}return{output:""}}(e,i,{x:0,y:0,availableX:a,availableY:o||n.availableY,maxX:a,maxY:n.maxY},r,e.layout);return s.cancel||(s.output=`<div${Kt(t,["container"],Qt(e,n,t,{computedHeight:o||s.height,container:!0}))}>${s.output}</div>`,s.height=o||s.height,s.width=a||s.width),s}),{container:!0}),Tt("repeater",((e,t,n,r)=>{Yt(t,"container",".container { position: absolute; box-sizing: border-box; }"),e.height||(e.height="auto");let o,i=n.availableY,a=n.availableX,s="",l=!1;const u=Gt(e);let c,f=r&&r.state&&"header"!==r.state.part?0:u[0];i-=f;let p,g=!1,h=r&&r.state&&r.state.src;if(!h){if(!e.source)return"";h=vt(e.source)?pt(t,e.source):dt(t.context.root.sources[e.source.source]||{value:[]},e.source.filter,e.source.sort,e.source.group,t.context).value,(t.context.special||(t.context.special={})).values||(t.context.special.values={})}if(Array.isArray(h))p=h;else{if(!h||!Array.isArray(h.value))return{output:"",height:0};c=h,p=c.value,e.group&&(g=e.group.length>c.grouped&&e.group.length-c.grouped-1)}if(c&&(!r||!r.state||"group"===r.state.part)&&(!1!==g&&(o=Lt(e.group[g],Ot(t,{value:c,special:{group:c.group,level:c&&c.level}}),{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY})),o)){if(o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"group",src:h,current:0}}};i-=o.height,s+=o.output,f+=o.height}if(e.header&&(r&&r.state&&"body"===r.state.part&&!1!==e.headerPerPage&&(!c||!c.grouped)||(!c||!c.grouped)&&(!r||!r.state||"header"===r.state.part||"group"===r.state.part))){if(o=Lt(e.header,t,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"header",src:h,current:0}}};i-=o.height,s+=o.output,f+=o.height}let d=r&&r.state&&r.state.context||Ot(t,{special:{level:c&&c.level,group:c&&c.group,values:{}}});if(!r||!r.state||"footer"!==r.state.part){let u=0,g=0;for(let m=r&&r.state&&r.state.current||0;m<p.length;m++){const y=c&&c.grouped?Ot(d,{value:p[m],special:{index:m,values:{}}}):Ot(d,{value:p[m],special:{index:m}});if(c&&c.grouped){const t=r&&r.child||{offset:0,state:{current:0,src:p[m],part:"group"}};o=Lt(e,y,{x:0,y:f,availableX:a-u,availableY:i,maxX:n.maxX,maxY:n.maxY},t)}else o=Lt(e.row,y,{x:u,y:f,availableX:a-u,maxX:n.maxX,availableY:i,maxY:n.maxY});if(r&&(r.child=null),o.width&&o.width<=a-u&&o.width!==a)u+=o.width,o.height>g&&(g=o.height);else if(o.width&&u&&o.width>a-u){f+=g,i-=g,g=0,u=0,m--;continue}if(o.height>i||o.cancel)return l?{output:`<div${Kt(t,["container","repeat"],Qt(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"body",src:h,current:m,context:d}}}:{output:"",height:f,continue:{offset:f,state:{part:r.state.part,src:h,current:m,context:d}}};if(g||(i-=o.height),g||(f+=o.height),s+=o.output,l=!0,c&&o.continue)return{output:`<div${Kt(t,["container","repeat"],Qt(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"body",src:h,current:m,context:d},child:o.continue}}}}if(e.footer){const a=d&&d.context||r&&r.state&&r.state.context&&r.state.context.context,l=Ot(t,{special:{source:c&&c.grouped?c.all:p,level:c&&c.level,grouped:c&&c.grouped,values:(a&&a.special||{}).values}});if(o=c?e.groupEnds&&e.groupEnds[c.grouped]?Lt(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}):{output:"",height:0}:Lt(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:`<div${Kt(t,["container","repeat"],Qt(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"footer",src:h,current:0,context:d}}};s+=o.output,f+=o.height}return{output:`<div${Kt(t,["container","repeat"],Qt(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f}}),{container:!0}),Tt("image",((e,t,n)=>(Yt(t,"image",".image { position: absolute; }"),`<img src="${pt(t,e.url)}"${Kt(t,["image"],Qt(e,n,t))} />`))),Tt("measured",((e,t,n,r)=>{const o=pt(t,e.text),i=Ft(o,_t(e,n)||n.availableX,e.font);if(!r&&i>n.availableY)return{output:"",height:0,continue:{state:{},offset:0}};{let r=Qt(e,n,t,{computedHeight:i,container:!0});return r[0]=`display:inline-block;white-space:pre-wrap;line-height:${e.font&&e.font.line||e.font&&e.font.size||1}rem;`+r[0],{height:i,output:`<span${Kt(t,["label"],r)}>${Ht(o)}</span>`}}})),Tt("html",((e,t,n)=>{Yt(t,"html",".html {position:absolute;box-sizing:border-box;overflow:hidden;word-break:break-all;line-height:1rem;}");const r=pt(Ot(t,{parser:xn}),e.html);return`<div${Kt(t,["html"],Qt(e,n,t,{container:!0}))}>${r}</div>`}));const wn=/(\d)(?=(\d{3})+\.)/g,An=/(\d)(?=(\d{3})+$)/g,jn=/^[-0-9\\.,]+$/;function kn(e,t=2){return e="number"!=typeof e?parseFloat(e||""):e,isNaN(e)?"":(e=e.toFixed(t),0===t&&(e=e.replace(/\..*/,"")),e.replace(-1===e.indexOf(".")?An:wn,"$1,"))}const Mn=/y+|M+|d+|E+|H+|m+|s+|k+|h+|a+/g,Dn=["January","February","March","April","May","June","July","August","September","October","November","December"],Xn=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let Yn;function On(e,t){if(!e)return"";if("string"==typeof e)e=new Date(e);else if("[object Date]"!==Object.prototype.toString.call(e))return"";const n=e;return t||(t=Yn),t?t.replace(Mn,(e=>{if("y"===e[0])return e.length<=2?(""+n.getFullYear()).substr(2,2):""+n.getFullYear();if("M"===e[0])return 1===e.length?""+(n.getMonth()+1):2===e.length?n.getMonth()<9?"0"+(n.getMonth()+1):""+(n.getMonth()+1):3===e.length?Dn[n.getMonth()].substr(0,3):Dn[n.getMonth()];if("d"===e[0])return 1===e.length?""+n.getDate():n.getDate()<=9?"0"+n.getDate():""+n.getDate();if("E"===e[0])return 1===e.length?""+(n.getDay()+1):2===e.length?Xn[n.getDay()].substr(0,3):Xn[n.getDay()];if("H"===e[0])return 1===e.length?""+n.getHours():n.getHours()<=9?"0"+n.getHours():""+n.getHours();if("m"===e[0])return 1===e.length?""+n.getMinutes():n.getMinutes()<=9?"0"+n.getMinutes():""+n.getMinutes();if("s"===e[0])return 1===e.length?""+n.getSeconds():n.getSeconds()<=9?"0"+n.getSeconds():""+n.getSeconds();if("k"===e[0]||"h"===e[0]){let e=""+n.getHours()%12;return"0"===e&&(e="12"),""+e}return"a"===e[0]?n.getHours()>11?"PM":"AM":void 0})):new Date(+e-6e4*e.getTimezoneOffset()).toISOString().substr(0,10)}function zn(e,t){return{type:"value",names:e,apply:t}}On.setDefault=function(e){Yn=e};const Cn=/^\s*$/;function Hn(e){return!isNaN(e)&&!Cn.test(e)}function Nn(e){return isNaN(e)||!e?0:+e}ht(zn(["is","is-not","==","!="],((e,t)=>{const[n,r]=t,o=n==r;return"is"===e||"=="===e?o:!o})),zn(["not"],((e,t)=>!t[0])),zn(["<",">","<=",">="],((e,t)=>{let[n,r]=t;return n instanceof Date||r instanceof Date?"number"==typeof n||"number"==typeof r?(n=+n,r=+r):"string"==typeof n||"string"==typeof r?(n=new Date(n),r=new Date(r)):"f"in n&&"o"in n?(n=jt(n)["<"===e[0]?1:0],r=new Date(r)):"f"in r&&"o"in r&&(r=jt(r)["<"===e||">="===e?0:1],n=new Date(n)):kt(n)?(n=jt(n)["<"===e[0]?1:0],r=kt(r)?jt(r)["<"===e||">="===e?0:1]:new Date(r)):kt(r)&&(r=jt(r)["<"===e||">="===e?0:1],n=new Date(n)),"<"===e?n<r:">"===e?n>r:"<="===e?n<=r:">="===e&&n>=r})),zn(["like","not-like","ilike","not-ilike"],((e,t)=>{const[n,r,o]=t;if("string"!=typeof r)return!1;let i;const a=new RegExp(`${"free"===o?"":"^"}${r.replace(/[\s\%\*]+/g,".*").replace(/\?/g,".")}${"free"===o?"":"$"}`,~e.indexOf("ilike")?"i":"");return i=Array.isArray(n)?!!n.find((e=>a.test(e))):a.test(n),"like"===e||"ilike"===e?i:!i})),zn(["in","not-in"],((e,t)=>{const[n,r]=t;if(kt(r)){const t=jt(r),o=kt(n)?jt(n)[0]:new Date(n),i=o>=t[0]&&o<=t[1];return"in"===e?i:!i}if(!Array.isArray(r)&&"string"!=typeof r)return"in"===e?n==r:n!=r;const o=!!~r.indexOf(n);return"in"===e?o:!o})),zn(["contains","does-not-contain"],((e,t)=>{const[n,r]=t;if(kt(n)){const t=jt(n),o=kt(r)?jt(r)[0]:new Date(r),i=o>=t[0]&&o<=t[1];return"contains"===e?i:!i}if(!Array.isArray(n)&&"string"!=typeof n)return!1;const o=!!~n.indexOf(r);return"contains"===e?o:!o})),zn(["get"],((e,t,n)=>{const[r,o]=t,i=xt(n,{value:r});return"string"==typeof(a=o)||"object"==typeof a&&Array.isArray(a.k)?ct(i,o):pt(i,o);var a})),zn(["array"],((e,t)=>t)),zn(["object"],((e,t)=>{const n={};for(let e=0;e<t.length;e+=2)n[t[e]]=t[e+1];return n})),zn(["split"],((e,[t,n])=>"string"!=typeof t?[t]:t.split(n||""))),zn(["filter"],((e,t,n)=>{let[r,o,i,a]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return[];r=r.value}return dt({value:r},o,i,a,n).value})),zn(["source"],((e,t)=>{const[n]=t;return{value:n}})),zn(["group"],((e,t,n)=>{n=n||new $t({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return dt({value:r},null,null,o,n)})),zn(["sort"],((e,t,n)=>{n=n||new $t({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return dt({value:r},null,o,null,n)})),zn(["time-span","time-span-ms"],((e,t)=>{let n=t[0],r="object"==typeof t[t.length-1]?t[t.length-1].unit:null;"string"!=typeof r&&(r=null),r=r&&("y"===r[0]?"y":"w"===r[0]?"w":"d"===r[0]?"d":"h"===r[0]?"h":"s"===r[0]?"s":"m"===r||"mo"===r.substr(0,2)?"m":"mm"===r||"min"===r.substr(0,3)?"mm":"ms"===r||"mil"===r.substr(0,3)?"ms":null);const o="number"==typeof t[1]?t[1]:r?0:1;if(r)return o?(n/he[r]).toFixed(o):Math.floor(n/he[r]);{const e=[0,0,0,0,0,0];e:{if(""===n||isNaN(n))return"";if(n=Math.abs(+n),e[0]=Math.floor(n/he.w),o<e.filter((e=>e)).length)break e;if(n%=he.w,e[1]=Math.floor(n/he.d),o<e.filter((e=>e)).length)break e;if(n%=he.d,e[2]=Math.floor(n/he.h),o<e.filter((e=>e)).length)break e;if(n%=he.h,e[3]=Math.floor(n/he.mm),o<e.filter((e=>e)).length)break e;if(n%=he.mm,e[4]=Math.floor(n/he.s),o<e.filter((e=>e)).length)break e;e[5]=n%he.s}let t="";return e[0]&&(t+=`${e[0]} week${e[0]>1?"s":""}`),e[1]&&(t+=`${t.length?" ":""}${e[1]} day${e[1]>1?"s":""}`),e[2]&&(t+=`${t.length?" ":""}${e[2]} hour${e[2]>1?"s":""}`),e[3]&&(t+=`${t.length?" ":""}${e[3]} minute${e[3]>1?"s":""}`),e[4]&&(t+=`${t.length?" ":""}${e[4]} second${e[4]>1?"s":""}`),e[5]&&(t+=`${t.length?" ":""}${e[5]} millisecond${e[5]>1?"s":""}`),t}})),zn(["string"],((e,[t])=>{if(null==t)return"";if(Array.isArray(t))return t.join(", ");let n=""+t;return"[object"===n.slice(0,7)?JSON.stringify(t):n})),zn(["call"],((e,t)=>{if(null!=t[0]&&"string"==typeof t[1]&&"function"==typeof t[0][t[1]]){const e=t.shift();return e[t.shift()].apply(e,t)}if("function"==typeof t[0]){return t.shift().apply(null,t)}}))),ht(zn(["+"],((e,t)=>{if(Array.isArray(t[0]))return t[0].concat.apply(t[0],t.slice(1));if(kt(t[0])&&t.length>1&&t.slice(1).reduce(((e,t)=>e&&Dt(t)),!0))return t.slice(1).reduce(((e,t)=>Xt(e,t,1)),Mt(t[0]));if("number"!=typeof t[0]&&t.length>1&&Dt(t[0]))return t.slice(1).reduce(((e,t)=>function(e,t){if("number"==typeof e&&"number"==typeof t)return e+t;{const n={d:[]};if("number"==typeof e)n.d[6]=e;else for(let t=0;t<7;t++)e.d[t]&&(n.d[t]=e.d[t]);if("number"==typeof t)n.d[6]=(n.d[6]||0)+t;else for(let e=0;e<7;e++)t.d[e]&&(n.d[e]=(n.d[e]||0)+t.d[e]);return n}}(e,t)),t[0]);return t.reduce(((e,t)=>e&&Hn(t)),!0)?t.reduce(((e,t)=>e+ +t),0):t.reduce(((e,t)=>e+(null==t?"":t)),"")})),zn(["-"],((e,t)=>{const n=t.shift();if(kt(n)){if(t.reduce(((e,t)=>e&&kt(t)),!0))return t.reduce(((e,t)=>e-+Mt(t)),+Mt(n));if(t.reduce(((e,t)=>e&&Dt(t)),!0))return t.reduce(((e,t)=>Xt(e,t,-1)),Mt(n))}return t.reduce(((e,t)=>e-(Hn(t)?+t:0)),Hn(n)?+n:0)})),zn(["*"],((e,t)=>{const n=t.shift();return Hn(n)?t.reduce(((e,t)=>e*(Hn(t)?+t:0)),+n):0})),zn(["/","/%"],((e,t)=>{const n=t.shift();return isNaN(n)?0:e.length>1?t.reduce(((e,t)=>Math.floor(e/(isNaN(t)?1:+t))),+n):t.reduce(((e,t)=>e/(isNaN(t)?1:+t)),+n)})),zn(["%"],((e,t)=>{const n=t.shift();return t.reduce(((e,t)=>e%(isNaN(t)?1:+t)),isNaN(n)?0:+n)})),zn(["pow","**"],((e,t)=>{const n=t.pop(),r=Math.pow(t.pop(),n);return t.reverse().reduce(((e,t)=>Math.pow(t,e)),r)})),zn(["abs"],((e,t)=>"number"!=typeof t[0]?t[0]:Math.abs(t[0]))),zn(["round"],((e,t)=>Math.round(t[0]))),zn(["floor"],((e,t)=>Math.floor(t[0]))),zn(["ceil"],((e,t)=>Math.ceil(t[0]))),zn(["rand","random"],((e,[t,n,r])=>{let o;return null==t?Math.random():("number"!=typeof n?o=Math.random()*t:"number"==typeof n&&(o=Math.random()*(n-t)+t),!0===n||!0===r?o:Math.round(o))})));const Tn=/^\s*/,Sn=/\s*$/,Un=/([\.\[\]\{\}\(\)\^\$\*\+\-])/g;ht(zn(["padl","padr"],((e,t)=>{let[n,r,o]=t;if("string"!=typeof n&&(n=""+n),!Hn(r))return n;o||(o=" "),"string"!=typeof o&&(o=""+o),o.length<1&&(o=" ");for(let t=n.length;t<r;t=n.length)"padl"===e?n=o+n:n+=o;return n})),zn(["trim","triml","trimr"],((e,t)=>{let[n]=t;return n=""+n,"trim"!==e&&"trimr"!==e||(n=n.replace(Sn,"")),"trim"!==e&&"triml"!==e||(n=n.replace(Tn,"")),n})),zn(["slice","substr"],((e,[t,n,r])=>{if(t&&"function"==typeof t.slice)return t.slice(n,r)})),zn(["len","length"],((e,[t])=>t&&"length"in t?t.length:0)),zn(["replace","replace-all"],((e,[t,n,r,o])=>{t=""+t;const i="string"==typeof o;return"replace-all"===e||i?t.replace(new RegExp(i?n:n.replace(Un,"\\$1"),("replace"===e||o&&~o.indexOf("g")?o:(o||"")+"g")||"g"),r):t.replace(n,r)})),zn(["reverse"],((e,[t])=>{if("string"==typeof t){let e="";for(let n=0;n<t.length;n++)e=t[n]+e;return e}if(Array.isArray(t))return t.reverse()})),zn(["keys"],((e,[t,n])=>{if(!t)return[];if(n){const e=[];for(const n in t)e.push(n);return e}return Object.keys(t)})),zn(["values"],((e,[t])=>t?Object.values(t):[])),zn(["date"],((e,[t])=>void 0!==t?kt(t)?Mt(t):new Date(t):new Date)),zn(["upper","lower"],((e,[t])=>(t=null==t?"":t,"upper"===e?(""+t).toUpperCase():(""+t).toLowerCase()))),zn(["format","fmt"],((e,t)=>{let[n,r,...o]=t;const i=wt[r];return i?i(n,o):""+n}))),ht({type:"checked",names:["and","&&"],checkArg:(e,t,n,r)=>r?"continue":{result:r},apply:(e,t)=>t[t.length-1]},{type:"checked",names:["or","||"],checkArg:(e,t,n,r)=>r?{result:r}:"continue",apply:()=>!1},{type:"checked",names:["if","unless"],checkArg:(e,t,n,r)=>t%2==0?t===n?{result:r}:("if"===e?!r:r)?{skip:1}:"continue":{result:r},apply(){}},{type:"checked",names:["each"],checkArg:(e,t,n,r)=>0===t?Array.isArray(r)||"object"==typeof r?"continue":{skip:1}:1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply(e,[t,n],r){if(r=r||new $t,Array.isArray(t)){const e=t.length-1;return t.map(((t,o)=>pt(xt(r,{value:t,special:{last:e,index:o,key:o,"last-key":e}}),n,t))).join("")}{const e=Object.entries(t),o=e[e.length-1][0],i=e.length-1;return Object.entries(t).map((([e,t],a)=>pt(xt(r,{value:t,special:{last:i,"last-key":o,index:a,key:e}}),n,t))).join("")}}},{type:"checked",names:["with"],checkArg:(e,t,n,r)=>0===t&&"object"==typeof r?"continue":1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply:(e,[t,n],r)=>pt(xt(r=r||new $t,{value:t}),n,t)},{type:"checked",names:["coalesce","coalesce-truth"],checkArg:(e,t,n,r)=>"coalesce"===e&&null!=r||r?{result:r}:"continue",apply(){}}),ht({type:"aggregate",names:["avg"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+Nn(n[0]?pt(r,n[0],t):t)),0)/t.length},{type:"aggregate",names:["sum"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+Nn(n[0]?pt(r,n[0],t):t)),0)},{type:"aggregate",names:["count"],apply:(e,t,n,r)=>n.length?t.filter((e=>pt(r,n[0],e))).length:t.length},{type:"aggregate",names:["min","max"],apply:(e,t,n,r)=>(n[0]&&(t=t.map((e=>pt(r,n[0],e)))),Math[e].apply(Math,t))},{type:"aggregate",names:["first","nth","last"],apply(e,t,n,r){let o,i=0;if("first"===e)o=t[0];else if("last"===e)o=t[t.length-1];else if(n[0]){const e=pt(r,n[0]);"number"==typeof e&&(o=t[e],i=1)}return n[i]&&(o=pt(r,n[i])),o}},{type:"aggregate",names:["map"],apply:(e,t,n,r)=>n[0]?t.map((e=>pt(r,n[0],e))):t},{type:"aggregate",names:["unique","unique-map"],apply(e,t,n,r){const o=[],i=[];for(const e of t){const t=n[0]?pt(r,n[0],e):e;~o.indexOf(t)||(o.push(t),i.push(e))}return"unique"===e?i:o}},{type:"aggregate",names:["join"],apply:(e,t,n,r)=>n.length>1?t.map((e=>pt(r,n[0],e))).join(pt(r,n[1])):t.join(pt(r,n[0]))},{type:"aggregate",names:["find"],apply(e,t,n,r){if(n[0]){if("object"==typeof n[0]&&"a"in n[0])return t.find((e=>pt(r,n[0],e)));{const e=pt(r,n[0]);return t.find((t=>t==e))}}}}),At("dollar",((e,[t,n])=>function(e,t,n=2,r="$"){return e&&jn.test(e)&&+e>0?`${r}${kn(e,n)}`:void 0!==t?t:e}(e,void 0,t,n))),At("date",((e,[t])=>On(e,t))),At("integer",((e,[])=>kn(e,0))),At("int",((e,[])=>kn(e,0))),At("number",((e,[t])=>kn(e,t))),At("num",((e,[t])=>kn(e,t))),At("phone",(e=>{return"number"==typeof(t=e)&&(t=t.toString()),7===(t=(t=t||"").replace(/[^\d]/g,"")).length?`${t.substr(0,3)}-${t.substr(3,4)}`:10===t.length?`(${t.substr(0,3)}) ${t.substr(3,3)}-${t.substr(6,4)}`:11===t.length?`${t[0]}-${t.substr(1,3)}-${t.substr(4,3)}-${t.substr(7,4)}`:t;var t}));const qn=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function En(e){const t=Ln(e);let n=Array.isArray(e)?e[0]||{}:e;if(Array.isArray(n)||"object"==typeof n){const e=[];for(const t in n)e.push(Fn(t,n[t]));return{root:t,fields:e}}return{root:t}}function Fn(e,t){const n=Ln(t);if(~n.indexOf("object")||"array"===n){const r=En(t);return r.fields?{type:n,fields:r.fields,name:e}:{type:n,name:e}}return{type:Ln(t),name:e}}function Ln(e){return"string"==typeof e?qn.test(e)?"date":"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":Array.isArray(e)?e.length<1?"array":"string"==typeof e[0]?qn.test(e[0])?"date[]":"string[]":"number"==typeof e[0]?"number[]":"boolean"==typeof e[0]?"boolean[]":"object"==typeof e[0]&&e[0]instanceof Date?"date[]":"object"==typeof e[0]?"object[]":"array":"object"==typeof e?e instanceof Date?"date":"object":"any"}const In=new RegExp(`[${me.split("").map((e=>"\\"+e)).join("")}]`),Rn=["op","args"];let _n=!1,Jn=!1;function Pn(e){if("r"in e){if("string"==typeof e.r)return/^[0-9]/.test(e.r)?"."+e.r:e.r;{const t=e.r;return`${function(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}("^",t.u||0)}${t.p||""}${t.k.map(((e,t)=>"string"==typeof e||"number"==typeof e?(t?"":".")+"{{p}":`[${Pn(e)}]`)).join("")}`}}if("op"in e){if("array"===e.op)return`[${e.args?e.args.map((e=>Pn(e))).join(" "):""}]`;if("object"===e.op&&e.args&&!e.args.find(((e,t)=>t%2==0&&(!("v"in e)||"string"!=typeof e.v)))){let t="{";if(e.args)for(let n=0;n<e.args.length;n+=2)t+=`${n>0?" ":""}${Jn=!0,Pn(e.args[n])}:${Jn=!1,Pn(e.args[n+1])}`;return t+="}",t}return"+"===e.op&&e.args&&e.args.length>0&&"object"==typeof e.args[0]&&"string"==typeof e.args[0].v?`'${e.args.map((e=>"v"in e&&"string"==typeof e.v?e.v.replace(/[\$']/g,(e=>"\\"+e)):`\${${Pn(e)}}`)).join("")}'`:`(${e.op}${e.args&&e.args.length?" "+e.args.map((e=>Pn(e))).join(" "):""})`}if("a"in e)return"=>"+Pn(e.a);if("v"in e){if("string"==typeof e.v)return!Jn&&_n||In.test(e.v)||!e.v.length?~e.v.indexOf("'")?~e.v.indexOf("`")?~e.v.indexOf('"')?`'${e.v.replace(/['\$]/g,(e=>"\\"+e))}'`:`"${e.v}"`:`\`${e.v.replace(/[\$`]/g,(e=>"\\"+e))}\``:`'${e.v.replace(/[\$']/g,(e=>"\\"+e))}'`:`${Jn?"":":"}${e.v}`;if("number"==typeof e.v||"boolean"==typeof e.v)return""+e.v;if("undefined"===e.v)return"undefined";if("null"===e.v)return"null";if(Array.isArray(e.v))return`[${e.v.map((e=>Pn({v:e}))).join(" ")}]`;if("object"==typeof e.v){if(e.v instanceof Date)return`#${e.v.getFullYear()}-${e.v.getMonth()+1}-${e.v.getDate()}#`;{const t=Object.keys(e.v);return 1===t.length&&("r"===t[0]||"v"===t[0])||"op"in e.v&&!t.find((e=>!Rn.includes(e)))?"%"+Pn(e.v):`{${t.map((t=>`${Jn=!0,Pn({v:t})}:${Jn=!1,Pn({v:e.v[t]})}`)).join(" ")}}`}}}}e.PageSizes={letter:{width:51,height:66,margin:[1.5,1.5]},legal:{width:51,height:84,margin:[1.5,1.5]},tabloid:{width:66,height:102,margin:[1.5,1.5]},a4:{width:49.606302,height:70.15746,margin:[1.5,1.5]}},e.Root=$t,e.applySource=tn,e.evaluate=pt,e.extend=xt,e.filter=dt,e.getOperatorMap=function(){return Object.assign({},gt)},e.inspect=En,e.isValueOrExpr=vt,e.join=function(e,t){return{parent:e,root:e.root,path:e.path?`${e.path}.${t}`:t,value:ct(e,t)}},e.parse=ut,e.parseTemplate=xn,e.registerFormat=At,e.registerLayout=Rt,e.registerOperator=ht,e.registerRenderer=Tt,e.run=function(e,t,n,r){const o=n&&"root"in n&&n.root===n?n:new $t(Object.assign({},e.context),{parameters:n});if(e.sources){for(const n of e.sources)tn(o,n,t);for(const e in o.sources)o.value[e]=o.sources[e].value}return"delimited"===e.type?function(e,t){const n=t.root.sources[e.source?e.source:e.sources[0].name||e.sources[0].source];let r="";e.headers&&(r+=e.headers.map((n=>`${e.quote||""}${pt(t,n)}${e.quote||""}`)).join(e.field||",")+(e.record||"\n"));const o=Array.isArray(n.value)?n.value:[n.value],i=e.quote?new RegExp(e.quote,"g"):void 0;for(const n of o){const o=xt(t,{value:n});r+=e.fields.map((t=>{let n=""+pt(o,t);return i&&(n=n.replace(i,e.quote+e.quote)),`${e.quote||""}${n}${e.quote||""}`})).join(e.field||",")+(e.record||"\n")}return r}(e,o):"flow"===e.type?function(e,t,n){const r={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};let o,i="",a=0,s=null;e.width?o=e.width:e.size&&(o="landscape"===e.orientation?e.size.height:e.size.width);for(const t of e.widgets){let e;i+=`<div${Kt(r,[],["position:absolute;right:0rem;left:0rem;"+(o?`width:${o}rem;`:""),""],`top:${a}rem;`,"p")}>\n`;let n=0;do{if(e=Lt(t,r,{x:0,y:n,availableX:o,maxX:o},s),"string"==typeof e)throw new Error("Container widget didn't specify used height");i+=e.output,n+=e.height,s=e.continue?e.continue:null}while(null!==s);a+=n,i+="</div>\n"}const l=e.size&&e.size.margin?Gt(e.size):[1.5,1.5,1.5,1.5];return`<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${o?` width: ${o}rem;`:""} }\n    #wrapper { height:${a}rem; position: relative; }\n    @media screen {\n      body { margin: 1rem; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${l[0]}rem ${l[1]}rem ${l[2]}rem ${l[3]}rem; }\n      html { background-color: #999; }\n    }${Object.entries(r.styles).map((([e,t])=>t)).join("\n")}${Object.entries(r.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n<div id=wrapper>${i}</div>${n&&n.foot||""}</body></html>`}(e,o,r):function(e,t,n){let r="landscape"===e.orientation?{width:e.size.height,height:e.size.width,margin:[e.size.margin[1],e.size.margin[0]]}:e.size;const o={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};t.special=t.special||{},t.special.page=0,t.special.pages=0;const i=[""];let a=0,s=r.height-2*r.margin[0],l=s,u=0;const c=r.width-2*r.margin[1];let f=null,p=0;if(e.header){p=Lt(e.header,o,{x:0,y:0,availableX:c,availableY:s,maxX:c,maxY:l}).height,s-=p,l-=p,u+=p}let g=0;if(e.footer){g=Lt(e.footer,o,{x:0,y:0,availableX:c,availableY:s,maxX:c,maxY:l}).height,s-=g,l-=g}for(const t of e.widgets){let e;do{e=Lt(t,o,{x:0,y:u,availableX:c,availableY:s,maxX:c,maxY:l},f),i[a]+=e.output,e.continue?(a++,i[a]="",u=p,s=r.height-2*r.margin[0]-p-g,f=e.continue):(u+=e.height,s-=e.height,f=null)}while(null!==f)}t.special.pages=i.length;const h=r.height-2*r.margin[0]-g;return i.forEach(((n,r)=>{let a=`<div class="page-back pb${r}"><div${Kt(o,["page","ps"+r],["",""],"","p")}>\n`;if(t.special.page=r+1,e.header){a+=Lt(e.header,o,{x:0,y:0,maxX:c,maxY:l}).output+"\n"}if(a+=n,e.footer){a+=Lt(e.footer,o,{x:0,y:h,maxX:c,maxY:l}).output+"\n"}a+="\n</div></div>",i[r]=a})),`<html style="font-size:100%;margin:0;padding:0;"><head><style>\n    .page { width: ${r.width-2*r.margin[1]}rem; height: ${r.height-2*r.margin[0]}rem; position: absolute; overflow: hidden; left: ${r.margin[1]}rem; top: ${r.margin[0]}rem; }\n    .page-back { width: ${r.width}rem; height: ${r.height}rem; }\n    @media screen {\n      html { min-width: ${r.width+2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { font-size: 0.83rem; margin: 0; padding: 0; ${r?`width:${r.width}rem;`:""}background-color: none; display: block; height: ${i.length*r.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${i.map(((e,t)=>`.pb${t} { top: ${t*r.height}rem; }`)).join("")}\n    }\n    @page {\n      size: ${r.width}em ${r.height}em;\n    }${Object.entries(o.styles).map((([e,t])=>t)).join("\n")}${Object.entries(o.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n${i.reduce(((e,t)=>e+t),"")}${n&&n.foot||""}</body></html>`}(e,o,r)},e.safeGet=ct,e.stringify=function(e,t){return _n=(t=t||{}).noSymbols,Jn=!1,Pn(e)},e.unregisterFormat=function(e){delete wt[e]},e.unregisterOperator=function(...e){for(const t of e)for(const e of t.names)delete gt[e]},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=raport.umd.min.js.map
