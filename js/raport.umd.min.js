!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Raport={})}(this,(function(e){"use strict";const t=[];let n=0;const r=[0,""],o=[0,""];function i(){return r}function s(e){return a(e?e.name||e:void 0),r.slice()}function a(e){!r[2]&&e&&(r[0]===o[0]&&r[2]===o[2]&&(o[2]=e),r[2]=e)}function l(e,i,s,a,l){return r[0]=e,r[1]=i||"",r[2]=s,r[3]=a,r[4]=l,1&n&&r[0]>=o[0]&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[4]=r[4]),t}function c(e){return"string"==typeof e||e&&"name"in e&&"string"==typeof e.name}function u(e,t){return{start:e,end:e,children:[],name:t}}function f(e,t,n){if(e.end=n[1],!m||e.end!==e.start)if(e.result=n[0],t)if(m)if(e.name&&e.name.primary){const n=e.children[0];if(1===e.children.length&&n.start===e.start&&n.end===e.end)t.children.push(n);else{e.name=e.name.name,e.children.reduce(((t,n,r)=>(t<n.start&&((e.extra||(e.extra={}))[r]=[t,n.start]),n.end)),e.start);const n=e.children[e.children.length-1];n&&e.end>n.end&&((e.extra||(e.extra={}))[e.children.length]=[n.end,e.end]),t.children.push(e)}}else e.children.length&&t.children.push.apply(t.children,e.children);else t.children.push(e);else{e.children.reduce(((t,n,r)=>(t<n.start&&((e.extra||(e.extra={}))[r]=[t,n.start]),n.end)),e.start);const t=e.children[e.children.length-1];t&&e.end>t.end&&((e.extra||(e.extra={}))[e.children.length]=[t.end,e.end])}}function p(e,t){let n=1;for(;~(t=e.lastIndexOf("\n",t))&&t;)n++,t--;return n}function g(e,t,n){const r=[],o=e[0];let i=o,s=i=t.lastIndexOf("\n",i),a=t.lastIndexOf("\n",i-1);for(let e=0;e<n&&~i;e++)r.unshift(t.substring(a+1,i)),i=a,a=t.lastIndexOf("\n",i-1);const l=r.length+1;a=s,i=t.indexOf("\n",a+1),-1===i&&a<t.length&&(i=t.length);for(let e=0;e<=n&&~i;e++)r.push(t.substring(a+1,i)),a=i,i=t.indexOf("\n",a+1),-1===i&&a<t.length&&(i=t.length);const c=r[l-1];let u="";const f=o-(~s?s:-1)-1;for(let e=0;e<f;e++)u+="\t"===c[e]?"\t":" ";return u+="^--",{context:r,column:o-s,line:p(t,o),position:o,source:c,message:e[1],marked:`${r.slice(0,l).join("\n")}\n${u}\n${r.slice(l).join("\n")}`,cause:e[3]&&g(e[3],t,n),causes:e[4]&&e[4].map((e=>g(e,t,n))),parser:e[2]?e[2].name||e[2]:void 0}}function d(e){let t=e;if(e[3]){const n=d(e[3]);n[0]>t[0]&&(t=n)}if(e[4]){const n=e[4].length;for(let r=0;r<n;r++){const n=d(e[4][r]);n[0]>t[0]&&(t=n)}}return o[0]>=r[0]&&o[1]!==e[1]?o:t}const h=/^\s*/,y={};let m=!1;function $(e,t){let r;const s=t,a=t?(t.detailed?1:0)+(t.causes?2:0):0,c=t&&t.consumeAll,p=function(t,p){const $=p&&"trim"in p?p.trim:s&&s.trim,b=$?h.exec(t)[0].length:0;$&&(e=y.map(y.seq(e,y.skip(" \t\r\n")),(([e])=>e)));const x=p?(p.detailed?1:0)+(p.causes?2:0):a;let w=[null,0];1&x&&(o[0]=0,o[1]="",o[2]=void 0,o[3]=void 0,o[4]=void 0);const k=p&&"tree"in p&&p.tree&&u(0);if(m=k&&!0===(p&&"compact"in p?p.compact:!(!s||!("compact"in s))&&s.compact),x!==n){const o=n;n=x,w=(r||(r=v(e))).parse(t,b,w,k),n=o}else w=(r||(r=v(e))).parse(t,b,w,k);if(w.length&&(p&&"consumeAll"in p?p.consumeAll:c)&&w[1]<t.length&&(w=l(w[1],1&x&&`expected to consume all input, but only ${w[1]} chars consumed`)),w.length){if(k){if(f(k,null,w),!m&&$){const e=k.children[0].children[0];return e.result=w[0],e}return k}return w[0]}{if(p&&"undefinedOnError"in p?p.undefinedOnError:s&&s.undefinedOnError)return;const e=i(),n=(p&&"contextLines"in p?p.contextLines:s&&s.contextLines)||0,r=g(A(e[4]||[],e),t,n),o=d(e);if(e!==o&&(r.latest=g(o,t,n)),p&&"throw"in p?p.throw:s&&s.throw){const e=new Error(r.message);throw Object.assign(e,r)}return r}};return p.parser=e,p}const b={parse:(e,t)=>l(t,1&n&&"uninitialized lazy parser")};function v(e){return e.parser||e||b}function x(e,t){let n;return n={parse:(r,o,i,s)=>(e(),n.parse=t,t(r,o,i,s))},n}function w(e){let t="";const n=e.length;for(let r=0;r<n;r++)e[r]&&(t=t.concat(e[r]));return t}function A(e,t){if(!e||!t)return o;let n,r=t[0];t[4]=e;const i=e||[];for(let e=0;e<i.length;e++)i[e][0]>r&&(n=i[e],r=n[0]);return n?[n[0],n[1],n[2],t]:t}function k(){return!1}function j(e,t){return e===t}function M(e,t){return e[0]===t||e[1]===t}function O(e,t){return e[0]===t||e[1]===t||e[2]===t}function D(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t}function z(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t}function Y(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t}function C(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t}function X(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t}function T(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t}function N(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t||e[9]===t}function U(e,t){const n=e.length;for(let r=0;r<n;r++)if(e[r]===t)return!0;return!1}function S(e,t){let n,r,o=e.length-1,i=0;if(t<e[0]||t>e[o])return!1;for(;i<=o;){if(n=i+o>>1,r=e[n],r===t)return!0;r<t?i=n+1:o=n-1}}function F(e,t=!0){const n=e.length;return 0===n?k:1===n?j:2===n?M:3===n?O:4===n?D:5===n?z:6===n?Y:7===n?C:8===n?X:9===n?T:10===n?N:t?S:U}function q(e){let t="";const n=e.split("").sort().join("");for(let e=0;e<n.length;e++)~t.indexOf(n[e])||(t+=n[e]);return t}function E(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(!r(n,e[i]))return i;return o}function H(e){const t=q(e),n=F(t);return{parse:(e,r,o)=>(o[1]=E(e,r,t,n),o)}}function L(e){const t=q(e),n=F(t);return{parse(e,r,o){const i=E(e,r,t,n);return o[0]=e.substring(r,i),o[1]=i,o}}}function _(e,t){const r=q(e),o=F(r);return{parse(i,s,a){const c=E(i,s,r,o);return c===s?l(s,1&n&&`expected one of ${JSON.stringify(e)}`,t):(a[0]=i.substring(s,c),a[1]=c,a)}}}function R(e,t,r){const o=t&&q(t),i=F(o||"");return{parse(t,s,a){if(t.length-s>=e){const c=t.substr(s,e);if(o)for(let t=0;t<e;t++)if(!i(o,c[t]))return l(s+t,1&n&&"unexpected char",r);return a[0]=c,a[1]=s+e,a}return l(s,1&n&&"unexpected end of input",r)}}}function P(e,t,r){const o=q(e),i=F(o);return{parse(s,a,c){const u=function(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(r(n,e[i]))return i;return o}(s,a,o,i);return!t&&u>=s.length?l(u-1,1&n&&`expected one of ${JSON.stringify(e)} before end of input`,r):(c[0]=u?s.substring(a,u):"",c[1]=u,c)}}}function I(e,t,r){const o=P(e,t);return{parse(e,t,i){const s=o.parse(e,t,i);return s.length?s[1]>t?s:l(t,1&n&&"expected at least one character",r):s}}}function J(...e){const t=e.length;if(1===t){const t=e[0],r=t.length;if(1===r)return{parse:(e,r,o)=>e[r]===t?(o[0]=t,o[1]=r+1,o):l(r,1&n&&`expected ${t}`)};if(2===r)return{parse:(e,r,o)=>e[r]===t[0]&&e[r+1]===t[1]?(o[0]=t,o[1]=r+2,o):l(r,1&n&&`expected ${t}`)};{let e,o;return{parse(i,s,a){for(e=0,o=s+e;e<r;e++,o++)if(t[e]!==i[o])return l(s,1&n&&`expected ${t}`);return a[0]=t,a[1]=s+r,a}}}}return{parse(r,o,i){e:for(let n=0;n<t;n++){const t=e[n],s=t.length;if(1!==s){for(let e=0;e<s;e++)if(t[e]!==r[o+e])continue e;return i[0]=t,i[1]=o+s,i}if(r[o]===t)return[t,o+s]}return l(o,1&n&&`expected ${e.length>1?"one of ":""}${e.map((e=>`${e}`)).join(", ")}`)}}}function Z(...e){const t=e.slice(),r=_(t.map((e=>e.toLowerCase()+e.toUpperCase())).join("")),o=t.map((e=>e.toLowerCase()));return{parse(e,i,s){const a=r.parse(e,i,s);if(!a.length)return a;const c=o.indexOf(a[0].toLowerCase());return~c?(a[0]=t[c],a):l(i,1&n&&`expected ${t.length>1?"one of ":""}${t.map((e=>`${e}`)).join(", ")}`)}}}function W(e,t){let n;return x((()=>n=v(e)),(function(e,r,o,i){const s=i&&u(r,t),a=n.parse(e,r,o,s);return a.length?(s&&f(s,i,a),a):(o[0]=null,o[1]=r,o)}))}function V(e,t){let r;return x((()=>r=v(e)),(function(e,o,i){const s=r.parse(e,o,i);return s.length?l(o,1&n&&(t||`unexpected ${e.slice(o,s[1])}`)):(i[0]="",i[1]=o,i)}))}function B(e,...t){const i=c(e)?e:void 0,a=c(e)?t:(e?[e]:[]).concat(t);let p;const g=a.length;return x((()=>p=a.map(v)),(function(e,t,a,c){let d;const h=c&&u(t,i);for(let r=0;r<g;r++){const o=p[r].parse(e,t,a,h);if(o.length)return h&&f(h,c,o),o;2&n&&(d||(d=[])).push(s(i))}if(2&n){const e=A(d,[t,`expected ${i||"alternate"}`,i]);return d.length&&d.map((e=>e[0])).reduce(((e,t)=>e+t),0)===d[0][0]*d.length&&(e[2]=i),l(e[0],e[1],e[2]||i,e[3],e[4])}return 1&n&&A()[0]===t&&i&&function(e){e&&(r[0]===o[0]&&r[2]===o[2]&&(o[2]=e),r[2]=e)}(i&&(i.name||i)),l(t,1&n&&`expected ${i||"alternate"}`,i)}))}function G(e,t,n){let r;return x((()=>r=v(e)),(function(e,o,i,s){const a=s&&u(o,n),c=r.parse(e,o,i,a);if(!c.length)return c;const p=t(c[0]);return!0===p?(a&&f(a,s,c),c):l(c[1],p,n)}))}function K(e,t,n){let r,o;const i=e=>o=e;return x((()=>r=v(e)),(function(e,s,c,p){const g=p&&u(s,n),d=r.parse(e,s,c,g);if(d.length){const e=o;o="",d[0]=t(d[0],i,s,d[1]);const r=o;return o=e,r?l(d[1],r,n):(g&&f(g,p,d),d)}return a(n&&(n.name||n)),d}))}function Q(e,t){let r;return x((()=>r=v(e)),(function(e,o,i,s){if(s){const l=u(o,t),c=r.parse(e,o,i,l);return c.length&&(l.children.length?(l.children[0].name=t,s.children.push(l.children[0])):f(l,s,c)),1&n&&a("string"==typeof t?t:t.name),c}{const s=r.parse(e,o,i);return!s.length&&1&n&&a("string"==typeof t?t:t.name),s}}))}function ee(e,t){let r;const o=[];return x((()=>r=v(e)),(function(e,i,a,l){const c=l&&u(i,t);let p,g,d=i;if(g=r.parse(e,d,a,c),!g.length||g[1]===d)return a[0]=o,a[1]=d,2&n&&(a[2]=s(t)),a;for(d=g[1],p=[g[0]];;){if(g=r.parse(e,d,a,c),!g.length||g[1]===d)return a[0]=p||[],a[1]=d,2&n&&(a[2]=s(t)),c&&f(c,l,a),a;p.push(g[0]),d=g[1]}}))}function te(e,t){let r;return x((()=>r=v(e)),(function(e,o,i,a){const c=a&&u(o,t);let p,g,d=o;if(g=r.parse(e,d,i,c),!g.length)return l(d,1&n&&`expected at least one ${t||"item"}`,t,2&n&&s(t));for((p=[]).push(g[0]),d=g[1];;){if(g=r.parse(e,d,i,c),!g.length)return i[0]=p,i[1]=d,2&n&&(i[2]=s(t)),c&&f(c,a,i),i;p.push(g[0]),d=g[1]}}))}function ne(e,t,r="disallow",o){let a,c;const p=[];return x((()=>(a=v(e),c=v(t))),(function(e,t,g,d){const h=d&&u(t,o);let y,m,$,b,v=t,x=t;if($=a.parse(e,v,g,h),!$.length||$[1]===v)return g[0]=p,g[1]=t,2&n&&(g[2]=s(o)),g;if(m=$[0],x=v,v=$[1],b=c.parse(e,v,g),!b.length)return"require"===r?l(x,1&n&&"expected separator",o):(g[0]=[m],g[1]=v,h&&f(h,d,g),g);for(v=b[1],y=[m];;){if($=a.parse(e,v,g,h),!$.length||$[1]===v){if("disallow"===r&&y&&y.length){if(2&n){const e=i();return l(e[0],e[1],o,[v,"unexpected separator"])}return l(v,1&n&&"unexpected separator",o)}break}if(x=v,v=$[1],m=$[0],b=c.parse(e,v,g),!b.length){if("require"===r)return l(x,1&n&&"expected separator",o);y.push(m);break}v=b[1],y.push(m)}return g[0]=y,g[1]=v,2&n&&(g[2]=s(o)),h&&f(h,d,g),g}))}function re(e,t,r="disallow",o){let i,a;return x((()=>(i=v(e),a=v(t))),(function(e,t,c,p){const g=p&&u(t,o);let d,h,y=t,m=y;if(h=i.parse(e,y,c,g),!h.length)return l(y,1&n&&`expected at least one ${o||"item"}`);{(d=[]).push(h[0]),m=y=h[1];const t=a.parse(e,y,c);if(t.length)for(y=t[1];;){if(h=i.parse(e,y,c,g),!h.length){if("disallow"===r&&d&&d.length)return c[0]=d,c[1]=m,g&&f(g,p,c),c;break}{d.push(h[0]),m=y=h[1];const t=a.parse(e,y,c);if(!t.length){if("require"===r)return l(y,1&n&&"expected separator",o);break}y=t[1]}}else if("require"===r)return l(y,1&n&&"expected separator",o)}return c[0]=d,c[1]=y,2&n&&(c[2]=s(o)),g&&f(g,p,c),c}))}function oe(e,t,o,i){const s=c(o)?o:c(i)?i:void 0;if(Array.isArray(e)){let r,o;const a=e.length;return x((()=>(o=v(t),r=e.map(v))),(function(e,t,c,p){const g=p&&u(t,s);let d,h;for(let n=0;n<a;n++){if(r[n].parse(e,t,c).length){h=r[n];break}}if(!h)return l(t,1&n&&"expected opening bracket",i);const y=o.parse(e,c[1],c,g);if(!y.length)return y;2&n&&(d=y[2]);const m=y[0],$=y[1];return h.parse(e,$,c).length?(c[0]=m,g&&f(g,p,c),c):l($,1&n&&"expected matching end bracket",i,2&n&&d)}))}if(!c(o)){let i,a,l;return x((()=>(i=v(e),a=v(t),l=v(o))),(function(e,t,o,c){let p;const g=c&&u(t,s),d=i.parse(e,t,o);if(!d.length)return d;const h=a.parse(e,d[1],o,g);if(!h.length)return h;2&n&&h[2]&&(p=h[2]);const y=h[0],m=l.parse(e,h[1],o);return m.length?(o[0]=y,g&&f(g,c,o),o):(2&n&&p&&function(e){(r[4]||(r[4]=[])).push(e)}(p),m)}))}}function ie(e,...t){let r,o;"string"!=typeof e?t.unshift(e):r=e;const i=t.length;return x((()=>o=t.map(v)),(function(e,t,a,c){const p=c&&u(t,r);let g,d,h,y=t;if(h=o[0].parse(e,y,a,p),!h.length){if(2&n){const e=A(d,s(r));return l(e[0],e[1],e[2],e[3],e[4])}return h}2&n&&h[2]&&(d||(d=[])).push(h[2]),(g=[]).push(h[0]),y=h[1];for(let t=1;t<i;t++){if(h=o[t].parse(e,y,a,p),!h.length){if(2&n){const e=A(d,s(r));return l(e[0],e[1],e[2],e[3],e[4])}return h}2&n&&h[2]&&(d||(d=[])).push(h[2]),g.push(h[0]),y=h[1]}return a[0]=g,a[1]=y,2&n&&(a[2]=[t,"error in seq",null,null,d]),p&&f(p,c,a),a}))}function se(e,...t){let r,o;"string"!=typeof e?t.unshift(e):o=e;const i=t.length;return x((()=>r=t.map(v)),(function(e,t,a,c){const p=c&&u(t,o);let g,d,h=t;if(d=r[0].parse(e,h,a),!d.length){if(2&n){const e=A(g,s(o));return l(e[0],e[1],e[2],e[3],e[4])}return d}2&n&&d[2]&&(g||(g=[])).push(d[2]),h=d[1];for(let t=1;t<i;t++){if(d=r[t].parse(e,h,a),!d.length){if(2&n){const e=A(g,s(o));return l(e[0],e[1],e[2],e[3],e[4])}return d}2&n&&d[2]&&(g||(g=[])).push(d[2]),h=d[1]}return a[0]=null,a[1]=h,p&&f(p,c,a),a}))}y.skip=H,y.map=K,y.seq=ie;const ae="abcdefABCDEF",le="0123456789",ce=ae+"abcdefABCDEFghijklmnopqrstuvwxyzGHIJKLMNOPQRSTUVWXYZ$_",ue=ae+le,fe={b:"\b",r:"\r",n:"\n","'":"'",'"':'"',t:"\t","\\":"\\"},pe=/_/g,ge=K(ie(W(J("-","+")),_(le),L(le+"_"),W(J(".")),L(le+"_"),K(W(ie(J("e","E"),W(J("+","-")),_(le+"_"))),(e=>e&&w(e)))),(e=>+w(e).replace(pe,""))),de=K(ie(J("\\"),function(e,t,r){const o=q(t),i=F(o);return{parse(t,s,a){if(t.length-s>=e){const c=t.substr(s,e);for(let t=0;t<e;t++)if(i(o,c[t]))return l(s+t,1&n&&"unexpected char",r);return a[0]=c,a[1]=s+e,a}return l(s,1&n&&"unexpected end of input",r)}}}(1,"xu")),(e=>fe[e[1]]||e[1])),he=K(ie(J("\\u"),R(4,ue)),(e=>String.fromCharCode(parseInt(e[1],16)))),ye=K(ie(J("\\x"),R(2,ue)),(e=>String.fromCharCode(parseInt(e[1],16)))),me=B(oe(J('"'),K(ee(B("string part",I('"\\'),he,ye,de)),(e=>w(e))),J('"')),oe(J("'"),K(ee(B("string part",I("'\\"),he,ye,de)),(e=>w(e))),J("'"))),$e=K(J("true","false"),(e=>"true"===e)),be=K(J("null"),(()=>null)),ve=K(ie(_(ce),W(L(ce+le))),(([e,t])=>null!==t?e+t:e)),xe=H(" \t\n\r"),we={},Ae={},ke=B("value",me,we,Ae,ge,$e,be),je=K(ie(xe,B("key",me,ve),se(xe,J(":"),xe),ke),(e=>[e[1],e[3]]));we.parser=oe(se(J("["),xe),ne(ke,se(xe,J(","),xe),"allow"),se(xe,J("]"))),Ae.parser=K(oe(se(J("{"),xe),ne(je,se(xe,J(","),xe),"allow"),se(xe,J("}"))),(e=>{const t=e.length,n={};for(let r=0;r<t;r++){const t=e[r];n[t[0]]=t[1]}return n})),$(K(ie(xe,ke,xe),(e=>e[1])));const Me={y:0,m:0,w:0,d:864e5,h:36e5,mm:6e4,s:1e3};function Oe(e){return"object"==typeof e&&e&&"number"==typeof e.ms}function De(e){return"number"==typeof e?e:Oe(e)?e.ms:1e3*(60*(60*(24*(30.45*(12*(e.d[0]||0)+(e.d[1]||0))+(e.d[2]||0))+(e.d[3]||0))+(e.d[4]||0))+(e.d[5]||0))+(e.d[6]||0)}Me.w=7*Me.d,Me.y=Math.floor(365.25*Me.d),Me.m=Math.floor(30.45*Me.d);const ze=" \r\n\t",Ye=" \r\n\t():{}[]<>,\"'`\\;&#",Ce=Ye+".+/*|^%=!?",Xe=K(ie(xe,J("//"),W(J(" ")),P("\n"),J("\n")),(([,,,e])=>({c:e})),{name:"comment",primary:!0});function Te(e,t){return K(ie(ee(Xe),xe,t),(([t,,n])=>(t&&t.length&&(n[e]=t.map((e=>e.c))),n)))}const Ne=function(e,t){const r=q(e),o=F(r);return{parse:(i,s,a)=>(a[1]=E(i,s,r,o),a[1]===s?l(s,1&n&&`expected at least one of ${JSON.stringify(e)}`,t):a)}}(ze,"required-space"),Ue=K(J("null","true","false","undefined"),(e=>{switch(e){case"null":return null;case"true":return!0;case"false":return!1;case"undefined":return}}),{primary:!0,name:"primitive"}),Se=I(Ce,!0),Fe=I(" \r\n\t():{}[],\"'\\;&#@",!0),qe={},Ee={},He={},Le={},_e={},Re={},Pe={},Ie={n:"\n",r:"\r",t:"\t",b:"\b"},Je=K(ie(J("\\"),R(1)),(([,e])=>Ie[e]||e)),Ze=K(te(B("ref-part",I(Ce,!0),Je)),(e=>e.join("")),"keypath-part"),We=K(ie(J("."),Ze),(([,e])=>e)),Ve=oe(ie(J("["),xe),_e,ie(xe,J("]"))),Be=K(ie(B("ref-sigil",J("!","~","*"),ie(L("^"),W(J("@",".")))),B("keypath",Ze,Ve),ee(B("keypath",We,Ve))),(([e,t,n])=>{const r={k:[t].concat(n).map((e=>"object"!=typeof e||!("v"in e)||"string"!=typeof e.v&&"number"!=typeof e.v?e:e.v))};return Array.isArray(e)?(e[0]&&(r.u=e[0].length),"@"===e[1]&&(r.p="@")):e&&(r.p=e),r}),"keypath"),Ge=K(ie(L("^"),Ze,ee(B("keypath",We,Ve))),(([e,t,n])=>{const r={k:[t].concat(n).map((e=>"object"!=typeof e||!("v"in e)||"string"!=typeof e.v&&"number"!=typeof e.v?e:e.v))};return e&&(r.u=e.length),r}),"localpath"),Ke=$(Be),Qe=$(Ge),et=["if","else","elif","elseif","elsif","unless","then","case","when","not","gte","gt","lte","lt","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain","is-not","is","strict-is-not","strict-is","deep-is-not","deep-is","and","or"],tt=K(Be,((e,t)=>(1!==e.k.length||e.p||e.u||!et.includes(e.k[0])||t(`invalid reference name '${e.k[0]}'`),{r:e})),{primary:!0,name:"reference"});function nt(e){const t=e.reduce(((e,t)=>(e.length&&"v"in t&&"v"in e[e.length-1]&&"string"==typeof t.v&&"string"==typeof e[e.length-1].v?e[e.length-1].v+=t.v:e.push(t),e)),[]);return t.length>0&&(!("v"in t[0])||"string"!=typeof t[0].v)&&t.unshift({v:""}),0===t.length?{v:""}:1===t.length?t[0]:{op:"+",args:t}}const rt=K(re(ie(ge,xe,Z("years","year","y","months","month","minutes","minute","milliseconds","millisecond","mm","ms","m","weeks","week","w","days","day","d","hours","hour","h","seconds","second","s")),xe),(e=>{const t={y:0,m:0,d:0,h:0,mm:0,s:0,ms:0};for(let n=0;n<e.length;n++)"y"===e[n][2][0]?t.y+=e[n][0]:"m"===e[n][2]||"months"===e[n][2]||"month"===e[n][2]?t.m+=e[n][0]:"d"===e[n][2][0]?t.d+=e[n][0]:"w"===e[n][2][0]?t.d+=7*e[n][0]:"h"===e[n][2][0]?t.h+=e[n][0]:"s"===e[n][2][0]?t.s+=e[n][0]:"mm"===e[n][2]||"minutes"===e[n][2]||"minute"===e[n][2]?t.mm+=e[n][0]:"ms"!==e[n][2]&&"milliseconds"!==e[n][2]&&"millisecond"!==e[n][2]||(t.ms+=e[n][0]);if(t.y||t.m||t.d){const e=[];return t.y&&(e[0]=t.y),t.m&&(e[1]=t.m),t.d&&(e[2]=t.d),t.h&&(e[3]=t.h),t.mm&&(e[4]=t.mm),t.s&&(e[5]=t.s),t.ms&&(e[6]=t.ms),{d:e}}{delete t.y,delete t.m,delete t.d;let e=0;for(const n in t)e+=t[n]*(Me[n]||1);return{ms:e}}}),{primary:!0,name:"timespan"}),ot=K(ie(xe,B("timezone",Z("z"),ie(W(R(1,"+-")),B(R(4,le),R(2,le),R(1,le)),W(ie(J(":"),R(2,le)))))),(e=>{if("z"===e[1][0])return 0;{let t;return 4===e[1][1].length?t=60*+e[1][1].substr(0,2)+ +e[1][1].substr(2,2):(t=60*+e[1][1],e[1][2]&&(t+=+e[1][2][1])),"-"===e[1][0]&&(t*=-1),t}})),it=B(K(ie(_(le),W(ie(J(":"),R(2,le),W(ie(J(":"),R(2,le),W(ie(J("."),R(3,le)))))))),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=r&&e[1][2][2]&&e[1][2][2][1],i=[+t];return n&&(i[1]=+n),r&&(i[2]=+r),o&&(i[3]=+o),i})),K(Z("start","midnight"),(()=>[0,0,0,0])),K(Z("noon","mid"),(()=>[12,0,0,0])),K(Z("end"),(()=>[23,59,59,999]))),st=$(B(K(ie(it,W(ie(xe,ot))),(([e,t])=>(t&&e.push(t[1]),e))),ot),{trim:!0,consumeAll:!0,undefinedOnError:!0}),at=W(ie(xe,J(">"))),lt=B("date",K(ie(W(Z("last","this","next")),Ne,Z("week","month","year"),W(ot),at),(([e,,t,n,r])=>{const o={f:"w"===t[0]?"w":"m"===t[0]?"m":"y",o:"last"===e?-1:"next"===e?1:0,e:r?1:void 0};return null!=n&&(o.z=n),o})),K(ie(Z("week","month","year"),ie(Ne,Z("to"),Ne,Z("date")),W(ot),at),(([e,,t,n])=>{const r={f:"w"===e[0]?"w":"m"===e[0]?"m":"y",o:0,d:1,e:n?1:void 0};return null!=t&&(r.z=t),r})),K(ie(Z("yesterday","today","tomorrow"),B(oe(xe,Z("at"),xe),Ne),it,xe,W(ot)),(e=>{const t={f:"d",o:"yesterday"===e[0]?-1:"today"===e[0]?0:1,t:e[2]};return null!=e[4]&&(t.t[4]=e[4]),t})),K(ie(Z("yesterday","today","tomorrow","now"),W(ot),at),(([e,t,n])=>{const r="now"===e?{f:"n",o:0}:{f:"d",o:"yesterday"===e?-1:"today"===e?0:1,e:n?1:void 0};return null!=t&&(r.z=t),r})),K(ie(Z("in"),Ne,rt),(e=>"number"==typeof e[2]||Oe(e[2])?{f:"n",o:De(e[2])}:{f:"n",o:e[2].d})),K(ie(rt,Ne,B("relative time anchor",Z("ago"),ie(Z("from"),Ne,Z("now"))),W(ot)),(([e,,t,n])=>{let r;return r="number"==typeof e||Oe(e)?{f:"n",o:De(e)*("ago"===t?-1:1)}:{f:"n",o:e.d,d:"ago"===t?-1:void 0},null!=n&&(r.z=n),r})));function ct(e,t,n){return null==n||(e[t]=n),e}const ut=K(ie(R(4,le),W(ie(R(1,"-/"),_(le),W(ie(R(1,"-/"),_(le))))),W(ie(B(oe(Ne,Z("at"),Ne),Z("t"),Ne),it)),W(ot),at),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=e[2]&&e[2][1],i=e[3],s=e[4]?1:void 0;if(n){if(r){if(o){const e={f:[+t,+n-1,+r],e:s};for(let t=0;t<o.length;t++)null!=o[t]&&(e.f[t+3]=o[t]);return null!=i&&(e.f[7]=i),e}return{f:ct([+t,+n-1,+r],7,i),e:s}}return{f:ct([+t,+n-1],7,i),e:s}}return{f:ct([+t],7,i),e:s}})),ft=oe(J("#"),B("date",ut,lt,rt),J("#"),{primary:!0,name:"date"}),pt=K(ie(J("@["),xe,Pt(),xe,J("]")),(([,,e])=>({v:e,s:1})),{name:"typelit",primary:!0}),gt=$(K(ie(W(J("#")),B("date",ut,lt,rt),W(J("#"))),(([,e])=>e)),{trim:!0,consumeAll:!0,undefinedOnError:!0}),dt=B({primary:!0,name:"string"},K(ie(J(":"),I(Ye,!0)),(e=>({v:e[1]}))),K(oe(J('"'),ee(B("string-part",I('\\"'),de,he,ye)),J('"')),(e=>({v:"".concat(...e)}))),K(oe(J("'"),ee(B("string-part",K(I("'\\${",!0),(e=>({v:e}))),K(J("\\$","$$"),(()=>({v:"$"}))),oe(J("${","{"),_e,J("}"),{primary:!0,name:"string-interpolation"}),K(J("$","{"),(e=>({v:e}))),K(he,(e=>({v:e}))),K(ye,(e=>({v:e}))),K(de,(e=>({v:e}))))),J("'")),nt),K(oe(J("`"),ee(B("string-part",K(I("`\\${",!0),(e=>({v:e}))),K(J("\\$","$$"),(()=>({v:"$"}))),oe(J("${"),_e,J("}"),{primary:!0,name:"string-interpolation"}),K(J("$","{"),(e=>({v:e}))),K(he,(e=>({v:e}))),K(ye,(e=>({v:e}))),K(de,(e=>({v:e}))))),J("`")),nt)),ht=K(B("literal",K(ge,(e=>e),{primary:!0,name:"number"}),Ue,ft),(e=>e instanceof Date||null==e||"object"!=typeof e?{v:e}:e)),yt=K(oe(se(J("("),xe),ie(Fe,xe,qe),se(xe,J(")"))),(([e,,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n}),{primary:!0,name:"s-expression"});function mt(e){return oe(ie(J("("),xe),e,ie(xe,J(")")))}const $t={},bt={},vt={},xt=_("abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789"),wt=K(ie(Q(xt,"op"),mt(qe)),(([e,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n}),{primary:!0,name:"call"}),At=function(e){return K(ie(e,W(ie(J("#"),Se,W(ie(J(","),re(_e,J(","),"allow")))),{primary:!0,name:"format-op"})),(([e,t])=>t?t[2]?{op:"fmt",args:[e,{v:t[1]},...t[2][1]]}:{op:"fmt",args:[e,{v:t[1]}]}:e),"fmt-op")}(function(e){return K(ie(e,ee(B("keypath",We,Ve))),(([e,t])=>t.length?{op:"get",args:[e,{v:{k:t}}]}:e),"postfix-path-op")}(B("operand",mt(Pe),mt(bt),mt(vt),G(mt($t),(e=>"op"in e||"expected bracketed op")),yt,Re))),kt=K(ie(J("not ","+"),At),(([e,t])=>({op:"+"===e?e:"not",args:[t]})),"unary op");function jt(e,[,t,,n]){return{op:t,args:[e,n]}}const Mt=K(ie(At,ee(ie(Ne,Q(J("**"),"exp op"),Ne,At))),(([e,t])=>t.length?function(e,t){if(1===t.length)return{op:t[0][1],args:[e,t[0][3]]};const n=t.pop();let r=t[t.length-1][1];const o={op:n[1],args:[t.pop()[3],n[3]]},i=t.reverse().reduce(((e,t)=>{const n={op:r,args:[t[3],e]};return r=t[1],n}),o);return{op:r,args:[e,i]}}(e,t):e),"exp-op"),Ot=K(ie(Mt,ee(ie(Ne,Q(J("*","/%","/","%"),"muldiv-op"),Ne,Mt))),(([e,t])=>t.length?t.reduce(jt,e):e),"muldiv-op"),Dt=K(ie(Ot,ee(ie(Ne,Q(J("+","-"),"addsub-op"),Ne,Ot))),(([e,t])=>t.length?t.reduce(jt,e):e),"addsub-op"),zt=K(ie(Dt,ee(ie(Ne,Q(J(">=",">","<=","<","gte","gt","lte","lt","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain"),"cmp-op"),Ne,Dt))),(([e,t])=>t.length?t.reduce(jt,e):e),"cmp-op"),Yt=K(ie(zt,ee(ie(Ne,Q(J("is-not","is","strict-is-not","strict-is","deep-is-not","deep-is","===","==","!==","!="),"eq-op"),Ne,zt))),(([e,t])=>t.length?t.reduce(jt,e):e),"eq-op"),Ct=K(ie(Yt,ee(ie(Ne,Q(J("and","&&"),"and-op"),Ne,Yt))),(([e,t])=>t.length?t.reduce(jt,e):e),"and-op"),Xt=K(ie(Ct,ee(ie(Ne,Q(J("or","||","??"),"or-op"),Ne,Ct))),(([e,t])=>t.length?t.reduce(jt,e):e),"or-op");function Tt(e){if(!e.args||!e.args.length)return!1;let t=!1;for(let n=0;n<e.args.length;n++){const r=e.args[n];"r"in r&&("_"===r.r||"object"==typeof r.r&&"_"===r.r.k[0])?(r.r={k:["case"].concat((r.r.k||[]).slice(1)),p:"@"},t=!0):"r"in r&&"object"==typeof r.r&&"@"===r.r.p&&"case"===r.r.k[0]?t=!0:"op"in r&&(t=t||Tt(r))}return t}$t.parser=K(Xt,(e=>e),{primary:!0,name:"binary-op"}),bt.parser=B({primary:!0,name:"conditional"},K(ie(J("if"),Ne,_e,Ne,He,ee(ie(xe,J("else if","elseif","elsif","elif"),Ne,_e,Ne,He)),W(ie(xe,J("else"),Ne,He))),(([,,e,,t,n,r])=>{const o={op:"if",args:[e,t]};for(const[,,,e,,t]of n)o.args.push(e,t);return r&&o.args.push(r[3]),o}),"if-block"),K(ie(J("if"),Ne,_e,Ne,J("then"),Ne,_e,ee(ie(Ne,V(J("end","fi")),J("else if","elseif","elsif","elif"),Ne,_e,Ne,J("then"),Ne,_e)),W(ie(Ne,J("else"),Ne,_e)),W(ie(Ne,J("end","fi")))),(([,,e,,,,t,n,r])=>{const o={op:"if",args:[e,t]};for(const[,,,,e,,,,t]of n)o.args.push(e,t);return r&&o.args.push(r[3]),o}),"if"),K(ie(J("unless"),Ne,_e,Ne,J("then"),Ne,_e,W(ie(Ne,J("else"),Ne,_e))),(([,,e,,,,t,n])=>{const r={op:"unless",args:[e,t]};return n&&r.args.push(n[3]),r})));const Nt=B(K(ie(Ne,V(J("end","esac")),J("when"),Ne,_e,Ne,J("then"),Ne,_e),(([,,,,e,,,,t])=>[e,t]),"when-branch"),K(ie(Ne,V(J("end","esac")),J("else"),Ne,_e),(([,,,,e])=>[void 0,e]),"else-branch"),K(ie(Ne,V(J("end","esac")),J("when"),Ne,_e,Ne,He),(([,,,,e,,t])=>[e,t]),"when-block"));vt.parser=B(K(ie(J("case"),Ne,_e,ee(Nt),W(ie(Ne,J("end","esac")))),(([,,e,t])=>{const n={op:"case",args:[e]};for(let e=0;e<t.length;e++)if(void 0===t[e][0])n.args.push(t[e][1]);else{let r=t[e][0];"op"in r&&Tt(r),n.args.push(r),n.args.push(t[e][1])}return n}),"case"));const Ut=B("expression",bt,vt,$t),St=K(ie(B("key",dt,K(Se,(e=>({v:e})))),xe,J(":"),xe,_e),(e=>[e[0],e[4]]),"pair");function Ft(e){return e.filter((e=>!("v"in e[0]&&"v"in e[1]))).length?{op:"object",args:e.reduce(((e,t)=>(e.push(t[0],t[1]),e)),[])}:{v:e.reduce(((e,t)=>(e[t[0].v]=t[1].v,e)),{})}}Ee.parser=K(oe(se(xe,J("["),xe),ne(_e,_(" \r\n\t,"),"allow"),se(xe,J("]"))),(e=>e.filter((e=>!("v"in e))).length?{op:"array",args:e}:{v:e.map((e=>e.v))}),{primary:!0,name:"array"}),Le.parser=K(oe(se(xe,J("{"),xe),ne(St,_(" \r\n\t,"),"allow"),se(xe,J("}"))),Ft,{primary:!0,name:"object"}),He.parser=K(oe(se(xe,J("{"),xe),re(_e,_(" \r\n\t;"),"allow"),se(xe,J("}"))),(e=>({op:"block",args:e})),{primary:!0,name:"block"}),_e.parser=v(Te("c",Ut));const qt=K(ie(Se,J(":"),xe,_e),(([e,,,t])=>[{v:e},t]),"named-arg");Pe.parser=K(ie(W(oe(se(J("|"),xe),re(xt,_(" \r\n\t,"),"allow"),J("|"))),xe,J("=>","=\\"),xe,_e),(([e,,,,t])=>e?{a:t,n:e}:{a:t}),{primary:!0,name:"application"}),qe.parser=K(ne(B("argument",qt,_e),_(" \r\n\t,"),"allow"),(e=>{const[t,n]=e.reduce(((e,t)=>(Array.isArray(t)?e[1].push(t):e[0].push(t),e)),[[],[]]);return n.length&&t.push(Ft(n)),t}));const Et=K(ie(J("let"),Ne,Q(Ge,{name:"reference",primary:!0}),xe,J("="),xe,_e),(([,,e,,,,t])=>({op:"let",args:[{v:e},t]})),{primary:!0,name:"let"}),Ht=K(ie(J("set"),Ne,Q(Be,{name:"reference",primary:!0}),xe,J("="),xe,_e),(([,,e,,,,t])=>({op:"set",args:[{v:e},t]})),{primary:!0,name:"set"});Re.parser=B("expression",Ee,Le,ht,pt,dt,Pe,kt,wt,Et,Ht,tt,He);const Lt=$(K(re(_e,_(" \r\n\t;"),"allow"),(e=>1===e.length?e[0]:{op:"block",args:e}),"expression-sequence"),{trim:!0}),_t=$(_e,{trim:!0}),Rt=Lt;function Pt(){const e={},t=W(ie(xe,re(K(ie(Q(J("?"),{name:"condition",primary:!0}),xe,Pe),(([,,e])=>e)),Ne,"disallow"))),n=K(ie(J("string[]","number[]","boolean[]","date[]","any","string","number","boolean","date"),V(I(Ce))),(([e])=>({type:e})),{name:"type",primary:!0}),r=Te("c",K(ie(J("type"),xe,Q(Se,{name:"type",primary:!0}),xe,J("="),xe,e),(([,,e,,,,t])=>({name:e,type:t})))),o=K(re(r,_(" \t\n;"),"disallow"),(e=>e.reduce(((e,t)=>(t.type.desc=t.c,e[t.name]=t.type,e)),{}))),i=K(ie(Se,W(J("[]"))),(([e,t])=>({type:t?"array":"any",ref:e})),{name:"type",primary:!0}),s=K(ie(Q(Se,{name:"key",primary:!0}),W(J("?")),xe,J(":"),xe,e),(([e,t,,,,n])=>{const r=n;return r.name=e,t||(r.required=!0),r})),a=B({name:"literal",primary:!0},K(B(me,ge),(e=>({type:"literal",literal:e}))),K(J("true","false","null","undefined"),(e=>({type:"literal",literal:"true"===e||"false"!==e&&("null"===e?null:void 0)})))),l=K(ie(J("..."),xe,J(":"),xe,e),(([,,,,e])=>Object.assign({name:"..."},e))),c=K(ie(J("{"),xe,ne(Te("desc",B(s,l)),_(" \t\n,;"),"allow"),xe,J("}"),W(J("[]"))),(([,,e,,,t],n)=>{const r=e.filter((e=>"..."===e.name));if(!(r.length>1)){const n=r[0],o={type:t?"object[]":"object"};return(e=e.filter((e=>"..."!==e.name))).length&&(o.fields=e),n&&(delete n.name,o.rest=n),o}n("only one object rest can be specified")})),u=K(ie(J("["),xe,ne(e,_(" \t\r\n,"),"allow"),xe,J("]"),W(J("[]"))),(([,,e,,,t])=>({type:t?"tuple[]":"tuple",types:e}))),f=K(re(ie(B(n,c,u,a,i),t),ie(xe,J("|"),xe),"disallow"),(e=>{const t=e.map((([e,t])=>(t&&t[1]&&t[1].length&&(e.checks=t[1]),e)));return 1===t.length?t[0]:{type:"union",types:t}})),p=B(K(ie(J("Array<"),xe,f,xe,J(">")),(([,,e],t)=>{if("union"===e.type)return{type:"union[]",types:e.types};if("literal"===e.type)t("literal types cannot be array types");else if("array"===e.type||~e.type.indexOf("[]"))t("array types cannot be array types");else{if("any"!==e.type)return e.type+="[]",e;t("any cannot be an array type")}})),K(ie(J("("),xe,f,xe,J(")")),(([,,e])=>e)),f);e.parser=K(ie(p,t),(([e,t])=>(t&&t[1]&&t[1].length&&(e.checks=t[1]),e)));const g=K(ie(W(o),xe,e),(([e,,t])=>(e&&(t.defs=e),t)));return g}const It=B(K(J("\\{{"),(()=>"{{")),K(ie(J("\\"),R(1)),(([,e])=>e))),Jt=K(te(B(I("\\{",!0),It,function(e,t,r){let o,i;return x((()=>(o=v(e),i=v(t))),(function(e,t,s,a){const c=a&&u(t,r),p=o.parse(e,t,s,c);if(!p.length)return p;const g=p[1];return i.parse(e,g,s).length?l(g,1&n&&`unexpected ${e.slice(g,p[1])}`,r):(c&&f(c,a,p),p)}))}(J("{"),J("{")))),(e=>({v:e.join("")})),"text");function Zt(e){return K(ie(J("{{"),xe,J(...e),Ne,_e,xe,J("}}")),(e=>[e[2],e[4]]),"tag")}const Wt=Q(se(ie(J("{{/"),P("}"),J("}}"))),"tag end"),Vt={};function Bt(e,t){return t?K(Zt(e),(([e,t])=>({name:e,value:t}))):K(ie(J("{{"),xe,J(...e),xe,J("}}")),(([,,e])=>({name:e})),"tag")}function Gt(e){return K(e,(e=>e.length<1?[{v:""}]:e))}const Kt=Bt(["else"]),Qt=Bt(["else if","elseif","elsif","elif"],!0),en=K(ie(Zt(["each"]),Gt(ee(B(Qt,Kt,Vt))),Wt),(([e,t])=>({op:"each",args:[e[1]].concat(ln(cn(t)))})),{primary:!0,name:"each-block"}),tn=K(ie(Zt(["if"]),Gt(ee(B(Qt,Kt,Vt))),Wt),(([e,t])=>({op:"if",args:[e[1]].concat(cn(t))})),{primary:!0,name:"if-block"}),nn=K(ie(Zt(["with"]),Gt(ee(B(Kt,Vt))),Wt),(([e,t])=>({op:"with",args:[e[1]].concat(ln(cn(t)))})),{primary:!0,name:"with-block"}),rn=K(ie(Zt(["unless"]),Gt(ee(Vt)),Wt),(([e,t])=>({op:"unless",args:[e[1]].concat(un(t))})),{primary:!0,name:"unless-block"}),on=K(ie((sn=["case"],K(ie(J("{{"),xe,J(...sn),Ne,_e,Ne,J("when"),Ne,_e,J("}}")),(e=>[e[2],e[4],e[8]]),"tag")),Gt(ee(B(Bt(["when"],!0),Kt,Vt))),Wt),(([e,t])=>{const n={op:"case",args:e.slice(1).concat(cn(t))};for(let e=1;e<n.args.length;e+=2){const t=n.args[e];"object"==typeof t&&"op"in t&&Tt(t)}return n}),{primary:!0,name:"case-block"});var sn;const an=K(ie(J("{{"),xe,_e,xe,J("}}")),(([,,e])=>({op:"string",args:[e]})),{primary:!0,name:"interpolator"});function ln(e){return e.length&&(e[0]={a:e[0]}),e}function cn(e){const t=[];let n=[],r=!1;for(let o=0;o<e.length;o++){const i=e[o];"name"in i?(r=!0,n.length?t.push(un(n)):t.push({v:""}),i.value&&t.push(i.value),n=[]):n.push(i)}return n.length?t.push(un(n)):r&&t.push({v:""}),t.length%2&&t.push({v:""}),t}function un(e){return 1===e.length?e[0]:{op:"+",args:e}}Vt.parser=B({primary:!0,name:"content"},Jt,en,tn,nn,on,rn,an);const fn=$(B(K(te(Vt),(e=>un(e))),K(xe,(()=>({v:""})))),{trim:!0});function pn(e,t){if(!t)return e.value;const n="string"==typeof t?Ke(t):t;if(!("error"in n)&&"k"in n){let t=n.k;const r=n.p;let o=0,i=e,s=e.value;for(let e=0;e<n.u;e++)i&&(i=i.parent);if(s=i?i.value:void 0,r){if("!"===r)s=e.root.parameters;else if("~"===r)s=e.root.value;else if("*"===r)s=e.root.sources[t[o++]],s&&o<t.length+1&&"value"!==t[o]&&(s=s.value);else if("@"===r){const n=t[o++];if("locals"===n||"specials"===n){const e="locals"===n?n:"special";for(;i&&!i[e];)i=i.parent;i&&(s=i[e])}else if("local"===n||"special"===n){const e="local"===n?"locals":n;s=i[e]||(i[e]={})}else if("parameters"===n||"sources"===n)s=e.root[n];else if("value"!==n){for(;i&&(!i.special||!(n in i.special));)i=i.parent;s=i&&i.special[n],s&&"source"===n&&void 0!==t[o]&&"value"!==t[o]&&s.value&&(s=s.value),s||"date"!==n||(s=e.root.special.date=new Date)}}}else{const e=t[0];if("_"===e)i.special&&i.special.pipe&&(s=i.special.pipe),o++;else if("string"==typeof e){let t=i;for(;t&&(!t.locals||!(e in t.locals));)t=t.parent;t&&e in t.locals&&(s=t.locals[e],o++)}}for(let n=o;n<t.length;n++){const r=t[n];if("object"!=typeof r)s=s&&s[r];else{const t=mn(e,r);s=s&&s[t]}if(null==s)return}return s}}function gn(e,t,n,r){if(!t)return;const o="string"==typeof t?r?Qe(t):Ke(t):t;if(!("error"in o)&&"k"in o){let t=o.k;const i=o.p;let s=e,a=e.value;for(let e=0;e<o.u;e++)s&&(s=s.parent);a=s?s.value:void 0;const l=t.map((t=>"object"!=typeof t?t:mn(e,t)));if(r)a=e.locals||(e.locals={});else if(i){if("~"!==i)return;a=e.root.value}if(!r){const e=l[0];for(;s&&(!s.locals||!(e in s.locals));)s=s.parent;s&&(a=s.locals)}const c=l.length-1;for(let e=0;e<c;e++){if("object"!=typeof a&&"function"!=typeof a||!a)return;const t=l[e],n=l[e+1];t in a&&null!=a[t]||(a[t]="number"==typeof n?[]:{}),a=a[t]}a&&(a[l[c]]=n)}}function dn(e,t){let n,r;return On(e)?(n=new Yn,r=e):zn(e)?(n=e,!Array.isArray(t)&&(r=t)):e&&"object"==typeof e&&"context"in e&&zn(e.context)?(n=e.context,!Array.isArray(t)&&(r=t)):On(t)?(n=new Yn(e),r=t):(n=new Yn,r=e),yn(n,r)}function hn(e,t,n,r,o){if(Mn(t)){const i=r?e:Cn(e,{value:n[0],special:o}),s=e.locals;let a;if("n"in t){const e=t.n.reduce(((e,t,r)=>(e[t]=n[r],e)),{});i.locals=e}return a=mn(i,t.a),i.locals=s,a}{const r=yn(e,t);return Mn(r)?hn(e,r,n,!1,o):r}}function yn(e,t){return"string"==typeof t&&(t=e.root.exprs[t]||(e.root.exprs[t]=(e.parser||Rt)(t))),"object"!=typeof t&&(t={v:t}),mn(e,t)}function mn(e,t){return t?"r"in t?pn(e,t.r):"v"in t?t.v:"op"in t?function(e,t){const n=$n[t.op];if(!n){const n=pn(e,t.op)||pn(e.root,t.op);if(Mn(n))return hn(e,n,t.args.map((t=>yn(e,t))));if("pipe"===t.op){if(!t.args||!t.args.length)return!0;let n=yn(e,t.args[0]);for(let r=1;r<t.args.length;r++){let o=t.args[r];!jn(o)||o.args&&o.args.find((e=>kn(e)&&An(e)))||(o=Object.assign({},o,{args:[{r:{k:["pipe"],p:"@"}}].concat(o.args||[])})),n=Mn(o)?hn(e,o,[n]):yn(Cn(e,{special:{pipe:n}}),o)}return n}return!0}let r;if("checked"===n.type){r=[];const o=t.args||[],i=n.extend?Cn(e,{}):e;for(let e=0;e<o.length;e++){const s=o[e],a=yn(i,s),l=n.checkArg(t.op,e,o.length-1,a,i,s);if("continue"===l)r.push(a);else if("skip"in l)e+=l.skip,"value"in l&&r.push(l.value);else if("result"in l)return l.result}return n.apply(t.op,r,i)}if("value"===n.type)return r=(t.args||[]).map((t=>yn(e,t))),n.apply(t.op,r,e);{let r;const o=n.extend?Cn(e,{}):e,i=(t.args||[]).slice();let s;if(!n.value&&(s=yn(o,i[0]),Array.isArray(s)?(i.shift(),r=s):"object"==typeof s&&"value"in s&&Array.isArray(s.value)&&(i.shift(),r=s.value),!r)){const e=mn(o,{r:"@source"});r=Array.isArray(e)?e:"object"==typeof e&&"value"in e&&Array.isArray(e.value)?e.values:[]}return n.apply(t.op,Array.isArray(r)?r:[],i,o)}}(e,t):Mn(t)||Un(t)||qn(t)?t:void 0:t}const $n={};function bn(...e){for(const t of e)for(const e of t.names)$n[e]=t}function vn(e){return $n[e]}function xn(e,t,n,r,o){const i=Array.isArray(e)?{value:e}:e;if(!i||!Array.isArray(i.value))return i;let s;s=o?zn(o)?Cn(o,{special:{source:i.value}}):new Yn(o):new Yn(i.value,{special:{source:i}});const a=t?[]:i.value.slice();if(t){let e="string"==typeof t?Rt(t):t;"m"in e&&(e={v:!0}),i.value.forEach(((t,n)=>{hn(Cn(s,{value:t,special:{value:t,index:n}}),e,[t,n])&&a.push(t)}))}const l=function(e,t){let n;if(Array.isArray(t))n=t;else{const r=yn(e,t);Array.isArray(r)?n=r:"string"==typeof r&&(n=[{v:r}])}if(n){let e;for(let t=0;t<n.length;t++){e=n[t];const o="object"==typeof(r=e)&&"v"in r?e.v:e;"string"==typeof o&&("-"===o[0]?n[t]={by:o.substr(1),desc:!0}:n[t]={by:"+"===o[0]?o.substr(1):o,desc:!1})}}var r;return n}(s,n);if(l&&l.length){const e=l.map((e=>{if("object"==typeof e&&"by"in e){if("desc"in e)return"boolean"==typeof e.desc?e.desc:yn(s,e.desc);if("dir"in e){const t="string"==typeof e.dir?e.dir.toLowerCase():e.dir,n="asc"===t||"desc"===t?t:yn(s,e.dir);if("desc"===("string"==typeof n?n.toLowerCase():n))return!0}}return!1}));a.sort(((t,n)=>{for(let r=0;r<l.length;r++){const o=l[r],i=e[r],a="string"==typeof o?o:o&&o.by?o.by:o,c=hn(s,a,[t]),u=hn(s,a,[n]),f=null==c&&null!=u?-1:null!=c&&null==u?1:c<u==u<c?0:c<u?-1:c>u?1:0;if(f)return(i?-1:1)*f}return 0}))}return Array.isArray(r)||(r=yn(s,r)),Array.isArray(r)&&r.length?{value:{schema:i.schema,grouped:r.length,level:0,value:wn(a,r,s,1),all:a}}:Array.isArray(e)?a:{schema:i.schema,value:a}}function wn(e,t,n,r=0){const o={},i=[],s=[];for(const r of e){const e=`${yn(Cn(n,{value:r}),t[0])}`;o[e]||(s.push(e),o[e]=[]),o[e].push(r)}for(const e of s)i.push({group:e,grouped:t.length-1,value:t.length>1?wn(o[e],t.slice(1),n,r+1):o[e],all:o[e],level:r});return i}function An(e){const t=function(e){if("object"==typeof e.r)return e.r;const t=Ke(e.r);return"k"in t?t:{k:[]}}(e);return"_"===t.k[0]||"@"===t.p&&"pipe"===t.k[0]}function kn(e){return"object"==typeof e&&"r"in e}function jn(e){return"object"==typeof e&&"string"==typeof e.op}function Mn(e){if("object"!=typeof e||!("a"in e)||"object"!=typeof e.a)return!1;const t=Object.keys(e).length;return 1===t||2===t&&"n"in e}function On(e){return"string"==typeof e||Dn(e)}function Dn(e){return"object"==typeof e&&e&&("r"in e&&"string"==typeof e.r||"op"in e&&"string"==typeof e.op||"v"in e||Mn(e))}function zn(e){return"object"==typeof e&&"string"==typeof e.path&&"object"==typeof e.root&&"value"in e&&("object"==typeof e.parent||e.root===e)}class Yn{constructor(e={},t){this.root=this,this.parameters={},this.sources={},this.special={},this.exprs={},this.path="",this.value=e,t&&(Object.assign(this.parameters,t.parameters),Object.assign(this.special,t.special),t.parser&&(this.parser=t.parser))}}function Cn(e,t){return{parent:e,root:e.root,path:t.path||"",value:"value"in t?t.value:e.value,special:t.special||{},parser:t.parser,locals:t.locals}}const Xn={};function Tn(e,t){Array.isArray(e)?e.forEach((e=>Xn[e]=t)):Xn[e]=t}function Nn(e){if(e instanceof Date)return[e,e];let t=new Date,n="d"in e&&e.d?new Date:void 0;t.setUTCFullYear(t.getFullYear(),t.getMonth(),t.getDate()),t.setUTCHours(0,0,0,0);let r="z"in e&&null!=e.z?e.z:null;if("n"===e.f)t="number"==typeof e.o?new Date(+new Date+e.o):En(new Date,{d:e.o},"d"in e?e.d:1),n=t,r=void 0;else if("d"===e.f){if(t.setUTCDate(t.getUTCDate()+e.o),n||(n=new Date(t)),"t"in e){const o=e.t;t.setUTCHours(o[0],o[1]||0,o[2]||0,o[3]||0),n.setUTCHours(o[0],null==o[1]?59:o[1],null==o[2]?59:o[2],null==o[3]?999:o[3]),null!=o[4]&&(r=o[4])}}else if("w"===e.f)t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+(-1===e.o?7:1===e.o?-7:0))),n||(n=new Date(t),n.setDate(t.getUTCDate()+6)),"z"in e&&null!=e.z&&(r=e.z);else if("m"===e.f)t.setUTCDate(1),t.setUTCMonth(t.getUTCMonth()+e.o),n||(n=new Date(t),n.setUTCMonth(t.getUTCMonth()+1),n.setUTCDate(0));else if("y"===e.f)t.setUTCDate(1),t.setUTCMonth(0),t.setUTCDate(1),n||(n=new Date(t),n.setUTCFullYear(t.getUTCFullYear()+1),n.setUTCDate(0));else if(Array.isArray(e.f)){const o=e.f.slice();t=new Date(Date.UTC(o[0],o[1]||0,o[2]||1,o[3]||0,o[4]||0,o[5]||0,o[6]||0));for(let e=1;e<7;e++)if(null==o[e]){o[e-1]++;break}null!=o[6]&&o[6]++,n=new Date(Date.UTC(o[0],o[1]||0,o[2]||1,o[3]||0,o[4]||0,o[5]||0,o[6]||0)),n.setUTCMilliseconds(n.getUTCMilliseconds()-1),null!=o[7]&&(r=o[7])}if("d"!==e.f&&"w"!==e.f&&"m"!==e.f&&"y"!==e.f||n.setUTCHours(23,59,59,999),void 0!==r)if(null!=r)t.setUTCMinutes(t.getUTCMinutes()-r),t!==n&&n.setUTCMinutes(n.getUTCMinutes()-r);else{const e=t.getTimezoneOffset();t.setUTCMinutes(t.getUTCMinutes()+e),t!==n&&n.setUTCMinutes(n.getUTCMinutes()+e)}return[t,n]}function Un(e){return e&&"object"==typeof e&&("f"in e&&(Array.isArray(e.f)||"o"in e)||e instanceof Date)}function Sn(e){const t=Nn(e);return"e"in e&&null!=e.e?t[1]:t[0]}function Fn(e){if(!e)return;if((t=e)&&"object"==typeof t&&"f"in t&&Array.isArray(t.f))return e;var t;const n=Sn(e),r=n.getTimezoneOffset(),o="z"in e&&null!=e.z?e.z:"f"in e&&"d"===e.f&&"t"in e&&null!=e.t[4]?e.t[4]:null;return e instanceof Date&&null!=o&&n.setMinutes(n.getMinutes()-(r+o)),{f:[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds(),null!=o?o:-r]}}function qn(e){return"number"==typeof e||"object"==typeof e&&Array.isArray(e.d)||Oe(e)}function En(e,t,n){if("number"==typeof t)return new Date(+e+t*n);if(Oe(t))return new Date(+e+t.ms*n);{let r=new Date(e);if(t.d[0]&&r.setFullYear(r.getFullYear()+t.d[0]*n),t.d[1]){const e=r.getDate();r.setDate(1),r.setMonth(r.getMonth()+t.d[1]*n);const o=r.getMonth();r.setDate(e),o!==r.getMonth()&&r.setDate(0)}return t.d[2]&&r.setDate(r.getDate()+t.d[2]*n),t.d[3]&&r.setHours(r.getHours()+t.d[3]*n),t.d[4]&&r.setMinutes(r.getMinutes()+t.d[4]*n),t.d[5]&&r.setSeconds(r.getSeconds()+t.d[5]*n),t.d[6]&&r.setMilliseconds(r.getMilliseconds()+t.d[6]*n),r}}function Hn(e,t,n){e.styles[t]||(e.styles[t]=n)}function Ln(e){return"object"==typeof e&&On(e.x)}function _n(e,t){return Ln(e)?e.x?dn(t,e.x):void 0:e}function Rn(e,t){return{report:e.report,context:Cn(e.context,t),styles:e.styles,styleMap:e.styleMap}}const Pn=/\>\<\&/g,In={"<":"&lt;",">":"&gt;","&":"&amp;"};function Jn(e){return(""+e).replace(Pn,(e=>In[e]||""))}const Zn={};function Wn(e,t,n){Zn[e]="function"==typeof t?{render:t}:t,n&&Object.assign(Zn[e],n)}const Vn=7.4,Bn=6.7,Gn=7.85,Kn=5.9;let Qn=function(e,t,n,r){const o=r&&_n(r.family,n)||"sans",i=r&&_n(r.size,n)||.83,s=(r&&_n(r.metric,n)||("mono"===o||/fixed|mono/i.test(o)?Gn:"narrow"===o||/narrow|condensed/i.test(o)?Kn:"sans"===o||/sans|arial|helvetica/i.test(o)?Vn:Bn))*i/16;return e.split(/\r?\n/g).reduce(((e,n)=>{const[r,o]=n.split(/\s/g).reduce(((e,n)=>{const r=(n.length+1)*s;return e[0]+r>t?(e[0]=r,e[1]++):e[0]+=r,e}),[0,0]);return e+(o+(r>0?1:0)||1)}),0)*i};function er(e,t,n,r){const o=Zn[e.type];if(!o||e.hide&&dn(Cn(t.context,{special:{widget:e,placement:n}}),e.hide))return{output:"",height:0};!("height"in e)&&o.container&&(e.height="auto");const i=sr(e,n,t);if(n.maxY&&!isNaN(i)&&i>n.maxY)return Hn(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2};if(n.availableY&&i>n.availableY)return{output:"",continue:{offset:0},cancel:!0};let s=0;if(e.margin){const r=cr(e,t,n);s+=r[0]+r[2],n.availableY&&(n.availableY-=r[0]+r[2])}const a=o.render(e,t,n,r);return"string"==typeof a?{output:a,height:i,width:or(e,n,t)}:n.maxY&&a.height>n.maxY?(Hn(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2}):isNaN(i)&&n.availableY&&a.height>n.availableY?{output:"",continue:{offset:0},height:a.height,cancel:!0}:(a.height=a.height||0,a.height+=s,a)}const tr={};function nr(e,t){tr[e]=t}function rr(e,t,n){let r=Ln(e.width)?dn(Cn(n.context,{special:{widget:e,placement:t}}),e.width.x):e.width;const o=e.margin&&cr(e,n,t);let i=!1;return"grow"===r?r=t.availableX||t.maxX:r||0===r?"number"==typeof r||(r=+(r.percent/100*(t.maxX||51)).toFixed(4),i=!0):r=t.maxX||51,"number"==typeof r&&("contain"===e.box||i&&"expand"!==e.box)&&(o?r-=o[1]+o[3]:e.font&&e.font.right&&(r-=e.font.right)),r}function or(e,t,n){let r=rr(e,t,n);if(e.margin){const o=cr(e,n,t);r+=o[1]+o[3]}else e.font&&e.font.right&&(r+=e.font.right);return r}function ir(e,t,n,r,o){let i=1,s=Ln(e.height)?dn(Cn(n.context,{special:{widget:e,placement:t,computed:r,linesize:o}}),e.height.x):e.height;const a=e.margin&&cr(e,n,t);let l=!1;if(null==s&&o&&(s=function(e){let t=e.height||1;if(e.font&&e.font.size>t&&(t=e.font.size),"text"in e&&Array.isArray(e.text))for(let n=0;n<e.text.length;n++)"object"==typeof e.text[n]&&e.text[n].font&&e.text[n].font.size>t&&(t=e.text[n].font.size);return t}(e)),"number"==typeof s)i=s;else if("object"==typeof s&&"percent"in s&&s.percent&&t.maxY)i=+(t.maxY*(s.percent/100)).toFixed(4),l=!0;else{if("auto"===s||r&&!s)return r||NaN;if("grow"===s&&(i=t.availableY||0,e.margin)){const r=cr(e,n,t);i-=r[0]+r[2]}}return"number"==typeof i&&("contain"===e.box||l&&"expand"!==e.box)&&a&&(i-=a[0]+a[2]),i}function sr(e,t,n,r,o){let i=ir(e,t,n,r,o);if(e.margin){const r=cr(e,n,t);i+=r[0]+r[2]}return i}function ar(e){return e.reduce(((e,t)=>e>t[1]+t[3]?e:t[1]+t[3]),0)}function lr(e){return e.reduce(((e,t)=>e>t[0]+t[2]?e:t[0]+t[2]),0)}function cr(e,t,n){if(e.margin){const r=Ln(e.margin)?dn(Cn(t.context,{special:{widget:e,placement:n}}),e.margin.x):e.margin;if(Array.isArray(r)){if(4===r.length)return r.map((e=>+e));if(2===r.length)return[+r[0],+r[1],+r[0],+r[1]]}else if("number"==typeof r)return[r,r,r,r]}return[0,0,0,0]}function ur(e,t,n){if(!t)return"";const r=e.styleMap.styles[t];if(r)return r;const o=`${n}${function(e,t){return e.styleMap.ids[t]||(e.styleMap.ids[t]=0),e.styleMap.ids[t]++}(e,n)}`;return e.styleMap.styles[t]=o}function fr(e,t,[n,r],o,i){if(!1!==e.report.classifyStyles){const s=[];return r&&s.push(ur(e,r,"h")),s.push(ur(e,n,i||"s")),` class="${t.concat(s).join(" ")}"${o?` style="${o}"`:""}`}{const e=`${n}${o||""}${r||""}`;return`${""+(t.length?` class="${t.join(" ")}"`:"")}${e?` style="${e}"`:""}`}}function pr(e,t,n,r){let o=`left:${(t.x||0)+(t.offsetX||0)}rem;top:${(t.y||0)+(t.offsetY||0)}rem;`,i="";o+=`width:${or(e,t,n)}rem;`;let s=sr(e,t,n,r&&r.computedHeight,r&&r.lineSize)||1;if("grow"===e.height&&e.margin){const r=cr(e,n,t);s+=r[0]+r[2]}r&&r.container&&r.computedHeight?i=`height:${s}rem;`:o+=`height:${s}rem;`;const a=e.font&&_n(e.font.line,n),l=e.font&&_n(e.font.size,n);if(o+=""+(r&&r.container&&!a?"":`line-height:${a||l||ir(e,t,n,r&&r.computedHeight,r&&r.lineSize)}rem;`),e.margin){const r=cr(e,n,t);(r[0]||r[1]||r[2]||r[3])&&(o+=`padding:${r[0]}rem ${r[1]}rem ${r[2]}rem ${r[3]}rem;`)}else e.font&&e.font.right&&(o+=`padding-right:${e.font.right}rem;`);return(r&&r.font||e.font)&&(o+=dr(r&&r.font||e.font,n)),e.border&&(o+=function(e,t){("string"==typeof e||"object"==typeof e&&("v"in e||"r"in e||"op"in e))&&(e=dn(t,e));if("number"==typeof e)return`border-bottom:${.0625*e}rem solid;`;if(function(e){return"object"==typeof e&&("top"in e||"bottom"in e||"left"in e||"right"in e)}(e))return`border-style:solid;border-width:${.0625*(e.top||0)}rem ${.0625*(e.right||0)}rem ${.0625*(e.bottom||0)}rem ${.0625*(e.left||0)}rem;`;if(Array.isArray(e)){if(1===e.length)return`border:${.0625*(+e[0]||0)}rem solid;`;if(2===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(3===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(4===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[3]||0)}rem;`}}(e.border,n)),o+=gr(e,n),[o,i]}function gr(e,t){let n="";const r=_n(e.bg,t);r&&(n+=`background-color:${r};`);const o=_n(e.radius,t);return o&&(n+=`border-radius:${o};`),n}function dr(e,t){if(!e)return"";let n,r,o="";return(n=_n(e.family,t))&&(o+=`font-family:${n};`),(n=_n(e.color,t))&&(o+=`color:${n};`),(n=_n(e.align,t))&&(o+=`text-align:${n};`),(n=_n(e.size,t))&&(o+=`font-size:${n}rem;`,r=n),n=_n(e.line,t),0===n?o+="line-height:initial;":null!=n?o+=`line-height:${n}rem;`:r&&(o+=`line-height:${r}rem;`),(n=_n(e.weight,t))&&(o+=`font-weight:${n};`),(n=_n(e.pre,t))&&(o+="white-space:pre-wrap;"),(n=_n(e.clamp,t))&&(o+="white-space:nowrap;overflow:hidden;"),o}nr("row",((e,t,n,r,o,i)=>{let s;const a=r.maxX-o[0][0]-o[0][2],l=or(e,{x:r.x,y:r.y,maxX:r.maxX,maxY:r.maxY,availableY:r.availableY,availableX:a},i);return s=(Ln(e.br)?dn(Cn(i.context,{special:{placement:r,widget:e}}),e.br.x):e.br)||o[0][0]+o[0][2]+l>r.maxX?{x:n[3],y:ar(o),availableX:r.maxX,maxX:r.maxX}:{x:o[0][0]+o[0][2],y:o[0][1],availableX:a,maxX:r.maxX},s.y-=t,r.availableY&&(s.availableY=r.availableY-o[0][1]),s}));function hr(e,t,n){const r=n&&"root"in n&&n.root===n?n:new Yn(Object.assign({},e.context),{parameters:n});r.parameters=Object.assign({},e.defaultParams,r.parameters);const o={};if(e.sources&&yr(r,e.sources,t),Array.isArray(e.parameters))for(const t of e.parameters)t.init&&t.name&&(o[t.name]=dn(r,t.init));return o}function yr(e,t,n){const r=e.sources;for(const o of t){let t=n[o.source||o.name]||{value:[]};o.base&&(t={value:dn(Cn(e,{value:t.value,special:{source:t}}),o.base)}),r[o.name||o.source]=t}for(const n of t)(n.filter||n.sort||n.group)&&(r[n.name||n.source]=xn(r[n.name||n.source],n.filter,n.sort,n.group,e))}Wn("label",((e,t,n)=>{Hn(t,"label",".label {position:absolute;box-sizing:border-box;}");let r,o="",i=(Array.isArray(e.text)?e.text:[e.text]).map((e=>{let n=dn(t,"object"==typeof e&&"text"in e?e.text:e);if("object"==typeof e&&"id"in e){let r=t.context;for(;r;)r.special&&r.special.values&&(r.special.values[e.id]||(r.special.values[e.id]=[])).push(n),r=r.parent}return o+=n,r=n,"object"==typeof e&&"text"in e?`<span${fr(t,[],[dr(e.font,t)+gr(e,t),""])}>${n}</span>`:n})).join("");if(e.id){let n=t.context;for(;n;)n.special&&n.special.values&&(n.special.values[e.id]||(n.special.values[e.id]=[])).push(o),n=n.parent}if(e.format&&e.format.name){const n=[{v:Array.isArray(e.text)&&1!==e.text.length?i:r},{v:e.format.name}];i=dn(t,{op:"format",args:n.concat(e.format.args||[])})}return`<span${fr(t,["label"],pr(e,n,t,{lineSize:!0}))}>${Jn(i)}</span>`})),Wn("container",((e,t,n,r)=>{let o;Hn(t,"container",".container {position:absolute;box-sizing:border-box;}"),e.height?"auto"!==e.height&&(o=sr(e,n,t)):e.height="auto";const i=e.context?Rn(t,{value:dn(t,e.context)}):t,s=rr(e,n,t)||n.availableX,a=function(e,t,n,r,o){if(Array.isArray(e.widgets)){let i="";const s=(r||{offset:0}).offset,a=[[0,s,0,0]],l=cr(e,t,n);a[0][0]+=l[3],a[0][1]+=l[0];for(let c=r&&r.last||0;c<e.widgets.length;c++){const u=e.widgets[c];if(u.hide&&dn(Cn(t.context,{special:{widget:u,placement:n}}),u.hide))continue;let f=n&&sr(u,n,t);if(f>n.maxY&&(f=1),n&&n.availableY&&f>n.availableY){const e=ar(a);return(r=r||{offset:e}).last=c,{output:i,continue:r,height:e}}{let e=Array.isArray(o)&&(o[c]||[0,0]);e&&Array.isArray(e)||(e=[0,0]),e[0]||(e[0]=0),e[1]||(e[1]=0);let p=Array.isArray(e)?{x:e[0]<0?e[0]:e[0]+l[3],y:e[1]<0?e[1]:e[1]+l[0],maxX:n.maxX}:e||n;Array.isArray(e)&&(p.availableX=p.maxX-p.x),o&&"string"!=typeof o||(p=(o&&tr[o]||tr.row)(u,s,l,n,a,t)),p.maxX=p.maxX||n.maxX,p.maxY=p.maxY||n.maxY,p.x<0&&(p.offsetX=l[3],p.x=(n.availableX||1)+p.x-or(u,n,t)+1),p.y<0&&(p.offsetY=l[0],p.y=(n.availableY||1)+p.y-f+1);const{x:g,y:d}=p,h=er(u,t,p,r&&r.child);if("string"==typeof h&&!h||!h.cancel&&!h.output&&!h.height)continue;if("string"==typeof h)i+=h,a.unshift([g,d,or(u,n,t),sr(u,n,t)]);else{if(h.cancel)return{output:"",cancel:!0};const e=h.height||sr(u,n,t)||0;if(d+e>n.availableY){const e=ar(a);return(r=r||{offset:e}).last=c,r.attempt=(+r.attempt||0)+1,r.attempt>1?(Hn(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:'<div class="error" style="bottom: 0rem;">Widget overflow error</div>',height:2}):{output:i,continue:r,height:e}}if(i+=h.output,a.unshift([g,d,h.width||or(u,n,t),e]),h.continue)return(r=r||{offset:0}).child=h.continue,r.last=c,r.offset=ar(a),{output:i,continue:r,height:ar(a),width:lr(a)}}0===p.availableX&&(a[0][2]=p.maxX)}}return{output:i,height:sr(e,n,t)||ar(a)-l[0],width:or(e,n,t)||lr(a)-l[3]}}return{output:"",height:0}}(e,i,{x:0,y:0,availableX:s,availableY:o||n.availableY,maxX:s,maxY:null!=o?o:n.maxY},r,e.layout);return a.cancel||(a.output=`<div${fr(t,["container"],pr(e,n,t,{computedHeight:o||a.height,container:!0}))}>${a.output}</div>`,a.height=o||a.height,a.width=or(e,n,t)),!a.cancel&&!a.continue||e.bridge?(a.continue&&(a.continue.offset=0),a):{continue:((a.continue||{}).offset=0,a.continue),output:""}}),{container:!0}),Wn("repeater",((e,t,n,r)=>{Hn(t,"container",".container {position:absolute;box-sizing:border-box;}"),e.height||(e.height="auto");let o,i=n.availableY,s=n.availableX,a="",l=!1;const c=cr(e,t,n);let u,f=r&&r.state&&"header"!==r.state.part?0:c[0];i-=f;let p,g=!1,d=r&&r.state&&r.state.src;if(!d){if(!e.source)return"";d=On(e.source)?dn(t,e.source):xn(t.context.root.sources[e.source.source]||{value:[]},e.source.filter,e.source.sort,e.source.group,t.context).value,(t.context.special||(t.context.special={})).values||(t.context.special.values={})}if(Array.isArray(d))p=d;else{if(!d||!Array.isArray(d.value))return{output:"",height:0};u=d,p=u.value,e.group&&(g=e.group.length>u.grouped&&e.group.length-u.grouped-1)}if(u&&(!r||!r.state||"group"===r.state.part)&&(!1!==g&&(o=er(e.group[g],Rn(t,{value:u,special:{source:u&&u.grouped?u.all:p,level:u&&u.level,grouped:!0,group:u.group}}),{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY})),o)){if(o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"group",src:d,current:0}}};i-=o.height,a+=o.output,f+=o.height}if(e.header&&(r&&r.state&&"body"===r.state.part&&!1!==e.headerPerPage&&(!u||!u.grouped)||(!u||!u.grouped)&&(!r||!r.state||"header"===r.state.part||"group"===r.state.part))){if(o=er(e.header,t,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"header",src:d,current:0}}};i-=o.height,a+=o.output,f+=o.height}let h=r&&r.state&&r.state.context||Rn(t,{special:{source:u&&u.grouped?u.all:p,level:u&&u.level,grouped:!1!==g,group:u&&u.group,values:{},last:p.length-1,count:p.length}});if(!r||!r.state||"footer"!==r.state.part){let c=0,g=0;for(let y=r&&r.state&&r.state.current||0;y<p.length;y++){const m=u&&u.grouped?Rn(h,{value:p[y],special:{index:y,values:{}}}):Rn(h,{value:p[y],special:{index:y}});if(u&&u.grouped){const t=r&&r.child||{offset:0,state:{current:0,src:p[y],part:"group"}};o=er(e,m,{x:0,y:f,availableX:s-c,availableY:i,maxX:n.maxX,maxY:n.maxY},t)}else o=er(e.row,m,{x:c,y:f,availableX:s-c,maxX:n.maxX,availableY:i,maxY:n.maxY},r?r.child:void 0);if(r&&(r.child=null),o.width&&o.width<=s-c&&o.width!==s)c+=o.width,o.height>g&&(g=o.height);else if(o.width&&c&&o.width>s-c){f+=g,i-=g,g=0,c=0,y--;continue}if(o.height>i||o.cancel)return l?{output:`<div${fr(t,["container","repeat"],pr(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"body",src:d,current:y,context:h,child:o.continue}}}:{output:"",height:f,continue:{offset:f,state:{part:r&&r.state&&r.state.part||"body",src:d,current:y,context:h,child:o.continue}}};if(g||(i-=o.height),g||(f+=o.height),a+=o.output,l=!0,o.continue)return{output:`<div${fr(t,["container","repeat"],pr(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"body",src:d,current:y,context:h},child:o.continue}}}}if(e.footer){const s=h&&h.context||r&&r.state&&r.state.context&&r.state.context.context,l=Rn(t,{special:{source:u&&u.grouped?u.all:p,level:u&&u.level,grouped:!1!==g,group:u&&u.group,values:(s&&s.special||{}).values}});if(o=u?e.groupEnds&&e.groupEnds[u.grouped]?er(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}):{output:"",height:0}:er(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:`<div${fr(t,["container","repeat"],pr(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"footer",src:d,current:0,context:h}}};a+=o.output,f+=o.height}return{output:`<div${fr(t,["container","repeat"],pr(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f}}),{container:!0}),Wn("image",((e,t,n)=>{Hn(t,"image",".image {position:absolute;box-sizing:border-box;} .image .inner {background-repeat:no-repeat;height:100%;}");const r=e.fit&&"object"==typeof e.fit?dn(t,e.fit.x):e.fit;return"stretch"===r?`<img src="${dn(t,e.url)}" ${fr(t,["image"],pr(e,n,t))} />`:`<div ${fr(t,["image"],pr(e,n,t))}><div ${fr(t,["inner"],function(e){return[`background-size:${e&&"contain"!==e?"stretch"===e?"100% 100%":"cover":"contain;background-position:center"};`,""]}(r),`background-image:url('${dn(t,e.url)}');`)}></div></div>`})),Wn("measured",((e,t,n,r)=>{Hn(t,"measured",".measured {position:absolute;box-sizing:border-box;white-space:pre-wrap;word-break:break-all;font-family:serif;font-size:0.83rem}");const o=dn(t,e.text),i=Qn(o,rr(e,n,t)||n.availableX,t,e.font);if(!r&&i>n.availableY)return{output:"",height:0,continue:{state:{},offset:0}};{let r=pr(e,n,t,{computedHeight:i,container:!0});return r[0]="line-height:1em;"+r[0],{height:i,output:`<span${fr(t,["measured","label"],r)}>${Jn(o)}</span>`}}})),Wn("html",((e,t,n)=>{Hn(t,"html",".html {position:absolute;box-sizing:border-box;overflow:hidden;line-height:1rem;}");const r=dn(Rn(t,{parser:fn}),e.html);return`<div${fr(t,["html"],pr(e,n,t,{container:!0}))}>${r}</div>`}));const mr=/(\d)(?=(\d{3})+\.)/g,$r=/(\d)(?=(\d{3})+$)/g,br=/^[-0-9\\.,]+$/;function vr(e,t=2,n=",",r="sign"){if(e="number"!=typeof e?parseFloat(e||""):e,isNaN(e))return"";const o=e<0;return e=e.toFixed(t),0===t&&(e=e.replace(/\..*/,"")),o&&"sign"!==r&&(e=`(${"both"===r?e:e.substr(1)})`),n?e.replace(-1===e.indexOf(".")?$r:mr,`$1${n}`):e}const xr=/y+|M+|d+|E+|H+|m+|s+|k+|h+|a+|S+|z+/g,wr=["January","February","March","April","May","June","July","August","September","October","November","December"],Ar=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let kr;function jr(e,t){if(!e)return"";let n,r,o,i,s,a,l,c,u;if("object"==typeof e&&"f"in e&&Array.isArray(e.f)){const t=e.f,f=t.length,p=e.e;n=t[0],r=f>1&&null!=t[1]?t[1]:p?11:0,o=f>2&&null!=t[2]?t[2]:p?0:1,s=f>3&&null!=t[3]?t[3]:p?23:0,a=f>4&&null!=t[4]?t[4]:p?59:0,l=f>5&&null!=t[5]?t[5]:p?59:0,c=f>6&&null!=t[6]?t[6]:p?999:0;let g=new Date(n,r,o||1,s,a,l,c);u=f>7&&null!=t[7]?-t[7]:g.getTimezoneOffset(),o||(g.setMonth(r+1),g.setDate(0),o=g.getDate()),i=g.getDay()}else{if("string"==typeof e&&(e=new Date(e)),"[object Date]"!==Object.prototype.toString.call(e))return"";if(isNaN(e))return"";const t=e;n=t.getFullYear(),r=t.getMonth(),o=t.getDate(),i=t.getDay(),s=t.getHours(),a=t.getMinutes(),l=t.getSeconds(),c=t.getMilliseconds(),u=t.getTimezoneOffset()}return t||(t=kr||"yyyy-MM-dd"),t.replace(xr,(e=>{if("y"===e[0])return e.length<=2?`${n}`.substr(2,2):`${n}`;if("M"===e[0])return 1===e.length?`${r+1}`:2===e.length?r<9?`0${r+1}`:`${r+1}`:3===e.length?wr[r].substr(0,3):wr[r];if("d"===e[0])return 1===e.length?`${o}`:2===e.length?o<=9?`0${o}`:`${o}`:Mr(o);if("E"===e[0])return 1===e.length?`${i+1}`:2===e.length?Ar[i].substr(0,3):Ar[i];if("H"===e[0])return 1===e.length?`${s}`:s<=9?`0${s}`:`${s}`;if("m"===e[0])return 1===e.length?`${a}`:a<=9?`0${a}`:`${a}`;if("s"===e[0])return 1===e.length?`${l}`:l<=9?`0${l}`:`${l}`;if("S"===e[0]){const t=c;return 1===e.length?`${t}`:t<10?`00${t}`:t<100?`0${t}`:`${t}`}if("k"===e[0]||"h"===e[0]){let e=""+s%12;return"0"===e&&(e="12"),`${e}`}if("a"===e[0])return s>11?"PM":"AM";if("z"===e[0]){let t=0-u;const n=t<0?"-":"+";t=Math.abs(t);let r=t;if(1===e.length)r=Math.floor(t/60);else{if(2===e.length){const e=t%60,r=Math.floor(t/60);return`${n}${r<10?"0":""}${r}${e<10?"0":""}${e}`}if(3===e.length){const e=t%60,r=Math.floor(t/60);return`${n}${r<10?"0":""}${r}:${e<10?"0":""}${e}`}r=t}return`${n}${r}`}}))}function Mr(e,t){let n=`${e=vr(e,0,t)}`;if(n=n.substr(-2,2),n.length>1&&"1"===n[0])return`${e}th`;switch(n[1]||n[0]){case"1":return`${e}st`;case"2":return`${e}nd`;case"3":return`${e}rd`;default:return`${e}th`}}jr.setDefault=function(e){kr=e};const Or=new RegExp(`[${Ce.split("").map((e=>`\\${e}`)).join("")}]`);let Dr=!1,zr=!1,Yr=!1,Cr=!1,Xr=!1,Tr=!1,Nr=!1,Ur=!1,Sr=!1,Fr={array:60,union:60,args:60,keys:60},qr=!1,Er=!1,Hr=!1,Lr=!1,_r=0,Rr=!1;const Pr=["===","!==","deep-is","deep-is-not"],Ir=Pr.concat(["**","*","/%","/","%","+","-",">=","gte",">","gt","<=","lte","<","lt","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain","is","is-not","==","!=","strict-is","strict-is-not","and","&&","or","||","??"]),Jr=["+","not"],Zr={"**":1,"*":2,"/%":2,"/":2,"%":2,"+":3,"-":3,">=":4,">":4,"<=":4,"<":4,in:4,like:4,ilike:4,"not-in":4,"not-like":4,"not-ilike":4,contains:4,"does-not-contain":4,gt:4,gte:4,lt:4,lte:4,is:5,"is-not":5,"==":5,"!=":5,"strict-is":5,"strict-is-not":5,"deep-is":5,"deep-is-not":5,"===":5,"!==":5,and:6,"&&":6,or:7,"||":7,"??":7},Wr=/^[-a-zA-Z_$0-9]/;function Vr(e,t){if(Dr=(t=t||{}).noSymbols,Yr=t.SExprOps,Cr=t.listCommas,Xr=t.SExprOps&&t.noArrayLiterals,Tr=t.SExprOps&&t.noObjectLiterals,zr=!1,Nr=Ur=t.template,Sr=t.noIndent,_r=0,Rr=!0,"listWrap"in t){const e=t.listWrap;if("boolean"==typeof e)Fr=e?{array:1,union:1,args:1,keys:1}:{array:0,union:0,args:0,keys:0};else if("number"==typeof e)Fr={array:e,union:e,args:e,keys:e};else{const t=e.base?!0===e.base?1:e.base:0;Fr={array:"array"in e?e.array?!0===e.array?1:e.array:0:t,union:"union"in e?e.union?!0===e.union?1:e.union:0:t,args:"args"in e?e.args?!0===e.args?1:e.args:0:t,keys:"keys"in e?e.keys?!0===e.keys?1:e.keys:0:t}}}else Fr={array:60,union:60,args:60,keys:60};return Er=t.noNamedArgs,Hr=t.htmlSafe,Lr=t.noChecks,!Yr&&"object"==typeof e&&e&&"op"in e&&"block"===e.op?function(e){return e.args&&e.args.length?e.args.map(((e,t)=>(Rr=0===t,Gr(e)))).join("\n"):""}(e):Gr(e)}function Br(e,t,n){if(e=`${e}`,!t)return e;for(let r=e.length;r<n;r++)e=t+e;return e}function Gr(e){if(null==e)return"";if("string"==typeof e)return e;let t;if(Nr&&("op"in e||"r"in e))if("op"in e){if("if"===e.op||"with"===e.op||"unless"===e.op||"each"===e.op)t=function(e){Nr=!1;const t=Gr(e.args[0]);Nr=!0;const n=Gr(e.args[1]);let r=`{{${e.op} ${t}}}${"with"===e.op||"each"===e.op?n.slice(2):n}`;if("unless"===e.op)return`${r}{{/}}`;for(let t=2;t<e.args.length;t++)if(t+1>=e.args.length){const n=e.args[t];if("object"==typeof n&&"v"in n&&""===n.v)continue;r+=`{{else}}${Gr(n)}`}else Nr=!1,r+=`{{elseif ${Gr(e.args[t++])}}}`,Nr=!0,r+=Gr(e.args[t]);return r+="{{/}}",r}(e);else if("case"===e.op)t=function(e){const t=e.args.length-1,n=e.args.map(((e,n)=>(Nr=!0,0!==n&&n%2!=1||(Nr=!1),n===t&&(Nr=!0),"object"==typeof e&&"op"in e?Gr(e).replace(co,"_"):Gr(e))));Nr=!0;let r=`{{${e.op} ${n[0]} when ${n[1]}}}`;for(let e=2;e<=t;e++)r+=e===t?`{{else}}${n[e]}`:e%2==1?`{{when ${n[e]}}}`:n[e];return r+="{{/}}",r}(e);else if(e.op){if("+"===e.op)return e.args.map((e=>Gr(e))).join("");{Nr=!1;const n=`{{${Gr("string"===e.op?e.args[0]:e)}}}`;Nr=!0,t=n}}}else{Nr=!1;const n=`{{${Gr(e)}}}`;Nr=!0,t=n}else if("r"in e)if("string"==typeof e.r)t=/^[0-9]/.test(e.r)?`.${e.r}`:e.r;else{const n=e.r;t=`${function(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}("^",n.u||0)}${n.p||""}${n.k.map(((e,t)=>"string"==typeof e&&Or.test(e)?`${t?"":"_"}[${Gr({v:e})}]`:"string"==typeof e||"number"==typeof e?`${t?".":""}${e}`:`[${Gr(e)}]`)).join("")}`}else if("op"in e)t=function(e){let t=e.op;(Ur&&!1!==Hr||Hr)&&(">"===t?t="gt":">="===t?t="gte":"<"===t?t="lt":"<="===t?t="lte":"&&"===t&&(t="and"));if(Xr||"array"!==t){if(Tr||"object"!==t||!e.args||e.args.find(((e,t)=>t%2==0&&("string"==typeof e||!("v"in e)||"string"!=typeof e.v)))){if(Yr)return e.args&&e.args.length?ao(`(${t} `,e.args,")",0,!0):`(${t})`;if("if"===t||"unless"===t&&e.args&&e.args.length>2)return function(e){if(!e.args||e.args.length<2)return"false";let t="";const n=e.args.length-1,r=!!e.args.find(((e,t)=>(t%2==1||t===n)&&lo(e)));_r++;const o=e.args.map(((e,t)=>Gr(!r||t%2!=1&&t!==n||lo(e)?e:{op:"block",args:[e]})));_r--;const i=o.find((e=>e.length>30||~e.indexOf("\n")))||"";let s=Sr?"":o.length>3||i?`\n${Br("","  ",_r)}`:"";const a=i&&`${s}  `||" ";s=s||" ";for(let e=0;e<=n;e++)if(0===e)if(r)t+=`if ${o[e++]} ${so("  ",o[e]).trimLeft()}`;else{const n=o[e++];t+=`if ${n}${~n.indexOf("\n")?s:" "}then${a}${o[e].trimLeft()}`}else e===n?r?t=t.trimRight()+` else ${so("  ",o[e]).trimLeft()}`:t+=`${s}else${a}${o[e].trimLeft()}`:r?t=t.trimRight()+` elif ${o[e++]} ${so("  ",o[e]).trimLeft()}`:t+=`${s}elif ${o[e++]} then${a}${o[e].trimLeft()}`;!r&&_r&&(t+=`${s}end`);return t}(e);if("case"===t&&e.args&&e.args.length>2)return function(e){if(!e.args||e.args.length<2)return"false";let t="";const n=e.args.length-1,r=!!e.args.find(((e,t)=>(t>1&&t%2==0||t===n)&&lo(e)));_r++;const o=e.args.map(((e,t)=>{let o;return 0!==t&&_r++,o=r&&(t>1&&t%2==0||t===n)?Gr(lo(e)?e:{op:"block",args:[e]}):t%2==0||t===n?Gr(e):"object"==typeof e&&"op"in e?Gr(e).replace(co,"_"):Gr(e),0!==t&&_r--,o}));_r--;const i=o.find((e=>e.length>30||~e.indexOf("\n")))||"";let s=Sr?"":o.length>3||i?`\n${Br("","  ",_r)}`:"";const a=s?`${s}  `:" ",l=i&&`${a}  `||" ";s=s||" ";for(let e=0;e<=n;e++)if(0===e)t+=`case ${o[e]}`;else if(e===n)r?t=t.trimRight()+a+`else ${so("  ",o[e]).trimLeft()}`:t+=`${a}else${l}${o[e].trimLeft()}`;else if(r)t=t.trimRight()+a+`when ${o[e++]} ${so("  ",o[e]).trimLeft()}`;else{const n=o[e++];t+=`${a}when ${n}${~n.indexOf("\n")?a:" "}then${l}${o[e].trimLeft()}`}!r&&_r&&(t+=`${s}end`);return t}(e);if("+"===t&&e.args&&e.args.length>1&&Kr(t,e)){return`'${Qr(t,e).map((e=>"string"!=typeof e&&"v"in e&&"string"==typeof e.v?e.v.replace(/[{']/g,(e=>`\\${e}`)).replace(/\$$/,"\\$"):`{${Gr(e)}}`)).join("")}'`}if(("fmt"===t||"format"===t)&&e.args&&"object"==typeof e.args[1]&&"v"in e.args[1]&&"string"==typeof e.args[1].v){const t=e.args[0];let n=Gr(t);return"string"!=typeof t&&"op"in t&&(Ir.includes(t.op)||Jr.includes(t.op))&&(n=`(${n})`),`${n}#${[e.args[1].v].concat(e.args.slice(2).map((e=>Gr(e)))).join(",")}`}if(Ir.includes(t)&&e.args&&e.args.length>1&&(!Pr.includes(t)||2===e.args.length)){let n=e.args.map(((e,n)=>function(e,t,n){const r=Er;let o;Er=!0,"**"===e&&1===n&&"string"!=typeof t&&"op"in t&&"**"===t.op&&(o=`(${Gr(t)})`);o="string"!=typeof t&&"op"in t&&(Ir.includes(t.op)&&Zr[t.op]>Zr[e]||"if"===t.op||"unless"===t.op||"case"===t.op||"fmt"===t.op||"format"===t.op)?`(${Gr(t)})`:Gr(t);return Er=r,o}(t,e,0===n?1:2)));const r=n.find((e=>e.length>30||~e.indexOf("\n")))||n.reduce(((e,t)=>e+t.length),0)&&n.length>2,o=Sr?" ":r?`\n${Br("","  ",_r+1)}`:" ";return(o.length>1||!Sr&&r)&&(n=[n[0]].concat(n.slice(1).map((e=>function(e,t){return t.replace(/\n/gm,`\n${e}`)}("  ",e))))),`${n[0]} ${t}${o}${n.slice(1).join(` ${t}${o.length>1?`${o}`:o}`)}`}if(Jr.includes(t)&&e.args&&1===e.args.length){const n=e.args[0];return"string"!=typeof n&&"op"in n&&(Ir.includes(n.op)||Jr.includes(n.op))?`${t}(${Gr(n)})`:`${t}${Wr.test(t)?" ":""}${Gr(n)}`}if("block"===t){if(!e.args||!e.args.length)return"";_r++;const t=Rr,n=e.args.map(((e,t)=>(Rr=0===t,Gr(e))));Rr=t;let r=Sr?"":`\n${Br("","  ",_r)}`;return _r--,1!==n.length||~n[0].indexOf("\n")?`{${r}${n.join(r)}\n${Br("","  ",_r)}}`:`{ ${n[0]} }`}if("let"!==t&&"set"!==t||!e.args||2!==e.args.length)return"get"===t&&2===e.args.length&&"object"==typeof e.args[1]&&"v"in e.args[1]&&"object"==typeof e.args[1].v&&"k"in e.args[1].v?`${Gr(e.args[0])}${Gr({r:{k:["r"].concat(e.args[1].v.k)}}).substr(1)}`:Wr.test(t)?ao(`${t}(`,e.args||[],")",0,!0):e.args&&e.args.length?ao(`(${t} `,e.args,")",0,!0):`(${t})`;{let n,r=e.args[0];return n="string"==typeof r?r:"v"in r&&"string"==typeof r.v?r.v:"v"in r&&"object"==typeof r.v&&"k"in r.v?Gr({r:r.v}):Gr(r),`${t} ${n} = ${Gr(e.args[1])}`}}return e.args&&e.args.length?!Er&&qr?ao("",e.args,"",2):ao("{",e.args,"}",2):"{}"}return ao("[",e.args,"]")}(e);else if(Mn(e)){const n=Ur&&!1!==Hr||Hr?"\\":">";t="n"in e?`|${e.n.join(Cr?", ":" ")}| =${n} ${Gr(e.a)}`:`=${n}${Gr(e.a)}`}else"v"in e?t=function(e){if(1===e.s){_r++;const t=uo(e.v);if(_r--,~t.indexOf("\n")){const e=Sr?" ":`\n${Br("","  ",_r)}`;return`@[${e}${" "!==e?"  ":""}${t}${e}]`}return`@[${t}]`}if("string"==typeof e.v)return Nr?e.v.replace(/\\(.)/g,"\\\\$1").replace(/{{/g,"\\{{"):!zr&&Dr||Or.test(e.v)||!e.v.length?~e.v.indexOf("'")?~e.v.indexOf("`")?~e.v.indexOf('"')?`'${e.v.replace(/['{]/g,(e=>`\\${e}`)).replace(/\${/g,"\\${")}'`:`"${e.v}"`:`\`${e.v.replace(/[{`]/g,(e=>`\\${e}`)).replace(/\${/g,"\\${")}\``:`'${e.v.replace(/[{']/g,(e=>`\\${e}`)).replace(/\${/g,"\\${")}'`:`${zr?"":":"}${e.v}`;if("number"==typeof e.v||"boolean"==typeof e.v||"true"===e.v||"false"===e.v)return`${e.v}`;if("undefined"===e.v||void 0===e.v)return"undefined";if("null"===e.v||null===e.v)return"null";if(Array.isArray(e.v))return Xr?`(array${e.v.length?" ":""}${e.v.map((e=>Gr({v:e}))).join(Cr?", ":" ")})`:`[${e.v.map((e=>Gr({v:e}))).join(Cr?", ":" ")}]`;if("object"==typeof e.v){if(Un(e.v))return ro(e.v);{const t=Object.keys(e.v);let n="";return!Er&&qr||(n+="{"),n+=`${t.map((t=>`${zr=!0,Gr({v:t})}:${zr=!1,Gr({v:e.v[t]})}`)).join(Cr?", ":" ")}`,!Er&&qr||(n+="}"),n}}}(e):Un(e)?t=ro(e):qn(e)&&(t=function(e){if("number"==typeof e||Oe(e)){let t="",n=Math.abs(De(e));return to.forEach((e=>{const r=Math.floor(n/Me[e]);n%=Me[e],r&&(t+=`${r}${e}`)})),n&&(t+=`${n}ms`),`#${t}#`}{const t=e.d;let n="";return no.forEach(((e,r)=>{null!=t[r]&&(n+=`${t[r]}${e}`)})),`#${n}#`}}(e));return"c"in e&&e.c.length&&(t=(Rr?"":"\n")+e.c.map((e=>`${Br("","  ",_r)}// ${e}\n`)).join("")+`${Br("","  ",_r)}${t}`),t}function Kr(e,t){if(t.args&&t.args.find((e=>"object"==typeof e&&"string"==typeof e.v)))return!0;if(!t.args||!t.args.length)return!1;const n=t.args[0];return"object"==typeof n&&"op"in n&&n.op===e&&Kr(e,n)}function Qr(e,t,n=[]){if(t.args&&t.args.length){let r=0;for(;r<t.args.length&&("object"==typeof t.args[r]&&"string"==typeof t.args[r].v);r++)n.push(t.args[r]);const o=t.args[r];"object"==typeof o&&"op"in o&&o.op===e?Qr(e,o,n):n.push(o),n.push.apply(n,t.args.slice(r+1))}return n}function eo(e,t){if(null==t)return"";t*=e;const n=Math.abs(t),r=Math.floor(n/60),o=n%60;return t?`${t>0?"-":"+"}${r}${o?`:${Br(o,"0",2)}`:""}`:"Z"}const to=["w","d","h","mm","s"],no=["y","m","d","h","mm","s","ms"];function ro(e){let t="";if(e instanceof Date){const n=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),i=e.getHours(),s=e.getMinutes(),a=e.getSeconds(),l=e.getMilliseconds();return t=`${n}-${Br(r,"0",2)}-${Br(o,"0",2)}`,i+s+a+l>0&&(t+=` ${Br(i,"0",2)}:${Br(s,"0",2)}`,a+l>0&&(t+=`:${Br(a,"0",2)}`,l>0&&(t+=`.${Br(l,"0",3)}`))),`#${t}${eo(1,e.getTimezoneOffset())}#`}if(Array.isArray(e.f)){const n=e.f;return t=`${n[0]}`,null!=n[1]&&(t+=`-${Br(n[1]+1,"0",2)}`),null!=n[2]&&(t+=`-${Br(n[2],"0",2)}`),null!=n[3]&&(t+=` ${Br(n[3],"0",2)}`),null!=n[4]&&(t+=`:${Br(n[4],"0",2)}`),null!=n[5]&&(t+=`:${Br(n[5],"0",2)}`),null!=n[6]&&(t+=`.${Br(n[6],"0",3)}`),null!=n[7]&&(t+=` ${eo(-1,n[7])}`),"e"in e&&e.e&&(t+="<"),`#${t}#`}if("n"===e.f){if(Array.isArray(e.o))return no.forEach(((n,r)=>{null!=e.o[r]&&(t+=`${e.o[r]}${n}`)})),t+=`${"d"in e&&-1===e.d?" ago":" from now"}${eo(-1,e.z)}`,`#${t}#`;if("number"==typeof e.o){if(0===e.o)return"#now#";let n=Math.abs(e.o);return to.forEach((e=>{const r=Math.floor(n/Me[e]);n%=Me[e],r&&(t+=`${r}${e}`)})),n&&(t+=`${n}ms`),`#${t}${e.o<0?" ago":e.o>0?" from now":""}${eo(-1,e.z)}#`}}else if("d"in e&&1===e.d&&0===e.o)t=`#${"w"===e.f?"week":"m"===e.f?"month":"year"} to date${eo(-1,e.z)}${e.e?">":""}#`;else{if("t"in e&&Array.isArray(e.t)){const n=e.t;return t=(e.o<0?"yesterday":e.o>0?"tomorrow":"today")+" at ",n[0]||n[1]||n[2]||n[3]?12!==n[0]||n[1]||n[2]||n[3]?(t+=n[0],null!=n[1]&&(t+=`:${Br(n[1],"0",2)}`),null!=n[2]&&(t+=`:${Br(n[2],"0",2)}`),null!=n[3]&&(t+=`.${Br(n[3],"0",3)}`)):t+="noon":t+="midnight",`#${t}${eo(-1,n[4])}${e.e?">":""}#`}if(!("t"in e)&&!("d"in e)&&!Array.isArray(e.f)){const n=e;return"d"===n.f?t+=""+(n.o<0?"yesterday":n.o>0?"tomorrow":"today"):t+=`${n.o<0?"last":n.o>0?"next":"this"} ${"w"===n.f?"week":"m"===n.f?"month":"year"}`,`#${t}${eo(-1,n.z)}${n.e?">":""}#`}}return t}const oo=/^\s+/,io=/^\s+/gm;function so(e,t){return e?t.replace(io,(t=>t.substr(e.length))):t}function ao(e,t,n,r,o){if(!t||!t.length)return`${e}${n}`;_r++;const i=Rr;let s;if(r){s=[];for(let e=0;e<t.length;e++)if(e%r==0)zr=!0,s.push(Gr(t[e])+":"),zr=!1;else{_r++,Rr=1===e;const n=Gr(t[e]);"\n"===n[0]?s[s.length-1]+=" "+n.replace(oo,""):s[s.length-1]+=n,_r--}}else{const e=t.length-1,n=qr;s=t.map(((t,n)=>(Rr=0===n,o&&n===e&&(qr=!0),Gr(t)))),qr=n}_r--,Rr=i;let a=Cr?", ":" ";if(Sr||1==s.length&&!~s[0].indexOf("\n"))return`${e}${s.join(a)}${n}`;let l=Fr.args;const c=s.join(Cr?", ":" ");!l&&~c.indexOf("\n")&&(l=1),1===l&&Cr&&(a=",\n");const u=Br("","  ",_r);if(!l)return`${e}${c}${n}`;if(1===l)return`${e}\n${s.map((e=>`${u}  ${e}`)).join(a)}\n${u}${n}`;if(c.length<=l)return`${e}${c}${n}`;let f=`${e}`,p="";const g=s.length-1;for(let e=0;e<s.length;e++)~s[e].indexOf("\n")?(p&&(f+=p),f+=`\n${" "===s[e][0]?"":u+"  "}${s[e]}${e!==g?a:""}`,p=""):(p||(p+=`\n${u}  `),p+=`${s[e]}${e!==g?a:""}`,p.length>=l&&(f+=p,p=""));return p&&(f+=p),`${f}\n${u}${n}`}function lo(e){return"object"==typeof e&&"op"in e&&"block"===e.op}const co=/@case\b/g;function uo(e,t){if(void 0!==t&&(Lr=t),!e)return"any";const n=e.type,r=e.types;let o,i,s="",a="",l="",c="",u=Fr.array;switch(n){case"object":case"object[]":const t=!!~n.indexOf("[]");if(!(e.fields&&e.fields.length||e.rest)){s="{}"+(t?"[]":"");break}u=Fr.keys,_r++,o=e.fields?e.fields.map(((e,t)=>{const n=uo(e);return(e.desc&&e.desc.length?(0===t?"":`\n${Br("","  ",_r)}`)+e.desc.map((e=>`// ${e}`)).join(`\n${Br("","  ",_r)}`)+`\n${Br("","  ",_r)}`:"")+`${e.name}${e.required?"":"?"}: ${n}`})):[],e.rest&&o.push(`...: ${uo(e.rest)}`),_r--,a="{",l="}"+(t?"[]":""),c=", ";break;case"union":case"union[]":~n.indexOf("[]")?(a="Array<",l=">"):e.checks&&e.checks.length&&(a="(",l=")"),a&&_r++,o=r.map((e=>uo(e))),u=Fr.union,c=o.length>6||o.find((e=>~e.indexOf("\n")))?" | ":"|",a&&_r--;break;case"literal":s="string"==typeof e.literal?`'${e.literal.replace(/'/g,"\\'")}'`:`${e.literal}`;break;case"tuple":case"tuple[]":if(!n||0===n.length){s="[]";break}_r++,a="[",l="]"+(~n.indexOf("\n")?"[]":""),c=", ",o=r.map((e=>uo(e))),_r--;break;default:s=e.ref||n||"any",e.ref&&"array"===n&&(s+="[]")}const f=Sr?" ":Br("","  ",_r);if(e.defs){i=Object.keys(e.defs).sort().map(((t,n)=>{const r=e.defs[t];return(r.desc&&r.desc.length?(0===n?"":`\n${f}`)+r.desc.map((e=>`// ${e}`)).join(`\n${f}`)+`\n${f}`:"")+`type ${t} = ${uo(r)}`})).join(`\n${f}`)}if(!s){const e=a&&!Sr?`${f}  `:f,t=Sr?"":"\n",n=a?`${a}${t}${e}`:"",r=l?`${t}${f}${l}`:"";if(0===u)s=`${n}${o.join(c)}${r}`;else if(1===u)s=`${n}${o.join(`${c}${t}${e}`)}${r}`;else{let i="";const f=o.length-1;for(let n=0;n<o.length;n++)~o[n].indexOf("\n")?(i="",s+=(0===n?"":"\n"+e)+o[n]+(n!==f?c:"")):(s+=o[n],i+=o[n],n!==f&&(s+=c,i+=c)),i.length>u&&n!==f&&!~(o[n+1]||"").indexOf("\n")&&(s+=`${t}${e}`,i="",~c.indexOf("|")&&(s+="  "));s=~s.indexOf("\n")?`${n}${s}${r}`:`${a}${"{"===a?" ":""}${s}${"{"===a&&" "!==s.substr(-1)?" ":""}${l}`}}return!Lr&&e.checks&&e.checks.length&&(s+=` ?${e.checks.map((e=>Gr(e))).join(" ?")} `),i&&(s=`${i}\n${f}\n${f}${s}`),s}const fo=$(K(ie(W(J("@[")),xe,Pt(),xe,W(J("]"))),(([,,e])=>e)),{trim:!0,consumeAll:!0}),po=K(ie(W(J("-")),_(le)),(([e,t])=>e?-t:+t)),go=K(ie(po,J("-",":"),po),(([e,,t])=>[e,t])),ho=K(ie(J("<",">"),xe,po),(([e,,t])=>"<"===e?[-1/0,t-1]:[t+1,1/0])),yo=$(re(B(K(J("*"),(()=>[-1/0,1/0])),go,ho,po),_(" \t\r\n,;"),"allow"),{trim:!0});function mo(...e){return e.filter((e=>e)).join(".")}const $o=(e,t)=>e==t,bo=(e,t)=>e===t,vo=/^\d+$/;function xo(e,t,n){const r=n&&"object"==typeof n?n.type:n;return wo(e,t,"",{},"function"==typeof r?r:"strict"===r?bo:$o,"object"==typeof n?n.identity:void 0)}function wo(e,t,n,r,o,i){if("object"!=typeof e||"object"!=typeof t)return e===t||(r[n]=[e,t]),r;let s;if(Array.isArray(e)&&Array.isArray(t)&&i&&(s=function(e,t){return e[`${t.split(".").reduce(((e,t)=>vo.test(t)?`${e}[]`:`${e}${e.length?".":""}${t}`),"")}[]`]}(i,n))){const a=e.map((e=>!0===s?e:"string"==typeof s?!e||"object"!=typeof e&&"function"!=typeof e?e:e[s]:s(e))),l=t.map((e=>!0===s?e:"string"==typeof s?!e||"object"!=typeof e&&"function"!=typeof e?e:e[s]:s(e)));for(let s=0;s<a.length;s++){const c=l.indexOf(a[s]);if(~c){const a=e[s],l=t[c];if(a===l)continue;"object"==typeof a&&"object"==typeof l?wo(a,l,mo(n,`${s}`),r,o,i):o(a,l)||(r[mo(n,`${s}`)]=[a,l])}else r[mo(n,`${s}`)]=[e[s],void 0]}const c=a.slice();for(let e=0;e<a.length;e++)~c.indexOf(l[e])||(r[mo(n,`${e+c.length}`)]=[void 0,t[e]])}else{const s=e||{},a=t||{},l=Object.keys(s);for(const e of Object.keys(a))~l.indexOf(e)||l.push(e);for(const e of l){const t=s[e],l=a[e];t!==l&&("object"==typeof t&&"object"==typeof l?wo(t,l,mo(n,e),r,o,i):o(t,l)||(r[mo(n,e)]=[t,l]))}}return r}function Ao(e,t,n){return ko(e,t,"function"==typeof n?n:"strict"===n?bo:$o)}function ko(e,t,n){if("object"!=typeof e||"object"!=typeof t)return n(e,t);const r=Object.keys(e||{});for(const e of Object.keys(t||{}))~r.indexOf(e)||r.push(e);for(const o of r){const r=e[o],i=t[o];if(r!==i)if("object"==typeof r&&"object"==typeof i){if(!ko(r,i,n))return!1}else if(!n(r,i))return!1}return!0}function jo(e,t,n){const r=n.omit?{}:Object.assign({},e);return Oo(e,t,"","",r,n),r}const Mo=/^\d+/;function Oo(e,t,n,r,o,i){for(const s in t)if("[]"===s.slice(-2)){const a=`${n}${n&&"."}${s.slice(0,-2)}`,l=Array.isArray(t[s])?t[s]:[t[s]],c=Object.keys(e),u=[];for(const e of c)if(0===e.indexOf(a)&&Mo.test(e.substr(a.length+1))){const t=e.indexOf(".",a.length+1),n=e.substring(a.length+1,~t?t:void 0);~u.indexOf(n)||u.push(n)}const f=`${r}${r&&" "}${l[0]}`;for(const t of u){const n=`${a}${a&&"."}${t}`;n in e&&(o[`${f}${f&&" "}${+t+1}`]=e[n],i.omit&&delete o[n]),l[1]&&Oo(e,l[1],n,`${f}${f&&" "}${+t+1}`,o,i)}}else{const a=`${n}${n&&"."}${s}`;let l=Array.isArray(t[s])?t[s]:[t[s]];const c=`${r}${r&&" "}${l[0]}`;a in e&&(o[c]=e[a],i.omit&&delete o[a]),l[1]&&Oo(e,l[1],a,c,o,i)}}const Do=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function zo(e){return"object"==typeof e?Un(e):!("string"!=typeof e||!Do.test(e))}function Yo(e,t){const n=Xo(e);if(Array.isArray(e)){const r=[];if(r.push({type:"number",name:"length"}),!t&&e.length>0){const t=Yo(e[0]);t.fields?r.push({type:t.type,fields:t.fields,name:"0"}):r.push({type:t.type,name:"0"})}return{type:n,fields:r}}if("object"==typeof e&&!zo(e)){const r=[];for(const n in e)r.push(Co(n,e[n],t));return{type:n,fields:r}}return{type:n}}function Co(e,t,n){const r=Xo(t);if(!n&&(~r.indexOf("object")||"array"===r)){const n=Yo(t);return n.fields?{type:r,fields:n.fields,name:e}:{type:r,name:e}}return{type:Xo(t),name:e}}function Xo(e){return"string"==typeof e?zo(e)?"date":"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":Array.isArray(e)?e.length<1?"array":"string"==typeof e[0]?zo(e[0])?"date[]":"string[]":"number"==typeof e[0]?"number[]":"boolean"==typeof e[0]?"boolean[]":zo(e[0])?"date[]":"object"==typeof e[0]?"object[]":"array":"object"==typeof e?zo(e)?"date":"object":"any"}function To(e,t,n){if("string"==typeof t){const e=fo(t);if("message"in e)return[{error:"invalid schema"}];t=e}t||(t={type:"any"});return No(e,t,n,"",new Yn(e,{special:{types:t.defs||{}}}))}function No(e,t,n,r,o,i){let s=t=t||{};const a=[],l="strict"===n||"missing"===n;if(s.ref){let e=s;for(;e&&e.ref;)e=pn(o,`@types.${e.ref}`);e?s=e:l&&a.push({error:`missing type definition '${s.ref}'`,type:"missing"})}let{checks:c}=s;const{type:u,fields:f,rest:p,types:g,literal:d}=s;if(!So(e,"array"===t.type?"array":u,d,i))return[{error:`type mismatch for${i?" required":""} '${u}'`,actual:uo(Yo(e)),value:e,path:r,expected:uo(s,!0)}];let h;if(s!==t&&t.checks&&(c=c?c.concat(t.checks):t.checks),"tuple"!==u&&"tuple[]"!==u||!g)if("union"!==u&&"union[]"!==u||!g){if(("object"===u||"object[]"===u||"any"===u)&&f||p){const i=~u.indexOf("[]")||"array"===t.type,s=i?e:[e];for(let e=0;e<s.length;e++){const t=s[e],l=i?mo(r,`${e}`):r;if("object"==typeof t||"function"==typeof t){if(f)for(const e of f)e.required&&!(e.name in t)?a.push({error:`requried field ${e.name} is missing`,path:mo(l,e.name)}):t&&e.name in t&&!0!==(h=No(t[e.name],e,n,mo(l,e.name),Cn(o,{value:t[e.name],path:mo(l,e.name)}),e.required))&&a.push.apply(a,h);if(p&&t)for(const e in t)f&&f.find((t=>t.name===e))||null!=t[e]&&!0!==(h=No(t[e],p,n,mo(l,e),Cn(o,{value:t[e],path:mo(l,e)})))&&a.push.apply(a,h);else if("strict"===n&&t)for(const e in t)(null==t[e]||f)&&f.find((t=>t.name===e))||a.push({error:`unknown field ${e}`,path:l,type:"strict",value:t[e]})}else a.push({error:"expected an object",value:t,path:l,actual:uo(Yo(t),!0)})}}}else{const t=~u.indexOf("[]"),i=t?e:[e];for(let e=0;e<i.length;e++){const s=i[e],c=t?mo(r,`${e}`):r;let u,f=!1;for(const e of g){if(!0===(h=No(s,e,n,c,o))){f=!0;break}l&&h.find((e=>"missing"===e.type))||h.find((e=>"check"===e.type))?u=h.filter((e=>l&&"missing"===e.type||"check"===e.type)):h.find((e=>e.path!==c))&&(u=h)}f||u?!f&&u&&a.push.apply(a,u):a.push({error:"type mismatch for union",actual:uo(Yo(s)),expected:uo({type:"union",types:g}),value:s,path:c})}}else{const t=~u.indexOf("[]"),i=t?e:[e];for(let e=0;e<i.length;e++){const s=i[e],l=t?mo(r,`${e}`):r;if(Array.isArray(s))if(s.length<g.length){const e=g.length-s.length;a.push({error:`missing ${e} field${e>1?"s":""} in tuple`,path:l,expected:uo({type:"tuple",types:g})})}else{for(let e=0;e<g.length;e++)!0!==(h=No(s[e],g[e],n,mo(l,`${e}`),Cn(o,{value:s[e],path:mo(l,`${e}`)})))&&a.push.apply(a,h);"strict"===n&&s.length>g.length&&a.push({error:"too many values for tuple",type:"strict",path:l,expected:uo({type:"tuple",types:g})})}else a.push({error:"expected a tuple",path:l,value:s})}}if(!a.length&&c&&c.length){let n;for(let i=0;i<c.length;i++){n=hn(o,c[i],[e],!0),n&&"string"!=typeof n||a.push({error:"string"==typeof n&&n?n:`check ${i+1} failed`,path:r,value:e,type:"check",expected:uo(t,!0)})}}return!a.length||a}const Uo=["string","number","boolean","object"];function So(e,t,n,r){switch(t||"any"){case"any":case"union":return!0;case"value":return!Array.isArray(e)&&!!~Uo.indexOf(typeof e)&&("object"!=typeof e||zo(e));case"array":case"tuple":case"union[]":case"tuple[]":return Array.isArray(e);case"literal":return e===n;case"string":return"string"==typeof e;case"number":return"number"==typeof e;case"boolean":return"boolean"==typeof e;case"date":return zo(e);case"object":return!(Array.isArray(e)||"object"!=typeof e||r&&null==e);case"string[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&"string"==typeof t),!0);case"number[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&"number"==typeof t),!0);case"boolean[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&"boolean"==typeof t),!0);case"date[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&zo(t)),!0);case"object[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&!Array.isArray(t)&&"object"==typeof t&&(!r||null!=t)),!0)}}const Fo={record:"\n",field:",",header:!1,quote:'"'};function qo(e){const t=Object.assign({},Fo,e),n=H(" \t\r\n".replace(t.field,"").replace(t.record,"").replace(t.quote,"")),r=J(t.quote||'"'),o=oe(ie(n,r),K(ee(B(P(t.quote),K(ie(r,r),(()=>"")))),(e=>w(e))),ie(r,n)),i=$(ne(G(re(B(o,P(t.record+t.field,!0)),ie(n,J(t.field),n)),(e=>e.length>1||e[0].length>0||"empty record")),J(t.record),"allow"),{consumeAll:!0});return function(e,n){const r=i(e,n);if(Array.isArray(r)&&r.length>0&&t.header){const e=r.shift().map(((e,t)=>[e,t]));e.sort(((e,t)=>e<t?-1:e>t?1:0));for(let t=0;t<r.length;t++)for(let n=0;n<e.length;n++)r[t][e[n][0]]=r[t][e[n][1]]}return r}}const Eo=[",","|","\t",":",";","~"],Ho=["\r\n","\r","\n"],Lo=["'",'"',"`","$"];function _o(e,t=2048){const n=e.slice(0,t),r=Eo.reduce(((e,t)=>(e[t]=n.replace(new RegExp(`[^${t}]`,"g"),"").length/t.length,e)),{}),o=Ho.reduce(((e,t)=>(e[t]=n.replace(new RegExp(`[^${t}]`,"g"),"").length/t.length,e)),{}),i=Lo.reduce(((e,t)=>(e[t]=n.replace(new RegExp(`[^${t}]`,"g"),"").length/t.length,e)),{}),s={field:",",record:"\n",quote:'"'};let a=0;for(const e in r)r[e]>a&&(s.field=e,a=r[e]);a=0;for(const e in o)o[e]>a&&(s.record=e,a=o[e]);a=0;for(const e in i)i[e]>a&&(s.quote=e,a=i[e]);return s}function Ro(e,t){return{type:"value",names:e,apply:t}}const Po={y:[0,12],M:[1,30],d:[2,24]},Io=/^[^\d]*(\d+(?:\.\d*)?)/,Jo=/^\s*$/;function Zo(e){return!isNaN(e)&&!Jo.test(e)}function Wo(e){return isNaN(e)||!e?0:+e}function Vo(e,t){return e==t}function Bo(e,t,n=.5){const r=Ko(e,t,n,0);return r&&r[1]||void 0}function Go(e,t,n=.5,r=2){const o=Ko(e,t,n,r);return o&&o[2]||0}function Ko(e,t,n=.5,r=2){if(!e||!t)return;const o=e.toLowerCase(),i=t.toLowerCase();o.indexOf(i),i.indexOf(o);let s=0,a=0,l=0,c=0,u=0,f=0,p=0,g=0,d=0;const h=e.length,y=t.length;let m=0,$=0;for(s=0;s<h;s++)for(a=0;a<y;a++)if(o[s]===i[a]){m=h-s,$=y-a,g=0;e:for(l=1,c=1;l<m&&c<$;){if(o[s+l]!==i[a+c]){for(u=0;u<=r;u++)for(f=0;f<=u;f++)for(p=0;p<=u;p++)if(o[s+l+f]===i[a+c+p]){l+=f,c+=p,g+=Math.max(f,p);continue e}break e}l++,c++}if(d=(Math.max(l,c)-g)/Math.min(o.length,i.length),d>=n)return[o.substr(s,l),i.substr(a,c),d]}}function Qo(e,t,n,r){if("string"!=typeof t&&(t=""+t),!Zo(n))return t;r||(r=" "),"string"!=typeof r&&(r=""+r),r.length<1&&(r=" ");for(let o=t.length;o<n;o=t.length)e?t=r+t:t+=r;return t}bn(Ro(["is","is-not","==","!=","strict-is","strict-is-not"],((e,t)=>{const[n,r]=t,o=Vo(n,r);return"is"===e||"=="===e?o:!o})),Ro(["strict-is","strict-is-not"],((e,t)=>{const[n,r]=t,o=n===r;return"strict-is"===e?o:!o})),Ro(["deep-is","deep-is-not","===","!=="],((e,t,n)=>{let[r,o,i]=t;if(i&&Mn(i)){const e=i;i=(t,r)=>hn(n,e,[t,r])}const s=Ao(r,o,i);return"deep-is"===e||"==="===e?s:!s})),Ro(["not"],((e,t)=>!t[0])),Ro(["<",">","<=",">=","gt","gte","lt","lte"],((e,t)=>{"gt"===e?e=">":"lt"===e?e="<":"gte"===e?e=">=":"lte"===e&&(e="<=");let[n,r]=t;return n instanceof Date||r instanceof Date?"number"==typeof n||"number"==typeof r?(n=+n,r=+r):"string"==typeof n||"string"==typeof r?(n=new Date(n),r=new Date(r)):n&&"f"in n&&"o"in n?(n=Nn(n)["<"===e[0]?1:0],r=new Date(r)):r&&"f"in r&&"o"in r&&(r=Nn(r)["<"===e||">="===e?0:1],n=new Date(n)):Un(n)?(n=Nn(n)["<"===e[0]?1:0],r=Un(r)?Nn(r)["<"===e||">="===e?0:1]:new Date(r)):Un(r)&&(r=Nn(r)["<"===e||">="===e?0:1],n=new Date(n)),"<"===e?n<r:">"===e?n>r:"<="===e?n<=r:">="===e&&n>=r})),Ro(["like","not-like","ilike","not-ilike"],((e,t)=>{const[n,r,o]=t;let i=!1;const s="string"==typeof r?[r]:r,a="free"===o||"object"==typeof o&&o.free;if(!Array.isArray(s))return!1;for(let t=0;t<s.length&&!i;t++){const r=s[t];if("string"!=typeof r)continue;const o=new RegExp(`${a?"":"^"}${r.replace(/[\s\%\*]+/g,"[\\s\\S]*").replace(/\?/g,".")}${a?"":"$"}`,~e.indexOf("ilike")?"i":"");i=Array.isArray(n)?!!n.find((e=>o.test(e))):o.test(n)}return"like"===e||"ilike"===e?i:!i})),Ro(["in","not-in"],((e,t,n)=>{const[r,o]=t;let i;if(Un(o)){const t=Nn(o),n=Un(r)?Nn(r)[0]:new Date(r),i=n>=t[0]&&n<=t[1];return"in"===e?i:!i}if("string"==typeof r&&"object"==typeof o&&!Array.isArray(o))return r in o;if(Array.isArray(r)&&r.length>0&&"string"==typeof r[0]&&!Array.isArray(o)&&o&&"object"==typeof o){const t=Object.keys(o),n=r.reduce(((e,n)=>e&&~t.indexOf(n)),!0);return"in"===e?n:!n}if("string"==typeof o&&Zo(r)&&(i=oi(n,o),Array.isArray(i))){const t=i.reduce(((e,t)=>e||(Array.isArray(t)?r>=t[0]&&r<=t[1]:r==t)),!1);return"in"===e?t:!t}if(Mn(r)){let t=!1;return Array.isArray(o)||o&&"object"==typeof o&&"0"in o?t=Array.prototype.find.call(o,((e,t)=>hn(n,r,[e,t],!1,{index:t,key:t}))):o&&"object"==typeof o&&(t=Object.entries(o).find(((e,t)=>hn(n,r,[e[1],t,e[0]],!1,{index:t,key:e[0]})))),"in"===e?!!t:!t}if(!Array.isArray(o)&&"string"!=typeof o)return"in"===e?r==o:r!=o;if(Array.isArray(r)&&Array.isArray(o)){const t=r.reduce(((e,t)=>e&&~o.indexOf(t)),!0);return"in"===e?!!t:!t}const s=!!~o.indexOf(r);return"in"===e?s:!s})),Ro(["contains","does-not-contain"],((e,t,n)=>{const[r,o]=t;if(Un(r)){const t=Nn(r),n=Un(o)?Nn(o)[0]:new Date(o),i=n>=t[0]&&n<=t[1];return"contains"===e?i:!i}if(Mn(o)){let t=!1;return Array.isArray(r)||r&&"object"==typeof r&&"0"in r?t=Array.prototype.find.call(r,((e,t)=>hn(n,o,[e,t],!1,{index:t,key:t}))):o&&"object"==typeof r&&(t=Object.entries(r).find(((e,t)=>hn(n,o,[e[1],t,e[0]],!1,{index:t,key:e[0]})))),"contains"===e?!!t:!t}if(!Array.isArray(r)&&"string"!=typeof r)return!1;if(Array.isArray(o)&&Array.isArray(r)){const t=o.reduce(((e,t)=>e&&~r.indexOf(t)),!0);return"contains"===e?!!t:!t}const i=!!~r.indexOf(o);return"contains"===e?i:!i})),Ro(["clamp"],((e,[t,n,r])=>n<t?t:n>r?r:n)),Ro(["get"],((e,t,n)=>{const[r,o]=t,i=Cn(n,{value:r});return"string"==typeof(s=o)||"object"==typeof s&&Array.isArray(s.k)?pn(i,o):dn(i,o);var s})),Ro(["array"],((e,t)=>t)),Ro(["object"],((e,t)=>{const n={};for(let e=0;e<t.length;e+=2)n[t[e]]=t[e+1];return n})),Ro(["split"],((e,[t,n])=>"string"!=typeof t?[t]:t.split(n||""))),Ro(["filter"],((e,t,n)=>{let[r,o,i,s]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return"object"==typeof r&&r?Object.entries(r).filter(((e,t)=>hn(n,o,[e[1],t,e[0]],!1,{index:t,key:e[0]}))).reduce(((e,t)=>(e[t[0]]=t[1],e)),{}):[];r=r.value}return xn({value:r},o,i,s,n).value})),Ro(["source"],((e,t)=>{const[n]=t;return{value:n}})),Ro(["group"],((e,t,n)=>{n=n||new Yn({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return xn({value:r},null,null,o,n).value})),Ro(["sort"],((e,t,n)=>{n=n||new Yn({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return xn({value:r},null,o,null,n).value})),Ro(["time-span","time-span-ms"],((e,t)=>{const n="[object Object]"===Object.prototype.toString.call(t[t.length-1])?t[t.length-1]:{},r=Un(t[0])&&Un(t[1])?function(e,t){if(isNaN(+e)||isNaN(+t))return{d:[]};if(t<e){const n=t;t=e,e=n}const n=new Date(e),r=t,o={d:[0,0,0,0,0,0,0],s:+n};let i,s,a=r.getFullYear()-n.getFullYear()-1;for(a>0&&(o.d[0]+=a,n.setFullYear(r.getFullYear()-1)),n.setFullYear(n.getFullYear()+1),n>r?n.setFullYear(n.getFullYear()-1):o.d[0]++,1===e.getMonth()&&29===e.getDate()&&1!==n.getMonth()&&(n.setDate(29),n.setMonth(1));;){if(a=n.getDate(),i=n.getMonth(),s=n.getFullYear(),n.setDate(a+1),n.getMonth()!==i?(n.setDate(1),n.setMonth(i+2),n.setDate(0)):(n.setDate(a),n.setMonth(i+1),(11===i?0!==n.getMonth():n.getMonth()!==i+1)&&(n.setDate(1),n.setMonth(i+2),n.setDate(0))),n>r){n.setFullYear(s),n.setDate(1),n.setMonth(i),n.setDate(a);break}o.d[1]++}for(;;){if(n.setDate(n.getDate()+1),n>r){n.setDate(n.getDate()-1);break}o.d[2]++}for(;;){if(n.setHours(n.getHours()+1),n>r){n.setHours(n.getHours()-1);break}o.d[3]++}for(;;){if(n.setMinutes(n.getMinutes()+1),n>r){n.setMinutes(n.getMinutes()-1);break}o.d[4]++}for(;;){if(n.setSeconds(n.getSeconds()+1),n>r){n.setSeconds(n.getSeconds()-1);break}o.d[5]++}return n.getMilliseconds()<=r.getMilliseconds()?o.d[6]=r.getMilliseconds()-n.getMilliseconds():o.d[6]=1e3-n.getMilliseconds()+r.getMilliseconds(),o}(Sn(t[0]),Sn(t[1])):qn(t[0])?t[0]:0;if(n.unit){const e=(Array.isArray(n.unit)?n.unit:[n.unit]).map((e=>"y"===e[0]?"y":"M"===e[0]||"m"===e[0]&&"i"!==e[1]&&"m"!==e[1]?"M":"w"===e[0]?"w":"d"===e[0]?"d":"h"===e[0]?"h":"m"!==e[0]||e[1]&&"i"!==e[1]&&"m"!==e[1]?"s"===e[0]?"s":"m"===e[0]&&"s"===e[1]?"l":"":"m")).filter((e=>!!e));let t,o;if("number"!=typeof r&&!Oe(r)){const n=e.join("");if("d"===n)if(r.s){const e=new Date(r.s);e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);const t=new Date(+e);t.setDate(1),t.setFullYear(t.getFullYear()+r.d[0]),t.setMonth(e.getMonth()+r.d[1]);const n=t.getMonth();t.setDate(e.getDate()),t.getMonth()!==n&&t.setDate(0),t.setDate(t.getDate()+r.d[2]);const i=+t-+e;let s=Math.floor(i/864e5);i%864e5>=828e5&&s++,o=[s]}else o[0]+=365*r.d[0],o[0]+=30*r.d[1];else e.length<4&&("y"===n||"yM"===n||"yMd"===n||"M"===n||"Md"===n||"d"===n)&&(o=e.map((e=>(t=r.d[Po[e][0]+1]/Po[e][1],r.d[Po[e][0]]))),"M"===e[0]&&(o[0]+=12*r.d[0]))}if(!o){let n="number"==typeof r||Oe(r)?De(r):r&&"s"in r?+En(new Date(r.s),r,1)-+new Date(r.s):r.d[0]*Me.y+r.d[1]*Me.m+r.d[2]*Me.d+r.d[3]*Me.h+r.d[4]*Me.mm+r.d[5]*Me.s+r.d[6];o=e.map((()=>0));const i={y:"m",M:"w",w:"d",d:"h",h:"mm",m:"s"},s={y:12,M:4.3,w:7,d:24,h:60,m:60};for(let r=0;r<o.length;r++){const a="m"===e[r]?"mm":"M"===e[r]?"m":e[r];if("l"===a){o[r]=n,t=0;break}o[r]=Math.floor(n/Me[a]),n-=o[r]*Me[a],i[e[r]]?t=n/Me[i[e[r]]]/s[e[r]]:"s"===e[r]&&(t=n%1e3)}}if(!0===n.round?t>=.5&&o[o.length-1]++:"c"===(n.round||"")[0]&&(t>0&&o[o.length-1]++,"y"===e[0]&&"M"===e[1]&&2===e.length&&12===o[1]&&(o[0]++,o[1]=0)),n.string){const t={y:"year",M:"month",w:"week",d:"day",h:"hour",m:"minute",s:"second",l:"millisecond"};let n="";for(let r=0;r<e.length;r++)o[r]&&(n+=`${n.length?" ":""}${o[r]} ${t[e[r]]}${o[r]>1?"s":""}`);return n}return Array.isArray(n.unit)?o:o[0]}if(!n.string)return r;if("number"!=typeof r&&!Oe(r)){let e="";const t=["year","month","day","hour","minute","second","millisecond"];for(let n=0;n<r.d.length;n++)r.d[n]&&(e+=`${e.length?" ":""}${r.d[n]} ${t[n]}${r.d[n]>1?"s":""}`);return e}{let e=De(r),t="";const n=["w","d","h","mm","s"],o=["week","day","hour","minute","second","millisecond"];for(let r=0;r<n.length;r++)if(e>Me[n[r]]){const i=Math.floor(e/Me[n[r]]);e-=Me[n[r]]*i,t+=`${t.length?" ":""}${i} ${o[r]}${i>1?"s":""}`}e&&(t+=`${t.length?" ":""}${e} millisecond${e>1?"s":""}`)}})),Ro(["string","unparse"],((e,t)=>{const[n]=t;let r=t.slice(-1)[0]||{};if("unparse"===e&&(r=Object.assign({},r,{raport:1})),r.raport&&r.tpl&&(r.template=1),!r&&null==n)return"";if("object"==typeof r&&r.json)return JSON.stringify(n);if("object"==typeof r&&r.schema)return uo(n);if("object"==typeof r&&r.raport){let e=Vr(n,r);return void 0===e&&(e=Vr({v:n},r)),e}if(Array.isArray(n))return n.join(", ");let o=`${n}`;return"[object"===o.slice(0,7)?JSON.stringify(n):o})),Ro(["call"],((e,t,n)=>{if(null!=t[0]&&"string"==typeof t[1]&&"function"==typeof t[0][t[1]]){const e=t.shift();return e[t.shift()].apply(e,t)}if("function"==typeof t[0]){return t.shift().apply(null,t)}if(Dn(t[0]))return hn(n,t[0],t.slice(1))})),Ro(["intersect"],((e,[t,n])=>{if(!Array.isArray(t)||!Array.isArray(n))return[];const r=[];let o;for(let e=0;e<t.length;e++)o=t[e],~n.indexOf(o)&&!~r.indexOf(o)&&r.push(o);for(let e=0;e<n.length;e++)o=n[e],!~r.indexOf(o)&&~t.indexOf(o)&&r.push(o);return r})),Ro(["let"],((e,[t,n],r)=>{gn(r,t,n,!0)})),Ro(["set"],((e,[t,n],r)=>{gn(r,t,n)})),Ro(["similarity"],((e,[t,n,r,o])=>Go(`${t||""}`,`${n||""}`,r,o))),Ro(["similar"],((e,[t,n,r,o])=>Ko(`${t||""}`,`${n||""}`,r,o))),Ro(["overlap"],((e,[t,n,r])=>Bo(`${t||""}`,`${n||""}`,r))),Ro(["validate","valid"],((e,[t,n,r])=>{const o=To(t,n,r);return"valid"===e?!0===o:o})),Ro(["inspect"],((e,[t,n])=>"schema"===n?uo(Yo(t)):Yo(t))),Ro(["diff"],((e,[t,n,r],o)=>{if(r&&Mn(r)){const e=r;r=(t,n)=>hn(o,e,[t,n])}return xo(t,n,r)})),Ro(["label-diff"],((e,[t,n,r])=>jo(t,n,r)))),bn(Ro(["+","add"],((e,t)=>{if(1===t.length)return Un(t[0])?+Sn(t[0]):t[0]?parseFloat(t[0]):0;if(Array.isArray(t[0]))return t[0].concat.apply(t[0],t.slice(1));if(Un(t[0])&&t.length>1&&t.slice(1).reduce(((e,t)=>e&&qn(t)),!0))return t.slice(1).reduce(((e,t)=>En(e,t,1)),Sn(t[0]));if("number"!=typeof t[0]&&t.length>1&&qn(t[0]))return t.slice(1).reduce(((e,t)=>function(e,t){if("number"==typeof e&&"number"==typeof t)return e+t;{const n={d:[]};if("number"==typeof e)n.d[6]=e;else if(Oe(e))n.d[6]=e.ms;else for(let t=0;t<7;t++)e.d[t]&&(n.d[t]=e.d[t]);if("number"==typeof t)n.d[6]=(n.d[6]||0)+t;else if(Oe(t))n.d[6]=(n.d[6]||0)+t.ms;else for(let e=0;e<7;e++)t.d[e]&&(n.d[e]=(n.d[e]||0)+t.d[e]);return n}}(e,t)),t[0]);if(t.reduce(((e,t)=>e&&"object"==typeof t&&!Un(t)),!0))return Object.assign.apply(Object,[{}].concat(t));return t.reduce(((e,t)=>e&&Zo(t)),!0)?t.reduce(((e,t)=>e+ +t),0):t.reduce(((e,t)=>e+(null==t?"":t)),"")})),Ro(["num"],((e,[t])=>{let n;return(n=Io.exec(t))?+n[1]:parseInt(t)})),Ro(["-","subtract"],((e,t)=>{const n=t.shift();if(Un(n)){if(t.reduce(((e,t)=>e&&Un(t)),!0))return t.reduce(((e,t)=>e-+Sn(t)),+Sn(n));if(t.reduce(((e,t)=>e&&qn(t)),!0))return t.reduce(((e,t)=>En(e,t,-1)),Sn(n))}return t.reduce(((e,t)=>e-(Zo(t)?+t:0)),Zo(n)?+n:0)})),Ro(["*","multiply"],((e,t)=>{const n=t.shift();if(!Zo(n)){if("string"==typeof n&&1===t.length&&Zo(t[0])&&+t[0]>0){let e="";for(let r=0;r<t[0];r++)e+=n;return e}return 0}return t.reduce(((e,t)=>e*(Zo(t)?+t:0)),+n)})),Ro(["/","/%","divide","intdiv"],((e,t)=>{const n=t.shift();return isNaN(n)?0:e.length>1||"intdiv"===e?t.reduce(((e,t)=>Math.floor(e/(isNaN(t)?1:+t))),+n):t.reduce(((e,t)=>e/(isNaN(t)?1:+t)),+n)})),Ro(["%","modulus"],((e,t)=>{const n=t.shift();return t.reduce(((e,t)=>e%(isNaN(t)?1:+t)),isNaN(n)?0:+n)})),Ro(["pow","**"],((e,t)=>{const n=t.pop(),r=Math.pow(t.pop(),n);return t.reverse().reduce(((e,t)=>Math.pow(t,e)),r)})),Ro(["abs"],((e,t)=>"number"!=typeof t[0]?t[0]:Math.abs(t[0]))),Ro(["round"],((e,t)=>Math.round(t[0]))),Ro(["floor"],((e,t)=>Math.floor(t[0]))),Ro(["ceil"],((e,t)=>Math.ceil(t[0]))),Ro(["rand","random"],((e,[t,n,r])=>{let o;return null==t?Math.random():("number"!=typeof n?o=Math.random()*t:"number"==typeof n&&(o=Math.random()*(n-t)+t),!0===n||!0===r?o:Math.round(o))})));const ei=/^\s*/,ti=/\s*$/,ni=/([\.\[\]\{\}\(\)\^\$\*\+\-])/g;function ri(e,t){if("string"==typeof e){const t=gt(e);t&&(e=t)}return jr(Un(e)?Fn(e):e,t)}function oi(e,t){const n=e.root._ranges||(e.root._ranges={});return t in n?n[t]:n[t]=yo(t)}bn(Ro(["eval"],((e,[t],n)=>dn(n,t))),Ro(["padl","padr"],((e,t)=>{let[n,r,o]=t;return Qo("padl"===e,n,r,o)})),Ro(["trim","triml","trimr"],((e,t)=>{let[n]=t;return n=""+n,"trim"!==e&&"trimr"!==e||(n=n.replace(ti,"")),"trim"!==e&&"triml"!==e||(n=n.replace(ei,"")),n})),Ro(["slice","substr"],((e,[t,n,r],o)=>{if(t&&"function"==typeof t.slice)return t.slice(n,r);{const e=vn("string");if(e)return`${e.apply("string",[t],o)}`.slice(n,r)}})),Ro(["len","length"],((e,[t])=>t&&"length"in t?t.length:0)),Ro(["replace","replace-all"],((e,[t,n,r,o])=>{t=`${t}`;const i="string"==typeof o;return"replace-all"===e||i?t.replace(new RegExp(i?n:n.replace(ni,"\\$1"),("replace"===e||o&&~o.indexOf("g")?o:`${o||""}g`)||"g"),r):t.replace(n,r)})),Ro(["reverse"],((e,[t])=>{if("string"==typeof t){let e="";for(let n=0;n<t.length;n++)e=t[n]+e;return e}if(Array.isArray(t))return t.reverse()})),Ro(["keys"],((e,[t,n])=>{if(!t)return[];if(n){const e=[];for(const n in t)e.push(n);return e}return Object.keys(t)})),Ro(["values"],((e,[t])=>t?Object.values(t):[])),Ro(["date"],((e,t,n)=>{let r,[o,i]=t,s=t.length>1&&t.slice(-1)[0]||{};if("object"!=typeof s&&(s={}),void 0!==o){if(Un(o))r=Sn(o);else if("string"==typeof o){let e=gt(o);if(Un(e))r=e;else if(e||(e=new Date(o)),isNaN(e)){let e=dn(n,~o.indexOf("#")?o:`#${o}#`);Un(e)&&(r=s.rel||s.parse?e:Sn(e))}}r||(r=new Date(o))}else r=new Date;if((s.rel||s.parse)&&Un(r)){let e=Fn(r);if("string"==typeof i&&(i=st(i)),Array.isArray(i)){const t=e.f;t[3]=i[0],t[4]=i[1],t[5]=i[2],t[6]=i[3],i=i[4]}if("number"==typeof i){if(s.shift){const t=(+e.f[7]||0)-i,n=Sn(e);n.setMinutes(n.getMinutes()-t),e=Fn(n)}e.f[7]=i,r=e}}else{const e=Un(r)?Sn(r):r;"y"in s&&!isNaN(s.y)&&e.setFullYear(s.y);const t=e.getFullYear();"m"in s&&!isNaN(s.m)&&(e.setMonth(+s.m-1),s.clamp&&e.getFullYear()!==t&&(e.setFullYear(t),e.setMonth(11)));const n=e.getMonth();if("d"in s&&!isNaN(s.d)&&(e.setDate(s.d),!s.clamp||e.getMonth()===n&&e.getFullYear()===t||(e.setDate(1),e.setFullYear(t),e.setMonth(n+1),e.setDate(0))),i){if(r===o)if("string"==typeof o){const e=gt(o);r=e&&Un(e)?Sn(e):new Date(o)}else r=new Date(o);if("string"==typeof i&&(i=st(i)),Array.isArray(i)){if(e.setHours(i[0]||0,i[1]||0,i[2]||0,i[3]||0),null!=i[4]){const t=-e.getTimezoneOffset()-i[4];e.setMinutes(e.getMinutes()+t)}}else if("number"==typeof i){const t=-e.getTimezoneOffset()-i;e.setMinutes(e.getMinutes()+t)}}r=e}return r})),Ro(["interval"],((e,[t],n)=>dn(n,~t.indexOf("#")?t:`#${t}#`))),Ro(["upper","lower"],((e,[t])=>(t=null==t?"":t,"upper"===e?`${t}`.toUpperCase():`${t}`.toLowerCase()))),Ro(["format","fmt"],((e,t)=>{let[n,r,...o]=t;const i=Xn[r];return i?i(n,o):`${n}`})),Ro(["parse"],((e,t)=>{let n=t.slice(-1)[0]||{};"object"!=typeof n&&(n={});const[r]=t;return n.date?gt(r,n):n.template||n.tpl?fn(r,n):n.time?st(r,n):n.expr?_t(r,n):n.schema?fo(r):n.range?yo(r,n):n.csv?(n.detect&&(n=Object.assign(_o(r),n)),function(e,t){const n=qo(Object.assign({},t,{header:!1}))(e);if("message"in n)return[];if(t.header&&n.length){const e=n.shift().map(((e,t)=>[e,t]));return e.sort(((e,t)=>e[0]<t[0]?-1:e[0]>t[0]?1:0)),n.map((t=>e.reduce(((e,n)=>(e[n[0]]=t[n[1]],e)),{})))}return n}(r,n)):Rt(r,n)})),Ro(["detect-delimiters"],((e,[t])=>"string"!=typeof t?{}:_o(t)))),bn({type:"checked",names:["and","&&"],checkArg:(e,t,n,r)=>r?"continue":{result:r},apply:(e,t)=>t[t.length-1]},{type:"checked",names:["or","||","??"],checkArg:(e,t,n,r)=>("??"===e?null!=r:r)?{result:r}:"continue",apply:e=>"??"===e&&void 0},{type:"checked",names:["if","unless"],checkArg:(e,t,n,r)=>t%2==0?t===n?{result:r}:("if"===e?!r:r)?{skip:1}:"continue":{result:r},apply(){}},{type:"checked",names:["case","switch"],checkArg(e,t,n,r,o,i){if(0===t)return(o.special||(o.special={})).case=r,"continue";if(t%2==1){if(t===n)return{result:r};if(Vo(r,o.special.case))return"continue";if(Dn(i)&&"op"in i&&!0===r)return"continue";if(Dn(r)){const e=mn(o,r);if(Vo(e,o.special.case))return"continue";if(!0===e)return"continue"}return{skip:1}}return{result:r}},apply(){},extend:!0},{type:"checked",names:["each"],checkArg:(e,t,n,r)=>0===t?Array.isArray(r)||"object"==typeof r?"continue":{skip:1}:1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply(e,[t,n],r){if(r=r||new Yn,Array.isArray(t)){const e=t.length-1;return t.map(((t,o)=>hn(Cn(r,{value:t,special:{last:e,index:o,key:o,"last-key":e}}),n,[t,o]))).join("")}{const e=Object.entries(t),o=e[e.length-1][0],i=e.length-1;return Object.entries(t).map((([e,t],s)=>hn(Cn(r,{value:t,special:{last:i,"last-key":o,index:s,key:e}}),n,[t,e]))).join("")}}},{type:"checked",names:["with"],checkArg:(e,t,n,r)=>0===t&&"object"==typeof r?"continue":1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply:(e,[t,n],r)=>hn(Cn(r=r||new Yn,{value:t}),n,[t])},{type:"checked",names:["coalesce","coalesce-truth"],checkArg:(e,t,n,r)=>"coalesce"===e&&null!=r||r?{result:r}:"continue",apply(){}}),bn({type:"aggregate",names:["avg"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+Wo(n[0]?hn(r,n[0],[t]):t)),0)/t.length},{type:"aggregate",names:["sum"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+Wo(n[0]?hn(r,n[0],[t]):t)),0)},{type:"aggregate",names:["count"],apply:(e,t,n,r)=>n.length?t.filter(((e,t)=>hn(r,n[0],[e,t]))).length:t.length},{type:"aggregate",names:["min","max"],apply:(e,t,n,r)=>(n[0]&&(t=t.map((e=>hn(r,n[0],[e])))),Math[e].apply(Math,t.filter((e=>!isNaN(e)))))},{type:"aggregate",names:["first","nth","last"],apply(e,t,n,r){let o,i=0;if("first"===e)o=t[0];else if("last"===e)o=t[t.length-1];else if(n[0]){const e=yn(r,n[0]);"number"==typeof e&&(o=t[e],i=1)}return n[i]&&(o=yn(r,n[i])),o}},{type:"aggregate",names:["map"],apply(e,t,n,r){if(!n[0])return t;let o,i,s;if(Mn(n[0])?(o=t,i=yn(r,n[0]),yn(r,s=n[1])):Mn(n[1])&&(o=yn(r,n[0]),i=yn(r,n[1]),s=yn(r,n[2])),(Array.isArray(o)||o&&"0"in o)&&Mn(i))return Array.prototype.map.call(o,((e,t)=>hn(r,i,[e,t],!1,{index:t,key:t})));if(o&&"object"==typeof o&&Mn(i)){if(s&&s.array)return Object.entries(o).map(((e,t)=>hn(r,i,[e[1],t,e[0]],!1,{index:t,key:e[0]})));if(s&&s.entries)return Object.entries(o).reduce(((e,t,n)=>{const o=hn(r,i,[t[1],n,t[0]],!1,{index:n,key:t[0]});return null===o||(Array.isArray(o)&&2===o.length&&"string"==typeof o[0]?e.push(o):e.push([t[0],o])),e}),[]);const e={};return Object.entries(o).forEach(((t,n)=>{const o=hn(r,i,[t[1],n,t[0]],!1,{index:n,key:t[0]});if(Array.isArray(o)&&2===o.length&&"string"==typeof o[0])e[o[0]]=o[1];else{if(null==o)return;e[t[0]]=o}})),e}}},{type:"aggregate",names:["reduce"],apply:(e,t,n,r)=>n[0]?t.reduce(((e,t,o)=>hn(r,n[0],[e,t,o])),yn(r,n[1])):t},{type:"aggregate",names:["unique","unique-map"],apply(e,t,n,r){const o=[],i=[];for(const e of t){const t=n[0]?hn(r,n[0],[e]):e;~o.indexOf(t)||(o.push(t),i.push(e))}return"unique"===e?i:o}},{type:"aggregate",names:["join"],apply:(e,t,n,r)=>n.length>1?t.map((e=>hn(r,n[0],[e]))).join(yn(r,n[1])):t.join(yn(r,n[0]))},{type:"aggregate",names:["find"],apply(e,t,n,r){if(n[0]){if(Mn(n[0]))return t.find(((e,t)=>hn(r,n[0],[e,t],!1,{index:t,key:t})));if(!Mn(n[1])){const e=yn(r,n[0]);return t.find((t=>t==e))}{const e=yn(r,n[0]);if(Array.isArray(e))return e.find(((e,t)=>hn(r,n[1],[e,t],!1,{index:t,key:t})));if("object"==typeof e&&e){const t=Object.entries(e).find(((e,t)=>hn(r,n[1],[e[1],t,e[0]],!1,{index:t,key:e[0]})));if(t)return t[1]}}}}},{type:"aggregate",names:["block"],apply(e,t,n,r){const o=n.length-1;if(o<0)return;const i=Cn(r,{locals:{}});for(let e=0;e<o;e++)yn(i,n[e]);return yn(i,n[o])},value:!0}),Tn("dollar",((e,[t,n,r])=>function(e,t,n=2,r=",",o="$",i="sign"){return null!=e&&br.test(e)?isNaN(+e)?void 0!==t?t:e:`${o}${vr(e,n,r,i)}`:void 0!==t?t:e}(e,void 0,t,n,r))),Tn("date",((e,[t])=>ri(e,t))),Tn("time",(e=>ri(e,"HH:mm:ss"))),Tn("timestamp",(e=>ri(e,"yyyy-MM-dd HH:mm:ss"))),Tn("timestamptz",(e=>ri(e,"yyyy-MM-dd HH:mm:sszzz"))),Tn("iso8601",(e=>ri(e,"yyyy-MM-ddTHH:mm:sszzz"))),Tn(["integer","int"],((e,[t,n])=>vr(e,0,t,n))),Tn(["number","num"],((e,[t,n,r])=>vr(e,t,n,r))),Tn("ordinal",((e,[t])=>Mr(e,null==t?",":t))),Tn("phone",(e=>{return"number"==typeof(t=e)&&(t=t.toString()),7===(t=(t=t||"").replace(/[^\d]/g,"")).length?`${t.substr(0,3)}-${t.substr(3,4)}`:10===t.length?`(${t.substr(0,3)}) ${t.substr(3,3)}-${t.substr(6,4)}`:11===t.length?`${t[0]}-${t.substr(1,3)}-${t.substr(4,3)}-${t.substr(7,4)}`:t;var t})),Tn("or",((e,[t])=>e||t)),Tn("padl",((e,[t,n])=>Qo(!0,e,t,n||"0"))),Tn("padr",((e,[t,n])=>Qo(!1,e,t,n||" "))),Tn("trim",(e=>e?`${e}`.trim():e));{const ii=/\s+/g,si=/[\s;,.:"]\w/g,ai=/[^a-zA-Z0-9]+([a-zA-Z0-9])/g,li=/[^\sa-zA-Z0-9]/g,ci=/([a-z])([A-Z])/g,ui=/\s([^\s])/g;function fi(e){return e.replace(ai,((e,t)=>t?` ${t}`:"")).replace(li,"").replace(ci,((e,t,n)=>`${t} ${n}`)).trim()}Tn("case",((e,t)=>{let n=`${e||""}`.trim();for(const e of t)if("upper"===e||"up"===e)n=n.toUpperCase();else if("lower"===e||"down"===e)n=n.toLowerCase();else if("snake"===e)n=fi(n).toLowerCase().replace(ii,"_");else if("kebab"===e)n=fi(n).toLowerCase().replace(ii,"-");else if("pascal"===e){const e=fi(n);n=e[0].toUpperCase()+e.toLowerCase().substr(1).replace(ui,((e,t)=>(t||"").toUpperCase()))}else if("camel"===e){const e=fi(n);n=e[0].toLowerCase()+e.toLowerCase().substr(1).replace(ui,((e,t)=>(t||"").toUpperCase()))}else"proper"===e&&(n=/[a-z]/.test(n)?n.trim().replace(si,(e=>e.toUpperCase())):n.toLowerCase().trim().replace(si,(e=>e.toUpperCase())),n=(n[0]||"").toUpperCase()+n.substr(1));return n}))}e.CSV_DEFAULTS=Fo,e.PageSizes={letter:{width:51,height:66,margin:[1.5,1.5]},legal:{width:51,height:84,margin:[1.5,1.5]},tabloid:{width:66,height:102,margin:[1.5,1.5]},a4:{width:49.606302,height:70.15746,margin:[1.5,1.5]}},e.Root=Yn,e.applySource=function(e,t,n){let r=n[t.source||t.name]||{value:[]};t.base&&(r={value:dn(Cn(e,{value:r.value,special:{source:r}}),t.base)}),t.filter||t.sort||t.group?e.sources[t.name||t.source]=xn(r,t.filter,t.sort,t.group,e):e.sources[t.name||t.source]=r},e.applySources=yr,e.checkType=So,e.deepEqual=Ao,e.detectCSV=_o,e.diff=xo,e.evalApply=hn,e.evalParse=yn,e.evalValue=mn,e.evaluate=dn,e.extend=Cn,e.filter=xn,e.getOperator=vn,e.getOperatorMap=function(){return Object.assign({},$n)},e.initParameters=hr,e.inspect=Yo,e.isComputed=Ln,e.isValueOrExpr=On,e.join=function(e,t){return{parent:e,root:e.root,path:e.path?`${e.path}.${t}`:t,value:pn(e,t)}},e.labelDiff=jo,e.overlap=Bo,e.parse=Rt,e.parseCSV=qo,e.parseDate=gt,e.parsePath=Ke,e.parseRange=yo,e.parseSchema=fo,e.parseTemplate=fn,e.parseTime=st,e.registerFormat=Tn,e.registerLayout=nr,e.registerOperator=bn,e.registerRenderer=Wn,e.run=function(e,t,n,r){const o=n&&"root"in n&&n.root===n?n:new Yn(Object.assign({},e.context),{parameters:n});if(e.sources&&yr(o,e.sources,t),o.parameters=Object.assign({},hr(e,t),o.parameters),e.extraContext){const t=dn(o,e.extraContext);t&&"object"==typeof t&&(o.value=Object.assign(o.value,t))}return"delimited"===e.type?function(e,t){const n=t.root.sources[e.source?e.source:e.sources[0].name||e.sources[0].source],r=Array.isArray(n.value)?n.value:"object"==typeof n.value&&"grouped"in n.value&&Array.isArray(n.value.all)?n.value.all:[n.value];let o=e.fields,i=e.headers;(!o||!o.length&&r.length)&&(o=Object.keys(r[0]),i&&i.length||(i=Object.keys(r[0]).map((e=>`'${e.replace(/'/g,"\\'")}'`))));let s="";if(i){const n=Cn(t,{parser:fn});s+=i.map((t=>`${e.quote||""}${dn(n,t)}${e.quote||""}`)).join(e.field||",")+(e.record||"\n")}const a=e.quote?new RegExp(e.quote,"g"):void 0;for(const n of r){const r=Cn(t,{value:n});s+=o.map((t=>{let n=t?`${dn(r,t)}`:"";return a&&(n=n.replace(a,e.quote+e.quote)),`${e.quote||""}${n}${e.quote||""}`})).join(e.field||",")+(e.record||"\n")}return s}(e,o):"flow"===e.type?function(e,t,n){const r={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};let o,i="",s=0,a=null;const l=e.size&&e.size.margin?cr(e.size,r,{x:0,y:0,availableX:o,maxX:o}):[1.5,1.5,1.5,1.5];e.width?o=e.width:e.size&&(o="portrait"!==e.orientation?e.size.height:e.size.width);o&&(o-=(l[1]||0)+(l[3]||0));function c(e,t){let n;i+=`<div${fr(r,t?[t]:[],["position:absolute;right:0rem;left:0rem;"+(o?`width:${o}rem;`:""),""],`top:${s}rem;`,"p")}>\n`;let l=0;do{if(n=er(e,r,{x:0,y:l,availableX:o,maxX:o},a),"string"==typeof n)throw new Error("Container widget didn't specify used height");i+=n.output,l+=n.height,a=n.continue?n.continue:null}while(null!==a);s+=l,i+="</div>\n"}e.watermark&&c(e.watermark,"watermark");let u=s||0;s=0;for(const t of e.widgets)c(t,"main");s>u&&(u=s);s=0,e.overlay&&c(e.overlay,"overlay");s>u&&(u=s);return`<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${o?` width: ${o}rem;`:""}; height: ${u}rem; position: relative; }\n    .page-back { ${o?`width: ${o}rem; `:""}height: ${u}rem; padding: ${l[0]||0}rem ${l[1]||0}rem ${l[2]||0}rem ${l[3]||0}rem; position: absolute; left: 0; top: 0; }\n    #wrapper { height:${u}rem; position: relative; ${e.font?dr(e.font,r):""} }\n    .watermark { z-index: 0; }\n    .main { z-index: 5; }\n    .overlay { z-index: 10; }\n    @media screen {\n      body { margin: 1rem${o?" auto":""}; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${l[0]}rem ${l[1]}rem ${l[2]}rem ${l[3]}rem !important; }\n      html { background-color: #999; }\n    }${Object.entries(r.styles).map((([e,t])=>t)).join("\n")}${Object.entries(r.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n<div class=page-back><div id=wrapper>${i}</div></div>${n&&n.foot||""}</body></html>`}(e,o,r):function(e,t,n){let r="portrait"!==e.orientation?{width:e.size.height,height:e.size.width,margin:[e.size.margin[1],e.size.margin[0]]}:e.size;const o={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};t.special=t.special||{},t.special.page=0,t.special.pages=0;const i=[""];let s=0,a=r.height-2*r.margin[0];const l=a;let c=a,u=0;const f=r.width-2*r.margin[1];let p=null,g=0;if(e.header){g=er(e.header,o,{x:0,y:0,availableX:f,availableY:a,maxX:f,maxY:c}).height,a-=g,c-=g,u+=g}let d=0;if(e.footer){d=er(e.footer,o,{x:0,y:0,availableX:f,availableY:a,maxX:f,maxY:c}).height,a-=d,c-=d}for(const t of e.widgets){let e;do{e=er(t,o,{x:0,y:u,availableX:f,availableY:a,maxX:f,maxY:c},p),i[s]+=e.output,e.continue?(s++,i[s]="",u=g,a=r.height-2*r.margin[0]-g-d,p=e.continue):(u+=e.height,a-=e.height,p=null)}while(null!==p)}t.special.pages=i.length;const h=r.height-2*r.margin[0]-d;return t.special.size={x:f,y:l},i.forEach(((n,r)=>{let s=`<div class="page-back pb${r}"><div${fr(o,["page",`ps${r}`],["",""],"","p")}>\n`;if(t.special.page=r+1,e.watermark){s+=er(e.watermark,o,{x:0,y:0,maxX:f,maxY:l}).output+"\n"}if(e.header){s+=er(e.header,o,{x:0,y:0,maxX:f,maxY:c}).output+"\n"}if(s+=n,e.footer){s+=er(e.footer,o,{x:0,y:h,maxX:f,maxY:c}).output+"\n"}if(e.overlay){s+=er(e.overlay,o,{x:0,y:0,maxX:f,maxY:l}).output+"\n"}s+="\n</div></div>",i[r]=s})),`<html style="font-size:100%;margin:0;padding:0;"><head><style>\n    .page { width: ${r.width-2*r.margin[1]}rem; height: ${r.height-2*r.margin[0]}rem; position: absolute; overflow: hidden; left: ${r.margin[1]}rem; top: ${r.margin[0]}rem; ${e.font?dr(e.font,o):""} }\n    .page-back { width: ${r.width}rem; height: ${r.height}rem; }\n    body { font-size: 0.83rem; }\n    @media screen {\n      html { min-width: ${r.width+2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { margin: 0; padding: 0; ${r?`width:${r.width}rem;`:""}background-color: none; display: block; height: ${i.length*r.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${i.map(((e,t)=>`.pb${t} { top: ${t*r.height}rem; }`)).join("")}\n    }\n    @page {\n      size: ${r.width}em ${r.height}em;\n    }${Object.entries(o.styles).map((([e,t])=>t)).join("\n")}${Object.entries(o.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n${i.reduce(((e,t)=>e+t),"")}${n&&n.foot||""}</body></html>`}(e,o,r)},e.safeGet=pn,e.similar=Ko,e.similarity=Go,e.stringify=Vr,e.template=function(e,t){let n,r;return"string"==typeof e?(n=new Yn,r=e):zn(e)?(n=e,r=t||""):e&&"object"==typeof e&&"context"in e&&zn(e.context)?(n=e.context,r=t||""):(n=new Yn,r=e),n=Cn(n,{parser:fn}),yn(n,r)},e.unparseSchema=uo,e.unregisterFormat=function(e){delete Xn[e]},e.unregisterOperator=function(...e){for(const t of e)for(const e of t.names)delete $n[e]},e.validate=To,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=raport.umd.min.js.map
