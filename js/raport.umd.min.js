!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Raport={})}(this,(function(e){"use strict";const t=[];let n=0;const r=[0,""],o=[0,""];function i(){return r}function a(){return r.slice()}function s(e,i,a,s){return r[0]=e,r[1]=i||"",r[2]=a,r[3]=s,1&n&&r[0]>=o[0]&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3]),t}function l(e,t){return{start:e,end:e,children:[],name:t}}function u(e,t,n){e.end=n[1],e.result=n[0],t&&t.children.push(e)}function c(e,t){let n=1;for(;~(t=e.lastIndexOf("\n",t))&&t;)n++,t--;return n}function f(e,t,n){const r=[],o=e[0];let i=o,a=i=t.lastIndexOf("\n",i),s=t.lastIndexOf("\n",i-1);for(let e=0;e<n&&~i;e++)r.unshift(t.substring(s+1,i)),i=s,s=t.lastIndexOf("\n",i-1);const l=r.length+1;s=a,i=t.indexOf("\n",s+1),-1===i&&s<t.length&&(i=t.length);for(let e=0;e<=n&&~i;e++)r.push(t.substring(s+1,i)),s=i,i=t.indexOf("\n",s+1),-1===i&&s<t.length&&(i=t.length);const u=r[l-1];let p="";const h=o-(~a?a:-1)-1;for(let e=0;e<h;e++)p+="\t"===u[e]?"\t":" ";return p+="^--",{context:r,column:o-a,line:c(t,o),position:o,source:u,message:e[1],marked:`${r.slice(0,l).join("\n")}\n${p}\n${r.slice(l).join("\n")}`,cause:e[2]&&f(e[2],t,n),causes:e[3]&&e[3].map((e=>f(e,t,n)))}}function p(e){let t=e;if(e[2]){const n=p(e[2]);n[0]>t[0]&&(t=n)}if(e[3])for(let n=0;n<e[3].length;n++){const r=p(e[3][n]);r[0]>t[0]&&(t=r)}return o[0]>=r[0]&&o[1]!==e[1]?o:t}const h=/^\s*/,g={};function d(e,t){let r;const a=t,c=t?(t.detailed?1:0)+(t.causes?2:0):0,d=t&&t.consumeAll;return function(t,m){const v=m&&"trim"in m?m.trim:a&&a.trim,b=v?h.exec(t)[0].length:0;v&&(e=g.map(g.seq(e,g.skip(" \t\r\n")),(([e])=>e)));const x=m?(m.detailed?1:0)+(m.causes?2:0):c;let w=[null,0];1&x&&(o[0]=0,o[1]="",o[2]=void 0,o[3]=void 0);const A=m&&"tree"in m&&m.tree&&l(0);if(x!==n){const o=n;n=x,w=(r||(r=y(e))).parse(t,b,w,A),n=o}else w=(r||(r=y(e))).parse(t,b,w,A);if(w.length&&(m&&"consumeAll"in m?m.consumeAll:d)&&w[1]<t.length&&(w=s(w[1],1&x&&`expected to consume all input, but only ${w[1]} chars consumed`)),w.length){if(A){if(u(A,null,w),v){const e=A.children[0].children[0];return e.result=w[0],e}return A}return w[0]}{const e=i(),n=(m&&"contextLines"in m?m.contextLines:a&&a.contextLines)||0,r=f($(e[3]||[],e),t,n),o=p(e);if(e!==o&&(r.latest=f(o,t,n)),m&&"throw"in m?m.throw:a&&a.throw){const e=new Error(r.message);throw Object.assign(e,r)}return r}}}const m={parse:(e,t)=>s(t,1&n&&"uninitialized lazy parser")};function y(e){return e.parser||e||m}function v(e,t){let n;return n={parse:(r,o,i,a)=>(e(),n.parse=t,t(r,o,i,a))},n}function b(e){let t="";const n=e.length;for(let r=0;r<n;r++)e[r]&&(t=t.concat(e[r]));return t}function $(e,t){let n,r=t[0];t[3]=e;const o=e||[];for(let e=0;e<o.length;e++)o[e][0]>r&&(n=o[e],r=n[0]);return n?[n[0],n[1],t]:t}function x(){return!1}function w(e,t){return e===t}function A(e,t){return e[0]===t||e[1]===t}function k(e,t){return e[0]===t||e[1]===t||e[2]===t}function j(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t}function M(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t}function D(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t}function X(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t}function Y(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t}function O(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t}function z(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t||e[9]===t}function C(e,t){const n=e.length;for(let r=0;r<n;r++)if(e[r]===t)return!0;return!1}function H(e,t){let n,r,o=e.length-1,i=0;if(t<e[0]||t>e[o])return!1;for(;i<=o;){if(n=i+o>>1,r=e[n],r===t)return!0;r<t?i=n+1:o=n-1}}function N(e,t=!0){const n=e.length;return 0===n?x:1===n?w:2===n?A:3===n?k:4===n?j:5===n?M:6===n?D:7===n?X:8===n?Y:9===n?O:10===n?z:t?H:C}function S(e){let t="";const n=e.split("").sort().join("");for(let e=0;e<n.length;e++)~t.indexOf(n[e])||(t+=n[e]);return t}function U(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(!r(n,e[i]))return i;return o}function T(e){const t=S(e),n=N(e);return{parse:(e,r,o)=>(o[1]=U(e,r,t,n),o)}}function q(e){const t=S(e),n=N(e);return{parse(e,r,o){const i=U(e,r,t,n);return o[0]=e.substring(r,i),o[1]=i,o}}}function F(e){const t=S(e),r=N(e);return{parse(o,i,a){const l=U(o,i,t,r);return l===i?s(i,1&n&&"expected one of "+e):(a[0]=o.substring(i,l),a[1]=l,a)}}}function E(e,t){const r=t&&S(t),o=N(r||"");return{parse(t,i,a){if(t.length-i>=e){const l=t.substr(i,e);if(r)for(let t=0;t<e;t++)if(!o(r,l[t]))return s(i+t,1&n&&"unexpected char");return a[0]=l,a[1]=i+e,a}return s(i,1&n&&"unexpected end of input")}}}function L(e,t){const r=S(e),o=N(e);return{parse(i,a,l){const u=function(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(r(n,e[i]))return i;return o}(i,a,r,o);return!t&&u>=i.length?s(u-1,1&n&&`expected one of '${e}' before end of input`):(l[0]=u?i.substring(a,u):"",l[1]=u,l)}}}function _(e,t){const r=L(e,t);return{parse(e,t,o){const i=r.parse(e,t,o);return i.length?i[1]>t?i:s(t,1&n&&"expected at least one character"):i}}}function I(...e){const t=e.length;if(1===t){const t=e[0],r=t.length;if(1===r)return{parse:(e,r,o)=>e[r]===t?(o[0]=t,o[1]=r+1,o):s(r,1&n&&"expected "+t)};if(2===r)return{parse:(e,r,o)=>e[r]===t[0]&&e[r+1]===t[1]?(o[0]=t,o[1]=r+2,o):s(r,1&n&&"expected "+t)};{let e,o;return{parse(i,a,l){for(e=0,o=a+e;e<r;e++,o++)if(t[e]!==i[o])return s(a,1&n&&"expected "+t);return l[0]=t,l[1]=a+r,l}}}}return{parse(r,o,i){e:for(let n=0;n<t;n++){const t=e[n],a=t.length;if(1!==a){for(let e=0;e<a;e++)if(t[e]!==r[o+e])continue e;return i[0]=t,i[1]=o+a,i}if(r[o]===t)return[t,o+a]}return s(o,1&n&&`expected ${e.length>1?"one of ":""}${e.map((e=>""+e)).join(", ")}`)}}}function R(...e){const t=e.slice(),r=F(t.map((e=>e.toLowerCase()+e.toUpperCase())).join("")),o=t.map((e=>e.toLowerCase()));return{parse(e,i,a){const l=r.parse(e,i,a);if(!l.length)return l;const u=o.indexOf(l[0].toLowerCase());return~u?(l[0]=t[u],l):s(i,1&n&&`expected ${t.length>1?"one of ":""}${t.map((e=>""+e)).join(", ")}`)}}}function J(e,t){let n;return v((()=>n=y(e)),(function(e,r,o,i){const a=i&&l(r,t),s=n.parse(e,r,o,a);return s.length?(a&&u(a,i,s),s):(o[0]=null,o[1]=r,o)}))}function P(e,...t){const r="string"==typeof e?e:void 0,o="string"==typeof e?t:(e?[e]:[]).concat(t);let i;const c=o.length;return v((()=>i=o.map(y)),(function(e,t,o,f){let p;const h=f&&l(t,r);for(let r=0;r<c;r++){const s=i[r].parse(e,t,o,h);if(s.length)return h&&u(h,f,s),s;2&n&&(p||(p=[])).push(a())}if(2&n){const e=$(p,[t,"expected "+(r||"alternate")]);return s(e[0],e[1],e[2],e[3])}return s(t,1&n&&"expected "+(r||"alternate"))}))}function Z(e,t,n){let r,o;const i=e=>o=e;return v((()=>r=y(e)),(function(e,a,c,f){const p=f&&l(a,n),h=r.parse(e,a,c,p);if(h.length){const e=o;o="",h[0]=t(h[0],i);const n=o;return o=e,n?s(a,n):(p&&u(p,f,h),h)}return h}))}function W(e,t){let n;return v((()=>n=y(e)),(function(e,r,o,i){if(i){const a=l(r,t),s=n.parse(e,r,o);return s.length&&(a.children.length?(a.children[0].name=t,i.children.push(a.children[0])):u(a,i,s)),s}return n.parse(e,r,o)}))}function B(e,t){let r;const o=[];return v((()=>r=y(e)),(function(e,i,s,c){const f=c&&l(i,t);let p,h,g=i;if(h=r.parse(e,g,s,f),!h.length)return s[0]=o,s[1]=g,2&n&&(s[2]=a()),s;for(g=h[1],p=[h[0]];;){if(h=r.parse(e,g,s,f),!h.length)return s[0]=p||[],s[1]=g,2&n&&(s[2]=a()),f&&u(f,c,s),s;p.push(h[0]),g=h[1]}}))}function G(e,t){let r;return v((()=>r=y(e)),(function(e,o,i,c){const f=c&&l(o,t);let p,h,g=o;if(h=r.parse(e,g,i,f),!h.length)return s(g,1&n&&"expected at least one "+(t||"item"),2&n&&a());for((p=[]).push(h[0]),g=h[1];;){if(h=r.parse(e,g,i,f),!h.length)return i[0]=p,i[1]=g,2&n&&(i[2]=a()),f&&u(f,c,i),i;p.push(h[0]),g=h[1]}}))}function V(e,t,r="disallow",o){let c,f;const p=[];return v((()=>(c=y(e),f=y(t))),(function(e,t,h,g){const d=g&&l(t,o);let m,y,v,b,$=t,x=t;if(v=c.parse(e,$,h,d),!v.length)return h[0]=p,h[1]=t,2&n&&(h[2]=a()),h;if(y=v[0],x=$,$=v[1],b=f.parse(e,$,h),!b.length)return"require"===r?s(x,1&n&&"expected separator"):(h[0]=[y],h[1]=$,d&&u(d,g,h),h);for($=b[1],m=[y];;){if(v=c.parse(e,$,h,d),!v.length){if("disallow"===r&&m&&m.length){if(2&n){const e=i();return s(e[0],e[1],[$,"unexpected separator"])}return s($,1&n&&"unexpected separator")}break}if(x=$,$=v[1],y=v[0],b=f.parse(e,$,h),!b.length){if("require"===r)return s(x,1&n&&"expected separator");m.push(y);break}$=b[1],m.push(y)}return h[0]=m,h[1]=$,2&n&&(h[2]=a()),d&&u(d,g,h),h}))}function K(e,t,r="disallow",o){let i,c;return v((()=>(i=y(e),c=y(t))),(function(e,t,f,p){const h=p&&l(t,o);let g,d,m=t,y=m;if(d=i.parse(e,m,f,h),!d.length)return s(m,1&n&&"expected at least one "+(o||"item"));{(g=[]).push(d[0]),y=m=d[1];const t=c.parse(e,m,f);if(t.length)for(m=t[1];;){if(d=i.parse(e,m,f,h),!d.length){if("disallow"===r&&g&&g.length)return f[0]=g,f[1]=y,h&&u(h,p,f),f;break}{g.push(d[0]),y=m=d[1];const t=c.parse(e,m,f);if(!t.length){if("require"===r)return s(m,1&n&&"expected separator");break}m=t[1]}}else if("require"===r)return s(m,1&n&&"expected separator")}return f[0]=g,f[1]=m,2&n&&(f[2]=a()),h&&u(h,p,f),f}))}function Q(e,t,o,i){const a="string"==typeof o?o:"string"==typeof i?i:void 0;if(Array.isArray(e)){let r,o;const i=e.length;return v((()=>(o=y(t),r=e.map(y))),(function(e,t,c,f){const p=f&&l(t,a);let h,g;for(let n=0;n<i;n++){if(r[n].parse(e,t,c).length){g=r[n];break}}if(!g)return s(t,1&n&&"expected opening bracket");const d=o.parse(e,c[1],c,p);if(!d.length)return d;2&n&&(h=d[2]);const m=d[0],y=d[1];return g.parse(e,y,c).length?(c[0]=m,p&&u(p,f,c),c):s(y,1&n&&"expected matching end bracket",2&n&&h)}))}if("string"!=typeof o){let i,s,c;return v((()=>(i=y(e),s=y(t),c=y(o))),(function(e,t,o,f){let p;const h=f&&l(t,a),g=i.parse(e,t,o);if(!g.length)return g;const d=s.parse(e,g[1],o,h);if(!d.length)return d;2&n&&d[2]&&(p=d[2]);const m=d[0],y=c.parse(e,d[1],o);return y.length?(o[0]=m,h&&u(h,f,o),o):(2&n&&p&&function(e){(r[3]||(r[3]=[])).push(e)}(p),y)}))}}function ee(...e){let t;const r=e.length;return v((()=>t=e.map(y)),(function(e,o,i,c){const f=c&&l(o);let p,h,g,d=o;if(g=t[0].parse(e,d,i,f),!g.length){if(2&n){const e=$(h,a());return s(e[0],e[1],e[2],e[3])}return g}2&n&&g[2]&&(h||(h=[])).push(g[2]),(p=[]).push(g[0]),d=g[1];for(let o=1;o<r;o++){if(g=t[o].parse(e,d,i,f),!g.length){if(2&n){const e=$(h,a());return s(e[0],e[1],e[2],e[3])}return g}2&n&&g[2]&&(h||(h=[])).push(g[2]),p.push(g[0]),d=g[1]}return i[0]=p,i[1]=d,2&n&&(i[2]=[o,"error in seq",null,h]),f&&u(f,c,i),i}))}function te(e,...t){let r,o;"string"!=typeof e?t.unshift(e):o=e;const i=t.length;return v((()=>r=t.map(y)),(function(e,t,c,f){const p=f&&l(t,o);let h,g,d=t;if(g=r[0].parse(e,d,c),!g.length){if(2&n){const e=$(h,a());return s(e[0],e[1],e[2],e[3])}return g}2&n&&g[2]&&(h||(h=[])).push(g[2]),d=g[1];for(let t=1;t<i;t++){if(g=r[t].parse(e,d,c),!g.length){if(2&n){const e=$(h,a());return s(e[0],e[1],e[2],e[3])}return g}2&n&&g[2]&&(h||(h=[])).push(g[2]),d=g[1]}return c[0]=null,c[1]=d,p&&u(p,f,c),c}))}g.skip=T,g.map=Z,g.seq=ee;const ne="abcdefABCDEF",re="0123456789",oe=ne+"abcdefABCDEFghijklmnopqrstuvwxyzGHIJKLMNOPQRSTUVWXYZ$_",ie=ne+re,ae={b:"\b",r:"\r",n:"\n","'":"'",'"':'"',t:"\t","\\":"\\"},se=/_/g,le=Z(ee(J(I("-","+")),F(re),q(re+"_"),J(I(".")),q(re+"_"),Z(J(ee(I("e","E"),J(I("+","-")),F(re+"_"))),(e=>e&&b(e)))),(e=>+b(e).replace(se,""))),ue=Z(ee(I("\\"),function(e,t){const r=S(t),o=N(r);return{parse(t,i,a){if(t.length-i>=e){const l=t.substr(i,e);for(let t=0;t<e;t++)if(o(r,l[t]))return s(i+t,1&n&&"unexpected char");return a[0]=l,a[1]=i+e,a}return s(i,1&n&&"unexpected end of input")}}}(1,"xu")),(e=>ae[e[1]]||e[1])),ce=Z(ee(I("\\u"),E(4,ie)),(e=>String.fromCharCode(parseInt(e[1],16)))),fe=Z(ee(I("\\x"),E(2,ie)),(e=>String.fromCharCode(parseInt(e[1],16)))),pe=P(Q(I('"'),Z(B(P("string part",_('"\\'),ce,fe,ue)),(e=>b(e))),I('"')),Q(I("'"),Z(B(P("string part",_("'\\"),ce,fe,ue)),(e=>b(e))),I("'"))),he=Z(I("true","false"),(e=>"true"===e)),ge=Z(I("null"),(()=>null)),de=Z(ee(F(oe),J(q(oe+re))),(([e,t])=>null!==t?e+t:e)),me=T(" \t\n\r"),ye={},ve={},be=P("value",pe,ye,ve,le,he,ge),$e=Z(ee(me,P("key",pe,de),te(me,I(":"),me),be),(e=>[e[1],e[3]]));ye.parser=Q(te(I("["),me),V(be,te(me,I(","),me),"allow"),te(me,I("]"))),ve.parser=Z(Q(te(I("{"),me),V($e,te(me,I(","),me),"allow"),te(me,I("}"))),(e=>{const t=e.length,n={};for(let r=0;r<t;r++){const t=e[r];n[t[0]]=t[1]}return n}));d(Z(ee(me,be,me),(e=>e[1])));const xe={y:0,m:0,w:0,d:864e5,h:36e5,mm:6e4,s:1e3};xe.w=7*xe.d,xe.y=Math.floor(365.25*xe.d),xe.m=Math.floor(30.45*xe.d);const we=" \r\n\t",Ae=" \r\n\t():{}[],\"'`\\;&#.",ke=function(e){const t=S(e),r=N(e);return{parse:(o,i,a)=>(a[1]=U(o,i,t,r),a[1]===i?s(i,1&n&&"expected at least one of "+JSON.stringify(e)):a)}}(we),je=Z(I("null","true","false","undefined"),(e=>{switch(e){case"null":return null;case"true":return!0;case"false":return!1;case"undefined":return}})),Me=_(Ae,!0),De={},Xe={},Ye={},Oe={},ze={},Ce={n:"\n",r:"\r",t:"\t",b:"\b"},He=Z(ee(I("\\"),E(1)),(([,e])=>Ce[e]||e)),Ne=Z(G(P("ref part",_(Ae+"=/",!0),He)),(e=>e.join(""))),Se=Z(ee(I("."),Ne),(([,e])=>e)),Ue=Q(ee(I("["),me),Oe,ee(me,I("]"))),Te=Z(ee(P("ref sigil",I("!","~","*"),ee(q("^"),J(I("@",".")))),P("keypath",Ne,Ue),B(P("keypath",Se,Ue))),(([e,t,n])=>{const r={k:[t].concat(n).map((e=>"object"!=typeof e||!("v"in e)||"string"!=typeof e.v&&"number"!=typeof e.v?e:e.v))};return Array.isArray(e)?(e[0]&&(r.u=e[0].length),"@"===e[1]&&(r.p="@")):e&&(r.p=e),r}),"keypath"),qe=d(Te),Fe=Z(Te,(e=>({r:e})),"reference");function Ee(e){const t=e.reduce(((e,t)=>(e.length&&"v"in t&&"v"in e[e.length-1]&&"string"==typeof t.v&&"string"==typeof e[e.length-1].v?e[e.length-1].v+=t.v:e.push(t),e)),[]);return t.length>0&&(!("v"in t[0])||"string"!=typeof t[0].v)&&t.unshift({v:""}),0===t.length?{v:""}:1===t.length?t[0]:{op:"+",args:t}}const Le=Z(K(ee(le,me,R("years","year","y","months","month","minutes","minute","milliseconds","millisecond","mm","ms","m","weeks","week","w","days","day","d","hours","hour","h","seconds","second","s")),me),(e=>{const t={y:0,m:0,d:0,h:0,mm:0,s:0,ms:0};for(let n=0;n<e.length;n++)"y"===e[n][2][0]?t.y+=e[n][0]:"m"===e[n][2]||"months"===e[n][2]||"month"===e[n][2]?t.m+=e[n][0]:"d"===e[n][2][0]?t.d+=e[n][0]:"w"===e[n][2][0]?t.d+=7*e[n][0]:"h"===e[n][2][0]?t.h+=e[n][0]:"s"===e[n][2][0]?t.s+=e[n][0]:"mm"===e[n][2]||"minutes"===e[n][2]||"minute"===e[n][2]?t.mm+=e[n][0]:"ms"!==e[n][2]&&"milliseconds"!==e[n][2]&&"millisecond"!==e[n][2]||(t.ms+=e[n][0]);if(t.y||t.m){const e=[];return t.y&&(e[0]=t.y),t.m&&(e[1]=t.m),t.d&&(e[2]=t.d),t.h&&(e[3]=t.h),t.mm&&(e[4]=t.mm),t.s&&(e[5]=t.s),t.ms&&(e[6]=t.ms),{d:e}}{delete t.y,delete t.m;let e=0;for(const n in t)e+=t[n]*(xe[n]||1);return e}}),"timespan"),_e=Z(ee(me,P("timezone",R("z"),ee(J(E(1,"+-")),F(re),J(ee(I(":"),E(2,re)))))),(e=>{if("z"===e[1][0])return 0;{let t=60*+e[1][1];return e[1][2]&&(t+=+e[1][2][1]),"-"===e[1][0]&&(t*=-1),t}})),Ie=P(Z(ee(F(re),J(ee(I(":"),E(2,re),J(ee(I(":"),E(2,re),J(ee(I("."),E(3,re)))))))),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=r&&e[1][2][2]&&e[1][2][2][1],i=[+t];return n&&(i[1]=+n),r&&(i[2]=+r),o&&(i[3]=+o),i})),Z(R("noon"),(()=>[12,0,0,0])),Z(R("midnight"),(()=>[0,0,0,0]))),Re=J(ee(me,I(">"))),Je=P("date",Z(ee(R("last","this","next"),ke,R("week","month","year"),J(ee(ke,R("to"),ke,R("date"))),Re),(([e,,t,n,r])=>({f:"w"===t[0]?"w":"m"===t[0]?"m":"y",o:"last"===e?-1:"this"===e?0:1,d:n?1:void 0,e:r?1:void 0}))),Z(ee(R("yesterday","today","tomorrow"),P(Q(me,R("at"),me),ke),Ie,me,J(_e)),(e=>{const t={f:"d",o:"yesterday"===e[1]?-1:"today"===e[1]?0:1,t:e[2]};return null!=e[4]&&(t.t[4]=e[4]),t})),Z(ee(R("yesterday","today","tomorrow","now"),Re),(([e,t])=>"now"===e?{f:"n",o:0}:{f:"d",o:"yesterday"===e?-1:"today"===e?0:1,e:t?1:void 0})),Z(ee(R("in"),ke,Le),(e=>"number"==typeof e[2]?{f:"n",o:e[2]}:{f:"n",o:e[2].d})),Z(ee(Le,ke,P("relative time anchor",R("ago"),ee(R("from"),ke,R("now")))),(([e,,t])=>"number"==typeof e?{f:"n",o:e*("ago"===t?-1:1)}:{f:"n",o:e.d,d:"ago"===t?-1:void 0})));function Pe(e,t,n){return null==n||(e[t]=n),e}const Ze=Z(ee(E(4,re),J(ee(E(1,"-/"),F(re),J(ee(E(1,"-/"),F(re))))),J(ee(P(Q(ke,R("at"),ke),R("t"),ke),Ie)),J(_e),Re),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=e[2]&&e[2][1],i=e[3]&&e[3][1],a=e[4]?1:void 0;return n?r?o?null!=i?new Date(Date.UTC(+t,+n-1,+r,o[0]+Math.floor(i/60),(o[1]||0)%60,o[2]||0,o[3]||0)):new Date(+t,+n-1,+r,o[0]||0,o[1]||0,o[2]||0,o[3]||0):{f:Pe([+t,+n-1,+r],7,i),e:a}:{f:Pe([+t,+n-1],7,i),e:a}:{f:Pe([+t],7,i),e:a}})),We=Q(I("#"),P("date",Ze,Je,Le),I("#")),Be=P("string",Z(ee(I(":"),_(Ae.replace(".",""),!0)),(e=>({v:e[1]}))),Z(Q(I('"'),B(P("string part",_('\\"'),ue,ce,fe)),I('"')),(e=>({v:"".concat(...e)}))),Z(Q(I("'"),B(P("string part",Z(_("'\\$",!0),(e=>({v:e}))),Z(I("\\$","$$"),(()=>({v:"$"}))),Q(I("${"),Oe,I("}")),Z(I("$"),(e=>({v:e}))),Z(ce,(e=>({v:e}))),Z(fe,(e=>({v:e}))),Z(ue,(e=>({v:e}))))),I("'")),Ee),Z(Q(I("`"),B(P("string part",Z(_("`\\$",!0),(e=>({v:e}))),Z(I("\\$","$$"),(()=>({v:"$"}))),Q(I("${"),Oe,I("}")),Z(I("$"),(e=>({v:e}))),Z(ce,(e=>({v:e}))),Z(fe,(e=>({v:e}))),Z(ue,(e=>({v:e}))))),I("`")),Ee)),Ge=Z(P("literal",le,je,We),(e=>({v:e}))),Ve=Z(Q(te(I("("),me),ee(Me,me,De),te(me,I(")"))),(([e,,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n}),"sexp");function Ke(e){return Q(ee(I("("),me),e,ee(me,I(")")))}const Qe={},et={},tt=Z(ee(W(F("abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789"),"op"),Ke(De)),(([e,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n}),"call"),nt=function(e){return Z(ee(e,J(ee(I("#"),Me,J(ee(I(","),K(Oe,I(","))))))),(([e,t])=>t?t[2]?{op:"fmt",args:[e,{v:t[1]},...t[2][1]]}:{op:"fmt",args:[e,{v:t[1]}]}:e))}(function(e){return Z(ee(e,B(P("keypath",Se,Ue))),(([e,t])=>t.length?{op:"get",args:[e,{v:{k:t}}]}:e))}(P("operand",Ke(et),function(e,t,n){let r;return v((()=>r=y(e)),(function(e,o,i,a){const c=a&&l(o,n),f=r.parse(e,o,i);if(!f.length)return f;const p=t(f[0]);return!0===p?(c&&u(c,a,f),f):s(f[1],p)}))}(Ke(Qe),(e=>"op"in e||"expected bracketed op")),Ve,ze))),rt=Z(ee(I("not ","+"),nt),(([e,t])=>({op:"+"===e?e:"not",args:[t]})),"unary");function ot(e,[,t,,n]){return{op:t,args:[e,n]}}const it=Z(ee(nt,B(ee(ke,W(I("**"),"exp op"),ke,nt))),(([e,t])=>t.length?function(e,t){if(1===t.length)return{op:t[0][1],args:[e,t[0][3]]};const n=t.pop();let r=t[t.length-1][1];const o={op:n[1],args:[t.pop()[3],n[3]]},i=t.reverse().reduce(((e,t)=>{const n={op:r,args:[t[3],e]};return r=t[1],n}),o);return{op:r,args:[e,i]}}(e,t):e)),at=Z(ee(it,B(ee(ke,W(I("*","/%","/","%"),"muldiv op"),ke,it))),(([e,t])=>t.length?t.reduce(ot,e):e)),st=Z(ee(at,B(ee(ke,W(I("+","-"),"addsub op"),ke,at))),(([e,t])=>t.length?t.reduce(ot,e):e)),lt=Z(ee(st,B(ee(ke,W(I(">=",">","<=","<","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain"),"cmp op"),ke,st))),(([e,t])=>t.length?t.reduce(ot,e):e)),ut=Z(ee(lt,B(ee(ke,W(I("is","is-not","==","!="),"eq op"),ke,lt))),(([e,t])=>t.length?t.reduce(ot,e):e)),ct=Z(ee(ut,B(ee(ke,W(I("and","&&"),"and op"),ke,ut))),(([e,t])=>t.length?t.reduce(ot,e):e)),ft=Z(ee(ct,B(ee(ke,W(I("or","||"),"or op"),ke,ct))),(([e,t])=>t.length?t.reduce(ot,e):e),"binop");Qe.parser=ft,et.parser=Z(ee(I("if"),ke,Oe,ke,I("then"),ke,Oe,B(ee(ke,I("else if","elseif","elsif","elif"),ke,Oe,ke,I("then"),ke,Oe)),J(ee(ke,I("else"),ke,Oe))),(([,,e,,,,t,n,r])=>{const o={op:"if",args:[e,t]};for(const[,,,e,,,,t]of n)o.args.push(e,t);return r&&o.args.push(r[3]),o}),"if");const pt=P("expression",et,Qe),ht=Z(ee(P("key",Be,Z(Me,(e=>({v:e})))),me,I(":"),me,Oe),(e=>[e[0],e[4]]),"pair");function gt(e){return e.filter((e=>!("v"in e[0]&&"v"in e[1]))).length?{op:"object",args:e.reduce(((e,t)=>(e.push(t[0],t[1]),e)),[])}:{v:e.reduce(((e,t)=>(e[t[0].v]=t[1].v,e)),{})}}Xe.parser=Z(Q(te(me,I("["),me),V(Oe,F(" \r\n\t,"),"allow"),te(me,I("]"))),(e=>e.filter((e=>!("v"in e))).length?{op:"array",args:e}:{v:e.map((e=>e.v))}),"array"),Ye.parser=Z(Q(te(me,I("{"),me),V(ht,F(" \r\n\t,"),"allow"),te(me,I("}"))),gt,"object"),Oe.parser=pt;const dt=Z(ee(Me,I(":"),me,Oe),(([e,,,t])=>[{v:e},t]),"named arg"),mt=Z(ee(I("=>"),me,Oe),(([,,e])=>({a:e})));De.parser=Z(V(P("argument",dt,Oe),F(" \r\n\t,"),"allow"),(e=>{const[t,n]=e.reduce(((e,t)=>(Array.isArray(t)?e[1].push(t):e[0].push(t),e)),[[],[]]);return n.length&&t.push(gt(n)),t}),"application"),ze.parser=P("expression",Xe,Ye,Ge,Be,mt,rt,tt,Fe);const yt=d(Oe,{trim:!0});function vt(e,t){if(!t)return e.value;const n="string"==typeof t?qe(t):t;if(!("error"in n)&&"k"in n){const t=n.k,r=n.p;let o=0,i=e,a=e.value;for(let e=0;e<n.u;e++)i&&(i=i.parent);if(a=i?i.value:void 0,r){if("!"===r)a=e.root.parameters;else if("~"===r)a=e.root.value;else if("*"===r)a=e.root.sources[t[o++]],a&&o<t.length+1&&"value"!==t[o]&&(a=a.value);else if("@"===r){const n=t[o++];if("value"!==n){for(;i&&(!i.special||!(n in i.special));)i=i.parent;a=i&&i.special[n],a&&"source"===n&&void 0!==t[o]&&"value"!==t[o]&&a.value&&(a=a.value),a||"date"!==n||(a=e.root.special.date=new Date)}}}else"_"===t[0]&&t.shift();for(let e=o;e<t.length;e++){const n=t[e];if("object"!=typeof n)a=a&&a[n];else{const e=$t(i,n);a=a&&a[e]}if(null==a)return}return a}}const bt={};function $t(e,t,n){let r,o,i=bt;return Mt(e)?(r=new Xt,o=e,arguments.length>1&&(i=t)):Dt(e)?(r=e,o=t,arguments.length>2&&(i=n)):e&&"context"in e&&Dt(e.context)?(r=e.context,o=t,arguments.length>2&&(i=n)):Mt(t)?(r=new Xt(e),o=t,arguments.length>2&&(i=n)):(r=new Xt,o=e,arguments.length>1&&(i=n)),"string"==typeof o&&(o=r.root.exprs[o]||(r.root.exprs[o]=(r.parser||yt)(o))),"object"!=typeof o&&(o={v:o}),o&&"r"in o?vt(r,o.r):o&&"v"in o?o.v:o&&"op"in o?jt(r,o):o&&"a"in o?i===bt?o.a:$t(Yt(r,{value:i}),o.a):void 0}const xt={};function wt(...e){for(const t of e)for(const e of t.names)xt[e]=t}function At(e,t,n,r,o){if(!e||!Array.isArray(e.value))return e;o=o?Yt(o,{special:{source:e.value}}):new Xt(e.value,{special:{source:e}});const i=t?[]:e.value.slice();if(t){let n="string"==typeof t?yt(t):t;"m"in n&&(n={v:!0}),e.value.forEach(((e,t)=>{$t(Yt(o,{value:e,special:{value:e,index:t}}),n)&&i.push(e)}))}const a=function(e,t){let n;if(Array.isArray(t))n=t;else{const r=$t(e,t);Array.isArray(r)?n=r:"string"==typeof r&&(n=[{v:r}])}if(n)for(let e=0;e<n.length;e++){const t=n[e];"string"==typeof t&&("-"===t[0]?n[e]={by:t.substr(1),desc:!0}:n[e]={by:"+"===t[0]?t.substr(1):t})}return n}(o,n);if(a&&a.length){const e=a.map((e=>"object"!=typeof e||!("by"in e)||("boolean"==typeof e.desc?e.desc:$t(o,e.desc))));i.sort(((t,n)=>{for(let r=0;r<a.length;r++){const i=a[r],s=e[r],l="string"==typeof i?i:"by"in i?i.by:i,u=$t(Yt(o,{value:t}),l),c=$t(Yt(o,{value:n}),l),f=null==u&&null!=c?-1:null!=u&&null==c?1:u<c==c<u?0:u<c?-1:u>c?1:0;if(f)return(s?-1:1)*f}return 0}))}return Array.isArray(r)||(r=$t(o,r)),Array.isArray(r)&&r.length?{value:{schema:e.schema,grouped:r.length,level:0,value:kt(i,r,o,1),all:i}}:{schema:e.schema,value:i}}function kt(e,t,n,r=0){const o={},i=[],a=[];for(const r of e){const e=""+$t(Yt(n,{value:r}),t[0]);o[e]||(a.push(e),o[e]=[]),o[e].push(r)}for(const e of a)i.push({group:e,grouped:t.length-1,value:t.length>1?kt(o[e],t.slice(1),n,r+1):o[e],all:o[e],level:r});return i}function jt(e,t){const n=xt[t.op];if(!n)return!0;let r;if("checked"===n.type){r=[];const o=t.args||[];for(let i=0;i<o.length;i++){const a=o[i],s=$t(e,a),l=n.checkArg(t.op,i,o.length-1,s,e);if("continue"===l)r.push(s);else if("skip"in l)i+=l.skip,"value"in l&&r.push(l.value);else if("result"in l)return l.result}return n.apply(t.op,r,e)}if("value"===n.type)return r=(t.args||[]).map((t=>$t(e,t))),n.apply(t.op,r,e);{let r;const o=(t.args||[]).slice(),i=$t(e,o[0]);if(Array.isArray(i)?(o.shift(),r=i):"object"==typeof i&&"value"in i&&Array.isArray(i.value)&&(o.shift(),r=i.value),!r){const t=$t(e,{r:"@source"});r=Array.isArray(t)?t:"object"==typeof t&&"value"in t&&Array.isArray(t.value)?t.values:[]}return n.apply(t.op,r,o,e)}}function Mt(e){return"string"==typeof e||"object"==typeof e&&e&&("r"in e&&"string"==typeof e.r||"op"in e&&"string"==typeof e.op||"v"in e||"a"in e)}function Dt(e){return"object"==typeof e&&"string"==typeof e.path&&"object"==typeof e.root&&"value"in e&&("object"==typeof e.parent||e.root===e)}class Xt{constructor(e={},t){this.root=this,this.parameters={},this.sources={},this.special={},this.exprs={},this.path="",this.value=e,t&&(Object.assign(this.parameters,t.parameters),Object.assign(this.special,t.special))}}function Yt(e,t){return{parent:e,root:e.root,path:"",value:"value"in t?t.value:e.value,special:t.special||{},parser:t.parser}}const Ot={};function zt(e,t){Ot[e]=t}function Ct(e){const t=[null,null];let n=new Date,r="d"in e&&e.d?new Date:void 0;if(n.setHours(0,0,0,0),e instanceof Date)return[e,e];if("n"===e.f)return n="number"==typeof e.o?new Date(+new Date+e.o):Ut(new Date,{d:e.o},1),[n,n];if("d"===e.f){if(n.setDate(n.getDate()+e.o),r||(r=new Date(n)),"t"in e){const o=e.t;if(null!=o[4]){const e=Math.floor(o[4]/60),t=o[4]%60;n.setUTCHours(o[0]+e,(o[1]||0)+t,o[2]||0,o[3]||0),r.setUTCHours(o[0]+e,(o[1]||59)+t,o[2]||59,o[3]||999)}else n.setHours(o[0],o[1]||0,o[2]||0,o[3]||0),r.setHours(o[0],null==o[1]?59:o[1],null==o[2]?59:o[2],null==o[3]?999:o[3]);return t[0]=n,t[1]=r,t}}else"w"===e.f?(n.setDate(n.getDate()-(n.getDay()+(-1===e.o?7:1===e.o?-7:0))),r||(r=new Date(n),r.setDate(n.getDate()+6))):"m"===e.f?(n.setDate(1),n.setMonth(n.getMonth()+e.o),r||(r=new Date(n),r.setMonth(n.getMonth()+1),r.setDate(0))):"y"===e.f&&(n.setDate(1),n.setMonth(0),n.setDate(1),r||(r=new Date(n),r.setFullYear(n.getFullYear()+1),r.setDate(0)));if(Array.isArray(e.f)){const t=e.f.slice();null!=t[7]?(n=new Date(Date.UTC(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)),t[7]&&n.setUTCHours(n.getUTCHours()+Math.floor(t[7]/60)),t[7]%60&&n.setUTCMinutes(n.getUTCMinutes()+t[7]%60)):n=new Date(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0);for(let e=1;e<7;e++)if(null==t[e]){t[e-1]++;break}null!=t[7]?(r=new Date(Date.UTC(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)),t[7]&&r.setUTCHours(r.getUTCHours()+Math.floor(t[7]/60)),t[7]%60&&r.setUTCMinutes(r.getUTCMinutes()+t[7]%60)):r=new Date(t[0],t[1]||0,t[2]||1,null==t[3]?23:t[3],null==t[4]?59:t[4],null==t[5]?59:t[5],null==t[6]?999:t[6]),r.setMilliseconds(-1)}else"d"in e&&e.d||r.setHours(23,59,59,999);return t[0]=n,t[1]=r,t}function Ht(e){return"object"==typeof e&&("f"in e&&(Array.isArray(e.f)||"o"in e)||e instanceof Date)}function Nt(e){const t=Ct(e);return"e"in e&&null!=e.e?t[1]:t[0]}function St(e){return"number"==typeof e||"object"==typeof e&&Array.isArray(e.d)}function Ut(e,t,n){if("number"==typeof t)return new Date(+e+t*n);{let r=new Date(e);return t.d[0]&&r.setFullYear(r.getFullYear()+t.d[0]*n),t.d[1]&&r.setMonth(r.getMonth()+t.d[1]*n),t.d[2]&&r.setDate(r.getDate()+t.d[2]*n),t.d[3]&&r.setHours(r.getHours()+t.d[3]*n),t.d[4]&&r.setMinutes(r.getMinutes()+t.d[4]*n),t.d[5]&&r.setSeconds(r.getSeconds()+t.d[5]*n),t.d[6]&&r.setMilliseconds(r.getMilliseconds()+t.d[6]*n),r}}function Tt(e,t,n){e.styles[t]||(e.styles[t]=n)}function qt(e,t){return{report:e.report,context:Yt(e.context,t),styles:e.styles,styleMap:e.styleMap}}const Ft=/\>\<\&/g,Et={"<":"&lt;",">":"&gt;","&":"&amp;"};function Lt(e){return e.replace(Ft,(e=>Et[e]||""))}const _t={};function It(e,t,n){_t[e]="function"==typeof t?{render:t}:t,n&&Object.assign(_t[e],n)}const Rt=7.4,Jt=6.7,Pt=7.85,Zt=5.9;let Wt=function(e,t,n){const r=n&&n.family||"sans",o=n&&n.size||.83,i=n&&n.line||1,a=("mono"===r||/fixed|mono/i.test(r)?Pt:"narrow"===r||/narrow|condensed/i.test(r)?Zt:"sans"===r||/sans/i.test(r)?Rt:Jt)*o/16;return e.split(/\r?\n/g).reduce(((e,n)=>{const[r,o]=n.split(/\s/g).reduce(((e,n)=>{const r=(n.length+1)*a;return e[0]+r>t?(e[0]=r,e[1]++):e[0]+=r,e}),[0,0]);return e+(o+(r>0?1:0)||1)}),0)*i};function Bt(e,t,n,r){const o=_t[e.type];if(!o||e.hide&&$t(t,e.hide))return{output:""};!("height"in e)&&o.container&&(e.height="auto");const i=tn(e,n);if(n.maxY&&!isNaN(i)&&i>n.maxY)return Tt(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2};if(n.availableY&&i>n.availableY)return{output:"",continue:{offset:0},cancel:!0};let a=0;if(e.margin){const t=on(e);a+=t[0]+t[2],n.availableX&&(n.availableX-=t[1]+t[3]),n.availableY&&(n.availableY-=t[0]+t[2])}const s=o.render(e,t,n,r);return"string"==typeof s?{output:s,height:i,width:Qt(e,n)}:n.maxY&&s.height>n.maxY?(Tt(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2}):isNaN(i)&&n.availableY&&s.height>n.availableY?{output:"",continue:{offset:0},height:s.height,cancel:!0}:(s.height+=a,s)}const Gt={};function Vt(e,t){Gt[e]=t}function Kt(e,t){const n=e.width;return n?"number"==typeof n?n:+(n.percent/100*(t.maxX||51)).toFixed(4):t.maxX||51}function Qt(e,t){let n=Kt(e,t);if(e.margin){const t=on(e);n+=t[1]+t[3]}else e.font&&e.font.right&&(n+=e.font.right);return n}function en(e,t,n){let r=1;if("number"==typeof e.height)r=e.height;else if("object"==typeof e.height&&e.height.percent&&t.availableY)r=+(t.availableY*(e.height.percent/100)).toFixed(4);else if("auto"===e.height||n&&!e.height)return n||NaN;return r}function tn(e,t,n){let r=en(e,t,n);if(e.margin){const t=on(e);r+=t[0]+t[2]}return r}function nn(e){return e.reduce(((e,t)=>e>t[1]+t[3]?e:t[1]+t[3]),0)}function rn(e){return e.reduce(((e,t)=>e>t[0]+t[2]?e:t[0]+t[2]),0)}function on(e){if(e.margin){const t=e.margin;if(Array.isArray(t)){if(4===t.length)return t.map((e=>+e));if(2===t.length)return[+t[0],+t[1],+t[0],+t[1]]}else if("number"==typeof t)return[t,t,t,t]}return[0,0,0,0]}function an(e,t,n){if(!t)return"";const r=e.styleMap.styles[t];if(r)return r;const o=`${n}${function(e,t){return e.styleMap.ids[t]||(e.styleMap.ids[t]=0),e.styleMap.ids[t]++}(e,n)}`;return e.styleMap.styles[t]=o}function sn(e,t,[n,r],o,i){if(e.report.classifyStyles){const a=[];return r&&a.push(an(e,r,"h")),a.push(an(e,n,i||"s")),` class="${t.concat(a).join(" ")}"${o?` style="${o}"`:""}`}{const e=`${n}${o||""}${r||""}`;return`${""+(t.length?` class="${t.join(" ")}"`:"")}${e?` style="${e}"`:""}`}}function ln(e,t,n,r){let o=`left:${t.x||0}rem;top:${t.y||0}rem;`,i="";e.width?"number"!=typeof e.width&&"percent"in e.width?o+=`width:${e.width.percent}%;`:o+=`width:${Qt(e,t)}rem;`:o+=`right:${(e.margin||{})[1]||0}rem;`;const a=tn(e,t,r&&r.computedHeight)||1;if(r&&r.container&&r.computedHeight?i=`height:${a}rem;`:o+=`height:${a}rem;`,e.font&&0===e.font.line?o+="line-height: initial;":o+=""+(!r||!r.container||e.font&&e.font.line?`line-height:${e.font&&e.font.line||en(e,t,r&&r.computedHeight)}rem;`:""),e.margin){const t=on(e);(t[0]||t[1]||t[2]||t[3])&&(o+=`padding: ${t[0]}rem ${t[1]}rem ${t[2]}rem ${t[3]}rem;`)}else e.font&&e.font.right&&(o+=`padding-right:${e.font.right}rem;`);return(r&&r.font||e.font)&&(o+=un(r&&r.font||e.font)),e.border&&(o+=function(e,t){("string"==typeof e||"object"==typeof e&&("v"in e||"r"in e||"op"in e))&&(e=$t(t,e));if("number"==typeof e)return`border-bottom:${.0625*e}rem solid;`;if(function(e){return"object"==typeof e&&("top"in e||"bottom"in e||"left"in e||"right"in e)}(e))return`border-style:solid;border-width:${.0625*(e.top||0)}rem ${.0625*(e.right||0)}rem ${.0625*(e.bottom||0)}rem ${.0625*(e.left||0)}rem;`;if(Array.isArray(e)){if(1===e.length)return`border:${.0625*(+e[0]||0)}rem solid;`;if(2===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(3===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(4===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[3]||0)}rem;`}}(e.border,n)),[o,i]}function un(e){let t="";return e.family&&(t+=`font-family:${e.family};`),e.color&&(t+=`color:${e.color};`),e.align&&(t+=`text-align:${e.align};`),e.size&&(t+=`font-size:${e.size}rem;`),e.weight&&(t+=`font-weight:${e.weight};`),e.pre&&(t+="white-space:pre-wrap;"),e.clamp&&(t+="white-space:nowrap;overflow:hidden;"),t}Vt("row",((e,t,n,r,o)=>{let i;const a=Qt(e,r);return e.br||r.availableX&&o[0][0]+o[0][2]+a>r.availableX?i={x:n[3],y:nn(o),availableX:r.availableX&&r.availableX-n[3],maxX:r.maxX}:(i={x:o[0][0]+o[0][2],y:o[0][1],maxX:r.maxX},r.availableX&&(i.availableX=r.availableX-(o[0][0]+o[0][2])-a)),i.y-=t,r.availableY&&(i.availableY=r.availableY-o[0][1]),i}));function cn(e,t,n){let r=n[t.source||t.name]||{value:[]};t.base&&(r={value:$t(Yt(e,{value:r.value,special:{source:r}}),t.base)}),t.filter||t.sort||t.group?e.sources[t.name||t.source]=At(r,t.filter,t.sort,t.group,e):e.sources[t.name||t.source]=r}const fn=P(Z(I("\\{{"),(()=>"{{")),Z(ee(I("\\"),E(1)),(([,e])=>e))),pn=Z(G(P(_("\\{",!0),fn,function(e,t,r){let o,i;return v((()=>(o=y(e),i=y(t))),(function(e,t,a,c){const f=c&&l(t,r),p=o.parse(e,t,a,f);if(!p.length)return p;const h=p[1];return i.parse(e,h,a).length?s(h,1&n&&"unexpected "+e.slice(h,p[1])):(f&&u(f,c,p),p)}))}(I("{"),I("{")))),(e=>({v:e.join("")})),"text");function hn(e){return Z(ee(I("{{"),me,I(...e),ke,Oe,me,I("}}")),(e=>[e[2],e[4]]),"tag")}const gn=W(te(ee(I("{{/"),L("}"),I("}}"))),"tag end"),dn={};function mn(e,t){return t?Z(hn(e),(([e,t])=>({name:e,value:t}))):Z(ee(I("{{"),me,I(...e),me,I("}}")),(([,,e])=>({name:e})),"tag")}function yn(e){return Z(e,(e=>e.length<1?[{v:""}]:e))}const vn=mn(["else"]),bn=mn(["else if","elseif","elsif","elif"],!0),$n=Z(ee(hn(["each"]),yn(B(P(bn,vn,dn))),gn),(([e,t])=>({op:"each",args:[e[1]].concat(jn(Mn(t)))}))),xn=Z(ee(hn(["if"]),yn(B(P(bn,vn,dn))),gn),(([e,t])=>({op:"if",args:[e[1]].concat(Mn(t))}))),wn=Z(ee(hn(["with"]),yn(B(P(vn,dn))),gn),(([e,t])=>({op:"with",args:[e[1]].concat(jn(Mn(t)))}))),An=Z(ee(hn(["unless"]),yn(B(dn)),gn),(([e,t])=>({op:"unless",args:[e[1]].concat(Dn(t))}))),kn=Z(ee(I("{{"),me,Oe,me,I("}}")),(([,,e])=>({op:"string",args:[e]})),"interpolator");function jn(e){return e.length&&(e[0]={a:e[0]}),e}function Mn(e){const t=[];let n=[],r=!1;for(let o=0;o<e.length;o++){const i=e[o];"name"in i?(r=!0,n.length?t.push(Dn(n)):t.push({v:""}),i.value&&t.push(i.value),n=[]):n.push(i)}return n.length?t.push(Dn(n)):r&&t.push({v:""}),t.length%2&&t.push({v:""}),t}function Dn(e){return 1===e.length?e[0]:{op:"+",args:e}}dn.parser=P("content",pn,$n,xn,wn,An,kn);const Xn=d(P(Z(G(dn),(e=>Dn(e))),Z(me,(()=>({v:""})))),{trim:!0});It("label",((e,t,n)=>{Tt(t,"label",".label { position: absolute; box-sizing: border-box; }");const r=(Array.isArray(e.text)?e.text:[e.text]).map((n=>{let r=$t(t,"object"==typeof n&&"text"in n?n.text:n);if(e.id){let n=t.context;for(;n;)n.special&&n.special.values&&(n.special.values[e.id]||(n.special.values[e.id]=[])).push(r),n=n.parent}return e.format&&e.format.name&&(r=$t(t,{op:"format",args:[r,`'${e.format.name}'`].concat(e.format.args||[])})),"object"==typeof n&&"text"in n?`<span${sn(t,[],[un(n.font),""])}>${r}</span>`:r})).join("");return`<span${sn(t,["label"],ln(e,n,t))}>${Lt(r)}</span>`})),It("container",((e,t,n,r)=>{let o;Tt(t,"container",".container { position: absolute; box-sizing: border-box; }"),e.height?"number"==typeof e.height&&(o=tn(e,n)):e.height="auto";const i=e.context?qt(t,{value:$t(t,e.context)}):t,a=Kt(e,n)||n.availableX,s=function(e,t,n,r,o){if(Array.isArray(e.widgets)){let i="";const a=(r||{offset:0}).offset,s=[[0,a,0,0]],l=on(e);s[0][0]+=l[3],s[0][1]+=l[0];for(let u=r&&r.state&&r.state.last||0;u<e.widgets.length;u++){const c=e.widgets[u];if(c.hide&&$t(t,c.hide))continue;let f=n&&tn(c,n);if(f>n.maxY&&(f=1),n&&n.availableY&&f>n.availableY)return(r=r||{offset:nn(s)}).last=u,{output:i,continue:r,height:f+s.map((([e,t])=>e+t)).reduce(((e,t)=>t>e?t:e),0)};{const e=Array.isArray(o)&&o[u];let f=Array.isArray(e)?{x:e[0]+l[3],y:e[1]+l[0],maxX:n.maxX}:e||n;o&&"string"!=typeof o||(f=(o&&Gt[o]||Gt.row)(c,a,l,n,s)),f.maxX=f.maxX||n.maxX,f.maxY=f.maxY||n.maxY;const{x:p,y:h}=f,g=Bt(c,t,f,r&&r.child);if("string"==typeof g&&!g||!g.cancel&&!g.output&&!g.height)continue;if("string"==typeof g)i+=g,s.unshift([p,h,Qt(c,n),tn(c,n)]);else{if(g.cancel&&!s.length)return{output:"",cancel:!0};if(i+=g.output,s.unshift([p,h,g.width||Qt(c,n),g.height||tn(c,n)]),g.continue)return(r=r||{offset:0}).child=g.continue,r.last=u,r.offset=nn(s),{output:i,continue:r,height:nn(s),width:rn(s)}}}}return{output:i,height:tn(e,n)||nn(s)-l[0],width:Qt(e,n)||rn(s)-l[3]}}return{output:""}}(e,i,{x:0,y:0,availableX:a,availableY:o||n.availableY,maxX:a,maxY:n.maxY},r,e.layout);return s.cancel||(s.output=`<div${sn(t,["container"],ln(e,n,t,{computedHeight:o||s.height,container:!0}))}>${s.output}</div>`,s.height=o||s.height,s.width=a||s.width),s}),{container:!0}),It("repeater",((e,t,n,r)=>{Tt(t,"container",".container { position: absolute; box-sizing: border-box; }"),e.height||(e.height="auto");let o,i=n.availableY,a=n.availableX,s="",l=!1;const u=on(e);let c,f=r&&r.state&&"header"!==r.state.part?0:u[0];i-=f;let p,h=!1,g=r&&r.state&&r.state.src;if(!g){if(!e.source)return"";g=Mt(e.source)?$t(t,e.source):At(t.context.root.sources[e.source.source]||{value:[]},e.source.filter,e.source.sort,e.source.group,t.context).value,(t.context.special||(t.context.special={})).values||(t.context.special.values={})}if(Array.isArray(g))p=g;else{if(!g||!Array.isArray(g.value))return{output:"",height:0};c=g,p=c.value,e.group&&(h=e.group.length>c.grouped&&e.group.length-c.grouped-1)}if(c&&(!r||!r.state||"group"===r.state.part)&&(!1!==h&&(o=Bt(e.group[h],qt(t,{value:c,special:{group:c.group,level:c&&c.level}}),{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY})),o)){if(o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"group",src:g,current:0}}};i-=o.height,s+=o.output,f+=o.height}if(e.header&&(r&&r.state&&"body"===r.state.part&&!1!==e.headerPerPage&&(!c||!c.grouped)||(!c||!c.grouped)&&(!r||!r.state||"header"===r.state.part||"group"===r.state.part))){if(o=Bt(e.header,t,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"header",src:g,current:0}}};i-=o.height,s+=o.output,f+=o.height}let d=r&&r.state&&r.state.context||qt(t,{special:{level:c&&c.level,group:c&&c.group,values:{}}});if(!r||!r.state||"footer"!==r.state.part){let u=0,h=0;for(let m=r&&r.state&&r.state.current||0;m<p.length;m++){const y=c&&c.grouped?qt(d,{value:p[m],special:{index:m,values:{}}}):qt(d,{value:p[m],special:{index:m}});if(c&&c.grouped){const t=r&&r.child||{offset:0,state:{current:0,src:p[m],part:"group"}};o=Bt(e,y,{x:0,y:f,availableX:a-u,availableY:i,maxX:n.maxX,maxY:n.maxY},t)}else o=Bt(e.row,y,{x:u,y:f,availableX:a-u,maxX:n.maxX,availableY:i,maxY:n.maxY});if(r&&(r.child=null),o.width&&o.width<=a-u&&o.width!==a)u+=o.width,o.height>h&&(h=o.height);else if(o.width&&u&&o.width>a-u){f+=h,i-=h,h=0,u=0,m--;continue}if(o.height>i||o.cancel)return l?{output:`<div${sn(t,["container","repeat"],ln(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"body",src:g,current:m,context:d}}}:{output:"",height:f,continue:{offset:f,state:{part:r.state.part,src:g,current:m,context:d}}};if(h||(i-=o.height),h||(f+=o.height),s+=o.output,l=!0,c&&o.continue)return{output:`<div${sn(t,["container","repeat"],ln(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"body",src:g,current:m,context:d},child:o.continue}}}}if(e.footer){const a=d&&d.context||r&&r.state&&r.state.context&&r.state.context.context,l=qt(t,{special:{source:c&&c.grouped?c.all:p,level:c&&c.level,grouped:c&&c.grouped,values:(a&&a.special||{}).values}});if(o=c?e.groupEnds&&e.groupEnds[c.grouped]?Bt(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}):{output:"",height:0}:Bt(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:`<div${sn(t,["container","repeat"],ln(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"footer",src:g,current:0,context:d}}};s+=o.output,f+=o.height}return{output:`<div${sn(t,["container","repeat"],ln(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f}}),{container:!0}),It("image",((e,t,n)=>(Tt(t,"image",".image { position: absolute; }"),`<img src="${$t(t,e.url)}"${sn(t,["image"],ln(e,n,t))} />`))),It("measured",((e,t,n,r)=>{const o=$t(t,e.text),i=Wt(o,Kt(e,n)||n.availableX,e.font);if(!r&&i>n.availableY)return{output:"",height:0,continue:{state:{},offset:0}};{let r=ln(e,n,t,{computedHeight:i,container:!0});return r[0]=`display:inline-block;white-space:pre-wrap;line-height:${e.font&&e.font.line||e.font&&e.font.size||1}rem;`+r[0],{height:i,output:`<span${sn(t,["label"],r)}>${Lt(o)}</span>`}}})),It("html",((e,t,n)=>{Tt(t,"html",".html {position:absolute;box-sizing:border-box;overflow:hidden;line-height:1rem;}");const r=$t(qt(t,{parser:Xn}),e.html);return`<div${sn(t,["html"],ln(e,n,t,{container:!0}))}>${r}</div>`}));const Yn=/(\d)(?=(\d{3})+\.)/g,On=/(\d)(?=(\d{3})+$)/g,zn=/^[-0-9\\.,]+$/;function Cn(e,t=2){return e="number"!=typeof e?parseFloat(e||""):e,isNaN(e)?"":(e=e.toFixed(t),0===t&&(e=e.replace(/\..*/,"")),e.replace(-1===e.indexOf(".")?On:Yn,"$1,"))}const Hn=/y+|M+|d+|E+|H+|m+|s+|k+|h+|a+/g,Nn=["January","February","March","April","May","June","July","August","September","October","November","December"],Sn=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let Un;function Tn(e,t){if(!e)return"";if("string"==typeof e)e=new Date(e);else if("[object Date]"!==Object.prototype.toString.call(e))return"";const n=e;return t||(t=Un),t?t.replace(Hn,(e=>{if("y"===e[0])return e.length<=2?(""+n.getFullYear()).substr(2,2):""+n.getFullYear();if("M"===e[0])return 1===e.length?""+(n.getMonth()+1):2===e.length?n.getMonth()<9?"0"+(n.getMonth()+1):""+(n.getMonth()+1):3===e.length?Nn[n.getMonth()].substr(0,3):Nn[n.getMonth()];if("d"===e[0])return 1===e.length?""+n.getDate():n.getDate()<=9?"0"+n.getDate():""+n.getDate();if("E"===e[0])return 1===e.length?""+(n.getDay()+1):2===e.length?Sn[n.getDay()].substr(0,3):Sn[n.getDay()];if("H"===e[0])return 1===e.length?""+n.getHours():n.getHours()<=9?"0"+n.getHours():""+n.getHours();if("m"===e[0])return 1===e.length?""+n.getMinutes():n.getMinutes()<=9?"0"+n.getMinutes():""+n.getMinutes();if("s"===e[0])return 1===e.length?""+n.getSeconds():n.getSeconds()<=9?"0"+n.getSeconds():""+n.getSeconds();if("k"===e[0]||"h"===e[0]){let e=""+n.getHours()%12;return"0"===e&&(e="12"),""+e}return"a"===e[0]?n.getHours()>11?"PM":"AM":void 0})):new Date(+e-6e4*e.getTimezoneOffset()).toISOString().substr(0,10)}function qn(e,t){return{type:"value",names:e,apply:t}}Tn.setDefault=function(e){Un=e};const Fn=/^\s*$/;function En(e){return!isNaN(e)&&!Fn.test(e)}function Ln(e){return isNaN(e)||!e?0:+e}wt(qn(["is","is-not","==","!="],((e,t)=>{const[n,r]=t,o=n==r;return"is"===e||"=="===e?o:!o})),qn(["not"],((e,t)=>!t[0])),qn(["<",">","<=",">="],((e,t)=>{let[n,r]=t;return n instanceof Date||r instanceof Date?"number"==typeof n||"number"==typeof r?(n=+n,r=+r):"string"==typeof n||"string"==typeof r?(n=new Date(n),r=new Date(r)):"f"in n&&"o"in n?(n=Ct(n)["<"===e[0]?1:0],r=new Date(r)):"f"in r&&"o"in r&&(r=Ct(r)["<"===e||">="===e?0:1],n=new Date(n)):Ht(n)?(n=Ct(n)["<"===e[0]?1:0],r=Ht(r)?Ct(r)["<"===e||">="===e?0:1]:new Date(r)):Ht(r)&&(r=Ct(r)["<"===e||">="===e?0:1],n=new Date(n)),"<"===e?n<r:">"===e?n>r:"<="===e?n<=r:">="===e&&n>=r})),qn(["like","not-like","ilike","not-ilike"],((e,t)=>{const[n,r,o]=t;if("string"!=typeof r)return!1;let i;const a=new RegExp(`${"free"===o?"":"^"}${r.replace(/[\s\%\*]+/g,".*").replace(/\?/g,".")}${"free"===o?"":"$"}`,~e.indexOf("ilike")?"i":"");return i=Array.isArray(n)?!!n.find((e=>a.test(e))):a.test(n),"like"===e||"ilike"===e?i:!i})),qn(["in","not-in"],((e,t)=>{const[n,r]=t;if(Ht(r)){const t=Ct(r),o=Ht(n)?Ct(n)[0]:new Date(n),i=o>=t[0]&&o<=t[1];return"in"===e?i:!i}if(!Array.isArray(r)&&"string"!=typeof r)return"in"===e?n==r:n!=r;const o=!!~r.indexOf(n);return"in"===e?o:!o})),qn(["contains","does-not-contain"],((e,t)=>{const[n,r]=t;if(Ht(n)){const t=Ct(n),o=Ht(r)?Ct(r)[0]:new Date(r),i=o>=t[0]&&o<=t[1];return"contains"===e?i:!i}if(!Array.isArray(n)&&"string"!=typeof n)return!1;const o=!!~n.indexOf(r);return"contains"===e?o:!o})),qn(["get"],((e,t,n)=>{const[r,o]=t,i=Yt(n,{value:r});return"string"==typeof(a=o)||"object"==typeof a&&Array.isArray(a.k)?vt(i,o):$t(i,o);var a})),qn(["array"],((e,t)=>t)),qn(["object"],((e,t)=>{const n={};for(let e=0;e<t.length;e+=2)n[t[e]]=t[e+1];return n})),qn(["split"],((e,[t,n])=>"string"!=typeof t?[t]:t.split(n||""))),qn(["filter"],((e,t,n)=>{let[r,o,i,a]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return[];r=r.value}return At({value:r},o,i,a,n).value})),qn(["source"],((e,t)=>{const[n]=t;return{value:n}})),qn(["group"],((e,t,n)=>{n=n||new Xt({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return At({value:r},null,null,o,n)})),qn(["sort"],((e,t,n)=>{n=n||new Xt({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return At({value:r},null,o,null,n)})),qn(["time-span","time-span-ms"],((e,t)=>{let n=t[0],r="object"==typeof t[t.length-1]?t[t.length-1].unit:null;"string"!=typeof r&&(r=null),r=r&&("y"===r[0]?"y":"w"===r[0]?"w":"d"===r[0]?"d":"h"===r[0]?"h":"s"===r[0]?"s":"m"===r||"mo"===r.substr(0,2)?"m":"mm"===r||"min"===r.substr(0,3)?"mm":"ms"===r||"mil"===r.substr(0,3)?"ms":null);const o="number"==typeof t[1]?t[1]:r?0:1;if(r)return o?(n/xe[r]).toFixed(o):Math.floor(n/xe[r]);{const e=[0,0,0,0,0,0];e:{if(""===n||isNaN(n))return"";if(n=Math.abs(+n),e[0]=Math.floor(n/xe.w),o<e.filter((e=>e)).length)break e;if(n%=xe.w,e[1]=Math.floor(n/xe.d),o<e.filter((e=>e)).length)break e;if(n%=xe.d,e[2]=Math.floor(n/xe.h),o<e.filter((e=>e)).length)break e;if(n%=xe.h,e[3]=Math.floor(n/xe.mm),o<e.filter((e=>e)).length)break e;if(n%=xe.mm,e[4]=Math.floor(n/xe.s),o<e.filter((e=>e)).length)break e;e[5]=n%xe.s}let t="";return e[0]&&(t+=`${e[0]} week${e[0]>1?"s":""}`),e[1]&&(t+=`${t.length?" ":""}${e[1]} day${e[1]>1?"s":""}`),e[2]&&(t+=`${t.length?" ":""}${e[2]} hour${e[2]>1?"s":""}`),e[3]&&(t+=`${t.length?" ":""}${e[3]} minute${e[3]>1?"s":""}`),e[4]&&(t+=`${t.length?" ":""}${e[4]} second${e[4]>1?"s":""}`),e[5]&&(t+=`${t.length?" ":""}${e[5]} millisecond${e[5]>1?"s":""}`),t}})),qn(["string"],((e,[t])=>{if(null==t)return"";if(Array.isArray(t))return t.join(", ");let n=""+t;return"[object"===n.slice(0,7)?JSON.stringify(t):n})),qn(["call"],((e,t)=>{if(null!=t[0]&&"string"==typeof t[1]&&"function"==typeof t[0][t[1]]){const e=t.shift();return e[t.shift()].apply(e,t)}if("function"==typeof t[0]){return t.shift().apply(null,t)}}))),wt(qn(["+"],((e,t)=>{if(Array.isArray(t[0]))return t[0].concat.apply(t[0],t.slice(1));if(Ht(t[0])&&t.length>1&&t.slice(1).reduce(((e,t)=>e&&St(t)),!0))return t.slice(1).reduce(((e,t)=>Ut(e,t,1)),Nt(t[0]));if("number"!=typeof t[0]&&t.length>1&&St(t[0]))return t.slice(1).reduce(((e,t)=>function(e,t){if("number"==typeof e&&"number"==typeof t)return e+t;{const n={d:[]};if("number"==typeof e)n.d[6]=e;else for(let t=0;t<7;t++)e.d[t]&&(n.d[t]=e.d[t]);if("number"==typeof t)n.d[6]=(n.d[6]||0)+t;else for(let e=0;e<7;e++)t.d[e]&&(n.d[e]=(n.d[e]||0)+t.d[e]);return n}}(e,t)),t[0]);return t.reduce(((e,t)=>e&&En(t)),!0)?t.reduce(((e,t)=>e+ +t),0):t.reduce(((e,t)=>e+(null==t?"":t)),"")})),qn(["-"],((e,t)=>{const n=t.shift();if(Ht(n)){if(t.reduce(((e,t)=>e&&Ht(t)),!0))return t.reduce(((e,t)=>e-+Nt(t)),+Nt(n));if(t.reduce(((e,t)=>e&&St(t)),!0))return t.reduce(((e,t)=>Ut(e,t,-1)),Nt(n))}return t.reduce(((e,t)=>e-(En(t)?+t:0)),En(n)?+n:0)})),qn(["*"],((e,t)=>{const n=t.shift();return En(n)?t.reduce(((e,t)=>e*(En(t)?+t:0)),+n):0})),qn(["/","/%"],((e,t)=>{const n=t.shift();return isNaN(n)?0:e.length>1?t.reduce(((e,t)=>Math.floor(e/(isNaN(t)?1:+t))),+n):t.reduce(((e,t)=>e/(isNaN(t)?1:+t)),+n)})),qn(["%"],((e,t)=>{const n=t.shift();return t.reduce(((e,t)=>e%(isNaN(t)?1:+t)),isNaN(n)?0:+n)})),qn(["pow","**"],((e,t)=>{const n=t.pop(),r=Math.pow(t.pop(),n);return t.reverse().reduce(((e,t)=>Math.pow(t,e)),r)})),qn(["abs"],((e,t)=>"number"!=typeof t[0]?t[0]:Math.abs(t[0]))),qn(["round"],((e,t)=>Math.round(t[0]))),qn(["floor"],((e,t)=>Math.floor(t[0]))),qn(["ceil"],((e,t)=>Math.ceil(t[0]))),qn(["rand","random"],((e,[t,n,r])=>{let o;return null==t?Math.random():("number"!=typeof n?o=Math.random()*t:"number"==typeof n&&(o=Math.random()*(n-t)+t),!0===n||!0===r?o:Math.round(o))})));const _n=/^\s*/,In=/\s*$/,Rn=/([\.\[\]\{\}\(\)\^\$\*\+\-])/g;wt(qn(["padl","padr"],((e,t)=>{let[n,r,o]=t;if("string"!=typeof n&&(n=""+n),!En(r))return n;o||(o=" "),"string"!=typeof o&&(o=""+o),o.length<1&&(o=" ");for(let t=n.length;t<r;t=n.length)"padl"===e?n=o+n:n+=o;return n})),qn(["trim","triml","trimr"],((e,t)=>{let[n]=t;return n=""+n,"trim"!==e&&"trimr"!==e||(n=n.replace(In,"")),"trim"!==e&&"triml"!==e||(n=n.replace(_n,"")),n})),qn(["slice","substr"],((e,[t,n,r])=>{if(t&&"function"==typeof t.slice)return t.slice(n,r)})),qn(["len","length"],((e,[t])=>t&&"length"in t?t.length:0)),qn(["replace","replace-all"],((e,[t,n,r,o])=>{t=""+t;const i="string"==typeof o;return"replace-all"===e||i?t.replace(new RegExp(i?n:n.replace(Rn,"\\$1"),("replace"===e||o&&~o.indexOf("g")?o:(o||"")+"g")||"g"),r):t.replace(n,r)})),qn(["reverse"],((e,[t])=>{if("string"==typeof t){let e="";for(let n=0;n<t.length;n++)e=t[n]+e;return e}if(Array.isArray(t))return t.reverse()})),qn(["keys"],((e,[t,n])=>{if(!t)return[];if(n){const e=[];for(const n in t)e.push(n);return e}return Object.keys(t)})),qn(["values"],((e,[t])=>t?Object.values(t):[])),qn(["date"],((e,[t])=>void 0!==t?Ht(t)?Nt(t):new Date(t):new Date)),qn(["upper","lower"],((e,[t])=>(t=null==t?"":t,"upper"===e?(""+t).toUpperCase():(""+t).toLowerCase()))),qn(["format","fmt"],((e,t)=>{let[n,r,...o]=t;const i=Ot[r];return i?i(n,o):""+n}))),wt({type:"checked",names:["and","&&"],checkArg:(e,t,n,r)=>r?"continue":{result:r},apply:(e,t)=>t[t.length-1]},{type:"checked",names:["or","||"],checkArg:(e,t,n,r)=>r?{result:r}:"continue",apply:()=>!1},{type:"checked",names:["if","unless"],checkArg:(e,t,n,r)=>t%2==0?t===n?{result:r}:("if"===e?!r:r)?{skip:1}:"continue":{result:r},apply(){}},{type:"checked",names:["each"],checkArg:(e,t,n,r)=>0===t?Array.isArray(r)||"object"==typeof r?"continue":{skip:1}:1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply(e,[t,n],r){if(r=r||new Xt,Array.isArray(t)){const e=t.length-1;return t.map(((t,o)=>$t(Yt(r,{value:t,special:{last:e,index:o,key:o,"last-key":e}}),n,t))).join("")}{const e=Object.entries(t),o=e[e.length-1][0],i=e.length-1;return Object.entries(t).map((([e,t],a)=>$t(Yt(r,{value:t,special:{last:i,"last-key":o,index:a,key:e}}),n,t))).join("")}}},{type:"checked",names:["with"],checkArg:(e,t,n,r)=>0===t&&"object"==typeof r?"continue":1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply:(e,[t,n],r)=>$t(Yt(r=r||new Xt,{value:t}),n,t)},{type:"checked",names:["coalesce","coalesce-truth"],checkArg:(e,t,n,r)=>"coalesce"===e&&null!=r||r?{result:r}:"continue",apply(){}}),wt({type:"aggregate",names:["avg"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+Ln(n[0]?$t(r,n[0],t):t)),0)/t.length},{type:"aggregate",names:["sum"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+Ln(n[0]?$t(r,n[0],t):t)),0)},{type:"aggregate",names:["count"],apply:(e,t,n,r)=>n.length?t.filter((e=>$t(r,n[0],e))).length:t.length},{type:"aggregate",names:["min","max"],apply:(e,t,n,r)=>(n[0]&&(t=t.map((e=>$t(r,n[0],e)))),Math[e].apply(Math,t))},{type:"aggregate",names:["first","nth","last"],apply(e,t,n,r){let o,i=0;if("first"===e)o=t[0];else if("last"===e)o=t[t.length-1];else if(n[0]){const e=$t(r,n[0]);"number"==typeof e&&(o=t[e],i=1)}return n[i]&&(o=$t(r,n[i])),o}},{type:"aggregate",names:["map"],apply:(e,t,n,r)=>n[0]?t.map((e=>$t(r,n[0],e))):t},{type:"aggregate",names:["unique","unique-map"],apply(e,t,n,r){const o=[],i=[];for(const e of t){const t=n[0]?$t(r,n[0],e):e;~o.indexOf(t)||(o.push(t),i.push(e))}return"unique"===e?i:o}},{type:"aggregate",names:["join"],apply:(e,t,n,r)=>n.length>1?t.map((e=>$t(r,n[0],e))).join($t(r,n[1])):t.join($t(r,n[0]))},{type:"aggregate",names:["find"],apply(e,t,n,r){if(n[0]){if("object"==typeof n[0]&&"a"in n[0])return t.find((e=>$t(r,n[0],e)));{const e=$t(r,n[0]);return t.find((t=>t==e))}}}}),zt("dollar",((e,[t,n])=>function(e,t,n=2,r="$"){return e&&zn.test(e)&&+e>0?`${r}${Cn(e,n)}`:void 0!==t?t:e}(e,void 0,t,n))),zt("date",((e,[t])=>Tn(e,t))),zt("integer",((e,[])=>Cn(e,0))),zt("int",((e,[])=>Cn(e,0))),zt("number",((e,[t])=>Cn(e,t))),zt("num",((e,[t])=>Cn(e,t))),zt("phone",(e=>{return"number"==typeof(t=e)&&(t=t.toString()),7===(t=(t=t||"").replace(/[^\d]/g,"")).length?`${t.substr(0,3)}-${t.substr(3,4)}`:10===t.length?`(${t.substr(0,3)}) ${t.substr(3,3)}-${t.substr(6,4)}`:11===t.length?`${t[0]}-${t.substr(1,3)}-${t.substr(4,3)}-${t.substr(7,4)}`:t;var t}));{const e=/\s+/g,t=/\b\w/g,n=/[^a-zA-Z0-9]+([a-zA-Z0-9])/g,r=/[^\sa-zA-Z0-9]/g,o=/([a-z])([A-Z])/g,i=/\s([^\s])/g;function Jn(e){return e.replace(n,((e,t)=>t?" "+t:"")).replace(r,"").replace(o,((e,t,n)=>`${t} ${n}`)).trim()}zt("case",((n,r)=>{let o=(""+(n||"")).trim();for(const n of r)if("upper"===n||"up"===n)o=o.toUpperCase();else if("lower"===n||"down"===n)o=o.toLowerCase();else if("snake"===n)o=Jn(o).toLowerCase().replace(e,"_");else if("kebab"===n)o=Jn(o).toLowerCase().replace(e,"-");else if("pascal"===n){const e=Jn(o);o=e[0].toUpperCase()+e.toLowerCase().substr(1).replace(i,((e,t)=>(t||"").toUpperCase()))}else if("camel"===n){const e=Jn(o);o=e[0].toLowerCase()+e.toLowerCase().substr(1).replace(i,((e,t)=>(t||"").toUpperCase()))}else"proper"===n&&(o=/[a-z]/.test(o)?o.trim().replace(t,(e=>e.toUpperCase())):o.toLowerCase().trim().replace(t,(e=>e.toUpperCase())));return o}))}const Pn=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function Zn(e){const t=Bn(e);let n=Array.isArray(e)?e[0]||{}:e;if(Array.isArray(n)||"object"==typeof n){const e=[];for(const t in n)e.push(Wn(t,n[t]));return{root:t,fields:e}}return{root:t}}function Wn(e,t){const n=Bn(t);if(~n.indexOf("object")||"array"===n){const r=Zn(t);return r.fields?{type:n,fields:r.fields,name:e}:{type:n,name:e}}return{type:Bn(t),name:e}}function Bn(e){return"string"==typeof e?Pn.test(e)?"date":"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":Array.isArray(e)?e.length<1?"array":"string"==typeof e[0]?Pn.test(e[0])?"date[]":"string[]":"number"==typeof e[0]?"number[]":"boolean"==typeof e[0]?"boolean[]":"object"==typeof e[0]&&e[0]instanceof Date?"date[]":"object"==typeof e[0]?"object[]":"array":"object"==typeof e?e instanceof Date?"date":"object":"any"}const Gn=new RegExp(`[${Ae.split("").map((e=>"\\"+e)).join("")}]`),Vn=["op","args"];let Kn=!1,Qn=!1;function er(e){if("r"in e){if("string"==typeof e.r)return/^[0-9]/.test(e.r)?"."+e.r:e.r;{const t=e.r;return`${function(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}("^",t.u||0)}${t.p||""}${t.k.map(((e,t)=>"string"==typeof e||"number"==typeof e?(t?"":".")+"{{p}":`[${er(e)}]`)).join("")}`}}if("op"in e){if("array"===e.op)return`[${e.args?e.args.map((e=>er(e))).join(" "):""}]`;if("object"===e.op&&e.args&&!e.args.find(((e,t)=>t%2==0&&(!("v"in e)||"string"!=typeof e.v)))){let t="{";if(e.args)for(let n=0;n<e.args.length;n+=2)t+=`${n>0?" ":""}${Qn=!0,er(e.args[n])}:${Qn=!1,er(e.args[n+1])}`;return t+="}",t}return"+"===e.op&&e.args&&e.args.length>0&&"object"==typeof e.args[0]&&"string"==typeof e.args[0].v?`'${e.args.map((e=>"v"in e&&"string"==typeof e.v?e.v.replace(/[\$']/g,(e=>"\\"+e)):`\${${er(e)}}`)).join("")}'`:`(${e.op}${e.args&&e.args.length?" "+e.args.map((e=>er(e))).join(" "):""})`}if("a"in e)return"=>"+er(e.a);if("v"in e){if("string"==typeof e.v)return!Qn&&Kn||Gn.test(e.v)||!e.v.length?~e.v.indexOf("'")?~e.v.indexOf("`")?~e.v.indexOf('"')?`'${e.v.replace(/['\$]/g,(e=>"\\"+e))}'`:`"${e.v}"`:`\`${e.v.replace(/[\$`]/g,(e=>"\\"+e))}\``:`'${e.v.replace(/[\$']/g,(e=>"\\"+e))}'`:`${Qn?"":":"}${e.v}`;if("number"==typeof e.v||"boolean"==typeof e.v)return""+e.v;if("undefined"===e.v)return"undefined";if("null"===e.v)return"null";if(Array.isArray(e.v))return`[${e.v.map((e=>er({v:e}))).join(" ")}]`;if("object"==typeof e.v){if(e.v instanceof Date)return`#${e.v.getFullYear()}-${e.v.getMonth()+1}-${e.v.getDate()}#`;{const t=Object.keys(e.v);return 1===t.length&&("r"===t[0]||"v"===t[0])||"op"in e.v&&!t.find((e=>!Vn.includes(e)))?"%"+er(e.v):`{${t.map((t=>`${Qn=!0,er({v:t})}:${Qn=!1,er({v:e.v[t]})}`)).join(" ")}}`}}}}e.PageSizes={letter:{width:51,height:66,margin:[1.5,1.5]},legal:{width:51,height:84,margin:[1.5,1.5]},tabloid:{width:66,height:102,margin:[1.5,1.5]},a4:{width:49.606302,height:70.15746,margin:[1.5,1.5]}},e.Root=Xt,e.applySource=cn,e.evaluate=$t,e.extend=Yt,e.filter=At,e.getOperatorMap=function(){return Object.assign({},xt)},e.inspect=Zn,e.isValueOrExpr=Mt,e.join=function(e,t){return{parent:e,root:e.root,path:e.path?`${e.path}.${t}`:t,value:vt(e,t)}},e.parse=yt,e.parseTemplate=Xn,e.registerFormat=zt,e.registerLayout=Vt,e.registerOperator=wt,e.registerRenderer=It,e.run=function(e,t,n,r){const o=n&&"root"in n&&n.root===n?n:new Xt(Object.assign({},e.context),{parameters:n});if(e.sources){for(const n of e.sources)cn(o,n,t);for(const e in o.sources)o.value[e]=o.sources[e].value}return"delimited"===e.type?function(e,t){const n=t.root.sources[e.source?e.source:e.sources[0].name||e.sources[0].source];let r="";e.headers&&(r+=e.headers.map((n=>`${e.quote||""}${$t(t,n)}${e.quote||""}`)).join(e.field||",")+(e.record||"\n"));const o=Array.isArray(n.value)?n.value:[n.value],i=e.quote?new RegExp(e.quote,"g"):void 0;for(const n of o){const o=Yt(t,{value:n});r+=e.fields.map((t=>{let n=""+$t(o,t);return i&&(n=n.replace(i,e.quote+e.quote)),`${e.quote||""}${n}${e.quote||""}`})).join(e.field||",")+(e.record||"\n")}return r}(e,o):"flow"===e.type?function(e,t,n){const r={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};let o,i="",a=0,s=null;e.width?o=e.width:e.size&&(o="landscape"===e.orientation?e.size.height:e.size.width);for(const t of e.widgets){let e;i+=`<div${sn(r,[],["position:absolute;right:0rem;left:0rem;"+(o?`width:${o}rem;`:""),""],`top:${a}rem;`,"p")}>\n`;let n=0;do{if(e=Bt(t,r,{x:0,y:n,availableX:o,maxX:o},s),"string"==typeof e)throw new Error("Container widget didn't specify used height");i+=e.output,n+=e.height,s=e.continue?e.continue:null}while(null!==s);a+=n,i+="</div>\n"}const l=e.size&&e.size.margin?on(e.size):[1.5,1.5,1.5,1.5];return`<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${o?` width: ${o}rem;`:""} }\n    #wrapper { height:${a}rem; position: relative; }\n    @media screen {\n      body { margin: 1rem; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${l[0]}rem ${l[1]}rem ${l[2]}rem ${l[3]}rem; }\n      html { background-color: #999; }\n    }${Object.entries(r.styles).map((([e,t])=>t)).join("\n")}${Object.entries(r.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n<div id=wrapper>${i}</div>${n&&n.foot||""}</body></html>`}(e,o,r):function(e,t,n){let r="landscape"===e.orientation?{width:e.size.height,height:e.size.width,margin:[e.size.margin[1],e.size.margin[0]]}:e.size;const o={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};t.special=t.special||{},t.special.page=0,t.special.pages=0;const i=[""];let a=0,s=r.height-2*r.margin[0],l=s,u=0;const c=r.width-2*r.margin[1];let f=null,p=0;if(e.header){p=Bt(e.header,o,{x:0,y:0,availableX:c,availableY:s,maxX:c,maxY:l}).height,s-=p,l-=p,u+=p}let h=0;if(e.footer){h=Bt(e.footer,o,{x:0,y:0,availableX:c,availableY:s,maxX:c,maxY:l}).height,s-=h,l-=h}for(const t of e.widgets){let e;do{e=Bt(t,o,{x:0,y:u,availableX:c,availableY:s,maxX:c,maxY:l},f),i[a]+=e.output,e.continue?(a++,i[a]="",u=p,s=r.height-2*r.margin[0]-p-h,f=e.continue):(u+=e.height,s-=e.height,f=null)}while(null!==f)}t.special.pages=i.length;const g=r.height-2*r.margin[0]-h;return i.forEach(((n,r)=>{let a=`<div class="page-back pb${r}"><div${sn(o,["page","ps"+r],["",""],"","p")}>\n`;if(t.special.page=r+1,e.header){a+=Bt(e.header,o,{x:0,y:0,maxX:c,maxY:l}).output+"\n"}if(a+=n,e.footer){a+=Bt(e.footer,o,{x:0,y:g,maxX:c,maxY:l}).output+"\n"}a+="\n</div></div>",i[r]=a})),`<html style="font-size:100%;margin:0;padding:0;"><head><style>\n    .page { width: ${r.width-2*r.margin[1]}rem; height: ${r.height-2*r.margin[0]}rem; position: absolute; overflow: hidden; left: ${r.margin[1]}rem; top: ${r.margin[0]}rem; }\n    .page-back { width: ${r.width}rem; height: ${r.height}rem; }\n    body { font-size: 0.83rem; }\n    @media screen {\n      html { min-width: ${r.width+2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { margin: 0; padding: 0; ${r?`width:${r.width}rem;`:""}background-color: none; display: block; height: ${i.length*r.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${i.map(((e,t)=>`.pb${t} { top: ${t*r.height}rem; }`)).join("")}\n    }\n    @page {\n      size: ${r.width}em ${r.height}em;\n    }${Object.entries(o.styles).map((([e,t])=>t)).join("\n")}${Object.entries(o.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n${i.reduce(((e,t)=>e+t),"")}${n&&n.foot||""}</body></html>`}(e,o,r)},e.safeGet=vt,e.stringify=function(e,t){return Kn=(t=t||{}).noSymbols,Qn=!1,er(e)},e.unregisterFormat=function(e){delete Ot[e]},e.unregisterOperator=function(...e){for(const t of e)for(const e of t.names)delete xt[e]},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=raport.umd.min.js.map
