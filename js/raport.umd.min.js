!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Raport={})}(this,(function(e){"use strict";const t=[];let n=0;const r=[0,""],o=[0,""];function i(){return r}function s(){return r.slice()}function a(e,i,s,a){return r[0]=e,r[1]=i||"",r[2]=s,r[3]=a,1&n&&r[0]>=o[0]&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3]),t}function l(e,t){return{start:e,end:e,children:[],name:t}}function u(e,t,n){e.end=n[1],e.result=n[0],t&&t.children.push(e)}function c(e,t){let n=1;for(;~(t=e.lastIndexOf("\n",t))&&t;)n++,t--;return n}function f(e,t,n){const r=[],o=e[0];let i=o,s=i=t.lastIndexOf("\n",i),a=t.lastIndexOf("\n",i-1);for(let e=0;e<n&&~i;e++)r.unshift(t.substring(a+1,i)),i=a,a=t.lastIndexOf("\n",i-1);const l=r.length+1;a=s,i=t.indexOf("\n",a+1),-1===i&&a<t.length&&(i=t.length);for(let e=0;e<=n&&~i;e++)r.push(t.substring(a+1,i)),a=i,i=t.indexOf("\n",a+1),-1===i&&a<t.length&&(i=t.length);const u=r[l-1];let p="";const g=o-(~s?s:-1)-1;for(let e=0;e<g;e++)p+="\t"===u[e]?"\t":" ";return p+="^--",{context:r,column:o-s,line:c(t,o),position:o,source:u,message:e[1],marked:`${r.slice(0,l).join("\n")}\n${p}\n${r.slice(l).join("\n")}`,cause:e[2]&&f(e[2],t,n),causes:e[3]&&e[3].map((e=>f(e,t,n)))}}function p(e){let t=e;if(e[2]){const n=p(e[2]);n[0]>t[0]&&(t=n)}if(e[3])for(let n=0;n<e[3].length;n++){const r=p(e[3][n]);r[0]>t[0]&&(t=r)}return o[0]>=r[0]&&o[1]!==e[1]?o:t}const g=/^\s*/,h={};function d(e,t){let r;const s=t,c=t?(t.detailed?1:0)+(t.causes?2:0):0,d=t&&t.consumeAll;return function(t,m){const b=m&&"trim"in m?m.trim:s&&s.trim,v=b?g.exec(t)[0].length:0;b&&(e=h.map(h.seq(e,h.skip(" \t\r\n")),(([e])=>e)));const x=m?(m.detailed?1:0)+(m.causes?2:0):c;let w=[null,0];1&x&&(o[0]=0,o[1]="",o[2]=void 0,o[3]=void 0);const A=m&&"tree"in m&&m.tree&&l(0);if(x!==n){const o=n;n=x,w=(r||(r=y(e))).parse(t,v,w,A),n=o}else w=(r||(r=y(e))).parse(t,v,w,A);if(w.length&&(m&&"consumeAll"in m?m.consumeAll:d)&&w[1]<t.length&&(w=a(w[1],1&x&&`expected to consume all input, but only ${w[1]} chars consumed`)),w.length){if(A){if(u(A,null,w),b){const e=A.children[0].children[0];return e.result=w[0],e}return A}return w[0]}{const e=i(),n=(m&&"contextLines"in m?m.contextLines:s&&s.contextLines)||0,r=f($(e[3]||[],e),t,n),o=p(e);if(e!==o&&(r.latest=f(o,t,n)),m&&"throw"in m?m.throw:s&&s.throw){const e=new Error(r.message);throw Object.assign(e,r)}return r}}}const m={parse:(e,t)=>a(t,1&n&&"uninitialized lazy parser")};function y(e){return e.parser||e||m}function b(e,t){let n;return n={parse:(r,o,i,s)=>(e(),n.parse=t,t(r,o,i,s))},n}function v(e){let t="";const n=e.length;for(let r=0;r<n;r++)e[r]&&(t=t.concat(e[r]));return t}function $(e,t){let n,r=t[0];t[3]=e;const o=e||[];for(let e=0;e<o.length;e++)o[e][0]>r&&(n=o[e],r=n[0]);return n?[n[0],n[1],t]:t}function x(){return!1}function w(e,t){return e===t}function A(e,t){return e[0]===t||e[1]===t}function j(e,t){return e[0]===t||e[1]===t||e[2]===t}function k(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t}function M(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t}function z(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t}function D(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t}function X(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t}function O(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t}function Y(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t||e[9]===t}function S(e,t){const n=e.length;for(let r=0;r<n;r++)if(e[r]===t)return!0;return!1}function C(e,t){let n,r,o=e.length-1,i=0;if(t<e[0]||t>e[o])return!1;for(;i<=o;){if(n=i+o>>1,r=e[n],r===t)return!0;r<t?i=n+1:o=n-1}}function N(e,t=!0){const n=e.length;return 0===n?x:1===n?w:2===n?A:3===n?j:4===n?k:5===n?M:6===n?z:7===n?D:8===n?X:9===n?O:10===n?Y:t?C:S}function H(e){let t="";const n=e.split("").sort().join("");for(let e=0;e<n.length;e++)~t.indexOf(n[e])||(t+=n[e]);return t}function E(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(!r(n,e[i]))return i;return o}function q(e){const t=H(e),n=N(e);return{parse:(e,r,o)=>(o[1]=E(e,r,t,n),o)}}function L(e){const t=H(e),n=N(e);return{parse(e,r,o){const i=E(e,r,t,n);return o[0]=e.substring(r,i),o[1]=i,o}}}function F(e){const t=H(e),r=N(e);return{parse(o,i,s){const l=E(o,i,t,r);return l===i?a(i,1&n&&"expected one of "+e):(s[0]=o.substring(i,l),s[1]=l,s)}}}function _(e,t){const r=t&&H(t),o=N(r||"");return{parse(t,i,s){if(t.length-i>=e){const l=t.substr(i,e);if(r)for(let t=0;t<e;t++)if(!o(r,l[t]))return a(i+t,1&n&&"unexpected char");return s[0]=l,s[1]=i+e,s}return a(i,1&n&&"unexpected end of input")}}}function T(e,t){const r=H(e),o=N(e);return{parse(i,s,l){const u=function(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(r(n,e[i]))return i;return o}(i,s,r,o);return!t&&u>=i.length?a(u-1,1&n&&`expected one of '${e}' before end of input`):(l[0]=u?i.substring(s,u):"",l[1]=u,l)}}}function I(e,t){const r=T(e,t);return{parse(e,t,o){const i=r.parse(e,t,o);return i.length?i[1]>t?i:a(t,1&n&&"expected at least one character"):i}}}function U(...e){const t=e.length;if(1===t){const t=e[0],r=t.length;if(1===r)return{parse:(e,r,o)=>e[r]===t?(o[0]=t,o[1]=r+1,o):a(r,1&n&&"expected "+t)};if(2===r)return{parse:(e,r,o)=>e[r]===t[0]&&e[r+1]===t[1]?(o[0]=t,o[1]=r+2,o):a(r,1&n&&"expected "+t)};{let e,o;return{parse(i,s,l){for(e=0,o=s+e;e<r;e++,o++)if(t[e]!==i[o])return a(s,1&n&&"expected "+t);return l[0]=t,l[1]=s+r,l}}}}return{parse(r,o,i){e:for(let n=0;n<t;n++){const t=e[n],s=t.length;if(1!==s){for(let e=0;e<s;e++)if(t[e]!==r[o+e])continue e;return i[0]=t,i[1]=o+s,i}if(r[o]===t)return[t,o+s]}return a(o,1&n&&`expected ${e.length>1?"one of ":""}${e.map((e=>""+e)).join(", ")}`)}}}function R(...e){const t=e.slice(),r=F(t.map((e=>e.toLowerCase()+e.toUpperCase())).join("")),o=t.map((e=>e.toLowerCase()));return{parse(e,i,s){const l=r.parse(e,i,s);if(!l.length)return l;const u=o.indexOf(l[0].toLowerCase());return~u?(l[0]=t[u],l):a(i,1&n&&`expected ${t.length>1?"one of ":""}${t.map((e=>""+e)).join(", ")}`)}}}function Z(e,t){let n;return b((()=>n=y(e)),(function(e,r,o,i){const s=i&&l(r,t),a=n.parse(e,r,o,s);return a.length?(s&&u(s,i,a),a):(o[0]=null,o[1]=r,o)}))}function J(e,t){let r;return b((()=>r=y(e)),(function(e,o,i){const s=r.parse(e,o,i);return s.length?a(o,1&n&&(t||"unexpected "+e.slice(o,s[1]))):(i[0]="",i[1]=o,i)}))}function P(e,...t){const r="string"==typeof e?e:void 0,o="string"==typeof e?t:(e?[e]:[]).concat(t);let i;const c=o.length;return b((()=>i=o.map(y)),(function(e,t,o,f){let p;const g=f&&l(t,r);for(let r=0;r<c;r++){const a=i[r].parse(e,t,o,g);if(a.length)return g&&u(g,f,a),a;2&n&&(p||(p=[])).push(s())}if(2&n){const e=$(p,[t,"expected "+(r||"alternate")]);return a(e[0],e[1],e[2],e[3])}return a(t,1&n&&"expected "+(r||"alternate"))}))}function W(e,t,n){let r,o;const i=e=>o=e;return b((()=>r=y(e)),(function(e,s,c,f){const p=f&&l(s,n),g=r.parse(e,s,c,p);if(g.length){const e=o;o="",g[0]=t(g[0],i);const n=o;return o=e,n?a(s,n):(p&&u(p,f,g),g)}return g}))}function B(e,t){let n;return b((()=>n=y(e)),(function(e,r,o,i){if(i){const s=l(r,t),a=n.parse(e,r,o);return a.length&&(s.children.length?(s.children[0].name=t,i.children.push(s.children[0])):u(s,i,a)),a}return n.parse(e,r,o)}))}function G(e,t){let r;const o=[];return b((()=>r=y(e)),(function(e,i,a,c){const f=c&&l(i,t);let p,g,h=i;if(g=r.parse(e,h,a,f),!g.length)return a[0]=o,a[1]=h,2&n&&(a[2]=s()),a;for(h=g[1],p=[g[0]];;){if(g=r.parse(e,h,a,f),!g.length)return a[0]=p||[],a[1]=h,2&n&&(a[2]=s()),f&&u(f,c,a),a;p.push(g[0]),h=g[1]}}))}function V(e,t){let r;return b((()=>r=y(e)),(function(e,o,i,c){const f=c&&l(o,t);let p,g,h=o;if(g=r.parse(e,h,i,f),!g.length)return a(h,1&n&&"expected at least one "+(t||"item"),2&n&&s());for((p=[]).push(g[0]),h=g[1];;){if(g=r.parse(e,h,i,f),!g.length)return i[0]=p,i[1]=h,2&n&&(i[2]=s()),f&&u(f,c,i),i;p.push(g[0]),h=g[1]}}))}function K(e,t,r="disallow",o){let c,f;const p=[];return b((()=>(c=y(e),f=y(t))),(function(e,t,g,h){const d=h&&l(t,o);let m,y,b,v,$=t,x=t;if(b=c.parse(e,$,g,d),!b.length)return g[0]=p,g[1]=t,2&n&&(g[2]=s()),g;if(y=b[0],x=$,$=b[1],v=f.parse(e,$,g),!v.length)return"require"===r?a(x,1&n&&"expected separator"):(g[0]=[y],g[1]=$,d&&u(d,h,g),g);for($=v[1],m=[y];;){if(b=c.parse(e,$,g,d),!b.length){if("disallow"===r&&m&&m.length){if(2&n){const e=i();return a(e[0],e[1],[$,"unexpected separator"])}return a($,1&n&&"unexpected separator")}break}if(x=$,$=b[1],y=b[0],v=f.parse(e,$,g),!v.length){if("require"===r)return a(x,1&n&&"expected separator");m.push(y);break}$=v[1],m.push(y)}return g[0]=m,g[1]=$,2&n&&(g[2]=s()),d&&u(d,h,g),g}))}function Q(e,t,r="disallow",o){let i,c;return b((()=>(i=y(e),c=y(t))),(function(e,t,f,p){const g=p&&l(t,o);let h,d,m=t,y=m;if(d=i.parse(e,m,f,g),!d.length)return a(m,1&n&&"expected at least one "+(o||"item"));{(h=[]).push(d[0]),y=m=d[1];const t=c.parse(e,m,f);if(t.length)for(m=t[1];;){if(d=i.parse(e,m,f,g),!d.length){if("disallow"===r&&h&&h.length)return f[0]=h,f[1]=y,g&&u(g,p,f),f;break}{h.push(d[0]),y=m=d[1];const t=c.parse(e,m,f);if(!t.length){if("require"===r)return a(m,1&n&&"expected separator");break}m=t[1]}}else if("require"===r)return a(m,1&n&&"expected separator")}return f[0]=h,f[1]=m,2&n&&(f[2]=s()),g&&u(g,p,f),f}))}function ee(e,t,o,i){const s="string"==typeof o?o:"string"==typeof i?i:void 0;if(Array.isArray(e)){let r,o;const i=e.length;return b((()=>(o=y(t),r=e.map(y))),(function(e,t,c,f){const p=f&&l(t,s);let g,h;for(let n=0;n<i;n++){if(r[n].parse(e,t,c).length){h=r[n];break}}if(!h)return a(t,1&n&&"expected opening bracket");const d=o.parse(e,c[1],c,p);if(!d.length)return d;2&n&&(g=d[2]);const m=d[0],y=d[1];return h.parse(e,y,c).length?(c[0]=m,p&&u(p,f,c),c):a(y,1&n&&"expected matching end bracket",2&n&&g)}))}if("string"!=typeof o){let i,a,c;return b((()=>(i=y(e),a=y(t),c=y(o))),(function(e,t,o,f){let p;const g=f&&l(t,s),h=i.parse(e,t,o);if(!h.length)return h;const d=a.parse(e,h[1],o,g);if(!d.length)return d;2&n&&d[2]&&(p=d[2]);const m=d[0],y=c.parse(e,d[1],o);return y.length?(o[0]=m,g&&u(g,f,o),o):(2&n&&p&&function(e){(r[3]||(r[3]=[])).push(e)}(p),y)}))}}function te(...e){let t;const r=e.length;return b((()=>t=e.map(y)),(function(e,o,i,c){const f=c&&l(o);let p,g,h,d=o;if(h=t[0].parse(e,d,i,f),!h.length){if(2&n){const e=$(g,s());return a(e[0],e[1],e[2],e[3])}return h}2&n&&h[2]&&(g||(g=[])).push(h[2]),(p=[]).push(h[0]),d=h[1];for(let o=1;o<r;o++){if(h=t[o].parse(e,d,i,f),!h.length){if(2&n){const e=$(g,s());return a(e[0],e[1],e[2],e[3])}return h}2&n&&h[2]&&(g||(g=[])).push(h[2]),p.push(h[0]),d=h[1]}return i[0]=p,i[1]=d,2&n&&(i[2]=[o,"error in seq",null,g]),f&&u(f,c,i),i}))}function ne(e,...t){let r,o;"string"!=typeof e?t.unshift(e):o=e;const i=t.length;return b((()=>r=t.map(y)),(function(e,t,c,f){const p=f&&l(t,o);let g,h,d=t;if(h=r[0].parse(e,d,c),!h.length){if(2&n){const e=$(g,s());return a(e[0],e[1],e[2],e[3])}return h}2&n&&h[2]&&(g||(g=[])).push(h[2]),d=h[1];for(let t=1;t<i;t++){if(h=r[t].parse(e,d,c),!h.length){if(2&n){const e=$(g,s());return a(e[0],e[1],e[2],e[3])}return h}2&n&&h[2]&&(g||(g=[])).push(h[2]),d=h[1]}return c[0]=null,c[1]=d,p&&u(p,f,c),c}))}h.skip=q,h.map=W,h.seq=te;const re="abcdefABCDEF",oe="0123456789",ie=re+"abcdefABCDEFghijklmnopqrstuvwxyzGHIJKLMNOPQRSTUVWXYZ$_",se=re+oe,ae={b:"\b",r:"\r",n:"\n","'":"'",'"':'"',t:"\t","\\":"\\"},le=/_/g,ue=W(te(Z(U("-","+")),F(oe),L(oe+"_"),Z(U(".")),L(oe+"_"),W(Z(te(U("e","E"),Z(U("+","-")),F(oe+"_"))),(e=>e&&v(e)))),(e=>+v(e).replace(le,""))),ce=W(te(U("\\"),function(e,t){const r=H(t),o=N(r);return{parse(t,i,s){if(t.length-i>=e){const l=t.substr(i,e);for(let t=0;t<e;t++)if(o(r,l[t]))return a(i+t,1&n&&"unexpected char");return s[0]=l,s[1]=i+e,s}return a(i,1&n&&"unexpected end of input")}}}(1,"xu")),(e=>ae[e[1]]||e[1])),fe=W(te(U("\\u"),_(4,se)),(e=>String.fromCharCode(parseInt(e[1],16)))),pe=W(te(U("\\x"),_(2,se)),(e=>String.fromCharCode(parseInt(e[1],16)))),ge=P(ee(U('"'),W(G(P("string part",I('"\\'),fe,pe,ce)),(e=>v(e))),U('"')),ee(U("'"),W(G(P("string part",I("'\\"),fe,pe,ce)),(e=>v(e))),U("'"))),he=W(U("true","false"),(e=>"true"===e)),de=W(U("null"),(()=>null)),me=W(te(F(ie),Z(L(ie+oe))),(([e,t])=>null!==t?e+t:e)),ye=q(" \t\n\r"),be={},ve={},$e=P("value",ge,be,ve,ue,he,de),xe=W(te(ye,P("key",ge,me),ne(ye,U(":"),ye),$e),(e=>[e[1],e[3]]));be.parser=ee(ne(U("["),ye),K($e,ne(ye,U(","),ye),"allow"),ne(ye,U("]"))),ve.parser=W(ee(ne(U("{"),ye),K(xe,ne(ye,U(","),ye),"allow"),ne(ye,U("}"))),(e=>{const t=e.length,n={};for(let r=0;r<t;r++){const t=e[r];n[t[0]]=t[1]}return n})),d(W(te(ye,$e,ye),(e=>e[1])));const we={y:0,m:0,w:0,d:864e5,h:36e5,mm:6e4,s:1e3};we.w=7*we.d,we.y=Math.floor(365.25*we.d),we.m=Math.floor(30.45*we.d);const Ae=" \r\n\t",je=" \r\n\t():{}[],\"'`\\;&#.",ke=function(e){const t=H(e),r=N(e);return{parse:(o,i,s)=>(s[1]=E(o,i,t,r),s[1]===i?a(i,1&n&&"expected at least one of "+JSON.stringify(e)):s)}}(Ae),Me=W(U("null","true","false","undefined"),(e=>{switch(e){case"null":return null;case"true":return!0;case"false":return!1;case"undefined":return}})),ze=I(je,!0),De={},Xe={},Oe={},Ye={},Se={},Ce={n:"\n",r:"\r",t:"\t",b:"\b"},Ne=W(te(U("\\"),_(1)),(([,e])=>Ce[e]||e)),He=W(V(P("ref part",I(je+"=/",!0),Ne)),(e=>e.join(""))),Ee=W(te(U("."),He),(([,e])=>e)),qe=ee(te(U("["),ye),Ye,te(ye,U("]"))),Le=W(te(P("ref sigil",U("!","~","*"),te(L("^"),Z(U("@",".")))),P("keypath",He,qe),G(P("keypath",Ee,qe))),(([e,t,n])=>{const r={k:[t].concat(n).map((e=>"object"!=typeof e||!("v"in e)||"string"!=typeof e.v&&"number"!=typeof e.v?e:e.v))};return Array.isArray(e)?(e[0]&&(r.u=e[0].length),"@"===e[1]&&(r.p="@")):e&&(r.p=e),r}),"keypath"),Fe=d(Le),_e=W(Le,(e=>({r:e})),"reference");function Te(e){const t=e.reduce(((e,t)=>(e.length&&"v"in t&&"v"in e[e.length-1]&&"string"==typeof t.v&&"string"==typeof e[e.length-1].v?e[e.length-1].v+=t.v:e.push(t),e)),[]);return t.length>0&&(!("v"in t[0])||"string"!=typeof t[0].v)&&t.unshift({v:""}),0===t.length?{v:""}:1===t.length?t[0]:{op:"+",args:t}}const Ie=W(Q(te(ue,ye,R("years","year","y","months","month","minutes","minute","milliseconds","millisecond","mm","ms","m","weeks","week","w","days","day","d","hours","hour","h","seconds","second","s")),ye),(e=>{const t={y:0,m:0,d:0,h:0,mm:0,s:0,ms:0};for(let n=0;n<e.length;n++)"y"===e[n][2][0]?t.y+=e[n][0]:"m"===e[n][2]||"months"===e[n][2]||"month"===e[n][2]?t.m+=e[n][0]:"d"===e[n][2][0]?t.d+=e[n][0]:"w"===e[n][2][0]?t.d+=7*e[n][0]:"h"===e[n][2][0]?t.h+=e[n][0]:"s"===e[n][2][0]?t.s+=e[n][0]:"mm"===e[n][2]||"minutes"===e[n][2]||"minute"===e[n][2]?t.mm+=e[n][0]:"ms"!==e[n][2]&&"milliseconds"!==e[n][2]&&"millisecond"!==e[n][2]||(t.ms+=e[n][0]);if(t.y||t.m){const e=[];return t.y&&(e[0]=t.y),t.m&&(e[1]=t.m),t.d&&(e[2]=t.d),t.h&&(e[3]=t.h),t.mm&&(e[4]=t.mm),t.s&&(e[5]=t.s),t.ms&&(e[6]=t.ms),{d:e}}{delete t.y,delete t.m;let e=0;for(const n in t)e+=t[n]*(we[n]||1);return e}}),"timespan"),Ue=W(te(ye,P("timezone",R("z"),te(Z(_(1,"+-")),F(oe),Z(te(U(":"),_(2,oe)))))),(e=>{if("z"===e[1][0])return 0;{let t=60*+e[1][1];return e[1][2]&&(t+=+e[1][2][1]),"-"===e[1][0]&&(t*=-1),t}})),Re=P(W(te(F(oe),Z(te(U(":"),_(2,oe),Z(te(U(":"),_(2,oe),Z(te(U("."),_(3,oe)))))))),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=r&&e[1][2][2]&&e[1][2][2][1],i=[+t];return n&&(i[1]=+n),r&&(i[2]=+r),o&&(i[3]=+o),i})),W(R("noon"),(()=>[12,0,0,0])),W(R("midnight"),(()=>[0,0,0,0]))),Ze=Z(te(ye,U(">"))),Je=P("date",W(te(Z(R("last","this","next")),ke,R("week","month","year"),Z(Ue),Ze),(([e,,t,n,r])=>{const o={f:"w"===t[0]?"w":"m"===t[0]?"m":"y",o:"last"===e?-1:"next"===e?1:0,e:r?1:void 0};return null!=n&&(o.z=n),o})),W(te(R("week","month","year"),te(ke,R("to"),ke,R("date")),Z(Ue),Ze),(([e,,t,n])=>{const r={f:"w"===e[0]?"w":"m"===e[0]?"m":"y",o:0,d:1,e:n?1:void 0};return null!=t&&(r.z=t),r})),W(te(R("yesterday","today","tomorrow"),P(ee(ye,R("at"),ye),ke),Re,ye,Z(Ue)),(e=>{const t={f:"d",o:"yesterday"===e[0]?-1:"today"===e[0]?0:1,t:e[2]};return null!=e[4]&&(t.t[4]=e[4]),t})),W(te(R("yesterday","today","tomorrow","now"),Z(Ue),Ze),(([e,t,n])=>{const r="now"===e?{f:"n",o:0}:{f:"d",o:"yesterday"===e?-1:"today"===e?0:1,e:n?1:void 0};return null!=t&&(r.z=t),r})),W(te(R("in"),ke,Ie),(e=>"number"==typeof e[2]?{f:"n",o:e[2]}:{f:"n",o:e[2].d})),W(te(Ie,ke,P("relative time anchor",R("ago"),te(R("from"),ke,R("now"))),Z(Ue)),(([e,,t,n])=>{let r;return r="number"==typeof e?{f:"n",o:e*("ago"===t?-1:1)}:{f:"n",o:e.d,d:"ago"===t?-1:void 0},null!=n&&(r.z=n),r})));function Pe(e,t,n){return null==n||(e[t]=n),e}const We=W(te(_(4,oe),Z(te(_(1,"-/"),F(oe),Z(te(_(1,"-/"),F(oe))))),Z(te(P(ee(ke,R("at"),ke),R("t"),ke),Re)),Z(Ue),Ze),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=e[2]&&e[2][1],i=e[3],s=e[4]?1:void 0;if(n){if(r){if(o){const e={f:[+t,+n-1,+r],e:s};for(let t=0;t<o.length;t++)null!=o[t]&&(e.f[t+3]=o[t]);return null!=i&&(e.f[7]=i),e}return{f:Pe([+t,+n-1,+r],7,i),e:s}}return{f:Pe([+t,+n-1],7,i),e:s}}return{f:Pe([+t],7,i),e:s}})),Be=ee(U("#"),P("date",We,Je,Ie),U("#")),Ge=P("string",W(te(U(":"),I(je.replace(".",""),!0)),(e=>({v:e[1]}))),W(ee(U('"'),G(P("string part",I('\\"'),ce,fe,pe)),U('"')),(e=>({v:"".concat(...e)}))),W(ee(U("'"),G(P("string part",W(I("'\\${",!0),(e=>({v:e}))),W(U("\\$","$$"),(()=>({v:"$"}))),ee(U("${","{"),Ye,U("}")),W(U("$","{"),(e=>({v:e}))),W(fe,(e=>({v:e}))),W(pe,(e=>({v:e}))),W(ce,(e=>({v:e}))))),U("'")),Te),W(ee(U("`"),G(P("string part",W(I("`\\${",!0),(e=>({v:e}))),W(U("\\$","$$"),(()=>({v:"$"}))),ee(U("${","{"),Ye,U("}")),W(U("$","{"),(e=>({v:e}))),W(fe,(e=>({v:e}))),W(pe,(e=>({v:e}))),W(ce,(e=>({v:e}))))),U("`")),Te)),Ve=W(P("literal",ue,Me,Be),(e=>e instanceof Date||null==e||"object"!=typeof e?{v:e}:e)),Ke=W(ee(ne(U("("),ye),te(ze,ye,De),ne(ye,U(")"))),(([e,,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n}),"sexp");function Qe(e){return ee(te(U("("),ye),e,te(ye,U(")")))}const et={},tt={},nt={},rt=W(te(B(F("abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789"),"op"),Qe(De)),(([e,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n}),"call"),ot=function(e){return W(te(e,Z(te(U("#"),ze,Z(te(U(","),Q(Ye,U(","))))))),(([e,t])=>t?t[2]?{op:"fmt",args:[e,{v:t[1]},...t[2][1]]}:{op:"fmt",args:[e,{v:t[1]}]}:e))}(function(e){return W(te(e,G(P("keypath",Ee,qe))),(([e,t])=>t.length?{op:"get",args:[e,{v:{k:t}}]}:e))}(P("operand",Qe(tt),Qe(nt),function(e,t,n){let r;return b((()=>r=y(e)),(function(e,o,i,s){const c=s&&l(o,n),f=r.parse(e,o,i);if(!f.length)return f;const p=t(f[0]);return!0===p?(c&&u(c,s,f),f):a(f[1],p)}))}(Qe(et),(e=>"op"in e||"expected bracketed op")),Ke,Se))),it=W(te(U("not ","+"),ot),(([e,t])=>({op:"+"===e?e:"not",args:[t]})),"unary");function st(e,[,t,,n]){return{op:t,args:[e,n]}}const at=W(te(ot,G(te(ke,B(U("**"),"exp op"),ke,ot))),(([e,t])=>t.length?function(e,t){if(1===t.length)return{op:t[0][1],args:[e,t[0][3]]};const n=t.pop();let r=t[t.length-1][1];const o={op:n[1],args:[t.pop()[3],n[3]]},i=t.reverse().reduce(((e,t)=>{const n={op:r,args:[t[3],e]};return r=t[1],n}),o);return{op:r,args:[e,i]}}(e,t):e)),lt=W(te(at,G(te(ke,B(U("*","/%","/","%"),"muldiv op"),ke,at))),(([e,t])=>t.length?t.reduce(st,e):e)),ut=W(te(lt,G(te(ke,B(U("+","-"),"addsub op"),ke,lt))),(([e,t])=>t.length?t.reduce(st,e):e)),ct=W(te(ut,G(te(ke,B(U(">=",">","<=","<","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain"),"cmp op"),ke,ut))),(([e,t])=>t.length?t.reduce(st,e):e)),ft=W(te(ct,G(te(ke,B(U("is","is-not","==","!="),"eq op"),ke,ct))),(([e,t])=>t.length?t.reduce(st,e):e)),pt=W(te(ft,G(te(ke,B(U("and","&&"),"and op"),ke,ft))),(([e,t])=>t.length?t.reduce(st,e):e)),gt=W(te(pt,G(te(ke,B(U("or","||"),"or op"),ke,pt))),(([e,t])=>t.length?t.reduce(st,e):e),"binop");function ht(e){if(!e.args||!e.args.length)return!1;let t=!1;for(let n=0;n<e.args.length;n++){const r=e.args[n];"r"in r&&("_"===r.r||"object"==typeof r.r&&"_"===r.r.k[0])?(r.r={k:["case"].concat((r.r.k||[]).slice(1)),p:"@"},t=!0):"r"in r&&"object"==typeof r.r&&"@"===r.r.p&&"case"===r.r.k[0]?t=!0:"op"in r&&(t=t||ht(r))}return t}et.parser=gt,tt.parser=P(W(te(U("if"),ke,Ye,ke,U("then"),ke,Ye,G(te(ke,J(U("end","fi")),U("else if","elseif","elsif","elif"),ke,Ye,ke,U("then"),ke,Ye)),Z(te(ke,U("else"),ke,Ye)),Z(te(ke,U("end","fi")))),(([,,e,,,,t,n,r])=>{const o={op:"if",args:[e,t]};for(const[,,,,e,,,,t]of n)o.args.push(e,t);return r&&o.args.push(r[3]),o}),"if"),W(te(U("unless"),ke,Ye,ke,U("then"),ke,Ye,Z(te(ke,U("else"),ke,Ye))),(([,,e,,,,t,n])=>{const r={op:"unless",args:[e,t]};return n&&r.args.push(n[3]),r})));const dt=P(W(te(ke,J(U("end","esac")),U("when"),ke,Ye,ke,U("then"),ke,Ye),(([,,,,e,,,,t])=>[e,t]),"when branch"),W(te(ke,J(U("end","esac")),U("else"),ke,Ye),(([,,,,e])=>[void 0,e]),"else branch"));nt.parser=W(te(U("case"),ke,Ye,G(dt),Z(te(ke,U("end","esac")))),(([,,e,t])=>{const n={op:"case",args:[e]};for(let e=0;e<t.length;e++)if(void 0===t[e][0])n.args.push(t[e][1]);else{let r=t[e][0];"op"in r&&ht(r),n.args.push(r),n.args.push(t[e][1])}return n}),"case");const mt=P("expression",tt,nt,et),yt=W(te(P("key",Ge,W(ze,(e=>({v:e})))),ye,U(":"),ye,Ye),(e=>[e[0],e[4]]),"pair");function bt(e){return e.filter((e=>!("v"in e[0]&&"v"in e[1]))).length?{op:"object",args:e.reduce(((e,t)=>(e.push(t[0],t[1]),e)),[])}:{v:e.reduce(((e,t)=>(e[t[0].v]=t[1].v,e)),{})}}Xe.parser=W(ee(ne(ye,U("["),ye),K(Ye,F(" \r\n\t,"),"allow"),ne(ye,U("]"))),(e=>e.filter((e=>!("v"in e))).length?{op:"array",args:e}:{v:e.map((e=>e.v))}),"array"),Oe.parser=W(ee(ne(ye,U("{"),ye),K(yt,F(" \r\n\t,"),"allow"),ne(ye,U("}"))),bt,"object"),Ye.parser=mt;const vt=W(te(ze,U(":"),ye,Ye),(([e,,,t])=>[{v:e},t]),"named arg"),$t=W(te(U("=>"),ye,Ye),(([,,e])=>({a:e})));De.parser=W(K(P("argument",vt,Ye),F(" \r\n\t,"),"allow"),(e=>{const[t,n]=e.reduce(((e,t)=>(Array.isArray(t)?e[1].push(t):e[0].push(t),e)),[[],[]]);return n.length&&t.push(bt(n)),t}),"application"),Se.parser=P("expression",Xe,Oe,Ve,Ge,$t,it,rt,_e);const xt=d(Ye,{trim:!0});function wt(e,t){if(!t)return e.value;const n="string"==typeof t?Fe(t):t;if(!("error"in n)&&"k"in n){const t=n.k,r=n.p;let o=0,i=e,s=e.value;for(let e=0;e<n.u;e++)i&&(i=i.parent);if(s=i?i.value:void 0,r){if("!"===r)s=e.root.parameters;else if("~"===r)s=e.root.value;else if("*"===r)s=e.root.sources[t[o++]],s&&o<t.length+1&&"value"!==t[o]&&(s=s.value);else if("@"===r){const n=t[o++];if("value"!==n){for(;i&&(!i.special||!(n in i.special));)i=i.parent;s=i&&i.special[n],s&&"source"===n&&void 0!==t[o]&&"value"!==t[o]&&s.value&&(s=s.value),s||"date"!==n||(s=e.root.special.date=new Date)}}}else"_"===t[0]&&t.shift();for(let n=o;n<t.length;n++){const r=t[n];if("object"!=typeof r)s=s&&s[r];else{const t=jt(e,r);s=s&&s[t]}if(null==s)return}return s}}const At={};function jt(e,t,n){let r,o,i=At;return Ot(e)?(r=new Ct,o=e,arguments.length>1&&(i=t)):St(e)?(r=e,o=t,arguments.length>2&&(i=n)):e&&"context"in e&&St(e.context)?(r=e.context,o=t,arguments.length>2&&(i=n)):Ot(t)?(r=new Ct(e),o=t,arguments.length>2&&(i=n)):(r=new Ct,o=e,arguments.length>1&&(i=n)),"string"==typeof o&&(o=r.root.exprs[o]||(r.root.exprs[o]=(r.parser||xt)(o))),"object"!=typeof o&&(o={v:o}),o&&"r"in o?wt(r,o.r):o&&"v"in o?o.v:o&&"op"in o?Xt(r,o):o&&"a"in o?i===At?o.a:jt(Nt(r,{value:i}),o.a):o&&Lt(o)?o:void 0}const kt={};function Mt(...e){for(const t of e)for(const e of t.names)kt[e]=t}function zt(e,t,n,r,o){if(!e||!Array.isArray(e.value))return e;o=o?Nt(o,{special:{source:e.value}}):new Ct(e.value,{special:{source:e}});const i=t?[]:e.value.slice();if(t){let n="string"==typeof t?xt(t):t;"m"in n&&(n={v:!0}),e.value.forEach(((e,t)=>{jt(Nt(o,{value:e,special:{value:e,index:t}}),n)&&i.push(e)}))}const s=function(e,t){let n;if(Array.isArray(t))n=t;else{const r=jt(e,t);Array.isArray(r)?n=r:"string"==typeof r&&(n=[{v:r}])}if(n)for(let e=0;e<n.length;e++){const t=n[e];"string"==typeof t&&("-"===t[0]?n[e]={by:t.substr(1),desc:!0}:n[e]={by:"+"===t[0]?t.substr(1):t})}return n}(o,n);if(s&&s.length){const e=s.map((e=>{if("object"==typeof e&&"by"in e){if("desc"in e)return"boolean"==typeof e.desc?e.desc:jt(o,e.desc);if("dir"in e){const t="string"==typeof e.dir?e.dir.toLowerCase():e.dir,n="asc"===t||"desc"===t?t:jt(o,e.dir);if("desc"===("string"==typeof n?n.toLowerCase():n))return!0}}return!1}));i.sort(((t,n)=>{for(let r=0;r<s.length;r++){const i=s[r],a=e[r],l="string"==typeof i?i:i&&i.by?i.by:i,u=jt(Nt(o,{value:t}),l),c=jt(Nt(o,{value:n}),l),f=null==u&&null!=c?-1:null!=u&&null==c?1:u<c==c<u?0:u<c?-1:u>c?1:0;if(f)return(a?-1:1)*f}return 0}))}return Array.isArray(r)||(r=jt(o,r)),Array.isArray(r)&&r.length?{value:{schema:e.schema,grouped:r.length,level:0,value:Dt(i,r,o,1),all:i}}:{schema:e.schema,value:i}}function Dt(e,t,n,r=0){const o={},i=[],s=[];for(const r of e){const e=""+jt(Nt(n,{value:r}),t[0]);o[e]||(s.push(e),o[e]=[]),o[e].push(r)}for(const e of s)i.push({group:e,grouped:t.length-1,value:t.length>1?Dt(o[e],t.slice(1),n,r+1):o[e],all:o[e],level:r});return i}function Xt(e,t){const n=kt[t.op];if(!n)return!0;let r;if("checked"===n.type){r=[];const o=t.args||[],i=n.extend?Nt(e,{}):e;for(let e=0;e<o.length;e++){const s=o[e],a=jt(i,s),l=n.checkArg(t.op,e,o.length-1,a,i,s);if("continue"===l)r.push(a);else if("skip"in l)e+=l.skip,"value"in l&&r.push(l.value);else if("result"in l)return l.result}return n.apply(t.op,r,i)}if("value"===n.type)return r=(t.args||[]).map((t=>jt(e,t))),n.apply(t.op,r,e);{let r;const o=n.extend?Nt(e,{}):e,i=(t.args||[]).slice(),s=jt(o,i[0]);if(Array.isArray(s)?(i.shift(),r=s):"object"==typeof s&&"value"in s&&Array.isArray(s.value)&&(i.shift(),r=s.value),!r){const e=jt(o,{r:"@source"});r=Array.isArray(e)?e:"object"==typeof e&&"value"in e&&Array.isArray(e.value)?e.values:[]}return n.apply(t.op,Array.isArray(r)?r:[],i,o)}}function Ot(e){return"string"==typeof e||Yt(e)}function Yt(e){return"object"==typeof e&&e&&("r"in e&&"string"==typeof e.r||"op"in e&&"string"==typeof e.op||"v"in e||"a"in e)}function St(e){return"object"==typeof e&&"string"==typeof e.path&&"object"==typeof e.root&&"value"in e&&("object"==typeof e.parent||e.root===e)}class Ct{constructor(e={},t){this.root=this,this.parameters={},this.sources={},this.special={},this.exprs={},this.path="",this.value=e,t&&(Object.assign(this.parameters,t.parameters),Object.assign(this.special,t.special))}}function Nt(e,t){return{parent:e,root:e.root,path:"",value:"value"in t?t.value:e.value,special:t.special||{},parser:t.parser}}const Ht={};function Et(e,t){Ht[e]=t}function qt(e){if(e instanceof Date)return[e,e];let t=new Date,n="d"in e&&e.d?new Date:void 0;t.setHours(0,0,0,0);let r="z"in e&&null!=e.z?e.z:null;if("n"===e.f)t="number"==typeof e.o?new Date(+new Date+e.o):Tt(new Date,{d:e.o},"d"in e?e.d:1),n=t;else if("d"===e.f){if(t.setDate(t.getDate()+e.o),n||(n=new Date(t)),"t"in e){const o=e.t;t.setHours(o[0],o[1]||0,o[2]||0,o[3]||0),n.setHours(o[0],null==o[1]?59:o[1],null==o[2]?59:o[2],null==o[3]?999:o[3]),null!=o[4]&&(r=o[4])}}else if("w"===e.f)t.setDate(t.getDate()-(t.getDay()+(-1===e.o?7:1===e.o?-7:0))),n||(n=new Date(t),n.setDate(t.getDate()+6)),"z"in e&&null!=e.z&&(r=e.z);else if("m"===e.f)t.setDate(1),t.setMonth(t.getMonth()+e.o),n||(n=new Date(t),n.setMonth(t.getMonth()+1),n.setDate(0));else if("y"===e.f)t.setDate(1),t.setMonth(0),t.setDate(1),n||(n=new Date(t),n.setFullYear(t.getFullYear()+1),n.setDate(0));else if(Array.isArray(e.f)){const o=e.f.slice();t=new Date(o[0],o[1]||0,o[2]||1,o[3]||0,o[4]||0,o[5]||0,o[6]||0);for(let e=1;e<7;e++)if(null==o[e]){o[e-1]++;break}null!=o[6]&&o[6]++,n=new Date(o[0],o[1]||0,o[2]||1,o[3]||0,o[4]||0,o[5]||0,o[6]||0),n.setMilliseconds(n.getMilliseconds()-1),null!=o[7]&&(r=o[7])}if("d"!==e.f&&"w"!==e.f&&"m"!==e.f&&"y"!==e.f||n.setHours(23,59,59,999),null!=r){const e=r+t.getTimezoneOffset();t.setMinutes(t.getMinutes()+e),t!==n&&n.setMinutes(n.getMinutes()+e)}return[t,n]}function Lt(e){return"object"==typeof e&&("f"in e&&(Array.isArray(e.f)||"o"in e)||e instanceof Date)}function Ft(e){const t=qt(e);return"e"in e&&null!=e.e?t[1]:t[0]}function _t(e){return"number"==typeof e||"object"==typeof e&&Array.isArray(e.d)}function Tt(e,t,n){if("number"==typeof t)return new Date(+e+t*n);{let r=new Date(e);return t.d[0]&&r.setFullYear(r.getFullYear()+t.d[0]*n),t.d[1]&&r.setMonth(r.getMonth()+t.d[1]*n),t.d[2]&&r.setDate(r.getDate()+t.d[2]*n),t.d[3]&&r.setHours(r.getHours()+t.d[3]*n),t.d[4]&&r.setMinutes(r.getMinutes()+t.d[4]*n),t.d[5]&&r.setSeconds(r.getSeconds()+t.d[5]*n),t.d[6]&&r.setMilliseconds(r.getMilliseconds()+t.d[6]*n),r}}function It(e,t,n){e.styles[t]||(e.styles[t]=n)}function Ut(e){return"object"==typeof e&&Ot(e.x)}function Rt(e,t){return{report:e.report,context:Nt(e.context,t),styles:e.styles,styleMap:e.styleMap}}const Zt=/\>\<\&/g,Jt={"<":"&lt;",">":"&gt;","&":"&amp;"};function Pt(e){return e.replace(Zt,(e=>Jt[e]||""))}const Wt={};function Bt(e,t,n){Wt[e]="function"==typeof t?{render:t}:t,n&&Object.assign(Wt[e],n)}const Gt=7.4,Vt=6.7,Kt=7.85,Qt=5.9;let en=function(e,t,n){const r=n&&n.family||"sans",o=n&&n.size||.83,i=(n.metric||("mono"===r||/fixed|mono/i.test(r)?Kt:"narrow"===r||/narrow|condensed/i.test(r)?Qt:"sans"===r||/sans|arial|helvetica/i.test(r)?Gt:Vt))*o/16;return e.split(/\r?\n/g).reduce(((e,n)=>{const[r,o]=n.split(/\s/g).reduce(((e,n)=>{const r=(n.length+1)*i;return e[0]+r>t?(e[0]=r,e[1]++):e[0]+=r,e}),[0,0]);return e+(o+(r>0?1:0)||1)}),0)*o};function tn(e,t,n,r){const o=Wt[e.type];if(!o||e.hide&&jt(t,e.hide))return{output:""};!("height"in e)&&o.container&&(e.height="auto");const i=ln(e,n,t);if(n.maxY&&!isNaN(i)&&i>n.maxY)return It(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2};if(n.availableY&&i>n.availableY)return{output:"",continue:{offset:0},cancel:!0};let s=0;if(e.margin){const r=fn(e,t);s+=r[0]+r[2],n.availableX&&(n.availableX-=r[1]+r[3]),n.availableY&&(n.availableY-=r[0]+r[2])}const a=o.render(e,t,n,r);return"string"==typeof a?{output:a,height:i,width:sn(e,n,t)}:n.maxY&&a.height>n.maxY?(It(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2}):isNaN(i)&&n.availableY&&a.height>n.availableY?{output:"",continue:{offset:0},height:a.height,cancel:!0}:(a.height+=s,a)}const nn={};function rn(e,t){nn[e]=t}function on(e,t,n){let r=Ut(e.width)?jt(n,e.width.x):e.width;return r?"number"==typeof r?r:+(r.percent/100*(t.maxX||51)).toFixed(4):t.maxX||51}function sn(e,t,n){let r=on(e,t,n);if(e.margin){const t=fn(e,n);r+=t[1]+t[3]}else e.font&&e.font.right&&(r+=e.font.right);return r}function an(e,t,n,r,o){let i=1,s=Ut(e.height)?jt(n,e.height.x):e.height;if(null==s&&o&&(s=function(e){let t=e.height||1;if(e.font&&e.font.size>t&&(t=e.font.size),"text"in e&&Array.isArray(e.text))for(let n=0;n<e.text.length;n++)"object"==typeof e.text[n]&&e.text[n].font&&e.text[n].font.size>t&&(t=e.text[n].font.size);return t}(e)),"number"==typeof s)i=s;else if("object"==typeof s&&"percent"in s&&s.percent&&t.availableY)i=+(t.availableY*(s.percent/100)).toFixed(4);else if("auto"===s||r&&!s)return r||NaN;return i}function ln(e,t,n,r,o){let i=an(e,t,n,r,o);if(e.margin){const t=fn(e,n);i+=t[0]+t[2]}return i}function un(e){return e.reduce(((e,t)=>e>t[1]+t[3]?e:t[1]+t[3]),0)}function cn(e){return e.reduce(((e,t)=>e>t[0]+t[2]?e:t[0]+t[2]),0)}function fn(e,t){if(e.margin){const n=Ut(e.margin)?jt(t,e.margin.x):e.margin;if(Array.isArray(n)){if(4===n.length)return n.map((e=>+e));if(2===n.length)return[+n[0],+n[1],+n[0],+n[1]]}else if("number"==typeof n)return[n,n,n,n]}return[0,0,0,0]}function pn(e,t,n){if(!t)return"";const r=e.styleMap.styles[t];if(r)return r;const o=`${n}${function(e,t){return e.styleMap.ids[t]||(e.styleMap.ids[t]=0),e.styleMap.ids[t]++}(e,n)}`;return e.styleMap.styles[t]=o}function gn(e,t,[n,r],o,i){if(e.report.classifyStyles){const s=[];return r&&s.push(pn(e,r,"h")),s.push(pn(e,n,i||"s")),` class="${t.concat(s).join(" ")}"${o?` style="${o}"`:""}`}{const e=`${n}${o||""}${r||""}`;return`${""+(t.length?` class="${t.join(" ")}"`:"")}${e?` style="${e}"`:""}`}}function hn(e,t,n,r){let o=`left:${t.x||0}rem;top:${t.y||0}rem;`,i="";e.width?"number"!=typeof e.width&&"percent"in e.width?o+=`width:${e.width.percent}%;`:o+=`width:${sn(e,t,n)}rem;`:o+=`right:${(e.margin||{})[1]||0}rem;`;const s=ln(e,t,n,r&&r.computedHeight,r&&r.lineSize)||1;if(r&&r.container&&r.computedHeight?i=`height:${s}rem;`:o+=`height:${s}rem;`,e.font&&0===e.font.line?o+="line-height:initial;":o+=""+(!r||!r.container||e.font&&e.font.line?`line-height:${e.font&&e.font.line||e.font&&e.font.size||an(e,t,n,r&&r.computedHeight,r&&r.lineSize)}rem;`:""),e.margin){const t=fn(e,n);(t[0]||t[1]||t[2]||t[3])&&(o+=`padding:${t[0]}rem ${t[1]}rem ${t[2]}rem ${t[3]}rem;`)}else e.font&&e.font.right&&(o+=`padding-right:${e.font.right}rem;`);return(r&&r.font||e.font)&&(o+=dn(r&&r.font||e.font)),e.border&&(o+=function(e,t){("string"==typeof e||"object"==typeof e&&("v"in e||"r"in e||"op"in e))&&(e=jt(t,e));if("number"==typeof e)return`border-bottom:${.0625*e}rem solid;`;if(function(e){return"object"==typeof e&&("top"in e||"bottom"in e||"left"in e||"right"in e)}(e))return`border-style:solid;border-width:${.0625*(e.top||0)}rem ${.0625*(e.right||0)}rem ${.0625*(e.bottom||0)}rem ${.0625*(e.left||0)}rem;`;if(Array.isArray(e)){if(1===e.length)return`border:${.0625*(+e[0]||0)}rem solid;`;if(2===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(3===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(4===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[3]||0)}rem;`}}(e.border,n)),[o,i]}function dn(e){if(!e)return"";let t="";return e.family&&(t+=`font-family:${e.family};`),e.color&&(t+=`color:${e.color};`),e.align&&(t+=`text-align:${e.align};`),e.line?t+=`line-height:${e.line}rem;`:e.size&&(t+=`line-height:${e.size}rem;`),e.size&&(t+=`font-size:${e.size}rem;`),e.weight&&(t+=`font-weight:${e.weight};`),e.pre&&(t+="white-space:pre-wrap;"),e.clamp&&(t+="white-space:nowrap;overflow:hidden;"),t}rn("row",((e,t,n,r,o,i)=>{let s;const a=sn(e,r,i),l=Ut(e.br)?jt(i,e.br.x):e.br;return r.availableX&&o[0][0]+o[0][2]+a>r.availableX?s={x:n[3],y:un(o),availableX:l?0:r.availableX&&r.availableX-n[3],maxX:r.maxX}:(s={x:o[0][0]+o[0][2],y:o[0][1],maxX:r.maxX},r.availableX&&(s.availableX=l?0:r.availableX-(o[0][0]+o[0][2])-a)),s.y-=t,r.availableY&&(s.availableY=r.availableY-o[0][1]),s}));function mn(e,t,n){let r=n[t.source||t.name]||{value:[]};t.base&&(r={value:jt(Nt(e,{value:r.value,special:{source:r}}),t.base)}),t.filter||t.sort||t.group?e.sources[t.name||t.source]=zt(r,t.filter,t.sort,t.group,e):e.sources[t.name||t.source]=r}const yn=P(W(U("\\{{"),(()=>"{{")),W(te(U("\\"),_(1)),(([,e])=>e))),bn=W(V(P(I("\\{",!0),yn,function(e,t,r){let o,i;return b((()=>(o=y(e),i=y(t))),(function(e,t,s,c){const f=c&&l(t,r),p=o.parse(e,t,s,f);if(!p.length)return p;const g=p[1];return i.parse(e,g,s).length?a(g,1&n&&"unexpected "+e.slice(g,p[1])):(f&&u(f,c,p),p)}))}(U("{"),U("{")))),(e=>({v:e.join("")})),"text");function vn(e){return W(te(U("{{"),ye,U(...e),ke,Ye,ye,U("}}")),(e=>[e[2],e[4]]),"tag")}const $n=B(ne(te(U("{{/"),T("}"),U("}}"))),"tag end"),xn={};function wn(e,t){return t?W(vn(e),(([e,t])=>({name:e,value:t}))):W(te(U("{{"),ye,U(...e),ye,U("}}")),(([,,e])=>({name:e})),"tag")}function An(e){return W(e,(e=>e.length<1?[{v:""}]:e))}const jn=wn(["else"]),kn=wn(["else if","elseif","elsif","elif"],!0),Mn=W(te(vn(["each"]),An(G(P(kn,jn,xn))),$n),(([e,t])=>({op:"each",args:[e[1]].concat(Cn(Nn(t)))}))),zn=W(te(vn(["if"]),An(G(P(kn,jn,xn))),$n),(([e,t])=>({op:"if",args:[e[1]].concat(Nn(t))}))),Dn=W(te(vn(["with"]),An(G(P(jn,xn))),$n),(([e,t])=>({op:"with",args:[e[1]].concat(Cn(Nn(t)))}))),Xn=W(te(vn(["unless"]),An(G(xn)),$n),(([e,t])=>({op:"unless",args:[e[1]].concat(Hn(t))}))),On=W(te((Yn=["case"],W(te(U("{{"),ye,U(...Yn),ke,Ye,ke,U("when"),ke,Ye,U("}}")),(e=>[e[2],e[4],e[8]]),"tag")),An(G(P(wn(["when"],!0),jn,xn))),$n),(([e,t])=>{const n={op:"case",args:e.slice(1).concat(Nn(t))};for(let e=1;e<n.args.length;e+=2){const t=n.args[e];"object"==typeof t&&"op"in t&&ht(t)}return n}));var Yn;const Sn=W(te(U("{{"),ye,Ye,ye,U("}}")),(([,,e])=>({op:"string",args:[e]})),"interpolator");function Cn(e){return e.length&&(e[0]={a:e[0]}),e}function Nn(e){const t=[];let n=[],r=!1;for(let o=0;o<e.length;o++){const i=e[o];"name"in i?(r=!0,n.length?t.push(Hn(n)):t.push({v:""}),i.value&&t.push(i.value),n=[]):n.push(i)}return n.length?t.push(Hn(n)):r&&t.push({v:""}),t.length%2&&t.push({v:""}),t}function Hn(e){return 1===e.length?e[0]:{op:"+",args:e}}xn.parser=P("content",bn,Mn,zn,Dn,On,Xn,Sn);const En=d(P(W(V(xn),(e=>Hn(e))),W(ye,(()=>({v:""})))),{trim:!0});Bt("label",((e,t,n)=>{It(t,"label",".label {position:absolute;box-sizing:border-box;}");let r,o="",i=(Array.isArray(e.text)?e.text:[e.text]).map((e=>{let n=jt(t,"object"==typeof e&&"text"in e?e.text:e);if("object"==typeof e&&"id"in e){let r=t.context;for(;r;)r.special&&r.special.values&&(r.special.values[e.id]||(r.special.values[e.id]=[])).push(n),r=r.parent}return o+=n,r=n,"object"==typeof e&&"text"in e?`<span${gn(t,[],[dn(e.font),""])}>${n}</span>`:n})).join("");if(e.id){let n=t.context;for(;n;)n.special&&n.special.values&&(n.special.values[e.id]||(n.special.values[e.id]=[])).push(o),n=n.parent}if(e.format&&e.format.name){const n=[{v:Array.isArray(e.text)&&1!==e.text.length?i:r},{v:e.format.name}];i=jt(t,{op:"format",args:n.concat(e.format.args||[])})}return`<span${gn(t,["label"],hn(e,n,t,{lineSize:!0}))}>${Pt(i)}</span>`})),Bt("container",((e,t,n,r)=>{let o;It(t,"container",".container {position:absolute;box-sizing:border-box;}"),e.height?"number"==typeof e.height&&(o=ln(e,n,t)):e.height="auto";const i=e.context?Rt(t,{value:jt(t,e.context)}):t,s=on(e,n,t)||n.availableX,a=function(e,t,n,r,o){if(Array.isArray(e.widgets)){let i="";const s=(r||{offset:0}).offset,a=[[0,s,0,0]],l=fn(e,t);a[0][0]+=l[3],a[0][1]+=l[0];for(let u=r&&r.state&&r.state.last||0;u<e.widgets.length;u++){const c=e.widgets[u];if(c.hide&&jt(t,c.hide))continue;let f=n&&ln(c,n,t);if(f>n.maxY&&(f=1),n&&n.availableY&&f>n.availableY)return(r=r||{offset:un(a)}).last=u,{output:i,continue:r,height:f+a.map((([e,t])=>e+t)).reduce(((e,t)=>t>e?t:e),0)};{const e=Array.isArray(o)&&o[u];let f=Array.isArray(e)?{x:e[0]+l[3],y:e[1]+l[0],maxX:n.maxX}:e||n;o&&"string"!=typeof o||(f=(o&&nn[o]||nn.row)(c,s,l,n,a,t)),f.maxX=f.maxX||n.maxX,f.maxY=f.maxY||n.maxY;const{x:p,y:g}=f,h=tn(c,t,f,r&&r.child);if("string"==typeof h&&!h||!h.cancel&&!h.output&&!h.height)continue;if("string"==typeof h)i+=h,a.unshift([p,g,sn(c,n,t),ln(c,n,t)]);else{if(h.cancel&&!a.length)return{output:"",cancel:!0};if(i+=h.output,a.unshift([p,g,h.width||sn(c,n,t),h.height||ln(c,n,t)]),h.continue)return(r=r||{offset:0}).child=h.continue,r.last=u,r.offset=un(a),{output:i,continue:r,height:un(a),width:cn(a)}}0===f.availableX&&(a[0][2]=f.maxX)}}return{output:i,height:ln(e,n,t)||un(a)-l[0],width:sn(e,n,t)||cn(a)-l[3]}}return{output:""}}(e,i,{x:0,y:0,availableX:s,availableY:o||n.availableY,maxX:s,maxY:n.maxY},r,e.layout);return a.cancel||(a.output=`<div${gn(t,["container"],hn(e,n,t,{computedHeight:o||a.height,container:!0}))}>${a.output}</div>`,a.height=o||a.height,a.width=s||a.width),a}),{container:!0}),Bt("repeater",((e,t,n,r)=>{It(t,"container",".container {position:absolute;box-sizing:border-box;}"),e.height||(e.height="auto");let o,i=n.availableY,s=n.availableX,a="",l=!1;const u=fn(e,t);let c,f=r&&r.state&&"header"!==r.state.part?0:u[0];i-=f;let p,g=!1,h=r&&r.state&&r.state.src;if(!h){if(!e.source)return"";h=Ot(e.source)?jt(t,e.source):zt(t.context.root.sources[e.source.source]||{value:[]},e.source.filter,e.source.sort,e.source.group,t.context).value,(t.context.special||(t.context.special={})).values||(t.context.special.values={})}if(Array.isArray(h))p=h;else{if(!h||!Array.isArray(h.value))return{output:"",height:0};c=h,p=c.value,e.group&&(g=e.group.length>c.grouped&&e.group.length-c.grouped-1)}if(c&&(!r||!r.state||"group"===r.state.part)&&(!1!==g&&(o=tn(e.group[g],Rt(t,{value:c,special:{group:c.group,level:c&&c.level}}),{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY})),o)){if(o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"group",src:h,current:0}}};i-=o.height,a+=o.output,f+=o.height}if(e.header&&(r&&r.state&&"body"===r.state.part&&!1!==e.headerPerPage&&(!c||!c.grouped)||(!c||!c.grouped)&&(!r||!r.state||"header"===r.state.part||"group"===r.state.part))){if(o=tn(e.header,t,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"header",src:h,current:0}}};i-=o.height,a+=o.output,f+=o.height}let d=r&&r.state&&r.state.context||Rt(t,{special:{level:c&&c.level,group:c&&c.group,values:{}}});if(!r||!r.state||"footer"!==r.state.part){let u=0,g=0;for(let m=r&&r.state&&r.state.current||0;m<p.length;m++){const y=c&&c.grouped?Rt(d,{value:p[m],special:{index:m,values:{}}}):Rt(d,{value:p[m],special:{index:m}});if(c&&c.grouped){const t=r&&r.child||{offset:0,state:{current:0,src:p[m],part:"group"}};o=tn(e,y,{x:0,y:f,availableX:s-u,availableY:i,maxX:n.maxX,maxY:n.maxY},t)}else o=tn(e.row,y,{x:u,y:f,availableX:s-u,maxX:n.maxX,availableY:i,maxY:n.maxY});if(r&&(r.child=null),o.width&&o.width<=s-u&&o.width!==s)u+=o.width,o.height>g&&(g=o.height);else if(o.width&&u&&o.width>s-u){f+=g,i-=g,g=0,u=0,m--;continue}if(o.height>i||o.cancel)return l?{output:`<div${gn(t,["container","repeat"],hn(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"body",src:h,current:m,context:d}}}:{output:"",height:f,continue:{offset:f,state:{part:r.state.part,src:h,current:m,context:d}}};if(g||(i-=o.height),g||(f+=o.height),a+=o.output,l=!0,c&&o.continue)return{output:`<div${gn(t,["container","repeat"],hn(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"body",src:h,current:m,context:d},child:o.continue}}}}if(e.footer){const s=d&&d.context||r&&r.state&&r.state.context&&r.state.context.context,l=Rt(t,{special:{source:c&&c.grouped?c.all:p,level:c&&c.level,grouped:c&&c.grouped,values:(s&&s.special||{}).values}});if(o=c?e.groupEnds&&e.groupEnds[c.grouped]?tn(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}):{output:"",height:0}:tn(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:`<div${gn(t,["container","repeat"],hn(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"footer",src:h,current:0,context:d}}};a+=o.output,f+=o.height}return{output:`<div${gn(t,["container","repeat"],hn(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f}}),{container:!0}),Bt("image",((e,t,n)=>(It(t,"image",".image {position:absolute;}"),`<img src="${jt(t,e.url)}"${gn(t,["image"],hn(e,n,t))} />`))),Bt("measured",((e,t,n,r)=>{It(t,"measured",".measured {position:absolute;box-sizing:border-box;white-space:pre-wrap;font-family:serif;font-size:0.83rem}");const o=jt(t,e.text),i=en(o,on(e,n,t)||n.availableX,e.font);if(!r&&i>n.availableY)return{output:"",height:0,continue:{state:{},offset:0}};{let r=hn(e,n,t,{computedHeight:i,container:!0});return r[0]="line-height:1em;"+r[0],{height:i,output:`<span class="measured"${gn(t,["label"],r)}>${Pt(o)}</span>`}}})),Bt("html",((e,t,n)=>{It(t,"html",".html {position:absolute;box-sizing:border-box;overflow:hidden;line-height:1rem;}");const r=jt(Rt(t,{parser:En}),e.html);return`<div${gn(t,["html"],hn(e,n,t,{container:!0}))}>${r}</div>`}));const qn=/(\d)(?=(\d{3})+\.)/g,Ln=/(\d)(?=(\d{3})+$)/g,Fn=/^[-0-9\\.,]+$/;function _n(e,t=2,n=","){return e="number"!=typeof e?parseFloat(e||""):e,isNaN(e)?"":(e=e.toFixed(t),0===t&&(e=e.replace(/\..*/,"")),n?e.replace(-1===e.indexOf(".")?Ln:qn,"$1"+n):e)}const Tn=/y+|M+|d+|E+|H+|m+|s+|k+|h+|a+|S+/g,In=["January","February","March","April","May","June","July","August","September","October","November","December"],Un=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let Rn;function Zn(e,t){if(!e)return"";if("string"==typeof e)e=new Date(e);else if("[object Date]"!==Object.prototype.toString.call(e))return"";const n=e;return t||(t=Rn),t?t.replace(Tn,(e=>{if("y"===e[0])return e.length<=2?(""+n.getFullYear()).substr(2,2):""+n.getFullYear();if("M"===e[0])return 1===e.length?""+(n.getMonth()+1):2===e.length?n.getMonth()<9?"0"+(n.getMonth()+1):""+(n.getMonth()+1):3===e.length?In[n.getMonth()].substr(0,3):In[n.getMonth()];if("d"===e[0])return 1===e.length?""+n.getDate():2===e.length?n.getDate()<=9?"0"+n.getDate():""+n.getDate():Jn(n.getDate());if("E"===e[0])return 1===e.length?""+(n.getDay()+1):2===e.length?Un[n.getDay()].substr(0,3):Un[n.getDay()];if("H"===e[0])return 1===e.length?""+n.getHours():n.getHours()<=9?"0"+n.getHours():""+n.getHours();if("m"===e[0])return 1===e.length?""+n.getMinutes():n.getMinutes()<=9?"0"+n.getMinutes():""+n.getMinutes();if("s"===e[0])return 1===e.length?""+n.getSeconds():n.getSeconds()<=9?"0"+n.getSeconds():""+n.getSeconds();if("S"===e[0]){const t=n.getMilliseconds();return 1===e.length?""+t:t<10?"00"+t:t<100?"0"+t:""+t}if("k"===e[0]||"h"===e[0]){let e=""+n.getHours()%12;return"0"===e&&(e="12"),""+e}return"a"===e[0]?n.getHours()>11?"PM":"AM":void 0})):new Date(+e-6e4*e.getTimezoneOffset()).toISOString().substr(0,10)}function Jn(e,t){let n=""+(e=_n(e,0,t));if(n=n.substr(-2,2),n.length>1&&"1"===n[0])return e+"th";switch(n[1]||n[0]){case"1":return e+"st";case"2":return e+"nd";case"3":return e+"rd";default:return e+"th"}}function Pn(e,t){return{type:"value",names:e,apply:t}}Zn.setDefault=function(e){Rn=e};const Wn=/^\s*$/;function Bn(e){return!isNaN(e)&&!Wn.test(e)}function Gn(e){return isNaN(e)||!e?0:+e}function Vn(e,t){return e==t}function Kn(e,t,n,r){if("string"!=typeof t&&(t=""+t),!Bn(n))return t;r||(r=" "),"string"!=typeof r&&(r=""+r),r.length<1&&(r=" ");for(let o=t.length;o<n;o=t.length)e?t=r+t:t+=r;return t}Mt(Pn(["is","is-not","==","!="],((e,t)=>{const[n,r]=t,o=Vn(n,r);return"is"===e||"=="===e?o:!o})),Pn(["not"],((e,t)=>!t[0])),Pn(["<",">","<=",">="],((e,t)=>{let[n,r]=t;return n instanceof Date||r instanceof Date?"number"==typeof n||"number"==typeof r?(n=+n,r=+r):"string"==typeof n||"string"==typeof r?(n=new Date(n),r=new Date(r)):"f"in n&&"o"in n?(n=qt(n)["<"===e[0]?1:0],r=new Date(r)):"f"in r&&"o"in r&&(r=qt(r)["<"===e||">="===e?0:1],n=new Date(n)):Lt(n)?(n=qt(n)["<"===e[0]?1:0],r=Lt(r)?qt(r)["<"===e||">="===e?0:1]:new Date(r)):Lt(r)&&(r=qt(r)["<"===e||">="===e?0:1],n=new Date(n)),"<"===e?n<r:">"===e?n>r:"<="===e?n<=r:">="===e&&n>=r})),Pn(["like","not-like","ilike","not-ilike"],((e,t)=>{const[n,r,o]=t;let i=!1;const s="string"==typeof r?[r]:r,a="free"===o||"object"==typeof o&&o.free;if(!Array.isArray(s))return!1;for(let t=0;t<s.length&&!i;t++){const r=s[t];if("string"!=typeof r)continue;const o=new RegExp(`${a?"":"^"}${r.replace(/[\s\%\*]+/g,".*").replace(/\?/g,".")}${a?"":"$"}`,~e.indexOf("ilike")?"i":"");i=Array.isArray(n)?!!n.find((e=>o.test(e))):o.test(n)}return"like"===e||"ilike"===e?i:!i})),Pn(["in","not-in"],((e,t)=>{const[n,r]=t;if(Lt(r)){const t=qt(r),o=Lt(n)?qt(n)[0]:new Date(n),i=o>=t[0]&&o<=t[1];return"in"===e?i:!i}if(!Array.isArray(r)&&"string"!=typeof r)return"in"===e?n==r:n!=r;if(Array.isArray(n)&&Array.isArray(r)){const t=n.reduce(((e,t)=>e&&~r.indexOf(t)),!0);return"in"===e?!!t:!t}const o=!!~r.indexOf(n);return"in"===e?o:!o})),Pn(["contains","does-not-contain"],((e,t)=>{const[n,r]=t;if(Lt(n)){const t=qt(n),o=Lt(r)?qt(r)[0]:new Date(r),i=o>=t[0]&&o<=t[1];return"contains"===e?i:!i}if(!Array.isArray(n)&&"string"!=typeof n)return!1;if(Array.isArray(r)&&Array.isArray(n)){const t=r.reduce(((e,t)=>e&&~n.indexOf(t)),!0);return"contains"===e?!!t:!t}const o=!!~n.indexOf(r);return"contains"===e?o:!o})),Pn(["clamp"],((e,[t,n,r])=>n<t?t:n>r?r:n)),Pn(["get"],((e,t,n)=>{const[r,o]=t,i=Nt(n,{value:r});return"string"==typeof(s=o)||"object"==typeof s&&Array.isArray(s.k)?wt(i,o):jt(i,o);var s})),Pn(["array"],((e,t)=>t)),Pn(["object"],((e,t)=>{const n={};for(let e=0;e<t.length;e+=2)n[t[e]]=t[e+1];return n})),Pn(["split"],((e,[t,n])=>"string"!=typeof t?[t]:t.split(n||""))),Pn(["filter"],((e,t,n)=>{let[r,o,i,s]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return[];r=r.value}return zt({value:r},o,i,s,n).value})),Pn(["source"],((e,t)=>{const[n]=t;return{value:n}})),Pn(["group"],((e,t,n)=>{n=n||new Ct({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return zt({value:r},null,null,o,n).value})),Pn(["sort"],((e,t,n)=>{n=n||new Ct({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return zt({value:r},null,o,null,n).value})),Pn(["time-span","time-span-ms"],((e,t)=>{let n=t[0],r="object"==typeof t[t.length-1]?t[t.length-1].unit:null;"string"!=typeof r&&(r=null),r=r&&("y"===r[0]?"y":"w"===r[0]?"w":"d"===r[0]?"d":"h"===r[0]?"h":"s"===r[0]?"s":"m"===r||"mo"===r.substr(0,2)?"m":"mm"===r||"min"===r.substr(0,3)?"mm":"ms"===r||"mil"===r.substr(0,3)?"ms":null);const o="number"==typeof t[1]?t[1]:r?0:1;if(r)return o?(n/we[r]).toFixed(o):Math.floor(n/we[r]);{const e=[0,0,0,0,0,0];e:{if(""===n||isNaN(n))return"";if(n=Math.abs(+n),e[0]=Math.floor(n/we.w),o<e.filter((e=>e)).length)break e;if(n%=we.w,e[1]=Math.floor(n/we.d),o<e.filter((e=>e)).length)break e;if(n%=we.d,e[2]=Math.floor(n/we.h),o<e.filter((e=>e)).length)break e;if(n%=we.h,e[3]=Math.floor(n/we.mm),o<e.filter((e=>e)).length)break e;if(n%=we.mm,e[4]=Math.floor(n/we.s),o<e.filter((e=>e)).length)break e;e[5]=n%we.s}let t="";return e[0]&&(t+=`${e[0]} week${e[0]>1?"s":""}`),e[1]&&(t+=`${t.length?" ":""}${e[1]} day${e[1]>1?"s":""}`),e[2]&&(t+=`${t.length?" ":""}${e[2]} hour${e[2]>1?"s":""}`),e[3]&&(t+=`${t.length?" ":""}${e[3]} minute${e[3]>1?"s":""}`),e[4]&&(t+=`${t.length?" ":""}${e[4]} second${e[4]>1?"s":""}`),e[5]&&(t+=`${t.length?" ":""}${e[5]} millisecond${e[5]>1?"s":""}`),t}})),Pn(["string"],((e,[t])=>{if(null==t)return"";if(Array.isArray(t))return t.join(", ");let n=""+t;return"[object"===n.slice(0,7)?JSON.stringify(t):n})),Pn(["call"],((e,t)=>{if(null!=t[0]&&"string"==typeof t[1]&&"function"==typeof t[0][t[1]]){const e=t.shift();return e[t.shift()].apply(e,t)}if("function"==typeof t[0]){return t.shift().apply(null,t)}})),Pn(["intersect"],((e,[t,n])=>{if(!Array.isArray(t)||!Array.isArray(n))return[];const r=[];let o;for(let e=0;e<t.length;e++)o=t[e],~n.indexOf(o)&&!~r.indexOf(o)&&r.push(o);for(let e=0;e<n.length;e++)o=n[e],!~r.indexOf(o)&&~t.indexOf(o)&&r.push(o);return r}))),Mt(Pn(["+"],((e,t)=>{if(1===t.length)return Lt(t[0])?+Ft(t[0]):t[0]?parseFloat(t[0]):0;if(Array.isArray(t[0]))return t[0].concat.apply(t[0],t.slice(1));if(Lt(t[0])&&t.length>1&&t.slice(1).reduce(((e,t)=>e&&_t(t)),!0))return t.slice(1).reduce(((e,t)=>Tt(e,t,1)),Ft(t[0]));if("number"!=typeof t[0]&&t.length>1&&_t(t[0]))return t.slice(1).reduce(((e,t)=>function(e,t){if("number"==typeof e&&"number"==typeof t)return e+t;{const n={d:[]};if("number"==typeof e)n.d[6]=e;else for(let t=0;t<7;t++)e.d[t]&&(n.d[t]=e.d[t]);if("number"==typeof t)n.d[6]=(n.d[6]||0)+t;else for(let e=0;e<7;e++)t.d[e]&&(n.d[e]=(n.d[e]||0)+t.d[e]);return n}}(e,t)),t[0]);return t.reduce(((e,t)=>e&&Bn(t)),!0)?t.reduce(((e,t)=>e+ +t),0):t.reduce(((e,t)=>e+(null==t?"":t)),"")})),Pn(["-"],((e,t)=>{const n=t.shift();if(Lt(n)){if(t.reduce(((e,t)=>e&&Lt(t)),!0))return t.reduce(((e,t)=>e-+Ft(t)),+Ft(n));if(t.reduce(((e,t)=>e&&_t(t)),!0))return t.reduce(((e,t)=>Tt(e,t,-1)),Ft(n))}return t.reduce(((e,t)=>e-(Bn(t)?+t:0)),Bn(n)?+n:0)})),Pn(["*"],((e,t)=>{const n=t.shift();if(!Bn(n)){if("string"==typeof n&&1===t.length&&Bn(t[0])&&+t[0]>0){let e="";for(let r=0;r<t[0];r++)e+=n;return e}return 0}return t.reduce(((e,t)=>e*(Bn(t)?+t:0)),+n)})),Pn(["/","/%"],((e,t)=>{const n=t.shift();return isNaN(n)?0:e.length>1?t.reduce(((e,t)=>Math.floor(e/(isNaN(t)?1:+t))),+n):t.reduce(((e,t)=>e/(isNaN(t)?1:+t)),+n)})),Pn(["%"],((e,t)=>{const n=t.shift();return t.reduce(((e,t)=>e%(isNaN(t)?1:+t)),isNaN(n)?0:+n)})),Pn(["pow","**"],((e,t)=>{const n=t.pop(),r=Math.pow(t.pop(),n);return t.reverse().reduce(((e,t)=>Math.pow(t,e)),r)})),Pn(["abs"],((e,t)=>"number"!=typeof t[0]?t[0]:Math.abs(t[0]))),Pn(["round"],((e,t)=>Math.round(t[0]))),Pn(["floor"],((e,t)=>Math.floor(t[0]))),Pn(["ceil"],((e,t)=>Math.ceil(t[0]))),Pn(["rand","random"],((e,[t,n,r])=>{let o;return null==t?Math.random():("number"!=typeof n?o=Math.random()*t:"number"==typeof n&&(o=Math.random()*(n-t)+t),!0===n||!0===r?o:Math.round(o))})));const Qn=/^\s*/,er=/\s*$/,tr=/([\.\[\]\{\}\(\)\^\$\*\+\-])/g;Mt(Pn(["padl","padr"],((e,t)=>{let[n,r,o]=t;return Kn("padl"===e,n,r,o)})),Pn(["trim","triml","trimr"],((e,t)=>{let[n]=t;return n=""+n,"trim"!==e&&"trimr"!==e||(n=n.replace(er,"")),"trim"!==e&&"triml"!==e||(n=n.replace(Qn,"")),n})),Pn(["slice","substr"],((e,[t,n,r])=>{if(t&&"function"==typeof t.slice)return t.slice(n,r)})),Pn(["len","length"],((e,[t])=>t&&"length"in t?t.length:0)),Pn(["replace","replace-all"],((e,[t,n,r,o])=>{t=""+t;const i="string"==typeof o;return"replace-all"===e||i?t.replace(new RegExp(i?n:n.replace(tr,"\\$1"),("replace"===e||o&&~o.indexOf("g")?o:(o||"")+"g")||"g"),r):t.replace(n,r)})),Pn(["reverse"],((e,[t])=>{if("string"==typeof t){let e="";for(let n=0;n<t.length;n++)e=t[n]+e;return e}if(Array.isArray(t))return t.reverse()})),Pn(["keys"],((e,[t,n])=>{if(!t)return[];if(n){const e=[];for(const n in t)e.push(n);return e}return Object.keys(t)})),Pn(["values"],((e,[t])=>t?Object.values(t):[])),Pn(["date"],((e,[t])=>void 0!==t?Lt(t)?Ft(t):new Date(t):new Date)),Pn(["upper","lower"],((e,[t])=>(t=null==t?"":t,"upper"===e?(""+t).toUpperCase():(""+t).toLowerCase()))),Pn(["format","fmt"],((e,t)=>{let[n,r,...o]=t;const i=Ht[r];return i?i(n,o):""+n}))),Mt({type:"checked",names:["and","&&"],checkArg:(e,t,n,r)=>r?"continue":{result:r},apply:(e,t)=>t[t.length-1]},{type:"checked",names:["or","||"],checkArg:(e,t,n,r)=>r?{result:r}:"continue",apply:()=>!1},{type:"checked",names:["if","unless"],checkArg:(e,t,n,r)=>t%2==0?t===n?{result:r}:("if"===e?!r:r)?{skip:1}:"continue":{result:r},apply(){}},{type:"checked",names:["case","switch"],checkArg(e,t,n,r,o,i){if(0===t)return(o.special||(o.special={})).case=r,"continue";if(t%2==1){if(t===n)return{result:r};if(Vn(r,o.special.case))return"continue";if(Yt(i)&&"op"in i&&!0===r)return"continue";if(Yt(r)){const e=jt(o,r);if(Vn(e,o.special.case))return"continue";if(!0===e)return"continue"}return{skip:1}}return{result:r}},apply(){},extend:!0},{type:"checked",names:["each"],checkArg:(e,t,n,r)=>0===t?Array.isArray(r)||"object"==typeof r?"continue":{skip:1}:1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply(e,[t,n],r){if(r=r||new Ct,Array.isArray(t)){const e=t.length-1;return t.map(((t,o)=>jt(Nt(r,{value:t,special:{last:e,index:o,key:o,"last-key":e}}),n,t))).join("")}{const e=Object.entries(t),o=e[e.length-1][0],i=e.length-1;return Object.entries(t).map((([e,t],s)=>jt(Nt(r,{value:t,special:{last:i,"last-key":o,index:s,key:e}}),n,t))).join("")}}},{type:"checked",names:["with"],checkArg:(e,t,n,r)=>0===t&&"object"==typeof r?"continue":1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply:(e,[t,n],r)=>jt(Nt(r=r||new Ct,{value:t}),n,t)},{type:"checked",names:["coalesce","coalesce-truth"],checkArg:(e,t,n,r)=>"coalesce"===e&&null!=r||r?{result:r}:"continue",apply(){}}),Mt({type:"aggregate",names:["avg"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+Gn(n[0]?jt(r,n[0],t):t)),0)/t.length},{type:"aggregate",names:["sum"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+Gn(n[0]?jt(r,n[0],t):t)),0)},{type:"aggregate",names:["count"],apply:(e,t,n,r)=>n.length?t.filter((e=>jt(r,n[0],e))).length:t.length},{type:"aggregate",names:["min","max"],apply:(e,t,n,r)=>(n[0]&&(t=t.map((e=>jt(r,n[0],e)))),Math[e].apply(Math,t))},{type:"aggregate",names:["first","nth","last"],apply(e,t,n,r){let o,i=0;if("first"===e)o=t[0];else if("last"===e)o=t[t.length-1];else if(n[0]){const e=jt(r,n[0]);"number"==typeof e&&(o=t[e],i=1)}return n[i]&&(o=jt(r,n[i])),o}},{type:"aggregate",names:["map"],apply:(e,t,n,r)=>n[0]?t.map((e=>jt(r,n[0],e))):t},{type:"aggregate",names:["unique","unique-map"],apply(e,t,n,r){const o=[],i=[];for(const e of t){const t=n[0]?jt(r,n[0],e):e;~o.indexOf(t)||(o.push(t),i.push(e))}return"unique"===e?i:o}},{type:"aggregate",names:["join"],apply:(e,t,n,r)=>n.length>1?t.map((e=>jt(r,n[0],e))).join(jt(r,n[1])):t.join(jt(r,n[0]))},{type:"aggregate",names:["find"],apply(e,t,n,r){if(n[0]){if("object"==typeof n[0]&&"a"in n[0])return t.find((e=>jt(r,n[0],e)));{const e=jt(r,n[0]);return t.find((t=>t==e))}}}}),Et("dollar",((e,[t,n])=>function(e,t,n=2,r=",",o="$"){return e&&Fn.test(e)&&+e>0?`${o}${_n(e,n,r)}`:void 0!==t?t:e}(e,void 0,t,n))),Et("date",((e,[t])=>Zn(Lt(e)?Ft(e):e,t))),Et("integer",((e,[t])=>_n(e,0,t))),Et("int",((e,[t])=>_n(e,0,t))),Et("number",((e,[t,n])=>_n(e,t,n))),Et("num",((e,[t,n])=>_n(e,t,n))),Et("ordinal",((e,[t])=>Jn(e,null==t?",":t))),Et("phone",(e=>{return"number"==typeof(t=e)&&(t=t.toString()),7===(t=(t=t||"").replace(/[^\d]/g,"")).length?`${t.substr(0,3)}-${t.substr(3,4)}`:10===t.length?`(${t.substr(0,3)}) ${t.substr(3,3)}-${t.substr(6,4)}`:11===t.length?`${t[0]}-${t.substr(1,3)}-${t.substr(4,3)}-${t.substr(7,4)}`:t;var t})),Et("or",((e,[t])=>e||t)),Et("padl",((e,[t,n])=>Kn(!0,e,t,n||"0"))),Et("padr",((e,[t,n])=>Kn(!1,e,t,n||" "))),Et("trim",(e=>e?(""+e).trim():e));{const e=/\s+/g,t=/\b\w/g,n=/[^a-zA-Z0-9]+([a-zA-Z0-9])/g,r=/[^\sa-zA-Z0-9]/g,o=/([a-z])([A-Z])/g,i=/\s([^\s])/g;function nr(e){return e.replace(n,((e,t)=>t?" "+t:"")).replace(r,"").replace(o,((e,t,n)=>`${t} ${n}`)).trim()}Et("case",((n,r)=>{let o=(""+(n||"")).trim();for(const n of r)if("upper"===n||"up"===n)o=o.toUpperCase();else if("lower"===n||"down"===n)o=o.toLowerCase();else if("snake"===n)o=nr(o).toLowerCase().replace(e,"_");else if("kebab"===n)o=nr(o).toLowerCase().replace(e,"-");else if("pascal"===n){const e=nr(o);o=e[0].toUpperCase()+e.toLowerCase().substr(1).replace(i,((e,t)=>(t||"").toUpperCase()))}else if("camel"===n){const e=nr(o);o=e[0].toLowerCase()+e.toLowerCase().substr(1).replace(i,((e,t)=>(t||"").toUpperCase()))}else"proper"===n&&(o=/[a-z]/.test(o)?o.trim().replace(t,(e=>e.toUpperCase())):o.toLowerCase().trim().replace(t,(e=>e.toUpperCase())));return o}))}const rr=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function or(e,t){const n=sr(e);if(Array.isArray(e)){const r=[];if(r.push({type:"number",name:"length"}),!t&&e.length>0){const t=or(e[0]);t.fields?r.push({type:t.root,fields:t.fields,name:"0"}):r.push({type:t.root,name:"0"})}return{root:n,fields:r}}if("object"==typeof e){const r=[];for(const n in e)r.push(ir(n,e[n],t));return{root:n,fields:r}}return{root:n}}function ir(e,t,n){const r=sr(t);if(!n&&(~r.indexOf("object")||"array"===r)){const n=or(t);return n.fields?{type:r,fields:n.fields,name:e}:{type:r,name:e}}return{type:sr(t),name:e}}function sr(e){return"string"==typeof e?rr.test(e)?"date":"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":Array.isArray(e)?e.length<1?"array":"string"==typeof e[0]?rr.test(e[0])?"date[]":"string[]":"number"==typeof e[0]?"number[]":"boolean"==typeof e[0]?"boolean[]":"object"==typeof e[0]&&e[0]instanceof Date?"date[]":"object"==typeof e[0]?"object[]":"array":"object"==typeof e?e instanceof Date?"date":"object":"any"}const ar=new RegExp(`[${je.split("").map((e=>"\\"+e)).join("")}]`);let lr=!1,ur=!1,cr=!1,fr=!1,pr=!1,gr=!1,hr=!1,dr=!1,mr=0;const yr=["**","*","/%","/","%","+","-",">=",">","<=","<","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain","is","is-not","==","!=","and","&&","or","||"],br=["+","not"],vr={"**":1,"*":2,"/%":2,"/":2,"%":2,"+":3,"-":3,">=":4,">":4,"<=":4,"<":4,in:4,like:4,ilike:4,"not-in":4,"not-like":4,"not-ilike":4,contains:4,"does-not-contain":4,is:5,"is-not":5,"==":5,"!=":5,and:6,"&&":6,or:7,"||":7},$r=/^[-a-zA-Z_$0-9]/;function xr(e,t,n){if(e=""+e,!t)return e;for(let r=e.length;r<n;r++)e=t+e;return e}function wr(e){if(null==e)return"";if("string"==typeof e)return e;if(hr&&("op"in e||"r"in e)){if(!("op"in e)){hr=!1;const t=`{{${wr(e)}}}`;return hr=!0,t}if("if"===e.op||"with"===e.op||"unless"===e.op||"each"===e.op)return function(e){hr=!1;const t=wr(e.args[0]);hr=!0;const n=wr(e.args[1]);let r=`{{${e.op} ${t}}}${"with"===e.op||"each"===e.op?n.slice(2):n}`;if("unless"===e.op)return r+"{{/}}";for(let t=2;t<e.args.length;t++)if(t+1>=e.args.length){const n=e.args[t];if("object"==typeof n&&"v"in n&&""===n.v)continue;r+="{{else}}"+wr(n)}else hr=!1,r+=`{{elseif ${wr(e.args[t++])}}}`,hr=!0,r+=wr(e.args[t]);return r+="{{/}}",r}(e);if("case"===e.op)return function(e){const t=e.args.length-1,n=e.args.map(((e,n)=>(hr=!0,0!==n&&n%2!=1||(hr=!1),n===t&&(hr=!0),"object"==typeof e&&"op"in e?wr(e).replace(Sr,"_"):wr(e))));hr=!0;let r=`{{${e.op} ${n[0]} when ${n[1]}}}`;for(let e=2;e<=t;e++)r+=e===t?"{{else}}"+n[e]:e%2==1?`{{when ${n[e]}}}`:n[e];return r+="{{/}}",r}(e);if(e.op){if("+"===e.op)return e.args.map((e=>wr(e))).join("");{hr=!1;const t=`{{${wr("string"===e.op?e.args[0]:e)}}}`;return hr=!0,t}}}else{if("r"in e){if("string"==typeof e.r)return/^[0-9]/.test(e.r)?"."+e.r:e.r;{const t=e.r;return`${function(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}("^",t.u||0)}${t.p||""}${t.k.map(((e,t)=>"string"==typeof e||"number"==typeof e?`${t?".":""}${e}`:`[${wr(e)}]`)).join("")}`}}if("op"in e)return function(e){if(pr||"array"!==e.op){if(gr||"object"!==e.op||!e.args||e.args.find(((e,t)=>t%2==0&&("string"==typeof e||!("v"in e)||"string"!=typeof e.v)))){if(cr)return`(${e.op}${e.args&&e.args.length?" "+e.args.map((e=>wr(e))).join(fr?", ":" "):""})`;if("if"===e.op||"unless"===e.op&&e.args&&e.args.length>2)return function(e){if(!e.args||e.args.length<2)return"false";let t="";mr++;const n=e.args.map((e=>wr(e)));mr--;const r=n.find((e=>e.length>30||~e.indexOf("\n")))||"";let o=dr?"":n.length>3||r?"\n"+xr("","  ",mr):"";const i=r&&o+"  "||" ";o=o||" ";const s=n.length-1;for(let e=0;e<=s;e++)t+=0===e?`${o&&mr>0?o:""}if ${n[e++]} then${i}${Yr(i,n[e])}`:e===s?`${o}else${i}${Yr(i,n[e])}`:`${o}elif ${n[e++]} then${i}${Yr(i,n[e])}`;mr&&(t+=o+"end");return t}(e);if("case"===e.op&&e.args&&e.args.length>2)return function(e){if(!e.args||e.args.length<2)return"false";let t="";mr++;const n=e.args.map((e=>"object"==typeof e&&"op"in e?wr(e).replace(Sr,"_"):wr(e)));mr--;const r=n.find((e=>e.length>30||~e.indexOf("\n")))||"";let o=dr?"":n.length>3||r?"\n"+xr("","  ",mr):"";const i=o?o+"  ":" ",s=r&&i+"  "||" ";o=o||" ";const a=n.length-1;for(let e=0;e<=a;e++)t+=0===e?`${o&&mr>0?o:""}case ${n[e]}`:e===a?`${i}else${s}${Yr(s,n[e])}`:`${i}when ${n[e++]} then${s}${Yr(s,n[e])}`;mr&&(t+=o+"end");return t}(e);if("+"===e.op&&e.args&&e.args.length>0&&jr(e.op,e)){return`'${kr(e.op,e).map((e=>"string"!=typeof e&&"v"in e&&"string"==typeof e.v?e.v.replace(/[\$']/g,(e=>"\\"+e)):`{${wr(e)}}`)).join("")}'`}if(("fmt"===e.op||"format"===e.op)&&e.args&&"object"==typeof e.args[1]&&"v"in e.args[1]&&"string"==typeof e.args[1].v){const t=e.args[0];let n=wr(t);return"string"!=typeof t&&"op"in t&&(yr.includes(t.op)||br.includes(t.op))&&(n=`(${n})`),`${n}#${[e.args[1].v].concat(e.args.slice(2).map((e=>wr(e)))).join(",")}`}if(yr.includes(e.op)&&e.args&&e.args.length>1){const t=e.args[0],n=e.args.slice(1);return`${Ar(e.op,t,1)} ${e.op} ${n.map((t=>Ar(e.op,t,2))).join(` ${e.op} `)}`}if(br.includes(e.op)&&e.args&&1===e.args.length){const t=e.args[0];return"string"!=typeof t&&"op"in t&&(yr.includes(t.op)||br.includes(t.op))?`${e.op}(${wr(t)})`:`${e.op}${$r.test(e.op)?" ":""}${wr(t)}`}return $r.test(e.op)?`${e.op}(${e.args&&e.args.map((e=>wr(e))).join(fr?", ":" ")||""})`:`(${e.op}${e.args&&e.args.length?" "+e.args.map((e=>wr(e))).join(fr?", ":" "):""})`}{let t="{";if(e.args)for(let n=0;n<e.args.length;n+=2)t+=`${n>0?" ":""}${ur=!0,wr(e.args[n])}:${ur=!1,wr(e.args[n+1])}`;return t+="}",t}}return`[${e.args?e.args.map((e=>wr(e))).join(fr?", ":" "):""}]`}(e);if("a"in e)return"=>"+wr(e.a);if("v"in e)return function(e){if("string"==typeof e.v)return hr?e.v:!ur&&lr||ar.test(e.v)||!e.v.length?~e.v.indexOf("'")?~e.v.indexOf("`")?~e.v.indexOf('"')?`'${e.v.replace(/['\$]/g,(e=>"\\"+e))}'`:`"${e.v}"`:`\`${e.v.replace(/[\$`]/g,(e=>"\\"+e))}\``:`'${e.v.replace(/[\$']/g,(e=>"\\"+e))}'`:`${ur?"":":"}${e.v}`;if("number"==typeof e.v||"boolean"==typeof e.v)return""+e.v;if("undefined"===e.v)return"undefined";if("null"===e.v)return"null";if(Array.isArray(e.v))return pr?`(array${e.v.length?" ":""}${e.v.map((e=>wr({v:e}))).join(fr?", ":" ")})`:`[${e.v.map((e=>wr({v:e}))).join(fr?", ":" ")}]`;if("object"==typeof e.v){if(Lt(e.v))return Xr(e.v);return`{${Object.keys(e.v).map((t=>`${ur=!0,wr({v:t})}:${ur=!1,wr({v:e.v[t]})}`)).join(fr?", ":" ")}}`}}(e);if(Lt(e))return Xr(e)}}function Ar(e,t,n){if("**"===e&&1===n&&"string"!=typeof t&&"op"in t&&"**"===t.op)return`(${wr(t)})`;if("string"!=typeof t&&"op"in t){if(yr.includes(t.op)&&vr[t.op]>vr[e])return`(${wr(t)})`;if("if"===t.op||"unless"===t.op||"fmt"===t.op||"format"===t.op)return`(${wr(t)})`}return wr(t)}function jr(e,t){if(t.args&&t.args.find((e=>"object"==typeof e&&"string"==typeof e.v)))return!0;if(!t.args||!t.args.length)return!1;const n=t.args[0];return"object"==typeof n&&"op"in n&&n.op===e&&jr(e,n)}function kr(e,t,n=[]){if(t.args&&t.args.length){let r=0;for(;r<t.args.length&&("object"==typeof t.args[r]&&"string"==typeof t.args[r].v);r++)n.push(t.args[r]);const o=t.args[r];"object"==typeof o&&"op"in o&&o.op===e?kr(e,o,n):n.push(o),n.push.apply(n,t.args.slice(r+1))}return n}function Mr(e,t){if(null==t)return"";t*=e;const n=Math.abs(t),r=Math.floor(n/60),o=n%60;return t?`${t>0?"-":"+"}${r}${o?":"+xr(o,"0",2):""}`:"Z"}const zr=["w","d","h","mm","s"],Dr=["y","m","d","h","mm","s","ms"];function Xr(e){let t="";if(e instanceof Date){const n=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),i=e.getHours(),s=e.getMinutes(),a=e.getSeconds(),l=e.getMilliseconds();return t=`${n}-${xr(r,"0",2)}-${xr(o,"0",2)}`,i+s+a+l>0&&(t+=` ${xr(i,"0",2)}:${xr(s,"0",2)}`,a+l>0&&(t+=":"+xr(a,"0",2),l>0&&(t+="."+xr(l,"0",3)))),`#${t}${Mr(1,e.getTimezoneOffset())}#`}if(Array.isArray(e.f)){const n=e.f;return t=""+n[0],null!=n[1]&&(t+="-"+xr(n[1]+1,"0",2)),null!=n[2]&&(t+="-"+xr(n[2],"0",2)),null!=n[3]&&(t+=" "+xr(n[3],"0",2)),null!=n[4]&&(t+=":"+xr(n[4],"0",2)),null!=n[5]&&(t+=":"+xr(n[5],"0",2)),null!=n[6]&&(t+="."+xr(n[6],"0",3)),null!=n[7]&&(t+=" "+Mr(-1,n[7])),"e"in e&&e.e&&(t+="<"),`#${t}#`}if("n"===e.f){if(Array.isArray(e.o))return Dr.forEach(((n,r)=>{null!=e.o[r]&&(t+=`${e.o[r]}${n}`)})),t+=`${"d"in e&&-1===e.d?" ago":" from now"}${Mr(-1,e.z)}`,`#${t}#`;if("number"==typeof e.o){let n=Math.abs(e.o);return zr.forEach((e=>{const r=Math.floor(n/we[e]);n%=we[e],r&&(t+=`${r}${e}`)})),n&&(t+=n+"ms"),`#${t}${e.o<0?" ago":" from now"}${Mr(-1,e.z)}#`}}else if("d"in e&&1===e.d&&0===e.o)t=`#${"w"===e.f?"week":"m"===e.f?"month":"year"} to date${Mr(-1,e.z)}${e.e?">":""}#`;else{if("t"in e&&Array.isArray(e.t)){const n=e.t;return t=(e.o<0?"yesterday":e.o>0?"tomorrow":"today")+" at ",n[0]||n[1]||n[2]||n[3]?12!==n[0]||n[1]||n[2]||n[3]?(t+=n[0],null!=n[1]&&(t+=":"+xr(n[1],"0",2)),null!=n[2]&&(t+=":"+xr(n[2],"0",2)),null!=n[3]&&(t+="."+xr(n[3],"0",3))):t+="noon":t+="midnight",`#${t}${Mr(-1,n[4])}${e.e?">":""}#`}if(!("t"in e)&&!("d"in e)&&!Array.isArray(e.f)){const n=e;return"d"===n.f?t+=""+(n.o<0?"yesterday":n.o>0?"tomorrow":"today"):t+=`${n.o<0?"last":n.o>0?"next":"this"} ${"w"===n.f?"week":"m"===n.f?"month":"year"}`,`#${t}${Mr(-1,n.z)}${n.e?">":""}#`}}return t}const Or=/^\s+/;function Yr(e,t){return e?t.replace(Or,""):t}const Sr=/@case\b/g;e.PageSizes={letter:{width:51,height:66,margin:[1.5,1.5]},legal:{width:51,height:84,margin:[1.5,1.5]},tabloid:{width:66,height:102,margin:[1.5,1.5]},a4:{width:49.606302,height:70.15746,margin:[1.5,1.5]}},e.Root=Ct,e.applySource=mn,e.evaluate=jt,e.extend=Nt,e.filter=zt,e.getOperatorMap=function(){return Object.assign({},kt)},e.inspect=or,e.isComputed=Ut,e.isValueOrExpr=Ot,e.join=function(e,t){return{parent:e,root:e.root,path:e.path?`${e.path}.${t}`:t,value:wt(e,t)}},e.parse=xt,e.parseTemplate=En,e.registerFormat=Et,e.registerLayout=rn,e.registerOperator=Mt,e.registerRenderer=Bt,e.run=function(e,t,n,r){const o=n&&"root"in n&&n.root===n?n:new Ct(Object.assign({},e.context),{parameters:n});if(e.sources){for(const n of e.sources)mn(o,n,t);for(const e in o.sources)o.value[e]=o.sources[e].value}return"delimited"===e.type?function(e,t){const n=t.root.sources[e.source?e.source:e.sources[0].name||e.sources[0].source];let r="";e.headers&&(r+=e.headers.map((n=>`${e.quote||""}${jt(t,n)}${e.quote||""}`)).join(e.field||",")+(e.record||"\n"));const o=Array.isArray(n.value)?n.value:[n.value],i=e.quote?new RegExp(e.quote,"g"):void 0;for(const n of o){const o=Nt(t,{value:n});r+=e.fields.map((t=>{let n=""+jt(o,t);return i&&(n=n.replace(i,e.quote+e.quote)),`${e.quote||""}${n}${e.quote||""}`})).join(e.field||",")+(e.record||"\n")}return r}(e,o):"flow"===e.type?function(e,t,n){const r={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};let o,i="",s=0,a=null;e.width?o=e.width:e.size&&(o="portrait"!==e.orientation?e.size.height:e.size.width);for(const t of e.widgets){let e;i+=`<div${gn(r,[],["position:absolute;right:0rem;left:0rem;"+(o?`width:${o}rem;`:""),""],`top:${s}rem;`,"p")}>\n`;let n=0;do{if(e=tn(t,r,{x:0,y:n,availableX:o,maxX:o},a),"string"==typeof e)throw new Error("Container widget didn't specify used height");i+=e.output,n+=e.height,a=e.continue?e.continue:null}while(null!==a);s+=n,i+="</div>\n"}const l=e.size&&e.size.margin?fn(e.size,r):[1.5,1.5,1.5,1.5];return`<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${o?` width: ${o}rem;`:""} }\n    #wrapper { height:${s}rem; position: relative; }\n    @media screen {\n      body { margin: 1rem; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${l[0]}rem ${l[1]}rem ${l[2]}rem ${l[3]}rem; }\n      html { background-color: #999; }\n    }${Object.entries(r.styles).map((([e,t])=>t)).join("\n")}${Object.entries(r.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n<div id=wrapper>${i}</div>${n&&n.foot||""}</body></html>`}(e,o,r):function(e,t,n){let r="portrait"!==e.orientation?{width:e.size.height,height:e.size.width,margin:[e.size.margin[1],e.size.margin[0]]}:e.size;const o={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};t.special=t.special||{},t.special.page=0,t.special.pages=0;const i=[""];let s=0,a=r.height-2*r.margin[0],l=a,u=0;const c=r.width-2*r.margin[1];let f=null,p=0;if(e.header){p=tn(e.header,o,{x:0,y:0,availableX:c,availableY:a,maxX:c,maxY:l}).height,a-=p,l-=p,u+=p}let g=0;if(e.footer){g=tn(e.footer,o,{x:0,y:0,availableX:c,availableY:a,maxX:c,maxY:l}).height,a-=g,l-=g}for(const t of e.widgets){let e;do{e=tn(t,o,{x:0,y:u,availableX:c,availableY:a,maxX:c,maxY:l},f),i[s]+=e.output,e.continue?(s++,i[s]="",u=p,a=r.height-2*r.margin[0]-p-g,f=e.continue):(u+=e.height,a-=e.height,f=null)}while(null!==f)}t.special.pages=i.length;const h=r.height-2*r.margin[0]-g;return i.forEach(((n,r)=>{let s=`<div class="page-back pb${r}"><div${gn(o,["page","ps"+r],["",""],"","p")}>\n`;if(t.special.page=r+1,e.header){s+=tn(e.header,o,{x:0,y:0,maxX:c,maxY:l}).output+"\n"}if(s+=n,e.footer){s+=tn(e.footer,o,{x:0,y:h,maxX:c,maxY:l}).output+"\n"}s+="\n</div></div>",i[r]=s})),`<html style="font-size:100%;margin:0;padding:0;"><head><style>\n    .page { width: ${r.width-2*r.margin[1]}rem; height: ${r.height-2*r.margin[0]}rem; position: absolute; overflow: hidden; left: ${r.margin[1]}rem; top: ${r.margin[0]}rem; }\n    .page-back { width: ${r.width}rem; height: ${r.height}rem; }\n    body { font-size: 0.83rem; }\n    @media screen {\n      html { min-width: ${r.width+2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { margin: 0; padding: 0; ${r?`width:${r.width}rem;`:""}background-color: none; display: block; height: ${i.length*r.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${i.map(((e,t)=>`.pb${t} { top: ${t*r.height}rem; }`)).join("")}\n    }\n    @page {\n      size: ${r.width}em ${r.height}em;\n    }${Object.entries(o.styles).map((([e,t])=>t)).join("\n")}${Object.entries(o.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n${i.reduce(((e,t)=>e+t),"")}${n&&n.foot||""}</body></html>`}(e,o,r)},e.safeGet=wt,e.stringify=function(e,t){return lr=(t=t||{}).noSymbols,cr=t.SExprOps,fr=t.listCommas,pr=t.SExprOps&&t.noArrayLiterals,gr=t.SExprOps&&t.noObjectLiterals,ur=!1,hr=t.template,dr=t.noIndent,mr=0,wr(e)},e.unregisterFormat=function(e){delete Ht[e]},e.unregisterOperator=function(...e){for(const t of e)for(const e of t.names)delete kt[e]},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=raport.umd.min.js.map
