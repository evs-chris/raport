!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Raport={})}(this,(function(e){"use strict";const t=[];let n=0;const r=[0,""],o=[0,""];function i(){return r}function a(){return r.slice()}function s(e,i,a,s){return r[0]=e,r[1]=i||"",r[2]=a,r[3]=s,1&n&&r[0]>=o[0]&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3]),t}function l(e,t){let n=1;for(;~(t=e.lastIndexOf("\n",t));)n++,t--;return n}function u(e,t,n){const r=[],o=e[0];let i=o,a=i=t.lastIndexOf("\n",i),s=t.lastIndexOf("\n",i-1);for(let e=0;e<n&&~i;e++)r.unshift(t.substring(s+1,i)),i=s,s=t.lastIndexOf("\n",i-1);const c=r.length+1;s=a,i=t.indexOf("\n",s+1),-1===i&&s<t.length&&(i=t.length);for(let e=0;e<=n&&~i;e++)r.push(t.substring(s+1,i)),s=i,i=t.indexOf("\n",s+1),-1===i&&s<t.length&&(i=t.length);const f=r[c-1];let p="";const g=o-(~a?a:-1)-1;for(let e=0;e<g;e++)p+="\t"===f[e]?"\t":" ";return p+="^--",{context:r,column:o-a,line:l(t,o),position:o,source:f,message:e[1],marked:`${r.slice(0,c).join("\n")}\n${p}\n${r.slice(c).join("\n")}`,cause:e[2]&&u(e[2],t,n),causes:e[3]&&e[3].map((e=>u(e,t,n)))}}function c(e){let t=e;if(e[2]){const n=c(e[2]);n[0]>t[0]&&(t=n)}if(e[3])for(let n=0;n<e[3].length;n++){const r=c(e[3][n]);r[0]>t[0]&&(t=r)}return o[0]>=r[0]&&o[1]!==e[1]?o:t}function f(e,t){let r;const a=t,l=t?(t.detailed?1:0)+(t.causes?2:0):0,f=t&&t.consumeAll;return function(t,p){const h=p?(p.detailed?1:0)+(p.causes?2:0):l;let m=[null,0];if(1&h&&(o[0]=0,o[1]="",o[2]=void 0,o[3]=void 0),h!==n){const o=n;n=h,m=(r||(r=g(e))).parse(t,0,m),n=o}else m=(r||(r=g(e))).parse(t,0,m);if(m.length&&(p&&"consumeAll"in p?p.consumeAll:f)&&m[1]<t.length&&(m=s(m[1],1&h&&`expected to consume all input, but only ${m[1]} chars consumed`)),m.length)return m[0];{const e=i(),n=(p&&"contextLines"in p?p.contextLines:a&&a.contextLines)||0,r=u(d(e[3]||[],e),t,n),o=c(e);if(e!==o&&(r.latest=u(o,t,n)),p&&"throw"in p?p.throw:a&&a.throw){const e=new Error(r.message);throw Object.assign(e,r)}return r}}}const p={parse:(e,t)=>s(t,1&n&&"uninitialized lazy parser")};function g(e){return e.parser||e||p}function h(e){let t="";const n=e.length;for(let r=0;r<n;r++)e[r]&&(t=t.concat(e[r]));return t}function d(e,t){let n,r=t[0];t[3]=e;const o=e||[];for(let e=0;e<o.length;e++)o[e][0]>r&&(n=o[e],r=n[0]);return n?[n[0],n[1],t]:t}function m(){return!1}function y(e,t){return e===t}function v(e,t){return e[0]===t||e[1]===t}function b(e,t){return e[0]===t||e[1]===t||e[2]===t}function $(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t}function x(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t}function w(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t}function A(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t}function j(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t}function k(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t}function M(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t||e[9]===t}function X(e,t){const n=e.length;for(let r=0;r<n;r++)if(e[r]===t)return!0;return!1}function D(e,t){let n,r,o=e.length-1,i=0;if(t<e[0]||t>e[o])return!1;for(;i<=o;){if(n=i+o>>1,r=e[n],r===t)return!0;r<t?i=n+1:o=n-1}}function Y(e,t=!0){const n=e.length;return 0===n?m:1===n?y:2===n?v:3===n?b:4===n?$:5===n?x:6===n?w:7===n?A:8===n?j:9===n?k:10===n?M:t?D:X}function O(e){let t="";const n=e.split("").sort().join("");for(let e=0;e<n.length;e++)~t.indexOf(n[e])||(t+=n[e]);return t}function z(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(!r(n,e[i]))return i;return o}function N(e){const t=O(e),n=Y(e);return{parse(e,r,o){o=o||["",0];const i=z(e,r,t,n);return o[0]=e.substring(r,i),o[1]=i,o}}}function C(e){const t=O(e),r=Y(e);return{parse(o,i,a){a=a||["",0];const l=z(o,i,t,r);return l===i?s(i,1&n&&"expected one of "+e):(a[0]=o.substring(i,l),a[1]=l,a)}}}function H(e,t){const r=t&&O(t),o=Y(r||"");return{parse(t,i,a){if(t.length-i>=e){a=a||["",0];const l=t.substr(i,e);if(r)for(let t=0;t<e;t++)if(!o(r,l[t]))return s(i+t,1&n&&"unexpected char");return a[0]=l,a[1]=i+e,a}return s(i,1&n&&"unexpected end of input")}}}function T(e,t){const r=function(e,t){const r=O(e),o=Y(e);return{parse(i,a,l){l=l||["",0];const u=function(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(r(n,e[i]))return i;return o}(i,a,r,o);return!t&&u>=i.length?s(u-1,1&n&&`expected one of '${e}' before end of input`):(l[0]=u?i.substring(a,u):"",l[1]=u,l)}}}(e,t);return{parse(e,t,o){o=o||["",0];const i=r.parse(e,t,o);return i.length?i[1]>t?i:s(t,1&n&&"expected at least one character"):i}}}function S(...e){const t=e.length;if(1===t){const t=e[0],r=t.length;if(1===r)return{parse:(e,r,o)=>e[r]===t?((o=o||["",0])[0]=t,o[1]=r+1,o):s(r,1&n&&"expected "+t)};if(2===r)return{parse:(e,r,o)=>e[r]===t[0]&&e[r+1]===t[1]?((o=o||["",0])[0]=t,o[1]=r+2,o):s(r,1&n&&"expected "+t)};{let e,o;return{parse(i,a,l){for(e=0,o=a+e;e<r;e++,o++)if(t[e]!==i[o])return s(a,1&n&&"expected "+t);return(l=l||["",0])[0]=t,l[1]=a+r,l}}}}return{parse(r,o,i){e:for(let n=0;n<t;n++){const t=e[n],a=t.length;if(1!==a){for(let e=0;e<a;e++)if(t[e]!==r[o+e])continue e;return(i=i||["",0])[0]=t,i[1]=o+a,i}if(r[o]===t)return[t,o+a]}return s(o,1&n&&`expected ${e.length>1?"one of ":""}${e.map((e=>""+e)).join(", ")}`)}}}function U(...e){const t=e.slice(),r=C(t.map((e=>e.toLowerCase()+e.toUpperCase())).join("")),o=t.map((e=>e.toLowerCase()));return{parse(e,i,a){const l=r.parse(e,i,a||["",0]);if(!l.length)return l;const u=o.indexOf(l[0].toLowerCase());return~u?(l[0]=t[u],l):s(i,1&n&&`expected ${t.length>1?"one of ":""}${t.map((e=>`'${e}'`)).join(", ")}`)}}}function q(e){let t,n;function r(e,n,r){r=r||[null,0];const o=t.parse(e,n,r);return o.length?o:(r[0]=null,r[1]=n,r)}return n={parse:(o,i,a)=>(t=g(e),n.parse=r,r(o,i,a))},n}function E(e,...t){const r="string"==typeof e?e:"alternate",o="string"==typeof e?t:(e?[e]:[]).concat(t);let i;const l=o.length;function u(e,t,o){let u;o=o||[null,0];for(let r=0;r<l;r++){const s=i[r].parse(e,t,o);if(s.length)return s;2&n&&(u||(u=[])).push(a())}if(2&n){const e=d(u,[t,"expected "+r]);return s(e[0],e[1],e[2],e[3])}return s(t,1&n&&"expected "+r)}let c;return c={parse:(e,t,n)=>(i=o.map((e=>g(e))),c.parse=u,u(e,t,n))},c}function F(e,t){let n,r;function o(e,r,o){o=o||[null,0];const i=n.parse(e,r,o);return i.length?(i[0]=t(i[0]),i):i}return r={parse:(t,i,a)=>(n=g(e),r.parse=o,o(t,i,a))},r}function L(e){let t;const r=[];function o(e,o,i){let s;i=i||[null,0];let l,u=o;if(l=t.parse(e,u,i),!l.length)return i[0]=r,i[1]=u,2&n&&(i[2]=a()),i;for(u=l[1],s=[l[0]];;){if(l=t.parse(e,u,i),!l.length)return[s||[],u,2&n&&a()];s.push(l[0]),u=l[1]}}let i;return i={parse:(n,r,a)=>(t=g(e),i.parse=o,o(n,r,a))},i}function I(e,t,r="disallow"){let o,l;const u=[];function c(e,t,c){let f;c=c||[null,0];let p,g,h,d=t,m=t;if(g=o.parse(e,d,c),!g.length)return c[0]=u,c[1]=t,2&n&&(c[2]=a()),c;if(p=g[0],m=d,d=g[1],h=l.parse(e,d,c),!h.length)return"require"===r?s(m,1&n&&"expected separator"):(c[0]=[p],c[1]=d,c);for(d=h[1],f=[p];;){if(g=o.parse(e,d,c),!g.length){if("disallow"===r&&f&&f.length){if(2&n){const e=i();return s(e[0],e[1],[d,"unexpected separator"])}return s(d,1&n&&"unexpected separator")}break}if(m=d,d=g[1],p=g[0],h=l.parse(e,d,c),!h.length){if("require"===r)return s(m,1&n&&"expected separator");f.push(p);break}d=h[1],f.push(p)}return[f,d,2&n&&a()]}let f;return f={parse:(n,r,i)=>(o=g(e),l=g(t),f.parse=c,c(n,r,i))},f}function R(e,t,r,o="disallow"){let i,l,u;function c(e,t,u){let c;u=u||[null,0];let f,p=t,g=p;if(f=i.parse(e,p,u),!f.length)return s(p,1&n&&"expected at least one "+(r||"item"));{(c=[]).push(f[0]),g=p=f[1];const t=l.parse(e,p,u);if(t.length)for(p=t[1];;){if(f=i.parse(e,p,u),!f.length){if("disallow"===o&&c&&c.length)return u[0]=c,u[1]=g,u;break}{c.push(f[0]),g=p=f[1];const t=l.parse(e,p,u);if(!t.length){if("require"===o)return s(p,1&n&&"expected separator");break}p=t[1]}}else if("require"===o)return s(p,1&n&&"expected separator")}return u[0]=c,u[1]=p,2&n&&(u[2]=a()),u}return u={parse:(n,r,o)=>(i=g(e),l=g(t),u.parse=c,c(n,r,o))},u}function _(e,t,o){if(Array.isArray(e)){let r,o;const a=e.length;function i(e,t,i){let l,u;i=i||[null,0];for(let n=0;n<a;n++){if(r[n].parse(e,t,i).length){u=r[n];break}}if(!u)return s(t,1&n&&"expected opening bracket");const c=o.parse(e,i[1],i);if(!c.length)return c;2&n&&(l=c[2]);const f=c[0],p=c[1];return u.parse(e,p,i).length?(i[0]=f,i):s(p,1&n&&"expected matching end bracket",2&n&&l)}let l;return l={parse:(n,a,s)=>(o=g(t),r=e.map((e=>g(e))),l.parse=i,i(n,a,s))},l}{let a,s,l,u;function i(e,t,o){let i;o=o||[null,0];const u=a.parse(e,t,o);if(!u.length)return u;const c=s.parse(e,u[1],o);if(!c.length)return c;2&n&&c[2]&&(i=c[2]);const f=c[0],p=l.parse(e,c[1],o);return p.length?(o[0]=f,o):(2&n&&i&&function(e){(r[3]||(r[3]=[])).push(e)}(i),p)}return u={parse:(n,r,c)=>(a=g(e),s=g(t),l=g(o),u.parse=i,i(n,r,c))},u}}function P(...e){let t;const r=e.length;function o(e,o,i){let l;i=i||[null,0];let u,c,f=o;if(c=t[0].parse(e,f,i),!c.length){if(2&n){const e=d(u,a());return s(e[0],e[1],e[2],e[3])}return c}2&n&&c[2]&&(u||(u=[])).push(c[2]),(l=[]).push(c[0]),f=c[1];for(let o=1;o<r;o++){if(c=t[o].parse(e,f,i),!c.length){if(2&n){const e=d(u,a());return s(e[0],e[1],e[2],e[3])}return c}2&n&&c[2]&&(u||(u=[])).push(c[2]),l.push(c[0]),f=c[1]}return i[0]=l,i[1]=f,2&n&&(i[2]=[o,"error in seq",null,u]),i}let i;return i={parse:(n,r,a)=>(t=e.map(g),i.parse=o,o(n,r,a))},i}function J(...e){let t;const r=e.length;function o(e,o,i){i=i||[null,0];let l,u,c=o;if(u=t[0].parse(e,c,i),!u.length){if(2&n){const e=d(l,a());return s(e[0],e[1],e[2],e[3])}return u}2&n&&u[2]&&(l||(l=[])).push(u[2]),c=u[1];for(let o=1;o<r;o++){if(u=t[o].parse(e,c,i),!u.length){if(2&n){const e=d(l,a());return s(e[0],e[1],e[2],e[3])}return u}2&n&&u[2]&&(l||(l=[])).push(u[2]),c=u[1]}return i[0]=null,i[1]=c,i}let i;return i={parse:(n,r,a)=>(t=e.map(g),i.parse=o,o(n,r,a))},i}const W="abcdefABCDEF",Z="0123456789",B=W+"abcdefABCDEFghijklmnopqrstuvwxyzGHIJKLMNOPQRSTUVWXYZ$_",G=W+Z,V={b:"\b",r:"\r",n:"\n","'":"'",'"':'"',t:"\t","\\":"\\"},K=/_/g,Q=F(P(q(S("-","+")),C(Z),N(Z+"_"),q(S(".")),N(Z+"_"),F(q(P(S("e","E"),q(S("+","-")),C(Z+"_"))),(e=>e&&h(e)))),(e=>+h(e).replace(K,""))),ee=F(P(S("\\"),function(e,t){const r=O(t),o=Y(r);return{parse(t,i,a){if(t.length-i>=e){a=a||["",0];const l=t.substr(i,e);for(let t=0;t<e;t++)if(o(r,l[t]))return s(i+t,1&n&&"unexpected char");return a[0]=l,a[1]=i+e,a}return s(i,1&n&&"unexpected end of input")}}}(1,"xu")),(e=>V[e[1]]||e[1])),te=F(P(S("\\u"),H(4,G)),(e=>String.fromCharCode(parseInt(e[1],16)))),ne=F(P(S("\\x"),H(2,G)),(e=>String.fromCharCode(parseInt(e[1],16)))),re=E(_(S('"'),F(L(E("string part",T('"\\'),te,ne,ee)),(e=>h(e))),S('"')),_(S("'"),F(L(E("string part",T("'\\"),te,ne,ee)),(e=>h(e))),S("'"))),oe=F(S("true","false"),(e=>"true"===e)),ie=F(S("null"),(()=>null)),ae=F(P(C(B),q(N(B+Z))),(([e,t])=>null!==t?e+t:e)),se=function(e){const t=O(e),n=Y(e);return{parse:(e,r,o)=>((o=o||["",0])[1]=z(e,r,t,n),o)}}(" \t\n\r"),le={},ue={},ce=E("value",re,le,ue,Q,oe,ie),fe=F(P(se,E("key",re,ae),J(se,S(":"),se),ce),(e=>[e[1],e[3]]));le.parser=_(J(S("["),se),I(ce,J(se,S(","),se),"allow"),J(se,S("]"))),ue.parser=F(_(J(S("{"),se),I(fe,J(se,S(","),se),"allow"),J(se,S("}"))),(e=>{const t=e.length,n={};for(let r=0;r<t;r++){const t=e[r];n[t[0]]=t[1]}return n}));f(F(P(se,ce,se),(e=>e[1])));const pe=6048e5,ge=864e5,he=36e5,de=6e4,me=1e3,ye={week:pe,weeks:pe,day:ge,days:ge,hour:he,hours:he,minute:de,minutes:de,second:me,seconds:me},ve=" \r\n\t",be=" \r\n\t():{}[],\"'`\\;&#.",$e=function(e){const t=O(e),r=Y(e);return{parse:(o,i,a)=>((a=a||["",0])[1]=z(o,i,t,r),a[1]===i?s(i,1&n&&"expected at least one of "+JSON.stringify(e)):a)}}(ve),xe=F(S("null","true","false","undefined"),(e=>{switch(e){case"null":return null;case"true":return!0;case"false":return!1;case"undefined":return}})),we=T(be,!0),Ae={},je={},ke={},Me={},Xe={},De={n:"\n",r:"\r",t:"\t",b:"\b"},Ye=F(P(S("\\"),H(1)),(([,e])=>De[e]||e)),Oe=F(function(e,t){let r,o;function i(e,o,i){let l;i=i||[null,0];let u,c=o;if(u=r.parse(e,c,i),!u.length)return s(c,1&n&&"expected at least one "+(t||"item"),2&n&&a());for((l=[]).push(u[0]),c=u[1];;){if(u=r.parse(e,c,i),!u.length)return i[0]=l,i[1]=c,2&n&&(i[2]=a()),i;l.push(u[0]),c=u[1]}}return o={parse:(t,n,a)=>(r=g(e),o.parse=i,i(t,n,a))},o}(E("ref part",T(be+"=",!0),Ye)),(e=>e.join(""))),ze=F(P(S("."),Oe),(([,e])=>e)),Ne=_(P(S("["),se),Me,P(se,S("]"))),Ce=F(P(E("ref sigil",S("!","~","*"),P(N("^"),q(S("@",".")))),E("keypath",Oe,Ne),L(E("keypath",ze,Ne))),(([e,t,n])=>{const r={k:[t].concat(n).map((e=>"object"!=typeof e||!("v"in e)||"string"!=typeof e.v&&"number"!=typeof e.v?e:e.v))};return Array.isArray(e)?(e[0]&&(r.u=e[0].length),"@"===e[1]&&(r.p="@")):e&&(r.p=e),r})),He=f(Ce),Te=F(Ce,(e=>({r:e})));function Se(e){const t=e.reduce(((e,t)=>(e.length&&"v"in t&&"v"in e[e.length-1]&&"string"==typeof t.v&&"string"==typeof e[e.length-1].v?e[e.length-1].v+=t.v:e.push(t),e)),[]);return t.length>0&&(!("v"in t[0])||"string"!=typeof t[0].v)&&t.unshift({v:""}),0===t.length?{v:""}:1===t.length?t[0]:{op:"+",args:t}}const Ue=F(R(P(Q,$e,U("week","weeks","day","days","hour","hours","minute","minutes","second","seconds","millisecond","milliseconds")),$e,"disallow"),(e=>{let t=0;for(let n=0;n<e.length;n++)t+=e[n][0]*ye[e[n][2]];return t})),qe=E("date",F(P(U("last","this","next"),$e,U("week","month","year"),q(P($e,U("to"),$e,U("date")))),(([e,,t,n])=>({f:"w"===t[0]?"w":"m"===t[0]?"m":"y",o:"last"===e?-1:"this"===e?0:1,d:n?1:void 0}))),F(U("yesterday","today","tomorrow","now"),(e=>"now"===e?{f:"n",o:0}:{f:"d",o:"yesterday"===e?-1:"today"===e?0:1})),F(P(Ue,$e,E("relative time anchor",U("ago"),P(U("from"),$e,U("now")))),(([e,,t])=>({f:"n",o:e*("ago"===t?-1:1)}))));function Ee(e,t,n){return null==n||(e[t]=n),e}const Fe=F(P(H(4,Z),q(P(H(1,"-/"),C(Z),q(P(H(1,"-/"),C(Z),q(P(H(1," T"),C(Z),q(P(S(":"),H(2,Z),q(P(S(":"),H(2,Z),q(P(S("."),H(3,Z))))))))))))),q(P(se,E("timezone",S("Z"),q(P(H(1,"+-"),C(Z),q(P(S(":"),H(2,Z))))))))),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=r&&e[1][2][2]&&e[1][2][2][1],i=o&&e[1][2][2][2]&&e[1][2][2][2][1],a=i&&e[1][2][2][2][2]&&e[1][2][2][2][2][1],s=a&&e[1][2][2][2][2][2]&&e[1][2][2][2][2][2][1],l=e[2]&&e[2][1]&&("string"==typeof e[2][1]?0:(60*+e[2][1][1]+(+e[2][1][2]||0))*("+"===e[2][1][0]?-1:1));if(n){if(r){if(o){if(i){if(null!=l){const e=new Date(Date.UTC(+t,+n-1,+r,+o,+i,a&&+a||0,s&&+s||0));return l&&e.setUTCHours(e.getUTCHours()+Math.floor(l/60)),l%60&&e.setUTCMinutes(e.getUTCMinutes()+l%60),e}return new Date(+t,+n-1,+r,+o,+i,a&&+a||0,s&&+s||0)}return{f:Ee([+t,+n-1,+r,+o],7,l)}}return{f:Ee([+t,+n-1,+r],7,l)}}return{f:Ee([+t,+n-1],7,l)}}return{f:Ee([+t],7,l)}})),Le=_(S("#"),E("date",Fe,qe,Ue),S("#")),Ie=E("string",F(P(S(":"),T(be.replace(".",""),!0)),(e=>({v:e[1]}))),F(_(S('"'),L(E("string part",T('\\"'),ee,te,ne)),S('"')),(e=>({v:"".concat(...e)}))),F(_(S("'"),L(E("string part",F(T("'\\$",!0),(e=>({v:e}))),F(S("\\$","$$"),(()=>({v:"$"}))),_(S("${"),Me,S("}")),F(S("$"),(e=>({v:e}))),F(te,(e=>({v:e}))),F(ne,(e=>({v:e}))),F(ee,(e=>({v:e}))))),S("'")),Se),F(_(S("`"),L(E("string part",F(T("`\\$",!0),(e=>({v:e}))),F(S("\\$","$$"),(()=>({v:"$"}))),_(S("${"),Me,S("}")),F(S("$"),(e=>({v:e}))),F(te,(e=>({v:e}))),F(ne,(e=>({v:e}))),F(ee,(e=>({v:e}))))),S("`")),Se)),Re=F(E("literal",Q,xe,Le),(e=>({v:e}))),_e=F(_(J(S("("),se),P(we,se,Ae),J(se,S(")"))),(([e,,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n}));function Pe(e){return _(P(S("("),se),e,P(se,S(")")))}const Je={},We={},Ze=F(P(C("abcdefghifghijklmnopqrstuvwzyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789"),Pe(Ae)),(([e,t])=>{const n={op:e};return t&&t.length&&(n.args=t),n})),Be=function(e){return F(P(e,q(P(S("#"),we,q(P(S(","),R(Me,S(","))))))),(([e,t])=>t?t[2]?{op:"fmt",args:[e,{v:t[1]},...t[2][1]]}:{op:"fmt",args:[e,{v:t[1]}]}:e))}(function(e){return F(P(e,L(E("keypath",ze,Ne))),(([e,t])=>t.length?{op:"get",args:[e,{v:{k:t}}]}:e))}(E("operand",Pe(We),function(e,t){let n,r;function o(e,r,o){o=o||[null,0];const i=n.parse(e,r,o);if(!i.length)return i;const a=t(i[0]);return!0===a?i:s(i[1],a)}return r={parse:(t,i,a)=>(n=g(e),r.parse=o,o(t,i,a))},r}(Pe(Je),(e=>"op"in e||"expected bracketed op")),_e,Xe))),Ge=F(P(S("not ","+"),Be),(([e,t])=>({op:"+"===e?e:"not",args:[t]})));function Ve(e,[,t,,n]){return{op:t,args:[e,n]}}const Ke=F(P(Be,L(P($e,S("**"),$e,Be))),(([e,t])=>t.length?function(e,t){if(1===t.length)return{op:t[0][1],args:[e,t[0][3]]};const n=t.pop();let r=t[t.length-1][1];const o={op:n[1],args:[t.pop()[3],n[3]]},i=t.reverse().reduce(((e,t)=>{const n={op:r,args:[t[3],e]};return r=t[1],n}),o);return{op:r,args:[e,i]}}(e,t):e)),Qe=F(P(Ke,L(P($e,S("*","/","%"),$e,Ke))),(([e,t])=>t.length?t.reduce(Ve,e):e)),et=F(P(Qe,L(P($e,S("+","-"),$e,Qe))),(([e,t])=>t.length?t.reduce(Ve,e):e)),tt=F(P(et,L(P($e,S(">=",">","<=","<","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain"),$e,et))),(([e,t])=>t.length?t.reduce(Ve,e):e)),nt=F(P(tt,L(P($e,S("is","is-not","==","!="),$e,tt))),(([e,t])=>t.length?t.reduce(Ve,e):e)),rt=F(P(nt,L(P($e,S("and","&&"),$e,nt))),(([e,t])=>t.length?t.reduce(Ve,e):e)),ot=F(P(rt,L(P($e,S("or","||"),$e,rt))),(([e,t])=>t.length?t.reduce(Ve,e):e));Je.parser=ot,We.parser=F(P(S("if"),$e,Me,$e,S("then"),$e,Me,L(P($e,S("else if","elseif","elsif","elif"),$e,Me,$e,S("then"),$e,Me)),q(P($e,S("else"),$e,Me))),(([,,e,,,,t,n,r])=>{const o={op:"if",args:[e,t]};for(const[,,,e,,,,t]of n)o.args.push(e,t);return r&&o.args.push(r[3]),o}));const it=E("expression",We,Je),at=F(P(E("key",Ie,F(we,(e=>({v:e})))),se,S(":"),se,Me),(e=>[e[0],e[4]]));je.parser=F(_(J(se,S("["),se),I(Me,C(" \r\n\t,"),"allow"),J(se,S("]"))),(e=>e.filter((e=>!("v"in e))).length?{op:"array",args:e}:{v:e.map((e=>e.v))})),ke.parser=F(_(J(se,S("{"),se),I(at,C(" \r\n\t,"),"allow"),J(se,S("}"))),(e=>e.filter((e=>!("v"in e[0]&&"v"in e[1]))).length?{op:"object",args:e.reduce(((e,t)=>(e.push(t[0],t[1]),e)),[])}:{v:e.reduce(((e,t)=>(e[t[0].v]=t[1].v,e)),{})})),Me.parser=it;const st=F(P(S("=>"),se,Me),(([,,e])=>({a:e})));Ae.parser=I(Me,C(" \r\n\t,"),"allow"),Xe.parser=E("expression",je,ke,Re,Ie,st,Ge,Ze,Te);const lt=f(Me);function ut(e,t){return lt(e.trim(),Object.assign({detailed:!1,consumeAll:!0},t))}const ct=new RegExp(`[${be.split("").map((e=>"\\"+e)).join("")}]`),ft=["op","args"];let pt=!1,gt=!1;function ht(e){if("r"in e){if("string"==typeof e.r)return/^[0-9]/.test(e.r)?"."+e.r:e.r;{const t=e.r;return`${function(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}("^",t.u||0)}${t.p||""}${t.k.map(((e,t)=>"string"==typeof e||"number"==typeof e?(t?"":".")+"{{p}":`[${ht(e)}]`)).join("")}`}}if("op"in e){if("array"===e.op)return`[${e.args?e.args.map((e=>ht(e))).join(" "):""}]`;if("object"===e.op&&e.args&&!e.args.find(((e,t)=>t%2==0&&(!("v"in e)||"string"!=typeof e.v)))){let t="{";if(e.args)for(let n=0;n<e.args.length;n+=2)t+=`${n>0?" ":""}${gt=!0,ht(e.args[n])}:${gt=!1,ht(e.args[n+1])}`;return t+="}",t}return"+"===e.op&&e.args&&e.args.length>0&&"object"==typeof e.args[0]&&"string"==typeof e.args[0].v?`'${e.args.map((e=>"v"in e&&"string"==typeof e.v?e.v.replace(/[\$']/g,(e=>"\\"+e)):`\${${ht(e)}}`)).join("")}'`:`(${e.op}${e.args&&e.args.length?" "+e.args.map((e=>ht(e))).join(" "):""})`}if("a"in e)return"=>"+ht(e.a);if("v"in e){if("string"==typeof e.v)return!gt&&pt||ct.test(e.v)||!e.v.length?~e.v.indexOf("'")?~e.v.indexOf("`")?~e.v.indexOf('"')?`'${e.v.replace(/['\$]/g,(e=>"\\"+e))}'`:`"${e.v}"`:`\`${e.v.replace(/[\$`]/g,(e=>"\\"+e))}\``:`'${e.v.replace(/[\$']/g,(e=>"\\"+e))}'`:`${gt?"":":"}${e.v}`;if("number"==typeof e.v||"boolean"==typeof e.v)return""+e.v;if("undefined"===e.v)return"undefined";if("null"===e.v)return"null";if(Array.isArray(e.v))return`[${e.v.map((e=>ht({v:e}))).join(" ")}]`;if("object"==typeof e.v){if(e.v instanceof Date)return`#${e.v.getFullYear()}-${e.v.getMonth()+1}-${e.v.getDate()}#`;{const t=Object.keys(e.v);return 1===t.length&&("r"===t[0]||"v"===t[0])||"op"in e.v&&!t.find((e=>!ft.includes(e)))?"%"+ht(e.v):`{${t.map((t=>`${gt=!0,ht({v:t})}:${gt=!1,ht({v:e.v[t]})}`)).join(" ")}}`}}}}function dt(e,t){if(!t)return e.value;const n="string"==typeof t?He(t):t;if(!("error"in n)&&"k"in n){const t=n.k,r=n.p;let o=0,i=e,a=e.value;for(let e=0;e<n.u;e++)i&&(i=i.parent);if(a=i?i.value:void 0,r){if("!"===r)a=e.root.parameters;else if("~"===r)a=e.root.value;else if("*"===r)a=e.root.sources[t[o++]],a&&o<t.length+1&&"value"!==t[o]&&(a=a.value);else if("@"===r){const n=t[o++];if("value"!==n){for(;i&&(!i.special||!(n in i.special));)i=i.parent;a=i&&i.special[n]||void 0,a&&"source"===n&&"value"!==t[o]&&(a=a.value),a||"date"!==n||(a=e.root.special.date=new Date)}}}else"_"===t[0]&&t.shift();for(let e=o;e<t.length;e++){const n=t[e];if("object"!=typeof n)a=a&&a[n];else{const e=yt(i,n);a=a&&a[e]}if(null==a)return}return a}}const mt={};function yt(e,t,n){let r,o,i=mt;return At(e)?(r=new kt,o=e,arguments.length>1&&(i=t)):jt(e)?(r=e,o=t,arguments.length>2&&(i=n)):e&&"context"in e&&jt(e.context)?(r=e.context,o=t,arguments.length>2&&(i=n)):At(t)?(r=new kt(e),o=t,arguments.length>2&&(i=n)):(r=new kt,o=e,arguments.length>1&&(i=n)),"string"==typeof o&&(o=r.root.exprs[o]||(r.root.exprs[o]=ut(o))),"object"!=typeof o&&(o={v:o}),o&&"r"in o?dt(r,o.r):o&&"v"in o?o.v:o&&"op"in o?wt(r,o):o&&"a"in o?i===mt?o.a:yt(Mt(r,{value:i}),o.a):void 0}const vt={};function bt(...e){for(const t of e)for(const e of t.names)vt[e]=t}function $t(e,t,n,r,o){if(!e||!Array.isArray(e.value))return e;o=o?Mt(o,{special:{source:e.value}}):new kt(e.value,{special:{source:e}});const i=t?[]:e.value.slice();if(t){let n="string"==typeof t?ut(t):t;"m"in n&&(n={v:!0}),e.value.forEach(((e,t)=>{yt(Mt(o,{value:e,special:{value:e,index:t}}),n)&&i.push(e)}))}const a=function(e,t){let n;if(Array.isArray(t))n=t;else{const r=yt(e,t);Array.isArray(r)?n=r:"string"==typeof r&&(n=[{v:r}])}if(n)for(let e=0;e<n.length;e++){const t=n[e];"string"==typeof t&&("-"===t[0]?n[e]={by:t.substr(1),desc:!0}:n[e]={by:"+"===t[0]?t.substr(1):t})}return n}(o,n);if(a&&a.length){const e=a.map((e=>"object"!=typeof e||!("by"in e)||("boolean"==typeof e.desc?e.desc:yt(o,e.desc))));i.sort(((t,n)=>{for(let r=0;r<a.length;r++){const i=a[r],s=e[r],l="string"==typeof i?i:"by"in i?i.by:i,u=yt(Mt(o,{value:t}),l),c=yt(Mt(o,{value:n}),l),f=null==u&&null!=c?-1:null!=u&&null==c?1:u<c==c<u?0:u<c?-1:u>c?1:0;if(f)return(s?-1:1)*f}return 0}))}return Array.isArray(r)||(r=yt(o,r)),Array.isArray(r)&&r.length?{value:{schema:e.schema,grouped:r.length,level:0,value:xt(i,r,o,1),all:i}}:{schema:e.schema,value:i}}function xt(e,t,n,r=0){const o={},i=[],a=[];for(const r of e){const e=""+yt(Mt(n,{value:r}),t[0]);o[e]||(a.push(e),o[e]=[]),o[e].push(r)}for(const e of a)i.push({group:e,grouped:t.length-1,value:t.length>1?xt(o[e],t.slice(1),n,r+1):o[e],all:o[e],level:r});return i}function wt(e,t){const n=vt[t.op];if(!n)return!0;let r;if("checked"===n.type){r=[];const o=t.args||[];for(let i=0;i<o.length;i++){const a=o[i],s=yt(e,a),l=n.checkArg(t.op,i,o.length-1,s,e);if("continue"===l)r.push(s);else if("skip"in l)i+=l.skip,"value"in l&&r.push(l.value);else if("result"in l)return l.result}return n.apply(t.op,r,e)}if("value"===n.type)return r=(t.args||[]).map((t=>yt(e,t))),n.apply(t.op,r,e);{let r;const o=(t.args||[]).slice(),i=yt(e,o[0]);if(Array.isArray(i)?(o.shift(),r=i):"object"==typeof i&&"value"in i&&Array.isArray(i.value)&&(o.shift(),r=i.value),!r){const t=yt(e,{r:"@source"});r=Array.isArray(t)?t:"object"==typeof t&&"value"in t&&Array.isArray(t.value)?t.values:[]}return n.apply(t.op,r,o,e)}}function At(e){return"string"==typeof e||"object"==typeof e&&e&&("r"in e&&"string"==typeof e.r||"op"in e&&"string"==typeof e.op||"v"in e||"a"in e)}function jt(e){return"object"==typeof e&&"string"==typeof e.path&&"object"==typeof e.root&&"value"in e&&("object"==typeof e.parent||e.root===e)}class kt{constructor(e={},t){this.root=this,this.parameters={},this.sources={},this.special={},this.exprs={},this.path="",this.value=e,t&&(Object.assign(this.parameters,t.parameters),Object.assign(this.special,t.special))}}function Mt(e,t){return{parent:e,root:e.root,path:"",value:"value"in t?t.value:e.value,special:t.special||{}}}const Xt={};function Dt(e,t){Xt[e]=t}function Yt(e){const t=[null,null];let n=new Date,r="d"in e&&e.d?new Date:void 0;if(n.setHours(0,0,0,0),"n"===e.f)return n=new Date(+new Date+e.o),[n,n];if("d"===e.f?(n.setDate(n.getDate()+e.o),r||(r=new Date(n))):"w"===e.f?(n.setDate(n.getDate()-(n.getDay()+(-1===e.o?7:1===e.o?-7:0))),r||(r=new Date(n),r.setDate(n.getDate()+6))):"m"===e.f?(n.setDate(1),n.setMonth(n.getMonth()+e.o),r||(r=new Date(n),r.setMonth(n.getMonth()+1),r.setDate(0))):"y"===e.f&&(n.setDate(1),n.setMonth(0),n.setDate(1),r||(r=new Date(n),r.setFullYear(n.getFullYear()+1),r.setDate(0))),Array.isArray(e.f)){const t=e.f.slice();null!=t[7]?(n=new Date(Date.UTC(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)),t[7]&&n.setUTCHours(n.getUTCHours()+Math.floor(t[7]/60)),t[7]%60&&n.setUTCMinutes(n.getUTCMinutes()+t[7]%60)):n=new Date(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0);for(let e=1;e<7;e++)if(null==t[e]){t[e-1]++;break}null!=t[7]?(r=new Date(Date.UTC(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)),t[7]&&r.setUTCHours(r.getUTCHours()+Math.floor(t[7]/60)),t[7]%60&&r.setUTCMinutes(r.getUTCMinutes()+t[7]%60)):r=new Date(t[0],t[1]||0,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0),r.setMilliseconds(-1)}else"d"in e&&e.d||r.setHours(23,59,59,999);return t[0]=n,t[1]=r,t}function Ot(e){return"object"==typeof e&&"f"in e&&(Array.isArray(e.f)||"o"in e)}function zt(e,t,n){e.styles[t]||(e.styles[t]=n)}function Nt(e,t){return{report:e.report,context:Mt(e.context,t),styles:e.styles,styleMap:e.styleMap}}const Ct=/\>\<\&/g,Ht={"<":"&lt;",">":"&gt;","&":"&amp;"};function Tt(e){return e.replace(Ct,(e=>Ht[e]||""))}const St={};function Ut(e,t,n){St[e]="function"==typeof t?{render:t}:t,n&&Object.assign(St[e],n)}const qt=7.4,Et=6.7,Ft=7.85,Lt=5.9;let It=function(e,t,n){const r=n&&n.family||"sans",o=n&&n.size||.83,i=n&&n.line||1,a=("mono"===r||/fixed|mono/i.test(r)?Ft:"narrow"===r||/narrow|condensed/i.test(r)?Lt:"sans"===r||/sans/i.test(r)?qt:Et)*o/16;return e.split(/\r?\n/g).reduce(((e,n)=>{const[r,o]=n.split(/\s/g).reduce(((e,n)=>{const r=(n.length+1)*a;return e[0]+r>t?(e[0]=r,e[1]++):e[0]+=r,e}),[0,0]);return e+(o+(r>0?1:0)||1)}),0)*i};function Rt(e,t,n,r){const o=St[e.type];if(!o||e.hide&&yt(t,e.hide))return{output:""};!("height"in e)&&o.container&&(e.height="auto");const i=Bt(e,n);if(n.maxY&&!isNaN(i)&&i>n.maxY)return zt(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2};if(n.availableY&&i>n.availableY)return{output:"",continue:{offset:0},cancel:!0};let a=0;if(e.margin){const t=Kt(e);a+=t[0]+t[2],n.availableX&&(n.availableX-=t[1]+t[3]),n.availableY&&(n.availableY-=t[0]+t[2])}const s=o.render(e,t,n,r);return"string"==typeof s?{output:s,height:i,width:Wt(e,n)}:(s.height=s.height+a,n.maxY&&s.height>n.maxY?(zt(t,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${n.y}rem;">Widget overflow error</div>`,height:2}):isNaN(i)&&n.availableY&&s.height>n.availableY?{output:"",continue:{offset:0},height:s.height,cancel:!0}:s)}const _t={};function Pt(e,t){_t[e]=t}function Jt(e,t){const n=e.width;return n?"number"==typeof n?n:n.percent/100*(t.availableX||t.maxX||51):t.maxX||51}function Wt(e,t){let n=Jt(e,t);if(e.margin){const t=Kt(e);n+=t[1]+t[3]}else e.font&&e.font.right&&(n+=e.font.right);return n}function Zt(e,t,n){let r=1;if("number"==typeof e.height)r=e.height;else if("object"==typeof e.height&&e.height.percent&&t.availableY)r=t.availableY*(e.height.percent/100);else if("auto"===e.height||n&&!e.height)return n||NaN;return r}function Bt(e,t,n){let r=Zt(e,t,n);if(e.margin){const t=Kt(e);r+=t[0]+t[2]}return r}function Gt(e){return e.reduce(((e,t)=>e>t[1]+t[3]?e:t[1]+t[3]),0)}function Vt(e){return e.reduce(((e,t)=>e>t[0]+t[2]?e:t[0]+t[2]),0)}function Kt(e){if(e.margin){const t=e.margin;if(Array.isArray(t)){if(4===t.length)return t.map((e=>+e));if(2===t.length)return[+t[0],+t[1],+t[0],+t[1]]}else if("number"==typeof t)return[t,t,t,t]}return[0,0,0,0]}function Qt(e,t,n){if(!t)return"";const r=e.styleMap.styles[t];if(r)return r;const o=`${n}${function(e,t){return e.styleMap.ids[t]||(e.styleMap.ids[t]=0),e.styleMap.ids[t]++}(e,n)}`;return e.styleMap.styles[t]=o}function en(e,t,[n,r],o,i){if(e.report.classifyStyles){const a=[];return r&&a.push(Qt(e,r,"h")),a.push(Qt(e,n,i||"s")),` class="${t.concat(a).join(" ")}"${o?` style="${o}"`:""}`}{const e=`${n}${o||""}${r||""}`;return`${""+(t.length?` class="${t.join(" ")}"`:"")}${e?` style="${e}"`:""}`}}function tn(e,t,n,r){let o=`left:${t.x||0}rem;top:${t.y||0}rem;`,i="";e.width?"number"!=typeof e.width&&"percent"in e.width?o+=`width:${e.width.percent}%;`:o+=`width:${Wt(e,t)}rem;`:o+=`right:${(e.margin||{})[1]||0}rem;`;const a=Bt(e,t,r&&r.computedHeight)||1;if(r&&r.container&&r.computedHeight?i=`height:${a}rem;`:o+=`height:${a}rem;`,e.font&&0===e.font.line?o+="line-height: initial;":o+=""+(!r||!r.container||e.font&&e.font.line?`line-height:${e.font&&e.font.line||Zt(e,t,r&&r.computedHeight)}rem;`:""),e.margin){const t=Kt(e);(t[0]||t[1]||t[2]||t[3])&&(o+=`padding: ${t[0]}rem ${t[1]}rem ${t[2]}rem ${t[3]}rem;`)}else e.font&&e.font.right&&(o+=`padding-right:${e.font.right}rem;`);return(r&&r.font||e.font)&&(o+=nn(r&&r.font||e.font)),e.border&&(o+=function(e,t){("string"==typeof e||"object"==typeof e&&("v"in e||"r"in e||"op"in e))&&(e=yt(t,e));if("number"==typeof e)return`border-bottom:${.0625*e}rem solid;`;if(function(e){return"object"==typeof e&&("top"in e||"bottom"in e||"left"in e||"right"in e)}(e))return`border-style:solid;border-width:${.0625*(e.top||0)}rem ${.0625*(e.right||0)}rem ${.0625*(e.bottom||0)}rem ${.0625*(e.left||0)}rem;`;if(Array.isArray(e)){if(1===e.length)return`border:${.0625*(+e[0]||0)}rem solid;`;if(2===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(3===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[1]||0)}rem;`;if(4===e.length)return`border-style:solid;border-width:${.0625*(+e[0]||0)}rem ${.0625*(+e[1]||0)}rem ${.0625*(+e[2]||0)}rem ${.0625*(+e[3]||0)}rem;`}}(e.border,n)),[o,i]}function nn(e){let t="";return e.family&&(t+=`font-family:${e.family};`),e.color&&(t+=`color:${e.color};`),e.align&&(t+=`text-align:${e.align};`),e.size&&(t+=`font-size:${e.size}rem;`),e.weight&&(t+=`font-weight:${e.weight};`),e.pre&&(t+="white-space:pre-wrap;"),e.clamp&&(t+="white-space:nowrap;overflow:hidden;"),t}Pt("row",((e,t,n,r,o)=>{let i;return e.br||r.availableX&&o[0][0]+o[0][2]+Wt(e,r)>r.availableX?i={x:n[3],y:Gt(o),availableX:r.availableX&&r.availableX-n[3],maxX:r.maxX}:(i={x:o[0][0]+o[0][2],y:o[0][1],maxX:r.maxX},r.availableX&&(i.availableX=r.availableX-(o[0][0]+o[0][2]))),i.y-=t,r.availableY&&(i.availableY=r.availableY-o[0][1]),i}));function rn(e,t,n){let r=n[t.source||t.name]||{value:[]};t.base&&(r={value:yt(Mt(e,{value:r.value,special:{source:r}}),t.base)}),t.filter||t.sort||t.group?e.sources[t.name||t.source]=$t(r,t.filter,t.sort,t.group,e):e.sources[t.name||t.source]=r}Ut("label",((e,t,n)=>{zt(t,"label",".label { position: absolute; box-sizing: border-box; }");const r=(Array.isArray(e.text)?e.text:[e.text]).map((n=>{let r=yt(t,"object"==typeof n&&"text"in n?n.text:n);if(e.id){let n=t.context;for(;n;)n.special&&n.special.values&&(n.special.values[e.id]||(n.special.values[e.id]=[])).push(r),n=n.parent}return e.format&&e.format.name&&(r=yt(t,{op:"format",args:[r,`'${e.format.name}'`].concat(e.format.args||[])})),"object"==typeof n&&"text"in n?`<span${en(t,[],[nn(n.font),""])}>${r}</span>`:r})).join("");return`<span${en(t,["label"],tn(e,n,t))}>${Tt(r)}</span>`})),Ut("container",((e,t,n,r)=>{let o;zt(t,"container",".container { position: absolute; box-sizing: border-box; }"),e.height?"number"==typeof e.height&&(o=Bt(e,n)):e.height="auto";const i=function(e,t,n,r,o){if(Array.isArray(e.widgets)){let i="";const a=(r||{offset:0}).offset,s=[[0,a,0,0]],l=Kt(e);s[0][0]+=l[3],s[0][1]+=l[0];for(let u=r&&r.state&&r.state.last||0;u<e.widgets.length;u++){const c=e.widgets[u];if(c.hide&&yt(t,c.hide))continue;let f=n&&Bt(c,n);if(f>n.maxY&&(f=1),n&&n.availableY&&f>n.availableY)return(r=r||{offset:Gt(s)}).last=u,{output:i,continue:r,height:s.map((([e,t])=>e+t)).reduce(((e,t)=>t>e?t:e),0)};{const e=Array.isArray(o)&&o[u];let f=Array.isArray(e)?{x:e[0]+l[3],y:e[1]+l[0],maxX:n.maxX}:e||n;o&&"string"!=typeof o||(f=(o&&_t[o]||_t.row)(c,a,l,n,s)),f.maxX=f.maxX||n.maxX,f.maxY=f.maxY||n.maxY;const{x:p,y:g}=f,h=Rt(c,t,f,r&&r.child);if("string"==typeof h&&!h||!h.cancel&&!h.output&&!h.height)continue;if("string"==typeof h)i+=h,s.unshift([p,g,Wt(c,n),Bt(c,n)]);else{if(h.cancel&&!s.length)return{output:"",cancel:!0};if(i+=h.output,s.unshift([p,g,h.width||Wt(c,n),h.height||Bt(c,n)]),h.continue)return(r=r||{offset:0}).child=h.continue,r.last=u,r.offset=Gt(s),{output:i,continue:r,height:Gt(s),width:Vt(s)}}}}return{output:i,height:Bt(e,n)||Gt(s)-l[0],width:Wt(e,n)||Vt(s)-l[3]}}return{output:""}}(e,e.context?Nt(t,{value:yt(t,e.context)}):t,{x:0,y:0,availableX:"number"==typeof e.width?e.width:n.availableX,availableY:o||n.availableY,maxX:n.maxX,maxY:n.maxY},r,e.layout);return i.cancel||(i.output=`<div${en(t,["container"],tn(e,n,t,{computedHeight:o||i.height,container:!0}))}>${i.output}</div>`,i.height=o||i.height),i}),{container:!0}),Ut("repeater",((e,t,n,r)=>{zt(t,"container",".container { position: absolute; box-sizing: border-box; }"),e.height||(e.height="auto");let o,i=n.availableY,a=n.availableX,s="",l=!1;let u,c,f=Kt(e)[0],p=!1,g=r&&r.state&&r.state.src;if(!g){if(!e.source)return"";g=At(e.source)?yt(t,e.source):$t(t.context.root.sources[e.source.source]||{value:[]},e.source.filter,e.source.sort,e.source.group,t.context).value,(t.context.special||(t.context.special={})).values||(t.context.special.values={})}if(Array.isArray(g))c=g;else{if(!g||!Array.isArray(g.value))return{output:"",height:0};u=g,c=u.value,e.group&&(p=e.group.length>u.grouped&&e.group.length-u.grouped-1)}if(u&&(!r||!r.state||"group"===r.state.part)&&(!1!==p&&(o=Rt(e.group[p],Nt(t,{value:u,special:{group:u.group,level:u&&u.level}}),{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY})),o)){if(o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"group",src:g,current:0}}};i-=o.height,s+=o.output,f+=o.height}if(e.header&&(r&&"body"===r.state.part&&!1!==e.headerPerPage&&(!u||!u.grouped)||(!u||!u.grouped)&&(!r||!r.state||"header"===r.state.part||"group"===r.state.part))){if(o=Rt(e.header,t,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:"",height:0,continue:{offset:0,state:{part:"header",src:g,current:0}}};i-=o.height,s+=o.output,f+=o.height}let h=r&&r.state&&r.state.context||Nt(t,{special:{level:u&&u.level,group:u&&u.group,values:{}}});if(!r||!r.state||"footer"!==r.state.part){let p=0,d=0;for(let m=r&&r.state&&r.state.current||0;m<c.length;m++){const y=u&&u.grouped?Nt(h,{value:c[m],special:{index:m,values:{}}}):Nt(h,{value:c[m],special:{index:m}});if(u&&u.grouped){const t=r&&r.child||{offset:0,state:{current:0,src:c[m],part:"group"}};o=Rt(e,y,{x:0,y:f,availableX:a-p,availableY:i,maxX:n.maxX,maxY:n.maxY},t)}else o=Rt(e.row,y,{x:p,y:f,availableX:a-p,maxX:n.maxX,availableY:i,maxY:n.maxY});if(r&&(r.child=null),o.width&&o.width<a-p)p+=o.width,o.height>d&&(d=o.height);else if(o.width&&p&&o.width>a-p){f+=d,i-=d,d=0,p=0,m--;continue}if(o.height>i||o.cancel)return l?{output:`<div${en(t,["container","repeat"],tn(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"body",src:g,current:m,context:h}}}:{output:"",height:f,continue:{offset:f,state:{part:r.state.part,src:g,current:m,context:h}}};if(d||(i-=o.height),d||(f+=o.height),s+=o.output,l=!0,u&&o.continue)return{output:`<div${en(t,["container","repeat"],tn(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"body",src:g,current:m,context:h},child:o.continue}}}}if(e.footer){const a=h&&h.context||r&&r.state&&r.state.context&&r.state.context.context,l=Nt(t,{special:{source:u&&u.grouped?u.all:c,level:u&&u.level,grouped:u&&u.grouped,values:(a&&a.special||{}).values}});if(o=u?e.groupEnds&&e.groupEnds[u.grouped]?Rt(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}):{output:"",height:0}:Rt(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o.height>i)return{output:`<div${en(t,["container","repeat"],tn(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f,continue:{offset:f,state:{part:"footer",src:g,current:0,context:h}}};s+=o.output,f+=o.height}return{output:`<div${en(t,["container","repeat"],tn(e,n,t,{computedHeight:f,container:!0}))}>\n${s}</div>`,height:f}}),{container:!0}),Ut("image",((e,t,n)=>(zt(t,"image",".image { position: absolute; }"),`<img src="${yt(t,e.url)}"${en(t,["image"],tn(e,n,t))} />`))),Ut("measured",((e,t,n,r)=>{const o=yt(t,e.text),i=It(o,Jt(e,n)||n.availableX,e.font);if(!r&&i>n.availableY)return{output:"",height:0,continue:{state:{},offset:0}};{let r=tn(e,n,t,{computedHeight:i,container:!0});return r[0]=`display:inline-block;white-space:pre-wrap;line-height:${e.font&&e.font.line||e.font&&e.font.size||1}rem;`+r[0],{height:i,output:`<span${en(t,["label"],r)}>${Tt(o)}</span>`}}})),Ut("html",((e,t,n)=>{zt(t,"html",".html {position:absolute;box-sizing:border-box;overflow:hidden;word-break:break-all;line-height:1rem;}");const r=yt(t,e.html);return`<div${en(t,["html"],tn(e,n,t,{container:!0}))}>${r}</div>`}));const on=/(\d)(?=(\d{3})+\.)/g,an=/(\d)(?=(\d{3})+$)/g,sn=/^[-0-9\\.,]+$/;function ln(e,t=2){return e="number"!=typeof e?parseFloat(e||""):e,isNaN(e)?"":(e=e.toFixed(t),0===t&&(e=e.replace(/\..*/,"")),e.replace(-1===e.indexOf(".")?an:on,"$1,"))}const un=/y+|M+|d+|E+|H+|m+|s+|k+|h+|a+/g,cn=["January","February","March","April","May","June","July","August","September","October","November","December"],fn=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let pn;function gn(e,t){if(!e)return"";if("string"==typeof e)e=new Date(e);else if("[object Date]"!==Object.prototype.toString.call(e))return"";const n=e;return t||(t=pn),t?t.replace(un,(e=>{if("y"===e[0])return e.length<=2?(""+n.getFullYear()).substr(2,2):""+n.getFullYear();if("M"===e[0])return 1===e.length?""+(n.getMonth()+1):2===e.length?n.getMonth()<9?"0"+(n.getMonth()+1):""+(n.getMonth()+1):3===e.length?cn[n.getMonth()].substr(0,3):cn[n.getMonth()];if("d"===e[0])return 1===e.length?""+n.getDate():n.getDate()<=9?"0"+n.getDate():""+n.getDate();if("E"===e[0])return 1===e.length?""+(n.getDay()+1):2===e.length?fn[n.getDay()].substr(0,3):fn[n.getDay()];if("H"===e[0])return 1===e.length?""+n.getHours():n.getHours()<=9?"0"+n.getHours():""+n.getHours();if("m"===e[0])return 1===e.length?""+n.getMinutes():n.getMinutes()<=9?"0"+n.getMinutes():""+n.getMinutes();if("s"===e[0])return 1===e.length?""+n.getSeconds():n.getSeconds()<=9?"0"+n.getSeconds():""+n.getSeconds();if("k"===e[0]||"h"===e[0]){let e=""+n.getHours()%12;return"0"===e&&(e="12"),""+e}return"a"===e[0]?n.getHours()>11?"PM":"AM":void 0})):new Date(+e-6e4*e.getTimezoneOffset()).toISOString().substr(0,10)}function hn(e,t){return{type:"value",names:e,apply:t}}gn.setDefault=function(e){pn=e},bt(hn(["is","is-not","==","!="],((e,t)=>{const[n,r]=t,o=n==r;return"is"===e||"=="===e?o:!o})),hn(["not"],((e,t)=>!t[0])),hn(["<",">","<=",">="],((e,t)=>{let[n,r]=t;return n instanceof Date||r instanceof Date?"number"==typeof n||"number"==typeof r?(n=+n,r=+r):"string"==typeof n||"string"==typeof r?(n=new Date(n),r=new Date(r)):"f"in n&&"o"in n?(n=Yt(n)["<"===e[0]?1:0],r=new Date(r)):"f"in r&&"o"in r&&(r=Yt(r)["<"===e||">="===e?0:1],n=new Date(n)):Ot(n)?(n=Yt(n)["<"===e[0]?1:0],r=Ot(r)?Yt(r)["<"===e||">="===e?0:1]:new Date(r)):Ot(r)&&(r=Yt(r)["<"===e||">="===e?0:1],n=new Date(n)),"<"===e?n<r:">"===e?n>r:"<="===e?n<=r:">="===e&&n>=r})),hn(["like","not-like","ilike","not-ilike"],((e,t)=>{const[n,r,o]=t;if("string"!=typeof r)return!1;let i;const a=new RegExp(`${"free"===o?"":"^"}${r.replace(/[\s\%\*]+/g,".*").replace(/\?/g,".")}${"free"===o?"":"$"}`,~e.indexOf("ilike")?"i":"");return i=Array.isArray(n)?!!n.find((e=>a.test(e))):a.test(n),"like"===e||"ilike"===e?i:!i})),hn(["in","not-in"],((e,t)=>{const[n,r]=t;if(Ot(r)){const t=Yt(r),o=Ot(n)?Yt(n)[0]:new Date(n),i=o>=t[0]&&o<=t[1];return"in"===e?i:!i}if(!Array.isArray(r)&&"string"!=typeof r)return"in"===e?n==r:n!=r;const o=!!~r.indexOf(n);return"in"===e?o:!o})),hn(["contains","does-not-contain"],((e,t)=>{const[n,r]=t;if(Ot(n)){const t=Yt(n),o=Ot(r)?Yt(r)[0]:new Date(r),i=o>=t[0]&&o<=t[1];return"contains"===e?i:!i}if(!Array.isArray(n)&&"string"!=typeof n)return!1;const o=!!~n.indexOf(r);return"contains"===e?o:!o})),hn(["get"],((e,t,n)=>{const[r,o]=t,i=Mt(n,{value:r});return"string"==typeof(a=o)||"object"==typeof a&&Array.isArray(a.k)?dt(i,o):yt(i,o);var a})),hn(["array"],((e,t)=>t)),hn(["object"],((e,t)=>{const n={};for(let e=0;e<t.length;e+=2)n[t[e]]=t[e+1];return n})),hn(["split"],((e,[t,n])=>"string"!=typeof t?[t]:t.split(n||""))),hn(["filter"],((e,t,n)=>{let[r,o,i,a]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return[];r=r.value}return $t({value:r},o,i,a,n).value})),hn(["source"],((e,t)=>{const[n]=t;return{value:n}})),hn(["group"],((e,t,n)=>{n=n||new kt({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return $t({value:r},null,null,o,n)})),hn(["sort"],((e,t,n)=>{n=n||new kt({});let[r,o]=t;if(!Array.isArray(r)){if(!r||!Array.isArray(r.value))return{};r=r.value}return $t({value:r},null,o,null,n)})),hn(["time-span-ms"],((e,[t,n])=>{n||(n=1);const r=[0,0,0,0,0,0];e:{if(""===t||isNaN(t))return"";if(t=Math.abs(+t),r[0]=Math.floor(t/pe),n<r.filter((e=>e)).length)break e;if(t%=pe,r[1]=Math.floor(t/ge),n<r.filter((e=>e)).length)break e;if(t%=ge,r[2]=Math.floor(t/he),n<r.filter((e=>e)).length)break e;if(t%=he,r[3]=Math.floor(t/de),n<r.filter((e=>e)).length)break e;if(t%=de,r[4]=Math.floor(t/me),n<r.filter((e=>e)).length)break e;r[5]=t%me}let o="";return r[0]&&(o+=`${r[0]} week${r[0]>1?"s":""}`),r[1]&&(o+=`${o.length?" ":""}${r[1]} day${r[1]>1?"s":""}`),r[2]&&(o+=`${o.length?" ":""}${r[2]} hour${r[2]>1?"s":""}`),r[3]&&(o+=`${o.length?" ":""}${r[3]} minute${r[3]>1?"s":""}`),r[4]&&(o+=`${o.length?" ":""}${r[4]} second${r[4]>1?"s":""}`),r[5]&&(o+=`${o.length?" ":""}${r[5]} millisecond${r[5]>1?"s":""}`),o})),hn(["call"],((e,t)=>{if(null!=t[0]&&"string"==typeof t[1]&&"function"==typeof t[0][t[1]]){const e=t.shift();return e[t.shift()].apply(e,t)}if("function"==typeof t[0]){return t.shift().apply(null,t)}}))),bt(hn(["+"],((e,t)=>{if(Array.isArray(t[0]))return t[0].concat.apply(t[0],t.slice(1));return t.reduce(((e,t)=>e&&!isNaN(t)&&""!==t),!0)?t.reduce(((e,t)=>e+ +t),0):t.reduce(((e,t)=>e+t),"")})),hn(["-"],((e,t)=>{const n=t.shift();return t.reduce(((e,t)=>e-(isNaN(t)?0:+t)),isNaN(n)?0:+n)})),hn(["*"],((e,t)=>{const n=t.shift();return isNaN(n)?0:t.reduce(((e,t)=>e*(isNaN(t)?0:+t)),+n)})),hn(["/"],((e,t)=>{const n=t.shift();return isNaN(n)?0:t.reduce(((e,t)=>e/(isNaN(t)?1:+t)),+n)})),hn(["%"],((e,t)=>{const n=t.shift();return t.reduce(((e,t)=>e%(isNaN(t)?1:+t)),isNaN(n)?0:+n)})),hn(["pow","**"],((e,t)=>{const n=t.pop(),r=Math.pow(t.pop(),n);return t.reverse().reduce(((e,t)=>Math.pow(t,e)),r)})),hn(["abs"],((e,t)=>"number"!=typeof t[0]?t[0]:Math.abs(t[0]))),hn(["round"],((e,t)=>Math.round(t[0]))),hn(["floor"],((e,t)=>Math.floor(t[0]))),hn(["ceil"],((e,t)=>Math.ceil(t[0]))),hn(["rand","random"],((e,[t,n,r])=>{let o;return null==t?Math.random():("number"!=typeof n?o=Math.random()*t:"number"==typeof n&&(o=Math.random()*(n-t)+t),!0===n||!0===r?o:Math.round(o))})));const dn=/^\s*/,mn=/\s*$/,yn=/([\.\[\]\{\}\(\)\^\$\*\+\-])/g;bt(hn(["padl","padr"],((e,t)=>{let[n,r,o]=t;if("string"!=typeof n&&(n=""+n),isNaN(r))return n;o||(o=" "),"string"!=typeof o&&(o=""+o),o.length<1&&(o=" ");for(let t=n.length;t<r;t=n.length)"padl"===e?n=o+n:n+=o;return n})),hn(["trim","triml","trimr"],((e,t)=>{let[n]=t;return n=""+n,"trim"!==e&&"trimr"!==e||(n=n.replace(mn,"")),"trim"!==e&&"triml"!==e||(n=n.replace(dn,"")),n})),hn(["slice","substr"],((e,[t,n,r])=>{if(t&&"function"==typeof t.slice)return t.slice(n,r)})),hn(["len","length"],((e,[t])=>t&&"length"in t?t.length:0)),hn(["replace","replace-all"],((e,[t,n,r,o])=>{t=""+t;const i="string"==typeof o;return"replace-all"===e||i?t.replace(new RegExp(i?n:n.replace(yn,"\\$1"),("replace"===e||o&&~o.indexOf("g")?o:(o||"")+"g")||"g"),r):t.replace(n,r)})),hn(["reverse"],((e,[t])=>{if("string"==typeof t){let e="";for(let n=0;n<t.length;n++)e=t[n]+e;return e}if(Array.isArray(t))return t.reverse()})),hn(["keys"],((e,[t,n])=>{if(!t)return[];if(n){const e=[];for(const n in t)e.push(n);return e}return Object.keys(t)})),hn(["values"],((e,[t])=>t?Object.values(t):[])),hn(["date"],((e,[t,n])=>{if(void 0!==t){if(Ot(t)){const e=Yt(t);return"s"===n||"start"===n?e[0]:"e"===n||"end"===n?e[1]:e}return new Date(t)}return new Date})),hn(["upper","lower"],((e,[t])=>(t=null==t?"":t,"upper"===e?(""+t).toUpperCase():(""+t).toLowerCase()))),hn(["format","fmt"],((e,t)=>{let[n,r,...o]=t;const i=Xt[r];return i?i(n,o):""+n}))),bt({type:"checked",names:["and","&&"],checkArg:(e,t,n,r)=>r?"continue":{result:r},apply:(e,t)=>t[t.length-1]},{type:"checked",names:["or","||"],checkArg:(e,t,n,r)=>r?{result:r}:"continue",apply:()=>!1},{type:"checked",names:["if","unless"],checkArg:(e,t,n,r)=>t%2==0?t===n?{result:r}:("if"===e?!r:r)?{skip:1}:"continue":{result:r},apply(){}},{type:"checked",names:["coalesce","coalesce-truth"],checkArg:(e,t,n,r)=>"coalesce"===e&&null!=r||r?{result:r}:"continue",apply(){}}),bt({type:"aggregate",names:["avg"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+(n[0]?yt(r,n[0],t):t)),0)/t.length},{type:"aggregate",names:["sum"],apply:(e,t,n,r)=>t.reduce(((e,t)=>e+(n[0]?yt(r,n[0],t):t)),0)},{type:"aggregate",names:["count"],apply:(e,t,n,r)=>n.length?t.filter((e=>yt(r,n[0],e))).length:t.length},{type:"aggregate",names:["min","max"],apply:(e,t,n,r)=>(n[0]&&(t=t.map((e=>yt(r,n[0],e)))),Math[e].apply(Math,t))},{type:"aggregate",names:["first","nth","last"],apply(e,t,n,r){let o,i=0;if("first"===e)o=t[0];else if("last"===e)o=t[t.length-1];else if(n[0]){const e=yt(r,n[0]);"number"==typeof e&&(o=t[e],i=1)}return n[i]&&(o=yt(r,n[i])),o}},{type:"aggregate",names:["map"],apply:(e,t,n,r)=>n[0]?t.map((e=>yt(r,n[0],e))):t},{type:"aggregate",names:["unique","unique-map"],apply(e,t,n,r){const o=[],i=[];for(const e of t){const t=n[0]?yt(r,n[0],e):e;~o.indexOf(t)||(o.push(t),i.push(e))}return"unique"===e?i:o}},{type:"aggregate",names:["join"],apply:(e,t,n,r)=>n.length>1?t.map((e=>yt(r,n[0],e))).join(yt(r,n[1])):t.join(yt(r,n[0]))},{type:"aggregate",names:["find"],apply(e,t,n,r){if(n[0]){if("object"==typeof n[0]&&"a"in n[0])return t.find((e=>yt(r,n[0],e)));{const e=yt(r,n[0]);return t.find((t=>t==e))}}}}),Dt("dollar",((e,[t,n])=>function(e,t,n=2,r="$"){return e&&sn.test(e)&&+e>0?`${r}${ln(e,n)}`:void 0!==t?t:e}(e,void 0,t,n))),Dt("date",((e,[t])=>gn(e,t))),Dt("integer",((e,[])=>ln(e,0))),Dt("int",((e,[])=>ln(e,0))),Dt("number",((e,[t])=>ln(e,t))),Dt("num",((e,[t])=>ln(e,t))),Dt("phone",(e=>{return"number"==typeof(t=e)&&(t=t.toString()),7===(t=(t=t||"").replace(/[^\d]/g,"")).length?`${t.substr(0,3)}-${t.substr(3,4)}`:10===t.length?`(${t.substr(0,3)}) ${t.substr(3,3)}-${t.substr(6,4)}`:11===t.length?`${t[0]}-${t.substr(1,3)}-${t.substr(4,3)}-${t.substr(7,4)}`:t;var t}));const vn=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function bn(e){const t=xn(e);let n=Array.isArray(e)?e[0]||{}:e;if(Array.isArray(n)||"object"==typeof n){const e=[];for(const t in n)e.push($n(t,n[t]));return{root:t,fields:e}}return{root:t}}function $n(e,t){const n=xn(t);if(~n.indexOf("object")||"array"===n){const r=bn(t);return r.fields?{type:n,fields:r.fields,name:e}:{type:n,name:e}}return{type:xn(t),name:e}}function xn(e){return"string"==typeof e?vn.test(e)?"date":"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":Array.isArray(e)?e.length<1?"array":"string"==typeof e[0]?vn.test(e[0])?"date[]":"string[]":"number"==typeof e[0]?"number[]":"boolean"==typeof e[0]?"boolean[]":"object"==typeof e[0]&&e[0]instanceof Date?"date[]":"object"==typeof e[0]?"object[]":"array":"object"==typeof e?e instanceof Date?"date":"object":"any"}e.PageSizes={letter:{width:51,height:66,margin:[1.5,1.5]},legal:{width:51,height:84,margin:[1.5,1.5]},tabloid:{width:66,height:102,margin:[1.5,1.5]},a4:{width:49.606302,height:70.15746,margin:[1.5,1.5]}},e.Root=kt,e.applySource=rn,e.evaluate=yt,e.extend=Mt,e.filter=$t,e.getOperatorMap=function(){return Object.assign({},vt)},e.inspect=bn,e.isValueOrExpr=At,e.join=function(e,t){return{parent:e,root:e.root,path:e.path?`${e.path}.${t}`:t,value:dt(e,t)}},e.parse=ut,e.registerFormat=Dt,e.registerLayout=Pt,e.registerOperator=bt,e.registerRenderer=Ut,e.run=function(e,t,n,r){const o=n&&"root"in n&&n.root===n?n:new kt(Object.assign({},e.context),{parameters:n});if(e.sources){for(const n of e.sources)rn(o,n,t);for(const e in o.sources)o.value[e]=o.sources[e].value}return"delimited"===e.type?function(e,t){const n=t.root.sources[e.source?e.source:e.sources[0].name||e.sources[0].source];let r="";e.headers&&(r+=e.headers.map((n=>`${e.quote||""}${yt(t,n)}${e.quote||""}`)).join(e.field||",")+(e.record||"\n"));const o=Array.isArray(n.value)?n.value:[n.value],i=e.quote?new RegExp(e.quote,"g"):void 0;for(const n of o){const o=Mt(t,{value:n});r+=e.fields.map((t=>{let n=""+yt(o,t);return i&&(n=n.replace(i,e.quote+e.quote)),`${e.quote||""}${n}${e.quote||""}`})).join(e.field||",")+(e.record||"\n")}return r}(e,o):"flow"===e.type?function(e,t,n){const r={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};let o,i="",a=0,s=null;e.width?o=e.width:e.size&&(o="landscape"===e.orientation?e.size.height:e.size.width);for(const t of e.widgets){let e;i+=`<div${en(r,[],["position:absolute;right:0rem;left:0rem;"+(o?`width:${o}rem;`:""),""],`top:${a}rem;`,"p")}>\n`;let n=0;do{if(e=Rt(t,r,{x:0,y:n,availableX:o,maxX:o},s),"string"==typeof e)throw new Error("Container widget didn't specify used height");i+=e.output,n+=e.height,s=e.continue?e.continue:null}while(null!==s);a+=n,i+="</div>\n"}const l=e.size&&e.size.margin?Kt(e.size):[1.5,1.5,1.5,1.5];return`<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${o?` width: ${o}rem;`:""} }\n    #wrapper { height:${a}rem; position: relative; }\n    @media screen {\n      body { margin: 1rem; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${l[0]}rem ${l[1]}rem ${l[2]}rem ${l[3]}rem; }\n      html { background-color: #999; }\n    }${Object.entries(r.styles).map((([e,t])=>t)).join("\n")}${Object.entries(r.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n<div id=wrapper>${i}</div>${n&&n.foot||""}</body></html>`}(e,o,r):function(e,t,n){let r="landscape"===e.orientation?{width:e.size.height,height:e.size.width,margin:[e.size.margin[1],e.size.margin[0]]}:e.size;const o={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};t.special=t.special||{},t.special.page=0,t.special.pages=0;const i=[""];let a=0,s=r.height-2*r.margin[0],l=s,u=0;const c=r.width-2*r.margin[1];let f=null,p=0;if(e.header){p=Rt(e.header,o,{x:0,y:0,availableX:c,availableY:s,maxX:c,maxY:l}).height,s-=p,l-=p,u+=p}let g=0;if(e.footer){g=Rt(e.footer,o,{x:0,y:0,availableX:c,availableY:s,maxX:c,maxY:l}).height,s-=g,l-=g}for(const t of e.widgets){let e;do{e=Rt(t,o,{x:0,y:u,availableX:c,availableY:s,maxX:c,maxY:l},f),i[a]+=e.output,e.continue?(a++,i[a]="",u=p,s=r.height-2*r.margin[0]-p-g,f=e.continue):(u+=e.height,s-=e.height,f=null)}while(null!==f)}t.special.pages=i.length;const h=r.height-2*r.margin[0]-g;return i.forEach(((n,r)=>{let a=`<div class="page-back pb${r}"><div${en(o,["page","ps"+r],["",""],"","p")}>\n`;if(t.special.page=r+1,e.header){a+=Rt(e.header,o,{x:0,y:0,maxX:c,maxY:l}).output+"\n"}if(a+=n,e.footer){a+=Rt(e.footer,o,{x:0,y:h,maxX:c,maxY:l}).output+"\n"}a+="\n</div></div>",i[r]=a})),`<html style="font-size:100%;margin:0;padding:0;"><head><style>\n    .page { width: ${r.width-2*r.margin[1]}rem; height: ${r.height-2*r.margin[0]}rem; position: absolute; overflow: hidden; left: ${r.margin[1]}rem; top: ${r.margin[0]}rem; }\n    .page-back { width: ${r.width}rem; height: ${r.height}rem; }\n    @media screen {\n      html { min-width: ${r.width+2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { font-size: 0.83rem; margin: 0; padding: 0; ${r?`width:${r.width}rem;`:""}background-color: none; display: block; height: ${i.length*r.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${i.map(((e,t)=>`.pb${t} { top: ${t*r.height}rem; }`)).join("")}\n    }\n    @page {\n      size: ${r.width}em ${r.height}em;\n    }${Object.entries(o.styles).map((([e,t])=>t)).join("\n")}${Object.entries(o.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n${i.reduce(((e,t)=>e+t),"")}${n&&n.foot||""}</body></html>`}(e,o,r)},e.safeGet=dt,e.stringify=function(e,t){return pt=(t=t||{}).noSymbols,gt=!1,ht(e)},e.unregisterFormat=function(e){delete Xt[e]},e.unregisterOperator=function(...e){for(const t of e)for(const e of t.names)delete vt[e]},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=raport.umd.min.js.map
