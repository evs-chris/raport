!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Raport={})}(this,(function(e){"use strict";const t=[];let n=0;const r=[0,""],o=[0,""];function i(){return r}function s(e){return a(e?e.name||e:void 0),r.slice()}function a(e){!r[2]&&e&&(r[0]===o[0]&&r[2]===o[2]&&(o[2]=e),r[2]=e)}function l(e,i,s,a,l){return r[0]=e,r[1]=i||"",r[2]=s,r[3]=a,r[4]=l,1&n&&r[0]>=o[0]&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[4]=r[4]),t}function u(e){return"string"==typeof e||e&&"name"in e&&"string"==typeof e.name}function c(e,t){return{start:e,end:e,children:[],name:t}}function f(e,t,n){if(e.end=n[1],!m||e.end!==e.start)if(e.result=n[0],t)if(m)if(e.name&&e.name.primary){const n=e.children[0];if(1===e.children.length&&n.start===e.start&&n.end===e.end)t.children.push(n);else{e.name=e.name.name,e.children.reduce(((t,n,r)=>(t<n.start&&((e.extra||(e.extra={}))[r]=[t,n.start]),n.end)),e.start);const n=e.children[e.children.length-1];n&&e.end>n.end&&((e.extra||(e.extra={}))[e.children.length]=[n.end,e.end]),t.children.push(e)}}else e.children.length&&t.children.push.apply(t.children,e.children);else t.children.push(e);else{e.children.reduce(((t,n,r)=>(t<n.start&&((e.extra||(e.extra={}))[r]=[t,n.start]),n.end)),e.start);const t=e.children[e.children.length-1];t&&e.end>t.end&&((e.extra||(e.extra={}))[e.children.length]=[t.end,e.end])}}function p(e,t){let n=1;for(;~(t=e.lastIndexOf("\n",t))&&t;)n++,t--;return n}function d(e,t,n){const r=[],o=e[0];let i=o,s=i=t.lastIndexOf("\n",i),a=t.lastIndexOf("\n",i-1);for(let e=0;e<n&&~i;e++)r.unshift(t.substring(a+1,i)),i=a,a=t.lastIndexOf("\n",i-1);const l=r.length+1;a=s,i=t.indexOf("\n",a+1),-1===i&&a<t.length&&(i=t.length);for(let e=0;e<=n&&~i;e++)r.push(t.substring(a+1,i)),a=i,i=t.indexOf("\n",a+1),-1===i&&a<t.length&&(i=t.length);const u=r[l-1];let c="";const f=o-(~s?s:-1)-1;for(let e=0;e<f;e++)c+="\t"===u[e]?"\t":" ";return c+="^--",{context:r,column:o-s,line:p(t,o),position:o,source:u,message:e[1],marked:`${r.slice(0,l).join("\n")}\n${c}\n${r.slice(l).join("\n")}`,cause:e[3]&&d(e[3],t,n),causes:e[4]&&e[4].map((e=>d(e,t,n))),parser:e[2]?e[2].name||e[2]:void 0}}function g(e){let t=e;if(e[3]){const n=g(e[3]);n[0]>t[0]&&(t=n)}if(e[4]){const n=e[4].length;for(let r=0;r<n;r++){const n=g(e[4][r]);n[0]>t[0]&&(t=n)}}return o[0]>=r[0]&&o[1]!==e[1]?o:t}const h=/^\s*/,y={};let m=!1;function $(e,t){let r;const s=t,a=t?(t.detailed?1:0)+(t.causes?2:0):0,u=t&&t.consumeAll,p=function(t,p){const $=p&&"trim"in p?p.trim:s&&s.trim,v=$?h.exec(t)[0].length:0;$&&(e=y.map(y.seq(e,y.skip(" \t\r\n")),(([e])=>e)));const x=p?(p.detailed?1:0)+(p.causes?2:0):a;let w=[null,0];1&x&&(o[0]=0,o[1]="",o[2]=void 0,o[3]=void 0,o[4]=void 0);const A=p&&"tree"in p&&p.tree&&c(0);if(m=A&&!0===(p&&"compact"in p?p.compact:!(!s||!("compact"in s))&&s.compact),x!==n){const o=n;n=x,w=(r||(r=b(e))).parse(t,v,w,A),n=o}else w=(r||(r=b(e))).parse(t,v,w,A);if(w.length&&(p&&"consumeAll"in p?p.consumeAll:u)&&w[1]<t.length&&(w=l(w[1],1&x&&`expected to consume all input, but only ${w[1]} chars consumed`)),w.length){if(A){if(f(A,null,w),!m&&$){const e=A.children[0].children[0];return e.result=w[0],e}return A}return w[0]}{if(p&&"undefinedOnError"in p?p.undefinedOnError:s&&s.undefinedOnError)return;const e=i(),n=(p&&"contextLines"in p?p.contextLines:s&&s.contextLines)||0,r=d(j(e[4]||[],e),t,n),o=g(e);if(e!==o&&(r.latest=d(o,t,n)),p&&"throw"in p?p.throw:s&&s.throw){const e=new Error(r.message);throw Object.assign(e,r)}return r}};return p.parser=e,p}const v={parse:(e,t)=>l(t,1&n&&"uninitialized lazy parser")};function b(e){return e.parser||e||v}function x(e,t){let n;return n={parse:(r,o,i,s)=>(e(),n.parse=t,t(r,o,i,s))},n}const w={parse:(e,t,n)=>(n[0]="",n[1]=t,n)};function A(e){let t="";const n=e.length;for(let r=0;r<n;r++)e[r]&&(t=t.concat(e[r]));return t}function j(e,t){if(!e||!t)return o;let n,r=t[0];t[4]=e;const i=e||[];for(let e=0;e<i.length;e++)i[e][0]>r&&(n=i[e],r=n[0]);return n?[n[0],n[1],n[2],t]:t}function k(){return!1}function O(e,t){return e===t}function M(e,t){return e[0]===t||e[1]===t}function Y(e,t){return e[0]===t||e[1]===t||e[2]===t}function D(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t}function X(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t}function z(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t}function C(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t}function F(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t}function S(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t}function N(e,t){return e[0]===t||e[1]===t||e[2]===t||e[3]===t||e[4]===t||e[5]===t||e[6]===t||e[7]===t||e[8]===t||e[9]===t}function T(e,t){const n=e.length;for(let r=0;r<n;r++)if(e[r]===t)return!0;return!1}function q(e,t){let n,r,o=e.length-1,i=0;if(t<e[0]||t>e[o])return!1;for(;i<=o;){if(n=i+o>>1,r=e[n],r===t)return!0;r<t?i=n+1:o=n-1}}function U(e,t=!0){const n=e.length;return 0===n?k:1===n?O:2===n?M:3===n?Y:4===n?D:5===n?X:6===n?z:7===n?C:8===n?F:9===n?S:10===n?N:t?q:T}function H(e){let t="";const n=e.split("").sort().join("");for(let e=0;e<n.length;e++)~t.indexOf(n[e])||(t+=n[e]);return t}function E(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(!r(n,e[i]))return i;return o}function L(e){const t=H(e),n=U(t);return{parse:(e,r,o)=>(o[1]=E(e,r,t,n),o)}}function P(e){const t=H(e),n=U(t);return{parse(e,r,o){const i=E(e,r,t,n);return o[0]=e.substring(r,i),o[1]=i,o}}}function _(e,t){const r=H(e),o=U(r);return{parse(i,s,a){const u=E(i,s,r,o);return u===s?l(s,1&n&&`expected one of ${JSON.stringify(e)}`,t):(a[0]=i.substring(s,u),a[1]=u,a)}}}function R(e,t,r){const o=t&&H(t),i=U(o||"");return{parse(t,s,a){if(t.length-s>=e){const u=t.substr(s,e);if(o)for(let t=0;t<e;t++)if(!i(o,u[t]))return l(s+t,1&n&&"unexpected char",r);return a[0]=u,a[1]=s+e,a}return l(s,1&n&&"unexpected end of input",r)}}}function J(e,t,r){const o=H(e),i=U(o);return{parse(s,a,u){const c=function(e,t,n,r){const o=e.length;for(let i=t;i<o;i++)if(r(n,e[i]))return i;return o}(s,a,o,i);return!t&&c>=s.length?l(c-1,1&n&&`expected one of ${JSON.stringify(e)} before end of input`,r):(u[0]=c?s.substring(a,c):"",u[1]=c,u)}}}function I(e,t,r){const o=J(e,t);return{parse(e,t,i){const s=o.parse(e,t,i);return s.length?s[1]>t?s:l(t,1&n&&"expected at least one character",r):s}}}function Z(...e){const t=e.length;if(1===t){const t=e[0],r=t.length;if(1===r)return{parse:(e,r,o)=>e[r]===t?(o[0]=t,o[1]=r+1,o):l(r,1&n&&`expected ${t}`)};if(2===r)return{parse:(e,r,o)=>e[r]===t[0]&&e[r+1]===t[1]?(o[0]=t,o[1]=r+2,o):l(r,1&n&&`expected ${t}`)};{let e,o;return{parse(i,s,a){for(e=0,o=s+e;e<r;e++,o++)if(t[e]!==i[o])return l(s,1&n&&`expected ${t}`);return a[0]=t,a[1]=s+r,a}}}}return{parse(r,o,i){e:for(let n=0;n<t;n++){const t=e[n],s=t.length;if(1!==s){for(let e=0;e<s;e++)if(t[e]!==r[o+e])continue e;return i[0]=t,i[1]=o+s,i}if(r[o]===t)return[t,o+s]}return l(o,1&n&&`expected ${e.length>1?"one of ":""}${e.map((e=>`${e}`)).join(", ")}`)}}}function V(...e){const t=e.slice(),r=_(t.map((e=>e.toLowerCase()+e.toUpperCase())).join("")),o=t.map((e=>e.toLowerCase()));return{parse(e,i,s){const a=r.parse(e,i,s);if(!a.length)return a;const u=o.indexOf(a[0].toLowerCase());return~u?(a[0]=t[u],a):l(i,1&n&&`expected ${t.length>1?"one of ":""}${t.map((e=>`${e}`)).join(", ")}`)}}}function W(e,t){let n;return x((()=>n=b(e)),(function(e,r,o,i){const s=i&&c(r,t),a=n.parse(e,r,o,s);return a.length?(s&&f(s,i,a),a):(o[0]=null,o[1]=r,o)}))}function B(e,t){let r;return x((()=>r=b(e)),(function(e,o,i){const s=r.parse(e,o,i);return s.length?l(o,1&n&&(t||`unexpected ${e.slice(o,s[1])}`)):(i[0]="",i[1]=o,i)}))}function G(e,...t){const i=u(e)?e:void 0,a=u(e)?t:(e?[e]:[]).concat(t);let p;const d=a.length;return x((()=>p=a.map(b)),(function(e,t,a,u){let g;const h=u&&c(t,i);for(let r=0;r<d;r++){const o=p[r].parse(e,t,a,h);if(o.length)return h&&f(h,u,o),o;2&n&&(g||(g=[])).push(s(i))}if(2&n){const e=j(g,[t,`expected ${i||"alternate"}`,i]);return g.length&&g.map((e=>e[0])).reduce(((e,t)=>e+t),0)===g[0][0]*g.length&&(e[2]=i),l(e[0],e[1],e[2]||i,e[3],e[4])}return 1&n&&j()[0]===t&&i&&function(e){e&&(r[0]===o[0]&&r[2]===o[2]&&(o[2]=e),r[2]=e)}(i&&(i.name||i)),l(t,1&n&&`expected ${i||"alternate"}`,i)}))}function K(e,t,n){let r;return x((()=>r=b(e)),(function(e,o,i,s){const a=s&&c(o,n),u=r.parse(e,o,i,a);if(!u.length)return u;const p=t(u[0]);return!0===p?(a&&f(a,s,u),u):l(u[1],p,n)}))}function Q(e,t,n){let r,o;const i=e=>o=e;return x((()=>r=b(e)),(function(e,s,u,p){const d=p&&c(s,n),g=r.parse(e,s,u,d);if(g.length){const e=o;o="",g[0]=t(g[0],i,s,g[1]);const r=o;return o=e,r?l(g[1],r,n):(d&&f(d,p,g),g)}return a(n&&(n.name||n)),g}))}function ee(e,t){let r;return x((()=>r=b(e)),(function(e,o,i,s){if(s){const l=c(o,t),u=r.parse(e,o,i,l);return u.length&&(l.children.length?(l.children[0].name=t,s.children.push(l.children[0])):f(l,s,u)),1&n&&a("string"==typeof t?t:t.name),u}{const s=r.parse(e,o,i);return!s.length&&1&n&&a("string"==typeof t?t:t.name),s}}))}function te(e,t){let r;const o=[];return x((()=>r=b(e)),(function(e,i,a,l){const u=l&&c(i,t);let p,d,g=i;if(d=r.parse(e,g,a,u),!d.length||d[1]===g)return a[0]=o,a[1]=g,2&n&&(a[2]=s(t)),a;for(g=d[1],p=[d[0]];;){if(d=r.parse(e,g,a,u),!d.length||d[1]===g)return a[0]=p||[],a[1]=g,2&n&&(a[2]=s(t)),u&&f(u,l,a),a;p.push(d[0]),g=d[1]}}))}function ne(e,t){let r;return x((()=>r=b(e)),(function(e,o,i,a){const u=a&&c(o,t);let p,d,g=o;if(d=r.parse(e,g,i,u),!d.length)return l(g,1&n&&`expected at least one ${t||"item"}`,t,2&n&&s(t));for((p=[]).push(d[0]),g=d[1];;){if(d=r.parse(e,g,i,u),!d.length)return i[0]=p,i[1]=g,2&n&&(i[2]=s(t)),u&&f(u,a,i),i;p.push(d[0]),g=d[1]}}))}function re(e,t,r="disallow",o){let a,u;const p=[];return x((()=>(a=b(e),u=b(t))),(function(e,t,d,g){const h=g&&c(t,o);let y,m,$,v,b=t,x=t;if($=a.parse(e,b,d,h),!$.length||$[1]===b)return d[0]=p,d[1]=t,2&n&&(d[2]=s(o)),d;if(m=$[0],x=b,b=$[1],v=u.parse(e,b,d),!v.length)return"require"===r?l(x,1&n&&"expected separator",o):(d[0]=[m],d[1]=b,h&&f(h,g,d),d);for(b=v[1],y=[m];;){if($=a.parse(e,b,d,h),!$.length||$[1]===b){if("disallow"===r&&y&&y.length){if(2&n){const e=i();return l(e[0],e[1],o,[b,"unexpected separator"])}return l(b,1&n&&"unexpected separator",o)}break}if(x=b,b=$[1],m=$[0],v=u.parse(e,b,d),!v.length){if("require"===r)return l(x,1&n&&"expected separator",o);y.push(m);break}b=v[1],y.push(m)}return d[0]=y,d[1]=b,2&n&&(d[2]=s(o)),h&&f(h,g,d),d}))}function oe(e,t,r="disallow",o){let i,a;return x((()=>(i=b(e),a=b(t))),(function(e,t,u,p){const d=p&&c(t,o);let g,h,y=t,m=y;if(h=i.parse(e,y,u,d),!h.length)return l(y,1&n&&`expected at least one ${o||"item"}`);{(g=[]).push(h[0]),m=y=h[1];const t=a.parse(e,y,u);if(t.length)for(y=t[1];;){if(h=i.parse(e,y,u,d),!h.length){if("disallow"===r&&g&&g.length)return u[0]=g,u[1]=m,d&&f(d,p,u),u;break}{g.push(h[0]),m=y=h[1];const t=a.parse(e,y,u);if(!t.length){if("require"===r)return l(y,1&n&&"expected separator",o);break}y=t[1]}}else if("require"===r)return l(y,1&n&&"expected separator",o)}return u[0]=g,u[1]=y,2&n&&(u[2]=s(o)),d&&f(d,p,u),u}))}function ie(e,t,o,i){const s=u(o)?o:u(i)?i:void 0;if(Array.isArray(e)){let r,o;const a=e.length;return x((()=>(o=b(t),r=e.map(b))),(function(e,t,u,p){const d=p&&c(t,s);let g,h;for(let n=0;n<a;n++){if(r[n].parse(e,t,u).length){h=r[n];break}}if(!h)return l(t,1&n&&"expected opening bracket",i);const y=o.parse(e,u[1],u,d);if(!y.length)return y;2&n&&(g=y[2]);const m=y[0],$=y[1];return h.parse(e,$,u).length?(u[0]=m,d&&f(d,p,u),u):l($,1&n&&"expected matching end bracket",i,2&n&&g)}))}if(!u(o)){let i,a,l;return x((()=>(i=b(e),a=b(t),l=b(o))),(function(e,t,o,u){let p;const d=u&&c(t,s),g=i.parse(e,t,o);if(!g.length)return g;const h=a.parse(e,g[1],o,d);if(!h.length)return h;2&n&&h[2]&&(p=h[2]);const y=h[0],m=l.parse(e,h[1],o);return m.length?(o[0]=y,d&&f(d,u,o),o):(2&n&&p&&function(e){(r[4]||(r[4]=[])).push(e)}(p),m)}))}}function se(e,...t){let r,o;"string"!=typeof e?t.unshift(e):r=e;const i=t.length;return x((()=>o=t.map(b)),(function(e,t,a,u){const p=u&&c(t,r);let d,g,h,y=t;if(h=o[0].parse(e,y,a,p),!h.length){if(2&n){const e=j(g,s(r));return l(e[0],e[1],e[2],e[3],e[4])}return h}2&n&&h[2]&&(g||(g=[])).push(h[2]),(d=[]).push(h[0]),y=h[1];for(let t=1;t<i;t++){if(h=o[t].parse(e,y,a,p),!h.length){if(2&n){const e=j(g,s(r));return l(e[0],e[1],e[2],e[3],e[4])}return h}2&n&&h[2]&&(g||(g=[])).push(h[2]),d.push(h[0]),y=h[1]}return a[0]=d,a[1]=y,2&n&&(a[2]=[t,"error in seq",null,null,g]),p&&f(p,u,a),a}))}function ae(e,...t){let r,o;"string"!=typeof e?t.unshift(e):o=e;const i=t.length;return x((()=>r=t.map(b)),(function(e,t,a,u){const p=u&&c(t,o);let d,g,h=t;if(g=r[0].parse(e,h,a),!g.length){if(2&n){const e=j(d,s(o));return l(e[0],e[1],e[2],e[3],e[4])}return g}2&n&&g[2]&&(d||(d=[])).push(g[2]),h=g[1];for(let t=1;t<i;t++){if(g=r[t].parse(e,h,a),!g.length){if(2&n){const e=j(d,s(o));return l(e[0],e[1],e[2],e[3],e[4])}return g}2&n&&g[2]&&(d||(d=[])).push(g[2]),h=g[1]}return a[0]=null,a[1]=h,p&&f(p,u,a),a}))}function le(e,t,r){let o,i;return x((()=>(o=b(e),i=b(t))),(function(e,t,s,a){const u=a&&c(t,r),p=o.parse(e,t,s,u);if(!p.length)return p;const d=p[1];return i.parse(e,d,s).length?l(d,1&n&&`unexpected ${e.slice(d,p[1])}`,r):(u&&f(u,a,p),p)}))}y.skip=L,y.map=Q,y.seq=se;const ue="abcdefABCDEF",ce="0123456789",fe=ue+"abcdefABCDEFghijklmnopqrstuvwxyzGHIJKLMNOPQRSTUVWXYZ$_",pe=ue+ce,de={b:"\b",r:"\r",n:"\n","'":"'",'"':'"',t:"\t","\\":"\\"},ge=/_/g,he=Q(se(W(Z("-","+")),_(ce),P(ce+"_"),W(Z(".")),P(ce+"_"),Q(W(se(Z("e","E"),W(Z("+","-")),_(ce+"_"))),(e=>e&&A(e)))),(e=>+A(e).replace(ge,""))),ye=Q(se(Z("\\"),function(e,t,r){const o=H(t),i=U(o);return{parse(t,s,a){if(t.length-s>=e){const u=t.substr(s,e);for(let t=0;t<e;t++)if(i(o,u[t]))return l(s+t,1&n&&"unexpected char",r);return a[0]=u,a[1]=s+e,a}return l(s,1&n&&"unexpected end of input",r)}}}(1,"xu")),(e=>de[e[1]]||e[1])),me=Q(se(Z("\\u"),R(4,pe)),(e=>String.fromCharCode(parseInt(e[1],16)))),$e=Q(se(Z("\\x"),R(2,pe)),(e=>String.fromCharCode(parseInt(e[1],16)))),ve=G(ie(Z('"'),Q(te(G("string part",I('"\\'),me,$e,ye)),(e=>A(e))),Z('"')),ie(Z("'"),Q(te(G("string part",I("'\\"),me,$e,ye)),(e=>A(e))),Z("'"))),be=Q(Z("true","false"),(e=>"true"===e)),xe=Q(Z("null"),(()=>null)),we=Q(se(_(fe),W(P(fe+ce))),(([e,t])=>null!==t?e+t:e)),Ae=L(" \t\n\r"),je={},ke={},Oe=G("value",ve,je,ke,he,be,xe),Me=Q(se(Ae,G("key",ve,we),ae(Ae,Z(":"),Ae),Oe),(e=>[e[1],e[3]]));je.parser=ie(ae(Z("["),Ae),re(Oe,ae(Ae,Z(","),Ae),"allow"),ae(Ae,Z("]"))),ke.parser=Q(ie(ae(Z("{"),Ae),re(Me,ae(Ae,Z(","),Ae),"allow"),ae(Ae,Z("}"))),(e=>{const t=e.length,n={};for(let r=0;r<t;r++){const t=e[r];n[t[0]]=t[1]}return n})),$(Q(se(Ae,Oe,Ae),(e=>e[1])));const Ye={y:0,m:0,w:0,d:864e5,h:36e5,mm:6e4,s:1e3};function De(e){return"object"==typeof e&&e&&"number"==typeof e.ms}function Xe(e){return"number"==typeof e?e:De(e)?e.ms:1e3*(60*(60*(24*(30.45*(12*(e.d[0]||0)+(e.d[1]||0))+(e.d[2]||0))+(e.d[3]||0))+(e.d[4]||0))+(e.d[5]||0))+(e.d[6]||0)}Ye.w=7*Ye.d,Ye.y=Math.floor(365.25*Ye.d),Ye.m=Math.floor(30.45*Ye.d);const ze=" \r\n\t",Ce=" \r\n\t():{}[]<>,\"'`\\;&#",Fe=Ce+".+/*|^%=!?",Se=Q(se(Ae,Z("//"),W(Z(" ")),J("\n"),Z("\n")),(([,,,e])=>({c:e})),{name:"comment",primary:!0});function Ne(e,t){return Q(se(te(Se),Ae,t),(([t,,n])=>(t&&t.length&&(n[e]=t.map((e=>e.c))),n)))}const Te=function(e,t){const r=H(e),o=U(r);return{parse:(i,s,a)=>(a[1]=E(i,s,r,o),a[1]===s?l(s,1&n&&`expected at least one of ${JSON.stringify(e)}`,t):a)}}(ze,"required-space"),qe=Q(Z("null","true","false","undefined"),(e=>{switch(e){case"null":return null;case"true":return!0;case"false":return!1;case"undefined":return}}),{primary:!0,name:"primitive"}),Ue=I(Fe,!0),He=I(" \r\n\t():{}[],\"'\\;&#@",!0),Ee={},Le={},Pe={},_e={},Re={},Je={},Ie={},Ze={},Ve={n:"\n",r:"\r",t:"\t",b:"\b"},We=Q(se(Z("\\"),R(1)),(([,e])=>Ve[e]||e)),Be=Q(ne(G("ref-part",I(Fe,!0),We)),(e=>e.join("")),"keypath-part"),Ge=Q(se(Z("."),Be),(([,e])=>e)),Ke=ie(se(Z("["),Ae),Re,se(Ae,Z("]"))),Qe=Q(se(G("ref-sigil",Z("!","~","*"),se(P("^"),W(Z("@",".")))),G("keypath",Be,Ke),te(G("keypath",Ge,Ke))),(([e,t,n])=>{const r={k:[t].concat(n).map((e=>"object"!=typeof e||!("v"in e)||"string"!=typeof e.v&&"number"!=typeof e.v?e:e.v))};return Array.isArray(e)?(e[0]&&(r.u=e[0].length),"@"===e[1]&&(r.p="@")):e&&(r.p=e),r}),"keypath"),et=Q(se(P("^"),Be,te(G("keypath",Ge,Ke))),(([e,t,n])=>{const r={k:[t].concat(n).map((e=>"object"!=typeof e||!("v"in e)||"string"!=typeof e.v&&"number"!=typeof e.v?e:e.v))};return e&&(r.u=e.length),r}),"localpath"),tt=$(Qe),nt=$(et),rt=["if","else","elif","elseif","elsif","fi","esac","unless","then","case","when","not","gte","gt","lte","lt","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain","is-not","is","strict-is-not","strict-is","deep-is-not","deep-is","and","or","end","with","each"],ot=Q(Qe,((e,t)=>(1!==e.k.length||e.p||e.u||!rt.includes(e.k[0])||t(`invalid reference name '${e.k[0]}'`),{r:e})),{primary:!0,name:"reference"});function it(e){const t=e.reduce(((e,t)=>(e.length&&"v"in t&&"v"in e[e.length-1]&&"string"==typeof t.v&&"string"==typeof e[e.length-1].v?e[e.length-1].v+=t.v:e.push(t),e)),[]);return t.length>0&&(!("v"in t[0])||"string"!=typeof t[0].v)&&t.unshift({v:""}),0===t.length?{v:""}:1===t.length?t[0]:{op:"+",args:t}}const st=Q(oe(se(he,Ae,V("years","year","y","months","month","minutes","minute","milliseconds","millisecond","mm","ms","m","weeks","week","w","days","day","d","hours","hour","h","seconds","second","s")),Ae),(e=>{const t={y:0,m:0,d:0,h:0,mm:0,s:0,ms:0};for(let n=0;n<e.length;n++)"y"===e[n][2][0]?t.y+=e[n][0]:"m"===e[n][2]||"months"===e[n][2]||"month"===e[n][2]?t.m+=e[n][0]:"d"===e[n][2][0]?t.d+=e[n][0]:"w"===e[n][2][0]?t.d+=7*e[n][0]:"h"===e[n][2][0]?t.h+=e[n][0]:"s"===e[n][2][0]?t.s+=e[n][0]:"mm"===e[n][2]||"minutes"===e[n][2]||"minute"===e[n][2]?t.mm+=e[n][0]:"ms"!==e[n][2]&&"milliseconds"!==e[n][2]&&"millisecond"!==e[n][2]||(t.ms+=e[n][0]);if(t.y||t.m||t.d){const e=[];return t.y&&(e[0]=t.y),t.m&&(e[1]=t.m),t.d&&(e[2]=t.d),t.h&&(e[3]=t.h),t.mm&&(e[4]=t.mm),t.s&&(e[5]=t.s),t.ms&&(e[6]=t.ms),{d:e}}{delete t.y,delete t.m,delete t.d;let e=0;for(const n in t)e+=t[n]*(Ye[n]||1);return{ms:e}}}),{primary:!0,name:"timespan"}),at=Q(se(Ae,G("timezone",V("z"),se(W(R(1,"+-")),G(R(4,ce),R(2,ce),R(1,ce)),W(se(Z(":"),R(2,ce)))))),(e=>{if("z"===e[1][0])return 0;{let t;return 4===e[1][1].length?t=60*+e[1][1].substr(0,2)+ +e[1][1].substr(2,2):(t=60*+e[1][1],e[1][2]&&(t+=+e[1][2][1])),"-"===e[1][0]&&(t*=-1),t}})),lt=G(Q(se(_(ce),W(se(Z(":"),R(2,ce),W(se(Z(":"),R(2,ce),W(se(Z("."),R(3,ce)))))))),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=r&&e[1][2][2]&&e[1][2][2][1],i=[+t];return n&&(i[1]=+n),r&&(i[2]=+r),o&&(i[3]=+o),i})),Q(V("start","midnight"),(()=>[0,0,0,0])),Q(V("noon","mid"),(()=>[12,0,0,0])),Q(V("end"),(()=>[23,59,59,999]))),ut=$(G(Q(se(lt,W(se(Ae,at))),(([e,t])=>(t&&e.push(t[1]),e))),at),{trim:!0,consumeAll:!0,undefinedOnError:!0}),ct=W(se(Ae,Z(">"))),ft=G("date",Q(se(W(V("last","this","next")),Te,V("week","month","year"),W(at),ct),(([e,,t,n,r])=>{const o={f:"w"===t[0]?"w":"m"===t[0]?"m":"y",o:"last"===e?-1:"next"===e?1:0,e:r?1:void 0};return null!=n&&(o.z=n),o})),Q(se(V("week","month","year"),se(Te,V("to"),Te,V("date")),W(at),ct),(([e,,t,n])=>{const r={f:"w"===e[0]?"w":"m"===e[0]?"m":"y",o:0,d:1,e:n?1:void 0};return null!=t&&(r.z=t),r})),Q(se(V("yesterday","today","tomorrow"),G(ie(Ae,V("at"),Ae),Te),lt,Ae,W(at)),(e=>{const t={f:"d",o:"yesterday"===e[0]?-1:"today"===e[0]?0:1,t:e[2]};return null!=e[4]&&(t.t[4]=e[4]),t})),Q(se(V("yesterday","today","tomorrow","now"),W(at),ct),(([e,t,n])=>{const r="now"===e?{f:"n",o:0}:{f:"d",o:"yesterday"===e?-1:"today"===e?0:1,e:n?1:void 0};return null!=t&&(r.z=t),r})),Q(se(V("in"),Te,st),(e=>"number"==typeof e[2]||De(e[2])?{f:"n",o:Xe(e[2])}:{f:"n",o:e[2].d})),Q(se(st,Te,G("relative time anchor",V("ago"),se(V("from"),Te,V("now"))),W(at)),(([e,,t,n])=>{let r;return r="number"==typeof e||De(e)?{f:"n",o:Xe(e)*("ago"===t?-1:1)}:{f:"n",o:e.d,d:"ago"===t?-1:void 0},null!=n&&(r.z=n),r})));function pt(e,t,n){return null==n||(e[t]=n),e}const dt=Q(se(R(4,ce),W(se(R(1,"-/"),_(ce),W(se(R(1,"-/"),_(ce))))),W(se(G(ie(Te,V("at"),Te),V("t"),Te),lt)),W(at),ct),(e=>{const t=e[0],n=e[1]&&e[1][1],r=n&&e[1][2]&&e[1][2][1],o=e[2]&&e[2][1],i=e[3],s=e[4]?1:void 0;if(n){if(r){if(o){const e={f:[+t,+n-1,+r],e:s};for(let t=0;t<o.length;t++)null!=o[t]&&(e.f[t+3]=o[t]);return null!=i&&(e.f[7]=i),e}return{f:pt([+t,+n-1,+r],7,i),e:s}}return{f:pt([+t,+n-1],7,i),e:s}}return{f:pt([+t],7,i),e:s}})),gt=ie(Z("#"),G("date",dt,ft,st),Z("#"),{primary:!0,name:"date"}),ht=Q(se(Z("@["),Ae,Zt(),Ae,Z("]")),(([,,e])=>({v:e,s:1})),{name:"typelit",primary:!0}),yt=$(Q(se(W(Z("#")),G("date",dt,ft,st),W(Z("#"))),(([,e])=>e)),{trim:!0,consumeAll:!0,undefinedOnError:!0}),mt=G({primary:!0,name:"string"},ie(Z("$$$"),Ze,Z("$$$")),Q(se(Z(":"),I(Ce,!0)),(e=>({v:e[1]}))),Q(ie(Z('"""'),te(G("string-part",I('\\"'),ye,me,$e,le(Z('"'),Z('""')))),Z('"""')),(e=>({v:"".concat(...e)}))),Q(ie(Z('"'),te(G("string-part",I('\\"'),ye,me,$e)),Z('"')),(e=>({v:"".concat(...e)}))),Q(ie(Z("'''"),te(G("string-part",Q(I("'\\${",!0),(e=>({v:e}))),Q(Z("\\$","$$"),(()=>({v:"$"}))),ie(Z("${","{"),Re,Z("}"),{primary:!0,name:"string-interpolation"}),Q(Z("$","{"),(e=>({v:e}))),Q(me,(e=>({v:e}))),Q($e,(e=>({v:e}))),Q(ye,(e=>({v:e}))),Q(le(Z("'"),Z("''")),(e=>({v:e}))))),Z("'''")),it),Q(ie(Z("'"),te(G("string-part",Q(I("'\\${",!0),(e=>({v:e}))),Q(Z("\\$","$$"),(()=>({v:"$"}))),ie(Z("${","{"),Re,Z("}"),{primary:!0,name:"string-interpolation"}),Q(Z("$","{"),(e=>({v:e}))),Q(me,(e=>({v:e}))),Q($e,(e=>({v:e}))),Q(ye,(e=>({v:e}))))),Z("'")),it),Q(ie(Z("```"),te(G("string-part",Q(I("`\\${",!0),(e=>({v:e}))),Q(Z("\\$","$$"),(()=>({v:"$"}))),ie(Z("${"),Re,Z("}"),{primary:!0,name:"string-interpolation"}),Q(Z("$","{"),(e=>({v:e}))),Q(me,(e=>({v:e}))),Q($e,(e=>({v:e}))),Q(ye,(e=>({v:e}))),Q(le(Z("`"),Z("``")),(e=>({v:e}))))),Z("```")),it),Q(ie(Z("`"),te(G("string-part",Q(I("`\\${",!0),(e=>({v:e}))),Q(Z("\\$","$$"),(()=>({v:"$"}))),ie(Z("${"),Re,Z("}"),{primary:!0,name:"string-interpolation"}),Q(Z("$","{"),(e=>({v:e}))),Q(me,(e=>({v:e}))),Q($e,(e=>({v:e}))),Q(ye,(e=>({v:e}))))),Z("`")),it)),$t=Q(G("literal",Q(he,(e=>e),{primary:!0,name:"number"}),qe,gt),(e=>e instanceof Date||null==e||"object"!=typeof e?{v:e}:e)),vt=Q(ie(ae(Z("("),Ae),se(He,Ae,Ee),ae(Ae,Z(")"))),(([e,,t])=>{const n={op:e};return t[0]&&t[0].length&&(n.args=t[0]),t[1]&&(n.opts=t[1]),n}),{primary:!0,name:"s-expression"});function bt(e){return ie(se(Z("("),Ae),e,se(Ae,Z(")")))}const xt={},wt={},At={},jt=_("abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789"),kt=Q(se(ee(jt,"op"),bt(Ee)),(([e,t])=>{const n={op:e};return t[0]&&t[0].length&&(n.args=t[0]),t[1]&&(n.opts=t[1]),n}),{primary:!0,name:"call"}),Ot=function(e){return Q(se(e,te(se(Z("#"),Ue,W(G(Q(se(Z(","),oe(Re,Z(","),"allow")),(([,e])=>[e,void 0])),bt(Ee)))),{primary:!0,name:"format-op"})),(([e,t])=>t&&t.length?t.reduce(((e,t)=>t[2]?{op:"fmt",args:[e,{v:t[1]},...t[2][0]||[]],opts:t[2][1]}:{op:"fmt",args:[e,{v:t[1]}]}),e):e),"fmt-op")}(function(e){return Q(se(e,te(G("keypath",Ge,Ke))),(([e,t])=>t.length?{op:"get",args:[e,{v:{k:t}}]}:e),"postfix-path-op")}(G("operand",bt(Ie),bt(wt),bt(At),K(bt(xt),(e=>"op"in e||"expected bracketed op")),vt,Je))),Mt=Q(se(Z("not ","+","-"),Ot),(([e,t])=>({op:"not "===e?"not":e,args:[t]})),"unary op");function Yt(e,[,t,,n]){return{op:t,args:[e,n]}}const Dt=Q(se(Ot,te(G(se(w,ee(Z("**"),"exp op"),w,Ot),se(Te,ee(Z("**"),"exp op"),Te,Ot)))),(([e,t])=>t.length?function(e,t){if(1===t.length)return{op:t[0][1],args:[e,t[0][3]]};const n=t.pop();let r=t[t.length-1][1];const o={op:n[1],args:[t.pop()[3],n[3]]},i=t.reverse().reduce(((e,t)=>{const n={op:r,args:[t[3],e]};return r=t[1],n}),o);return{op:r,args:[e,i]}}(e,t):e),"exp-op"),Xt=Q(se(Dt,te(G(se(w,ee(Z("*","/%","/","%"),"muldiv-op"),w,Dt),se(Te,ee(Z("*","/%","/","%"),"muldiv-op"),Te,Dt)))),(([e,t])=>t.length?t.reduce(Yt,e):e),"muldiv-op"),zt=Q(se(Xt,te(G(se(w,ee(Z("+","-"),"addsub-op"),w,Xt),se(Te,ee(Z("+","-"),"addsub-op"),Te,Xt)))),(([e,t])=>t.length?t.reduce(Yt,e):e),"addsub-op"),Ct=Q(se(zt,te(G(se(w,ee(Z(">=",">","<=","<"),"cmp-op"),w,zt),se(Te,ee(Z(">=",">","<=","<","gte","gt","lte","lt","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain"),"cmp-op"),Te,zt)))),(([e,t])=>t.length?t.reduce(Yt,e):e),"cmp-op"),Ft=Q(se(Ct,te(G(se(w,ee(Z("===","==","!==","!="),"eq-op"),w,Ct),se(Te,ee(Z("===","==","!==","!=","is-not","is","strict-is-not","strict-is","deep-is-not","deep-is"),"eq-op"),Te,Ct)))),(([e,t])=>t.length?t.reduce(Yt,e):e),"eq-op"),St=Q(se(Ft,te(G(se(w,ee(Z("&&"),"and-op"),w,Ft),se(Te,ee(Z("and","&&"),"and-op"),Te,Ft)))),(([e,t])=>t.length?t.reduce(Yt,e):e),"and-op"),Nt=Q(se(St,te(G(se(w,ee(Z("||","??"),"or-op"),w,St),se(Te,ee(Z("or","||","??"),"or-op"),Te,St)))),(([e,t])=>t.length?t.reduce(Yt,e):e),"or-op");function Tt(e){if(!e.args||!e.args.length)return!1;let t=!1;for(let n=0;n<e.args.length;n++){const r=e.args[n];"r"in r&&("_"===r.r||"object"==typeof r.r&&"_"===r.r.k[0])?(r.r={k:["case"].concat((r.r.k||[]).slice(1)),p:"@"},t=!0):"r"in r&&"object"==typeof r.r&&"@"===r.r.p&&"case"===r.r.k[0]?t=!0:"op"in r&&(t=t||Tt(r))}return t}xt.parser=Q(Nt,(e=>e),{primary:!0,name:"binary-op"}),wt.parser=G({primary:!0,name:"conditional"},Q(se(Z("if"),Te,Re,Te,Pe,te(se(Ae,Z("else if","elseif","elsif","elif"),Te,Re,Te,Pe)),W(se(Ae,Z("else"),Te,Pe))),(([,,e,,t,n,r])=>{const o={op:"if",args:[e,t]};for(const[,,,e,,t]of n)o.args.push(e,t);return r&&o.args.push(r[3]),o}),"if-block"),Q(se(Z("if"),Te,Re,Te,Z("then"),Te,Re,te(se(Te,B(Z("end","fi")),Z("else if","elseif","elsif","elif"),Te,Re,Te,Z("then"),Te,Re)),W(se(Te,Z("else"),Te,Re)),W(se(Te,Z("end","fi")))),(([,,e,,,,t,n,r])=>{const o={op:"if",args:[e,t]};for(const[,,,,e,,,,t]of n)o.args.push(e,t);return r&&o.args.push(r[3]),o}),"if"),Q(se(Z("unless"),Te,Re,Te,Z("then"),Te,Re,W(se(Te,Z("else"),Te,Re)),W(se(Te,Z("end")))),(([,,e,,,,t,n])=>{const r={op:"unless",args:[e,t]};return n&&r.args.push(n[3]),r})));const qt=G(Q(se(Te,B(Z("end","esac")),Z("when"),Te,Re,Te,Z("then"),Te,Re),(([,,,,e,,,,t])=>[e,t]),"when-branch"),Q(se(Te,B(Z("end","esac")),Z("else"),Te,Re),(([,,,,e])=>[void 0,e]),"else-branch"),Q(se(Te,B(Z("end","esac")),Z("when"),Te,Re,Te,Pe),(([,,,,e,,t])=>[e,t]),"when-block"));At.parser=G(Q(se(Z("case"),Te,Re,te(qt),W(se(Te,Z("end","esac")))),(([,,e,t])=>{const n={op:"case",args:[e]};for(let e=0;e<t.length;e++)if(void 0===t[e][0])n.args.push(t[e][1]);else{let r=t[e][0];"op"in r&&Tt(r),n.args.push(r),n.args.push(t[e][1])}return n}),"case"));const Ut=G("expression",wt,At,xt),Ht=Q(se(G("key",mt,Q(Ue,(e=>({v:e})))),Ae,Z(":"),Ae,Re),(e=>[e[0],e[4]]),"pair");function Et(e){return e.filter((e=>!("v"in e[0]&&"v"in e[1]))).length?{op:"object",args:e.reduce(((e,t)=>(e.push(t[0],t[1]),e)),[])}:{v:e.reduce(((e,t)=>(e[t[0].v]=t[1].v,e)),{})}}Le.parser=Q(ie(ae(Z("["),Ae),re(Re,_(" \r\n\t,"),"allow"),ae(Ae,Z("]"))),(e=>e.filter((e=>!("v"in e))).length?{op:"array",args:e}:{v:e.map((e=>e.v))}),{primary:!0,name:"array"}),_e.parser=Q(ie(ae(Z("{"),Ae),re(Ht,_(" \r\n\t,"),"allow"),ae(Ae,Z("}"))),Et,{primary:!0,name:"object"}),Pe.parser=Q(ie(ae(Z("{"),Ae),oe(Re,_(" \r\n\t;"),"allow"),ae(Ae,Z("}"))),(e=>({op:"block",args:e})),{primary:!0,name:"block"}),Re.parser=b(Ne("c",Ut));const Lt=Q(se(Ue,Z(":"),Ae,Re),(([e,,,t])=>[{v:e},t]),"named-arg");Ie.parser=Q(se(W(ie(ae(Z("|"),Ae),oe(jt,_(" \r\n\t,"),"allow"),se(Z("|"),Ae))),Z("=>","=\\"),Ae,Re),(([e,,,t])=>e?{a:t,n:e}:{a:t}),{primary:!0,name:"application"}),Ee.parser=Q(re(G("argument",Lt,Re),_(" \r\n\t,"),"allow"),(e=>{const[t,n]=e.reduce(((e,t)=>(Array.isArray(t)?e[1].push(t):e[0].push(t),e)),[[],[]]);return n.length?[t,Et(n)]:[t,void 0]}));const Pt=Q(se(Z("let"),Te,ee(et,{name:"reference",primary:!0}),Ae,Z("="),Ae,Re),(([,,e,,,,t])=>({op:"let",args:[{v:e},t]})),{primary:!0,name:"let"}),_t=Q(se(Z("set"),Te,ee(Qe,{name:"reference",primary:!0}),Ae,Z("="),Ae,Re),(([,,e,,,,t])=>({op:"set",args:[{v:e},t]})),{primary:!0,name:"set"});Je.parser=G("expression",Le,_e,$t,ht,mt,Ie,Mt,kt,Pt,_t,ot,Pe);const Rt=$(Q(oe(Re,_(" \r\n\t;"),"allow"),(e=>1===e.length?e[0]:{op:"block",args:e,opts:{v:{implicit:1}}}),"expression-sequence"),{trim:!0}),Jt=$(Re,{trim:!0});Rt.namespace="default";const It=Rt;function Zt(){const e={},t=W(se(Ae,oe(Q(se(ee(Z("?"),{name:"condition",primary:!0}),Ae,Ie),(([,,e])=>e)),Te,"disallow"))),n=Q(se(Z("any[]","string[]","number[]","boolean[]","date[]","any","string","number","boolean","date"),B(I(Fe))),(([e])=>({type:"any[]"===e?"array":e})),{name:"type",primary:!0}),r=Ne("c",Q(se(Z("type"),Ae,ee(Ue,{name:"type",primary:!0}),Ae,Z("="),Ae,e),(([,,e,,,,t])=>({name:e,type:t})))),o=Q(oe(r,_(" \t\n;"),"allow"),(e=>e.reduce(((e,t)=>(t.type.desc=t.c,e[t.name]=t.type,e)),{}))),i=Q(se(Ue,W(Z("[]"))),(([e,t])=>({type:t?"array":"any",ref:e})),{name:"type",primary:!0}),s=Q(se(ee(Ue,{name:"key",primary:!0}),W(Z("?")),Ae,Z(":"),Ae,e),(([e,t,,,,n])=>{const r=n;return r.name=e,t||(r.required=!0),r})),a=G({name:"literal",primary:!0},Q(G(ve,he),(e=>({type:"literal",literal:e}))),Q(Z("true","false","null","undefined"),(e=>({type:"literal",literal:"true"===e||"false"!==e&&("null"===e?null:void 0)})))),l=Q(se(Z("..."),Ae,Z(":"),Ae,e),(([,,,,e])=>Object.assign({name:"..."},e))),u=Q(se(Z("{"),Ae,re(Ne("desc",G(s,l)),_(" \t\n,;"),"allow"),Ae,Z("}"),W(Z("[]"))),(([,,e,,,t],n)=>{const r=e.filter((e=>"..."===e.name));if(!(r.length>1)){const n=r[0],o={type:t?"object[]":"object"};return(e=e.filter((e=>"..."!==e.name))).length&&(o.fields=e),n&&(delete n.name,o.rest=n),o}n("only one object rest can be specified")})),c=Q(se(Z("["),Ae,re(e,_(" \t\r\n,"),"allow"),Ae,Z("]"),W(Z("[]"))),(([,,e,,,t])=>({type:t?"tuple[]":"tuple",types:e}))),f={},p={};f.parser=Q(oe(se(G(n,u,c,a,p,i),t),se(Ae,Z("|"),Ae),"disallow"),(e=>{const t=e.map((([e,t])=>(t&&t[1]&&t[1].length&&(e.checks=t[1]),e)));return 1===t.length?t[0]:{type:"union",types:t}})),p.parser=G(Q(se(Z("Array<"),Ae,f,Ae,Z(">")),(([,,e],t)=>"union"===e.type?{type:"union[]",types:e.types}:"literal"!==e.type?"array"===e.type||~e.type.indexOf("[]")?{type:"union[]",types:[e]}:"any"===e.type?{type:"array"}:(e.type+="[]",e):void t("literal types cannot be array types"))),Q(se(Z("("),Ae,f,Ae,Z(")")),(([,,e])=>e)),f),e.parser=Q(se(p,t),(([e,t])=>(t&&t[1]&&t[1].length&&(e.checks=t[1]),e)));const d=Q(se(W(o),Ae,e),(([e,,t])=>(e&&(t.defs=e),t)));return d}const Vt=G(Q(Z("\\{{"),(()=>"{{")),Q(se(Z("\\"),R(1)),(([,e])=>e))),Wt=Q(ne(G(I("\\{",!0),Vt,le(Z("{"),Z("{")))),(e=>({v:e.join("")})),"text"),Bt=Q(ne(G(I("\\{$"),Vt,le(Z("$"),Z("$$")),le(Z("{"),Z("{")))),(e=>({v:e.join("")})),"text");function Gt(e){return Q(se(Z("{{"),Ae,Z(...e),Te,Re,Ae,Z("}}")),(e=>[e[2],e[4]]),"tag")}const Kt=ee(ae(se(Z("{{/"),J("}"),Z("}}"))),"tag end"),Qt={};function en(e,t){return t?Q(Gt(e),(([e,t])=>({name:e,value:t}))):Q(se(Z("{{"),Ae,Z(...e),Ae,Z("}}")),(([,,e])=>({name:e})),"tag")}function tn(e){return Q(e,(e=>e.length<1?[{v:""}]:e))}const nn=en(["else"]),rn=en(["else if","elseif","elsif","elif"],!0),on=Q(se(Gt(["each"]),tn(te(G(rn,nn,Qt))),Kt),(([e,t])=>({op:"each",args:[e[1]].concat(pn(dn(t)))})),{primary:!0,name:"each-block"}),sn=Q(se(Gt(["if"]),tn(te(G(rn,nn,Qt))),Kt),(([e,t])=>({op:"if",args:[e[1]].concat(dn(t))})),{primary:!0,name:"if-block"}),an=Q(se(Gt(["with"]),tn(te(G(nn,Qt))),Kt),(([e,t])=>({op:"with",args:[e[1]].concat(pn(dn(t)))})),{primary:!0,name:"with-block"}),ln=Q(se(Gt(["unless"]),tn(te(Qt)),Kt),(([e,t])=>({op:"unless",args:[e[1]].concat(gn(t))})),{primary:!0,name:"unless-block"}),un=Q(se((cn=["case"],Q(se(Z("{{"),Ae,Z(...cn),Te,Re,Te,Z("when"),Te,Re,Z("}}")),(e=>[e[2],e[4],e[8]]),"tag")),tn(te(G(en(["when"],!0),nn,Qt))),Kt),(([e,t])=>{const n={op:"case",args:e.slice(1).concat(dn(t))};for(let e=1;e<n.args.length;e+=2){const t=n.args[e];"object"==typeof t&&"op"in t&&Tt(t)}return n}),{primary:!0,name:"case-block"});var cn;const fn=Q(se(Z("{{"),Ae,Re,Ae,Z("}}")),(([,,e])=>({op:"string",args:[e]})),{primary:!0,name:"interpolator"});function pn(e){return e.length&&(e[0]={a:e[0]}),e}function dn(e){const t=[];let n=[],r=!1;for(let o=0;o<e.length;o++){const i=e[o];"name"in i?(r=!0,n.length?t.push(gn(n)):t.push({v:""}),i.value&&t.push(i.value),n=[]):n.push(i)}return n.length?t.push(gn(n)):r&&t.push({v:""}),t.length%2&&t.push({v:""}),t}function gn(e){return 1===e.length?e[0]:{op:"cat",args:e,meta:"$"}}Qt.parser=G({primary:!0,name:"content"},Wt,on,sn,an,un,ln,fn);const hn=$(G(Q(ne(Qt),(e=>gn(e))),Q(Ae,(()=>({v:""})))),{trim:!0});hn.namespace="template";const yn=hn;function mn(e){if(Array.isArray(e))return{value:e};if(e&&"object"==typeof e){for(const t in e)if("schema"!==t&&"value"!==t)return{value:e};return e}return{value:e}}function $n(e,t){if(!t)return e.value;const n="string"==typeof t?tt(t):t;if(!("error"in n)&&"k"in n){let t=n.k;const r=n.p;let o=0,i=e,s=e.value;for(let e=0;e<n.u;e++)i&&(i=i.parent);if(s=i?i.value:void 0,r){if("!"===r)s=e.root.parameters;else if("~"===r)s=e.root.value;else if("*"===r)s=e.root.sources[t[o++]],s&&o<t.length+1&&"value"!==t[o]&&(s=s.value);else if("@"===r){const n=t[o++];if("locals"===n||"specials"===n){const e="locals"===n?n:"special";for(;i&&!i[e];)i=i.parent;i&&(s=i[e])}else if("local"===n||"special"===n){const e="local"===n?"locals":n;s=i[e]||(i[e]={})}else if("parameters"===n||"sources"===n)s=e.root[n];else if("value"!==n){for(;i&&(!i.special||!(n in i.special));)i=i.parent;s=i&&i.special[n],s&&"source"===n&&void 0!==t[o]&&"value"!==t[o]&&s.value&&(s=s.value),s||"date"!==n||(s=e.root.special.date=new Date)}}}else{const e=t[0];if("_"===e)i.special&&i.special.pipe&&(s=i.special.pipe),o++;else if("string"==typeof e){let t=i;for(;t&&(!t.locals||!(e in t.locals));)t=t.parent;t&&e in t.locals&&(s=t.locals[e],o++)}}for(let n=o;n<t.length;n++){const r=t[n],o="object"!=typeof r?r:jn(e,r);if(s=Array.isArray(s)&&"number"==typeof o&&o<0?s[s.length+o]:s&&s[o],null==s)return}return s}}function vn(e,t,n,r){if(!t)return;const o="string"==typeof t?r?nt(t):tt(t):t;if(!("error"in o)&&"k"in o){let t=o.k;const i=o.p;let s=e,a=e.value;for(let e=0;e<o.u;e++)s&&(s=s.parent);a=s?s.value:void 0;const l=t.map((t=>"object"!=typeof t?t:jn(e,t)));if(r)a=e.locals||(e.locals={});else if(i){if("~"!==i)return;a=e.root.value}if(!r){const e=l[0];for(;s&&(!s.locals||!(e in s.locals));)s=s.parent;s&&(a=s.locals)}const u=l.length-1;for(let e=0;e<u;e++){if("object"!=typeof a&&"function"!=typeof a||!a)return;const t=l[e],n=l[e+1];t in a&&null!=a[t]||(a[t]="number"==typeof n?[]:{}),a=a[t]}if(a){const e=a[l[u]];return a[l[u]]=n,e}}}function bn(e,t){let n,r;return!t&&qn(e)?(n=new En,r=e):Hn(e)?(n=e,!Array.isArray(t)&&(r=t)):e&&"object"==typeof e&&"context"in e&&Hn(e.context)?(n=e.context,!Array.isArray(t)&&(r=t)):qn(t)?(n=new En(e),r=t):(n=new En,r=e),An(n,r)}function xn(e,t){let n,r;return"string"==typeof e?(n=new En,r=e):Hn(e)?(n=e,r=t||""):e&&"object"==typeof e&&"context"in e&&Hn(e.context)?(n=e.context,r=t||""):e&&"string"!=typeof e?(n=new En(e),r=t||""):(n=new En,r=e),n=Ln(n,{parser:yn}),An(n,r)}function wn(e,t,n,r){if(Tn(t)){const o=Ln(e,{value:n[0],special:r,fork:!e.locals});let i;if("n"in t){const e=t.n.reduce(((e,t,r)=>(e[t]=n[r],e)),{});o.locals=e}return i=jn(o,t.a),i}{const o=An(Ln(e,{value:n[0],special:r,fork:!e.locals}),t);return Tn(o)?wn(e,o,n,r):o}}function An(e,t){if("string"==typeof t){const n=e.parser||It,r=n.namespace||"unknown",o=e.root.exprs[r]||(e.root.exprs[r]={});t=o[t]||(o[t]=n(t))}return"object"!=typeof t&&(t={v:t}),jn(e,t)}function jn(e,t){return t?"r"in t?$n(e,t.r):"v"in t?t.v:"op"in t?Fn(e,t):Tn(t)||In(t)||Wn(t)?t:void 0:t}Ze.parser=Q(ne(G({name:"inline-template"},Bt,on,sn,an,un,ln,fn)),(e=>gn(e)));const kn={};function On(...e){for(const t of e)for(const e of t.names)kn[e]=t}function Mn(e){return kn[e]}const Yn=(e,t,n)=>wn(e,t,[n]);function Dn(e,t,n,r){let o;if(Array.isArray(n))o=n;else if(Tn(n))o=[n];else if("object"==typeof n&&n&&"by"in n)o=[n];else{const t=An(e,n);Array.isArray(t)?o=t:"string"==typeof t?o=[{v:t}]:"string"==typeof n&&(o=[n])}if(o){let e;for(let t=0;t<o.length;t++){e=o[t];const n="object"==typeof(i=e)&&"v"in i?e.v:e;"string"==typeof n&&("-"===n[0]?o[t]={by:n.slice(1),desc:!0}:o[t]={by:"+"===n[0]?n.slice(1):n,desc:!1})}}var i;if(r=r||Yn,o&&o.length){const n=o.map((t=>{if("object"==typeof t&&"by"in t){if("desc"in t)return"boolean"==typeof t.desc?t.desc:An(e,t.desc);if("dir"in t){const n="string"==typeof t.dir?t.dir.toLowerCase():t.dir,r="asc"===n||"desc"===n?n:An(e,t.dir);if("desc"===("string"==typeof r?r.toLowerCase():r))return!0}}return!1}));t.sort(((t,i)=>{for(let s=0;s<o.length;s++){const a=o[s],l=n[s],u="string"==typeof a?a:a&&a.by?a.by:a,c=r(e,u,t),f=r(e,u,i),p=null==c&&null!=f?-1:null!=c&&null==f?1:c<f==f<c?0:c<f?-1:c>f?1:0;if(p)return(l?-1:1)*p}return 0}))}return t}function Xn(e,t,n,r,o){const i=Array.isArray(e)?{value:e}:e;if(!i||!Array.isArray(i.value))return i;let s;s=o?Hn(o)?Ln(o,{special:{source:i.value}}):new En(o):new En(i.value,{special:{source:i}});const a=t?[]:i.value.slice();if(t){let e="string"==typeof t?It(t):t;"m"in e&&(e={v:!0}),i.value.forEach(((t,n)=>{wn(Ln(s,{value:t,special:{value:t,index:n}}),e,[t,n])&&a.push(t)}))}return n&&Dn(s,a,n),r&&!Array.isArray(r)&&(r=[r]),Array.isArray(r)&&r.length?{value:{schema:i.schema,grouped:r.length,level:0,value:zn(a,r,s,1),all:a}}:Array.isArray(e)?a:{schema:i.schema,value:a}}function zn(e,t,n,r=0){const o={},i=[],s=[];for(const r of e){const e=Tn(t[0])?`${wn(n,t[0],[r])}`:`${An(Ln(n,{value:r}),t[0])}`;o[e]||(s.push(e),o[e]=[]),o[e].push(r)}for(const e of s)i.push({group:e,grouped:t.length-1,value:t.length>1?zn(o[e],t.slice(1),n,r+1):o[e],all:o[e],level:r});return i}function Cn(e){const t=function(e){if("object"==typeof e.r)return e.r;const t=tt(e.r);return"k"in t?t:{k:[]}}(e);return"_"===t.k[0]||"@"===t.p&&"pipe"===t.k[0]}function Fn(e,t){const n=kn[t.op];if(!n){const n=$n(e,t.op)||$n(e.root,t.op);if(Tn(n))return wn(e,n,(t.args||[]).map((t=>An(e,t))));if("pipe"===t.op){if(!t.args||!t.args.length)return!0;let n=An(e,t.args[0]);for(let r=1;r<t.args.length;r++){let o=t.args[r];!Nn(o)||o.args&&o.args.find((e=>Sn(e)&&Cn(e)))||(o=Object.assign({},o,{args:[{r:{k:["pipe"],p:"@"}}].concat(o.args||[])})),n=Tn(o)?wn(e,o,[n]):An(Ln(e,{special:{pipe:n}}),o)}return n}return!0}let r;if("checked"===n.type){r=[];const o=t.args||[],i=n.extend?Ln(e,{}):e,s=t.opts?An(i,t.opts):void 0;for(let e=0;e<o.length;e++){const a=o[e],l=An(i,a),u=n.checkArg(t.op,e,o.length-1,l,s,i,a);if("continue"===u)r.push(l);else if("skip"in u)e+=u.skip,"value"in u&&r.push(u.value);else if("result"in u)return u.result}return n.apply(t.op,r,s,i)}if("value"===n.type)return r=(t.args||[]).map((t=>An(e,t))),n.apply(t.op,r,t.opts?An(e,t.opts):void 0,e);{let r;const o=n.extend?Ln(e,{}):e,i=(t.args||[]).slice(),s=t.opts?An(o,t.opts):void 0;let a;if(!n.value&&(a=An(o,i[0]),Array.isArray(a)?(i.shift(),r=a):"object"==typeof a&&"value"in a&&Array.isArray(a.value)&&(i.shift(),r=a.value),!r)){const e=jn(o,{r:"@source"});r=Array.isArray(e)?e:"object"==typeof e&&"value"in e&&Array.isArray(e.value)?e.value:[]}return n.apply(t.op,Array.isArray(r)?r:[],i,s,o)}}function Sn(e){return"object"==typeof e&&"r"in e}function Nn(e){return"object"==typeof e&&"string"==typeof e.op}function Tn(e){if("object"!=typeof e||!("a"in e)||"object"!=typeof e.a)return!1;const t=Object.keys(e).length;return 1===t||2===t&&"n"in e}function qn(e){return"string"==typeof e||Un(e)}function Un(e){return"object"==typeof e&&e&&("r"in e&&"string"==typeof e.r||"op"in e&&"string"==typeof e.op||"v"in e||Tn(e))}function Hn(e){return"object"==typeof e&&"string"==typeof e.path&&"object"==typeof e.root&&"value"in e&&("object"==typeof e.parent||e.root===e)}class En{constructor(e={},t){this.root=this,this.parameters={},this.sources={},this.special={},this.exprs={},this.path="",this.value=e,t&&(Object.assign(this.parameters,t.parameters),Object.assign(this.special,t.special),t.parser&&(this.parser=t.parser),t.log&&"function"==typeof t.log&&(this.log=t.log))}log(e){console.log(...e)}}function Ln(e,t){return{parent:t.fork?e.parent||e.root:e,root:e.root,path:t.path||"",value:"value"in t?t.value:e.value,special:t.fork?Object.assign({},e.special,{pipe:void 0},t.special):t.special||{},parser:t.parser,locals:t.locals}}const Pn={},_n={};function Rn(e,t,n={}){Array.isArray(e)?e.forEach((e=>Pn[e]={apply:t,defaults:n})):Pn[e]={apply:t,defaults:n}}function Jn(e){if(e instanceof Date)return[e,e];let t=new Date,n="d"in e&&e.d?new Date:void 0;t.setUTCFullYear(t.getFullYear(),t.getMonth(),t.getDate()),t.setUTCHours(0,0,0,0);let r="z"in e&&null!=e.z?e.z:null;if("n"===e.f)t="number"==typeof e.o?new Date(+new Date+e.o):Bn(new Date,{d:e.o},"d"in e?e.d:1),n=t,r=void 0;else if("d"===e.f){if(t.setUTCDate(t.getUTCDate()+e.o),n||(n=new Date(t)),"t"in e){const o=e.t;t.setUTCHours(o[0],o[1]||0,o[2]||0,o[3]||0),n.setUTCHours(o[0],null==o[1]?59:o[1],null==o[2]?59:o[2],null==o[3]?999:o[3]),null!=o[4]&&(r=o[4])}}else if("w"===e.f)t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+(-1===e.o?7:1===e.o?-7:0))),n||(n=new Date(t),n.setDate(t.getUTCDate()+6)),"z"in e&&null!=e.z&&(r=e.z);else if("m"===e.f)t.setUTCDate(1),t.setUTCMonth(t.getUTCMonth()+e.o),n||(n=new Date(t),n.setUTCMonth(t.getUTCMonth()+1),n.setUTCDate(0));else if("y"===e.f)t.setUTCDate(1),t.setUTCMonth(0),t.setUTCDate(1),n||(n=new Date(t),n.setUTCFullYear(t.getUTCFullYear()+1),n.setUTCDate(0));else if(Array.isArray(e.f)){const o=e.f.slice();t=new Date(Date.UTC(o[0],o[1]||0,o[2]||1,o[3]||0,o[4]||0,o[5]||0,o[6]||0));for(let e=1;e<7;e++)if(null==o[e]){o[e-1]++;break}null!=o[6]&&o[6]++,n=new Date(Date.UTC(o[0],o[1]||0,o[2]||1,o[3]||0,o[4]||0,o[5]||0,o[6]||0)),n.setUTCMilliseconds(n.getUTCMilliseconds()-1),null!=o[7]&&(r=o[7])}if("d"!==e.f&&"w"!==e.f&&"m"!==e.f&&"y"!==e.f||n.setUTCHours(23,59,59,999),void 0!==r)if(null!=r)t.setUTCMinutes(t.getUTCMinutes()-r),t!==n&&n.setUTCMinutes(n.getUTCMinutes()-r);else{const e=t.getTimezoneOffset();t.setUTCMinutes(t.getUTCMinutes()+e),t!==n&&n.setUTCMinutes(n.getUTCMinutes()+e)}return[t,n]}function In(e){return e&&"object"==typeof e&&("f"in e&&(Array.isArray(e.f)||"o"in e)||e instanceof Date)}function Zn(e){const t=Jn(e);return"e"in e&&null!=e.e?t[1]:t[0]}function Vn(e){if(!e)return;if((t=e)&&"object"==typeof t&&"f"in t&&Array.isArray(t.f))return e;var t;const n=Zn(e),r=n.getTimezoneOffset(),o="z"in e&&null!=e.z?e.z:"f"in e&&"d"===e.f&&"t"in e&&null!=e.t[4]?e.t[4]:null;return e instanceof Date&&null!=o&&n.setMinutes(n.getMinutes()-(r+o)),{f:[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds(),null!=o?o:-r]}}function Wn(e){return"number"==typeof e||"object"==typeof e&&Array.isArray(e.d)||De(e)}function Bn(e,t,n){if("number"==typeof t)return new Date(+e+t*n);if(De(t))return new Date(+e+t.ms*n);{let r=new Date(e);if(t.d[0]&&r.setFullYear(r.getFullYear()+t.d[0]*n),t.d[1]){const e=r.getDate();r.setDate(1),r.setMonth(r.getMonth()+t.d[1]*n);const o=r.getMonth();r.setDate(e),o!==r.getMonth()&&r.setDate(0)}return t.d[2]&&r.setDate(r.getDate()+t.d[2]*n),t.d[3]&&r.setHours(r.getHours()+t.d[3]*n),t.d[4]&&r.setMinutes(r.getMinutes()+t.d[4]*n),t.d[5]&&r.setSeconds(r.getSeconds()+t.d[5]*n),t.d[6]&&r.setMilliseconds(r.getMilliseconds()+t.d[6]*n),r}}function Gn(e,t,n){e.styles[t]||(e.styles[t]=n)}function Kn(e,t,n="Widget overflow error"){return Gn(e,"error",".error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }"),{output:`<div class="error" style="top: ${t.y}rem;">${n}</div>`,height:2}}function Qn(e){return e&&"object"==typeof e&&qn(e.x)}function er(e,t){return Qn(e)?e.x?bn(t,e.x):void 0:e}function tr(e,t){return{parent:e,report:e.report,context:Ln(e.context,t),styles:e.styles,styleMap:e.styleMap,commit:t.commit}}const nr=/[><&]/g,rr={"<":"&lt;",">":"&gt;","&":"&amp;"};function or(e){return(""+e).replace(nr,(e=>rr[e]||""))}const ir={};function sr(e,t,n){ir[e]="function"==typeof t?{render:t}:t,n&&Object.assign(ir[e],n)}const ar=7.4,lr=6.7,ur=7.85,cr=5.9;let fr=function(e,t,n,r){const o=r&&er(r.family,n)||"sans",i=r&&er(r.size,n)||.83,s=r&&er(r.line,n)||i,a=!r||!("break-word"in r)||r["break-word"],l=(r&&er(r.metric,n)||("mono"===o||/fixed|mono/i.test(o)?ur:"narrow"===o||/narrow|condensed/i.test(o)?cr:"sans"===o||/sans|arial|helvetica/i.test(o)?ar:lr))*i/16;return e.split(/\r?\n/g).reduce(((e,n)=>{const[r,o]=n.split(/\s|-/g).reduce(((e,n)=>{const r=(n.length+1)*l;return e[0]+r>t?0===e[0]||r>t?(a&&(e[0]=(r-(t-e[0]))%t,r>t&&(e[1]+=Math.floor(r/t))),e[1]++):(e[0]=r,e[1]++):e[0]+=r,e}),[0,0]);return e+(o+(r>0?1:0)||1)}),0)*s};function pr(e,t,n,r){const o=ir[e.type];if(!o||e.hide&&bn(Ln(t.context,{special:{widget:e,placement:n}}),e.hide))return{output:"",height:0};!("height"in e)&&o.container&&(e.height="auto");const i=$r(e,n,t);if(n.maxY&&!isNaN(i)&&i>n.maxY)return Kn(t,n);if(null!=n.availableY&&i>n.availableY)return{output:"",continue:{offset:0},cancel:!0};let s=0;if(e.margin){const r=xr(e,t,n);s+=r[0]+r[2],null!=n.availableY&&(n.availableY-=r[0]+r[2])}if(e.border&&!i&&"expand"===e.box){const r=wr(e,t,n);s+=r[0]+r[2],null!=n.availableY&&(n.availableY-=r[0]+r[2])}const a=o.render(e,t,n,r);return"string"==typeof a?{output:a,height:i,width:yr(e,n,t)}:("number"==typeof a.height&&(a.height=+a.height.toFixed(6)),"number"==typeof a.width&&(a.width=+a.width.toFixed(6)),null!=n.availableY&&(n.availableY=+n.availableY.toFixed(6)),n.maxY&&a.height>n.maxY?Kn(t,n):isNaN(i)&&null!=n.availableY&&a.height>n.availableY?{output:"",continue:{offset:0},height:a.height||0,cancel:!0}:(a.height=a.height||0,a.height+=s,a.height=+a.height.toFixed(6),a))}const dr={};function gr(e,t){dr[e]=t}function hr(e,t,n){let r=Qn(e.width)?bn(Ln(n.context,{special:{widget:e,placement:t}}),e.width.x):e.width;const o=e.margin&&xr(e,n,t);let i=!1;return"grow"===r?r=t.availableX||t.maxX:r||0===r?"number"==typeof r||(r=+(r.percent/100*(t.maxX||51)).toFixed(4),i=!0):r=t.maxX||51,"number"!=typeof r||"contain"!==e.box&&(!i&&r!==t.availableX||"expand"===e.box)||(o?r-=o[1]+o[3]:e.font&&e.font.right&&(r-=e.font.right)),r}function yr(e,t,n){let r=hr(e,t,n);if(e.margin){const o=xr(e,n,t);r+=o[1]+o[3]}else e.font&&e.font.right&&(r+=e.font.right);return r}function mr(e,t,n,r,o){let i=1,s=Qn(e.height)?bn(Ln(n.context,{special:{widget:e,placement:t,computed:r,linesize:o}}),e.height.x):e.height;const a=e.margin&&xr(e,n,t),l=e.border&&wr(e,n,t);let u=!1;if(null==s&&o&&(s=function(e){let t=e.height||1;if(e.font&&e.font.size>t&&(t=e.font.size),"text"in e&&Array.isArray(e.text))for(let n=0;n<e.text.length;n++){const r=e.text[n];"object"==typeof r&&"font"in r&&r.font&&r.font.size>t&&(t=r.font.size)}return t}(e)),"number"==typeof s)i=s;else if(s&&"object"==typeof s&&"percent"in s&&s.percent&&t.maxY)i=+(t.maxY*(s.percent/100)).toFixed(4),u=!0;else if("grow"===s)i=t.availableY||0;else if("auto"===s||"string"==typeof s||null==s&&"container"===e.type||r&&!s)return l&&"expand"===e.box?r+l[0]+l[2]||NaN:r||NaN;return"number"!=typeof i||"contain"!==e.box&&(!u&&i!==t.availableY||"expand"===e.box)||a&&(i-=a[0]+a[2]),i}function $r(e,t,n,r,o){let i=mr(e,t,n,r,o);if("number"==typeof i&&e.margin){const r=xr(e,n,t);i+=r[0]+r[2]}return i}function vr(e){return e.reduce(((e,t)=>e>t[1]+t[3]?e:t[1]+t[3]),0)}function br(e){return e.reduce(((e,t)=>e>t[0]+t[2]?e:t[0]+t[2]),0)}function xr(e,t,n){if(e.margin){const r=Qn(e.margin)?bn(Ln(t.context,{special:{widget:e,placement:n}}),e.margin.x):e.margin;if(Array.isArray(r)){if(4===r.length)return r.map((e=>+e));if(2===r.length)return[+r[0],+r[1],+r[0],+r[1]]}else if("number"==typeof r)return[r,r,r,r]}return[0,0,0,0]}function wr(e,t,n){let r=e.border,o=[0,0,0,0];("string"==typeof r||r&&!Array.isArray(r)&&"object"==typeof r&&("v"in r||"r"in r||"op"in r))&&(r=bn(Ln(t.context,{special:{widget:e,placement:n}}),r)),"number"==typeof r?o=[0,0,r,0]:Array.isArray(r)?1===r.length?o=[r[0],r[0],r[0],r[0]]:2===r.length?o=[r[0],r[1],r[0],r[1]]:3===r.length?o=[r[0],r[1],r[2],r[1]]:r.length>=4&&(o=[r[0],r[1],r[2],r[3]]):r&&"object"==typeof r&&(o=[r.top||0,r.right||0,r.bottom||0,r.left||0]);for(let e=0;e<4;e++)o[e]=.0625*o[e];return o}function Ar(e,t,n,r,o){const i=bn(Ln(n.context,{special:{widget:t,placement:r,state:o}}),e);if(i&&!Array.isArray(i)&&"object"==typeof i)if("content"in i||"props"in i||"properties"in i)t=Object.assign({},t,i.props,i.properties,{widgets:Array.isArray(i.content)?i.content:i.content?[i.content]:t.widgets,macro:void 0});else{if("replace"in i&&i.replace&&"object"==typeof i.replace&&"type"in i.replace)return i.replace;t=Object.assign({},t,{widgets:[i],macro:void 0})}else Array.isArray(i)&&(t=Object.assign({},t,{widgets:i,macro:void 0}));return t}function jr(e,t,n){if(!t)return"";const r=e.styleMap.styles[t];if(r)return r;const o=`${n}${function(e,t){return e.styleMap.ids[t]||(e.styleMap.ids[t]=0),e.styleMap.ids[t]++}(e,n)}`;return e.styleMap.styles[t]=o}function kr(e,t,[n,r],o,i){if(!1!==e.report.classifyStyles){const s=[];return r&&s.push(jr(e,r,"h")),s.push(jr(e,n,i||"s")),` class="${t.concat(s).join(" ")}"${o?` style="${o}"`:""}`}{const e=`${n}${o||""}${r||""}`;return`${""+(t.length?` class="${t.join(" ")}"`:"")}${e?` style="${e}"`:""}`}}function Or(e,t,n,r){let o=`left:${(t.x||0)+(t.offsetX||0)}rem;top:${(t.y||0)+(t.offsetY||0)}rem;`,i="";o+=`width:${yr(e,t,n)}rem;`;let s=$r(e,t,n,r&&r.computedHeight,r&&r.lineSize)||1;if("grow"===e.height&&e.margin){const r=xr(e,n,t);s+=r[0]+r[2]}r&&r.container&&r.computedHeight?i=`height:${s}rem;`:o+=`height:${s}rem;`;const a=e.font&&er(e.font.line,n),l=e.font&&er(e.font.size,n);if(null==a&&null==l||(o+=`line-height: ${null!=a?a:l}rem;`),e.margin){const r=xr(e,n,t);(r[0]||r[1]||r[2]||r[3])&&(o+=`padding:${r[0]}rem ${r[1]}rem ${r[2]}rem ${r[3]}rem;`)}else e.font&&e.font.right&&(o+=`padding-right:${e.font.right}rem;`);return(r&&r.font||e.font)&&(o+=Yr(r&&r.font||e.font,n)),e.border&&(o+=function(e,t,n){const r=wr(e,t,n);return r[0]+r[1]+r[2]+r[3]?`border-style:solid;border-width:${r[0]}rem ${r[1]}rem ${r[2]}rem ${r[3]}rem;`:""}(e,n,t)),o+=Mr(e,n),[o,i]}function Mr(e,t){let n="";const r=er(e.bg,t);r&&(n+=`background-color:${r};`);const o=er(e.radius,t);return o&&(n+=`border-radius:${o};`),n}function Yr(e,t){if(!e)return"";let n,r,o="";(n=er(e.family,t))&&(o+=`font-family:${n};`),(n=er(e.color,t))&&(o+=`color:${n};`),(n=er(e.align,t))&&(o+=`text-align:${n};`),(n=er(e.size,t))&&(o+=`font-size:${n}rem;`,r=n),n=er(e.line,t),0===n?o+="line-height:initial;":null!=n?o+=`line-height:${n}rem;`:r&&(o+=`line-height:${r}rem;`),(n=er(e.weight,t))&&(o+=`font-weight:${n};`),(n=er(e.pre,t))&&(o+="white-space:pre-wrap;word-break:break-word;");const i=n;return(n=er(e.clamp,t))&&(o+=(i?"":"white-space:nowrap;")+"overflow:hidden;"),o}gr("row",((e,t,n,r,o,i)=>{let s,a=Qn(e.br)?bn(Ln(i.context,{special:{placement:r,widget:e}}),e.br.x):e.br,l=r.maxX-o[0][0]-o[0][2]+o[o.length-1][0];return l<=0&&(l=r.maxX,a=!0),a||o[0][0]+o[0][2]+yr(e,{x:r.x,y:r.y,maxX:r.maxX,maxY:r.maxY,availableY:r.availableY,availableX:l},i)-o[o.length-1][0]>r.maxX?(s={x:n[3],y:vr(o),availableX:r.maxX,maxX:r.maxX},s.availableY=r.availableY-(s.y-t)):s={x:o[0][0]+o[0][2],y:o[0][1],availableX:l,maxX:r.maxX,availableY:r.availableY},s.y-=t,s}));function Dr(e,t,n){const r=n&&"root"in n&&n.root===n?n:new En(Object.assign({},e.context),{parameters:n});r.parameters=Object.assign({},e.defaultParams,r.parameters);const o={};if(e.sources&&Xr(r,e.sources,t),Array.isArray(e.parameters))for(const t of e.parameters)t.init&&t.name&&(o[t.name]=bn(r,t.init));return o}function Xr(e,t,n){const r=e.sources;for(const o of t){let t=n[o.source||o.name]||{value:[]};o.base&&(t=bn(Ln(e,{value:t.value,special:{source:t}}),o.base)),r[o.name||o.source]=mn(t)}for(const n of t)(n.filter||n.sort||n.group)&&(r[n.name||n.source]=Xn(r[n.name||n.source],n.filter,n.sort,n.group,e))}function zr(e,t,n){const r=t.root.sources[e.source?e.source:e.sources[0].name||e.sources[0].source],o=Array.isArray(r.value)?r.value:"object"==typeof r.value&&"grouped"in r.value&&Array.isArray(r.value.all)?r.value.all:[r.value];let i=e.fields,s=e.headers;(!i||!i.length&&o.length)&&(i=Object.keys(o[0]),s&&s.length||(s=Object.keys(o[0])));let a="";if(s){const r=Ln(t,{parser:yn});(null==n?void 0:n.table)?a+=`<tr class=header><th style="border-right: 2px solid;"></th>${s.map((e=>`<th>${bn(r,e)}</th>`)).join("")}</tr>`:a+=s.map((t=>`${e.quote||""}${bn(r,t)}${e.quote||""}`)).join(e.field||",")+(e.record||"\n")}if(null==n?void 0:n.table){let n=1;for(const r of o){const o=Ln(t,{value:r,special:{index:n-1}});if(e.rowContext){o.locals||(o.locals={});const t=bn(o,e.rowContext);t&&(o.value=t)}a+=`<tr class=row><th>${n}</th>${i.map((e=>{let t=e?bn(o,e):"";if(void 0===t&&(t=""),"string"!=typeof t){const e=t;t=`${e}`,"[object"===t.slice(0,7)&&(t=JSON.stringify(e))}return`<td>${t}</td>`})).join("")}</tr>`,n++}a=`<table>${a}</table>`}else{const n=e.quote?new RegExp(e.quote,"g"):void 0;let r=0;for(const s of o){const o=Ln(t,{value:s,special:{index:r}});if(e.rowContext){o.locals||(o.locals={});const t=bn(o,e.rowContext);t&&(o.value=t)}a+=i.map((t=>{let r=t?bn(o,t):"";if(void 0===r&&(r=""),"string"!=typeof r){const e=r;r=`${e}`,"[object"===r.slice(0,7)&&(r=JSON.stringify(e))}return n&&(r=r.replace(n,e.quote+e.quote)),`${e.quote||""}${r}${e.quote||""}`})).join(e.field||",")+(e.record||"\n"),r++}}return a}function Cr(e,t,n,r){if(r=r||[],e.type===t&&r.push(e),n&&r.length)return r;if(e.widgets)for(const o of e.widgets)Cr(o,t,n,r);return r}const Fr="&#8203;",Sr=_(" \r\n\t"),Nr=P(" \r\n\t"),Tr="0123456789abcdef",qr=Q(_("0123456789"),(e=>+e)),Ur=Q(se(W(Z("-")),_("0123456789"),W(se(Z("."),_("0123456789")))),(([e,t,n])=>+[e,t,null==n?void 0:n[0],null==n?void 0:n[1]].filter((e=>e)).join(""))),Hr=Q(se(W(Z("#")),G(R(8,Tr),R(6,Tr),R(4,Tr),R(3,Tr))),(([,e])=>`#${e}`)),Er=Q(se(Ur,W(Z("%"))),(([e,t])=>`${e}${t?"%":"rem"}`)),Lr=Z("left","right","top","bottom","center"),Pr=Q(se(Z("align"),W(se(Z("="),G(se(Z("top","middle","bottom","base"),W(se(Sr,Z("left","right","center")))),se(Z("left","right","center"),W(se(Sr,Z("top","middle","bottom","base")))))))),(([,e])=>{var t;return{tag:"align",value:e?[e[1][0],null===(t=e[1][1])||void 0===t?void 0:t[1]].filter((e=>e)):null}})),_r=Q(se(Z("valign"),W(se(Z("="),Z("top","middle","bottom","base")))),(([,e])=>({tag:"valign",value:e?e[1]:null}))),Rr=Q(se(Z("pad"),W(se(Z("="),oe(Ur,Sr)))),(([,e])=>({tag:"pad",value:e?e[1]:null}))),Jr=Q(se(Z("margin"),W(se(Z("="),oe(Ur,Sr)))),(([,e])=>({tag:"margin",value:e?e[1]:null}))),Ir=Q(se(Z("width","w"),W(se(Z("="),Er))),(([,e])=>({tag:"width",value:e?e[1]:null}))),Zr=Q(se(Z("height","h"),W(se(Z("="),Er))),(([,e])=>({tag:"height",value:e?e[1]:null}))),Vr=Q(se(Z("line"),W(se(Z("="),Ur))),(([,e])=>({tag:"line",value:e?e[1]:null}))),Wr=Q(se(Z("fg","color","fore"),W(se(Z("="),Hr))),(([,e])=>({tag:"fg",value:e?e[1]:null}))),Br=Q(se(Z("bg","background","back"),W(se(Z("="),Hr))),(([,e])=>({tag:"bg",value:e?e[1]:null}))),Gr=Q(se(Z("size"),W(se(Z("="),Ur))),(([,e])=>({tag:"size",value:e?e[1]:null}))),Kr=Q(se(Z("font"),W(se(Z("="),I(",|")))),(([,e])=>({tag:"font",value:e?e[1]:null}))),Qr=Q(se(Z("rotate"),W(se(Z("="),Ur,Nr,W(Z("left","right")),W(se(Sr,G(Er,Lr),Sr,G(Er,Lr)))))),(([,e])=>({tag:"rotate",value:e?{turn:e[1]*("left"===e[3]?-1:1),origin:e[4]?[e[4][1],e[4][3]]:void 0}:null}))),eo=Q(se(Z("move"),W(se(Z("="),Er,Sr,Er))),(([,e])=>({tag:"move",value:e?{x:e[1],y:e[3]}:null}))),to=Q(J(",|"),(e=>({tag:"trash",value:e}))),no=Q(se(Z("border"),W(se(Z("="),W(Z("solid","dot","dash","double")),Nr,oe(qr,Sr),Nr,W(se(Z("/"),Nr,oe(Ur,Sr))),Nr,W(Hr)))),(([,e])=>{var t;return{tag:"border",value:e?{style:e[1]||"solid",width:e[3],radius:null===(t=e[5])||void 0===t?void 0:t[2],color:e[7]}:null}})),ro=Q(G(Z("sub","sup","bold","italic","underline","strike","overline","overflow","nowrap","pre","br","b","i","u")),(e=>({tag:e}))),oo=Q(se(Z("|"),Nr,oe(G(no,Pr,Wr,Br,_r,Gr,Vr,Kr,Rr,Jr,Ir,Zr,ro,Qr,eo,to),se(Nr,Z(","),Nr),"allow"),J("|"),Z("|")),(([,,e])=>e.filter((e=>"trash"!==e.tag)))),io=Q(ne(G(I("\\|",!0),Q(Z("\\|"),(()=>"|")))),(e=>e.join(""))),so=$(te(G(io,oo)),{consumeAll:!0,undefinedOnError:!0}),ao=["border","width","height","pad","margin","align","overflow","nowrap","rotate","move"],lo={b:"bold",i:"italic",u:"underline"};function uo(e){const t=so(e);return Array.isArray(t)?function(e){let t="",n=!1;const r={bool:{},value:{}},o=[];for(const i of e)if("string"==typeof i)!r.bool.pre&&/^\s/.test(i)&&(t+=Fr),t+=i,!r.bool.pre&&/\s$/.test(i)&&(t+=Fr);else{let e,s=!1;for(const n of i){const i=lo[n.tag]||n.tag;"value"in n?null!==n.value?((r.value[i]||(r.value[i]=[])).push(n.value),(ao.includes(i)||e&&"bg"===i)&&(e||(e=[])).push(i)):ao.includes(i)||"bg"===i&&(s||o&&o.length&&o[o.length-1].includes("bg"))?s=!0:(r.value[i]||(r.value[i]=[])).pop():"br"===i?t+="<br/>":ao.includes(i)&&e.length?e.push(i):r.bool[i]=!r.bool[i]}if(n&&(t+="</span>"),n=!0,s){const e=o.pop();if(e){t+="</span>";for(const t of e)(r.value[t]||(r.value[t]=[])).pop()}}e&&(o.push(e),t+=`<span style="${po(r,e)}">`),t+=`<span style="${po(r,"inline")}">`}n&&(t+="</span>");for(const e of o)t+="</span>";return t}(t):e}const co={top:"start",middle:"center",bottom:"end",base:"baseline"},fo={dot:"dotted",dash:"dashed"};function po(e,t){let n="";if("inline"===t){const t=e.bool;(t.underline||t.overline||t.strike)&&(n+=`text-decoration-line:${[t.underline&&"underline",t.overline&&"overline",t.strike&&"line-through"].filter((e=>e)).join(" ")};`),(t.sup||t.sub)&&(n+="font-size:70%;",t.sup&&(n+="vertical-align:super;"),t.sub&&(n+="vertical-align:sub;")),t.italic&&(n+="font-style:italic;"),t.bold&&(n+="font-weight:bold;"),t.pre&&(n+="white-space:pre-wrap;");const r=e.value;if(Array.isArray(r.valign)){const e=r.valign[r.valign.length-1];e&&(n+=`vertical-align:${"base"===e?"baseline":e};`)}if(Array.isArray(r.fg)){const e=r.fg[r.fg.length-1];e&&(n+=`color:${e};`)}if(Array.isArray(r.bg)){const e=r.bg[r.bg.length-1];e&&(n+=`background-color:${e};`)}if(Array.isArray(r.size)){const e=r.size[r.size.length-1];null!=e&&(n+=`font-size:${e}rem;`)}if(Array.isArray(r.font)){const e=r.font[r.font.length-1];null!=e&&(n+=`font-family:${e};`)}if(Array.isArray(r.line)){const e=r.line[r.line.length-1];null!=e&&(n+=`line-height:${e}rem;`)}}else{n+="display:inline-flex;box-sizing:content-box;overflow:hidden;";const r=e.value;let o;if(t.includes("align")&&Array.isArray(r.align)){const e=r.align[r.align.length-1];if(Array.isArray(e)){let t=e.find((e=>["top","middle","bottom","base"].includes(e)));t&&(n+=`align-items:${co[t]};`),t=e.find((e=>["left","right","center"].includes(e))),t&&(n+=`justify-content:${t};`)}}if(t.includes("width")&&Array.isArray(r.width)){const e=r.width[r.width.length-1];null!=e&&(n+=`width:${e};`)}if(t.includes("height")&&Array.isArray(r.height)){const e=r.height[r.height.length-1];null!=e&&(n+=`height:${e};`)}if(t.includes("pad")&&Array.isArray(r.pad)){const e=r.pad[r.pad.length-1];Array.isArray(e)&&e.length&&(n+=`padding:${e[0]}rem`,e.length>1&&(n+=` ${e[1]}rem`),e.length>2&&(n+=` ${e[2]}rem`),e.length>3&&(n+=` ${e[3]}rem`),n+=";")}if(t.includes("margin")&&Array.isArray(r.margin)){const e=r.margin[r.margin.length-1];Array.isArray(e)&&e.length&&(n+=`margin:${e[0]}rem`,e.length>1&&(n+=` ${e[1]}rem`),e.length>2&&(n+=` ${e[2]}rem`),e.length>3&&(n+=` ${e[3]}rem`),n+=";")}if(t.includes("border")&&Array.isArray(r.border)){const e=r.border[r.border.length-1];e&&(n+=`border-style:${fo[e.style]||e.style};border-width:${e.width[0]}px`,e.width.length>1&&(n+=` ${e.width[1]}px`),e.width.length>2&&(n+=` ${e.width[2]}px`),e.width.length>3&&(n+=` ${e.width[3]}px`),n+=";",e.color&&(n+=`border-color:${e.color};`),e.radius&&(n+=`border-radius:${e.radius[0]}rem`,e.radius.length>1&&(n+=` ${e.radius[1]}rem`),e.radius.length>2&&(n+=` ${e.radius[2]}rem`),e.radius.length>3&&(n+=` ${e.radius[3]}rem`),n+=";"))}if(t.includes("bg")&&Array.isArray(r.bg)){const e=r.bg[r.bg.length-1];e&&(n+=`background-color:${e};`)}if(t.includes("rotate")&&Array.isArray(r.rotate)){const e=r.rotate[r.rotate.length-1];e&&(e.origin&&(n+=`transform-origin:${e.origin[0]} ${e.origin[1]};`),(o||(o=[]))[t.indexOf("rotate")]=`rotate(${e.turn}turn)`)}if(t.includes("move")&&Array.isArray(r.move)){const e=r.move[r.move.length-1];e&&((o||(o=[]))[t.indexOf("move")]=`translate(${e.x}, ${e.y})`)}o&&(n+=`transform:${o.filter((e=>e)).join(" ")};`),t.includes("nowrap")&&(n+="white-space:nowrap;"),t.includes("overflow")&&(n+="overflow:visible;")}return n}function go(e,t,n){let r=e;for(;r;){if(r.commit)return void(r.commit[t]=n);r=r.parent}}function ho(e){for(const t in e.commit){let n=e.context;for(;n;)n.special&&n.special.values&&(n.special.values[t]||(n.special.values[t]=[])).push(e.commit[t]),n=n.parent}}sr("label",((e,t,n)=>{Gn(t,"label",".label {position:absolute;box-sizing:border-box;white-space:normal;}");let r,o="",i=(Array.isArray(e.text)?e.text:[e.text]).map((n=>{let i=bn(t,"object"==typeof n&&"text"in n?n.text:n);return"string"==typeof i&&(i=or(i)),"object"==typeof n&&"id"in n&&go(t,n.id,i),o+=i,r=i,e.styled&&(i=uo(i)),"object"==typeof n&&"text"in n?`<span${kr(t,[],[Yr(n.font,t)+Mr(n,t),""])}>${i}</span>`:i})).join("");if(e.id&&go(t,e.id,o),e.format&&e.format.name){const n=[{v:Array.isArray(e.text)&&1!==e.text.length?i:r},{v:e.format.name}];i=bn(t,{op:"format",args:n.concat(e.format.args||[])})}return`<span${kr(t,["label"],Or(e,n,t,{lineSize:!0}))}>${i}</span>`})),sr("container",((e,t,n,r)=>{let o;Gn(t,"container",".container {position:absolute;box-sizing:border-box;}"),e.height?"auto"!==e.height&&(o=$r(e,n,t)):e.height="auto";const i=((r||{}).state||{}).ctx?Object.assign({},t,{context:r.state.ctx}):t;if(e.context&&!((r||{}).state||{}).ctx){i.context.locals||(i.context.locals={});const t=bn(tr(i,{special:{placement:n,widget:e},locals:i.context.locals}),e.context);t&&(i.context=Ln(i.context,{value:t,special:{placement:n,widget:e}}))}const s=hr(e,n,t)||n.availableX,a=function(e,t,n,r,o){if(Array.isArray(e.widgets)){let i="";const s=(r||{offset:0}).offset,a=[[0,s,0,0]],l=xr(e,t,n);a[0][0]+=l[3],a[0][1]+=l[0];const u=l[0]||0;if(e.border&&"expand"===e.box){const r=wr(e,t,n);null!=n.availableX&&(n.availableX-=r[1]+r[3]),null!=n.availableY&&(n.availableY-=r[0]+r[2])}for(let c=r&&r.last||0;c<e.widgets.length;c++){let f=e.widgets[c];if(f.macro&&(f=Ar(f.macro,f,t,n,r)),f.hide&&bn(Ln(t.context,{special:{widget:f,placement:n}}),f.hide))continue;let p=n&&$r(f,n,t);if(p>n.maxY&&(p=1),n&&null!=n.availableY&&p>n.availableY){const e=vr(a);return(r=r||{offset:e}).last=c,{output:i,continue:r,height:e}}{let e=Array.isArray(o)&&(o[c]||[0,0]);e&&Array.isArray(e)||(e=[0,0]),e[0]||(e[0]=0),e[1]||(e[1]=0);let d=Array.isArray(e)?{x:e[0]<0?e[0]:e[0]+l[3],y:e[1]<0?e[1]:e[1]+l[0],maxX:n.maxX}:e||n;if(Array.isArray(e)&&(d.availableX=d.maxX),(!o||"string"==typeof o)&&(d=(o&&dr[o]||dr.row)(f,s,l,n,a,t),p>d.availableY&&("grow"===f.height&&(p=$r(f,d,t)),p>d.availableY))){const e=vr(a);return(r=r||{offset:e}).last=c,{output:i,continue:r,height:e}}d.maxX=d.maxX||n.maxX,d.maxY=d.maxY||n.maxY,d.x<0&&(d.offsetX=l[3],d.x=(n.availableX||1)+d.x-yr(f,n,t)+1),d.y<0&&(d.offsetY=l[0],null==n.availableY?d.y=0:d.y=(n.availableY||1)+d.y-p+1);const{x:g,y:h}=d,y=pr(f,t,d,r&&r.child);if("string"==typeof y&&!y||!y.cancel&&!y.output&&!y.continue&&!y.height)continue;if("string"==typeof y)i+=y,a.unshift([g,h,yr(f,n,t),$r(f,n,t)]);else{if(y.cancel)return{output:"",cancel:!0};const e=y.height||$r(f,n,t)||0;if(h-u+e>n.availableY){const e=vr(a);return(r=r||{offset:e}).last=c,r.attempt=(+r.attempt||0)+1,r.attempt>1?Kn(t,n):{output:i,continue:r,height:e}}if(i+=y.output,a.unshift([g,h,y.width||yr(f,n,t),e]),y.continue)return(r=r||{offset:0}).child=y.continue,r.last=c,r.offset=vr(a),{output:i,continue:r,height:vr(a),width:br(a)}}0===d.availableX&&(a[0][2]=d.maxX)}}return{output:i,height:$r(e,n,t)||vr(a)-l[0],width:yr(e,n,t)||br(a)-l[3]}}return{output:"",height:0}}(e,i,{x:0,y:0,availableX:s,availableY:o||n.availableY,maxX:s,maxY:null==o||isNaN(o)?n.maxY:o},r,e.layout);if(a.cancel||(a.output=`<div${kr(t,["container"],Or(e,n,t,{computedHeight:o||a.height,container:!0}))}>${a.output}</div>`,a.height=o||a.height,a.width=yr(e,n,t)),(a.cancel||a.continue)&&!e.bridge){const e=a.continue||{};return e.offset=0,delete e.last,e.attempt=(e.attempt||0)+1,e.attempt>1?Kn(t,n):{continue:e,output:""}}return a.continue&&(e.context&&(a.continue.state={ctx:i.context}),a.continue.offset=0),a}),{container:!0}),sr("repeater",((e,t,n,r)=>{Gn(t,"container",".container {position:absolute;box-sizing:border-box;}"),e.height||(e.height="auto");let o,i=n.availableY,s=n.availableX,a="",l=!1;const u=xr(e,t,n);let c,f=r&&r.state&&"header"!==r.state.part?0:u[0];null!=i&&(i-=f,i=+i.toFixed(6));let p=!1;const d=r&&r.state&&r.state.newPage;let g,h=r&&r.state&&r.state.src;if(!h){if(!e.source)return"";h=qn(e.source)?bn(t,e.source):Xn(t.context.root.sources[e.source.source]||{value:[]},e.source.filter,e.source.sort,e.source.group,t.context).value,(t.context.special||(t.context.special={})).values||(t.context.special.values={})}if(Array.isArray(h))g=h;else{if(!h||!Array.isArray(h.value))return{output:"",height:0};c=h,g=c.value,e.group&&(p=e.group.length>c.grouped&&e.group.length-c.grouped-1)}if((e.header||e.group)&&(d||!r||!r.state||"header"===r.state.part||"group"===r.state.part)){const s=r&&r.state&&r.state.context&&r.state.context.context;if(c){const l=tr(t,{special:{source:c&&c.grouped?c.all:g,level:c&&c.level,grouped:!1!==p,group:c&&c.group,values:(s&&s.special||{}).values}});if(e.group&&!1!==p&&(!r||!r.state||"group"===r.state.part)&&(o=pr(e.group[p],tr(t,{value:c,special:{source:c&&c.grouped?c.all:g,level:c&&c.level,grouped:!0,group:c.group}}),{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}),o)){if(o.height>i)return a&&(a=`<div${kr(t,["container","repeat"],Or(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`),{output:a,height:f,continue:{offset:0,state:{part:"group",src:h,current:0,newPage:!0}}};null!=i&&(i-=o.height,i=+i.toFixed(6)),a+=o.output,f+=o.height}if(o=e.header&&(e.groupHeaders&&e.groupHeaders[c.grouped]&&(!r||!r.state||!r.state.current)||d&&!1!==e.headerPerPage)?pr(e.header,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}):{output:"",height:0},o.height>i)return{output:`<div${kr(t,["container","repeat"],Or(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"header",src:h,current:0,context:t,newPage:!0}}};null!=i&&(i-=o.height,i=+i.toFixed(6)),a+=o.output,f+=o.height}else if(e.header){if(o=!r||d&&!1!==e.headerPerPage?pr(e.header,t,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY}):{output:"",height:0},o.height>i)return{output:`<div${kr(t,["container","repeat"],Or(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"header",src:h,current:0,context:t,newPage:!0}}};null!=i&&(i-=o.height,i=+i.toFixed(6)),a+=o.output,f+=o.height}}d&&(r.state.newPage=!1),r&&r.child&&r.child.state&&(r.child.state.newPage=!1);let y=r&&r.state&&r.state.context||tr(t,{special:{source:c&&c.grouped?c.all:g,level:c&&c.level,grouped:!1!==p,group:c&&c.group,values:{},last:g.length-1,count:g.length}});const m=e.row&&(Qn(e.row.elide)?bn(tr(y,{special:{placement:n,widget:e}}),e.row.elide.x):e.row.elide);if(!r||!r.state||"footer"!==r.state.part){let u=0,d=0,$=f;if(m||g.length||!e.alternate)for(let v=r&&r.state&&r.state.current||0;v<g.length;v++){let b=!1;const x=c&&c.grouped?tr(y,{value:g[v],special:{index:v,values:{}},commit:{}}):tr(y,{value:g[v],special:{index:v}});if(c&&c.grouped){const t=r&&r.child||{offset:0,state:{current:0,src:g[v],part:"group"}};o=pr(e,x,{x:0,y:f,availableX:s-u,availableY:i,maxX:n.maxX,maxY:n.maxY},t)}else{if(x.commit={},m){pr(e.row,x,{x:0,y:0,availableX:n.maxX,maxX:n.maxX,availableY:n.maxY,maxY:n.maxY},r?r.child:void 0),ho(x);continue}o=pr(e.row,x,{x:u,y:f,availableX:s-u,maxX:n.maxX,availableY:i,maxY:n.maxY},r?r.child:void 0),b=!0}if(r&&(r.child=null),o.width&&o.width<=s-u&&o.width!==s)u+=o.width,o.height>d&&(d=o.height,o.height>i&&($-=o.height));else if(o.width&&u&&o.width>s-u){f+=d,$=f,null!=i&&(i-=d,i=+i.toFixed(6)),d=0,u=0,v--;continue}if(o.height>i||o.cancel)return $===f&&d&&(f+=d),l?{output:`<div${kr(t,["container","repeat"],Or(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"body",src:h,current:v,context:y,newPage:!c||!1===p},child:o.continue}}:{output:"",height:f,continue:{offset:f,state:{part:r&&r.state&&r.state.part||"body",src:h,current:v,context:y,newPage:!c||!1===p},child:o.continue}};if(d||(f+=o.height,null!=i&&(i-=o.height,i=+i.toFixed(6))),a+=o.output,l=!0,b&&e.header&&"flow"===t.report.type&&e.headerRepeat>0&&v+1&&(v+1)%e.headerRepeat==0){const r=pr(e.header,t,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY});a+=r.output,f+=r.height}if(o.continue)return $===f&&d&&(f+=d),e.row.bridge&&ho(x),{output:`<div${kr(t,["container","repeat"],Or(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"body",src:h,current:v,context:y,newPage:!c||!1===p},child:e.row.bridge||c&&c.grouped?o.continue:void 0}};ho(x)}else if(e.alternate){if(o=pr(e.alternate,y,{x:u,y:f,availableX:s-u,maxX:n.maxX,availableY:i,maxY:n.maxY},r?r.child:void 0),o.height>i)return{output:a,height:0,continue:{offset:0,state:{part:"body",src:h,current:0,newPage:!0}}};null!=i&&(i-=o.height,i=+i.toFixed(6)),a+=o.output,f+=o.height}$===f&&d&&(f+=d)}if(e.footer){const s=y&&y.context||r&&r.state&&r.state.context&&r.state.context.context,l=tr(t,{special:{source:c&&c.grouped?c.all:g,level:c&&c.level,grouped:!1!==p,group:c&&c.group,values:(s&&s.special||{}).values},commit:{}});if(o=c?e.groupEnds&&e.groupEnds[c.grouped]?pr(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY,availableY:i}):{output:"",height:0}:pr(e.footer,l,{x:0,y:f,availableX:n.availableX,maxX:n.maxX,maxY:n.maxY,availableY:i}),o.height>i)return{output:`<div${kr(t,["container","repeat"],Or(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"footer",current:0,src:h,context:y,newPage:!0}}};if(o.continue)return e.footer.bridge&&ho(l),{output:`<div${kr(t,["container","repeat"],Or(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f,continue:{offset:f,state:{part:"footer",src:h,current:0,context:y,newPage:!0},child:e.footer.bridge?o.continue:void 0}};ho(l),a+=o.output,f+=o.height}return{output:`<div${kr(t,["container","repeat"],Or(e,n,t,{computedHeight:f,container:!0}))}>\n${a}</div>`,height:f}}),{container:!0}),sr("image",((e,t,n)=>{Gn(t,"image",".image {position:absolute;box-sizing:border-box;} .image .inner {background-repeat:no-repeat;height:100%;}");const r=e.fit&&"object"==typeof e.fit?bn(t,e.fit.x):e.fit;return"stretch"===r?`<img src="${bn(t,e.url)}" ${kr(t,["image"],Or(e,n,t))} />`:`<div ${kr(t,["image"],Or(e,n,t))}><div ${kr(t,["inner"],function(e){return[`background-size:${e&&"contain"!==e?"stretch"===e?"100% 100%":"cover":"contain;background-position:center"};`,""]}(r),`background-image:url('${bn(t,e.url)}');`)}></div></div>`})),sr("measured",((e,t,n,r)=>{Gn(t,"measured",".measured {position:absolute;box-sizing:border-box;white-space:pre-wrap;font-family:serif;font-size:0.83rem;word-break:break-word;}");const o=bn(t,e.text),i=fr(o,hr(e,n,t)||n.availableX,t,e.font);if(!r&&i>n.availableY)return{output:"",height:0,continue:{state:{},offset:0}};{let r=Or(e,n,t,{computedHeight:i,container:!0});return r[0]="line-height:1em;"+r[0],{height:i,output:`<span${kr(t,["measured","label"],r)}>${or(o)}</span>`}}})),sr("html",((e,t,n)=>{Gn(t,"html",".html {position:absolute;box-sizing:border-box;overflow:hidden;line-height:1rem;}");const r=bn(tr(t,{parser:yn}),e.html);return`<div${kr(t,["html"],Or(e,n,t,{container:!0}))}>${r}</div>`}));const yo=/(\d)(?=(\d{3})+\.)/g,mo=/(\d)(?=(\d{3})+$)/g,$o=/^[-0-9\\.,]+$/;function vo(e,t=2,n=",",r="sign"){if(e="number"!=typeof e?parseFloat(e||""):e,isNaN(e))return"";const o=e<0;return e=e.toFixed(t),0===t&&(e=e.replace(/\..*/,"")),o&&"sign"!==r&&(e=`(${"both"===r?e:e.substr(1)})`),n?e.replace(-1===e.indexOf(".")?mo:yo,`$1${n}`):e}const bo=/\\.|y+|M+|d+|E+|H+|m+|s+|k+|h+|a+|S+|z+/g,xo=["January","February","March","April","May","June","July","August","September","October","November","December"],wo=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let Ao;function jo(e,t){if(!e)return"";let n,r,o,i,s,a,l,u,c;if("object"==typeof e&&"f"in e&&Array.isArray(e.f)){const t=e.f,f=t.length,p=e.e;n=t[0],r=f>1&&null!=t[1]?t[1]:p?11:0,o=f>2&&null!=t[2]?t[2]:p?0:1,s=f>3&&null!=t[3]?t[3]:p?23:0,a=f>4&&null!=t[4]?t[4]:p?59:0,l=f>5&&null!=t[5]?t[5]:p?59:0,u=f>6&&null!=t[6]?t[6]:p?999:0;let d=new Date(n,r,o||1,s,a,l,u);c=f>7&&null!=t[7]?-t[7]:d.getTimezoneOffset(),o||(d.setMonth(r+1),d.setDate(0),o=d.getDate()),i=d.getDay()}else{if("string"==typeof e&&(e=new Date(e)),"[object Date]"!==Object.prototype.toString.call(e))return"";if(isNaN(e))return"";const t=e;n=t.getFullYear(),r=t.getMonth(),o=t.getDate(),i=t.getDay(),s=t.getHours(),a=t.getMinutes(),l=t.getSeconds(),u=t.getMilliseconds(),c=t.getTimezoneOffset()}return t||(t=Ao||"yyyy-MM-dd"),t.replace(bo,(e=>{if("\\"===e[0])return e[1];if("y"===e[0])return e.length<=2?`${n}`.substr(2,2):`${n}`;if("M"===e[0])return 1===e.length?`${r+1}`:2===e.length?r<9?`0${r+1}`:`${r+1}`:3===e.length?xo[r].substr(0,3):xo[r];if("d"===e[0])return 1===e.length?`${o}`:2===e.length?o<=9?`0${o}`:`${o}`:ko(o);if("E"===e[0])return 1===e.length?`${i+1}`:2===e.length?wo[i].substr(0,3):wo[i];if("H"===e[0])return 1===e.length?`${s}`:s<=9?`0${s}`:`${s}`;if("m"===e[0])return 1===e.length?`${a}`:a<=9?`0${a}`:`${a}`;if("s"===e[0])return 1===e.length?`${l}`:l<=9?`0${l}`:`${l}`;if("S"===e[0]){const t=u;return 1===e.length?`${t}`:t<10?`00${t}`:t<100?`0${t}`:`${t}`}if("k"===e[0]||"h"===e[0]){let e=""+s%12;return"0"===e&&(e="12"),`${e}`}if("a"===e[0])return s>11?"PM":"AM";if("z"===e[0]){let t=0-c;const n=t<0?"-":"+";t=Math.abs(t);let r=t;if(1===e.length)r=Math.floor(t/60);else{if(2===e.length){const e=t%60,r=Math.floor(t/60);return`${n}${r<10?"0":""}${r}${e<10?"0":""}${e}`}if(3===e.length){const e=t%60,r=Math.floor(t/60);return`${n}${r<10?"0":""}${r}:${e<10?"0":""}${e}`}r=t}return`${n}${r}`}}))}function ko(e,t){let n=`${e=vo(e,0,t)}`;if(n=n.substr(-2,2),n.length>1&&"1"===n[0])return`${e}th`;switch(n[1]||n[0]){case"1":return`${e}st`;case"2":return`${e}nd`;case"3":return`${e}rd`;default:return`${e}th`}}jo.setDefault=function(e){Ao=e};const Oo=new RegExp(`[${Fe.split("").map((e=>`\\${e}`)).join("")}]`);let Mo=!1,Yo=!1,Do=!1,Xo=!1,zo=!1,Co=!1,Fo=!1,So=!1,No=!1,To={array:60,union:60,args:60,keys:60},qo=!1,Uo=!1,Ho=0,Eo=!1;const Lo=["===","!==","deep-is","deep-is-not"],Po=Lo.concat(["**","*","/%","/","%","+","-",">=","gte",">","gt","<=","lte","<","lt","in","like","ilike","not-in","not-like","not-ilike","contains","does-not-contain","is","is-not","==","!=","strict-is","strict-is-not","and","&&","or","||","??"]),_o=["+","not"],Ro={"**":1,"*":2,"/%":2,"/":2,"%":2,"+":3,"-":3,">=":4,">":4,"<=":4,"<":4,in:4,like:4,ilike:4,"not-in":4,"not-like":4,"not-ilike":4,contains:4,"does-not-contain":4,gt:4,gte:4,lt:4,lte:4,is:5,"is-not":5,"==":5,"!=":5,"strict-is":5,"strict-is-not":5,"deep-is":5,"deep-is-not":5,"===":5,"!==":5,and:6,"&&":6,or:7,"||":7,"??":7},Jo=/^[-a-zA-Z_$0-9]/;function Io(e,t){if(Mo=(t=t||{}).noSymbols,Do=t.SExprOps,Xo=t.listCommas,zo=t.SExprOps&&t.noArrayLiterals,Co=t.SExprOps&&t.noObjectLiterals,Yo=!1,Fo=So=t.template,No=t.noIndent,Ho=0,Eo=!0,"listWrap"in t){const e=t.listWrap;if("boolean"==typeof e)To=e?{array:1,union:1,args:1,keys:1}:{array:0,union:0,args:0,keys:0};else if("number"==typeof e)To={array:e,union:e,args:e,keys:e};else{const t=e.base?!0===e.base?1:e.base:0;To=Object.keys(To).reduce(((n,r)=>(n[r]=r in e&&null!=e[r]?e[r]?!0===e[r]?1:e[r]:0:t,n)),{})}}else To={array:60,union:60,args:60,keys:60};return qo=t.htmlSafe,Uo=t.noChecks,!Do&&"object"==typeof e&&e&&"op"in e&&"block"===e.op?function(e){return e.args&&e.args.length?e.args.map(((e,t)=>(Eo=0===t,Vo(e)))).join("\n"):""}(e):Vo(e)}function Zo(e,t,n){if(e=`${e}`,!t)return e;for(let r=e.length;r<n;r++)e=t+e;return e}function Vo(e){if("string"==typeof e)return e;let t;if(null==e||"number"==typeof e||"boolean"==typeof e)return`${e}`;if(Fo&&("op"in e||"r"in e))if("op"in e){if("if"===e.op||"with"===e.op||"unless"===e.op||"each"===e.op)t=function(e){Fo=!1;const t=Vo(e.args[0]);Fo=!0;const n=Vo(e.args[1]);let r=`{{${e.op} ${t}}}${"with"===e.op||"each"===e.op?n.slice(2):n}`;if("unless"===e.op)return`${r}{{/}}`;for(let t=2;t<e.args.length;t++)if(t+1>=e.args.length){const n=e.args[t];if("object"==typeof n&&"v"in n&&""===n.v)continue;r+=`{{else}}${Vo(n)}`}else Fo=!1,r+=`{{elseif ${Vo(e.args[t++])}}}`,Fo=!0,r+=Vo(e.args[t]);return r+="{{/}}",r}(e);else if("case"===e.op)t=function(e){const t=e.args.length-1,n=e.args.map(((e,n)=>(Fo=!0,0!==n&&n%2!=1||(Fo=!1),n===t&&(Fo=!0),"object"==typeof e&&"op"in e?Vo(e).replace(si,"_"):Vo(e))));Fo=!0;let r=`{{${e.op} ${n[0]} when ${n[1]}}}`;for(let e=2;e<=t;e++)r+=e===t?`{{else}}${n[e]}`:e%2==1?`{{when ${n[e]}}}`:n[e];return r+="{{/}}",r}(e);else if(e.op){if("+"===e.op)return e.args.map((e=>Vo(e))).join("");{Fo=!1;const n=`{{${Vo("string"===e.op?e.args[0]:e)}}}`;Fo=!0,t=n}}}else{Fo=!1;const n=`{{${Vo(e)}}}`;Fo=!0,t=n}else if("r"in e)if("string"==typeof e.r)t=/^[0-9]/.test(e.r)?`.${e.r}`:e.r;else{const n=e.r;t=`${function(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}("^",n.u||0)}${n.p||""}${n.k.map(((e,t)=>"string"==typeof e&&Oo.test(e)?`${t?"":"_"}[${Vo({v:e})}]`:"string"==typeof e||"number"==typeof e?`${t?".":""}${e}`:`[${Vo(e)}]`)).join("")}`}else if("op"in e)t=function(e){let t=e.op;(So&&!1!==qo||qo)&&(">"===t?t="gt":">="===t?t="gte":"<"===t?t="lt":"<="===t?t="lte":"&&"===t&&(t="and"));if(zo||"array"!==t||e.opts){if(Co||"object"!==t||!e.args||e.args.find(((e,t)=>t%2==0&&("string"==typeof e||!("v"in e)||"string"!=typeof e.v)))){if(Do)return e.args&&e.args.length?oi(`(${t} `,e.args,e.opts,")",0):`(${t})`;if("if"===t||"unless"===t&&e.args&&e.args.length>2)return function(e){if(!e.args||e.args.length<2)return"false";let t="";const n=e.args.length-1,r=!!e.args.find(((e,t)=>(t%2==1||t===n)&&ii(e)));Ho++;const o=e.args.map(((e,t)=>Vo(!r||t%2!=1&&t!==n||ii(e)?e:{op:"block",args:[e]})));Ho--;const i=o.find((e=>e.length>30||~e.indexOf("\n")))||"";let s=No?"":o.length>3||i?`\n${Zo("","  ",Ho)}`:"";const a=i&&`${s}  `||" ";s=s||" ";for(let e=0;e<=n;e++)if(0===e)if(r)t+=`if ${o[e++]} ${ri("  ",o[e]).trimLeft()}`;else{const n=o[e++];t+=`if ${n}${~n.indexOf("\n")?s:" "}then${a}${o[e].trimLeft()}`}else e===n?r?t=t.trimRight()+` else ${ri("  ",o[e]).trimLeft()}`:t+=`${s}else${a}${o[e].trimLeft()}`:r?t=t.trimRight()+` elif ${o[e++]} ${ri("  ",o[e]).trimLeft()}`:t+=`${s}elif ${o[e++]} then${a}${o[e].trimLeft()}`;!r&&Ho&&(t+=`${s}end`);return t}(e);if("case"===t&&e.args&&e.args.length>2)return function(e){if(!e.args||e.args.length<2)return"false";let t="";const n=e.args.length-1,r=!!e.args.find(((e,t)=>(t>1&&t%2==0||t===n)&&ii(e)));Ho++;const o=e.args.map(((e,t)=>{let o;return 0!==t&&Ho++,o=r&&(t>1&&t%2==0||t===n)?Vo(ii(e)?e:{op:"block",args:[e]}):t%2==0||t===n?Vo(e):"object"==typeof e&&"op"in e?Vo(e).replace(si,"_"):Vo(e),0!==t&&Ho--,o}));Ho--;const i=o.find((e=>e.length>30||~e.indexOf("\n")))||"";let s=No?"":o.length>3||i?`\n${Zo("","  ",Ho)}`:"";const a=s?`${s}  `:" ",l=i&&`${a}  `||" ";s=s||" ";for(let e=0;e<=n;e++)if(0===e)t+=`case ${o[e]}`;else if(e===n)r?t=t.trimRight()+a+`else ${ri("  ",o[e]).trimLeft()}`:t+=`${a}else${l}${o[e].trimLeft()}`;else if(r)t=t.trimRight()+a+`when ${o[e++]} ${ri("  ",o[e]).trimLeft()}`;else{const n=o[e++];t+=`${a}when ${n}${~n.indexOf("\n")?a:" "}then${l}${o[e].trimLeft()}`}!r&&Ho&&(t+=`${s}end`);return t}(e);if("+"===t&&e.args&&e.args.length>1&&Wo(t,e)){return`'${Bo(t,e).map((e=>"string"!=typeof e&&"v"in e&&"string"==typeof e.v?e.v.replace(/[{']/g,(e=>`\\${e}`)).replace(/\$$/,"\\$"):`{${Vo(e)}}`)).join("")}'`}if(("fmt"===t||"format"===t)&&e.args&&"object"==typeof e.args[1]&&"v"in e.args[1]&&"string"==typeof e.args[1].v){const t=e.args[0];let n=Vo(t);return"string"!=typeof t&&"op"in t&&(Po.includes(t.op)||_o.includes(t.op))&&(n=`(${n})`),e.opts?`${n}#${[e.args[1].v]}${oi("(",e.args.slice(2),e.opts,")")}`:`${n}#${[e.args[1].v].concat(e.args.slice(2).map((e=>Vo(e)))).join(",")}`}if(!(Po.includes(t)&&e.args&&e.args.length>1)||e.opts||Lo.includes(t)&&2!==e.args.length){if(_o.includes(t)&&e.args&&1===e.args.length){const n=e.args[0];return"string"!=typeof n&&"op"in n&&(Po.includes(n.op)||_o.includes(n.op))?`${t}(${Vo(n)})`:`${t}${Jo.test(t)?" ":""}${Vo(n)}`}if("block"===t){if(!e.args||!e.args.length)return"";Ho++;const t=Eo,n=e.args.map(((e,t)=>(Eo=0===t,Vo(e))));Eo=t;let r=No?"":`\n${Zo("","  ",Ho)}`;return Ho--,1!==n.length||~n[0].indexOf("\n")?`{${r}${n.join(r)}\n${Zo("","  ",Ho)}}`:`{ ${n[0]} }`}if("let"!==t&&"set"!==t||!e.args||2!==e.args.length)return"get"===t&&2===e.args.length&&"object"==typeof e.args[1]&&"v"in e.args[1]&&"object"==typeof e.args[1].v&&"k"in e.args[1].v?`${Vo(e.args[0])}${Vo({r:{k:["r"].concat(e.args[1].v.k)}}).substr(1)}`:Jo.test(t)?oi(`${t}(`,e.args||[],e.opts,")",0):e.args&&e.args.length?oi(`(${t} `,e.args,e.opts,")",0):`(${t})`;{let n,r=e.args[0];return n="string"==typeof r?r:"v"in r&&"string"==typeof r.v?r.v:"v"in r&&"object"==typeof r.v&&"k"in r.v?Vo({r:r.v}):Vo(r),`${t} ${n} = ${Vo(e.args[1])}`}}{let n=e.args.map(((e,n)=>function(e,t,n){let r;"**"===e&&1===n&&"string"!=typeof t&&"op"in t&&"**"===t.op&&(r=`(${Vo(t)})`);r="string"!=typeof t&&"op"in t&&(Po.includes(t.op)&&Ro[t.op]>Ro[e]||"if"===t.op||"unless"===t.op||"case"===t.op||"fmt"===t.op||"format"===t.op)?`(${Vo(t)})`:Vo(t);return r}(t,e,0===n?1:2)));const r=n.find((e=>e.length>30||~e.indexOf("\n")))||n.reduce(((e,t)=>e+t.length),0)&&n.length>2,o=No?" ":r?`\n${Zo("","  ",Ho+1)}`:" ";return(o.length>1||!No&&r)&&(n=[n[0]].concat(n.slice(1).map((e=>function(e,t){return t.replace(/\n/gm,`\n${e}`)}("  ",e))))),`${n[0]} ${t}${o}${n.slice(1).join(` ${t}${o.length>1?`${o}`:o}`)}`}}return e.args&&e.args.length?oi("{",e.args,e.opts,"}",2):"{}"}return oi("[",e.args,e.opts,"]")}(e);else if(Tn(e)){const n=So&&!1!==qo||qo?"\\":">";t="n"in e?`|${e.n.join(Xo?", ":" ")}| =${n} ${Vo(e.a)}`:`=${n}${Vo(e.a)}`}else"v"in e?t=function(e){if(1===e.s){Ho++;const t=ai(e.v);if(Ho--,~t.indexOf("\n")){const e=No?" ":`\n${Zo("","  ",Ho)}`;return`@[${e}${" "!==e?"  ":""}${t}${e}]`}return`@[${t}]`}if("string"==typeof e.v)return Fo?e.v.replace(/\\(.)/g,"\\\\$1").replace(/{{/g,"\\{{"):!Yo&&Mo||Oo.test(e.v)||!e.v.length?~e.v.indexOf("'")?~e.v.indexOf("`")?~e.v.indexOf('"')?`'${e.v.replace(/['{]/g,(e=>`\\${e}`)).replace(/\${/g,"\\${")}'`:`"${e.v}"`:`\`${e.v.replace(/[{`]/g,(e=>`\\${e}`)).replace(/\${/g,"\\${")}\``:`'${e.v.replace(/[{']/g,(e=>`\\${e}`)).replace(/\${/g,"\\${")}'`:`${Yo?"":":"}${e.v}`;if("number"==typeof e.v||"boolean"==typeof e.v||"true"===e.v||"false"===e.v)return`${e.v}`;if("undefined"===e.v||void 0===e.v)return"undefined";if("null"===e.v||null===e.v)return"null";if(Array.isArray(e.v))return zo?oi("(array",e.v.map((e=>({v:e}))),null,")",null,"array"):oi("[",e.v.map((e=>({v:e}))),null,"]",null,"array");if("object"==typeof e.v)return In(e.v)?ei(e.v):oi("{",Object.entries(e.v).reduce(((e,t)=>(e.push({v:t[0]},{v:t[1]}),e)),[]),null,"}",2,"keys")}(e):In(e)?t=ei(e):Wn(e)&&(t=function(e){if("number"==typeof e||De(e)){let t="",n=Math.abs(Xe(e));return Ko.forEach((e=>{const r=Math.floor(n/Ye[e]);n%=Ye[e],r&&(t+=`${r}${e}`)})),n&&(t+=`${n}ms`),`#${t}#`}{const t=e.d;let n="";return Qo.forEach(((e,r)=>{null!=t[r]&&(n+=`${t[r]}${e}`)})),`#${n}#`}}(e));return"c"in e&&e.c.length&&(t=(Eo?"":"\n")+e.c.map((e=>`${Zo("","  ",Ho)}// ${e}\n`)).join("")+`${Zo("","  ",Ho)}${t}`),t}function Wo(e,t){if(t.args&&t.args.find((e=>"object"==typeof e&&"string"==typeof e.v)))return!0;if(!t.args||!t.args.length)return!1;const n=t.args[0];return"object"==typeof n&&"op"in n&&n.op===e&&Wo(e,n)}function Bo(e,t,n=[]){if(t.args&&t.args.length){let r=0;for(;r<t.args.length&&("object"==typeof t.args[r]&&"string"==typeof t.args[r].v);r++)n.push(t.args[r]);const o=t.args[r];"object"==typeof o&&"op"in o&&o.op===e?Bo(e,o,n):n.push(o),n.push.apply(n,t.args.slice(r+1))}return n}function Go(e,t){if(null==t)return"";t*=e;const n=Math.abs(t),r=Math.floor(n/60),o=n%60;return t?`${t>0?"-":"+"}${r}${o?`:${Zo(o,"0",2)}`:""}`:"Z"}const Ko=["w","d","h","mm","s"],Qo=["y","m","d","h","mm","s","ms"];function ei(e){let t="";if(e instanceof Date){const n=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),i=e.getHours(),s=e.getMinutes(),a=e.getSeconds(),l=e.getMilliseconds();return t=`${n}-${Zo(r,"0",2)}-${Zo(o,"0",2)}`,i+s+a+l>0&&(t+=` ${Zo(i,"0",2)}:${Zo(s,"0",2)}`,a+l>0&&(t+=`:${Zo(a,"0",2)}`,l>0&&(t+=`.${Zo(l,"0",3)}`))),`#${t}${Go(1,e.getTimezoneOffset())}#`}if(Array.isArray(e.f)){const n=e.f;return t=`${n[0]}`,null!=n[1]&&(t+=`-${Zo(n[1]+1,"0",2)}`),null!=n[2]&&(t+=`-${Zo(n[2],"0",2)}`),null!=n[3]&&(t+=` ${Zo(n[3],"0",2)}`),null!=n[4]&&(t+=`:${Zo(n[4],"0",2)}`),null!=n[5]&&(t+=`:${Zo(n[5],"0",2)}`),null!=n[6]&&(t+=`.${Zo(n[6],"0",3)}`),null!=n[7]&&(t+=` ${Go(-1,n[7])}`),"e"in e&&e.e&&(t+="<"),`#${t}#`}if("n"===e.f){if(Array.isArray(e.o))return Qo.forEach(((n,r)=>{null!=e.o[r]&&(t+=`${e.o[r]}${n}`)})),t+=`${"d"in e&&-1===e.d?" ago":" from now"}${Go(-1,e.z)}`,`#${t}#`;if("number"==typeof e.o){if(0===e.o)return"#now#";let n=Math.abs(e.o);return Ko.forEach((e=>{const r=Math.floor(n/Ye[e]);n%=Ye[e],r&&(t+=`${r}${e}`)})),n&&(t+=`${n}ms`),`#${t}${e.o<0?" ago":e.o>0?" from now":""}${Go(-1,e.z)}#`}}else if("d"in e&&1===e.d&&0===e.o)t=`#${"w"===e.f?"week":"m"===e.f?"month":"year"} to date${Go(-1,e.z)}${e.e?">":""}#`;else{if("t"in e&&Array.isArray(e.t)){const n=e.t;return t=(e.o<0?"yesterday":e.o>0?"tomorrow":"today")+" at ",n[0]||n[1]||n[2]||n[3]?12!==n[0]||n[1]||n[2]||n[3]?(t+=n[0],null!=n[1]&&(t+=`:${Zo(n[1],"0",2)}`),null!=n[2]&&(t+=`:${Zo(n[2],"0",2)}`),null!=n[3]&&(t+=`.${Zo(n[3],"0",3)}`)):t+="noon":t+="midnight",`#${t}${Go(-1,n[4])}${e.e?">":""}#`}if(!("t"in e)&&!("d"in e)&&!Array.isArray(e.f)){const n=e;return"d"===n.f?t+=""+(n.o<0?"yesterday":n.o>0?"tomorrow":"today"):t+=`${n.o<0?"last":n.o>0?"next":"this"} ${"w"===n.f?"week":"m"===n.f?"month":"year"}`,`#${t}${Go(-1,n.z)}${n.e?">":""}#`}}return t}const ti=/^\s+/,ni=/^\s+/gm;function ri(e,t){return e?t.replace(ni,(t=>t.substr(e.length))):t}function oi(e,t,n,r,o,i){if(!(t&&t.length||n))return`${e}${r}`;Ho++;const s=Eo;let a;if(o){a=[];for(let e=0;e<t.length;e++)if(e%o==0)Yo=!0,a.push(Vo(t[e])+":"),Yo=!1;else{Ho++,Eo=1===e;const n=Vo(t[e]);"\n"===n[0]?a[a.length-1]+=" "+n.replace(ti,""):a[a.length-1]+=n,Ho--}}else a=t.map(((e,t)=>(Eo=0===t,Vo(e))));if(n&&"object"==typeof n){const e="op"in n&&n.args?n.args:"v"in n?Object.entries(n.v).reduce(((e,t)=>(e.push({v:t[0]},{v:t[1]}),e)),[]):[];for(let t=0;t<e.length;t++)if(t%2==0)Yo=!0,a.push(Vo(e[t])+":"),Yo=!1;else{Ho++,Eo=1===t;const n=Vo(e[t]);"\n"===n[0]?a[a.length-1]+=" "+n.replace(ti,""):a[a.length-1]+=n,Ho--}}Ho--,Eo=s;let l=Xo?", ":" ";if(No||1==a.length&&!~a[0].indexOf("\n"))return`${e}${a.join(l)}${r}`;let u=To[i||"args"];const c=a.join(Xo?", ":" ");!u&&~c.indexOf("\n")&&(u=1),1===u&&Xo&&(l=",\n");const f=Zo("","  ",Ho);if(!u)return`${e}${c}${r}`;if(1===u)return`${e}\n${a.map((e=>`${f}  ${e}`)).join(l)}\n${f}${r}`;if(c.length<=u)return`${e}${c}${r}`;let p=`${e}`,d="";const g=a.length-1;for(let e=0;e<a.length;e++)~a[e].indexOf("\n")?(d&&(p+=d),p+=`\n${" "===a[e][0]?"":f+"  "}${a[e]}${e!==g?l:""}`,d=""):(d||(d+=`\n${f}  `),d+=`${a[e]}${e!==g?l:""}`,d.length>=u&&(p+=d,d=""));return d&&(p+=d),`${p}\n${f}${r}`}function ii(e){return"object"==typeof e&&"op"in e&&"block"===e.op}const si=/@case\b/g;function ai(e,t){if(void 0!==t&&(Uo=t),!e)return"any";const n=e.type,r=e.types;let o,i,s="",a="",l="",u="",c=To.array;switch(n){case"object":case"object[]":const t=!!~n.indexOf("[]");if(!(e.fields&&e.fields.length||e.rest)){s="{}"+(t?"[]":"");break}c=To.keys,Ho++,o=e.fields?e.fields.map(((e,t)=>{const n=ai(e);return(e.desc&&e.desc.length?(0===t?"":`\n${Zo("","  ",Ho)}`)+e.desc.map((e=>`// ${e}`)).join(`\n${Zo("","  ",Ho)}`)+`\n${Zo("","  ",Ho)}`:"")+`${e.name}${e.required?"":"?"}: ${n}`})):[],e.rest&&o.push(`...: ${ai(e.rest)}`),Ho--,a="{",l="}"+(t?"[]":""),u=", ";break;case"union":case"union[]":~n.indexOf("[]")?(a="Array<",l=">"):e.checks&&e.checks.length&&(a="(",l=")"),a&&Ho++,o=r.map((e=>ai(e))),c=To.union,u=o.length>6||o.find((e=>~e.indexOf("\n")))?" | ":"|",a&&Ho--;break;case"literal":s="string"==typeof e.literal?`'${e.literal.replace(/'/g,"\\'")}'`:`${e.literal}`;break;case"tuple":case"tuple[]":if(!n||0===n.length){s="[]";break}Ho++,a="[",l="]"+(~n.indexOf("\n")?"[]":""),u=", ",o=r.map((e=>ai(e))),Ho--;break;default:s=e.ref||n||"any",e.ref&&"array"===n&&(s+="[]")}const f=No?" ":Zo("","  ",Ho);if(e.defs){i=Object.keys(e.defs).sort().map(((t,n)=>{const r=e.defs[t];return(r.desc&&r.desc.length?(0===n?"":`\n${f}`)+r.desc.map((e=>`// ${e}`)).join(`\n${f}`)+`\n${f}`:"")+`type ${t} = ${ai(r)}`})).join(`\n${f}`)}if(!s){const e=a&&!No?`${f}  `:f,t=No?"":"\n",n=a?`${a}${t}${e}`:"",r=l?`${t}${f}${l}`:"";if(0===c)s=`${n}${o.join(u)}${r}`;else if(1===c)s=`${n}${o.join(`${u}${t}${e}`)}${r}`;else{let i="";const f=o.length-1;for(let n=0;n<o.length;n++)~o[n].indexOf("\n")?(i="",s+=(0===n?"":"\n"+e)+o[n]+(n!==f?u:"")):(s+=o[n],i+=o[n],n!==f&&(s+=u,i+=u)),i.length>c&&n!==f&&!~(o[n+1]||"").indexOf("\n")&&(s+=`${t}${e}`,i="",~u.indexOf("|")&&(s+="  "));s=~s.indexOf("\n")?`${n}${s}${r}`:`${a}${"{"===a?" ":""}${s}${"{"===a&&" "!==s.substr(-1)?" ":""}${l}`}}return!Uo&&e.checks&&e.checks.length&&(s+=` ?${e.checks.map((e=>Vo(e))).join(" ?")} `),i&&(s=`${i}\n${f}\n${f}${s}`),s}const li=$(Q(se(W(Z("@[")),Ae,Zt(),Ae,W(Z("]"))),(([,,e])=>e)),{trim:!0,consumeAll:!0}),ui=Q(se(W(Z("-")),_(ce)),(([e,t])=>e?-t:+t)),ci=Q(se(ui,Z("-",":"),ui),(([e,,t])=>[e,t].sort(((e,t)=>e<t?-1:e>t?1:0)))),fi=Q(se(Z("<",">"),Ae,ui),(([e,,t])=>"<"===e?[-1/0,t-1]:[t+1,1/0])),pi=Q(Z("*"),(()=>[-1/0,1/0])),di=Q(se(Z("!"),G(ci,fi,ui)),(([,e])=>({not:e}))),gi=$(oe(G(pi,ci,fi,ui,di),_(" \t\r\n,;"),"allow"),{trim:!0});function hi(...e){return e.filter((e=>e)).join(".")}const yi=(e,t)=>e==t,mi=(e,t)=>e===t,$i=/^[\d.]+$/,vi=/^(true|on|yes)$/i,bi=/^(false|off|no)$/i,xi=(e,t)=>{var n,r;let o,i;return("number"==typeof e||"string"==typeof e&&$i.test(e))&&("number"==typeof t||"string"==typeof t&&$i.test(t))?+e==+t:"boolean"!=typeof e&&"boolean"!=typeof t||"string"!=typeof e&&"string"!=typeof t?(e instanceof Date||"string"==typeof e&&Array.isArray(null===(n=o=yt(e))||void 0===n?void 0:n.f))&&(t instanceof Date||"string"==typeof t&&Array.isArray(null===(r=i=yt(t))||void 0===r?void 0:r.f))?(o=o?Zn(o):e,i=i?Zn(i):t,+o==+i):e==t:vi.test(e)&&vi.test(t)||bi.test(e)&&bi.test(t)},wi=/^\d+$/;function Ai(e,t,n){const r=(null==n?void 0:n.equal)&&"object"==typeof n.equal?n.equal.type:null==n?void 0:n.equal;return ji(e,t,"",{},"function"==typeof r?r:"strict"===r?mi:"sql"===r?xi:yi,"object"==typeof(null==n?void 0:n.equal)?null==n?void 0:n.equal.identity:void 0,(null==n?void 0:n.keys)||"all")}function ji(e,t,n,r,o,i,s){if("object"!=typeof e||"object"!=typeof t)return e===t||(r[n]=[e,t]),r;let a;if(Array.isArray(e)&&Array.isArray(t)&&i&&(a=function(e,t){return e[`${t.split(".").reduce(((e,t)=>wi.test(t)?`${e}[]`:`${e}${e.length?".":""}${t}`),"")}[]`]}(i,n))){const s=e.map((e=>!0===a?e:"string"==typeof a?!e||"object"!=typeof e&&"function"!=typeof e?e:e[a]:a(e))),l=t.map((e=>!0===a?e:"string"==typeof a?!e||"object"!=typeof e&&"function"!=typeof e?e:e[a]:a(e)));for(let a=0;a<s.length;a++){const u=l.indexOf(s[a]);if(~u){const s=e[a],l=t[u];if(s===l)continue;"object"==typeof s&&"object"==typeof l?ji(s,l,hi(n,`${a}`),r,o,i):o(s,l)||(r[hi(n,`${a}`)]=[s,l])}else r[hi(n,`${a}`)]=[e[a],void 0]}const u=s.slice();for(let e=0;e<s.length;e++)~u.indexOf(l[e])||(r[hi(n,`${e+u.length}`)]=[void 0,t[e]])}else{const a=e||{},l=t||{},u=[];if("common"===s)for(const e of Object.keys(a))e in l&&u.push(e);else{u.push.apply(u,Object.keys(a));for(const e of Object.keys(l))~u.indexOf(e)||u.push(e)}for(const e of u){const t=a[e],s=l[e];t!==s&&("object"==typeof t&&"object"==typeof s?ji(t,s,hi(n,e),r,o,i):o(t,s)||(r[hi(n,e)]=[t,s]))}}return r}function ki(e,t,n){return Oi(e,t,"function"==typeof n?n:"strict"===n?mi:"sql"===n?xi:yi)}function Oi(e,t,n){if("object"!=typeof e||"object"!=typeof t)return n(e,t);if(!(e&&t||e==t))return!1;const r=Object.keys(e||{});for(const e of Object.keys(t||{}))~r.indexOf(e)||r.push(e);for(const o of r){const r=e[o],i=t[o];if(r!==i)if("object"==typeof r&&"object"==typeof i){if(!Oi(r,i,n))return!1}else if(!n(r,i))return!1}return!0}function Mi(e,t,n){const r=(null==n?void 0:n.omit)?{}:Object.assign({},e);return Di(e,t,"","",r,n),r}const Yi=/^\d+/;function Di(e,t,n,r,o,i){for(const s in t)if("[]"===s.slice(-2)){const a=`${n}${n&&"."}${s.slice(0,-2)}`,l=Array.isArray(t[s])?t[s]:[t[s]],u=Object.keys(e),c=[];for(const e of u)if(0===e.indexOf(a)&&Yi.test(e.substr(a.length+1))){const t=e.indexOf(".",a.length+1),n=e.substring(a.length+1,~t?t:void 0);~c.indexOf(n)||c.push(n)}const f=`${r}${r&&" "}${l[0]}`;for(const t of c){const n=`${a}${a&&"."}${t}`;n in e&&(o[`${f}${f&&" "}${+t+1}`]=e[n],(null==i?void 0:i.omit)&&delete o[n]),l[1]&&Di(e,l[1],n,`${f}${f&&" "}${+t+1}`,o,i)}}else{const a=`${n}${n&&"."}${s}`;let l=Array.isArray(t[s])?t[s]:[t[s]];const u=`${r}${r&&" "}${l[0]}`;a in e&&(o[u]=e[a],(null==i?void 0:i.omit)&&delete o[a]),l[1]&&Di(e,l[1],a,u,o,i)}}const Xi=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function zi(e){return"object"==typeof e?In(e):!("string"!=typeof e||!Xi.test(e))}function Ci(e){return e&&"object"==typeof e&&"type"in e&&"string"==typeof e.type}function Fi(e,t){const n=Ni(e);if(Array.isArray(e)){const r=[];if(r.push({type:"number",name:"length"}),!t&&e.length>0){const t=Fi(e[0]);t.fields?r.push({type:t.type,fields:t.fields,name:"0"}):r.push({type:t.type,name:"0"})}return{type:n,fields:r}}if("object"==typeof e&&!zi(e)){const r=[];for(const n in e)r.push(Si(n,e[n],t));return{type:n,fields:r}}return{type:n}}function Si(e,t,n){const r=Ni(t);if(!n&&(~r.indexOf("object")||"array"===r)){const n=Fi(t);return n.fields?{type:r,fields:n.fields,name:e}:{type:r,name:e}}return{type:Ni(t),name:e}}function Ni(e){return"string"==typeof e?zi(e)?"date":"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":Array.isArray(e)?e.length<1?"array":"string"==typeof e[0]?zi(e[0])?"date[]":"string[]":"number"==typeof e[0]?"number[]":"boolean"==typeof e[0]?"boolean[]":zi(e[0])?"date[]":"object"==typeof e[0]?"object[]":"array":"object"==typeof e?zi(e)?"date":"object":"any"}function Ti(e,t,n){if("string"==typeof t){const e=li(t);if("message"in e)return[{error:"invalid schema"}];t=e}t||(t={type:"any"});return qi(e,t,n,"",new En(e,{special:{types:t.defs||{}}}))}function qi(e,t,n,r,o,i){let s=t=t||{};const a=[],l="strict"===n||"missing"===n;if(s.ref){let e=s;for(;e&&e.ref;)e=$n(o,`@types.${e.ref}`);e?s=e:l&&a.push({error:`missing type definition '${s.ref}'`,type:"missing"})}let{checks:u}=s;const{type:c,fields:f,rest:p,types:d,literal:g}=s;if(!Hi(e,"array"===t.type?"array":c,g,i))return[{error:`type mismatch for${i?" required":""} ${c}`,actual:ai(Fi(e)),value:e,path:r,expected:ai(s,!0),literal:"literal"===c}];let h;if(s!==t&&t.checks&&(u=u?u.concat(t.checks):t.checks),"tuple"!==c&&"tuple[]"!==c||!d)if("union"!==c&&"union[]"!==c||!d){if(("object"===c||"object[]"===c||"any"===c)&&f||p){const i=~c.indexOf("[]")||"array"===t.type,s=i?e:[e];for(let e=0;e<s.length;e++){const t=s[e],l=i?hi(r,`${e}`):r;if("object"==typeof t||"function"==typeof t){if(f)for(const e of f)e.required&&!(e.name in t)?a.push({error:`required field '${e.name}' is missing`,path:hi(l,e.name),expected:e.type}):t&&e.name in t&&!0!==(h=qi(t[e.name],e,n,hi(l,e.name),Ln(o,{value:t[e.name],path:hi(l,e.name)}),e.required))&&a.push.apply(a,h);if(p&&t)for(const e in t)f&&f.find((t=>t.name===e))||null!=t[e]&&!0!==(h=qi(t[e],p,n,hi(l,e),Ln(o,{value:t[e],path:hi(l,e)})))&&a.push.apply(a,h);else if("strict"===n&&t)for(const e in t)(null==t[e]||f)&&f.find((t=>t.name===e))||a.push({error:`unknown field '${e}'`,path:l,type:"strict",value:t[e]})}else a.push({error:"expected an object",value:t,path:l,actual:ai(Fi(t),!0)})}}}else{const t=~c.indexOf("[]"),i=t?e:[e];for(let e=0;e<i.length;e++){const s=i[e],u=t?hi(r,`${e}`):r;let c,f=!1;for(const e of d){if(!0===(h=qi(s,e,n,u,o))){f=!0;break}l&&h.find((e=>"missing"===e.type))||h.find((e=>"check"===e.type))?h.filter((e=>l&&"missing"===e.type||"check"===e.type)):h.find((e=>e.path!==u))&&(c?(h.length<c.length||c.filter((e=>e.literal)).length>h.filter((e=>e.literal)).length)&&(c=h):c=h)}f||c?!f&&c&&a.push.apply(a,c):a.push({error:"type mismatch for union",actual:ai(Fi(s)),expected:ai({type:"union",types:d}),value:s,path:u})}}else{const t=~c.indexOf("[]"),i=t?e:[e];for(let e=0;e<i.length;e++){const s=i[e],l=t?hi(r,`${e}`):r;if(Array.isArray(s))if(s.length<d.length){const e=d.length-s.length;a.push({error:`missing ${e} field${e>1?"s":""} in tuple`,path:l,expected:ai({type:"tuple",types:d})})}else{for(let e=0;e<d.length;e++)!0!==(h=qi(s[e],d[e],n,hi(l,`${e}`),Ln(o,{value:s[e],path:hi(l,`${e}`)})))&&a.push.apply(a,h);"strict"===n&&s.length>d.length&&a.push({error:"too many values for tuple",type:"strict",path:l,expected:ai({type:"tuple",types:d})})}else a.push({error:"expected a tuple",path:l,value:s})}}if(!a.length&&u&&u.length){let n;for(let i=0;i<u.length;i++){n=wn(o,u[i],[e]),n&&"string"!=typeof n||a.push({error:"string"==typeof n&&n?n:`check ${i+1} failed`,path:r,value:e,type:"check",expected:ai(t,!0)})}}return!a.length||a}const Ui=["string","number","boolean","object"];function Hi(e,t,n,r){switch(t||"any"){case"any":case"union":return!0;case"value":return!Array.isArray(e)&&!!~Ui.indexOf(typeof e)&&("object"!=typeof e||zi(e));case"array":case"tuple":case"union[]":case"tuple[]":return Array.isArray(e);case"literal":return e===n;case"string":return"string"==typeof e;case"number":return"number"==typeof e;case"boolean":return"boolean"==typeof e;case"date":return zi(e);case"object":return!(Array.isArray(e)||"object"!=typeof e||r&&null==e);case"string[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&"string"==typeof t),!0);case"number[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&"number"==typeof t),!0);case"boolean[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&"boolean"==typeof t),!0);case"date[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&zi(t)),!0);case"object[]":return Array.isArray(e)&&e.reduce(((e,t)=>e&&!Array.isArray(t)&&"object"==typeof t&&(!r||null!=t)),!0)}}const Ei={record:"\n",field:",",header:!1,quote:'"'};function Li(e){const t=Object.assign({},Ei,e),n=L(" \t\r\n".replace(t.field,"").replace(t.record,"").replace(t.quote,"")),r=Z(t.quote||'"'),o=ie(se(n,r),Q(te(G(J(t.quote),Q(se(r,r),(()=>"")))),(e=>A(e))),se(r,n)),i=$(re(K(oe(G(o,J(t.record+t.field,!0)),se(n,Z(t.field),n)),(e=>e.length>1||e[0].length>0||"empty record")),Z(t.record),"allow"),{consumeAll:!0});return function(e,n){const r=i(e,n);if(Array.isArray(r)&&r.length>0&&t.header){const e=r.shift().map(((e,t)=>[e,t]));e.sort(((e,t)=>e<t?-1:e>t?1:0));for(let t=0;t<r.length;t++)for(let n=0;n<e.length;n++)r[t][e[n][0]]=r[t][e[n][1]]}return r}}const Pi=[",","|","\t",":",";","~"],_i=["\r\n","\r","\n"],Ri=["'",'"',"`","$"];function Ji(e,t){var n;void 0===t&&(t=null!=(t=e.indexOf("\n",e.indexOf("\n",e.indexOf("\n",1)+1)+1))?t:2048)<2048&&(t=2048);const r=e.slice(0,t);if(null===(n=r.split(/\r?\n/).filter((e=>e))[1])||void 0===n?void 0:n.match(/^[-|+\s_=]+$/))return{table:1,header:!0};const o=Pi.reduce(((e,t)=>(e[t]=r.replace(new RegExp(`[^${t}]`,"g"),"").length/t.length,e)),{}),i=_i.reduce(((e,t)=>(e[t]=r.replace(new RegExp(`[^${t}]`,"g"),"").length/t.length,e)),{}),s=Ri.reduce(((e,t)=>(e[t]=r.replace(new RegExp(`[^${t}]`,"g"),"").length/t.length,e)),{}),a={field:",",record:"\n",quote:'"'};let l=0;for(const e in o)o[e]>l&&(a.field=e,l=o[e]);l=0;for(const e in i)i[e]>l&&(a.record=e,l=i[e]);l=0;for(const e in s)s[e]>l&&(a.quote=e,l=s[e]);return a}function Ii(e,t){var n,r,o;let i;if((s=t)&&"table"in s&&1===s.table)i=function(e){return Object.assign({header:!0},e),function(e,t){const n=e.split(/\r?\n/).filter((e=>e));if("|"===n[1][0])for(let e=0;e<n.length;e++){const t=n[e];n[e]=t.replace(/^\|\s*|\s*\|$/g,"")}return n.map((e=>e.trim().split(/\s*\|\s*/)))}}(t)(e),i.splice(1,1);else{const n=Li(Object.assign({},t,{header:!1}))(e);if("message"in n)return[];i=n}var s;if(null===(n=t.fixedSize)||void 0===n||n){const e=null===(r=i[0])||void 0===r?void 0:r.length;i=i.filter((t=>t.length>=e))}if(t.header&&i.length){const e=i.shift().map(((e,t)=>[e,t]));return(null===(o=t.order)||void 0===o||o)&&e.sort(((e,t)=>{const n=`${e}`.toLowerCase(),r=`${t}`.toLowerCase();return n<r?-1:n>r?1:0})),i.map((t=>e.reduce(((e,n)=>(e[n[0]]=t[n[1]],e)),{})))}return i}const Zi=P(" \r\n\t"),Vi={amp:"&",gt:">",lt:"<"},Wi=Q(se(Z("&"),Z("amp","gt","lt"),Z(";")),(([,e])=>Vi[e]||""),"entity"),Bi=_("abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-_:$","name"),Gi=Q(se(Bi,W(se(Zi,Z("="),Zi,G(Bi,Ki('"'),Ki("'"))))),(([e,t])=>({name:e,value:!t||t[3]})),"attr");function Ki(e){return Q(se(Z(e),J(e),Z(e)),(([,e])=>e))}const Qi=Q(se(Z("<"),Zi,Bi,Zi,re(Gi,Zi,"allow"),W(Z("/")),Z(">")),(([,,e,,t,n])=>({open:!0,name:e,attrs:t,empty:!!n})),"open"),es=Q(se(Z("</"),Zi,Bi,Zi,Z(">")),(([,,e])=>({close:!0,name:e})),"close"),ts=Q(ne(G(I("&<",!0),Wi),"content"),(e=>e.join("").trim())),ns=$(te(G(Qi,ts,es)),{trim:!0,consumeAll:!0,undefinedOnError:!0});function rs(e,t,n){t in e?Array.isArray(e[t])?e[t].push(n):e[t]=[e[t],n]:e[t]=n}function os(e,t){const n=[],r=[],o=[];let i="";const s=ns(e);if(s&&!("error"in s)){for(const e of s)if("string"==typeof e)e&&(i+=e);else if("open"in e){i="";const t=e.attrs.reduce(((e,t)=>(rs(e,t.name,t.value),e)),{});e.empty?n.length?rs(n[n.length-1],e.name,t):o.push(t):(r.push(e.name),n.push(t))}else if("close"in e){if(t&&e.name!==r[r.length-1])return;a(e.name)}return r.length&&!t&&a(r[0]),o.length>1?o:1===o.length?o[0]:void 0}function a(e){const t=n.pop();if(!t)return;const s=r.pop();n.length?Object.keys(t).length?rs(n[n.length-1],s,t):rs(n[n.length-1],s,i||""):o.push(t),e!==s&&a(e)}}function is(e,t){return{type:"value",names:e,apply:t}}const ss={y:[0,12],M:[1,30],d:[2,24]},as={max:1e4};function ls(e,t){let n="";for(let r=0;r<t;r++)n+=e;return n}const us={places:2,"all-numeric":!1,method:"half-even"};function cs(e,t){var n,r;const o=null!==(n=null==t?void 0:t.places)&&void 0!==n?n:us.places,i=null!==(r=null==t?void 0:t.method)&&void 0!==r?r:us.method;if(o>0){let t=(+e||0).toString();const n=t.indexOf(".");if(!~n)return(+t).toFixed(o);let r=t.slice(n+1);if(r.length<=o)return(+t).toFixed(o);t+="0",r+="0";const s=+`${t.slice(o-r.length,o-r.length+1)}`||0,a=parseInt(t.slice(o-r.length)+"0");if("up"===i&&a>0)return+e>0?(+t.slice(0,o-r.length)+ +`0.${ls("0",o-1)}1`).toFixed(o):t.slice(0,o-r.length);if("down"===i&&a>0)return+e<0?(+t.slice(0,o-r.length)-+`0.${ls("0",o-1)}1`).toFixed(o):t.slice(0,o-r.length);if("to-0"===i&&a>0)return t.slice(0,o-r.length);if("from-0"===i&&a>0)return+e<0?(+t.slice(0,o-r.length)-+`0.${ls("0",o-1)}1`).toFixed(o):(+t.slice(0,o-r.length)+ +`0.${ls("0",o-1)}1`).toFixed(o);if(+s<5)return t.slice(0,o-r.length);if(+s>5||+`${t.slice(1+o-r.length)}`)return(+e).toFixed(o);{const e=`${t.slice(0,o-r.length)}`,n=+t.slice(o-r.length-1,o-r.length);return"half-odd"===i?(+`${e}${n%2==0?6:4}`).toFixed(o):"half-up"===i?(+`${e}${+e>0?6:4}`).toFixed(o):"half-down"===i?(+`${e}${+e>0?4:6}`).toFixed(o):"half-to-0"===i?(+`${e}4`).toFixed(o):"half-from-0"===i?(+`${e}6`).toFixed(o):(+`${e}${n%2==0?4:6}`).toFixed(o)}}if(0===o){let t=(+e||0).toString();const n=t.indexOf(".");if(!~n)return t;t=`${t}00`;const r=+t.slice(n-1,n),o=+t.slice(n+1,n+2),s=parseInt(t.slice(n+1)+"0");if("up"===i&&s>0)return+e>0?(+t.slice(0,n)+1).toFixed(0):t.slice(0,n);if("down"===i&&s>0)return+e<0?(+t.slice(0,n)-1).toFixed(0):t.slice(0,n);if("to-0"===i&&s>0)return t.slice(0,n);if("from-0"===i&&s>0){if(+e<0)return(+t.slice(0,n)-1).toFixed(0);if(+e>0)return(+t.slice(0,n)+1).toFixed(0)}if(o<5)return t.slice(0,n);if(o>5||5===o&&+t.slice(n+2))return(+`${t.slice(0,n-1)}0`+(r+1)*(+t<0?-1:1)).toString();{const e=+`${t.slice(0,n-1)}0`;return"half-odd"===i?(e+(r%2==0?r+1:r)*(+t<0?-1:1)).toString():"half-up"===i?(e+(+t>0?r+1:r)*(+t<0?-1:1)).toString():"half-down"===i?(e+(+t<0?r+1:r)*(+t<0?-1:1)).toString():"half-to-0"===i?e.toString():"half-from-0"===i?(e+1).toString():(e+(r%2==0?r:r+1)*(+t<0?-1:1)).toString()}}{let t=`${+e<0?Math.floor(+e||0):Math.ceil(+e||0)}`;if(0-o>t.length&&"up"!==i&&"down"!==i&&"to-0"!==i&&"from-0"!==i)return"0";const n=+t.slice(o,-1===o?void 0:o+1),r=+(t.slice(o)+"0");let s=t.slice(o-1,o);"-"===s&&(s="");const a=`${Math.pow(10,0-o).toString().slice(1)}`;if(s){if("up"===i&&r>0)return+t>0?(+(t.slice(0,o)+ls("0",-1*o))+ +`1${ls("0",-1*o)}`).toFixed(0):t.slice(0,o)+ls("0",-1*o);if("down"===i&&r>0)return+t<0?(+(t.slice(0,o)+ls("0",-1*o))-+`1${ls("0",-1*o)}`).toFixed(0):t.slice(0,o)+ls("0",-1*o);if("to-0"===i&&r>0)return t.slice(0,o)+ls("0",-1*o);if("from-0"===i&&r>0)return+t>0?(+(t.slice(0,o)+ls("0",-1*o))+ +`1${ls("0",-1*o)}`).toFixed(0):(+(t.slice(0,o)+ls("0",-1*o))-+`1${ls("0",-1*o)}`).toFixed(0);if(n<5)return`${t.slice(0,o)}${a}`;if(n>5||o<-1&&+`${t.slice(o+1)}`)return(+`${+t.slice(0,o-1)||0}0${a}`+ +`${+s+1}${a}`*(+t<0?-1:1)).toString();{const e=+`${t.slice(0,o-1)||0}0${a}`;return"half-odd"===i?(e+ +`${+s%2==0?+s+1:+s}${a}`*(+t<0?-1:1)).toString():"half-up"===i?(e+ +`${+t>0?+s+1:+s}${a}`*(+t<0?-1:1)).toString():"half-down"===i?(e+ +`${+t<0?+s+1:+s}${a}`*(+t<0?-1:1)).toString():"half-to-0"===i?(e+ +`${+s}${a}`*(+t<0?-1:1)).toString():"half-from-0"===i?(e+ +`${+s+1}${a}`*(+t<0?-1:1)).toString():(e+ +`${+s%2==0?+s:+s+1}${a}`*(+t<0?-1:1)).toString()}}{const n=`${+t<0?"-":""}1${a}`;return"up"===i?+e>0?n:"0":"down"===i?+e<0?n:"0":"to-0"===i?"0":"from-0"===i?n:+t>0&&+t<5||+t<0&&+t>-5?"0":+t>0&&+t>5||+t<0&&+t<-5||"half-odd"===i?n:"half-up"===i?+t>0?n:"0":"half-down"===i?+t>0?"0":n:"half-to-0"===i?"0":"half-from-0"===i?n:"0"}}}const fs=/^[^\d]*(\d+(?:\.\d*)?)/,ps=/^\s*$/;function ds(e){return!isNaN(e)&&!ps.test(e)}function gs(e){return isNaN(e)||!e?0:+e}function hs(e,t){return e===t||e==t||(In(e)&&In(t)?+Zn(e)==+Zn(t):"number"==typeof e&&"number"==typeof t&&(isNaN(e)&&isNaN(t)))}function ys(e,t,n=.5){const r=$s(e,t,n,0);return r&&r[1]||void 0}function ms(e,t,n=.5,r=2,o=!1){const i=$s(e,t,n,r);return i&&o?(i[2]||0)*((i[0].length/e.length+i[1].length/t.length)/2):i&&i[2]||0}function $s(e,t,n=.5,r=2){if(!e||!t)return;const o=e.toLowerCase(),i=t.toLowerCase();o.indexOf(i),i.indexOf(o);let s=0,a=0,l=0,u=0,c=0,f=0,p=0,d=0,g=0;const h=e.length,y=t.length;let m=0,$=0;for(s=0;s<h;s++)for(a=0;a<y;a++)if(o[s]===i[a]){m=h-s,$=y-a,d=0;e:for(l=1,u=1;l<m&&u<$;){if(o[s+l]!==i[a+u]){for(c=0;c<=r;c++)for(f=0;f<=c;f++)for(p=0;p<=c;p++)if(o[s+l+f]===i[a+u+p]){l+=f,u+=p,d+=Math.max(f,p);continue e}break e}l++,u++}if(g=(Math.max(l,u)-d)/Math.min(o.length,i.length),g>=n)return[o.substr(s,l),i.substr(a,u),g]}}function vs(e,t){let n=!1,r=!1;for(const o of t)Array.isArray(o)&&e>=o[0]&&e<=o[1]?n=!0:"object"==typeof o&&"not"in o?(Array.isArray(o.not)&&e>=o.not[0]&&e<=o.not[1]||e==o.not)&&(r=!0):e==o&&(n=!0);return n&&!r}function bs(e,t,n,r){if("string"!=typeof t&&(t=""+t),!ds(n))return t;"string"!=typeof r&&(r=""+r),r||(r=" "),1!==r.length&&(r=" ");const o=(n-t.length)/2;for(let i=0;t.length<n;i++)"l"===e?t=r+t:"r"===e?t+=r:i<o?t=r+t:t+=r;return t}On(is(["is","is-not","==","!="],((e,t)=>{const[n,r]=t;let o=hs(n,r);return o||"is"!==e&&"is-not"!==e||!Ci(r)||(o=!0===Ti(n,r,"loose")),"is"===e||"=="===e?o:!o})),is(["strict-is","strict-is-not"],((e,t)=>{const[n,r]=t;let o=n===r;return!o&&Ci(r)&&(o=!0===Ti(n,r,"strict")),"strict-is"===e?o:!o})),is(["deep-is","deep-is-not","===","!=="],((e,[t,n,r],o,i)=>{if((r=r||(null==o?void 0:o.equal))&&Tn(r)){const e=r;r=(t,n)=>wn(i,e,[t,n])}const s=ki(t,n,r);return"deep-is"===e||"==="===e?s:!s})),is(["not"],((e,t)=>!t[0])),is(["<",">","<=",">=","gt","gte","lt","lte"],((e,t)=>{"gt"===e?e=">":"lt"===e?e="<":"gte"===e?e=">=":"lte"===e&&(e="<=");let[n,r]=t;return n instanceof Date||r instanceof Date?"number"==typeof n||"number"==typeof r?(n=+n,r=+r):"string"==typeof n||"string"==typeof r?(n=new Date(n),r=new Date(r)):n&&"f"in n&&"o"in n?(n=Jn(n)["<"===e[0]?1:0],r=new Date(r)):r&&"f"in r&&"o"in r&&(r=Jn(r)["<"===e||">="===e?0:1],n=new Date(n)):In(n)?(n=Jn(n)["<"===e[0]?1:0],r=In(r)?Jn(r)["<"===e||">="===e?0:1]:new Date(r)):In(r)&&(r=Jn(r)["<"===e||">="===e?0:1],n=new Date(n)),"<"===e?n<r:">"===e?n>r:"<="===e?n<=r:">="===e&&n>=r})),is(["like","not-like","ilike","not-ilike"],((e,t)=>{const[n,r,o]=t;let i=!1;const s="string"==typeof r?[r]:r,a="free"===o||"object"==typeof o&&o.free;if(!Array.isArray(s))return!1;for(let t=0;t<s.length&&!i;t++){const r=s[t];if("string"!=typeof r)continue;const o=new RegExp(`${a?"":"^"}${r.replace(/[\s\%\*]+/g,"[\\s\\S]*").replace(/\?/g,".")}${a?"":"$"}`,~e.indexOf("ilike")?"i":"");i=Array.isArray(n)?!!n.find((e=>o.test(e))):o.test(n)}return"like"===e||"ilike"===e?i:!i})),is(["in","not-in"],((e,t,n,r)=>{const[o,i]=t;let s;if(In(i)){const t=Jn(i),n=In(o)?Jn(o)[0]:new Date(o),r=n>=t[0]&&n<=t[1];return"in"===e?r:!r}if("string"==typeof o&&"object"==typeof i&&!Array.isArray(i))return o in i;if(Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&!Array.isArray(i)&&i&&"object"==typeof i){const t=Object.keys(i),n=o.reduce(((e,n)=>e&&~t.indexOf(n)),!0);return"in"===e?n:!n}if("string"==typeof i&&ds(o)&&(s=Os(r,i),Array.isArray(s))){const t=vs(+o,s);return"in"===e?t:!t}if(Tn(o)){let t=!1;return Array.isArray(i)||i&&"object"==typeof i&&"0"in i?t=Array.prototype.find.call(i,((e,t)=>wn(r,o,[e,t],{index:t,key:t}))):i&&"object"==typeof i&&(t=Object.entries(i).find(((e,t)=>wn(r,o,[e[1],t,e[0]],{index:t,key:e[0]})))),"in"===e?!!t:!t}if(!Array.isArray(i)&&"string"!=typeof i)return"in"===e?o==i:o!=i;if(Array.isArray(o)&&Array.isArray(i)){const t=o.reduce(((e,t)=>e&&~i.indexOf(t)),!0);return"in"===e?!!t:!t}const a=!!~i.indexOf(o);return"in"===e?a:!a})),is(["contains","does-not-contain"],((e,t,n,r)=>{const[o,i]=t;if(In(o)){const t=Jn(o),n=In(i)?Jn(i)[0]:new Date(i),r=n>=t[0]&&n<=t[1];return"contains"===e?r:!r}if(Tn(i)){let t=!1;return Array.isArray(o)||o&&"object"==typeof o&&"0"in o?t=Array.prototype.find.call(o,((e,t)=>wn(r,i,[e,t],{index:t,key:t}))):i&&"object"==typeof o&&(t=Object.entries(o).find(((e,t)=>wn(r,i,[e[1],t,e[0]],{index:t,key:e[0]})))),"contains"===e?!!t:!t}if(!Array.isArray(o)&&"string"!=typeof o)return!1;if(Array.isArray(i)&&Array.isArray(o)){const t=i.reduce(((e,t)=>e&&~o.indexOf(t)),!0);return"contains"===e?!!t:!t}const s=!!~o.indexOf(i);return"contains"===e?s:!s})),is(["clamp"],((e,[t,n,r])=>n<t?t:n>r?r:n)),is(["get"],((e,t,n,r)=>{const[o,i]=t,s=Ln(r,{value:o});return"string"==typeof(a=i)||"object"==typeof a&&Array.isArray(a.k)?$n(s,i):"number"==typeof i?$n(s,""+i):bn(s,i);var a})),is(["generate"],((e,[t],n,r)=>{let o;if(t&&Tn(t)){const e=[];let o,i=n;for(let n=0;n<as.max;n++)if(o=wn(r,t,[i,o,n],{index:n,last:o,state:i}),Array.isArray(o))o.forEach((t=>e.push(t)));else if(o&&"object"==typeof o){Object.keys(o).find((e=>"value"!==e&&"state"!==e))?e.push(o):(e.push(o.value),i=o.state||i,o=o.value)}else{if(void 0===o)break;e.push(o)}return e}if((o=gi(t))&&Array.isArray(o)){o=o.filter((e=>"number"==typeof e||Array.isArray(e)&&!e.find((e=>e===1/0||e===-1/0))||"object"==typeof e&&!Array.isArray(e)));const e=[],t=[];for(const e of o)"object"!=typeof e||Array.isArray(e)||t.push("number"==typeof e.not?[e.not,e.not]:e.not);for(const n of o){if(e.length>=as.max)break;if("number"!=typeof n||t.find((([e,t])=>n>=e&&n<=t))){if(Array.isArray(n))for(let r=n[0];r<=n[1]&&(t.find((([e,t])=>r>=e&&r<=t))||e.push(r),!(e.length>=as.max));r++);}else e.push(n)}return e}return[]})),is(["array"],((e,t,n)=>{if(1===t.length&&(null==n?void 0:n.range)){let e=t[0];if("string"==typeof e&&(e=gi(e)),Array.isArray(e)){const t=Array.isArray(n.bounds)&&2===n.bounds.length&&2===n.bounds.filter((e=>"number"==typeof e)).length?n.bounds:[-100,200];t.slice().sort(((e,t)=>e<t?-1:e>t?1:0));let[r,o]=t;o-r>1e4&&(r=o-1e4);const i=[];for(let t=r;t<=o;t++)vs(t,e)&&i.push(t);return i}return[]}return t})),is(["object"],((e,t)=>{const n={};for(let e=0;e<t.length;e+=2)n[t[e]]=t[e+1];return n})),is(["split"],((e,[t,n])=>"string"!=typeof t?[t]:t.split(n||""))),is(["filter"],((e,t,n,r)=>{let[o,i,s,a]=t;if(!Array.isArray(o)){if(!o||!Array.isArray(o.value)){if("object"==typeof o&&o){let e=Object.entries(o).filter(((e,t)=>wn(r,i,[e[1],t,e[0]],{index:t,key:e[0]})));return s&&(e=Dn(r,e,s,((e,t,n)=>wn(e,t,[n[1],n[0]],{key:n[0]})))),e.reduce(((e,t)=>(e[t[0]]=t[1],e)),{})}return[]}o=o.value}return Xn({value:o},i,s,a,r).value})),is(["source"],((e,t,n,r)=>{const[o,i]=t;let s=mn(o);return Tn(i)?wn(r,i,[],{source:s}):s})),is(["group"],((e,t,n,r)=>{let[o,i]=t;if(!Array.isArray(o)){if(!o||!Array.isArray(o.value))return{};o=o.value}return Xn({value:o},null,null,i,r).value})),is(["sort"],((e,t,n,r)=>{let[o,i]=t;if(!Array.isArray(o)){if(!o||!Array.isArray(o.value))return o&&"object"==typeof o?(i||(i=[{a:{r:{p:"@",k:["key"]}}}]),Dn(r,Object.entries(o),i,((e,t,n)=>wn(e,t,[n[1],n[0]],{key:n[0]}))).reduce(((e,t)=>(e[t[0]]=t[1],e)),{})):{};o=o.value}return i||(i=[{a:{r:{k:["_"]}}}]),Dn(r,o.slice(),i)})),is(["time-span","time-span-ms"],((e,t,n)=>{const r=n||{},o=In(t[0])&&In(t[1])?function(e,t){if(isNaN(+e)||isNaN(+t))return{d:[]};if(t<e){const n=t;t=e,e=n}const n=new Date(e),r=t,o={d:[0,0,0,0,0,0,0],s:+n};let i,s,a=r.getFullYear()-n.getFullYear()-1;for(a>0&&(o.d[0]+=a,n.setFullYear(r.getFullYear()-1)),n.setFullYear(n.getFullYear()+1),n>r?n.setFullYear(n.getFullYear()-1):o.d[0]++,1===e.getMonth()&&29===e.getDate()&&1!==n.getMonth()&&(n.setDate(29),n.setMonth(1));;){if(a=n.getDate(),i=n.getMonth(),s=n.getFullYear(),n.setDate(a+1),n.getMonth()!==i?(n.setDate(1),n.setFullYear(s),n.setMonth(i+2),n.setDate(0)):(n.setDate(a),n.setMonth(i+1),(11===i?0!==n.getMonth():n.getMonth()!==i+1)&&(n.setDate(1),n.setFullYear(s),n.setMonth(i+2),n.setDate(0))),n>r){n.setFullYear(s),n.setDate(1),n.setMonth(i),n.setDate(a);break}o.d[1]++}for(;;){if(n.setDate(n.getDate()+1),n>r){n.setDate(n.getDate()-1);break}o.d[2]++}for(;;){if(n.setHours(n.getHours()+1),n>r){n.setHours(n.getHours()-1);break}o.d[3]++}for(;;){if(n.setMinutes(n.getMinutes()+1),n>r){n.setMinutes(n.getMinutes()-1);break}o.d[4]++}for(;;){if(n.setSeconds(n.getSeconds()+1),n>r){n.setSeconds(n.getSeconds()-1);break}o.d[5]++}return n.getMilliseconds()<=r.getMilliseconds()?o.d[6]=r.getMilliseconds()-n.getMilliseconds():o.d[6]=1e3-n.getMilliseconds()+r.getMilliseconds(),o}(Zn(t[0]),Zn(t[1])):Wn(t[0])?t[0]:0;if(r.unit){const e=(Array.isArray(r.unit)?r.unit:[r.unit]).map((e=>"y"===e[0]?"y":"M"===e[0]||"m"===e[0]&&"i"!==e[1]&&"m"!==e[1]?"M":"w"===e[0]?"w":"d"===e[0]?"d":"h"===e[0]?"h":"m"!==e[0]||e[1]&&"i"!==e[1]&&"m"!==e[1]?"s"===e[0]?"s":"m"===e[0]&&"s"===e[1]?"l":"":"m")).filter((e=>!!e));let t,n;if("number"!=typeof o&&!De(o)){const r=e.join("");if("d"===r)if(o.s){const e=new Date(o.s);e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);const t=new Date(+e);t.setDate(1),t.setFullYear(t.getFullYear()+o.d[0]),t.setMonth(e.getMonth()+o.d[1]);const r=t.getMonth();t.setDate(e.getDate());const i=new Date(+e),s=i.getMonth();i.setDate(i.getDate()+1),s!==i.getMonth()&&(t.setMonth(t.getMonth()+1),t.setDate(0)),t.getMonth()!==r&&t.setDate(0),t.setDate(t.getDate()+o.d[2]);const a=+t-+e;let l=Math.floor(a/864e5);a%864e5>=828e5&&l++,n=[l]}else n[0]+=365*o.d[0],n[0]+=30*o.d[1];else e.length<4&&("y"===r||"yM"===r||"yMd"===r||"M"===r||"Md"===r||"d"===r)&&(n=e.map((e=>(t=o.d[ss[e][0]+1]/ss[e][1],o.d[ss[e][0]]))),"M"===e[0]&&(n[0]+=12*o.d[0]))}if(!n){let r="number"==typeof o||De(o)?Xe(o):o&&"s"in o?+Bn(new Date(o.s),o,1)-+new Date(o.s):o.d[0]*Ye.y+o.d[1]*Ye.m+o.d[2]*Ye.d+o.d[3]*Ye.h+o.d[4]*Ye.mm+o.d[5]*Ye.s+o.d[6];n=e.map((()=>0));const i={y:"m",M:"w",w:"d",d:"h",h:"mm",m:"s"},s={y:12,M:4.3,w:7,d:24,h:60,m:60};for(let o=0;o<n.length;o++){const a="m"===e[o]?"mm":"M"===e[o]?"m":e[o];if("l"===a){n[o]=r,t=0;break}n[o]=Math.floor(r/Ye[a]),r-=n[o]*Ye[a],i[e[o]]?t=r/Ye[i[e[o]]]/s[e[o]]:"s"===e[o]&&(t=r%1e3)}}if(!0===r.round?t>=.5&&n[n.length-1]++:"c"===(r.round||"")[0]&&(t>0&&n[n.length-1]++,"y"===e[0]&&"M"===e[1]&&2===e.length&&12===n[1]&&(n[0]++,n[1]=0)),r.string){const t={y:"year",M:"month",w:"week",d:"day",h:"hour",m:"minute",s:"second",l:"millisecond"};let r="";for(let o=0;o<e.length;o++)n[o]&&(r+=`${r.length?" ":""}${n[o]} ${t[e[o]]}${n[o]>1?"s":""}`);return r}return Array.isArray(r.unit)?n:n[0]}if(!r.string)return o;if("number"!=typeof o&&!De(o)){let e="";const t=["year","month","day","hour","minute","second","millisecond"];for(let n=0;n<o.d.length;n++)o.d[n]&&(e+=`${e.length?" ":""}${o.d[n]} ${t[n]}${o.d[n]>1?"s":""}`);return e}{let e=Xe(o),t="";const n=["w","d","h","mm","s"],r=["week","day","hour","minute","second","millisecond"];for(let o=0;o<n.length;o++)if(e>Ye[n[o]]){const i=Math.floor(e/Ye[n[o]]);e-=Ye[n[o]]*i,t+=`${t.length?" ":""}${i} ${r[o]}${i>1?"s":""}`}e&&(t+=`${t.length?" ":""}${e} millisecond${e>1?"s":""}`)}})),is(["string","unparse"],((e,t,n)=>{const[r]=t;if((n=n||t[1]||{})&&"object"==typeof n||(n={}),"unparse"===e&&(n=Object.assign({},n,{raport:1})),n.raport&&n.tpl&&(n.template=1),!n&&null==r)return"";if("object"==typeof n){if(n.json)return JSON.stringify(r);if(n.schema)return ai(r);if(n.base64)return btoa(r);if(n.raport){let e=Io(r,n);return void 0===e&&(e=Io({v:r},n)),e}if("string"==typeof r&&n.styled)return uo(r);if(null==r)return""}if(Array.isArray(r))return r.join(", ");let o=`${r}`;return"[object"===o.slice(0,7)?JSON.stringify(r):o})),is(["log"],((e,t,n,r)=>{try{r.root.log(t)}catch(e){console.error(e),console.log(...t)}})),is(["call"],((e,t,n,r)=>{if(null!=t[0]&&"string"==typeof t[1]&&"function"==typeof t[0][t[1]]){const e=t.shift();return e[t.shift()].apply(e,t)}if("function"==typeof t[0]){return t.shift().apply(null,t)}if(Un(t[0]))return wn(r,t[0],t.slice(1))})),is(["intersect"],((e,[t,n])=>{if(!Array.isArray(t)||!Array.isArray(n))return[];const r=[];let o;for(let e=0;e<t.length;e++)o=t[e],~n.indexOf(o)&&!~r.indexOf(o)&&r.push(o);for(let e=0;e<n.length;e++)o=n[e],!~r.indexOf(o)&&~t.indexOf(o)&&r.push(o);return r})),is(["let"],((e,[t,n],r,o)=>vn(o,t,n,!0))),is(["set"],((e,[t,n],r,o)=>vn(o,t,n))),is(["similarity"],((e,[t,n,r,o])=>ms(`${t||""}`,`${n||""}`,r,o))),is(["similar"],((e,[t,n,r,o])=>$s(`${t||""}`,`${n||""}`,r,o))),is(["overlap"],((e,[t,n,r])=>ys(`${t||""}`,`${n||""}`,r))),is(["validate","valid"],((e,[t,n,r],o)=>{const i=Ti(t,n,r||(null==o?void 0:o.mode)||(null==o?void 0:o.strict)&&"strict");return"valid"===e?!0===i:i})),is(["inspect"],((e,[t,n],r)=>"schema"===(n||(null==r?void 0:r.mode))?ai(Fi(t,null==r?void 0:r.flat)):Fi(t))),is(["diff"],((e,[t,n,r],o,i)=>{if((r=r||(null==o?void 0:o.equal))&&Tn(r)){const e=r;r=(t,n)=>wn(i,e,[t,n])}return Ai(t,n,{equal:r,keys:null==o?void 0:o.keys})})),is(["label-diff"],((e,[t,n],r)=>Mi(t,n,r))),is(["patch"],((e,t,n)=>{const r=(null==n?void 0:n.dir)||"forward",o=null==n?void 0:n.strict,i=JSON.parse(JSON.stringify(t.shift()||{})),s=new En(i);if("backward"===r){const e=t.slice().reverse();if(o)for(const t of e)for(const e in t)$n(s,e)==t[e][1]&&vn(s,e,t[e][0]);else for(const t of e)for(const e in t)vn(s,e,t[e][0])}else if(o)for(const e of t)for(const t in e)$n(s,t)==e[t][0]&&vn(s,t,e[t][1]);else for(const e of t)for(const t in e)vn(s,t,e[t][1]);return i}))),On(is(["+","add"],((e,t,n,r)=>{var o;if(1===t.length)return In(t[0])?+Zn(t[0]):t[0]?parseFloat(t[0]):0;if(Array.isArray(t[0]))return t[0].concat.apply(t[0],t.slice(1));if(In(t[0])&&t.length>1&&t.slice(1).reduce(((e,t)=>e&&Wn(t)),!0))return t.slice(1).reduce(((e,t)=>Bn(e,t,1)),Zn(t[0]));if("number"!=typeof t[0]&&t.length>1&&Wn(t[0]))return t.slice(1).reduce(((e,t)=>function(e,t){if("number"==typeof e&&"number"==typeof t)return e+t;{const n={d:[]};if("number"==typeof e)n.d[6]=e;else if(De(e))n.d[6]=e.ms;else for(let t=0;t<7;t++)e.d[t]&&(n.d[t]=e.d[t]);if("number"==typeof t)n.d[6]=(n.d[6]||0)+t;else if(De(t))n.d[6]=(n.d[6]||0)+t.ms;else for(let e=0;e<7;e++)t.d[e]&&(n.d[e]=(n.d[e]||0)+t.d[e]);return n}}(e,t)),t[0]);if(t.reduce(((e,t)=>e&&"object"==typeof t&&!In(t)),!0))return Object.assign.apply(Object,[{}].concat(t));return t.reduce(((e,t)=>e&&ds(t)),!0)?(null===(o=r.special)||void 0===o?void 0:o.round)?+t.reduce(((e,t)=>+cs(e+ +t,r.special.round)),0):t.reduce(((e,t)=>e+ +t),0):t.reduce(((e,t)=>e+(null==t?"":t)),"")})),is(["cat"],((e,t)=>t.reduce(((e,t)=>e+(null==t?"":t)),""))),is(["num"],((e,[t])=>{let n;return(n=fs.exec(t))?+n[1]:parseInt(t)})),is(["-","subtract"],((e,t,n,r)=>{var o;const i=t.shift();if(!t.length)return-i;if(In(i)){if(t.reduce(((e,t)=>e&&In(t)),!0))return t.reduce(((e,t)=>e-+Zn(t)),+Zn(i));if(t.reduce(((e,t)=>e&&Wn(t)),!0))return t.reduce(((e,t)=>Bn(e,t,-1)),Zn(i))}return(null===(o=r.special)||void 0===o?void 0:o.round)?t.reduce(((e,t)=>+cs(e-(ds(t)?+t:0),r.special.round)),ds(i)?+i:0):t.reduce(((e,t)=>e-(ds(t)?+t:0)),ds(i)?+i:0)})),is(["*","multiply"],((e,t,n,r)=>{const o=t.shift();if(!ds(o)){if(1===t.length&&ds(t[0])&&+t[0]>0){if("string"==typeof o)return ls(o,+t[0]);if(Array.isArray(o)&&+t[0]<1e4&&o.length<1e3){const e=[];for(let n=0;n<t[0];n++)e.push.apply(e,o);return e}}return 0}return r.special.round?t.reduce(((e,t)=>+cs(e*(ds(t)?+t:0),r.special.round)),+o):t.reduce(((e,t)=>e*(ds(t)?+t:0)),+o)})),is(["/","/%","divide","intdiv"],((e,t,n,r)=>{var o;const i=t.shift();return isNaN(i)?0:e.length>1||"intdiv"===e?t.reduce(((e,t)=>Math.floor(e/(isNaN(t)?1:+t))),+i):(null===(o=r.special)||void 0===o?void 0:o.round)?t.reduce(((e,t)=>+cs(e/(isNaN(t)?1:+t),r.special.round)),+i):t.reduce(((e,t)=>e/(isNaN(t)?1:+t)),+i)})),is(["%","modulus"],((e,t)=>{const n=t.shift();return t.reduce(((e,t)=>e%(isNaN(t)?1:+t)),isNaN(n)?0:+n)})),is(["pow","**"],((e,t,n,r)=>{var o;const i=t.pop(),s=Math.pow(t.pop(),i);return(null===(o=r.special)||void 0===o?void 0:o.round)?t.reverse().reduce(((e,t)=>+cs(Math.pow(t,e),r.special.round)),s):t.reverse().reduce(((e,t)=>Math.pow(t,e)),s)})),is(["abs"],((e,t)=>"number"!=typeof t[0]?t[0]:Math.abs(t[0]))),is(["round"],((e,[t,n,r],o)=>{if(void 0!==(n=null!=n?n:null==o?void 0:o.places)||us["all-numeric"]){const e=cs(t,{places:n,method:r||(null==o?void 0:o.method)});return(null==o?void 0:o.string)?e:+e}return Math.round(t)})),is(["floor"],((e,t)=>Math.floor(t[0]))),is(["ceil"],((e,t)=>Math.ceil(t[0]))),is(["rand","random"],((e,t)=>{if(!t.length||"number"==typeof t[0]){const[e,n,r]=t;let o;return null==e?Math.random():("number"!=typeof n?o=Math.random()*e:"number"==typeof n&&(o=Math.random()*(n-e)+e),!0===n||!0===r?o:Math.round(o))}if(Array.isArray(t[0])){const e=t[0];return e[Math.floor(Math.random()*e.length)]}if("string"==typeof t[0]&&"number"==typeof t[1]){let e="";const[n,r]=t;for(let t=0;t<r;t++)e+=n[Math.floor(Math.random()*n.length)];return e}})));const xs=/^\s*/,ws=/\s*$/,As=/([\.\[\]\{\}\(\)\^\$\*\+\-])/g;function js(e,t=1){let n=e||[];const r="number"!=typeof t?1:t;for(let e=0;e<r;e++){if(!n.find((e=>Array.isArray(e))))return n;n=[].concat(...n)}return n}function ks(e,t){if("string"==typeof e){const t=yt(e);t&&(e=t)}return jo(In(e)?Vn(e):e,t)}function Os(e,t){const n=e.root._ranges||(e.root._ranges={});return t in n?n[t]:n[t]=gi(t)}function Ms(e,t,n,r){if(Array.isArray(t)){if(0===t.length)return e;if(2===t.length){const[n,o]=t;if(Array.isArray(n))for(const t of n)r?t in e?e[t].push(o):e[t]=[o]:e[t]=o;else r?n in e?e[n].push(o):e[n]=[o]:e[n]=o}}else if("object"==typeof t){const o=t;if("many"in o&&Array.isArray(o.many))for(const t of o.many)Ms(e,t,n,r);else("key"in o||"keys"in o)&&Ms(e,[o.key||o.keys,o.value||n],n,r)}else r?t in e?e[t].push(n):e[t]=[n]:e[t]=n;return e}On(is(["eval"],((e,[t],n,r)=>(null==n?void 0:n.template)?xn((null==n?void 0:n.context)||r,t):bn((null==n?void 0:n.context)||r,t))),is(["padl","padr","pad"],((e,t)=>{let[n,r,o]=t;return bs("padl"===e?"l":"padr"===e?"r":"c",n,r,o)})),is(["trim","triml","trimr"],((e,t)=>{let[n]=t;return n=""+n,"trim"!==e&&"trimr"!==e||(n=n.replace(ws,"")),"trim"!==e&&"triml"!==e||(n=n.replace(xs,"")),n})),is(["slice","substr"],((e,[t,n,r],o,i)=>{if(t&&"function"==typeof t.slice)return t.slice(n,r);{const e=Mn("string");if(e)return`${e.apply("string",[t],void 0,i)}`.slice(n,r)}})),is(["len","length"],((e,[t])=>"string"==typeof t||Array.isArray(t)?t.length:"object"==typeof t&&1===Object.keys(t).length&&Array.isArray(t.value)?t.value.length:"object"==typeof t?Object.keys(t).length:0)),is(["replace","replace-all"],((e,[t,n,r,o])=>{t=`${t}`;const i="string"==typeof o;return"replace-all"===e||i?t.replace(new RegExp(i?n:n.replace(As,"\\$1"),("replace"===e||o&&~o.indexOf("g")?o:`${o||""}g`)||"g"),r):t.replace(n,r)})),is(["reverse"],((e,[t])=>{if("string"==typeof t){let e="";for(let n=0;n<t.length;n++)e=t[n]+e;return e}if(Array.isArray(t))return t.slice().reverse()})),is(["wrap-count"],((e,[t,n,r],o,i)=>{var s;let a=n||(null==o?void 0:o.width);const l=$n(i,"@placement.availableX")||48;if(null===(s=i.special)||void 0===s?void 0:s.widget){const e=i.special.widget.width;e&&("grow"===e?a=l:"number"==typeof e?a=e:"object"==typeof e&&"number"==typeof e.percent?a=e.percent/100*l:"object"==typeof e&&"string"==typeof e.x&&(a=bn(i,e.x)))}if(a||(a=l),r=r||(null==o?void 0:o.font)||$n(i,"@widget.font"),o){r=Object.assign({},r);for(const e of["family","size","line","metric","break-word"])e in o&&(r[e]=o[e])}return fr(t,a,{context:i},r)})),is(["keys"],((e,[t,n])=>{if(!t)return[];if(n){const e=[];for(const n in t)e.push(n);return e}return Object.keys(t)})),is(["values"],((e,[t])=>t?Object.values(t):[])),is(["date"],((e,t,n,r)=>{let o,[i,s]=t;if("object"==typeof n&&n||(n={}),void 0!==i){if(In(i))o=Zn(i);else if("string"==typeof i){let e=yt(i);if(In(e))o=e;else if(e||(e=new Date(i)),isNaN(e)){let e=bn(r,~i.indexOf("#")?i:`#${i}#`);In(e)&&(o=n.rel||n.parse?e:Zn(e))}}o||(o=new Date(i))}else o=new Date;if((n.rel||n.parse)&&In(o)){let e=Vn(o);if("string"==typeof s&&(s=ut(s)),Array.isArray(s)){const t=e.f;t[3]=s[0],t[4]=s[1],t[5]=s[2],t[6]=s[3],s=s[4]}if("number"==typeof s){if(n.shift){const t=(+e.f[7]||0)-s,n=Zn(e);n.setMinutes(n.getMinutes()-t),e=Vn(n)}e.f[7]=s,o=e}}else{const e=In(o)?Zn(o):o;"y"in n&&!isNaN(n.y)&&e.setFullYear(n.y);const t=e.getFullYear();"m"in n&&!isNaN(n.m)&&(e.setMonth(+n.m-1),n.clamp&&e.getFullYear()!==t&&(e.setFullYear(t),e.setMonth(11)));const r=e.getMonth();if("d"in n&&!isNaN(n.d)&&(e.setDate(n.d),!n.clamp||e.getMonth()===r&&e.getFullYear()===t||(e.setDate(1),e.setFullYear(t),e.setMonth(r+1),e.setDate(0))),s){if(o===i)if("string"==typeof i){const e=yt(i);o=e&&In(e)?Zn(e):new Date(i)}else o=new Date(i);if("string"==typeof s&&(s=ut(s)),Array.isArray(s)){if(e.setHours(s[0]||0,s[1]||0,s[2]||0,s[3]||0),null!=s[4]){const t=-e.getTimezoneOffset()-s[4];e.setMinutes(e.getMinutes()+t)}}else if("number"==typeof s){const t=-e.getTimezoneOffset()-s;e.setMinutes(e.getMinutes()+t)}}o=e}if(!(o instanceof Date&&isNaN(+o)))return o})),is(["interval"],((e,[t],n,r)=>bn(r,~t.indexOf("#")?t:`#${t}#`))),is(["upper","lower"],((e,[t])=>(t=null==t?"":t,"upper"===e?`${t}`.toUpperCase():`${t}`.toLowerCase()))),is(["format","fmt"],((e,t,n,r)=>{let[o,i,...s]=t;const a=Pn[i];if(a)return a.apply(o,s,n||a.defaults);{let e=Mn(i);if(!e){const t=$n(r,i)||$n(r.root,i);Tn(t)&&(e=t)}if(e){return Fn(r,{op:i,args:[o,...s].map((e=>Tn(e)?e:{v:e})),opts:{v:n||_n[i]}})}return`${o}`}})),is(["set-defaults"],((e,[t,n],r,o)=>{if("format"===t&&"string"==typeof n){const e=Pn[n];if(e)return Object.assign(e.defaults,r);const t=_n[n];if(t)return Object.assign(t.defaults,r)}else"round"===t?(null==r?void 0:r.context)?(null==r?void 0:r.unset)?o.special&&delete o.special.round:(o.special||(o.special={})).round=Object.assign({},r,{context:void 0}):Object.assign(us,r):"generate"===t&&Object.assign(as,r)})),is(["parse"],((e,t,n)=>{(n=n||t[1]||{})&&"object"==typeof n||(n={});const[r]=t;return n.date?yt(r,n):n.template||n.tpl?yn(r,n):n.time?ut(r,n):n.expr?Jt(r,n):n.json?JSON.parse(r):n.schema?li(r):n.range?gi(r,n):n.xml?os(r,n.strict):n.csv||n.delimited?(!n.detect&&(n.field||n.separator||n.record||n.quote)||(n=Object.assign(Ji(r,n.context),n)),Ii(r,n)):n.base64?atob(r):It(r,n)})),is(["detect-delimiters"],((e,[t,n],r)=>"string"!=typeof t?{}:Ji(t,null!=n?n:null==r?void 0:r.context)))),On({type:"checked",names:["and","&&"],checkArg:(e,t,n,r)=>r?"continue":{result:r},apply:(e,t)=>t[t.length-1]},{type:"checked",names:["or","||","??"],checkArg:(e,t,n,r)=>("??"===e?null!=r:r)?{result:r}:"continue",apply:e=>"??"===e&&void 0},{type:"checked",names:["if","unless"],checkArg:(e,t,n,r)=>t%2==0?t===n?{result:r}:("if"===e?!r:r)?{skip:1}:"continue":{result:r},apply(){}},{type:"checked",names:["case","switch"],checkArg(e,t,n,r,o,i,s){if(0===t)return(i.special||(i.special={})).case=r,"continue";if(t%2==1){if(t===n)return{result:r};if(hs(r,i.special.case))return"continue";if(Un(s)&&"op"in s&&!0===r)return"continue";if(Un(r)){const e=jn(i,r);if(hs(e,i.special.case))return"continue";if(!0===e)return"continue"}return{skip:1}}return{result:r}},apply(){},extend:!0},{type:"checked",names:["each"],checkArg:(e,t,n,r)=>0===t?Array.isArray(r)&&r.length||r&&"object"==typeof r&&Object.keys(r).length?"continue":{skip:1}:1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply(e,[t,n],r,o){if(Array.isArray(t)){const e=t.length-1;return t.map(((t,r)=>wn(Ln(o,{value:t,special:{last:e,index:r,key:r,"last-key":e}}),n,[t,r]))).join((null==r?void 0:r.join)||"")}if("object"==typeof t&&t){const e=Object.entries(t),r=e[e.length-1][0],i=e.length-1;return Object.entries(t).map((([e,t],s)=>wn(Ln(o,{value:t,special:{last:i,"last-key":r,index:s,key:e}}),n,[t,e]))).join("")}return""}},{type:"checked",names:["with"],checkArg:(e,t,n,r)=>0===t&&r&&"object"==typeof r?"continue":1===t?{skip:n-t,value:r}:t===n?{result:r}:t%2==0?r?"continue":{skip:1}:{result:r},apply:(e,[t,n],r,o)=>wn(Ln(o,{value:t}),n,[t])},{type:"checked",names:["coalesce","coalesce-truth"],checkArg:(e,t,n,r)=>"coalesce"===e&&null!=r||r?{result:r}:"continue",apply(){}}),On({type:"aggregate",names:["avg"],apply(e,t,n,r,o){var i;return(null===(i=o.special)||void 0===i?void 0:i.round)?+cs(t.reduce(((e,t)=>+cs(e+gs(n[0]?wn(o,n[0],[t]):t))),0)/t.length):t.reduce(((e,t)=>e+gs(n[0]?wn(o,n[0],[t]):t)),0)/t.length}},{type:"aggregate",names:["sum"],apply(e,t,n,r,o){var i;return(null===(i=o.special)||void 0===i?void 0:i.round)?t.reduce(((e,t)=>+cs(e+gs(n[0]?wn(o,n[0],[t]):t))),0):t.reduce(((e,t)=>e+gs(n[0]?wn(o,n[0],[t]):t)),0)}},{type:"aggregate",names:["count"],apply:(e,t,n,r,o)=>n.length?t.filter(((e,t)=>wn(o,n[0],[e,t]))).length:t.length},{type:"aggregate",names:["min","max"],apply:(e,t,n,r,o)=>(Tn(n[0])?t=t.map((e=>wn(o,n[0],[e]))):n.length&&!t.length&&(t=n.map((e=>An(o,e)))),t.length?Math[e].apply(Math,t.filter((e=>!isNaN(e)))):0)},{type:"aggregate",names:["first","nth","last"],apply(e,t,n,r,o){let i,s=0;if("first"===e)i=t[0];else if("last"===e)i=t[t.length-1];else if(n[0]){const e=An(o,n[0]);"number"==typeof e&&(i=e<0?t[t.length+e]:t[e-1],s=1)}return n[s]&&(i=An(o,n[s])),i}},{type:"aggregate",names:["map"],apply(e,t,n,r,o){if(!n[0])return t;let i,s;if(Tn(n[0])?(i=t,s=An(o,n[0])):Tn(n[1])&&(i=An(o,n[0]),s=An(o,n[1])),(Array.isArray(i)||i&&"0"in i)&&Tn(s)){const e=Array.prototype.map.call(i,((e,t)=>wn(o,s,[e,t],{index:t,key:t})));return r&&r.flat?js(e,r.flat):e}if(i&&"object"==typeof i&&Tn(s)){if(r&&r.array){const e=Object.entries(i).map(((e,t)=>wn(o,s,[e[1],t,e[0]],{index:t,key:e[0]})));return r&&r.flat?js(e,r.flat):e}if(r&&r.entries)return Object.entries(i).reduce(((e,t,n)=>{const r=wn(o,s,[t[1],n,t[0]],{index:n,key:t[0]});return null===r||(Array.isArray(r)&&2===r.length&&"string"==typeof r[0]?e.push(r):e.push([t[0],r])),e}),[]);const e={};return Object.entries(i).forEach(((t,n)=>{const r=wn(o,s,[t[1],n,t[0]],{index:n,key:t[0]});if(Array.isArray(r)&&2===r.length&&"string"==typeof r[0])e[r[0]]=r[1];else{if(null==r)return;e[t[0]]=r}})),e}}},{type:"aggregate",names:["index"],apply(e,t,n,r,o){if(!n[0])return{};const i=r&&r.many;return t.reduce(((e,t,r)=>Ms(e,wn(o,n[0],[t,r],{index:r,all:e}),t,i)),{})}},{type:"aggregate",names:["reduce"],apply:(e,t,n,r,o)=>n[0]?t.reduce(((e,t,r)=>wn(o,n[0],[e,t,r])),An(o,n[1])):t},{type:"aggregate",names:["unique","unique-map"],apply(e,t,n,r,o){const i=[],s=[];for(const e of t){const t=n[0]?wn(o,n[0],[e]):e;~i.indexOf(t)||(i.push(t),s.push(e))}return"unique"===e?s:i}},{type:"aggregate",names:["join"],apply:(e,t,n,r,o)=>(Tn(n[0])&&(t=t.map((e=>wn(o,n[0],[e]))),n=n.slice(1)),n.length>1&&t.length>2?[t.slice(0,-1).join(An(o,n[0])),t[t.length-1]].join(An(o,n[1])):n.length>2&&2===t.length?t.join(An(o,n[2])):t.join(An(o,n[0])))},{type:"aggregate",names:["find"],apply(e,t,n,r,o){if(n[0]){if(Tn(n[0]))return t.find(((e,t)=>wn(o,n[0],[e,t],{index:t,key:t})));if(!Tn(n[1])){const e=An(o,n[0]);return t.find((t=>t==e))}{const e=An(o,n[0]);if(Array.isArray(e))return e.find(((e,t)=>wn(o,n[1],[e,t],{index:t,key:t})));if("object"==typeof e&&e){const t=Object.entries(e).find(((e,t)=>wn(o,n[1],[e[1],t,e[0]],{index:t,key:e[0]})));if(t)return t[1]}}}}},{type:"aggregate",names:["flatten"],apply:(e,t,n,r,o)=>js(t,(n.length>0?An(o,n[0]):0)||(null==r?void 0:r.flat))},{type:"aggregate",names:["block"],apply(e,t,n,r,o){const i=n.length-1;if(i<0)return;const s=Ln(o,{locals:r&&r.implicit&&o.locals||{},fork:!o.locals});for(let e=0;e<i;e++)An(s,n[e]);const a=An(s,n[i]);return r&&r.implicit&&(o.locals=s.locals),a},value:!0}),Rn("dollar",(function(e,[t,n,r,o],i){var s,a,l,u;return function(e,t,n=2,r=",",o="$",i="sign"){return null!=e&&$o.test(e)?isNaN(+e)?void 0!==t?t:e:`${o}${vo(e,n,r,i)}`:void 0!==t?t:e}(e,void 0,null!==(s=null!=t?t:null==i?void 0:i.dec)&&void 0!==s?s:this.defaults.dec,null!==(a=null!=n?n:null==i?void 0:i.group)&&void 0!==a?a:this.defaults.group,null!==(l=null!=r?r:null==i?void 0:i.sign)&&void 0!==l?l:this.defaults.sign,null!==(u=null!=o?o:null==i?void 0:i.neg)&&void 0!==u?u:this.defaults.neg)}),{dec:2,group:",",sign:"$",neg:"sign"}),Rn("date",(function(e,[t],n){var r;return ks(e,null!==(r=null!=t?t:null==n?void 0:n.format)&&void 0!==r?r:this.defaults.format)}),{format:"yyyy-MM-dd"}),Rn("time",(function(e,[t],n){var r;return ks(e,null!==(r=null!=t?t:null==n?void 0:n.format)&&void 0!==r?r:this.defaults.format)}),{format:"HH:mm:ss"}),Rn("timestamp",(function(e,[t],n){var r;return ks(e,null!==(r=null!=t?t:null==n?void 0:n.format)&&void 0!==r?r:this.defaults.format)}),{format:"yyyy-MM-dd HH:mm:ss"}),Rn("timestamptz",(function(e,[t],n){var r;return ks(e,null!==(r=null!=t?t:null==n?void 0:n.format)&&void 0!==r?r:this.defaults.format)}),{format:"yyyy-MM-dd HH:mm:sszzz"}),Rn("iso8601",(e=>ks(e,"yyyy-MM-ddTHH:mm:sszzz"))),Rn(["integer","int"],(function(e,[t,n],r){var o,i;return vo(e,0,null!==(o=null!=t?t:null==r?void 0:r.group)&&void 0!==o?o:this.defaults.group,null!==(i=null!=n?n:null==r?void 0:r.neg)&&void 0!==i?i:this.defaults.neg)}),{group:",",neg:"sign"}),Rn(["number","num"],(function(e,[t,n,r],o){var i,s,a;return vo(e,null!==(i=null!=t?t:null==o?void 0:o.dec)&&void 0!==i?i:this.defaults.dev,null!==(s=null!=n?n:null==o?void 0:o.group)&&void 0!==s?s:this.defaults.group,null!==(a=null!=r?r:null==o?void 0:o.neg)&&void 0!==a?a:this.defaults.neg)}),{dec:2,group:",",neg:"sign"}),Rn("ordinal",(function(e,[t],n){var r;return ko(e,null!==(r=null!=t?t:null==n?void 0:n.group)&&void 0!==r?r:this.defaults.group)}),{group:","}),Rn("phone",(e=>{return(t=e)||(t=""),"string"!=typeof t&&(t=t.toString()),7===(t=(t=t||"").replace(/[^\d]/g,"")).length?`${t.substr(0,3)}-${t.substr(3,4)}`:10===t.length?`(${t.substr(0,3)}) ${t.substr(3,3)}-${t.substr(6,4)}`:11===t.length?`${t[0]}-${t.substr(1,3)}-${t.substr(4,3)}-${t.substr(7,4)}`:t;var t})),Rn("styled",(e=>uo(e)));{const Ds=/\s+/g,Xs=/[\s;,.:"]\w/g,zs=/[^a-zA-Z0-9]+([a-zA-Z0-9])/g,Cs=/[^\sa-zA-Z0-9]/g,Fs=/([a-z])([A-Z])/g,Ss=/\s([^\s])/g;function Ns(e){return e.replace(zs,((e,t)=>t?` ${t}`:"")).replace(Cs,"").replace(Fs,((e,t,n)=>`${t} ${n}`)).trim()}Rn("case",((e,t)=>{let n=`${e||""}`.trim();for(const e of t)if("upper"===e||"up"===e)n=n.toUpperCase();else if("lower"===e||"down"===e)n=n.toLowerCase();else if("snake"===e)n=Ns(n).toLowerCase().replace(Ds,"_");else if("kebab"===e)n=Ns(n).toLowerCase().replace(Ds,"-");else if("pascal"===e){const e=Ns(n);n=e[0].toUpperCase()+e.toLowerCase().substr(1).replace(Ss,((e,t)=>(t||"").toUpperCase()))}else if("camel"===e){const e=Ns(n);n=e[0].toLowerCase()+e.toLowerCase().substr(1).replace(Ss,((e,t)=>(t||"").toUpperCase()))}else"proper"===e&&(n=/[a-z]/.test(n)?n.trim().replace(Xs,(e=>e.toUpperCase())):n.toLowerCase().trim().replace(Xs,(e=>e.toUpperCase())),n=(n[0]||"").toUpperCase()+n.substr(1));return n}))}function Ys(e,t,n,r){return Array.isArray(e)?e.reduce(((e,o)=>{const i=Ys(o,t+1,n,r),s=""===i||void 0===i?`<${r} />`:`<${r}>${i}${n&&/\n/.test(i)?"\n"+bs("l","",t*n," "):""}</${r}>`;return`${e}${n&&t?"\n"+bs("l","",t*n," "):""}${s}`}),""):e&&"object"==typeof e?Object.entries(e).reduce(((e,[r,o])=>{const i=Ys(o,t+(Array.isArray(o)?0:1),n,r);return`${e}${""===i?`${n&&t?"\n"+bs("l","",t*n," "):""}<${r} />`:Array.isArray(o)?i:`${n&&t?"\n"+bs("l","",t*n," "):""}<${r}>${i}${n&&/\n/.test(i)?"\n"+bs("l","",t*n," "):""}</${r}>`}`}),""):or(e)}Rn("hex",(e=>{if("number"==typeof e)return e.toString(16);{const t=`${e}`,n=new TextEncoder;return Array.from(n.encode(t)).map((e=>e.toString(16).padStart(2,"0"))).join("")}})),Rn("base",((e,[t])=>{try{return e.toString(t)}catch(t){return e}})),Rn("noxml",(e=>or(`${e}`))),Rn("xml",((e,[t])=>e&&"object"==typeof e?function(e,t){if(Array.isArray(e))return Ys({values:{value:e}},0,t);const n=Object.keys(e);return n.length>1?Ys({root:e},0,t):n.length<1?"<root />":Array.isArray(e[n[0]])?Ys({root:e},0,t):Ys(e,0,t)}(e,t):e)),Rn("base64",(e=>btoa(`${e}`))),e.CSV_DEFAULTS=Ei,e.PageSizes={letter:{width:51,height:66,margin:[1.5,1.5]},legal:{width:51,height:84,margin:[1.5,1.5]},tabloid:{width:66,height:102,margin:[1.5,1.5]},a4:{width:49.606302,height:70.15746,margin:[1.5,1.5]}},e.Root=En,e.applySource=function(e,t,n){let r=n[t.source||t.name]||{value:[]};t.base&&(r={value:bn(Ln(e,{value:r.value,special:{source:r}}),t.base)}),t.filter||t.sort||t.group?e.sources[t.name||t.source]=Xn(r,t.filter,t.sort,t.group,e):e.sources[t.name||t.source]=mn(r)},e.applySources=Xr,e.checkType=Hi,e.deepEqual=ki,e.detectCSV=Ji,e.diff=Ai,e.evalApply=wn,e.evalParse=An,e.evalValue=jn,e.evaluate=bn,e.extend=Ln,e.filter=Xn,e.getOperator=Mn,e.getOperatorMap=function(){return Object.assign({},kn)},e.initParameters=Dr,e.inspect=Fi,e.isComputed=Qn,e.isValueOrExpr=qn,e.join=function(e,t){return{parent:e,root:e.root,path:e.path?`${e.path}.${t}`:t,value:$n(e,t)}},e.labelDiff=Mi,e.overlap=ys,e.parse=It,e.parseCSV=Li,e.parseDate=yt,e.parsePath=tt,e.parseRange=gi,e.parseSchema=li,e.parseTemplate=yn,e.parseTime=ut,e.parseXML=os,e.registerFormat=Rn,e.registerLayout=gr,e.registerOperator=On,e.registerRenderer=sr,e.run=function(e,t,n,r){const o=n&&"root"in n&&n.root===n?n:new En(Object.assign({},e.context),{parameters:n});if(e.sources&&Xr(o,e.sources,t),o.parameters=Object.assign({},Dr(e,t),o.parameters),e.extraContext){const t=bn(o,e.extraContext);t&&"object"==typeof t&&(o.value=Object.assign(o.value,t))}return"delimited"===e.type?zr(e,o,{table:null==r?void 0:r.table}):(null==r?void 0:r.delimited)?function(e,t,n){var r;const[o]=Cr({type:"container",widgets:e.widgets},"repeater",!0);if(o&&"string"==typeof(null===(r=null==o?void 0:o.source)||void 0===r?void 0:r.source)){let e,r;const i=o.row.context;if(o.header){e=Cr(o.header,"label").map((e=>"string"==typeof e.text?It(e.text):e.text))}r=Cr(o.row,"label").map((e=>e.text));const s="_tmp";if("object"==typeof o.source){const e=o.source;let n;if("source"in e){const r=e;let o=t.sources[r.source]||{value:[]};r.base&&(o={value:bn(Ln(t,{value:o.value,special:{source:o}}),r.base)}),(r.filter||r.sort||r.group)&&(o=Xn(o,r.filter,r.sort,r.group,t)),n=mn(o)}else n=mn(bn(t,e));t.sources._tmp=n}return zr(Object.assign({type:"delimited",headers:e,fields:r,source:s,rowContext:i},n),t,(null==n?void 0:n.table)?{table:!0}:{})}return""}(e,o,r):"flow"===e.type?function(e,t,n){const r={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}};let o,i,s="",a=0,l=null;e.width?o=e.width:e.size&&(o="portrait"!==e.orientation?e.size.height:e.size.width);null!=e.margin&&(i=xr(e,r,{x:0,y:0,availableX:o,maxX:o}));!i&&e.size&&e.size.margin&&(i=xr(e.size,r,{x:0,y:0,availableX:o,maxX:o}));i||(i=[0,0,0,0]);o&&(o-=(i[1]||0)+(i[3]||0));function u(e,t){let n;s+=`<div${kr(r,t?[t]:[],["position:absolute;right:0rem;left:0rem;"+(o?`width:${o}rem;`:""),""],`top:${a}rem;`,"p")}>\n`;let i=0;do{if(n=pr(e,r,{x:0,y:i,availableX:o,maxX:o},l),"string"==typeof n)throw new Error("Container widget didn't specify used height");s+=n.output,i+=n.height,l=n.continue?n.continue:null}while(null!==l);a+=i,s+="</div>\n"}e.watermark&&u(e.watermark,"watermark");let c=a||0;a=0;for(const t of e.widgets||[])u(t,"main");a>c&&(c=a);a=0,e.overlay&&u(e.overlay,"overlay");a>c&&(c=a);return`<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${o?` width: ${o}rem;`:""}; height: ${c}rem; position: relative; }\n    .page-back { ${o?`width: ${o}rem; `:"width: 100%; box-sizing: border-box; "}padding: ${i[0]||0}rem ${i[1]||0}rem ${i[2]||0}rem ${i[3]||0}rem; position: absolute; left: 0; top: 0; }\n    #wrapper { height:${c}rem; position: relative; ${e.font?Yr(e.font,r):""} }\n    .watermark { z-index: 0; }\n    .main { z-index: 5; }\n    .overlay { z-index: 10; }\n    @media screen {\n      body { margin: 1rem${o?" auto":""}; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${i[0]}rem ${i[1]}rem ${i[2]}rem ${i[3]}rem !important; }\n    }${Object.entries(r.styles).map((([e,t])=>t)).join("\n")}${Object.entries(r.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n<div class=page-back><div id=wrapper>${s}</div></div>${n&&n.foot||""}</body></html>`}(e,o,r):function(e,t,n){var r,o,i,s,a,l,u;let c="portrait"!==e.orientation?{width:e.size.height,height:e.size.width,margin:[e.size.margin[1],e.size.margin[0]]}:e.size;const f={context:t,report:e,styles:{},styleMap:{ids:{},styles:{}}},p=xr(e,f,{x:0,y:0});t.special=t.special||{},t.special.page=0,t.special.pages=0;const d=[""];let g=0;const h=c.width-2*c.margin[1],y=c.height-2*c.margin[0];let m=y-p[0]-p[2];const $=m;let v=m,b=0;const x=h-p[1]-p[3];let w=null,A=0;if(e.header){A=pr(e.header,f,{x:0,y:0,availableX:x,availableY:m,maxX:x,maxY:v}).height,(null===(r=e.header)||void 0===r?void 0:r.outer)||(m-=A,v-=A,b+=A)}let j=0;if(e.footer){j=pr(e.footer,f,{x:0,y:0,availableX:x,availableY:m,maxX:x,maxY:v}).height,(null===(o=e.footer)||void 0===o?void 0:o.outer)||(m-=j,v-=j)}for(let n of e.widgets||[]){let r;n.macro&&(n=Ar(n.macro,n,f,{x:0,y:0,availableX:x,availableY:m,maxX:x,maxY:v},w));do{t.special.page=g+1,r=pr(n,f,{x:0,y:b,availableX:x,availableY:m,maxX:x,maxY:v},w),d[g]+=r.output,r.continue?(g++,d[g]="",b=(null===(i=e.header)||void 0===i?void 0:i.outer)?0:A,m=y-((null===(s=e.header)||void 0===s?void 0:s.outer)?0:A)-((null===(a=e.footer)||void 0===a?void 0:a.outer)?0:j)-p[0]-p[2],w=r.continue):(b+=r.height,m-=r.height,w=null)}while(null!==w)}t.special.pages=d.length;const k=(null===(l=e.footer)||void 0===l?void 0:l.outer)?{x:0,y:y-j,maxX:h,maxY:y}:{x:0+p[3],y:y-p[0]-j,maxX:h-p[3]-p[1],maxY:y-p[0]-p[2]},O=(null===(u=e.header)||void 0===u?void 0:u.outer)?{x:0,y:0,maxX:h,maxY:y}:{x:0+p[3],y:p[0],maxX:h-p[3]-p[1],maxY:y-p[0]-p[2]};return t.special.size={x:x,y:$},d.forEach(((n,r)=>{let o=`<div class="page-back pb${r}"><div${kr(f,["page",`ps${r}`],["",""],"","p")}>\n`;if(t.special.page=r+1,e.watermark){o+=pr(e.watermark,f,{x:0,y:0,maxX:h,availableX:h,maxY:y,availableY:y}).output+"\n"}if(e.header){o+=pr(e.header,f,O).output+"\n"}if(o+=`<div class="page-inner">${n}</div>`,e.footer){o+=pr(e.footer,f,k).output+"\n"}if(e.overlay){o+=pr(e.overlay,f,{x:0,y:0,maxX:h,availableX:h,maxY:y,availableY:y}).output+"\n"}o+="\n</div></div>",d[r]=o})),`<html style="font-size:100%;margin:0;padding:0;"><head><style>\n    .page { width: ${h}rem; height: ${y}rem; position: absolute; overflow: hidden; left: ${c.margin[1]}rem; top: ${c.margin[0]}rem; ${e.font?Yr(e.font,f):""} }\n    .page-inner { position: absolute; width: ${h-p[1]-p[3]}rem; height: ${y-p[0]-p[2]}rem; left: ${p[3]}rem; top: ${p[0]}rem; }\n    .page-back { width: ${c.width}rem; height: ${c.height}rem; }\n    body { font-size: 0.83rem; }\n    @media screen {\n      html { min-width: ${c.width+2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { margin: 0; padding: 0; ${c?`width:${c.width}rem;`:""}background-color: none; display: block; height: ${d.length*c.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${d.map(((e,t)=>`.pb${t} { top: ${t*c.height}rem; }`)).join("")}\n    }\n    @page {\n      size: ${c.width}em ${c.height}em;\n    }${Object.entries(f.styles).map((([e,t])=>t)).join("\n")}${Object.entries(f.styleMap.styles).map((([e,t])=>`.${t} { ${e} }`)).join("\n")}\n  </style>${n&&n.head||""}</head><body>\n${d.reduce(((e,t)=>e+t),"")}${n&&n.foot||""}</body></html>`}(e,o,r)},e.safeGet=$n,e.similar=$s,e.similarity=ms,e.stringify=Io,e.styled=uo,e.template=xn,e.toDataSet=mn,e.unparseSchema=ai,e.unregisterFormat=function(e){delete Pn[e]},e.unregisterOperator=function(...e){for(const t of e)for(const e of t.names)delete kn[e]},e.validate=Ti,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=raport.umd.min.js.map
