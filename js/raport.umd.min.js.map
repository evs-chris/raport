{"version":3,"file":"raport.umd.min.js","sources":["../node_modules/sprunge/src/base.ts","../node_modules/sprunge/src/search.ts","../node_modules/sprunge/src/parsers/char.ts","../node_modules/sprunge/src/parsers/str.ts","../node_modules/sprunge/src/parsers/base.ts","../node_modules/sprunge/src/parsers/rep.ts","../node_modules/sprunge/src/parsers/seq.ts","../node_modules/sprunge/src/json.ts","../src/lib/data/parse.ts","../src/lib/data/parse/template.ts","../src/lib/data/index.ts","../src/lib/render/error.ts","../src/lib/render/index.ts","../src/lib/render/style.ts","../src/lib/report.ts","../src/lib/data/parse/style.ts","../src/lib/render/builtins.ts","../src/lib/data/format.ts","../src/lib/data/parse/stringify.ts","../src/lib/data/parse/schema.ts","../src/lib/data/parse/range.ts","../src/lib/data/diff.ts","../src/lib/data/schema.ts","../src/lib/data/csv.ts","../src/lib/data/parse/xml.ts","../src/lib/data/builtins.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,"import { parser as makeParser, Parser, bracket, opt, alt, seq, str, istr, map, read, chars, repsep, rep1sep, read1To, read1, skip1, rep, rep1, check, verify, name, not, nop, readTo, unwrap, andNot } from 'sprunge/lib';\nimport { ws, digits, JNum, JStringEscape, JStringUnicode, JStringHex, JString } from 'sprunge/lib/json';\nimport { Value, DateRel, DateRelToDate, DateRelRange, DateRelSpan, DateExactRange, Literal, Keypath, TimeSpan, Operation, TimeSpanMS, Schema, Field, TypeMap, ValueWithAnchor } from './index';\n\nexport const timespans = {\n  y: 0,\n  m: 0,\n  w: 0,\n  d: 86400000,\n  h: 3600000,\n  mm: 60000,\n  s: 1000,\n};\n\ntimespans.w = timespans.d * 7;\ntimespans.y = Math.floor(timespans.d * 365.25);\ntimespans.m = Math.floor(timespans.d * 30.45);\n\nexport function isTimespanMS(v: any): v is TimeSpanMS {\n  return typeof v === 'object' && v && typeof v.ms === 'number';\n}\n\nexport function timeSpanToNumber(v: TimeSpan): number {\n  if (typeof v === 'number') return v;\n  else if (isTimespanMS(v)) return v.ms;\n  else return ((((((((((((v.d[0] || 0) * 12) + (v.d[1] || 0)) * 30.45) + (v.d[2] || 0)) * 24) + (v.d[3] || 0)) * 60) + (v.d[4] || 0)) * 60) + (v.d[5] || 0)) * 1000) + (v.d[6] || 0);\n}\n\nconst space = ' \\r\\n\\t';\nconst endSym = space + '():{}[]<>,\"\\'`\\\\;&#';\nexport const endRef = endSym + '.+/*|^%=!?';\n\nconst _comment = map(seq(ws, str('//'), opt(str(' ')), readTo('\\n'), str('\\n')), ([, , , c]) => ({ c }), { name: 'comment', primary: true });\nfunction comment<T extends any>(prop: string, p: Parser<T>): Parser<T> {\n  return map(seq(rep(_comment), ws, p), ([c, , v]) => {\n    if (c && c.length) v[prop] = c.map(c => c.c);\n    return v;\n  });\n}\n\nexport const rws = skip1(space, 'required-space');\n\nexport const keywords = map<string, any>(str('null', 'true', 'false', 'undefined'), v => {\n  switch (v) {\n    case 'null': return null;\n    case 'true': return true;\n    case 'false': return false;\n    case 'undefined': return undefined;\n  }\n}, { primary: true, name: 'primitive' });\n\nexport const ident = read1To(endRef, true);\nexport const sexprop = read1To(' \\r\\n\\t():{}[],\"\\'\\\\;&#@', true);\n\nexport const args: Parser<[Value[], Value]> = {};\nexport const array: Parser<Value> = {};\nexport const block: Parser<Value> = {};\nexport const object: Parser<Value> = {};\nexport const value: Parser<Value> = {};\nexport const values: Parser<Value> = {};\nexport const tpl: Parser<Value> = {};\nexport const application: Parser<Value> = {};\nexport const inlineTemplate: Parser<Value> = {};\n\nconst escmap: { [k: string]: string } = { n: '\\n', r: '\\r', t: '\\t', b: '\\b' };\nconst pathesc = map(seq(str('\\\\'), chars(1)), ([, char]) => escmap[char] || char);\nconst pathident = map(rep1(alt('ref-part', read1To(endRef, true), pathesc)), parts => parts.join(''), 'keypath-part');\nconst dotpath = map(seq(str('.'), pathident), ([, part]) => part);\nconst valueAnchor = map(seq(value, ws, opt(str('<')), ws, opt(seq(value, ws, opt(str('<'))))), ([v, , a, , s]) => {\n  if (a) (v as ValueWithAnchor).anchor = 'end';\n  if (s) {\n    const r = v as ValueWithAnchor;\n    r.slice = s[0];\n    if (s[2]) r.slice.anchor = 'end';\n  }\n  return v\n});\nconst bracketpath = bracket(seq(str('['), ws), valueAnchor, seq(ws, str(']')));\nexport const keypath = map(seq(alt<'!'|'~'|'*'|[string,string]>('ref-sigil', str('!', '~', '*') as any, seq(read('^'), opt(str('@', '.')))), alt<string|Value>('keypath', pathident, bracketpath), rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([prefix, init, parts]) => {\n  const res: Keypath = { k: [init].concat(parts).map(p => typeof p === 'object' && 'v' in p && (typeof p.v === 'string' || typeof p.v === 'number') && !('anchor' in p) && !('slice' in p) ? p.v : p) };\n  if (Array.isArray(prefix)) {\n    if (prefix[0]) res.u = prefix[0].length;\n    if (prefix[1] === '@') res.p = '@';\n  } else if (prefix) {\n    res.p = prefix;\n  }\n  return res;\n}, 'keypath');\nexport const localpath = map(seq(read('^'), pathident, rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([prefix, init, parts]) => {\n  const res: Keypath = { k: ([init] as Array<string|Value>).concat(parts).map(p => typeof p === 'object' && 'v' in p && (typeof p.v === 'string' || typeof p.v === 'number' && !('anchor' in p) && !('slice' in p)) ? p.v : p) };\n  if (prefix) res.u = prefix.length;\n  return res;\n}, 'localpath');\n\nexport const parsePath = makeParser(keypath);\nexport const parseLetPath = makeParser(localpath);\n\nconst illegalRefs = ['if', 'else', 'elif', 'elseif', 'elsif', 'fi', 'esac', 'unless', 'then', 'case', 'when', 'not', 'gte', 'gt', 'lte', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain', 'is-not', 'is', 'strict-is-not', 'strict-is', 'deep-is-not', 'deep-is', 'and', 'or', 'end', 'with', 'each'];\nexport const ref = map(keypath, (r, err) => {\n  if (r.k.length === 1 && !r.p && !r.u && illegalRefs.includes(r.k[0] as string)) err(`invalid reference name '${r.k[0] as string}'`);\n  return { r };\n}, { primary: true, name: 'reference' });\n\nfunction stringInterp(parts: Value[], q?: string): Value {\n  const res = parts.reduce((a, c) => {\n    if (a.length) {\n      if ('v' in c && 'v' in a[a.length - 1] && typeof c.v === 'string' && typeof (a[a.length - 1] as Literal).v === 'string') (a[a.length - 1] as Literal).v += c.v;\n      else a.push(c);\n    } else {\n      a.push(c);\n    }\n    return a;\n  }, [] as Value[]);\n\n  if (res.length > 0 && (!('v' in res[0]) || typeof res[0].v !== 'string')) res.unshift({ v: '' });\n\n  if (res.length === 0) return { v: '' };\n  else if (res.length === 1) return res[0];\n  return { op: '+', args: res, meta: q ? { q } : undefined };\n}\n\nconst timespan = map(rep1sep(seq(JNum, ws, istr('years', 'year', 'y', 'months', 'month', 'minutes', 'minute', 'milliseconds', 'millisecond', 'mm', 'ms', 'm', 'weeks', 'week', 'w', 'days', 'day', 'd', 'hours', 'hour', 'h', 'seconds', 'second', 's')), ws), parts => {\n  const span = { y: 0, m: 0, d: 0, h: 0, mm: 0, s: 0, ms: 0 };\n  for (let i = 0; i < parts.length; i++) {\n    if (parts[i][2][0] === 'y') span.y += parts[i][0];\n    else if (parts[i][2] === 'm' || parts[i][2] === 'months' || parts[i][2] === 'month') span.m += parts[i][0];\n    else if (parts[i][2][0] === 'd') span.d += parts[i][0];\n    else if (parts[i][2][0] === 'w') span.d += parts[i][0] * 7;\n    else if (parts[i][2][0] === 'h') span.h += parts[i][0];\n    else if (parts[i][2][0] === 's') span.s += parts[i][0];\n    else if (parts[i][2] === 'mm' || parts[i][2] === 'minutes' || parts[i][2] === 'minute') span.mm += parts[i][0];\n    else if (parts[i][2] === 'ms' || parts[i][2] === 'milliseconds' || parts[i][2] === 'millisecond') span.ms += parts[i][0];\n  }\n\n  if (!span.y && !span.m && !span.d) {\n    delete span.y; delete span.m; delete span.d;\n    let n = 0;\n    for (const k in span) n += span[k] * (timespans[k] || 1);\n    return { ms: n };\n  } else {\n    const s: [number?, number?, number?, number?, number?, number?, number?] = [];\n    if (span.y) s[0] = span.y;\n    if (span.m) s[1] = span.m;\n    if (span.d) s[2] = span.d;\n    if (span.h) s[3] = span.h;\n    if (span.mm) s[4] = span.mm;\n    if (span.s) s[5] = span.s;\n    if (span.ms) s[6] = span.ms;\n    return { d: s };\n  }\n}, { primary: true, name: 'timespan' });\n\nexport const timezone = map(seq(ws, alt<string|[string, string, [string, string]]>('timezone',\n  istr('z'),\n  seq(opt(chars(1, '+-')), alt(chars(4, digits), chars(2, digits), chars(1, digits)),\n    opt(seq(str(':'), chars(2, digits)))\n  )\n)), v => {\n  if (v[1][0] === 'z') return 0;\n  else {\n    let res: number;\n    if (v[1][1].length === 4) {\n      res = +v[1][1].substr(0, 2) * 60 + +v[1][1].substr(2, 2);\n    } else {\n      res = +v[1][1] * 60;\n      if (v[1][2]) res += +v[1][2][1];\n    }\n    if (v[1][0] === '-') res *= -1;\n    return res;\n  }\n});\n\nexport const timeexact = alt<[number, number?, number?, number?]>(\n  map(seq(\n    read1(digits),\n    opt(seq(\n      str(':'), chars(2, digits), opt(\n        seq(str(':'), chars(2, digits), opt(\n          seq(str('.'), chars(3, digits))\n        ))\n      )\n    ))\n  ), v => {\n    const h = v[0];\n    const m = v[1] && v[1][1];\n    const s = m && v[1][2] && v[1][2][1];\n    const ms = s && v[1][2][2] && v[1][2][2][1];\n    const res: [number, number?, number?, number?] = [+h];\n    if (m) res[1] = +m;\n    if (s) res[2] = +s;\n    if (ms) res[3] = +ms;\n    return res;\n  }),\n  map(istr('start', 'midnight'), () => [0, 0, 0, 0]),\n  map(istr('noon', 'mid'), () => [12, 0, 0, 0]),\n  map(istr('end'), () => [23, 59, 59, 999]),\n);\n\nexport const parseTime = makeParser(alt<number|[number, number?, number?, number?]>(map(seq(timeexact, opt(seq(ws, timezone))), ([tm, z]) => {\n  if (z) tm.push(z[1]);\n  return tm;\n}), timezone), { trim: true, consumeAll: true, undefinedOnError: true });\n\nconst dateend = opt(seq(ws, str('>')));\nconst daterel = alt<DateRel>('date',\n  map(seq(opt(istr('last', 'this', 'next')), rws, istr('week', 'month', 'year'), opt(timezone), dateend), ([o, , f, tz, e]) => {\n    const val: DateRelRange = { f: f[0] === 'w' ? 'w' : f[0] === 'm' ? 'm' : 'y', o: o === 'last' ? -1 : o === 'next' ? 1 : 0, e: e ? 1 : undefined };\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('week', 'month', 'year'), seq(rws, istr('to'), rws, istr('date')), opt(timezone), dateend), ([f, , tz, e]) => {\n    const val: DateRelToDate = { f: f[0] === 'w' ? 'w' : f[0] === 'm' ? 'm' : 'y', o: 0, d: 1, e: e ? 1 : undefined };\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('yesterday', 'today', 'tomorrow'), alt<any>(bracket(ws, istr('at'), ws), rws), timeexact, ws, opt(timezone)), v => {\n    const res: DateRel = { f: 'd', o: v[0] === 'yesterday' ? -1 : v[0] === 'today' ? 0 : 1, t: v[2] };\n    if (v[4] != null) res.t[4] = v[4];\n    return res;\n  }),\n  map(seq(istr('yesterday', 'today', 'tomorrow', 'now'), opt(timezone), dateend), ([v, tz, e]) => {\n    const val: DateRel = (v === 'now' ? { f: 'n', o: 0 } : { f: 'd', o: v === 'yesterday' ? -1 : v === 'today' ? 0 : 1, e: e ? 1 : undefined });\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('in'), rws, timespan), v => (typeof v[2] === 'number' || isTimespanMS(v[2]) ? { f: 'n', o: timeSpanToNumber(v[2]) } : { f: 'n', o: v[2].d })),\n  map(seq(timespan, rws, alt<string|any[]>('relative time anchor', istr('ago'), seq(istr('from'), rws, istr('now'))), opt(timezone)), ([span, , ref, tz]) => {\n    let val: DateRelSpan;\n    if (typeof span === 'number' || isTimespanMS(span)) {\n      val = { f: 'n', o: timeSpanToNumber(span) * (ref === 'ago' ? -1 : 1) };\n    } else {\n      val = { f: 'n', o: span.d, d: ref === 'ago' ? -1 : undefined };\n    }\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n);\n\nfunction setIndex<T, U = Array<T>>(array: U, index: number, value: T): U {\n  if (value == null) return array;\n  array[index] = value;\n  return array;\n}\nexport const dateexact: Parser<Date|DateRel> = map(seq(\n  chars(4, digits),\n  opt(seq(chars(1, '-/'), read1(digits),\n    opt(seq(chars(1, '-/'), read1(digits)))\n  )),\n  opt(seq(\n    alt(bracket(rws, istr('at'), rws), istr('t'), rws), timeexact\n  )),\n  opt(timezone),\n  dateend,\n), v => {\n  const y = v[0];\n  const m = v[1] && v[1][1];\n  const d = m && v[1][2] && v[1][2][1];\n  const time = v[2] && v[2][1];\n  const tz = v[3];\n  const e = v[4] ? 1 : undefined;\n  if (!m) return { f: setIndex([+y], 7, tz), e };\n  else if (!d) return { f: setIndex([+y, +m - 1], 7, tz), e };\n  else if (!time) return { f: setIndex([+y, +m - 1, +d], 7, tz), e }\n  else {\n    const res: DateExactRange = { f: [+y, +m - 1, +d], e };\n    for (let i = 0; i < time.length; i++) {\n      if (time[i] != null) res.f[i + 3] = time[i];\n    }\n    if (tz != null) res.f[7] = tz;\n    return res;\n  }\n});\n\nexport const date = bracket(str('#'), alt<Date|DateRel|TimeSpan>('date', dateexact, daterel, timespan), str('#'), { primary: true, name: 'date' });\n\nexport const typelit = map(seq(str('@['), ws, schema(), ws, str(']')), ([, , v]) => ({ v, s: 1 } as Value), { name: 'typelit', primary: true });\n\nexport const parseDate = makeParser(map(seq(opt(str('#')), alt<Date|DateRel|TimeSpan>('date', dateexact, daterel, timespan), opt(str('#'))), ([, d,]) => d), { trim: true, consumeAll: true, undefinedOnError: true });\n\nexport const string = alt<Value>({ primary: true, name: 'string' },\n  bracket(str('$$$'), inlineTemplate, str('$$$')),\n  map(seq(str(':'), read1To(endSym, true)), v => ({ v: v[1]})),\n  map(bracket(str('\"\"\"'), rep(alt<string>('string-part',\n    read1To('\\\\\"'), JStringEscape, JStringUnicode, JStringHex, andNot(str('\"'), str('\"\"')),\n  )), str('\"\"\"')), a => ({ v: ''.concat(...a), q: '\"\"\"' })),\n  map(bracket(str('\"'), rep(alt<string>('string-part',\n    read1To('\\\\\"'), JStringEscape, JStringUnicode, JStringHex\n  )), str('\"')), a => ({ v: ''.concat(...a) })), \n  map(bracket(str(`'''`), rep(alt('string-part',\n    map(read1To(`'\\\\$\\{`, true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${', '{'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n    map(andNot(str(`'`), str(`''`)), v => ({ v })),\n  )), str(`'''`)), v => stringInterp(v, \"'''\")),\n  map(bracket(str(`'`), rep(alt('string-part',\n    map(read1To(`'\\\\$\\{`, true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${', '{'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n  )), str(`'`)), v => stringInterp(v)),\n  map(bracket(str('```'), rep(alt('string-part',\n    map(read1To('`\\\\${', true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n    map(andNot(str('`'), str('``')), v => ({ v })),\n  )), str('```')), v => stringInterp(v, '```')),\n  map(bracket(str('`'), rep(alt('string-part',\n    map(read1To('`\\\\${', true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n  )), str('`')), v => stringInterp(v)),\n);\nexport const literal = map(alt('literal', map(JNum, v => v, { primary: true, name: 'number' }), keywords, date), v => {\n  if (v instanceof Date || v == null || typeof v !== 'object') return { v };\n  else return v;\n});\n\nexport const sexp = map(bracket(\n  check(str('('), ws),\n  seq(sexprop, ws, args),\n  check(ws, str(')')),\n), ([op, , args]) => {\n  const res: Value = { op };\n  if (args[0] && args[0].length) res.args = args[0];\n  if (args[1]) res.opts = args[1];\n  return res;\n}, { primary: true, name: 's-expression' });\n\nfunction fmt_op(parser: Parser<Value>): Parser<Value> {\n  return map(seq(parser, rep(seq(str('#'), ident, opt(alt<[Value[], Value]>(\n    map(seq(str(','), rep1sep(value, str(','), 'allow')), ([, value]) => [value, undefined]),\n    bracket_op(args),\n  ))), { primary: true, name: 'format-op' })), ([value, fmt]) => {\n    if (!fmt || !fmt.length) return value;\n    return fmt.reduce((a, c) => c[2] ?\n      { op: 'fmt', args: [a, { v: c[1] }, ...(c[2][0] || [])], opts: c[2][1] } :\n      { op: 'fmt', args: [a, { v: c[1] }] }, value);\n  }, 'fmt-op');\n}\n\nfunction bracket_op<T>(parser: Parser<T>): Parser<T> {\n  return bracket(seq(str('('), ws), parser, seq(ws, str(')')));\n}\n\nexport const binop: Parser<Value> = {};\nexport const if_op: Parser<Value> = {};\nexport const case_op: Parser<Value> = {};\n\nconst opName = read1('abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789');\nconst call_op = map(seq(name(opName, 'op'), bracket_op(args)), ([op, args]) => {\n  const res: Value = { op };\n  if (args[0] && args[0].length) res.args = args[0];\n  if (args[1]) res.opts = args[1];\n  return res;\n}, { primary: true, name: 'call' });\n\nexport const operand: Parser<Value> = fmt_op(postfix_path(alt('operand', bracket_op(application), bracket_op(if_op), bracket_op(case_op), verify(bracket_op(binop), v => 'op' in v || `expected bracketed op`), sexp, values)));\nexport const unop = map(seq(str('not ', '+', '-'), operand), ([op, arg]) => ({ op: op === 'not ' ? 'not' : op, args: [arg] }), 'unary op');\n\nfunction leftassoc(left: Value, [, op, , right]: [string, string, string, Value]) {\n  return { op, args: [left, right] };\n}\n\nfunction rightassoc(left: Value, more: Array<[string, string, string, Value]>) {\n  if (more.length === 1) return { op: more[0][1], args: [left, more[0][3]] };\n  const end = more.pop();\n  let op = more[more.length - 1][1];\n  const first = { op: end[1], args: [more.pop()[3], end[3]] }\n  const right = more.reverse().reduce((a, c) => {\n    const res = { op, args: [c[3], a] };\n    op = c[1];\n    return res;\n  }, first);\n  return { op, args: [left, right] };\n}\n\nexport const binop_e = map(seq(operand, rep(alt(\n  seq(nop, name(str('**'), 'exp op'), nop, operand),\n  seq(rws, name(str('**'), 'exp op'), rws, operand),\n))), ([arg1, more]) => more.length ? rightassoc(arg1, more) : arg1, 'exp-op');\nexport const binop_md = map(seq(binop_e, rep(alt(\n  seq(nop, name(str('*', '/%', '/', '%'), 'muldiv-op'), nop, binop_e),\n  seq(rws, name(str('*', '/%', '/', '%'), 'muldiv-op'), rws, binop_e),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'muldiv-op');\nexport const binop_as = map(seq(binop_md, rep(alt(\n  seq(nop, name(str('+', '-'), 'addsub-op'), nop, binop_md),\n  seq(rws, name(str('+', '-'), 'addsub-op'), rws, binop_md),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'addsub-op');\nexport const binop_cmp = map(seq(binop_as, rep(alt(\n  seq(nop, name(str('>=', '>', '<=', '<'), 'cmp-op'), nop, binop_as),\n  seq(rws, name(str('>=', '>', '<=', '<', 'gte', 'gt', 'lte', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain'), 'cmp-op'), rws, binop_as),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'cmp-op');\nexport const binop_eq = map(seq(binop_cmp, rep(alt(\n  seq(nop, name(str('===', '==', '!==', '!='), 'eq-op'), nop, binop_cmp),\n  seq(rws, name(str('===', '==', '!==', '!=', 'is-not', 'is', 'strict-is-not', 'strict-is', 'deep-is-not', 'deep-is'), 'eq-op'), rws, binop_cmp),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'eq-op');\nexport const binop_and = map(seq(binop_eq, rep(alt(\n  seq(nop, name(str('&&'), 'and-op'), nop, binop_eq),\n  seq(rws, name(str('and', '&&'), 'and-op'), rws, binop_eq),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'and-op');\nexport const binop_or = map(seq(binop_and, rep(alt(\n  seq(nop, name(str('||', '??'), 'or-op'), nop, binop_and),\n  seq(rws, name(str('or', '||', '??'), 'or-op'), rws, binop_and),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'or-op');\nbinop.parser = map(binop_or, v => v, { primary: true, name: 'binary-op' });\n\nif_op.parser = alt({ primary: true, name: 'conditional' },\n  map(seq(str('if'), rws, value, rws, block, rep(seq(ws, str('else if', 'elseif', 'elsif', 'elif'), rws, value, rws, block)), opt(seq(ws, str('else'), rws, block))), ([,, cond1,, block1, elifs, el]) => {\n    const op =  { op: 'if', args: [cond1, block1] };\n    for (const [,,, cond,, block] of elifs) op.args.push(cond, block);\n    if (el) op.args.push(el[3]);\n    return op;\n  }, 'if-block'),\n  map(seq(str('if'), rws, value, rws, str('then'), rws, value, rep(seq(rws, not(str('end', 'fi')), str('else if', 'elseif', 'elsif', 'elif'), rws, value, rws, str('then'), rws, value)), opt(seq(rws, str('else'), rws, value)), opt(seq(rws, str('end', 'fi')))), ([,, cond1,,,, val1, elifs, el]) => {\n    const op = { op: 'if', args: [cond1, val1] };\n    for (const [,,,, cond,,,, val] of elifs) op.args.push(cond, val);\n    if (el) op.args.push(el[3]);\n    return op;\n  }, 'if'),\n  map(seq(str('unless'), rws, value, rws, str('then'), rws, value, opt(seq(rws, str('else'), rws, value)), opt(seq(rws, str('end')))), ([, , cond, , , , hit, miss]) => {\n    const op = { op: 'unless', args: [cond, hit] };\n    if (miss) op.args.push(miss[3]);\n    return op;\n  }),\n);\n\nexport function replaceCase(op: Operation): boolean {\n  if (!op.args || !op.args.length) return false;\n  let found = false;\n  for (let i = 0; i < op.args.length; i++) {\n    const arg = op.args[i] as Value;\n    if ('r' in arg && (arg.r === '_' || (typeof arg.r === 'object' && arg.r.k[0] === '_'))) {\n      arg.r = { k: ['case'].concat(((arg.r as any).k || []).slice(1)), p: '@' };\n      found = true;\n    } else if ('r' in arg && typeof arg.r === 'object' && arg.r.p === '@' && arg.r.k[0] === 'case') {\n      found = true;\n    } else if ('op' in arg) found = found || replaceCase(arg);\n  }\n  return found;\n}\n\nexport const case_branch = alt<[undefined|Value, Value]>(\n  map(seq(rws, not(str('end', 'esac')), str('when'), rws, value, rws, str('then'), rws, value), ([,,,, cond,,,, hit]) => [cond, hit], 'when-branch'),\n  map(seq(rws, not(str('end', 'esac')), str('else'), rws, value), ([,,,, hit]) => [undefined, hit], 'else-branch'),\n  map(seq(rws, not(str('end', 'esac')), str('when'), rws, value, rws, block), ([,,,, cond,, hit]) => [cond, hit], 'when-block'),\n);\ncase_op.parser = alt(\n  map(seq(str('case'), rws, value, rep(case_branch), opt(seq(rws, str('end', 'esac')))), ([,, val, branches]) => {\n    const op = { op: 'case', args: [val] };\n    for (let i = 0; i < branches.length; i++) {\n      if (branches[i][0] === undefined) op.args.push(branches[i][1]);\n      else {\n        let arg: Value = branches[i][0];\n        if ('op' in arg) replaceCase(arg);\n        op.args.push(arg);\n        op.args.push(branches[i][1]);\n      }\n    }\n    return op;\n  }, 'case'),\n);\n\nfunction postfix_path(parser: Parser<Value>): Parser<Value> {\n  return map(seq(parser, rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([v, k]) => {\n    if (k.length) return { op: 'get', args: [v, { v: { k } }] };\n    else return v;\n  }, 'postfix-path-op');\n}\n\nexport const operation = alt<Value>('expression', if_op, case_op, binop);\n\nconst pair: Parser<[Value, Value]> = map(seq(alt('key', string, map(ident, v => ({ v }))), ws, str(':'), ws, value), t => [t[0], t[4]], 'pair');\n\narray.parser = map(bracket(\n  check(str('['), ws),\n  repsep(value, read1(space + ','), 'allow'),\n  check(ws, str(']')),\n), args => args.filter(a => !('v' in a)).length ? { op: 'array', args } : { v: args.map(a => (a as Literal).v) }, { primary: true, name: 'array' });\n\nfunction objectOp(pairs: [Value, Value][]): Value {\n  return pairs.filter(p => !('v' in p[0] && 'v' in p[1])).length ?\n  { op: 'object', args: pairs.reduce((a, c) => (a.push(c[0], c[1]), a), []) } : \n  { v: pairs.reduce((a, c) => (a[(c[0] as Literal).v] = (c[1] as Literal).v, a), {}) };\n}\n\nobject.parser = map(bracket(\n  check(str('{'), ws),\n  repsep(pair, read1(space + ','), 'allow'),\n  check(ws, str('}')),\n), objectOp, { primary: true, name: 'object' });\n\nblock.parser = map(bracket(\n  check(str('{'), ws),\n  rep1sep(value, read1(space + ';'), 'allow'),\n  check(ws, str('}')),\n), args => ({ op: 'block', args }), { primary: true, name: 'block' });\n\nvalue.parser = unwrap(comment('c', operation));\n\nconst namedArg: Parser<[Value, Value]> = map(seq(ident, str(':'), ws, value), ([k, , , v]) => [{ v: k }, v], 'named-arg');\napplication.parser = map(seq(opt(bracket(check(str('|'), ws), rep1sep(opName, read1(space + ','), 'allow'), seq(str('|'), ws))), str('=>', '=\\\\'), ws, value), ([names, , , value]) => {\n  const res: Value = { a: value };\n  if (names) res.n = names;\n  if ('op' in value && value.op === 'block') {\n    value.opts = Object.assign({}, value.opts, { v: { implicit: 1 } });\n  }\n  return res;\n}, { primary: true, name: 'application' });\nargs.parser = map(repsep(alt<[Value, Value] | Value>('argument', namedArg, value), read1(space + ','), 'allow'), (args) => {\n  const [plain, obj] = args.reduce((a, c) => ((Array.isArray(c) ? a[1].push(c) : a[0].push(c)), a), [[], []] as [Array<Value>, Array<[Value, Value]>]);\n  if (obj.length) return [plain, objectOp(obj)];\n  return [plain, undefined];\n});\n\nconst letter = map(seq(str('let'), rws, name(localpath, { name: 'reference', primary: true }), ws, str('='), ws, value), ([, , k, , , , v]) => ({ op: 'let', args: [{ v: k }, v] }), { primary: true, name: 'let' });\nconst setter = map(seq(str('set'), rws, name(keypath, { name: 'reference', primary: true }), ws, str('='), ws, value), ([, , k, , , , v]) => ({ op: 'set', args: [{ v: k }, v] }), { primary: true, name: 'set' });\nvalues.parser = alt('expression', array, object, literal, typelit, string, application, unop, call_op, letter, setter, ref, block);\n\nexport const parseBlock = makeParser<Value>(map(rep1sep(value, read1(space + ';'), 'allow'), args => args.length === 1 ? args[0] : { op: 'block', args, opts: { v: { implicit: 1 } } }, 'expression-sequence'), { trim: true });\nexport const parseExpr = makeParser(value, { trim: true });\n(parseBlock as any).namespace = 'default';\nexport const parse: typeof parseBlock & { namespace: string } = parseBlock as any;\nexport default parse;\n\nexport function schema() {\n  const type: Parser<Schema> = {};\n  const conditions = opt(seq(ws, rep1sep(map(seq(name(str('?'), { name: 'condition', primary: true }), ws, application), ([, , a]) => a), rws, 'disallow')));\n  const value = map(seq(str('any[]', 'string[]', 'number[]', 'boolean[]', 'date[]', 'any', 'string', 'number', 'boolean', 'date'), not(read1To(endRef))), ([s]) => ({ type: s === 'any[]' ? 'array' : s } as Schema), { name: 'type', primary: true });\n  const typedef = comment('c', map(seq(str('type'), ws, name(ident, { name: 'type', primary: true }), ws, str('='), ws, type), ([, , name, , , , type]) => ({ name, type } as { name: string, type: Schema, c?: string[] })));\n  const typedefs = map(rep1sep(typedef, read1(' \\t\\n;'), 'allow'), defs => defs.reduce((a, c) => (c.type.desc = c.c, a[c.name] = c.type, a), {} as TypeMap));\n  const ref = map(seq(ident, opt(str('[]'))), ([ref, arr]) => ({ type: arr ? 'array' : 'any', ref } as Schema), { name: 'type', primary: true });\n  const key = map(seq(name(ident, { name: 'key', primary: true }), opt(str('?')), ws, str(':'), ws, type), ([name, opt, , , , type]) => {\n    const res: Field = type as Field;\n    res.name = name;\n    if (!opt) res.required = true;\n    return res;\n  });\n  const literal = alt<Schema>(\n    { name: 'literal', primary: true }, \n    map(alt<string|number>(JString, JNum), v => {\n      return { type: 'literal', literal: v } as Schema;\n    }),\n    map(str('true', 'false', 'null', 'undefined'), v => {\n      return { type: 'literal', literal: v === 'true' ? true : v === 'false' ? false : v === 'null' ? null : undefined } as Schema;\n    }),\n  );\n  const rest = map(seq(str('...'), ws, str(':'), ws, type), ([, , , , type]) => {\n    return Object.assign({ name: '...' }, type) as Field;\n  });\n  const object: Parser<Schema> = map(seq(str('{'), ws, repsep(comment('desc', alt('interface parts', key, rest)), read1(' \\t\\n,;'), 'allow'), ws, str('}'), opt(str('[]'))), ([, , keys, , , arr], fail) => {\n    const rests = keys.filter(k => k.name === '...');\n    if (rests.length > 1) fail('only one object rest can be specified');\n    else {\n      const rest = rests[0];\n      keys = keys.filter(k => k.name !== '...');\n      const type: Schema = { type: arr ? 'object[]' : 'object' };\n      if (keys.length) type.fields = keys;\n      if (rest) {\n        delete rest.name;\n        type.rest = rest;\n      }\n      return type;\n    }\n  });\n  const tuple = map(seq(str('['), ws, repsep(type, read1(' \\t\\r\\n,'), 'allow'), ws, str(']'), opt(str('[]'))), ([, , types, , , arr]) => {\n    return { type: arr ? 'tuple[]' : 'tuple', types } as Schema;\n  });\n  const maybe_union: Parser<Schema> = {};\n  const union_array: Parser<Schema> = {};\n\n  maybe_union.parser = map(rep1sep(seq(alt<Schema>('union', value, object, tuple, literal, union_array, ref), conditions), seq(ws, str('|'), ws), 'disallow'), list => {\n    const types = list.map(([t, c]) => {\n      if (c && c[1] && c[1].length) t.checks = c[1];\n      return t;\n    });\n    if (types.length === 1) return types[0];\n    else return { type: 'union', types: types } as Schema;\n  });\n  union_array.parser = alt<Schema>('union array',\n    map(seq(str('Array<'), ws, maybe_union, ws, str('>')), ([, , union], fail) => {\n      if (union.type === 'union') return { type: 'union[]', types: union.types } as Schema;\n      else if (union.type === 'literal') fail('literal types cannot be array types');\n      else if (union.type === 'array' || ~union.type.indexOf('[]')) return { type: 'union[]', types: [union] } as Schema;\n      else if (union.type === 'any') return { type: 'array' } as Schema;\n      else {\n        union.type += '[]';\n        return union;\n      }\n    }),\n    map(seq(str('('), ws, maybe_union, ws, str(')')), ([, , union]) => union),\n  );\n\n  type.parser = map(seq(maybe_union, conditions), ([type, checks]) => {\n    if (checks && checks[1] && checks[1].length) type.checks = checks[1];\n    return type;\n  });\n\n  const root = map(seq(opt(typedefs), ws, type), ([defs, , type]) => {\n    if (defs) type.defs = defs;\n    return type;\n  });\n\n  return root;\n}\n","import { Value } from '../index';\nimport { value, rws, replaceCase, inlineTemplate } from '../parse';\nimport { Parser, parser as makeParser, rep, rep1, seq, alt, map, read1To, chars, str, readTo, check, andNot, name } from 'sprunge';\nimport { ws } from 'sprunge/lib/json';\n\nconst endTxt = '\\\\{';\n\nconst txtEsc = alt(map(str('\\\\{{'), () => '{{'), map(seq(str('\\\\'), chars(1)), ([, c]) => c));\nconst text = map(rep1(alt(read1To(endTxt, true), txtEsc, andNot(str('{'), str('{')))), txts => ({ v: txts.join('') }), 'text');\nconst nestedText = map(rep1(alt(read1To(endTxt + '$'), txtEsc, andNot(str('$'), str('$$')), andNot(str('{'), str('{')))), txts => ({ v: txts.join('') }), 'text');\n\nfunction tag_value(names: string[]): Parser<[string, Value]> {\n  return map(seq(str('{{'), ws, str(...names), rws, value, ws, str('}}')), arr => [arr[2], arr[4]], 'tag');\n}\n\nfunction case_value(names: string[]): Parser<[string, Value, Value]> {\n  return map(seq(str('{{'), ws, str(...names), rws, value, rws, str('when'), rws, value, str('}}')), arr => [arr[2], arr[4], arr[8]], 'tag');\n}\n\nconst tag_end = name(check(seq(str('{{/'), readTo('}'), str('}}'))), 'tag end');\n\nconst content: Parser<Value> = {};\n\ninterface Branch {\n  name: string;\n  value?: Value;\n}\n\ntype Content = Value|Branch;\n\nfunction branch(names: string[], value?: boolean): Parser<Branch> {\n  if (value) return map(tag_value(names), ([name, value]) => ({ name, value }));\n  else return map(seq(str('{{'), ws, str(...names), ws, str('}}')), ([, , name]) => ({ name }), 'tag');\n}\n\nfunction min_one<T>(values: Parser<Array<T>>): Parser<Array<T|Value>> {\n  return map(values, v => v.length < 1 ? [{ v: '' }] : v);\n}\n\nconst else_tag = branch(['else']);\nconst branch_tag = branch(['else if', 'elseif', 'elsif', 'elif'], true);\n\nconst each_op = map(seq(tag_value(['each']), min_one(rep(alt<Content>(branch_tag, else_tag, content))), tag_end), ([tag, content]) => ({ op: 'each', args: [tag[1]].concat(apply_first(cond_branches(content))) }), { primary: true, name: 'each-block' });\nconst if_op = map(seq(tag_value(['if']), min_one(rep(alt<Content>(branch_tag, else_tag, content))), tag_end), ([tag, content]) => ({ op: 'if', args: [tag[1]].concat(cond_branches(content)) }), { primary: true, name: 'if-block' });\nconst with_op = map(seq(tag_value(['with']), min_one(rep(alt<Content>(else_tag, content))), tag_end), ([tag, content]) => ({ op: 'with', args: [tag[1]].concat(apply_first(cond_branches(content))) }), { primary: true, name: 'with-block' });\nconst unless_op = map(seq(tag_value(['unless']), min_one(rep(content)), tag_end), ([tag, content]) => ({ op: 'unless', args: [tag[1]].concat(concat(content)) }), { primary: true, name: 'unless-block' });\nconst case_op = map(seq(case_value(['case']), min_one(rep(alt<Content>(branch(['when'], true), else_tag, content))), tag_end), ([tag, content]) => {\n  const op = { op: 'case', args: tag.slice(1).concat(cond_branches(content)) };\n  for (let i = 1; i < op.args.length; i += 2) {\n    const arg = op.args[i];\n    if (typeof arg === 'object' && 'op' in arg) replaceCase(arg);\n  }\n  return op;\n}, { primary: true, name: 'case-block' });\n\nconst interpolator = map(seq(str('{{'), ws, value, ws, str('}}')), ([, , value]) => ({ op: 'string', args: [value] }), { primary: true, name: 'interpolator' });\n\ncontent.parser = alt<Value>({ primary: true, name: 'content' }, text, each_op, if_op, with_op, case_op, unless_op, interpolator);\n\nfunction apply_first(content: Value[]): Value[] {\n  if (content.length) content[0] = { a: content[0] };\n  return content;\n}\n\nfunction cond_branches(content: Array<Value|Branch>): Value[] {\n  const res: Value[] = [];\n  let args = [];\n  let hasTag = false;\n\n  for (let i = 0; i < content.length; i++) {\n    const c = content[i];\n    if ('name' in c) {\n      hasTag = true;\n      if (args.length) res.push(concat(args));\n      else res.push({ v: '' });\n      if (c.value) res.push(c.value);\n      args = [];\n    } else args.push(c);\n  }\n  if (args.length) res.push(concat(args));\n  else if (hasTag) res.push({ v: '' });\n\n  if (res.length % 2) res.push({ v: '' });\n\n  return res;\n}\n\nfunction concat(values: Value[]): Value {\n  if (values.length === 1) return values[0];\n  return { op: 'cat', args: values, meta: { q: '$$$' } };\n}\n\nconst _parse = makeParser(alt<Value>(map(rep1(content), args => concat(args)), map(ws, () => ({ v: '' }))), { trim: true });\n(_parse as any).namespace = 'template';\nexport const parse: typeof _parse & { namespace: string } = _parse as any;\n\n(inlineTemplate as { parser?: Parser<Value> }).parser = map(rep1(alt<Value>({ name: 'inline-template' }, nestedText, each_op, if_op, with_op, case_op, unless_op, interpolator)), args => concat(args));\n","import { parse, parsePath, parseLetPath, isTimespanMS } from './parse';\nimport { parse as parseTemplate } from './parse/template';\nimport { ParseError } from 'sprunge/lib';\n\nexport interface TypeMap {\n  [name: string]: Schema;\n}\n\n// Data\nexport interface Schema {\n  /** An optional type for the value */\n  type?: Type;\n  /** Child fields belonging to the field */\n  fields?: Field[];\n  /** Types of unnamed fields in object prototypes */\n  rest?: Schema;\n  /** Types of tuple or union */\n  types?: Schema[];\n  /** Literal value of field */\n  literal?: string|number|boolean|undefined|null;\n  /** Addition validators on the value */\n  checks?: ValueOrExpr[];\n  /** An optional map of named types */\n  defs?: TypeMap;\n  /** If the type is 'any', this may be a name in a type map */\n  ref?: string;\n  /** Additional comments about the type */\n  desc?: string[];\n}\n\nexport interface DataSource<T = any, R = any> {\n  schema?: Schema;\n  values(parms?: T): Promise<DataSet<R>>;\n}\n\nexport interface DataSet<R = any> {\n  schema?: Schema;\n  value: R;\n}\n\nexport function toDataSet(value: any): DataSet {\n  if (Array.isArray(value)) return { value };\n  if (value && typeof value === 'object') {\n    for (const k in value) if (k !== 'schema' && k !== 'value') return { value };\n    return value;\n  }\n  return { value };\n}\n\nexport class CachedDataSource<R = any> implements DataSource<any, R> {\n  _schema: Schema;\n  _value: R;\n\n  constructor(value: R, schema?: Schema) {\n    this._value = value;\n    this._schema = schema;\n  }\n\n  values(): Promise<DataSet<R>> { return Promise.resolve({ schema: this._schema, value: this._value }); }\n}\n\nexport interface SourceMap { [key: string]: DataSet }\n\nexport type ValueType = 'string'|'number'|'boolean'|'date'|'object'|'literal';\nexport type ArrayType = 'string[]'|'number[]'|'boolean[]'|'date[]'|'object[]'|'tuple[]'|'union[]';\nexport type Type = ValueType|ArrayType|'value'|'array'|'union'|'tuple'|'any';\n\nexport interface Field extends Schema {\n  /** The property name for the field */\n  name: string;\n  /** Whether this field is required */\n  required?: true;\n  /** A user-friendly name for the field */\n  label?: string;\n  /** Additional information for special use cases */\n  meta?: any;\n}\n\nexport interface Operation {\n  op: string;\n  args?: ValueOrExpr[];\n  c?: string[];\n  opts?: ValueOrExpr;\n  meta?: any;\n}\n\nexport type Sort = ValueOrExpr|SortBy;\nexport type SortBy = SortBySQL|SortByDir;\nexport interface SortByBase {\n  by: ValueOrExpr;\n}\nexport interface SortBySQL extends SortByBase {\n  desc?: ValueOrExpr|boolean;\n}\nexport interface SortByDir extends SortByBase {\n  dir?: ValueOrExpr|'asc'|'desc';\n}\n\nexport type Operator = AggregateOperator | ValueOperator | CheckedOperator;\n\nexport interface OperatorOptions {\n  [key: string]: any;\n  // this is a dirty hack to make ts acknowledge that this isn't just any old object\n  __options: 1;\n}\n\nexport interface BaseOperator {\n  names: string[];\n}\nexport interface ValueOperator extends BaseOperator {\n  type: 'value';\n  apply(name: string, values: any[], opts: OperatorOptions, context: Context): any;\n}\n\nexport interface CheckedOperator extends BaseOperator {\n  type: 'checked';\n  apply(name: string, values: any[], opts: OperatorOptions, context: Context): any;\n  checkArg: (name: string, num: number, last: number, value: any, opts: OperatorOptions, context: Context, expr: ValueOrExpr) => CheckResult;\n  extend?: true;\n}\n\nexport interface AggregateOperator extends BaseOperator {\n  type: 'aggregate';\n  apply(name: string, values: any[], args: ValueOrExpr[], opts: OperatorOptions, context: Context): any;\n  extend?: true;\n  value?: true;\n}\n\nexport type CheckResult = 'continue'|{ result: any }|{ skip: number, value?: any };\n\nexport interface Group<R = any> {\n  grouped: number;\n  group: string;\n  value: R;\n  all: R[];\n  level: number;\n}\n\n// eval\nexport function getKeypath(ref: Reference): Keypath {\n  if (typeof ref.r === 'object') return ref.r;\n  const path = parsePath(ref.r);\n  if ('k' in path) return path;\n  else return { k: [] };\n}\n\nexport function safeGet(root: Context, path: string|Keypath): any {\n  if (!path) return root.value;\n  const p = typeof path === 'string' ? parsePath(path) : path;\n\n  if ('error' in p) return;\n  else if ('k' in p) {\n    let parts = p.k;\n    const prefix = p.p;\n    let idx = 0;\n    let ctx = root;\n    let o: any = root.value;\n\n    for (let i = 0; i < p.u; i++) ctx && (ctx = ctx.parent);\n    o = ctx ? ctx.value : undefined;\n\n    if (prefix) {\n      if (prefix === '!') o = root.root.parameters;\n      else if (prefix === '~') o = root.root.value;\n      else if (prefix === '*') {\n        o = root.root.sources[parts[idx++] as string];\n        if (o && idx < parts.length + 1 && parts[idx] !== 'value') o = o.value;\n      } else if (prefix === '@') {\n        const which = parts[idx++] as string;\n        if (which === 'locals' || which === 'specials') {\n          const key = which === 'locals' ? which : 'special';\n          while (ctx) {\n            if (ctx[key]) break;\n            ctx = ctx.parent;\n          }\n          if (ctx) o = ctx[key];\n        } else if (which === 'local' || which === 'special') {\n          const key = which === 'local' ? 'locals' : which;\n          o = ctx[key] || (ctx[key] = {});\n        } else if (which === 'parameters' || which === 'sources') {\n          o = root.root[which];\n        } else if (which !== 'value') {\n          while (ctx && (!ctx.special || !(which in ctx.special))) ctx = ctx.parent;\n          o = ctx && ctx.special[which];\n\n          if (o && which === 'source' && parts[idx] !== undefined && parts[idx] !== 'value' && o.value) o = o.value;\n          if (!o && which === 'date') o = root.root.special.date = new Date();\n        }\n      }\n    } else {\n      let first = parts[0];\n      if (typeof first === 'object' && 'v' in first) first = first.v;\n      if (first === '_') {\n        if (ctx.special && ctx.special.pipe) o = ctx.special.pipe;\n        idx++;\n      } else if (typeof first === 'string') {\n        let lctx = ctx;\n        while (lctx && (!lctx.locals || !(first in lctx.locals))) lctx = lctx.parent;\n        if (lctx && first in lctx.locals) {\n          o = lctx.locals[first];\n          idx++;\n        }\n      }\n    }\n\n    for (let i = idx; i < parts.length; i++) {\n      const part = parts[i];\n      const v = typeof part !== 'object' ? part : evalValue(root, part);\n      if (o != null && typeof v === 'number' && typeof part === 'object' && typeof o.length === 'number') {\n        if ('slice' in part && part.slice && typeof part.slice === 'object') {\n          let start = 'anchor' in part && part.anchor === 'end' ? o.length - 1 - v : v;\n          if (start < 0) start = 0;\n          if (start > o.length - 1) start = o.length - 1;\n          const e = typeof part.slice !== 'object' ? part : evalValue(root, part.slice);\n          let end = 'anchor' in part.slice && part.slice.anchor === 'end' ? o.length - 1 - e : e;\n          if (end < 0) end = 0;\n          if (end > o.length - 1) end = o.length - 1;\n          const dir = start > end ? -1 : 1;\n          let res = typeof o === 'string' ? '' : [];\n          for (let i = start; i !== end + dir; i += dir) typeof res === 'string' ? res = res + o[i] : res.push(o[i]);\n          o = res;\n        } else if ('anchor' in part && part.anchor === 'end') {\n          o = o[o.length - 1 - v];\n        } else {\n          o = o[v];\n        }\n      } else if (Array.isArray(v) && o && typeof o === 'object') {\n        const r = {};\n        for (const f of v) if (f in o) r[f] = o[f];\n        o = r;\n      } else o = o && o[v];\n      if (o === null || o === undefined) return;\n    }\n\n    return o;\n  }\n}\n\nexport function safeSet(root: Context, path: string|Keypath, value: any, islet?: boolean): any {\n  if (!path) return;\n  const p = typeof path === 'string' ? (islet ? parseLetPath(path) : parsePath(path)) : path;\n\n  if ('error' in p) return;\n  else if ('k' in p) {\n    let parts = p.k;\n    const prefix = p.p;\n    let ctx = root;\n    let o: any = root.value;\n\n    for (let i = 0; i < p.u; i++) ctx && (ctx = ctx.parent);\n    o = ctx ? ctx.value : undefined;\n\n    const keys = parts.map(p => typeof p !== 'object' ? p : evalValue(root, p));\n\n    if (islet) {\n      o = root.locals || (root.locals = {});\n    } else if (prefix) {\n      if (prefix === '~') o = root.root.value;\n      else return;\n    }\n\n    if (!islet) {\n      const first = keys[0];\n      while (ctx) {\n        if (ctx.locals && first in ctx.locals) break;\n        ctx = ctx.parent;\n      }\n      if (ctx) o = ctx.locals;\n    }\n\n    const last = keys.length - 1;\n    for (let i = 0; i < last; i++) {\n      if (typeof o !== 'object' && typeof o !== 'function' || !o) return;\n      let key = keys[i];\n      const part = parts[i];\n      if (o != null && typeof key === 'number' && typeof part === 'object' && 'anchor' in part && part.anchor === 'end' && typeof o.length === 'number') key = o.length - key;\n      const next = keys[i + 1];\n      if (!(key in o) || o[key] == null) o[key] = typeof next === 'number' ? [] : {};\n      o = o[key];\n    }\n    \n    if (o) {\n      const part = parts[last];\n      let k = keys[last];\n      if (o != null && typeof k === 'number' && typeof part === 'object' && 'anchor' in part && part.anchor === 'end' && typeof o.length === 'number') k = o.length- 1 - k;\n      const cur = o[k];\n      o[k] = value;\n      return cur;\n    }\n  }\n}\n\nexport function evaluate(value: ValueOrExpr): any;\nexport function evaluate(root: Context|{ context: Context }|any, value: ValueOrExpr): any;\nexport function evaluate(root: ValueOrExpr|Context|{ context: Context }|any, value?: ValueOrExpr): any {\n  let r: Context;\n  let e: ValueOrExpr;\n  if (!value && isValueOrExpr(root)) {\n    r = new Root();\n    e = root;\n  } else if (isContext(root)) {\n    r = root;\n    !Array.isArray(value) && (e = value);\n  } else if (root && typeof root === 'object' && 'context' in root && isContext(root.context)) {\n    r = root.context;\n    !Array.isArray(value) && (e = value);\n  } else if (isValueOrExpr(value)) {\n    r = new Root(root);\n    e = value;\n  } else {\n    r = new Root();\n    e = root;\n  }\n  return evalParse(r, e);\n}\n\nexport function template(template: string): string;\nexport function template(root: Context|{ context: Context }|any, template: string): string;\nexport function template(root: string|Context|{ context: Context }|any, template?: string): string {\n  let r: Context;\n  let t: string;\n  if (typeof root === 'string') {\n    r = new Root();\n    t = root;\n  } else if (isContext(root)) {\n    r = root;\n    t = template || '';\n  } else if (root && typeof root === 'object' && 'context' in root && isContext(root.context)) {\n    r = root.context;\n    t = template || '';\n  } else if (root && typeof root !== 'string') {\n    r = new Root(root);\n    t = template || '';\n  } else {\n    r = new Root();\n    t = root;\n  }\n  r = extend(r, { parser: parseTemplate });\n  return evalParse(r, t);\n}\n\n/**\n * Evaluate an applicative with the given locals, naming them if the applicative declares named arguments.\n * If swap is not true, then a new context extension will be used. Otherwise, the context locals will be\n * swapped for the evaluation and replaced afterwards. Swap should only be used for applications that are\n * passing the context value as the first local.\n */\nexport function evalApply(ctx: Context, value: ValueOrExpr, locals: any[], special?: object): any {\n  if (isApplication(value)) {\n    const c = extend(ctx, { value: locals[0], special, fork: !ctx.locals });\n    let res: any;\n    if ('n' in value) {\n      const map = value.n.reduce((a, c, i) => (a[c] = locals[i], a), {} as ParameterMap);\n      c.locals = map;\n    }\n    res = evalValue(c, value.a);\n    return res;\n  } else {\n    const v = evalParse(extend(ctx, { value: locals[0], special, fork: !ctx.locals }), value);\n    if (isApplication(v)) return evalApply(ctx, v, locals, special);\n    else return v;\n  }\n}\n\nexport function evalParse(ctx: Context, expr: ValueOrExpr): any {\n  if (typeof expr === 'string') {\n    const p = ctx.parser || parse;\n    const ns = p.namespace || 'unknown';\n    const cache = ctx.root.exprs[ns] || (ctx.root.exprs[ns] = {});\n    expr = cache[expr] || (cache[expr] = p(expr));\n  }\n  if (typeof expr !== 'object') expr = { v: expr };\n  return evalValue(ctx, expr);\n}\n\nexport function evalValue(ctx: Context, expr: Value): any {\n  if (!expr) return expr;\n  if ('r' in expr) return safeGet(ctx, expr.r);\n  else if ('v' in expr) return expr.v;\n  else if ('op' in expr) return applyOperator(ctx, expr);\n  else if (isApplication(expr)) return expr;\n  else if (isDateRel(expr) || isTimespan(expr)) return expr;\n}\n\nconst opMap: { [key: string]: Operator } = {};\nexport function registerOperator(...ops: Operator[]) {\n  for (const op of ops) {\n    for (const name of op.names) opMap[name] = op;\n  }\n}\nexport function unregisterOperator(...ops: Operator[]) {\n  for (const op of ops) {\n    for (const name of op.names) delete opMap[name];\n  }\n}\nexport function getOperatorMap(): { [key: string]: Operator } {\n  return Object.assign({}, opMap);\n}\nexport function getOperator<T extends Operator = Operator>(name: string): T {\n  return opMap[name] as T;\n}\n\nconst _defaultGetValue = (c: Context, b: ValueOrExpr, v: any) => evalApply(c, b, [v]);\nexport function sort(context: Context, arr: any[], sorts: Sort[]|ValueOrExpr, getValue?: (context: Context, by: ValueOrExpr, v: any) => any): any[] {\n  let sortArr: Sort[];\n  \n  if (Array.isArray(sorts)) {\n    sortArr = sorts;\n  } else if (isApplication(sorts)) {\n    sortArr = [sorts];\n  } else if (typeof sorts === 'object' && sorts && 'by' in sorts) {\n    sortArr = [sorts];\n  } else {\n    const s = evalParse(context, sorts);\n    if (Array.isArray(s)) sortArr = s;\n    else if (typeof s === 'string') sortArr = [{ v: s }];\n    else if (typeof sorts === 'string') sortArr = [sorts]\n  }\n\n  if (sortArr) {\n    let el: any;\n    for (let i = 0; i < sortArr.length; i++) {\n      el = sortArr[i];\n      const by = isLiteral(el) ? el.v : el;\n      if (typeof by === 'string') {\n        if (by[0] === '-') sortArr[i] = { by: by.slice(1), desc: true };\n        else sortArr[i] = { by: by[0] === '+' ? by.slice(1) : by, desc: false };\n      }\n    }\n  }\n\n  getValue = getValue || _defaultGetValue;\n  if (sortArr && sortArr.length) {\n    const dirs = sortArr.map(s => {\n      if (typeof s === 'object') {\n        if ('by' in s) {\n          if ('desc' in s) {\n            if (typeof s.desc === 'boolean') return s.desc;\n            return evalParse(context, s.desc);\n          } else if ('dir' in s) {\n            const lower = typeof s.dir === 'string' ? s.dir.toLowerCase() : s.dir;\n            const dir = lower === 'asc' || lower === 'desc' ? lower : evalParse(context, s.dir);\n            const val = typeof dir === 'string' ? dir.toLowerCase() : dir;\n            if (val === 'desc') return true;\n          }\n        }\n      }\n      // default to asc\n      return false;\n    });\n\n    arr.sort((a, b) => {\n      for (let i = 0; i < sortArr.length; i++) {\n        const s = sortArr[i];\n        const desc = dirs[i];\n        const by: ValueOrExpr = typeof s === 'string' ? s : s && (s as any).by ? (s as any).by : s;\n        const l = getValue(context, by, a);\n        const r = getValue(context, by, b);\n        const cmp = l == null && r != null ? -1 \n          : l != null && r == null ? 1\n          : (l < r) === (r < l) ? 0\n          : l < r ? -1\n          : l > r ? 1\n          : 0;\n        if (cmp) return (desc ? -1 : 1) * cmp;\n      }\n      return 0;\n    });\n  }\n\n  return arr;\n}\n\nexport function filter(arr: any[], filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): any[];\nexport function filter(ds: DataSet, filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): DataSet;\nexport function filter(ds: DataSet|any[], filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): DataSet|any[] {\n  const _ds = Array.isArray(ds) ? { value: ds } : ds;\n  if (!_ds || !Array.isArray(_ds.value)) return _ds;\n  let _context: Context;\n  if (!context) _context = new Root(_ds.value, { special: { source: _ds } });\n  else if (isContext(context)) _context = extend(context, { special: { source: _ds.value } });\n  else _context = new Root(context);\n  const values = filter ? [] : _ds.value.slice();\n\n  if (filter) {\n    let flt: Value = typeof filter === 'string' ? parse(filter) : filter;\n    if ('m' in flt) flt = { v: true };\n    _ds.value.forEach((row, index) => {\n      if (!!evalApply(extend(_context, { value: row, special: { value: row, index } }), flt, [row, index])) values.push(row);\n    });\n  }\n\n  if (sorts) sort(_context, values, sorts);\n\n  if (groups && !Array.isArray(groups)) groups = [groups];\n\n  if (Array.isArray(groups) && groups.length) {\n    return { value: { schema: _ds.schema, grouped: groups.length, level: 0, value: group(values, groups, _context, 1), all: values } };\n  }\n\n  if (Array.isArray(ds)) return values;\n  else return { schema: _ds.schema, value: values };\n}\n\ninterface GroupCache {\n  [group: string]: any[];\n}\n\nfunction group(arr: any[], groups: Array<ValueOrExpr>, ctx: Context, level: number = 0): Group[] {\n  const cache: GroupCache = {};\n  const res: Group[] = [];\n  const order: string[] = [];\n  for (const e of arr) {\n    const g = isApplication(groups[0]) ? `${evalApply(ctx, groups[0], [e])}` : `${evalParse(extend(ctx, { value: e }), groups[0])}`;\n    if (!cache[g]) {\n      order.push(g);\n      cache[g] = [];\n    }\n    cache[g].push(e);\n  }\n\n  for (const k of order) {\n    res.push({ group: k, grouped: groups.length - 1, value: groups.length > 1 ? group(cache[k], groups.slice(1), ctx, level + 1) : cache[k], all: cache[k], level });\n  }\n\n  return res;\n}\n\nfunction hasPipeRef(ref: Reference): boolean {\n  const path = getKeypath(ref);\n  return path.k[0] === '_' || path.p === '@' && path.k[0] === 'pipe';\n}\n\nexport function applyOperator(root: Context, operation: Operation): any {\n  const op = opMap[operation.op];\n\n  // if the operator doesn't exist, try a local, pipe, or skip\n  if (!op) {\n    const local = safeGet(root, operation.op) || safeGet(root.root, operation.op);\n    if (isApplication(local)) {\n      return evalApply(root, local, (operation.args || []).map(a => evalParse(root, a)));\n    } else if (operation.op === 'pipe') { // handle the special built-in pipe operator\n      if (!operation.args || !operation.args.length) return true;\n      let v = evalParse(root, operation.args[0]);\n      for (let i = 1; i < operation.args.length; i++) {\n        let a = operation.args[i];\n        if (isOperation(a) && (!a.args || !a.args.find(a => isReference(a) && hasPipeRef(a)))) a = Object.assign({}, a, { args: [{ r: { k: ['pipe'], p: '@' } } as ValueOrExpr].concat(a.args || []) });\n        \n        if (isApplication(a)) v = evalApply(root, a, [v]);\n        else v = evalParse(extend(root, { special: { pipe: v } }), a);\n      }\n      return v;\n    }\n    return true;\n  }\n\n  let args: any[];\n  if (op.type === 'checked') {\n    args = [];\n    const flts = operation.args || [];\n    const ctx = op.extend ? extend(root, {}) : root;\n    const opts = operation.opts ? evalParse(ctx, operation.opts) : undefined;\n    for (let i = 0; i < flts.length; i++) {\n      const a = flts[i];\n      const arg = evalParse(ctx, a);\n      const res = op.checkArg(operation.op, i, flts.length - 1, arg, opts, ctx, a);\n      if (res === 'continue') args.push(arg);\n      else if ('skip' in res) {\n        i += res.skip;\n        if ('value' in res) args.push(res.value);\n      } else if ('result' in res) return res.result;\n    }\n\n    return op.apply(operation.op, args, opts, ctx);\n  } else if (op.type === 'value') {\n    args = (operation.args || []).map(a => evalParse(root, a));\n    return op.apply(operation.op, args, operation.opts ? evalParse(root, operation.opts) : undefined, root);\n  } else {\n    let arr: any[];\n    const ctx = op.extend ? extend(root, {}) : root;\n    const args = (operation.args || []).slice();\n    const opts = operation.opts ? evalParse(ctx, operation.opts) : undefined;\n    let arg: any;\n    if (!op.value) {\n      arg = evalParse(ctx, args[0]);\n      if (Array.isArray(arg)) {\n        args.shift();\n        arr = arg;\n      } else if (typeof arg === 'object' && 'value' in arg && Array.isArray(arg.value)) {\n        args.shift();\n        arr = arg.value;\n      }\n      if (!arr) {\n        const src = evalValue(ctx, { r: '@source' });\n        if (Array.isArray(src)) arr = src;\n        else if (typeof src === 'object' && 'value' in src && Array.isArray(src.value)) arr = src.value;\n        else arr = [];\n      }\n    }\n    return op.apply(operation.op, Array.isArray(arr) ? arr : [], args, opts, ctx);\n  }\n}\n\nexport interface Keypath {\n  u?: number;\n  p?: '!'|'~'|'*'|'@';\n  k: Array<string|number|Value|ValueWithAnchor>;\n}\n\nexport function isKeypath(v: any): v is string|Keypath {\n  return typeof v === 'string' || (typeof v === 'object' && Array.isArray(v.k));\n}\n\nexport function isLiteral(v: any): v is Literal {\n  return typeof v === 'object' && 'v' in v;\n}\n\nexport function isReference(v: any): v is Reference {\n  return typeof v === 'object' && 'r' in v;\n}\n\nexport function isOperation(v: any): v is Operation {\n  return typeof v === 'object' && typeof v.op === 'string';\n}\n\nexport interface Reference { r: string|Keypath; c?: string[] };\nexport interface Application { a: Value; n?: string[]; c?: string[] };\nexport interface Literal { v: any; s?: 1; c?: string[]; q?: string };\n\nexport function isApplication(v: any): v is Application {\n  if (typeof v !== 'object' || !('a' in v) || typeof v.a !== 'object') return false;\n  const len = Object.keys(v).length;\n  return len === 1 || len === 2 && 'n' in v;\n}\n\n/** A timespan specified in milliseconds */\nexport interface DateRelSpanMS {\n  /** Starting point (now) */\n  f: 'n';\n  /** Offset in ms */\n  o: number;\n  /** Timezone offset */\n  z?: number;\n}\n/** A timespan specified in individual units years, months, days, hours, minutes, seconds, and/or milliseconds */\nexport interface DateRelSpanFull {\n  /** Starting point (now) */\n  f: 'n';\n  /** Offset array [years, months, days, hours, minutes, seconds, milliseconds] */\n  o: [number?, number?, number?, number?, number?, number?, number?];\n  /** Offset direction is before starting point */\n  d?: -1;\n  /** Timezone offset */\n  z?: number;\n}\nexport type DateRelSpan = DateRelSpanMS | DateRelSpanFull;\n\n/** A date span covering last|this|next day|week|month|year */\nexport interface DateRelRange {\n  /** Starting point (d: day, w: week, m: month, y: year) */\n  f: 'd'|'w'|'m'|'y';\n  /** Offset in units (-1: last, 0: this, 1: next) */\n  o: -1|0|1;\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n  /** Timezone offset */\n  z?: number;\n}\n/** A date span by time relative to yesterday, today, or tomorrow */\nexport interface DateRelTimeRange {\n  /** Starting point (day) */\n  f: 'd';\n  /** Offset in units (-1: yesterday, 0: today, 1: tomorrow) */\n  o: -1|0|1;\n  /** Time array [hour, minute, second, millisecond, timezone offset] */\n  t: [number, number?, number?, number?, number?];\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n}\n/** A date span covering this year, month, or week to the current date */\nexport interface DateRelToDate {\n  /** Starting point */\n  f: 'w'|'m'|'y';\n  /** Offset */\n  o: 0;\n  /** Relative to current date */\n  d: 1;\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n  /** Timezone offset */\n  z?: number;\n}\n/** A date range covering a specific range in time at most a year, optionally more specific by scoping farther\n * down with a month, date, hour, minute, second, and millisecond. It may also specify a timezone. */\nexport interface DateExactRange {\n  /** Starting point [year, month, date, hour, minute, second, millisecond, timezone] */\n  f: [number, number?, number?, number?, number?, number?, number?, number?];\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n}\nexport type DateRel = Date | DateRelSpan | DateRelRange | DateRelTimeRange | DateRelToDate | DateExactRange;\n\nexport type TimeSpan = number|TimeSpanMS|FullTimeSpan;\nexport interface TimeSpanMS {\n  ms: number;\n}\nexport interface FullTimeSpan {\n  s?: number;\n  d: [number?, number?, number?, number?, number?, number?, number?];\n}\n\nexport type ValueOrExpr = string|Value;\nexport type Value = Reference | Literal | Operation | Application | ParseError;\nexport type ValueWithAnchor = Value & { anchor?: 'start'|'end'; slice?: ValueWithAnchor };\n\nexport function isValueOrExpr(o: any): o is ValueOrExpr {\n  return typeof o === 'string' || isValue(o);\n}\n\nexport function isValue(o: any): o is Value {\n  return typeof o === 'object' && o && (\n    ('r' in o && typeof o.r === 'string') ||\n    ('op' in o && typeof o.op === 'string') ||\n    ('v' in o) ||\n    (isApplication(o))\n  );\n}\n\nexport type Parameter<T = any> = ParameterBase & T;\nexport interface ParameterBase {\n  name: string;\n  label?: string;\n  type?: Type;\n  required?: boolean;\n  refine?: string;\n  init?: ValueOrExpr;\n  options?: Array<string|{ label: string; value: any }>;\n}\n\nexport interface ParameterMap {\n  [name: string]: any;\n}\n\nexport function isContext(v: any): v is Context {\n  return typeof v === 'object' && typeof v.path === 'string' && typeof v.root == 'object' && 'value' in v && (typeof v.parent === 'object' || v.root === v);\n}\nexport interface Context {\n  path: string;\n  root: RootContext;\n  parent?: Context;\n  special?: ParameterMap;\n  locals?: ParameterMap;\n  value: any;\n  parser?: ((txt: string) => Value) & { namespace: string };\n}\n\nexport interface RootContext extends Context {\n  parameters: ParameterMap;\n  sources: SourceMap;\n  parent: undefined;\n  exprs: { [ns: string]: { [key: string]: Value } };\n  log: (...v: any[]) => void;\n}\n\nexport class Root implements RootContext {\n  value: any;\n  root: RootContext = this;\n  parameters: ParameterMap = {};\n  sources: SourceMap = {};\n  special: ParameterMap = {};\n  parent: undefined;\n  exprs = {} as { [ns: string]: { [key: string]: Value } };\n  parser?: ((txt: string) => Value) & { namespace: string };\n  path: '' = '';\n  log(v: any[]) {\n    console.log(...v);\n  }\n\n  constructor(root: any = {}, opts?: ExtendOptions & { parameters?: ParameterMap; log?: (...v: any[]) => void }) {\n    this.value = root;\n    if (opts) {\n      Object.assign(this.parameters, opts.parameters);\n      Object.assign(this.special, opts.special);\n      if (opts.parser) this.parser = opts.parser;\n      if (opts.log && typeof opts.log === 'function') this.log = opts.log;\n    }\n  }\n}\n\nexport function join(context: Context, path: string): Context {\n  return {\n    parent: context,\n    root: context.root,\n    path: context.path ? `${context.path}.${path}` : path,\n    value: safeGet(context, path)\n  };\n}\n\nexport interface ExtendOptions {\n  value?: any;\n  special?: any;\n  locals?: ParameterMap,\n  parser?: ((txt: string) => Value) & { namespace: string };\n  path?: string;\n  fork?: boolean;\n}\n\nexport function extend(context: Context, opts: ExtendOptions): Context {\n  return {\n    parent: opts.fork && (!opts.value || opts.value === context.value) ? (context.parent || context.root) : context,\n    root: context.root,\n    path: opts.path || '',\n    value: 'value' in opts ? opts.value : context.value,\n    special: opts.fork ? Object.assign({}, context.special, { pipe: undefined }, opts.special) : (opts.special || {}),\n    parser: opts.parser,\n    locals: opts.locals,\n  };\n}\n\nexport const formats: { [name: string]: { apply: (value: any, args?: any[], opts?: OperatorOptions) => string, defaults: { [key: string]: any } } } = {};\nexport const virtualFormats: { [name: string]: { defaults: { [key: string]: any } } } = {};\nexport function registerFormat<T = any>(name: string|string[], format: (value: T, args?: any[], opts?: OperatorOptions) => string, defaults: { [key: string]: any } = {}) {\n  if (Array.isArray(name)) name.forEach(n => formats[n] = { apply: format, defaults });\n  else formats[name] = { apply: format, defaults };\n}\nexport function unregisterFormat(name: string) {\n  delete formats[name];\n}\n\nexport function dateRelToRange(rel: DateRel): [Date, Date] {\n  if (rel instanceof Date) return [rel, rel];\n\n  let from = new Date();\n  let to: Date = 'd' in rel && rel.d ? new Date() : undefined;\n  from.setUTCFullYear(from.getFullYear(), from.getMonth(), from.getDate());\n  from.setUTCHours(0, 0, 0, 0);\n  let tz: number = 'z' in rel && rel.z != null ? rel.z : null;\n\n  if (rel.f === 'n') { // DateRelSpan (MS or Full)\n    from = typeof rel.o === 'number' ? new Date(+new Date() + rel.o) : dateAndTimespan(new Date(), { d: rel.o }, 'd' in rel ? rel.d : 1);\n    to = from;\n    tz = undefined;\n  } else if (rel.f === 'd') { // DateRelRange - day\n    from.setUTCDate(from.getUTCDate() + rel.o);\n    if (!to) to = new Date(from);\n    if ('t' in rel) { // DateRelTimeRange\n      const t = rel.t;\n      from.setUTCHours(t[0], t[1] || 0, t[2] || 0, t[3] || 0);\n      to.setUTCHours(t[0], t[1] == null ? 59 : t[1], t[2] == null ? 59 : t[2], t[3] == null ? 999 : t[3]);\n      if (t[4] != null) tz = t[4];\n    }\n  } else if (rel.f === 'w') { // DateRelRange - week\n    from.setUTCDate(from.getUTCDate() - (from.getUTCDay() + (rel.o === -1 ? 7 : rel.o === 1 ? -7 : 0)));\n    if (!to) {\n      to = new Date(from);\n      to.setDate(from.getUTCDate() + 6);\n    }\n    if ('z' in rel && rel.z != null) tz = rel.z;\n  } else if (rel.f === 'm') { // DateRelRange - month\n    from.setUTCDate(1);\n    from.setUTCMonth(from.getUTCMonth() + rel.o);\n    if (!to) {\n      to = new Date(from);\n      to.setUTCMonth(from.getUTCMonth() + 1);\n      to.setUTCDate(0);\n    }\n  } else if (rel.f === 'y') { // DateRelRange - year\n    from.setUTCDate(1);\n    from.setUTCMonth(0);\n    from.setUTCDate(1);\n    if (!to) {\n      to = new Date(from);\n      to.setUTCFullYear(from.getUTCFullYear() + 1);\n      to.setUTCDate(0);\n    }\n  } else if (Array.isArray(rel.f)) { // DateExactRange\n    const v = rel.f.slice();\n    from = new Date(Date.UTC(v[0], v[1] || 0, v[2] || 1, v[3] || 0, v[4] || 0, v[5] || 0, v[6] || 0));\n    for (let i = 1; i < 7; i++) {\n      if (v[i] == null) {\n        v[i - 1]++;\n        break;\n      }\n    }\n    if (v[6] != null) v[6]++;\n    to = new Date(Date.UTC(v[0], v[1] || 0, v[2] || 1, v[3] || 0, v[4] || 0, v[5] || 0, v[6] || 0));\n    to.setUTCMilliseconds(to.getUTCMilliseconds() - 1);\n    if (v[7] != null) tz = v[7];\n  }\n\n  if (rel.f === 'd' || rel.f === 'w' || rel.f === 'm' || rel.f === 'y') to.setUTCHours(23, 59, 59, 999);\n\n  if (tz !== undefined) {\n    if (tz != null) {\n      from.setUTCMinutes(from.getUTCMinutes() - tz);\n      if (from !== to) to.setUTCMinutes(to.getUTCMinutes() - tz);\n    } else { // shift to local time\n      const offset = from.getTimezoneOffset();\n      from.setUTCMinutes(from.getUTCMinutes() + offset);\n      if (from !== to) to.setUTCMinutes(to.getUTCMinutes() + offset);\n    }\n  }\n\n  return [from, to];\n}\n\nexport function isDateRel(v: any): v is DateRel {\n  return v && typeof v === 'object' && (('f' in v && (Array.isArray(v.f) || 'o' in v)) || v instanceof Date);\n}\n\nexport function isDateExactRange(v: any): v is DateExactRange {\n  return v && typeof v === 'object' && 'f' in v && Array.isArray(v.f);\n}\n\nexport function dateRelToDate(rel: DateRel): Date {\n  const range = dateRelToRange(rel);\n  if ('e' in rel && rel.e != null) return range[1];\n  else return range[0];\n}\n\nexport function dateRelToExactRange(rel: DateRel): DateExactRange {\n  if (!rel) return;\n  if (isDateExactRange(rel)) return rel;\n  const dt = dateRelToDate(rel);\n  const offset = dt.getTimezoneOffset();\n  const z = 'z' in rel && rel.z != null ? rel.z : 'f' in rel && rel.f === 'd' && 't' in rel && rel.t[4] != null ? rel.t[4] : null;\n  if (rel instanceof Date && z != null) dt.setMinutes(dt.getMinutes() - (offset + z));\n  return {\n    f: [dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours(), dt.getMinutes(), dt.getSeconds(), dt.getMilliseconds(), z != null ? z : -offset],\n  };\n}\n\nexport function isTimespan(v: any): v is TimeSpan {\n  return typeof v === 'number' || (typeof v === 'object' && Array.isArray(v.d)) || isTimespanMS(v);\n}\n\nexport function addTimespan(l: TimeSpan, r: TimeSpan): TimeSpan {\n  if (typeof l === 'number' && typeof r === 'number') return l + r;\n  else {\n    const res: TimeSpan = { d: [] };\n    if (typeof l === 'number') res.d[6] = l;\n    else if (isTimespanMS(l)) res.d[6] = l.ms;\n    else for (let i = 0; i < 7; i++) if (l.d[i]) res.d[i] = l.d[i];\n\n    if (typeof r === 'number') res.d[6] = (res.d[6] || 0) + r;\n    else if (isTimespanMS(r)) res.d[6] = (res.d[6] || 0) + r.ms;\n    else for (let i = 0; i < 7; i++) if (r.d[i]) res.d[i] = (res.d[i] || 0) + r.d[i];\n    return res;\n  }\n}\n\nexport function subtractTimespan(l: TimeSpan, r: TimeSpan): TimeSpan {\n  if (typeof l === 'number' && typeof r === 'number') return l - r;\n  else {\n    if (isTimespanMS(l)) l = l.ms;\n    if (isTimespanMS(r)) r = r.ms;\n    if (typeof l === 'number') {\n      const res = ({ d: (r as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      for (let i = 0; i < 7; i++) if (res.d[i]) res.d[i] = 0 - res.d[i];\n      res.d[6] = (res.d[6] || 0) + l;\n      return res;\n    } else if (typeof r === 'number') {\n      const res = ({ d: (l as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      res.d[6] = (res.d[6] || 0) - r;\n      return res;\n    } else {\n      const res = ({ d: (l as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      for (let i = 0; i < 7; i++) if (r.d[i]) l.d[i] = (l.d[i] || 0) - r.d[i];\n      return res;\n    }\n  }\n}\n\nexport function datesDiff(l: Date, r: Date): FullTimeSpan {\n  if (isNaN(+l) || isNaN(+r)) return { d: [] };\n  if (r < l) {\n    const s = r;\n    r = l;\n    l = s;\n  }\n  const a = new Date(l);\n  const b = r;\n  const res: FullTimeSpan = { d: [0, 0, 0, 0, 0, 0, 0], s: +a };\n  let num = b.getFullYear() - a.getFullYear() - 1;\n  let tmp1: number, tmp2: number;\n  if (num > 0) {\n    res.d[0] += num;\n    a.setFullYear(b.getFullYear() - 1);\n  }\n  a.setFullYear(a.getFullYear() + 1);\n  if (a > b) a.setFullYear(a.getFullYear() - 1);\n  else res.d[0]++;\n\n  // watch out for leap year\n  if (l.getMonth() === 1 && l.getDate() === 29 && a.getMonth() !== 1) {\n    a.setDate(29);\n    a.setMonth(1);\n  }\n\n  // jumping months can make days get weird\n  while (true) {\n    num = a.getDate();\n    tmp1 = a.getMonth();\n    tmp2 = a.getFullYear();\n    a.setDate(num + 1);\n    if (a.getMonth() !== tmp1) {\n      a.setDate(1);\n      a.setFullYear(tmp2);\n      a.setMonth(tmp1 + 2);\n      a.setDate(0);\n    } else {\n      a.setDate(num);\n      a.setMonth(tmp1 + 1);\n      if (tmp1 === 11 ? a.getMonth() !== 0 : a.getMonth() !== tmp1 + 1) {\n        a.setDate(1);\n        a.setFullYear(tmp2);\n        a.setMonth(tmp1 + 2);\n        a.setDate(0);\n      }\n    }\n    if (a > b) {\n      // make sure we stay in the correct year\n      a.setFullYear(tmp2);\n      a.setDate(1);\n      a.setMonth(tmp1);\n      a.setDate(num);\n      break;\n    } else res.d[1]++;\n  }\n\n  while (true) {\n    a.setDate(a.getDate() + 1);\n    if (a > b) {\n      a.setDate(a.getDate() - 1);\n      break;\n    } else res.d[2]++;\n  }\n\n  while (true) {\n    a.setHours(a.getHours() + 1);\n    if (a > b) {\n      a.setHours(a.getHours() - 1);\n      break;\n    } else res.d[3]++;\n  }\n\n  while (true) {\n    a.setMinutes(a.getMinutes() + 1);\n    if (a > b) {\n      a.setMinutes(a.getMinutes() - 1);\n      break;\n    } else res.d[4]++;\n  }\n\n  while (true) {\n    a.setSeconds(a.getSeconds() + 1);\n    if (a > b) {\n      a.setSeconds(a.getSeconds() - 1);\n      break;\n    } else res.d[5]++;\n  }\n\n  if (a.getMilliseconds() <= b.getMilliseconds()) res.d[6] = b.getMilliseconds() - a.getMilliseconds();\n  else res.d[6] = (1000 - a.getMilliseconds()) + b.getMilliseconds();\n\n  return res;\n}\n\nexport function dateAndTimespan(l: Date, r: TimeSpan, m: 1|-1): Date {\n  if (typeof r === 'number') return new Date(+l + r * m);\n  else if (isTimespanMS(r)) return new Date(+l + r.ms * m);\n  else {\n    let d = new Date(l);\n    if (r.d[0]) d.setFullYear(d.getFullYear() + r.d[0] * m);\n    if (r.d[1]) {\n      const dd = d.getDate();\n      d.setDate(1);\n      d.setMonth(d.getMonth() + r.d[1] * m);\n      const mm = d.getMonth();\n      d.setDate(dd);\n      if (mm !== d.getMonth()) d.setDate(0);\n    }\n    if (r.d[2]) d.setDate(d.getDate() + r.d[2] * m);\n    if (r.d[3]) d.setHours(d.getHours() + r.d[3] * m);\n    if (r.d[4]) d.setMinutes(d.getMinutes() + r.d[4] * m);\n    if (r.d[5]) d.setSeconds(d.getSeconds() + r.d[5] * m);\n    if (r.d[6]) d.setMilliseconds(d.getMilliseconds() + r.d[6] * m);\n    return d;\n  }\n}\n","import { Displayed, Placement } from '../report';\nimport { Context } from '../data/index';\n\nexport interface RenderContext {\n  parent?: RenderContext;\n  report: Displayed;\n  styles: StyleRegistry;\n  styleMap: StyleMap;\n  context: Context;\n  commit?: { [name: string]: any };\n}\n\nexport interface StyleRegistry {\n  [id: string]: string;\n}\n\ninterface StyleMap {\n  ids: { [id: string]: number };\n  styles: StyleRegistry;\n}\n\nexport function addStyle(context: RenderContext, id: string, style: string) {\n  if (!context.styles[id]) context.styles[id] = style;\n}\n\nexport function error(context: RenderContext, placement: Placement, message: string = 'Widget overflow error') {\n    addStyle(context, 'error', `.error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }`);\n    return { output: `<div class=\"error\" style=\"top: ${placement.y}rem;\">${message}</div>`, height: 2 };\n}\n","import { Displayed, Layout, Placement, Widget, Margin, MeasureFont, Computed, Borders } from '../report';\nimport { extend as extendContext, Context, ExtendOptions as ContextExtendOptions, evaluate, isValueOrExpr } from '../data/index';\nimport { error, RenderContext, addStyle } from './error';\n\nexport { RenderContext, error, addStyle } from './error';\n\nexport function isComputed(v: any): v is Computed {\n  return v && typeof v === 'object' && isValueOrExpr(v.x);\n}\n\nexport function maybeComputed<V, T = Exclude<V, Computed>>(v: V, context: RenderContext): T {\n  if (!isComputed(v)) return v as any;\n  else if (v.x) return evaluate(context, v.x);\n}\n\nexport interface ExtendOptions extends ContextExtendOptions {\n  commit?: { [key: string]: any };\n}\n\nexport function extend(context: RenderContext, opts: ExtendOptions): RenderContext {\n  return { parent: context, report: context.report, context: extendContext(context.context, opts), styles: context.styles, styleMap: context.styleMap, commit: opts.commit };\n}\n\nconst htmlChars = /[><&]/g;\nconst htmlReplace = { '<': '&lt;', '>': '&gt;', '&': '&amp;' };\nexport function escapeHTML(html: string): string {\n  return ('' + html).replace(htmlChars, m => htmlReplace[m] || '');\n}\n\nconst renderers: { [type: string]: Renderer } = {};\nexport function registerRenderer<T extends Widget = Widget, S = any>(type: string, renderer: ((widget: T, context: RenderContext, placement: Placement, state?: RenderState<S>) => RenderResult<S>) | Renderer<T, S>, options?: RendererOptions) {\n  renderers[type] = typeof renderer === 'function' ? { render: renderer } : renderer;\n  if (options) Object.assign(renderers[type], options);\n}\n\n/** Decent guesstimates for char width at 16px/em */\nconst avgs = {\n  sans: 7.4,\n  serif: 6.7,\n  mono: 7.85,\n  narrow: 5.9,\n}\n\n/** Text height measurement function for the given text, font, available width in rem, and line height in rem.\n * The text is assumed to be rendered as white-space: pre-wrap.\n */\nexport function measureEstimate(text: string, width: number, context: RenderContext, font?: MeasureFont): number {\n  const family = (font && maybeComputed(font.family, context)) || 'sans';\n  const size = (font && maybeComputed(font.size, context)) || 0.83;\n  const line = (font && maybeComputed(font.line, context)) || size;\n  const brw = font && 'break-word' in font ? font['break-word'] : true;\n  const avg = (((font && maybeComputed(font.metric, context)) || ((family === 'mono' || /fixed|mono/i.test(family) ? avgs.mono :\n    family === 'narrow' || /narrow|condensed/i.test(family) ? avgs.narrow :\n      family === 'sans' || /sans|arial|helvetica/i.test(family) ? avgs.sans :\n        avgs.serif))) * size) / 16;\n  \n  const lines = text.split(/\\r?\\n/g);\n  return lines.reduce((a, c) => {\n    const [word, lines] = c.split(/\\s|-/g).reduce((a, c) => {\n      const wlen = (c.length + 1) * avg;\n      if (a[0] + wlen > width) {\n        if (a[0] === 0 || wlen > width) {\n          if (brw) {\n            a[0] = (wlen - (width - a[0])) % width;\n            if (wlen > width) a[1] += Math.floor(wlen / width);\n          }\n          a[1]++;\n        } else {\n          a[0] = wlen;\n          a[1]++;\n        }\n      } else {\n        a[0] += wlen;\n      }\n      return a;\n    }, [0, 0]);\n    return a + ((lines + (word > 0 ? 1 : 0)) || 1);\n  }, 0) * line;\n}\n\n/** Text height measurement function for the given text, font, available width in rem, and line height in rem.\n * The text is assumed to be rendered as white-space: pre-wrap.\n */\nexport let measure: (text: string, width: number, context: RenderContext, font?: MeasureFont) => number = measureEstimate;\n\nexport interface RenderContinuation<T = any> {\n  output: string;\n  continue?: RenderState<T>;\n  height?: number;\n  width?: number;\n  cancel?: boolean;\n}\n\nexport type RenderResult<T = any> = string|RenderContinuation<T>;\n\nexport interface Renderer<T extends Widget = Widget, S = any> extends RendererOptions {\n  render(widget: T, context: RenderContext, placement: Placement, state?: RenderState<S>): RenderResult;\n}\n\nexport interface RendererOptions {\n  container?: boolean;\n}\n\nexport interface RenderState<T = any> {\n  child?: RenderState;\n  last?: number;\n  state?: T;\n  offset: number;\n  attempt?: number;\n}\n\n/** Render the given widget to string or a continuation using a registered renderer */\nexport function renderWidget(w: Widget, context: RenderContext, placement: Placement, state?: RenderState): RenderContinuation {\n  const renderer = renderers[w.type];\n  if (!renderer || (w.hide && evaluate(extendContext(context.context, { special: { widget: w, placement } }), w.hide))) return { output: '', height: 0 };\n\n  if (!('height' in w) && renderer.container) w.height = 'auto'; \n  const h = getHeightWithMargin(w, placement, context);\n\n  if (placement.maxY && !isNaN(h) && h > placement.maxY) return error(context, placement);\n\n  if (placement.availableY != null && h > placement.availableY) return { output: '', continue: { offset: 0 }, cancel: true };\n\n  let extraHeight = 0;\n\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    extraHeight += m[0] + m[2];\n    if (placement.availableY != null) placement.availableY -= m[0] + m[2];\n  }\n\n  if (w.border && !h && w.box === 'expand') {\n    const b = expandBorder(w, context, placement)\n    extraHeight += b[0] + b[2];\n    if (placement.availableY != null) placement.availableY -= b[0] + b[2];\n  }\n\n  const r = renderer.render(w, context, placement, state);\n  if (typeof r === 'string') return { output: r, height: h, width: getWidthWithMargin(w, placement, context) };\n\n  if (typeof r.height === 'number') r.height = +r.height.toFixed(6);\n  if (typeof r.width === 'number') r.width = +r.width.toFixed(6);\n  if (placement.availableY != null) placement.availableY = +placement.availableY.toFixed(6);\n  \n  if (placement.maxY && r.height > placement.maxY) return error(context, placement);\n\n  if (isNaN(h) && placement.availableY != null && r.height > placement.availableY) return { output: '', continue: { offset: 0 }, height: r.height || 0, cancel: true };\n\n  r.height = r.height || 0;\n\n  r.height += extraHeight;\n\n  r.height = +(r.height.toFixed(6));\n\n  return r;\n}\n\nconst layouts: { [name: string]: (widget: Widget, offset: number, margin: [number, number, number, number], placement: Placement, placements: Array<[number, number, number, number]>, context: RenderContext) => Placement } = {};\n\nexport function registerLayout(name: string, layout: (widget: Widget, offset: number, margin: [number, number, number, number], placement: Placement, placements: Array<[number, number, number, number]>, context: RenderContext) => Placement) {\n  layouts[name] = layout;\n}\n\nregisterLayout('row', (w, o, m, p, ps, context) => {\n  let n: Placement;\n  let br = isComputed(w.br) ? evaluate(extendContext(context.context, { special: { placement: p, widget: w } }), w.br.x) : w.br;\n  let availableX = p.maxX - ps[0][0] - ps[0][2] + ps[ps.length - 1][0];\n  if (availableX <= 0) {\n    availableX = p.maxX;\n    br = true;\n  }\n  if (br || ps[0][0] + ps[0][2] + getWidthWithMargin(w, { x: p.x, y: p.y, maxX: p.maxX, maxY: p.maxY, availableY: p.availableY, availableX }, context) - ps[ps.length - 1][0] > p.maxX) {\n    n = { x: m[3], y: maxYOffset(ps), availableX: p.maxX, maxX: p.maxX };\n    n.availableY = p.availableY - (n.y - o);\n  } else {\n    n = { x: ps[0][0] + ps[0][2], y: ps[0][1], availableX, maxX: p.maxX, availableY: p.availableY };\n  }\n\n  n.y -= o;\n\n  return n;\n});\n\n/** Render child widgets handling continuation across pages */\nexport function renderWidgets(widget: Widget, context: RenderContext, placement: Placement, state?: RenderState, layout?: Layout): RenderContinuation {\n  if (Array.isArray(widget.widgets)) {\n    let s = '';\n    const offset = (state || { offset: 0 }).offset;\n    const ps: Array<[number, number, number, number]> = [[0, offset, 0, 0]];\n\n    const m = expandMargin(widget, context, placement);\n    ps[0][0] += m[3];\n    ps[0][1] += m[0];\n\n    // placement starts with availableY shrunk for margins, so offset y by the top margin\n    const yo = m[0] || 0;\n\n    if (widget.border && widget.box === 'expand') {\n      const b = expandBorder(widget, context, placement);\n      if (placement.availableX != null) placement.availableX -= b[1] + b[3];\n      if (placement.availableY != null) placement.availableY -= b[0] + b[2];\n    }\n\n    for (let i = state && state.last || 0; i < widget.widgets.length; i++) {\n      let w: Widget = widget.widgets[i];\n      if (w.macro) w = expandMacro(w.macro, w, context, placement, state);\n      if (w.hide && evaluate(extendContext(context.context, { special: { widget: w, placement } }), w.hide)) continue;\n\n      // allow widgets that are taller than max height to be dropped\n      let h = placement && getHeightWithMargin(w, placement, context);\n      if (h > placement.maxY) h = 1;\n\n      if (placement && placement.availableY != null && h > placement.availableY) {\n        const offset = maxYOffset(ps);\n        state = state || { offset };\n        state.last = i;\n        return { output: s, continue: state, height: offset };\n      } else {\n        let lp = Array.isArray(layout) && (layout[i] || [0, 0]);\n        if (!lp || !Array.isArray(lp)) lp = [0, 0];\n        if (!lp[0]) lp[0] = 0;\n        if (!lp[1]) lp[1] = 0;\n        let p: Placement = Array.isArray(lp) ? { x: lp[0] < 0 ? lp[0] : lp[0] + m[3], y: lp[1] < 0 ? lp[1] : lp[1] + m[0], maxX: placement.maxX } : (lp || placement);\n        if (Array.isArray(lp)) p.availableX = p.maxX;\n\n        if (!layout || typeof layout === 'string') {\n          const l = layout ? layouts[layout as string] || layouts.row : layouts.row;\n          p = l(w, offset, m, placement, ps, context);\n          if (h > p.availableY) {\n            if (w.height === 'grow') h = getHeightWithMargin(w, p, context);\n            if (h > p.availableY) {\n              const offset = maxYOffset(ps);\n              state = state || { offset };\n              state.last = i;\n              return { output: s, continue: state, height: offset };\n            }\n          }\n        }\n\n        p.maxX = p.maxX || placement.maxX;\n        p.maxY = p.maxY || placement.maxY;\n\n        if (p.x < 0) {\n          p.offsetX = m[3];\n          p.x = (placement.availableX || 1) + p.x - getWidthWithMargin(w, placement, context) + 1;\n        }\n        if (p.y < 0) {\n          p.offsetY = m[0];\n          if (placement.availableY == null) p.y = 0;\n          else p.y = (placement.availableY || 1) + p.y - h + 1;\n        }\n\n        const { x, y } = p;\n        const r = renderWidget(w, context, p, state && state.child);\n\n        // skip empty output\n        if (typeof r === 'string' && !r || (!r.cancel && !r.output && !r.continue && !r.height)) continue;\n\n        if (typeof r === 'string') {\n          s += r;\n          ps.unshift([x, y, getWidthWithMargin(w, placement, context), getHeightWithMargin(w, placement, context)]);\n        } else {\n          if (r.cancel) return { output: '', cancel: true };\n          const h = r.height || getHeightWithMargin(w, placement, context) || 0;\n          if (y - yo + h > placement.availableY) {\n            const offset = maxYOffset(ps);\n            state = state || { offset };\n            state.last = i;\n            state.attempt = (+state.attempt || 0) + 1;\n            if (state.attempt > 1) return error(context, placement);\n            return { output: s, continue: state, height: offset };\n          }\n          s += r.output;\n          ps.unshift([x, y, r.width || getWidthWithMargin(w, placement, context), h]);\n          if (r.continue) {\n            state = state || { offset: 0 };\n            state.child = r.continue;\n            state.last = i;\n            state.offset = maxYOffset(ps);\n            return { output: s, continue: state, height: maxYOffset(ps), width: maxXOffset(ps) };\n          }\n        }\n\n        if (p.availableX === 0) ps[0][2] = p.maxX;\n      }\n    }\n\n    return { output: s, height: getHeightWithMargin(widget, placement, context) || maxYOffset(ps) - m[0], width: getWidthWithMargin(widget, placement, context) || maxXOffset(ps) - m[3] };\n  }\n  return { output: '', height: 0 };\n}\n\nexport function getWidth(w: Widget, placement: Placement, context: RenderContext): number {\n  let width = isComputed(w.width) ? evaluate(extendContext(context.context, { special: { widget: w, placement} }), w.width.x) : w.width;\n  const m = w.margin && expandMargin(w, context, placement);\n  let pct = false;\n  if (width === 'grow') width = placement.availableX || placement.maxX;\n  else if (!width && width !== 0) width = placement.maxX || 51;\n  else if (typeof width === 'number') width;\n  else {\n    width = +((width.percent / 100) * (placement.maxX || 51)).toFixed(4);\n    pct = true;\n  }\n  if (typeof width === 'number' && (w.box === 'contain' || (pct || width === placement.availableX) && w.box !== 'expand')) {\n    if (m) width -= m[1] + m[3];\n    else if (w.font && w.font.right) width -= w.font.right;\n  }\n  return width;\n}\n\nexport function getWidthWithMargin(w: Widget, placement: Placement, context: RenderContext): number {\n  let r = getWidth(w, placement, context);\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    r += m[1] + m[3];\n  } else if (w.font && w.font.right) {\n    r += w.font.right;\n  }\n  return r;\n}\n\nfunction maxFontSize(w: Widget) {\n  let n = w.height || 1;\n  if (w.font && w.font.size > n) n = w.font.size;\n  if ('text' in w && Array.isArray(w.text)) {\n    for (let i = 0; i < w.text.length; i++) {\n      const t = w.text[i];\n      if (typeof t === 'object' && 'font' in t && t.font && t.font.size > n) n = t.font.size;\n    }\n  }\n  return n;\n}\n\nexport function getHeight(w: Widget, placement: Placement, context: RenderContext, computed?: number, linesize?: boolean): number {\n  let r = 1;\n  let h = isComputed(w.height) ? evaluate(extendContext(context.context, { special: { widget: w, placement, computed, linesize } }), w.height.x) : w.height;\n  const m = w.margin && expandMargin(w, context, placement);\n  const b = w.border && expandBorder(w, context, placement);\n  let pct = false;\n  if (h == null && linesize) h = maxFontSize(w);\n\n  if (typeof h === 'number') r = h;\n  else if (h && typeof h === 'object' && 'percent' in h && h.percent && placement.maxY) {\n    r = +(placement.maxY * (h.percent / 100)).toFixed(4);\n    pct = true;\n  } else if (h === 'grow') {\n    r = placement.availableY || 0;\n  } else if (h === 'auto' || typeof h === 'string' || (h == null && w.type === 'container') || (computed && !h)) {\n    if (b && w.box === 'expand') return computed + b[0] + b[2] || NaN;\n    return computed || NaN;\n  }\n\n  if (typeof r === 'number' && (w.box === 'contain' || (pct || r === placement.availableY) && w.box !== 'expand')) {\n    if (m) r -= m[0] + m[2];\n  }\n\n  return r;\n}\n\nexport function getHeightWithMargin(w: Widget, placement: Placement, context: RenderContext, computed?: number, linesize?: boolean): number {\n  let h = getHeight(w, placement, context, computed, linesize);\n  if (typeof h === 'number' && w.margin) {\n    const m = expandMargin(w, context, placement);\n    h += m[0] + m[2];\n  }\n  return h;\n}\n\nfunction maxYOffset(points: Array<[number, number, number, number]>): number {\n  return points.reduce((a, c) => a > c[1] + c[3] ? a : c[1] + c[3], 0);\n}\n\nfunction maxXOffset(points: Array<[number, number, number, number]>): number {\n  return points.reduce((a, c) => a > c[0] + c[2] ? a : c[0] + c[2], 0);\n}\n\nexport function expandMargin(w: { margin?: Margin|Computed }, context: RenderContext, placement: Placement): [number, number, number, number] {\n  if (w.margin) {\n    const m = isComputed(w.margin) ? evaluate(extendContext(context.context, { special: { widget: w, placement} }), w.margin.x) : w.margin;\n    if (Array.isArray(m)) {\n      if (m.length === 4) return m.map(e => +e) as [number, number, number, number];\n      else if (m.length === 2) return [+m[0], +m[1], +m[0], +m[1]];\n    } else if (typeof m === 'number') return [m, m, m, m];\n  }\n\n  return [0, 0, 0, 0];\n}\n\nexport function expandBorder(w: { border?: number|number[]|Borders|string }, context: RenderContext, placement: Placement): [number, number, number, number] {\n  let b = w.border;\n  let res: [number, number, number, number] = [0, 0, 0, 0];\n  if (typeof b === 'string' || (b && !Array.isArray(b) && typeof b === 'object' && ('v' in b || 'r' in b || 'op' in b))) b = evaluate(extendContext(context.context, { special: { widget: w, placement } }), b as string);\n  if (typeof b === 'number') res = [0, 0, b, 0];\n  else if (Array.isArray(b)) {\n    if (b.length === 1) res = [b[0], b[0], b[0], b[0]];\n    else if (b.length === 2) res = [b[0], b[1], b[0], b[1]];\n    else if (b.length === 3) res = [b[0], b[1], b[2], b[1]];\n    else if (b.length >= 4) res = [b[0], b[1], b[2], b[3]];\n  } else if (b && typeof b === 'object') res = [b.top || 0, b.right || 0, b.bottom || 0, b.left || 0]\n\n  for (let i = 0; i < 4; i++) res[i] = res[i] * 0.0625;\n  return res;\n}\n\nexport function expandMacro(macro: string, w: Widget, ctx: RenderContext, placement: Placement, state: RenderState): Widget {\n  const res = evaluate(extendContext(ctx.context, { special: { widget: w, placement, state } }), macro);\n  const orig = w;\n  if (res && !Array.isArray(res) && typeof res === 'object') {\n    if ('content' in res || 'props' in res || 'properties' in res) w = Object.assign({}, w, res.props, res.properties, { widgets: Array.isArray(res.content) ? res.content : res.content ? [res.content] : w.widgets, macro: undefined });\n    else if ('replace' in res && res.replace && typeof res.replace === 'object' && 'type' in res.replace) return res.replace;\n    else w = Object.assign({}, w, { widgets: [res], macro: undefined });\n  } else if (Array.isArray(res)) w = Object.assign({}, w, { widgets: res, macro: undefined });\n  return w;\n}\n","import { Borders, Font, Placement, Widget } from '../report';\nimport { expandMargin, expandBorder, getHeightWithMargin, maybeComputed, getWidthWithMargin, RenderContext } from './index';\nimport { ValueOrExpr } from '../data/index';\n\nexport interface StyleOptions {\n  computedHeight?: number;\n  container?: boolean;\n  lineSize?: boolean;\n  font?: Font;\n}\n\nexport function nextStyleId(ctx: RenderContext, prefix: string): number {\n  if (!ctx.styleMap.ids[prefix]) ctx.styleMap.ids[prefix] = 0;\n  return ctx.styleMap.ids[prefix]++;\n}\n\nexport function mapStyle(ctx: RenderContext, style: string, prefix: string): string {\n  if (!style) return '';\n  const mapped = ctx.styleMap.styles[style];\n  if (mapped) return mapped;\n  const id = `${prefix}${nextStyleId(ctx, prefix)}`;\n  return ctx.styleMap.styles[style] = id;\n}\n\nexport function styleClass(ctx: RenderContext, cls: string[], [style, inline]: [string, string], inlineStyle?: string, classPrefix?: string): string {\n  if (ctx.report.classifyStyles !== false) {\n    const cs = [];\n    if (inline) cs.push(mapStyle(ctx, inline, 'h'));\n    cs.push(mapStyle(ctx, style, classPrefix || 's'));\n    return ` class=\"${cls.concat(cs).join(' ')}\"${inlineStyle ? ` style=\"${inlineStyle}\"` : ''}`;\n  } else {\n    const s = `${style}${inlineStyle || ''}${inline || ''}`;\n    const c = `${cls.length ? ` class=\"${cls.join(' ')}\"` : ''}`;\n    return `${c}${s ? ` style=\"${s}\"` : ''}`;\n  }\n}\n\nexport function style(w: Widget, placement: Placement, context: RenderContext, opts?: StyleOptions): [string, string] {\n  let s = `left:${(placement.x || 0) + (placement.offsetX || 0)}rem;top:${((placement.y || 0) + (placement.offsetY || 0))}rem;`;\n  let i = ``;\n\n  s += `width:${getWidthWithMargin(w, placement, context)}rem;`;\n\n  let h = getHeightWithMargin(w, placement, context, opts && opts.computedHeight, opts && opts.lineSize) || 1;\n  if (w.height === 'grow' && w.margin) {\n    const m = expandMargin(w, context, placement);\n    h += m[0] + m[2];\n  }\n  if (opts && opts.container && opts.computedHeight) i = `height:${h}rem;`;\n  else s += `height:${h}rem;`;\n\n  const line = w.font && maybeComputed(w.font.line, context);\n  const size = w.font && maybeComputed(w.font.size, context);\n  if (line != null || size != null) s += `line-height: ${line ?? size}rem;`;\n\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    if (m[0] || m[1] || m[2] || m[3]) s += `padding:${m[0]}rem ${m[1]}rem ${m[2]}rem ${m[3]}rem;`;\n  } else if (w.font && w.font.right) {\n    s += `padding-right:${w.font.right}rem;`;\n  }\n  \n  if ((opts && opts.font) || w.font) s += styleFont((opts && opts.font) || w.font, context);\n  if (w.border) s += styleBorder(w, context, placement);\n\n  s += styleExtra(w, context);\n\n  return [s, i];\n}\n\nexport function styleExtra(w: { bg?: ValueOrExpr; radius?: ValueOrExpr }, context: RenderContext): string {\n  let s = '';\n\n  const bg = maybeComputed(w.bg, context);\n  if (bg) s += `background-color:${bg};`;\n\n  const radius = maybeComputed(w.radius, context);\n  if (radius) s += `border-radius:${radius};`;\n\n  return s;\n}\n\nexport function styleFont(f: Font, context: RenderContext): string {\n  if (!f) return '';\n  let t: any;\n  let size: any;\n  let s = '';\n  if (t = maybeComputed(f.family, context)) s += `font-family:${t};`;\n  if (t = maybeComputed(f.color, context)) s += `color:${t};`;\n  if (t = maybeComputed(f.align, context)) s += `text-align:${t};`;\n  if (t = maybeComputed(f.size, context)) {\n    s += `font-size:${t}rem;`;\n    size = t;\n  }\n\n  t = maybeComputed(f.line, context);\n  if (t === 0) s += `line-height:initial;`;\n  else if (t != null) s += `line-height:${t}rem;`;\n  else if (size) s += `line-height:${size}rem;`;\n\n  if (t = maybeComputed(f.weight, context)) s += `font-weight:${t};`;\n  if (t = maybeComputed(f.pre, context)) s += `white-space:pre-wrap;word-break:break-word;`;\n  const pre = t;\n  if (t = maybeComputed(f.clamp, context)) s += `${pre ? '' : 'white-space:nowrap;'}overflow:hidden;`;\n  return s;\n}\n\nexport function styleBorder(w: { border?: number|Borders|number[]|string }, context: RenderContext, placement: Placement): string {\n  const b = expandBorder(w, context, placement);\n  if (b[0] + b[1] + b[2] + b[3]) return `border-style:solid;border-width:${b[0]}rem ${b[1]}rem ${b[2]}rem ${b[3]}rem;`;\n  return '';\n}\n\nexport function styleImage(fit?: string): [string, string] {\n  const s = `background-size:${!fit || fit === 'contain' ? 'contain;background-position:center' : fit === 'stretch' ? '100% 100%' : 'cover'};`;\n  \n  return [s, ''];\n}\n","import { Sort, ValueOrExpr, Parameter, ParameterMap, SourceMap, Root, Context, RootContext, extend, evaluate, filter, toDataSet } from './data/index';\n\nimport { renderWidget, RenderContext, RenderResult, RenderState, expandMargin, expandMacro } from './render/index';\nimport { styleClass, styleFont } from './render/style';\n\nimport { parse } from './data/parse';\nimport { parse as parseTemplate } from './data/parse/template';\n\nexport type ReportType = 'delimited'|'flow'|'page';\n\nexport type Report<T = {}> = Delimited<T> | Flow<T> | Page<T>;\n\nexport interface PartSource {\n  /** Filters to apply to the base value of the data source */\n  filter?: ValueOrExpr;\n  /** Sorts to apply to the base value of the data source */\n  sort?: Sort[]|ValueOrExpr;\n  /** Groupings to apply to the base data source */\n  group?: Array<ValueOrExpr>|ValueOrExpr;\n  /** An expression to apply to the base data source before filtering, sorting, or grouping */\n  base?: ValueOrExpr;\n  /** The name of the data source to be pulled from the root context */\n  source: string;\n}\n\nexport interface ReportSource extends PartSource {\n  /** The destination for the applied source, defaults to the source */\n  name?: string;\n  /** A user-friendly name for the source */\n  label?: string;\n  parameters?: { [name: string]: ValueOrExpr };\n}\n\ninterface BaseReport<T = {}> {\n  type: ReportType;\n  name?: string;\n  parameters?: Parameter<T>[];\n  sources?: ReportSource[];\n  /** An initial value for the root context. */\n  context?: ParameterMap;\n  /** An additional context expression to be merged with any fixed context just before the report is run. */\n  extraContext?: ValueOrExpr;\n  classifyStyles?: boolean;\n  defaultParams?: ParameterMap;\n}\n\n// delimited\nexport interface Delimited<T = {}> extends BaseReport<T> {\n  type: 'delimited';\n  source?: string;\n  fields: ValueOrExpr[];\n  headers?: ValueOrExpr[];\n  record?: string;\n  field?: string;\n  quote?: string;\n  rowContext?: ValueOrExpr;\n}\n\nexport interface Displayed<T = {}> extends BaseReport<T> {\n  widgets: Widget[];\n  font?: {\n    family?: string;\n    color?: string;\n    size?: number;\n    line?: number;\n  };\n  watermark?: Container;\n  overlay?: Container;\n}\n\n// flow\nexport interface Flow<T = {}> extends Displayed<T> {\n  type: 'flow';\n  width?: number;\n  margin?: Margin;\n  size?: PageSize;\n  orientation?: PageOrientation;\n}\n\n// page\nexport interface Page<T = {}> extends Displayed<T> {\n  type: 'page';\n  header?: Container & { outer?: boolean };\n  footer?: Container & { outer?: boolean };\n  size: PageSize;\n  orientation?: PageOrientation;\n  margin?: Margin;\n}\n\nexport type Dimension = number|{ percent: number };\n\nexport interface PageSize {\n  width: number;\n  height: number;\n  margin: [number, number];\n}\n\nexport type PageOrientation = 'portrait'|'landscape';\nexport const PageSizes: { [name: string]: PageSize } = {\n  letter: {\n    width: 51,\n    height: 66,\n    margin: [1.5, 1.5],\n  },\n  legal: {\n    width: 51,\n    height: 84,\n    margin: [1.5, 1.5],\n  },\n  tabloid: {\n    width: 66,\n    height: 102,\n    margin: [1.5, 1.5],\n  },\n  a4: {\n    width: 49.606302,\n    height: 70.15746,\n    margin: [1.5, 1.5],\n  }\n};\n\nexport function pageOffset(num: number, size: PageSize): number {\n  return num * size.height + size.margin[0];\n}\n\n// Attributes\nexport interface Font {\n  size?: number|Computed;\n  family?: string|Computed;\n  weight?: number|Computed;\n  color?: string|Computed;\n  align?: 'left'|'right'|'center'|'justify'|Computed;\n  line?: number|Computed;\n  right?: number;\n  pre?: boolean|Computed;\n  clamp?: boolean|Computed;\n}\n\nexport interface Placement {\n  x: number;\n  y: number;\n  availableX?: number;\n  availableY?: number;\n  maxX?: number;\n  maxY?: number;\n  offsetX?: number;\n  offsetY?: number;\n}\nexport type Layout = Array<[number, number]>|Placement[]|'row'|string;\n\nexport interface Borders {\n  top?: number;\n  left?: number;\n  bottom?: number;\n  right?: number;\n}\n\nexport interface Style {\n  font?: Font;\n  border?: number|Borders|number[]|string;\n}\n\nexport type Margin = number|[number, number]|[number, number, number, number];\n\nexport interface Computed {\n  x: ValueOrExpr;\n}\n\n// Widgets\nexport interface Widget extends Style {\n  type: string;\n  width?: Dimension|Computed|'grow'; // default 100%\n  height?: Dimension|'auto'|Computed|'grow'; // optional, defaulting to 1\n  margin?: Margin|Computed;\n  box?: 'expand'|'contain';\n  hide?: ValueOrExpr;\n  br?: boolean|Computed;\n  bg?: ValueOrExpr;\n  radius?: ValueOrExpr;\n\n  // container\n  widgets?: Widget[];\n  layout?: Layout;\n  context?: ValueOrExpr;\n  bridge?: boolean;\n  macro?: string;\n\n  // label\n  text?: ValueOrExpr|Array<ValueOrExpr|Span>;\n  format?: LabelFormat;\n  id?: string;\n  styled?: boolean;\n\n  // image\n  url?: ValueOrExpr;\n  fit?: 'cover'|'stretch'|Computed;\n\n  // html\n  html?: ValueOrExpr;\n\n  // repeater\n  source?: PartSource|ValueOrExpr;\n  header?: Container;\n  group?: Container[];\n  groupEnds?: boolean[];\n  groupHeaders?: boolean[];\n  row?: Container;\n  footer?: Container;\n  alternate?: Container;\n  headerPerPage?: boolean;\n\n  // repeater row\n  elide?: boolean|Computed;\n}\n\nexport interface Container extends Widget {\n  widgets: Widget[];\n  layout?: Layout;\n  context?: ValueOrExpr;\n  bridge?: boolean;\n  elide?: boolean|Computed;\n  macro?: string;\n}\n\nexport interface Image extends Widget {\n  url: ValueOrExpr;\n  fit?: 'cover'|'stretch'|Computed;\n}\n\nexport interface Span {\n  text: ValueOrExpr;\n  font?: Font;\n  bg?: ValueOrExpr;\n  radius?: ValueOrExpr;\n  id?: string;\n}\nexport interface LabelFormat {\n  name: string;\n  args?: ValueOrExpr[];\n}\nexport interface Label extends Widget {\n  text: ValueOrExpr|Array<ValueOrExpr|Span>;\n  format?: LabelFormat;\n  id?: string;\n  styled?: boolean;\n}\n\nexport interface HTML extends Widget {\n  html: ValueOrExpr;\n}\n\nexport interface Repeater extends Widget {\n  source: PartSource|ValueOrExpr;\n  header?: Container;\n  group?: Container[];\n  groupEnds?: boolean[];\n  groupHeaders?: boolean[];\n  row: Container;\n  footer?: Container;\n  alternate?: Container;\n  headerPerPage?: boolean;\n  headerRepeat?: number;\n}\n\nexport interface MeasureFont {\n  /** The font family for the label. The built-in estimator only works with sans, serif, narrow, and mono fonts, which should be relatively metric-compatible with Arial, Times New Roman, Arial Narrow, and, well, any fixed-width font. */\n  family?: 'sans'|'serif'|'narrow'|'mono'|string|Computed;\n  /** Font size in rem, where 1rem is 16px or 12pt based on the report html element style */\n  size?: number|Computed;\n  /** The line-height of the rendered font in rem */\n  line?: number|Computed;\n  /** Average width in px at font-size 16px. If this is supplied, it won't be guessed based on the font name. */\n  metric?: number|Computed;\n  /** Break words that exceed the line length */\n  'break-word'?: boolean;\n}\n\nexport interface MeasuredLabel extends Widget {\n  font?: MeasureFont;\n  text: ValueOrExpr;\n}\n\n// execution\ninterface ReportExtras {\n  /** Extra content to be rendered at the bottom of the <head> */\n  head?: string;\n  /** Extra content to be rendered at the bottom of the <body> */\n  foot?: string;\n  /** Run a delimited report to a table instead of using the defined delimiters */\n  table?: boolean;\n  /** Run a rendered report as a delimited report */\n  delimited?: boolean;\n  /** Record delimiter if running a rendered report as a delimited report */\n  record?: string;\n  /** Field delimiter if running a rendered report as a delimited report */\n  field?: string;\n  /** Field quoter if running a rendered report as a delimited report */\n  quote?: string;\n}\n\n/** Initialize a parameter map based on the parameters defined by the given report. */\nexport function initParameters(report: Report, sources: SourceMap, parameters?: ParameterMap|Root): ParameterMap {\n  const ctx = parameters && 'root' in parameters && parameters.root === parameters ? parameters as Root : new Root(Object.assign({}, report.context), { parameters });\n  ctx.parameters = Object.assign({}, report.defaultParams, ctx.parameters);\n  const inits: ParameterMap = {};\n\n  if (report.sources) applySources(ctx, report.sources, sources);\n\n  if (Array.isArray(report.parameters)) {\n    for (const p of report.parameters) {\n      if (p.init && p.name) {\n        inits[p.name] = evaluate(ctx, p.init);\n      }\n    }\n  }\n\n  return inits;\n}\n\n/** Run the given report to string. If the report is displayed, the result will be HTML. Otherwise, it will be plain text. */\nexport function run(report: Report, sources: SourceMap, parameters?: ParameterMap|Root, extra?: ReportExtras): string {\n  const ctx = parameters && 'root' in parameters && parameters.root === parameters ? parameters as Root : new Root(Object.assign({}, report.context), { parameters });\n\n  if (report.sources) applySources(ctx, report.sources, sources);\n  ctx.parameters = Object.assign({}, initParameters(report, sources), ctx.parameters);\n\n  if (report.extraContext) {\n    const res = evaluate(ctx, report.extraContext);\n    if (res && typeof res === 'object') ctx.value = Object.assign(ctx.value, res);\n  }\n\n  if (report.type === 'delimited') return runDelimited(report, ctx, { table: extra?.table });\n  else if (extra?.delimited) return runAsDelimited(report, ctx, extra);\n  else if (report.type === 'flow') return runFlow(report, ctx, extra);\n  else return runPage(report, ctx, extra);\n}\n\n/** Apply multiple sources to a context together. Each source base is available before filter/sort/group is applied in case a source needs to reference a later source for those purposes. */\nexport function applySources(context: RootContext, sources: ReportSource[], map: SourceMap) {\n  const srcs = context.sources;\n  for (const source of sources) {\n    let base = map[source.source || source.name] || { value: [] };\n    if (source.base) base = evaluate(extend(context, { value: base.value, special: { source: base } }), source.base);\n    srcs[source.name || source.source] = toDataSet(base);\n  }\n\n  for (const source of sources) {\n    if (source.filter || source.sort || source.group) srcs[source.name || source.source] = filter(srcs[source.name || source.source], source.filter, source.sort, source.group, context);\n  }\n}\n\nexport function applySource(context: RootContext, source: ReportSource, sources: SourceMap) {\n  let base = sources[source.source || source.name] || { value: [] };\n  if (source.base) base = { value: evaluate(extend(context, { value: base.value, special: { source: base } }), source.base) };\n  if (source.filter || source.sort || source.group) context.sources[source.name || source.source] = filter(base, source.filter, source.sort, source.group, context);\n  else context.sources[source.name || source.source] = toDataSet(base);\n}\n\nfunction runDelimited(report: Delimited, context: Context, options?: { table?: boolean }): string {\n  const source = context.root.sources[report.source ? report.source : (report.sources[0].name || report.sources[0].source)];\n  const values = Array.isArray(source.value) ?\n    source.value :\n    typeof source.value === 'object' && 'grouped' in source.value && Array.isArray(source.value.all) ? // watch out for grouped sources\n      source.value.all :\n      [source.value];\n  let fields = report.fields;\n  let headers = report.headers;\n\n  if ((!fields || !fields.length) && values.length && typeof values[0] === 'object' && values[0]) {\n    fields = Object.keys(values[0]);\n    if (Array.isArray(values[0])) fields = fields.map(i => `_.${i}`);\n    else if (!headers || !headers.length) headers = Object.keys(values[0]);\n  }\n\n  if (!fields) fields = [];\n\n  let res = '';\n  if (headers) {\n    const ctx = extend(context, { parser: parseTemplate });\n    if (options?.table) res += `<thead><tr><th class=index></th>${headers.map(h => `<th>${evaluate(ctx, h)}</th>`).join('')}</tr></thead>`;\n    else res += headers.map(h => `${report.quote || ''}${evaluate(ctx, h)}${report.quote || ''}`).join(report.field || ',') + (report.record || '\\n');\n  }\n\n  if (options?.table) {\n    res += '<tbody>'\n    let idx = 1;\n    for (const value of values) {\n      const c = extend(context, { value, special: { index: idx - 1 } });\n      if (report.rowContext) {\n        if (!c.locals) c.locals = {};\n        const v = evaluate(c, report.rowContext);\n        if (v) c.value = v;\n      }\n      res += `<tr><th class=index>${idx}</th>${fields.map(f => {\n        let val = f ? evaluate(c, f) : '';\n        if (val === undefined) val = '';\n        if (typeof val !== 'string') {\n          const v = val;\n          val = `${v}`;\n          if (val.slice(0, 7) === '[object') val = JSON.stringify(v);\n        }\n        return `<td>${val}</td>`;\n      }).join('')}</tr>`;\n      idx++;\n    }\n    res += '</tbody>';\n    res = `<table>${res}</table>`;\n  } else {\n    const unquote: RegExp = report.quote ? new RegExp(report.quote, 'g') : undefined;\n    let index = 0;\n    for (const value of values) {\n      const c = extend(context, { value, special: { index } });\n      if (report.rowContext) {\n        if (!c.locals) c.locals = {};\n        const v = evaluate(c, report.rowContext);\n        if (v) c.value = v;\n      }\n      res += fields.map(f => {\n        let val = f ? evaluate(c, f) : '';\n        if (val === undefined) val = '';\n        if (typeof val !== 'string') {\n          const v = val;\n          val = `${v}`;\n          if (val.slice(0, 7) === '[object') val = JSON.stringify(v);\n        }\n        if (unquote) val = val.replace(unquote, report.quote + report.quote);\n        return `${report.quote || ''}${val}${report.quote || ''}`;\n      }).join(report.field || ',') + (report.record || '\\n');\n      index++;\n    }\n  }\n\n  return res;\n}\n\nfunction runPage(report: Page, context: Context, extras?: ReportExtras): string {\n  let size: PageSize = report.orientation !== 'portrait' ? { width: report.size.height, height: report.size.width, margin: [report.size.margin[1], report.size.margin[0]] } : report.size;\n\n  const ctx: RenderContext = { context, report, styles: {}, styleMap: { ids: {}, styles: {} } };\n  const margin = expandMargin(report, ctx, { x: 0, y: 0 });\n  context.special = context.special || {};\n  context.special.page = 0;\n  context.special.pages = 0;\n\n  const pages: string[] = [''];\n  let page = 0;\n  const printX = size.width - 2 * size.margin[1];\n  const printY = size.height - 2 * size.margin[0];\n  let availableY = printY - margin[0] - margin[2];\n  const pageY = availableY;\n  let maxY = availableY;\n  let y = 0;\n  const availableX = printX - margin[1] - margin[3];\n  let state: RenderState<any> = null;\n\n  let headSize = 0;\n  if (report.header) {\n    const r = renderWidget(report.header, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY });\n    headSize = r.height;\n    if (!report.header?.outer) {\n      availableY -= headSize;\n      maxY -= headSize;\n      y += headSize;\n    }\n  }\n\n  let footSize = 0;\n  if (report.footer) {\n    const r = renderWidget(report.footer, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY });\n    footSize = r.height;\n    if (!report.footer?.outer) {\n      availableY -= footSize;\n      maxY -= footSize;\n    }\n  }\n\n  for (let w of report.widgets || []) {\n    if (w.macro) w = expandMacro(w.macro, w, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY }, state);\n    let r: RenderResult;\n    do {\n      context.special.page = page + 1;\n      r = renderWidget(w, ctx, { x: 0, y, availableX, availableY, maxX: availableX, maxY }, state);\n      pages[page] += r.output;\n      if (r.continue) {\n        page++;\n        pages[page] = '';\n        y = report.header?.outer ? 0 : headSize;\n        availableY = printY - (report.header?.outer ? 0 : headSize) - (report.footer?.outer ? 0 : footSize) - margin[0] - margin[2];\n        state = r.continue;\n      } else {\n        y += r.height;\n        availableY -= r.height;\n        state = null;\n      }\n    } while (state !== null)\n  }\n\n  context.special.pages = pages.length;\n  const footPlace = report.footer?.outer ?\n    { x: 0, y: printY - footSize, maxX: printX, maxY: printY } :\n    { x: 0 + margin[3], y: printY - margin[0] - footSize, maxX: printX - margin[3] - margin[1], maxY: printY - margin[0] - margin[2] };\n  const headPlace = report.header?.outer ?\n    { x: 0, y: 0, maxX: printX, maxY: printY } :\n    { x: 0 + margin[3], y: margin[0], maxX: printX - margin[3] - margin[1], maxY: printY - margin[0] - margin[2] };\n\n  context.special.size = { x: availableX, y: pageY };\n  pages.forEach((p, i) => {\n    let n = `<div class=\"page-back pb${i}\"><div${styleClass(ctx, ['page', `ps${i}`], ['', ''], '', 'p')}>\\n`;\n    context.special.page = i + 1;\n    if (report.watermark) {\n      const r = renderWidget(report.watermark, ctx, { x: 0, y: 0, maxX: printX, availableX: printX, maxY: printY, availableY: printY });\n      n += r.output + '\\n';\n    }\n    if (report.header) {\n      const r = renderWidget(report.header, ctx, headPlace);\n      n += r.output + '\\n';\n    }\n    n += `<div class=\"page-inner\">${p}</div>`;\n    if (report.footer) {\n      const r = renderWidget(report.footer, ctx, footPlace);\n      n += r.output + '\\n';\n    }\n    if (report.overlay) {\n      const r = renderWidget(report.overlay, ctx, { x: 0, y: 0, maxX: printX, availableX: printX, maxY: printY, availableY: printY });\n      n += r.output + '\\n';\n    }\n    n += '\\n</div></div>';\n    pages[i] = n;\n  });\n\n  return `<html style=\"font-size:100%;margin:0;padding:0;\"><head><style>\n    .page { width: ${printX}rem; height: ${printY}rem; position: absolute; overflow: hidden; left: ${size.margin[1]}rem; top: ${size.margin[0]}rem; ${report.font ? styleFont(report.font, ctx) : ''} }\n    .page-inner { position: absolute; width: ${printX - margin[1] - margin[3]}rem; height: ${printY - margin[0] - margin[2]}rem; left: ${margin[3]}rem; top: ${margin[0]}rem; }\n    .page-back { width: ${size.width}rem; height: ${size.height}rem; }\n    body { font-size: 0.83rem; }\n    @media screen {\n      html { min-width: ${size.width + 2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { margin: 0; padding: 0; ${size ? `width:${size.width}rem;` : ''}background-color: none; display: block; height: ${pages.length * size.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${pages.map((_p, i) => `.pb${i} { top: ${i * size.height}rem; }`).join('')}\n    }\n    @page {\n      size: ${size.width}em ${size.height}em;\n    }${Object.entries(ctx.styles).map(([_k, v]) => v).join('\\n')}${Object.entries(ctx.styleMap.styles).map(([style, id]) => `.${id} { ${style} }`).join('\\n')}\n  </style>${extras && extras.head || ''}</head><body>\\n${pages.reduce((a, c) => a + c, '')}${extras && extras.foot || ''}</body></html>`;\n}\n\nfunction runFlow(report: Flow, context: Context, extras?: ReportExtras): string {\n  const ctx: RenderContext = { context, report, styles: {}, styleMap: { ids: {}, styles: {} } };\n  let html = '';\n  let y = 0;\n  let state: RenderState<any> = null;\n\n  let width: number;\n\n  if (report.width) width = report.width;\n  else if (report.size) width = report.orientation !== 'portrait' ? report.size.height : report.size.width;\n\n  let margin: [number, number, number, number];\n  if (report.margin != null) margin = expandMargin(report, ctx, { x: 0, y: 0, availableX: width, maxX: width });\n  if (!margin && report.size && report.size.margin) margin = expandMargin(report.size, ctx, { x: 0, y: 0, availableX: width, maxX: width });\n  if (!margin) margin = [0, 0, 0, 0];\n\n  // account for margins\n  if (width) width -= (margin[1] || 0) + (margin[3] || 0);\n\n  function render(w: Widget, cls: string) {\n    html += `<div${styleClass(ctx, cls ? [cls] : [], [`position:absolute;right:0rem;left:0rem;${width ? `width:${width}rem;` : ''}`, ''], `top:${y}rem;`, 'p')}>\\n`;\n    let r: RenderResult;\n    let yy = 0;\n    do {\n      r = renderWidget(w, ctx, { x: 0, y: yy, availableX: width, maxX: width }, state);\n      if (typeof r === 'string') throw new Error(`Container widget didn't specify used height`);\n      else {\n        html += r.output;\n        yy += r.height;\n        if (r.continue) {\n          state = r.continue;\n        } else {\n          state = null;\n        }\n      }\n    } while (state !== null)\n    y += yy;\n    html += `</div>\\n`;\n  }\n\n  if (report.watermark) render(report.watermark, 'watermark');\n  let maxY = y || 0;\n  y = 0;\n  for (const w of report.widgets || []) render(w, 'main');\n  if (y > maxY) maxY = y;\n  y = 0;\n  if (report.overlay) render(report.overlay, 'overlay');\n  if (y > maxY) maxY = y;\n\n  return `<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${width ? ` width: ${width}rem;` : ''}; height: ${maxY}rem; position: relative; }\n    .page-back { ${width ? `width: ${width}rem; ` : 'width: 100%; box-sizing: border-box; '}padding: ${margin[0] || 0}rem ${margin[1] || 0}rem ${margin[2] || 0}rem ${margin[3] || 0}rem; position: absolute; left: 0; top: 0; }\n    #wrapper { height:${maxY}rem; position: relative; ${report.font ? styleFont(report.font, ctx) : ''} }\n    .watermark { z-index: 0; }\n    .main { z-index: 5; }\n    .overlay { z-index: 10; }\n    @media screen {\n      body { margin: 1rem${width ? ' auto' : ''}; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${margin[0]}rem ${margin[1]}rem ${margin[2]}rem ${margin[3]}rem !important; }\n    }${Object.entries(ctx.styles).map(([_k, v]) => v).join('\\n')}${Object.entries(ctx.styleMap.styles).map(([style, id]) => `.${id} { ${style} }`).join('\\n')}\n  </style>${extras && extras.head || ''}</head><body>\\n<div class=page-back><div id=wrapper>${html}</div></div>${extras && extras.foot || ''}</body></html>`;\n}\n\nfunction findWidgets(from: Widget, type: string, first?: boolean, results?: Widget[]): Widget[] {\n  results = results || [];\n  if (from.type === type) results.push(from);\n  if (first && results.length) return results;\n  if (from.widgets) for (const w of from.widgets) findWidgets(w, type, first, results);\n  return results;\n}\n\n// TODO: this could try harder to carry context forward and use non-named sources if it seems necessary\nfunction runAsDelimited(report: Flow|Page, context: RootContext, extra?: ReportExtras): string {\n  const [repeater] = findWidgets({ type: 'container', widgets: report.widgets }, 'repeater', true) as Repeater[];\n  if (repeater && typeof (repeater?.source as any)?.source === 'string') {\n    let headers: ValueOrExpr[];\n    let fields: ValueOrExpr[];\n    const rowContext = repeater.row.context;\n\n    if (repeater.header) {\n      const labels = findWidgets(repeater.header, 'label') as Label[];\n      headers = labels.map(l => typeof l.text === 'string' ? parse(l.text) : l.text) as ValueOrExpr[];\n    }\n\n    fields = (findWidgets(repeater.row, 'label') as Label[]).map(l => l.text) as ValueOrExpr[];\n\n    const source = '_tmp';\n    if (typeof repeater.source === 'object') {\n      const src = repeater.source;\n      let data;\n      if ('source' in src) {\n        const s = src as ReportSource;\n        let base = context.sources[s.source] || { value: [] };\n        if (s.base) base = { value: evaluate(extend(context, { value: base.value, special: { source: base } }), s.base) };\n        if (s.filter || s.sort || s.group) base = filter(base, s.filter, s.sort, s.group, context);\n        data = toDataSet(base);\n      } else data = toDataSet(evaluate(context, src));\n      context.sources._tmp = data;\n    }\n\n    return runDelimited(Object.assign({ type: 'delimited', headers, fields, source, rowContext }, extra) as Delimited, context, extra?.table ? { table: true } : {});\n  }\n  return '';\n}\n","import { Parser, parser as makeParser, opt, rep1sep, seq, alt, map, readTo, read1To, rep1, rep, str, read, read1, chars } from 'sprunge';\n\ntype Style = BoolStyle | ValueStyle<any>;\ninterface BoolStyle {\n  tag: string;\n}\ninterface ValueStyle<T> {\n  tag: string;\n  value: T|null;\n}\n\n// zero width space\nconst zwsp = '&#8203;';\n\nconst sp = read1(' \\r\\n\\t');\nconst ws = read(' \\r\\n\\t');\nconst hex = '0123456789abcdef';\nconst integer = map(read1('0123456789'), v => +v);\nconst number = map(seq(opt(str('-')), read1('0123456789'), opt(seq(str('.'), read1('0123456789')))), ([m, n, d]) => +[m, n, d?.[0], d?.[1]].filter(v => v).join(''));\nconst color = map(seq(opt(str('#')), alt(chars(8, hex), chars(6, hex), chars(4, hex), chars(3, hex))), ([, color]) => `#${color}`);\nconst remOrPercent = map(seq(number, opt(str('%'))), ([n, p]) => `${n}${p ? '%' : 'rem'}`);\nconst places = str('left', 'right', 'top', 'bottom', 'center');\n\nconst align = map(seq(str('align'), opt(seq(str('='), alt(\n  seq(str('top', 'middle', 'bottom', 'base'), opt(seq(sp, str('left', 'right', 'center')))),\n  seq(str('left', 'right', 'center'), opt(seq(sp, str('top', 'middle', 'bottom', 'base'))))\n)))), ([,v]) => ({ tag: 'align', value: v ? [v[1][0], v[1][1]?.[1]].filter(v => v) : null }));\nconst valign = map(seq(str('valign'), opt(seq(str('='), str('top', 'middle', 'bottom', 'base')))), ([, v]) => ({ tag: 'valign', value: v ? v[1] : null }));\n\nconst pad = map(seq(str('pad'), opt(seq(str('='), rep1sep(number, sp)))), ([, v]) => ({ tag: 'pad', value: v ? v[1] : null }));\nconst margin = map(seq(str('margin'), opt(seq(str('='), rep1sep(number, sp)))), ([, v]) => ({ tag: 'margin', value: v ? v[1] : null }));\nconst width = map(seq(str('width', 'w'), opt(seq(str('='), remOrPercent))), ([,v]) => ({ tag: 'width', value: v ? v[1] : null }));\nconst height = map(seq(str('height', 'h'), opt(seq(str('='), remOrPercent))), ([,v]) => ({ tag: 'height', value: v ? v[1] : null }));\nconst line = map(seq(str('line'), opt(seq(str('='), number))), ([,v]) => ({ tag: 'line', value: v ? v[1] : null }));\nconst fg = map(seq(str('fg', 'color', 'fore'), opt(seq(str('='), color))), ([,v]) => ({ tag: 'fg', value: v ? v[1] : null }));\nconst bg = map(seq(str('bg', 'background', 'back'), opt(seq(str('='), color))), ([,v]) => ({ tag: 'bg', value: v ? v[1] : null }));\nconst size = map(seq(str('size'), opt(seq(str('='), number))), ([,v]) => ({ tag: 'size', value: v ? v[1] : null }));\nconst font = map(seq(str('font'), opt(seq(str('='), read1To(',|')))), ([,v]) => ({ tag: 'font', value: v ? v[1] : null }));\nconst rotate = map(seq(str('rotate'), opt(seq(str('='), number, ws, opt(str('left', 'right')), opt(seq(sp, alt(remOrPercent, places), sp, alt(remOrPercent, places)))))), ([,v]) => ({ tag: 'rotate', value: v ? { turn: v[1] * (v[3] === 'left' ? -1 : 1), origin: v[4] ? [v[4][1], v[4][3]] : undefined } : null }));\nconst move = map(seq(str('move'), opt(seq(str('='), remOrPercent, sp, remOrPercent))), ([,v]) => ({ tag: 'move', value: v ? { x: v[1], y: v[3] } : null }));\n\nconst trash = map(readTo(',|'), v => ({ tag: 'trash', value: v }));\n\nconst border = map(seq(\n  str('border'), opt(seq(str('='),opt(str('solid', 'dot', 'dash', 'double')), ws,\n  rep1sep(integer, sp), ws, opt(seq(str('/'), ws, rep1sep(number, sp))), ws, opt(color),\n  ))), ([, v]) => ({ tag: 'border', value: v ? { style: v[1] || 'solid', width: v[3], radius: v[5]?.[2], color: v[7] } : null }));\n\nconst bools = map(alt(str('sub', 'sup', 'bold', 'italic', 'underline', 'strike', 'overline', 'overflow', 'nowrap', 'pre', 'br', 'b', 'i', 'u')), tag => ({ tag }));\n\nconst tag: Parser<Style[]> = map(seq(str('|'), ws, rep1sep(alt(border, align, fg, bg, valign, size, line, font, pad, margin, width, height, bools, rotate, move, trash), seq(ws, str(','), ws), 'allow'), readTo('|'), str('|')), ([, , tags]) => tags.filter(t => t.tag !== 'trash'));\nconst text = map(rep1(alt(read1To('\\\\|', true), map(str('\\\\|'), () => '|'))), txts => txts.join(''));\n\nconst all = rep(alt<Style[]|string>(text, tag))\n\nconst parser = makeParser(all, { consumeAll: true, undefinedOnError: true });\n\ninterface State {\n  bool: { [key: string]: boolean }\n  value: { [key: string]: any[] }\n}\n\nconst blocks = ['border', 'width', 'height', 'pad', 'margin', 'align', 'overflow', 'nowrap', 'rotate', 'move'];\n\nconst aliases = {\n  b: 'bold',\n  i: 'italic',\n  u: 'underline',\n}\n\nfunction process(stuff: Array<Style[]|string>): string {\n  let res = '';\n  let open = false;\n  const state: State = { bool: {}, value: {} };\n  const blockstack: string[][] = [];\n  for (const s of stuff) {\n    if (typeof s === 'string') {\n      if (!state.bool.pre && /^\\s/.test(s)) res += zwsp;\n      res += s;\n      if (!state.bool.pre && /\\s$/.test(s)) res += zwsp;\n    } else {\n      let drop = false;\n      let block: string[];\n      for (const style of s) {\n        const tag = aliases[style.tag] || style.tag;\n        if ('value' in style) {\n          if (style.value !== null) {\n            (state.value[tag] || (state.value[tag] = [])).push(style.value);\n            if (blocks.includes(tag) || block && tag === 'bg') (block || (block = [])).push(tag);\n          } else {\n            if (blocks.includes(tag)) drop = true;\n            else if (tag === 'bg' && (drop || blockstack && blockstack.length && blockstack[blockstack.length - 1].includes('bg'))) drop = true;\n            else (state.value[tag] || (state.value[tag] = [])).pop();\n          }\n        } else {\n          if (tag === 'br') res += '<br/>';\n          else if (blocks.includes(tag) && block.length) block.push(tag);\n          else state.bool[tag] = !state.bool[tag];\n        }\n      }\n      if (open) res += `</span>`;\n      open = true;\n      if (drop) {\n        const frame = blockstack.pop();\n        if (frame) {\n          res += '</span>';\n          for (const b of frame) (state.value[b] || (state.value[b] = [])).pop();\n        }\n      }\n      if (block) {\n        blockstack.push(block);\n        res += `<span style=\"${getStyle(state, block)}\">`;\n      }\n      res += `<span style=\"${getStyle(state, 'inline')}\">`;\n    }\n  }\n  if (open) res += `</span>`;\n  for (const f of blockstack) res += '</span>';\n  return res;\n}\n\nexport function style(str: string): string {\n  const parsed = parser(str);\n  if (Array.isArray(parsed)) return process(parsed);\n  return str;\n}\n\nconst flexAlign = { top: 'start', middle: 'center', bottom: 'end', base: 'baseline' };\nconst borderStyle = { dot: 'dotted', dash: 'dashed' };\nfunction getStyle(state: State, which: 'inline'|string[]) {\n  let res = '';\n\n  if (which === 'inline') {\n    const bs = state.bool;\n    if (bs.underline || bs.overline || bs.strike) res += `text-decoration-line:${[bs.underline && 'underline', bs.overline && 'overline', bs.strike && 'line-through'].filter(v => v).join(' ')};`\n    if (bs.sup || bs.sub) {\n      res += `font-size:70%;`;\n      if (bs.sup) res += `vertical-align:super;`;\n      if (bs.sub) res += `vertical-align:sub;`;\n    }\n    if (bs.italic) res += `font-style:italic;`;\n    if (bs.bold) res += `font-weight:bold;`;\n    if (bs.pre) res += `white-space:pre-wrap;`;\n\n    const vs = state.value;\n    if (Array.isArray(vs.valign)) {\n      const v = vs.valign[vs.valign.length - 1];\n      if (v) res += `vertical-align:${v === 'base' ? 'baseline' : v};`;\n    }\n\n    if (Array.isArray(vs.fg)) {\n      const v = vs.fg[vs.fg.length - 1];\n      if (v) res += `color:${v};`;\n    }\n\n    if (Array.isArray(vs.bg)) {\n      const v = vs.bg[vs.bg.length - 1];\n      if (v) res += `background-color:${v};`;\n    }\n\n    if (Array.isArray(vs.size)) {\n      const v = vs.size[vs.size.length - 1];\n      if (v != null) res += `font-size:${v}rem;`;\n    }\n\n    if (Array.isArray(vs.font)) {\n      const v = vs.font[vs.font.length - 1];\n      if (v != null) res += `font-family:${v};`;\n    }\n\n    if (Array.isArray(vs.line)) {\n      const v = vs.line[vs.line.length - 1];\n      if (v != null) res += `line-height:${v}rem;`;\n    }\n  } else {\n    res += `display:inline-flex;box-sizing:content-box;overflow:hidden;`;\n    const vs = state.value;\n\n    let transforms: string[];\n\n    if (which.includes('align') && Array.isArray(vs.align)) {\n      const v = vs.align[vs.align.length - 1];\n      if (Array.isArray(v)) {\n        let vv = v.find(v => ['top', 'middle', 'bottom', 'base'].includes(v));\n        if (vv) res += `align-items:${flexAlign[vv]};`;\n        vv = v.find(v => ['left', 'right', 'center'].includes(v));\n        if (vv) res += `justify-content:${vv};`;\n      }\n    }\n\n    if (which.includes('width') && Array.isArray(vs.width)) {\n      const v = vs.width[vs.width.length - 1];\n      if (v != null) res += `width:${v};`;\n    }\n\n    if (which.includes('height') && Array.isArray(vs.height)) {\n      const v = vs.height[vs.height.length - 1];\n      if (v != null) res += `height:${v};`;\n    }\n\n    if (which.includes('pad') && Array.isArray(vs.pad)) {\n      const v: number[] = vs.pad[vs.pad.length - 1];\n      if (Array.isArray(v) && v.length) {\n        res += `padding:${v[0]}rem`;\n        if (v.length > 1) res += ` ${v[1]}rem`;\n        if (v.length > 2) res += ` ${v[2]}rem`;\n        if (v.length > 3) res += ` ${v[3]}rem`;\n        res += ';';\n      }\n    }\n\n    if (which.includes('margin') && Array.isArray(vs.margin)) {\n      const v: number[] = vs.margin[vs.margin.length - 1];\n      if (Array.isArray(v) && v.length) {\n        res += `margin:${v[0]}rem`;\n        if (v.length > 1) res += ` ${v[1]}rem`;\n        if (v.length > 2) res += ` ${v[2]}rem`;\n        if (v.length > 3) res += ` ${v[3]}rem`;\n        res += ';';\n      }\n    }\n\n    if (which.includes('border') && Array.isArray(vs.border)) {\n      const v: { style: string; color?: string; width: number[]; radius: number[] } = vs.border[vs.border.length - 1];\n      if (v) {\n        res += `border-style:${borderStyle[v.style] || v.style};border-width:${v.width[0]}px`;\n        if (v.width.length > 1) res += ` ${v.width[1]}px`;\n        if (v.width.length > 2) res += ` ${v.width[2]}px`;\n        if (v.width.length > 3) res += ` ${v.width[3]}px`;\n        res += ';';\n        if (v.color) res += `border-color:${v.color};`;\n        if (v.radius) {\n          res += `border-radius:${v.radius[0]}rem`;\n          if (v.radius.length > 1) res += ` ${v.radius[1]}rem`;\n          if (v.radius.length > 2) res += ` ${v.radius[2]}rem`;\n          if (v.radius.length > 3) res += ` ${v.radius[3]}rem`;\n          res += ';';\n        }\n      }\n    }\n\n    if (which.includes('bg') && Array.isArray(vs.bg)) {\n      const v = vs.bg[vs.bg.length - 1];\n      if (v) res += `background-color:${v};`;\n    }\n\n    if (which.includes('rotate') && Array.isArray(vs.rotate)) {\n      const v: { turn: number; origin?: [string, string] } = vs.rotate[vs.rotate.length - 1];\n      if (v) {\n        if (v.origin) res += `transform-origin:${v.origin[0]} ${v.origin[1]};`;\n        (transforms || (transforms = []))[which.indexOf('rotate')] = `rotate(${v.turn}turn)`;\n      }\n    }\n\n    if (which.includes('move') && Array.isArray(vs.move)) {\n      const v: { x: string; y: string } = vs.move[vs.move.length - 1];\n      if (v) (transforms || (transforms = []))[which.indexOf('move')] = `translate(${v.x}, ${v.y})`;\n    }\n\n    if (transforms) res += `transform:${transforms.filter(v => v).join(' ')};`;\n\n    if (which.includes('nowrap')) res += `white-space:nowrap;`;\n    if (which.includes('overflow')) res += `overflow:visible;`;\n  }\n\n  return res;\n}\n","import { Container, Label, Repeater, Image, MeasuredLabel, HTML } from '../report';\nimport { evaluate, filter, Group, ValueOrExpr, isValueOrExpr, extend as extendData } from '../data/index';\nimport { parse as parseTemplate } from '../data/parse/template';\nimport { style as styleText } from '../data/parse/style';\nimport { error } from './error';\n\nimport { addStyle, escapeHTML, extend, getWidth, measure, registerRenderer, renderWidget, renderWidgets, RenderContinuation, RenderState, RenderContext, getHeightWithMargin, expandMargin, getWidthWithMargin, isComputed } from './index';\nimport { styleClass, style, styleFont, styleImage, styleExtra } from './style';\n\nfunction onCommit(ctx: RenderContext, key: string, value: any) {\n  let c = ctx;\n  while (c) {\n    if (c.commit) {\n      c.commit[key] = value;\n      return;\n    }\n    c = c.parent;\n  }\n}\n\nfunction commitContext(ctx: RenderContext) {\n  for (const k in ctx.commit) {\n    let l = ctx.context;\n    while (l) {\n      if (l.special && l.special.values) (l.special.values[k] || (l.special.values[k] = [])).push(ctx.commit[k]);\n      l = l.parent;\n    }\n  }\n}\n\nregisterRenderer<Label>('label', (w, ctx, placement) => {\n  addStyle(ctx, 'label', `.label {position:absolute;box-sizing:border-box;white-space:normal;}`);\n  let str = '';\n  let sval: any;\n  let val = (Array.isArray(w.text) ? w.text : [w.text]).map(v => {\n    let val = evaluate(ctx, typeof v === 'object' && 'text' in v ? v.text : v);\n    if (typeof val === 'string') val = escapeHTML(val);\n    if (typeof v === 'object' && 'id' in v) onCommit(ctx, v.id, val);\n    str += val;\n    sval = val;\n\n    if (w.styled) val = styleText(val);\n\n    if (typeof v === 'object' && 'text' in v) {\n      return `<span${styleClass(ctx, [], [styleFont(v.font, ctx) + styleExtra(v, ctx), ''])}>${val}</span>`;\n    } else {\n      return val\n    };\n  }).join('');\n\n  if (w.id) onCommit(ctx, w.id, str);\n\n  if (w.format && w.format.name) {\n    const args: ValueOrExpr[] = [{ v: !Array.isArray(w.text) || w.text.length === 1 ? sval : val }, { v: w.format.name }];\n    val = evaluate(ctx, { op: 'format', args: args.concat(w.format.args || []) });\n  }\n\n  return `<span${styleClass(ctx, ['label'], style(w, placement, ctx, { lineSize: true }))}>${val}</span>`\n});\n\nregisterRenderer<Container>('container', (w, ctx, placement, state) => {\n  addStyle(ctx, 'container', `.container {position:absolute;box-sizing:border-box;}`);\n  let h: number;\n  if (!w.height) w.height = 'auto';\n  else if (w.height !== 'auto') h = getHeightWithMargin(w, placement, ctx);\n  const wctx = ((state || {}).state || {}).ctx ? Object.assign({}, ctx, { context: state.state.ctx }) : ctx;\n  if (w.context && !((state || {}).state || {}).ctx) {\n    if (!wctx.context.locals) wctx.context.locals = {};\n    const value = evaluate(extend(wctx, { special: { placement, widget: w }, locals: wctx.context.locals }), w.context);\n    if (value) wctx.context = extendData(wctx.context, { value, special: { placement, widget: w } });\n  }\n  const cw = getWidth(w, placement, ctx) || placement.availableX;\n  const r = renderWidgets(w, wctx, { x: 0, y: 0, availableX: cw, availableY: h || placement.availableY, maxX: cw, maxY: h != null && !isNaN(h) ? h : placement.maxY }, state, w.layout);\n  if (!r.cancel) {\n    r.output = `<div${styleClass(ctx, ['container'], style(w, placement, ctx, { computedHeight: h || r.height, container: true }))}>${r.output}</div>`;\n    r.height = h || r.height;\n    r.width = getWidthWithMargin(w, placement, ctx);\n  }\n  if ((r.cancel || r.continue) && !w.bridge) {\n    const state = r.continue || {} as RenderState;\n    state.offset = 0;\n    // must start over\n    delete state.last;\n    state.attempt = (state.attempt || 0) + 1;\n    if (state.attempt > 1) return error(ctx, placement);\n    return { continue: state, output: '' };\n  } else if (r.continue) {\n    if (w.context) r.continue.state = { ctx: wctx.context };\n    r.continue.offset = 0;\n  }\n  return r;\n}, { container: true });\n\ntype RepeatState = { part: 'group'|'header'|'body'|'footer'; group?: 'header'|'body'; src: Group|any[]; current: number; context?: RenderContext; newPage?: boolean };\nregisterRenderer<Repeater, RepeatState>('repeater', (w, ctx, placement, state) => {\n  addStyle(ctx, 'container', `.container {position:absolute;box-sizing:border-box;}`);\n  if (!w.height) w.height = 'auto';\n  let availableY = placement.availableY;\n  let availableX = placement.availableX;\n\n  let r: RenderContinuation;\n  let html = '';\n  let commit = false;\n  const m = expandMargin(w, ctx, placement);\n  let y = !state || !state.state || state.state.part === 'header' ? m[0] : 0;\n  if (availableY != null) {\n    availableY -= y;\n    availableY = +availableY.toFixed(6)\n  }\n  let group: Group;\n  let groupNo: number|boolean = false;\n  const newPage = state && state.state && state.state.newPage;\n\n  let src: Group|any[] = state && state.state && state.state.src;\n  if (!src) {\n    if (!w.source) return '';\n    src = isValueOrExpr(w.source) ?\n      evaluate(ctx, w.source) :\n      filter(ctx.context.root.sources[w.source.source] || { value: [] }, w.source.filter, w.source.sort, w.source.group, ctx.context).value;\n    (ctx.context.special || (ctx.context.special = {})).values || (ctx.context.special.values = {});\n  }\n    \n  let arr: any[];\n\n  if (!Array.isArray(src)) {\n    if (!src || !Array.isArray(src.value)) return { output: '', height: 0 };\n    group = src;\n    arr = group.value;\n    if (w.group) {\n      groupNo = w.group.length > group.grouped ? w.group.length - group.grouped - 1 : false;\n    }\n  } else {\n    arr = src;\n  }\n\n  if ((w.header || w.group) && (newPage || !state || !state.state || state.state.part === 'header' || state.state.part === 'group')) {\n    const hctx = state && state.state && state.state.context && state.state.context.context;\n\n    if (group) {\n      const c = extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: (hctx && hctx.special || {}).values } });\n\n      if (w.group && groupNo !== false && (!state || !state.state || state.state.part === 'group')) {\n        r = renderWidget(w.group[groupNo], extend(ctx, { value: group, special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: true, group: group.group } }), { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n\n        if (r) {\n          if (r.height > availableY) {\n            if (html) html = `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`;\n            return { output: html, height: y, continue: { offset: 0, state: { part: 'group', src, current: 0, newPage: true } } }\n          } else if (availableY != null) {\n            availableY -= r.height;\n            availableY = +availableY.toFixed(6);\n          }\n\n          html += r.output;\n          y += r.height;\n        }\n      }\n\n      if (w.header && (w.groupHeaders && w.groupHeaders[group.grouped] && (!state || !state.state || !state.state.current) || newPage && w.headerPerPage !== false)) r = renderWidget(w.header, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n      else r = { output: '', height: 0 };\n\n      if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'header', src, current: 0, context: ctx, newPage: true } } }\n      else if (availableY != null) {\n        availableY -= r.height;\n        availableY = +availableY.toFixed(6);\n      }\n\n      html += r.output;\n      y += r.height;\n    } else if (w.header) {\n      if (!state || newPage && w.headerPerPage !== false) r = renderWidget(w.header, ctx, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n      else r = { output: '', height: 0 };\n\n      if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'header', src, current: 0, context: ctx, newPage: true } } }\n      else if (availableY != null) {\n        availableY -= r.height;\n        availableY = +availableY.toFixed(6);\n      }\n\n      html += r.output;\n      y += r.height;\n    }\n  }\n\n  if (newPage) state.state.newPage = false;\n  if (state && state.child && state.child.state) state.child.state.newPage = false;\n\n  let rctx: RenderContext = state && state.state && state.state.context || extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: {}, last: arr.length - 1, count: arr.length } });\n  const elide = w.row && (isComputed(w.row.elide) ? evaluate(extend(rctx, { special: { placement, widget: w } }), w.row.elide.x) : w.row.elide);\n\n  if (!state || !state.state || state.state.part !== 'footer') {\n    let usedX = 0;\n    let usedY = 0;\n    let initY = y;\n    if (!elide && !arr.length && w.alternate) {\n      if (w.alternate) {\n        r = renderWidget(w.alternate, rctx, { x: usedX, y, availableX: availableX - usedX, maxX: placement.maxX, availableY, maxY: placement.maxY }, state ? state.child : undefined);\n        if (r.height > availableY) return { output: html, height: 0, continue: { offset: 0, state: { part: 'body', src, current: 0, newPage: true } } }\n        else if (availableY != null) {\n          availableY -= r.height;\n          availableY = +availableY.toFixed(6);\n        }\n\n        html += r.output;\n        y += r.height;\n      }\n    } else {\n      for (let i = (state && state.state && state.state.current) || 0; i < arr.length; i++) {\n        let row = false;\n        const c = group && group.grouped ?\n          extend(rctx, { value: arr[i], special: { index: i, values: {} }, commit: {} }) :\n          extend(rctx, { value: arr[i], special: { index: i } });\n\n        if (group && group.grouped) {\n          const s: RenderState<RepeatState> = (state && state.child) || { offset: 0, state: { current: 0, src: arr[i], part: 'group' } };\n          r = renderWidget(w, c, { x: 0, y, availableX: availableX - usedX, availableY, maxX: placement.maxX, maxY: placement.maxY }, s);\n        } else {\n          c.commit = {};\n          if (elide) {\n            renderWidget(w.row, c, { x: 0, y: 0, availableX: placement.maxX, maxX: placement.maxX, availableY: placement.maxY, maxY: placement.maxY }, state ? state.child : undefined);\n            commitContext(c);\n            continue;\n          } else {\n            r = renderWidget(w.row, c, { x: usedX, y, availableX: availableX - usedX, maxX: placement.maxX, availableY, maxY: placement.maxY }, state ? state.child : undefined);\n            row = true;\n          }\n        }\n\n        if (state) state.child = null;\n\n        if (r.width && r.width <= availableX - usedX && r.width !== availableX) {\n          usedX += r.width;\n          if (r.height > usedY) {\n            usedY = r.height;\n            if (r.height > availableY) initY -= r.height;\n          }\n        } else if (r.width && usedX && r.width > availableX - usedX) {\n          y += usedY;\n          initY = y;\n          if (availableY != null) {\n            availableY -= usedY;\n            availableY = +availableY.toFixed(6);\n          }\n          usedY = 0;\n          usedX = 0;\n          i--;\n          continue;\n        }\n\n        if (r.height > availableY || r.cancel) {\n          if (initY === y && usedY) y += usedY;\n          if (commit) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: r.continue } };\n          else return { output: '', height: y, continue: { offset: y, state: { part: state && state.state && state.state.part || 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: r.continue } };\n        }\n\n        if (!usedY) {\n          y += r.height;\n          if (availableY != null) {\n            availableY -= r.height;\n            availableY = +availableY.toFixed(6);\n          }\n        }\n\n        html += r.output;\n        commit = true;\n\n        if (row && w.header && ctx.report.type === 'flow' && w.headerRepeat > 0 && i + 1 && (i + 1) % w.headerRepeat === 0) {\n          const h = renderWidget(w.header, ctx, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n          html += h.output;\n          y += h.height;\n        }\n\n        if (r.continue) {\n          if (initY === y && usedY) y += usedY;\n          if (w.row.bridge) commitContext(c);\n          return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: w.row.bridge || (group && group.grouped) ? r.continue : undefined } };\n        }\n\n        commitContext(c);\n      }\n    }\n\n    if (initY === y && usedY) y += usedY;\n  }\n\n  if (w.footer) {\n    const fctx = (rctx && rctx.context) || (state && state.state && state.state.context && state.state.context.context);\n    const c = extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: (fctx && fctx.special || {}).values }, commit: {} });\n\n    if (group) {\n      if (w.groupEnds && w.groupEnds[group.grouped]) r = renderWidget(w.footer, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY, availableY });\n      else r = { output: '', height: 0 };\n    } else r = renderWidget(w.footer, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY, availableY });\n\n    if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'footer', current: 0, src, context: rctx, newPage: true } } }\n    else if (r.continue) {\n      if (w.footer.bridge) commitContext(c);\n      return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'footer', src, current: 0, context: rctx, newPage: true }, child: w.footer.bridge ? r.continue : undefined } }\n    }\n\n    commitContext(c);\n\n    html += r.output;\n    y += r.height;\n  }\n\n  return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y };\n}, { container: true });\n\nregisterRenderer<Image>('image', (w, ctx, placement) => {\n  addStyle(ctx, 'image', `.image {position:absolute;box-sizing:border-box;} .image .inner {background-repeat:no-repeat;height:100%;}`);\n\n  const fit = w.fit && typeof w.fit === 'object' ? evaluate(ctx, w.fit.x) : w.fit;\n  if (fit === 'stretch') {\n    return `<img src=\"${evaluate(ctx, w.url)}\" ${styleClass(ctx, ['image'], style(w, placement, ctx))} />`;\n  } else {\n    return `<div ${styleClass(ctx, ['image'], style(w, placement, ctx))}><div ${styleClass(ctx, ['inner'], styleImage(fit), `background-image:url('${evaluate(ctx, w.url)}');`)}></div></div>`;\n  }\n});\n\nregisterRenderer<MeasuredLabel>('measured', (w, ctx, placement, state) => {\n  addStyle(ctx, 'measured', `.measured {position:absolute;box-sizing:border-box;white-space:pre-wrap;font-family:serif;font-size:0.83rem;word-break:break-word;}`);\n  const text = evaluate(ctx, w.text);\n  const height = measure(text, getWidth(w, placement, ctx) || placement.availableX, ctx, w.font);\n  \n  if (!state && height > placement.availableY) {\n    return { output: '', height: 0, continue: { state: {}, offset: 0 } };\n  } else {\n    let s = style(w, placement, ctx, { computedHeight: height, container: true });\n    s[0] = `line-height:1em;` + s[0];\n    return {\n      height, output: `<span${styleClass(ctx, ['measured', 'label'], s)}>${escapeHTML(text)}</span>`\n    };\n  }\n});\n\nregisterRenderer<HTML>('html', (w, ctx, placement) => {\n  addStyle(ctx, 'html', `.html {position:absolute;box-sizing:border-box;overflow:hidden;line-height:1rem;}`);\n  const html = evaluate(extend(ctx, { parser: parseTemplate }), w.html);\n  return `<div${styleClass(ctx, ['html'], style(w, placement, ctx, { container: true }))}>${html}</div>`;\n});\n","import { DateExactRange } from \"./index\";\n\nconst decRE = /(\\d)(?=(\\d{3})+\\.)/g;\nconst intRE = /(\\d)(?=(\\d{3})+$)/g;\nconst isNumRE = /^[-0-9\\\\.,]+$/;\n\nexport function number(v: string|number, dec: number = 2, group: string = ',', negative: 'sign'|'wrap'|'both' = 'sign'): string {\n  v = typeof v !== 'number' ? parseFloat(v || '') : v;\n  if (isNaN(v)) return '';\n  const neg = v < 0;\n  v = v.toFixed(dec);\n  if (dec === 0) v = v.replace(/\\..*/, '');\n  if (neg && negative !== 'sign') v = `(${negative === 'both' ? v : v.substr(1)})`\n  if (group) return v.replace(v.indexOf('.') === -1 ? intRE : decRE, `$1${group}`);\n  else return v;\n}\n\nexport function dollar(v: string, alt: string, dec: number = 2, group: string = ',', sign: string = '$', negative: 'sign'|'wrap'|'both' = 'sign'): string {\n  if (v != null && isNumRE.test(v)) {\n    if (!isNaN(+v)) return `${sign}${number(v, dec, group, negative)}`;\n    else return alt !== undefined ? alt : v;\n  } else {\n    return alt !== undefined ? alt : v;\n  }\n}\n\nexport function phone(v: string|number): string {\n  if (!v) v = '';\n  if (typeof v !== 'string') v = v.toString();\n  v = v || '';\n  v = v.replace(/[^\\d]/g, '');\n\n  if (v.length === 7) return `${v.substr(0, 3)}-${v.substr(3, 4)}`;\n  else if (v.length === 10) return `(${v.substr(0, 3)}) ${v.substr(3, 3)}-${v.substr(6, 4)}`;\n  else if (v.length === 11) return `${v[0]}-${v.substr(1, 3)}-${v.substr(4, 3)}-${v.substr(7, 4)}`;\n  else return v;\n}\n\nconst dateRE = /\\\\.|y+|M+|d+|E+|H+|m+|s+|k+|h+|a+|S+|z+/g;\nconst months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\nconst days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nlet dateDefault: string;\nexport function date(d: string|Date|DateExactRange, fmt: string): string {\n  if (!d) return '';\n  let Y: number, M: number, D: number, DD: number, H: number, MM: number, S: number, SS: number, Z: number;\n\n  // convert an exact range to numbers\n  if (typeof d === 'object' && 'f' in d && Array.isArray(d.f)) {\n    const f = d.f, l = f.length, e = d.e;\n    Y = f[0], M = l > 1 && f[1] != null ? f[1] : e ? 11 : 0, D = l > 2 && f[2] != null ? f[2] : e ? 0 : 1,\n      H = l > 3 && f[3] != null ? f[3] : e ? 23 : 0, MM = l > 4 && f[4] != null ? f[4] : e ? 59 : 0, S = l > 5 && f[5] != null ? f[5] : e ? 59 : 0,\n      SS = l > 6 && f[6] != null ? f[6] : e ? 999 : 0;\n    let dt = new Date(Y, M, D || 1, H, MM, S, SS);\n    Z = l > 7 && f[7] != null ? -f[7] : dt.getTimezoneOffset();\n    if (!D) {\n      dt.setMonth(M + 1);\n      dt.setDate(0);\n      D = dt.getDate();\n    }\n    DD = dt.getDay();\n  } else {\n    if (typeof d === 'string') d = new Date(d);\n    if (Object.prototype.toString.call(d) !== '[object Date]') return '';\n    if (isNaN(d as any)) return '';\n\n    const v = d as Date;\n    Y = v.getFullYear(), M = v.getMonth(), D = v.getDate(), DD = v.getDay(), H = v.getHours(), MM = v.getMinutes(), S = v.getSeconds(), SS = v.getMilliseconds(), Z = v.getTimezoneOffset();\n  }\n\n\n  if (!fmt) fmt = dateDefault || 'yyyy-MM-dd';\n\n  return fmt.replace(dateRE, m => {\n    if (m[0] === '\\\\') {\n      return m[1];\n    } else if (m[0] === 'y') {\n      return m.length <= 2 ? (`${Y}`).substr(2, 2) : `${Y}`;\n    } else if (m[0] === 'M') {\n      if (m.length === 1) return `${M + 1}`;\n      else if (m.length === 2) return M < 9 ? `0${M + 1}` : `${M + 1}`;\n      else if (m.length === 3) return months[M].substr(0, 3);\n      else return months[M];\n    } else if (m[0] === 'd') {\n      if (m.length === 1) return `${D}`;\n      else if (m.length === 2) return D <= 9 ? `0${D}` : `${D}`;\n      else return ordinal(D);\n    } else if (m[0] === 'E') {\n      if (m.length === 1) return `${DD + 1}`;\n      else if (m.length === 2) return days[DD].substr(0, 3);\n      else return days[DD];\n    } else if (m[0] === 'H') {\n      return m.length === 1 ? `${H}` : H <= 9 ? `0${H}` : `${H}`;\n    } else if (m[0] === 'm') {\n      return m.length === 1 ? `${MM}` : MM <= 9 ? `0${MM}` : `${MM}`;\n    } else if (m[0] === 's') {\n      return m.length === 1 ? `${S}` : S <= 9 ? `0${S}` : `${S}`;\n    } else if (m[0] === 'S') {\n      const ms = SS;\n      if (m.length === 1) return `${ms}`;\n      return ms < 10 ? `00${ms}` : ms < 100 ? `0${ms}` : `${ms}`;\n    } else if (m[0] === 'k' || m[0] === 'h') {\n      let r = `${H % 12}`;\n      if (r === '0') r = '12';\n      return `${r}`;\n    } else if (m[0] === 'a') {\n      return H > 11 ? 'PM' : 'AM';\n    } else if (m[0] === 'z') {\n      let min = 0 - Z;\n      const bit = min < 0 ? '-' : '+';\n      min = Math.abs(min);\n      let r: number = min;\n      if (m.length === 1) {\n        r = Math.floor(min / 60);\n      } else if (m.length === 2) {\n        const mm = min % 60;\n        const h = Math.floor(min / 60);\n        return `${bit}${h < 10 ? '0' : ''}${h}${mm < 10 ? '0' : ''}${mm}`;\n      } else if (m.length === 3) {\n        const mm = min % 60;\n        const h = Math.floor(min / 60);\n        return `${bit}${h < 10 ? '0' : ''}${h}:${mm < 10 ? '0' : ''}${mm}`;\n      } else r = min;\n      return `${bit}${r}`;\n    }\n  });\n}\n\ndate.setDefault = function(format?: string) {\n  dateDefault = format;\n}\n\nexport function ordinal(num: number|string, group?: string): string {\n  num = number(num, 0, group);\n  let n = `${num}`;\n  n = n.substr(-2, 2);\n  if (n.length > 1 && n[0] === '1') return `${num}th`;\n  switch (n[1] || n[0]) {\n    case '1':\n      return `${num}st`;\n    case '2':\n      return `${num}nd`;\n    case '3':\n      return `${num}rd`;\n    default:\n      return `${num}th`;\n  }\n}\n","import { ValueOrExpr, Operation, Literal, DateRel, DateRelRange, isDateRel, isTimespan, TimeSpan, isApplication, ValueWithAnchor } from '../index';\nimport { endRef, isTimespanMS, timespans, timeSpanToNumber } from '../parse';\nimport { Schema } from '../index';\n\nconst checkIdent = new RegExp(`[${endRef.split('').map(v => `\\\\${v}`).join('')}]`);\n\nexport interface ListOverride {\n  base: boolean|number;\n  array?: boolean|number;\n  union?: boolean|number;\n  args?: boolean|number;\n  keys?: boolean|number;\n}\n\ninterface _ListOverride {\n  array: number;\n  union: number;\n  args: number;\n  keys: number;\n}\n\nexport type StringifyOpts = SimpleStringifyOpts | SExprStringifyOpts;\nexport interface BaseStringifyOpts {\n  /** Disable the use of symbol style :strings. */\n  noSymbols?: boolean;\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps?: boolean;\n  /** Enable comma separators in lists of values. */\n  listCommas?: boolean;\n  /** Whether to wrap lists of items. `true` wraps every item. A number targets that many characters in the output to cause a wrap. The default is 60 chars. */\n  listWrap?: boolean|number|ListOverride;\n  /** Output template formatted expressions. */\n  template?: boolean;\n  /** Output unindented single line expressions. */\n  noIndent?: boolean;\n  /** Output HTML-friendly syntax */\n  htmlSafe?: boolean;\n  /** Strip checks out of schema types */\n  noChecks?: boolean;\n}\nexport interface SimpleStringifyOpts extends BaseStringifyOpts {\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps?: false;\n}\nexport interface SExprStringifyOpts extends BaseStringifyOpts {\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps: true;\n  /** Output array function calls rather than sugared array literals. */\n  noArrayLiterals?: boolean;\n  /** Output object function calls rather than sugared object literals. */\n  noObjectLiterals?: boolean;\n}\n\nlet _noSym: boolean = false;\nlet _key: boolean = false;\nlet _sexprops: boolean = false;\nlet _listcommas: boolean = false;\nlet _noarr: boolean = false;\nlet _noobj: boolean = false;\nlet _tpl: boolean = false;\nlet _tplmode: boolean = false;\nlet _noindent: boolean = false;\nlet _listwrap: _ListOverride = { array: 60, union: 60, args: 60, keys: 60 };\nlet _html: boolean = false;\nlet _nochecks: boolean = false;\n\nlet _level = 0;\nlet _first = false;\n\nconst deepops = ['===', '!==', 'deep-is', 'deep-is-not'];\nconst binops = deepops.concat(['**', '*', '/%', '/', '%', '+', '-', '>=', 'gte', '>', 'gt', '<=', 'lte', '<', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain', 'is', 'is-not', '==', '!=', 'strict-is', 'strict-is-not', 'and', '&&', 'or', '||', '??']);\nconst unops = ['+', 'not'];\nconst precedence = {\n  '**': 1,\n  '*': 2, '/%': 2, '/': 2, '%': 2,\n  '+': 3, '-': 3,\n  '>=': 4, '>': 4, '<=': 4, '<': 4, in: 4, like: 4, ilike: 4, 'not-in': 4, 'not-like': 4, 'not-ilike': 4, 'contains': 4, 'does-not-contain': 4, gt: 4, gte: 4, lt: 4, lte: 4,\n  'is': 5, 'is-not': 5, '==': 5, '!=': 5, 'strict-is': 5, 'strict-is-not': 5, 'deep-is': 5, 'deep-is-not': 5, '===': 5, '!==': 5,\n  'and': 6, '&&': 6,\n  'or': 7, '||': 7, '??': 7,\n}\n\nconst call_op = /^[-a-zA-Z_$0-9]/;\n\nexport function stringify(value: ValueOrExpr, opts?: StringifyOpts): string {\n  opts = opts || {};\n  _noSym = opts.noSymbols;\n  _sexprops = opts.SExprOps;\n  _listcommas = opts.listCommas;\n  _noarr = opts.SExprOps && opts.noArrayLiterals;\n  _noobj = opts.SExprOps && opts.noObjectLiterals;\n  _key = false;\n  _tpl = _tplmode = opts.template;\n  _noindent = opts.noIndent;\n  _level = 0;\n  _first = true;\n  if ('listWrap' in opts) {\n    const o = opts.listWrap;\n    if (typeof o === 'boolean') _listwrap = !o ? { array: 0, union: 0, args: 0, keys: 0 } : { array: 1, union: 1, args: 1, keys: 1 };\n    else if (typeof o === 'number') _listwrap = { array: o, union: o, args: o, keys: o };\n    else {\n      const b = !o.base ? 0 : o.base === true ? 1 : o.base;\n      _listwrap = Object.keys(_listwrap).reduce((a, c) => (a[c] = c in o && o[c] != null ? (!o[c] ? 0 : o[c] === true ? 1 : o[c]) : b, a), {} as any);\n    }\n  } else _listwrap = { array: 60, union: 60, args: 60, keys: 60 };\n  _html = opts.htmlSafe;\n  _nochecks = opts.noChecks;\n  if (!_sexprops && typeof value === 'object' && value && 'op' in value && value.op === 'block') return stringifyRootBlock(value);\n  else return _stringify(value);\n}\n\nfunction padl(v: any, pad: string, len: number): string {\n  v = `${v}`;\n  if (!pad) return v;\n  for (let i = v.length; i < len; i++) {\n    v = pad + v;\n  }\n  return v;\n}\n\nfunction fill(char: string, len: number): string {\n  let res = '';\n  for (let i = 0; i < len; i++) res += char;\n  return res;\n}\n\nfunction _stringify(value: ValueOrExpr): string {\n  if (typeof value === 'string') return value;\n  let stringed: string;\n  if (value == null || typeof value === 'number' || typeof value === 'boolean') return `${value}`;\n  if (_tpl && ('op' in value || 'r' in value)) {\n    if ('op' in value) {\n      if (value.op === 'if' || value.op === 'with' || value.op === 'unless' || value.op === 'each') {\n        stringed = stringifyTemplateBlock(value);\n      } else if (value.op === 'case') {\n        stringed = stringifyTemplateCase(value);\n      } else if (value.op) {\n        if (value.op === '+') return value.args.map(a => _stringify(a)).join('');\n        else {\n          _tpl = false;\n          const res = `{{${_stringify(value.op === 'string' ? value.args[0] : value)}}}`;\n          _tpl = true;\n          stringed = res;\n        }\n      }\n    } else {\n      _tpl = false;\n      const res = `{{${_stringify(value)}}}`;\n      _tpl = true;\n      stringed = res;\n    }\n  } else if ('r' in value) {\n    if (typeof value.r === 'string') stringed = /^[0-9]/.test(value.r) ? `.${value.r}` : value.r;\n    else {\n      const r = value.r;\n      stringed = `${fill('^', r.u || 0)}${r.p || ''}${r.k.map((p, i) => {\n        if (typeof p === 'string' && checkIdent.test(p)) return `${i ? '' : '_'}[${_stringify({ v: p })}]`;\n        else if (typeof p === 'string' || typeof p === 'number') return `${i ? '.' : ''}${p}`;\n        else {\n          const v = p as ValueWithAnchor;\n          return `[${_stringify(p)}${v.anchor === 'end' ? '<' : ''}${v.slice ? ` ${_stringify(v.slice)}${v.slice.anchor === 'end' ? '<' : ''}` : ''}]`\n        }\n      }).join('')}`;\n    }\n  } else if ('op' in value) {\n    stringed = stringifyOp(value);\n  } else if (isApplication(value)) {\n    const arrow = ((_tplmode && _html !== false) || _html) ? '\\\\' : '>';\n    if ('n' in value) stringed = `|${value.n.join(_listcommas ? ', ' : ' ')}| =${arrow} ${_stringify(value.a)}`;\n    else stringed = `=${arrow}${_stringify(value.a)}`;\n  } else if ('v' in value) {\n    stringed = stringifyLiteral(value);\n  } else if (isDateRel(value)) {\n    stringed = stringifyDate(value);\n  } else if (isTimespan(value)) {\n    stringed = stringifyTimespan(value);\n  }\n\n  if ('c' in value && value.c.length) stringed = (_first ? '' : '\\n') + value.c.map(c => `${padl('', '  ', _level)}// ${c}\\n`).join('') + `${padl('', '  ', _level)}${stringed}`;\n\n  return stringed;\n}\n\nfunction stringifyBinopArg(op: string, arg: ValueOrExpr, pos: 1|2): string {\n  let res: string;\n  if (op === '**' && pos === 1 && typeof arg !== 'string' && 'op' in arg && arg.op === '**') res = `(${_stringify(arg)})`;\n  if (typeof arg !== 'string' && 'op' in arg) {\n    if (binops.includes(arg.op) && precedence[arg.op] > precedence[op]) res = `(${_stringify(arg)})`;\n    else if (arg.op === 'if' || arg.op === 'unless' || arg.op === 'case' || arg.op === 'fmt' || arg.op === 'format') res = `(${_stringify(arg)})`;\n    else res = _stringify(arg);\n  } else res = _stringify(arg);\n  return res;\n}\n\nfunction findNestedStringOpL(op: string, value: Operation): boolean {\n  if (value.args && value.args.find(a => typeof a === 'object' && typeof (a as any).v === 'string')) return true;\n  if (!value.args || !value.args.length) return false;\n  const left = value.args[0];\n  if (typeof left === 'object' && 'op' in left && left.op === op) return findNestedStringOpL(op, left);\n  return false;\n}\n\nfunction flattenNestedBinopsL(op: string, value: Operation, agg: ValueOrExpr[] = []): ValueOrExpr[] {\n  if (value.args && value.args.length) {\n    let i = 0;\n    for (; i < value.args.length; i++) {\n      if (typeof value.args[i] === 'object' && typeof (value.args[i] as any).v === 'string') agg.push(value.args[i]);\n      else break;\n    }\n    const left = value.args[i];\n    if (typeof left === 'object' && 'op' in left && left.op === op) flattenNestedBinopsL(op, left, agg);\n    else agg.push(left);\n    agg.push.apply(agg, value.args.slice(i + 1));\n  }\n  return agg;\n}\n\nfunction stringifyOp(value: Operation): string {\n  let op = value.op;\n  if ((_tplmode && _html !== false) || _html) {\n    if (op === '>') op = 'gt';\n    else if (op === '>=') op = 'gte';\n    else if (op === '<') op = 'lt';\n    else if (op === '<=') op = 'lte';\n    else if (op === '&&') op = 'and';\n  }\n  if (!_noarr && op === 'array' && !value.opts) {\n    return wrapArgs('[', value.args, value.opts, ']');\n  } else if (!_noobj && op === 'object' && value.args && !value.args.find((a, i) => i % 2 === 0 && (typeof a === 'string' || !('v' in a) || typeof a.v !== 'string'))) {\n    if (!value.args || !value.args.length) return '{}';\n    return wrapArgs('{', value.args, value.opts, '}', 2);\n  } else if (_sexprops) {\n    if (!value.args || !value.args.length) return `(${op})`;\n    return wrapArgs(`(${op} `, value.args, value.opts, ')', 0);\n  } else if (op === 'if' || op === 'unless' && value.args && value.args.length > 2) {\n    return stringifyIf(value);\n  } else if (op === 'case' && value.args && value.args.length > 2) {\n    return stringifyCase(value);\n  } else if (op === '+' && value.args && value.args.length > 1 && findNestedStringOpL(op, value)) {\n    const args = flattenNestedBinopsL(op, value);\n    if (value.meta && value.meta.q) {\n      const re = new RegExp(`(\\\\{|${value.meta.q})`, 'g');\n      return `${value.meta.q}${args.map(a => typeof a !== 'string' && 'v' in a && typeof a.v === 'string' ? a.v.replace(re, v => `\\\\$1`).replace(/\\$$/, '\\\\$') : `{${_stringify(a)}}`).join('')}${value.meta.q}`\n    } else return `'${args.map(a => typeof a !== 'string' && 'v' in a && typeof a.v === 'string' ? a.v.replace(/[{']/g, v => `\\\\${v}`).replace(/\\$$/, '\\\\$') : `{${_stringify(a)}}`).join('')}'`\n  } else if ((op === 'fmt' || op === 'format') && value.args && typeof value.args[1] === 'object' && 'v' in value.args[1] && typeof value.args[1].v === 'string') {\n    const val = value.args[0];\n    let vs = _stringify(val);\n    if (typeof val !== 'string' && 'op' in val && (binops.includes(val.op) || unops.includes(val.op))) vs = `(${vs})`;\n    if (value.opts || value.args?.length > 3) return `${vs}#${[value.args[1].v]}${wrapArgs('(', value.args.slice(2), value.opts, ')')}`;\n    else return `${vs}#${[value.args[1].v].concat(value.args.slice(2).map(a => _stringify(a))).join(',')}`;\n  } else if (binops.includes(op) && value.args && value.args.length > 1 && !value.opts && (!deepops.includes(op) || value.args.length === 2)) {\n    let parts = value.args.map((a, i) => stringifyBinopArg(op, a, i === 0 ? 1 : 2));\n    const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || parts.reduce((a, c) => a + c.length, 0) && parts.length > 2;\n    const split = _noindent ? ' ' : long ? `\\n${padl('', '  ', _level + 1)}` : ' ';\n    if (split.length > 1 || (!_noindent && long)) parts = [parts[0]].concat(parts.slice(1).map(p => indentAll('  ', p)));\n    return `${parts[0]} ${op}${split}${parts.slice(1).join(` ${op}${split.length > 1 ? `${split}` : split}`)}`;\n  } else if (unops.includes(op) && value.args && value.args.length === 1) {\n    const arg = value.args[0];\n    if (typeof arg !== 'string' && 'op' in arg && (binops.includes(arg.op) || unops.includes(arg.op))) return `${op}(${_stringify(arg)})`;\n    else return `${op}${call_op.test(op) ? ' ' : ''}${_stringify(arg)}`;\n  } else if (op === 'block') {\n    if (!value.args || !value.args.length) return '';\n\n    _level++;\n    const _f = _first;\n    const parts = value.args.map((a, i) => (_first = i === 0, _stringify(a)));\n    _first = _f;\n    let split = _noindent ? '' : `\\n${padl('', '  ', _level)}`;\n    _level--;\n    if (parts.length === 1 && !~parts[0].indexOf('\\n')) return `{ ${parts[0]} }`;\n    return `{${split}${parts.join(split)}\\n${padl('', '  ', _level)}}`;\n  } else if ((op === 'let' || op === 'set') && value.args && value.args.length === 2) {\n    let path: string;\n    let arg = value.args[0];\n    if (typeof arg === 'string') path = arg;\n    else if ('v' in arg && typeof arg.v === 'string') path = arg.v;\n    else if ('v' in arg && typeof arg.v === 'object' && 'k' in arg.v) path = _stringify({ r: arg.v });\n    else path = _stringify(arg);\n    return `${op} ${path} = ${_stringify(value.args[1])}`;\n  } else if (op === 'get' && value.args.length === 2 && typeof value.args[1] === 'object' && 'v' in value.args[1] && typeof value.args[1].v === 'object' && 'k' in value.args[1].v) {\n    return `${_stringify(value.args[0])}${_stringify({ r: { k: ['r'].concat(value.args[1].v.k) } }).substr(1)}`;\n  } else if (op === 'cat' && value.meta?.q === '$$$') {\n    return `$$$${stringifyTemplate(value.args)}$$$`;\n  } else if (call_op.test(op)) {\n    return wrapArgs(`${op}(`, value.args || [], value.opts, ')', 0);\n  } else {\n    if (!value.args || !value.args.length) return `(${op})`;\n    return wrapArgs(`(${op} `, value.args, value.opts, ')', 0);\n  }\n}\n\nfunction stringifyRootBlock(block: Operation): string {\n  if (!block.args || !block.args.length) return '';\n  return block.args.map((a, i) => (_first = i === 0, _stringify(a))).join('\\n');\n}\n\nfunction stringifyLiteral(value: Literal): string {\n  if (value.s === 1) {\n    _level++;\n    const res = stringifySchema(value.v);\n    _level--;\n    if (~res.indexOf('\\n')) {\n      const level = _noindent ? ' ' : `\\n${padl('', '  ', _level)}`;\n      return `@[${level}${level !== ' ' ? '  ' : ''}${res}${level}]`;\n    } else return `@[${res}]`;\n  } else if (typeof value.v === 'string') {\n    if (_tpl) return value.v.replace(/\\\\(.)/g, '\\\\\\\\$1').replace(/{{/g, '\\\\{{');\n    if ((_key || !_noSym) && !checkIdent.test(value.v) && value.v.length) return `${_key ? '' : ':'}${value.v}`;\n    else if (value.q) return `${value.q}${value.v.replace(new RegExp(value.q, 'g'), `\\\\${value.q}`)}${value.q}`;\n    else if (!~value.v.indexOf(\"'\")) return `'${value.v.replace(/[{']/g, v => `\\\\${v}`).replace(/\\${/g, '\\\\${')}'`;\n    else if (!~value.v.indexOf('`')) return `\\`${value.v.replace(/[{`]/g, v => `\\\\${v}`).replace(/\\${/g, '\\\\${')}\\``;\n    else if (!~value.v.indexOf('\"')) return `\"${value.v}\"`;\n    else return `'${value.v.replace(/['{]/g, s => `\\\\${s}`).replace(/\\${/g, '\\\\${')}'`;\n  } else if (typeof value.v === 'number' || typeof value.v === 'boolean' || value.v === 'true' || value.v === 'false') {\n    return `${value.v}`;\n  } else if (value.v === 'undefined' || value.v === undefined) {\n    return 'undefined';\n  } else if (value.v === 'null' || value.v === null) {\n    return 'null';\n  } else if (Array.isArray(value.v)) {\n    if (_noarr) return wrapArgs('(array', value.v.map(v => ({ v })), null, ')', null, 'array');\n    return wrapArgs('[', value.v.map(v => ({ v })), null, ']', null, 'array');\n  } else if (typeof value.v === 'object') {\n    if (isDateRel(value.v)) {\n      return stringifyDate(value.v);\n    } else {\n      return wrapArgs('{', Object.entries(value.v).reduce((a, c) => (a.push({ v: c[0] }, { v: c[1] }), a), []), null, '}', 2, 'keys');\n    }\n  }\n}\n\nfunction offsetToTimezone(dir: 1|-1, offset?: number): string {\n  if (offset == null) return '';\n  offset = offset * dir;\n  const o = Math.abs(offset);\n  const h = Math.floor(o / 60);\n  const m = o % 60;\n  if (!offset) return 'Z';\n  else return `${offset > 0 ? '-' : '+'}${h}${m ? `:${padl(m, '0', 2)}` : ''}`;\n}\n\nconst spanKeys = ['w', 'd', 'h', 'mm', 's'];\nconst spanExact = ['y', 'm', 'd', 'h', 'mm', 's', 'ms'];\nfunction stringifyDate(value: DateRel): string {\n  let str = '';\n  if (value instanceof Date) { // date object\n    const y = value.getFullYear();\n    const m = value.getMonth() + 1;\n    const d = value.getDate();\n    const h = value.getHours();\n    const mn = value.getMinutes();\n    const s = value.getSeconds();\n    const ms = value.getMilliseconds();\n    str = `${y}-${padl(m, '0', 2)}-${padl(d, '0', 2)}`;\n    if (h + mn + s + ms > 0) {\n      str += ` ${padl(h, '0', 2)}:${padl(mn, '0', 2)}`;\n      if (s + ms > 0) {\n        str += `:${padl(s, '0', 2)}`;\n        if (ms > 0) str += `.${padl(ms, '0', 3)}`;\n      }\n    }\n    return `#${str}${offsetToTimezone(1, value.getTimezoneOffset())}#`;\n  } else if (Array.isArray(value.f)) { // precise date\n    const a = value.f;\n    str = `${a[0]}`;\n    if (a[1] != null) str += `-${padl(a[1] + 1, '0', 2)}`;\n    if (a[2] != null) str += `-${padl(a[2], '0', 2)}`;\n    if (a[3] != null) str += ` ${padl(a[3], '0', 2)}`;\n    if (a[4] != null) str += `:${padl(a[4], '0', 2)}`;\n    if (a[5] != null) str += `:${padl(a[5], '0', 2)}`;\n    if (a[6] != null) str += `.${padl(a[6], '0', 3)}`;\n    if (a[7] != null) str += ` ${offsetToTimezone(-1, a[7])}`;\n    if ('e' in value && value.e) str += '<';\n    return `#${str}#`;\n  } else if (value.f === 'n') { // relative point in time\n    if (Array.isArray(value.o)) { // inconsistent units\n      spanExact.forEach((k, i) => {\n        if (value.o[i] != null) str += `${value.o[i]}${k}`;\n      });\n      str += `${'d' in value && value.d === -1 ? ' ago' : ' from now'}${offsetToTimezone(-1, value.z)}`;\n      return `#${str}#`;\n    } else if (typeof value.o === 'number') { // milliseconds\n      if (value.o === 0) return `#now#`;\n      let rem = Math.abs(value.o);\n      spanKeys.forEach(k => {\n        const t = Math.floor(rem / timespans[k]);\n        rem = rem % timespans[k];\n        if (t) str += `${t}${k}`;\n      });\n      if (rem) str += `${rem}ms`;\n      return `#${str}${value.o < 0 ? ' ago' : value.o > 0 ? ' from now' : ''}${offsetToTimezone(-1, value.z)}#`;\n    }\n  } else if ('d' in value && value.d === 1 && value.o === 0) { // span to date\n    str = `#${value.f === 'w' ? 'week' : value.f === 'm' ? 'month' : 'year'} to date${offsetToTimezone(-1, value.z)}${value.e && '>' || ''}#`;\n  } else if ('t' in value && Array.isArray(value.t)) { // time on relative day\n    const a = value.t;\n    str = `${value.o < 0 ? 'yesterday' : value.o > 0 ? 'tomorrow' : 'today'} at `;\n    if (!a[0] && !a[1] && !a[2] && !a[3]) str += 'midnight';\n    else if (a[0] === 12 && !a[1] && !a[2] && !a[3]) str += 'noon';\n    else {\n      str += a[0];\n      if (a[1] != null) str += `:${padl(a[1], '0', 2)}`;\n      if (a[2] != null) str += `:${padl(a[2], '0', 2)}`;\n      if (a[3] != null) str += `.${padl(a[3], '0', 3)}`;\n    }\n    return `#${str}${offsetToTimezone(-1, a[4])}${value.e ? '>' : ''}#`;\n  } else if (!('t' in value) && !('d' in value) && !Array.isArray(value.f)) { // relative span\n    const v = value as DateRelRange;\n    if (v.f === 'd') {\n      str += `${v.o < 0 ? 'yesterday' : v.o > 0 ? 'tomorrow' : 'today'}`;\n    } else {\n      str += `${v.o < 0 ? 'last' : v.o > 0 ? 'next' : 'this'} ${v.f === 'w' ? 'week' : v.f === 'm' ? 'month' : 'year'}`;\n    }\n    return `#${str}${offsetToTimezone(-1, v.z)}${v.e ? '>' : ''}#`;\n  }\n\n  return str;\n}\n\nfunction stringifyTimespan(value: TimeSpan): string {\n  if (typeof value === 'number' || isTimespanMS(value)) {\n    let str = '';\n    let rem = Math.abs(timeSpanToNumber(value));\n    spanKeys.forEach(k => {\n      const t = Math.floor(rem / timespans[k]);\n      rem = rem % timespans[k];\n      if (t) str += `${t}${k}`;\n    });\n    if (rem) str += `${rem}ms`;\n    return `#${str}#`;\n  } else {\n    const o = value.d;\n    let str = '';\n    spanExact.forEach((k, i) => {\n      if (o[i] != null) str += `${o[i]}${k}`;\n    });\n    return `#${str}#`;\n  }\n}\n\nconst leadingSpace = /^\\s+/;\nconst allLeadingSpace = /^\\s+/gm;\nfunction outdentAll(amount: string, str: string): string {\n  if (amount) return str.replace(allLeadingSpace, s => s.substr(amount.length));\n  else return str;\n}\nfunction indentAll(amount: string, str: string): string {\n  return str.replace(/\\n/gm, `\\n${amount}`);\n}\n\nfunction wrapArgs(open: string, args: ValueOrExpr[], opts: ValueOrExpr, close: string, keyMod?: number, wrapSetting?: keyof _ListOverride): string {\n  if ((!args || !args.length) && !opts) return `${open}${close}`;\n  _level++;\n  const _f = _first;\n  let parts: string[];\n  if (keyMod) {\n    parts = [];\n    for (let i = 0; i < args.length; i++) {\n      if (i % keyMod === 0) {\n        _key = true;\n        parts.push(_stringify(args[i]) + ':');\n        _key = false;\n      } else {\n        _level++;\n        _first = i === 1;\n        const res = _stringify(args[i]);\n        if (res[0] === '\\n')  parts[parts.length - 1] += ' ' + res.replace(leadingSpace, '');\n        else parts[parts.length - 1] += res;\n        _level--;\n      }\n    }\n  } else {\n    parts = args.map((a, i) => {\n      _first = i === 0;\n      return _stringify(a);\n    });\n  }\n  if (opts && typeof opts === 'object') {\n    const args = 'op' in opts && opts.args ? opts.args : 'v' in opts ? Object.entries(opts.v).reduce((a, c) => (a.push({ v: c[0] }, { v: c[1] }), a), []) : [];\n    for (let i = 0; i < args.length; i++) {\n      if (i % 2 === 0) {\n        _key = true;\n        parts.push(_stringify(args[i]) + ':');\n        _key = false;\n      } else {\n        _level++;\n        _first = i === 1;\n        const res = _stringify(args[i]);\n        if (res[0] === '\\n')  parts[parts.length - 1] += ' ' + res.replace(leadingSpace, '');\n        else parts[parts.length - 1] += res;\n        _level--;\n      }\n    }\n  }\n  _level--;\n  _first = _f;\n\n  let join = _listcommas ? ', ' : ' ';\n  if (_noindent || (parts.length == 1 && !~parts[0].indexOf('\\n'))) return `${open}${parts.join(join)}${close}`;\n  let wrap = _listwrap[wrapSetting || 'args'];\n  const base = parts.join(_listcommas ? ', ' : ' ');\n  if (!wrap && ~base.indexOf('\\n')) wrap = 1;\n  if (wrap === 1 && _listcommas) join = ',\\n';\n\n  const level = padl('', '  ', _level);\n\n  if (!wrap) return `${open}${base}${close}`;\n  else if (wrap === 1) return `${open}\\n${parts.map(p => `${level}  ${p}`).join(join)}\\n${level}${close}`;\n  if (base.length <= wrap) return `${open}${base}${close}`;\n\n  let res = `${open}`;\n  let str = '';\n  const last = parts.length - 1;\n  for (let i = 0; i < parts.length; i++) {\n    if (~parts[i].indexOf('\\n')) {\n      if (str) res += str;\n      res += `\\n${parts[i][0] === ' ' ? '' : level + '  '}${parts[i]}${i !== last ? join : ''}`;\n      str = '';\n      continue;\n    }\n    if (!str) str += `\\n${level}  `;\n    str += `${parts[i]}${i !== last ? join : ''}`;\n    if (str.length >= wrap) {\n      res += str;\n      str = '';\n    }\n  }\n  if (str) res += str;\n  return `${res}\\n${level}${close}`;\n}\n\nfunction isBlock(v: any): boolean {\n  return typeof v === 'object' && 'op' in v && v.op === 'block';\n}\n\nfunction stringifyIf(op: Operation): string {\n  if (!op.args || op.args.length < 2) return 'false';\n\n  let str = '';\n\n  const last = op.args.length - 1;\n  const block = !!op.args.find((p, i) => (i % 2 === 1 || i === last) && isBlock(p));\n\n  _level++;\n  const parts = op.args.map((a, i) => _stringify(block && (i % 2 === 1 || i === last) && !isBlock(a) ? { op: 'block', args: [a] } : a));\n  _level--;\n\n  const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || '';\n  let split = _noindent ? '' : parts.length > 3 || long ? `\\n${padl('', '  ', _level)}` : '';\n  const cindent = long && `${split}  ` || ' ';\n  split = split || ' ';\n  for (let i = 0; i <= last; i++) {\n    if (i === 0) {\n      if (block) str += `if ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else {\n        const cond = parts[i++];\n        str += `if ${cond}${~cond.indexOf('\\n') ? split : ' '}then${cindent}${parts[i].trimLeft()}`\n      }\n    } else if (i === last) {\n      if (block) str = str.trimRight() + ` else ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${split}else${cindent}${parts[i].trimLeft()}`;\n    } else {\n      if (block) str = str.trimRight() + ` elif ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${split}elif ${parts[i++]} then${cindent}${parts[i].trimLeft()}`;\n    }\n  }\n  if (!block && _level) str += `${split}end`;\n\n  return str;\n}\n\nconst caseRE = /@case\\b/g;\nfunction stringifyCase(op: Operation): string {\n  if (!op.args || op.args.length < 2) return 'false';\n\n  let str = '';\n\n  const last = op.args.length - 1;\n  const block = !!op.args.find((p, i) => ((i > 1 && i % 2 === 0) || i === last) && isBlock(p));\n\n  _level++;\n  const parts = op.args.map((a, i) => {\n    let res: string;\n    if (i !== 0) _level++;\n\n    if (block && (i > 1 && i % 2 === 0 || i === last)) {\n      res = _stringify(isBlock(a) ? a : { op: 'block', args: [a] });\n    } else if (i % 2 === 0 || i === last) {\n      res = _stringify(a);\n    } else {\n      res = typeof a === 'object' && 'op' in a ? _stringify(a).replace(caseRE, '_') : _stringify(a);\n    }\n\n    if (i !== 0) _level--;\n\n    return res;\n  });\n  _level--;\n\n  const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || '';\n  let split = _noindent ? '' : parts.length > 3 || long ? `\\n${padl('', '  ', _level)}` : '';\n  const wsplit = split ? `${split}  ` : ' ';\n  const cindent = long && `${wsplit}  ` || ' ';\n  split = split || ' ';\n  for (let i = 0; i <= last; i++) {\n    if (i === 0) {\n      if (block) str += `case ${parts[i]}`;\n      else str += `case ${parts[i]}`\n    } else if (i === last) {\n      if (block) str = str.trimRight() + wsplit + `else ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${wsplit}else${cindent}${parts[i].trimLeft()}`\n    } else {\n      if (block) str = str.trimRight() + wsplit + `when ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else {\n        const cond = parts[i++];\n        str += `${wsplit}when ${cond}${~cond.indexOf('\\n') ? wsplit : ' '}then${cindent}${parts[i].trimLeft()}`;\n      }\n    }\n  }\n  if (!block && _level) str += `${split}end`;\n\n  return str;\n}\n\nfunction stringifyTemplate(parts: ValueOrExpr[]) {\n  const start = _tpl;\n  _tpl = true;\n  const res = parts.map(p => _stringify(p)).join('');\n  _tpl = start;\n  return res;\n}\n\nfunction stringifyTemplateBlock(op: Operation): string {\n  _tpl = false;\n  const cond = _stringify(op.args[0]);\n  _tpl = true;\n  const first = _stringify(op.args[1]);\n  let res = `{{${op.op} ${cond}}}${op.op === 'with' || op.op === 'each' ? first.slice(2) : first}`;\n  if (op.op === 'unless') return `${res}{{/}}`;\n  for (let i = 2; i < op.args.length; i++) {\n    if (i + 1 >= op.args.length) {\n      const arg = op.args[i];\n      if (typeof arg === 'object' && 'v' in arg && arg.v === '') continue;\n      else res += `{{else}}${_stringify(arg)}`;\n    } else {\n      _tpl = false;\n      res += `{{elseif ${_stringify(op.args[i++])}}}`;\n      _tpl = true;\n      res += _stringify(op.args[i]);\n    }\n  }\n  res += '{{/}}';\n  return res;\n}\n\nfunction stringifyTemplateCase(op: Operation): string {\n  const last = op.args.length - 1;\n  const parts = op.args.map((a, i) => {\n    _tpl = true;\n    if (i === 0 || i % 2 === 1) _tpl = false;\n    if (i === last) _tpl = true;\n    return typeof a === 'object' && 'op' in a ? _stringify(a).replace(caseRE, '_') : _stringify(a);\n  });\n  _tpl = true;\n  let res = `{{${op.op} ${parts[0]} when ${parts[1]}}}`;\n  for (let i = 2; i <= last; i++) {\n    if (i === last) res += `{{else}}${parts[i]}`;\n    else if (i % 2 === 1) res += `{{when ${parts[i]}}}`;\n    else res += parts[i];\n  }\n  res += '{{/}}';\n  return res;\n}\n\nexport function stringifySchema(schema: Schema, noChecks?: boolean): string {\n  if (noChecks !== undefined) _nochecks = noChecks;\n\n  if (!schema) return 'any';\n  const t = schema.type;\n  const ts = schema.types;\n\n  let strs: string[];\n  let fin = '', open = '', close = '', join = '';\n  let wrap: number = _listwrap.array;\n\n  switch (t) {\n    case 'object':\n    case 'object[]':\n      const arr = !!~t.indexOf('[]');\n      if ((!schema.fields || !schema.fields.length) && !schema.rest) {\n        fin = `{}${arr ? '[]' : ''}`;\n        break;\n      }\n      wrap = _listwrap.keys;\n      _level++;\n      strs = schema.fields ? schema.fields.map((f, i) => {\n        const str = stringifySchema(f);\n        return (f.desc && f.desc.length ? (i === 0 ? '' : `\\n${padl('', '  ', _level)}`) + f.desc.map(c => `// ${c}`).join(`\\n${padl('', '  ', _level)}`) + `\\n${padl('', '  ', _level)}` : '') + `${f.name}${f.required ? '' : '?'}: ${str}`;\n      }) : [];\n      if (schema.rest) strs.push(`...: ${stringifySchema(schema.rest)}`);\n      _level--;\n      open = '{';\n      close = `}${arr ? '[]' : ''}`;\n      join = ', ';\n      break;\n    case 'union':\n    case 'union[]':\n      if (~t.indexOf('[]')) open = 'Array<', close = '>';\n      else if (schema.checks && schema.checks.length) open = '(', close = ')';\n      if (open) _level++;\n      strs = ts.map(u => stringifySchema(u));\n      wrap = _listwrap.union;\n      join = strs.length > 6 || strs.find(s => ~s.indexOf('\\n')) ? ' | ' : '|';\n      if (open) _level--;\n      break;\n    case 'literal':\n      if (typeof schema.literal === 'string') fin = `'${schema.literal.replace(/'/g, '\\\\\\'')}'`;\n      else fin = `${schema.literal}`;\n      break;\n    case 'tuple':\n    case 'tuple[]':\n      if (!t || t.length === 0) {\n        fin = '[]';\n        break;\n      }\n\n      _level++;\n      open = '[', close = `]${~t.indexOf('\\n') ? '[]' : ''}`;\n      join = ', ';\n      strs = ts.map(t => stringifySchema(t));\n      _level--;\n      break;\n    default:\n      fin = schema.ref || t || 'any';\n      if (schema.ref && t === 'array') fin += '[]';\n      break;\n  }\n\n  let defs: string;\n  const level = _noindent ? ' ' : padl('', '  ', _level);\n\n  if (schema.defs) {\n    const keys = Object.keys(schema.defs).sort();\n    defs = keys.map((k, i) => {\n      const def = schema.defs[k];\n      return (def.desc && def.desc.length ? (i === 0 ? '' : `\\n${level}`) + def.desc.map(c => `// ${c}`).join(`\\n${level}`) + `\\n${level}` : '') + `type ${k} = ${stringifySchema(def)}`;\n    }).join(`\\n${level}`);\n  }\n\n  if (!fin) {\n    const l2 = open && !_noindent ? `${level}  ` : level;\n    const nl = _noindent ? '' : '\\n';\n    const lopen = open ? `${open}${nl}${l2}` : '';\n    const lclose = close ? `${nl}${level}${close}` : '';\n    if (wrap === 0) fin = `${lopen}${strs.join(join)}${lclose}`;\n    else if (wrap === 1) fin = `${lopen}${strs.join(`${join}${nl}${l2}`)}${lclose}`;\n    else {\n      let line = '';\n      \n      const last = strs.length - 1;\n      for (let i = 0; i < strs.length; i++) {\n        if (~strs[i].indexOf('\\n')) {\n          line = '';\n          fin += (i === 0 ? '' : '\\n' + l2) + strs[i] + (i !== last ? join : '');\n        } else {\n          fin += strs[i], line += strs[i];\n          if (i !== last) fin += join, line += join;\n        }\n\n        if (line.length > wrap && i !== last && !~(strs[i + 1] || '').indexOf('\\n')) {\n          fin += `${nl}${l2}`;\n          line = '';\n          if (~join.indexOf('|')) fin += '  ';\n        }\n      }\n\n      if (~fin.indexOf('\\n')) fin = `${lopen}${fin}${lclose}`;\n      else fin = `${open}${open === '{' ? ' ' : ''}${fin}${open === '{' && fin.substr(-1) !== ' ' ? ' ' : ''}${close}`;\n    }\n  }\n\n  if (!_nochecks && schema.checks && schema.checks.length) {\n    fin += ` ?${schema.checks.map(c => _stringify(c)).join(' ?')} `;\n  }\n\n  if (defs) fin = `${defs}\\n${level}\\n${level}${fin}`;\n\n  return fin;\n}\n","import { parser as makeParser, map, seq, str, opt } from 'sprunge';\nimport { ws } from 'sprunge/lib/json';\nimport { schema } from '../parse';\n\nexport const parseSchema = makeParser(\n  map(seq(opt(str('@[')), ws, schema(), ws, opt(str(']'))), ([, , schema]) => schema),\n  { trim: true, consumeAll: true },\n);\nexport { stringifySchema as unparseSchema } from './stringify';\n","import { parser as makeParser, opt, str, alt, seq, map, rep1sep, read1 } from 'sprunge/lib';\nimport { digits, ws } from 'sprunge/lib/json';\nexport { ParseError } from 'sprunge/lib';\n\nconst space = ' \\t\\r\\n';\n\nconst num = map(seq(opt(str('-')), read1(digits)), ([neg, num]) => neg ? -num : +num);\nconst num_range = map(seq(num, str('-', ':'), num), ([start,, end]) => [start, end].sort((l, r) => l < r ? -1 : l > r ? 1 : 0) as [number, number]);\nconst sign_range = map(seq(str('<', '>'), ws, num), ([sign,, num]) => sign === '<' ? [-Infinity, num - 1] as [number, number] : [num + 1, Infinity] as [number, number]);\nconst star_range = map(str('*'), () => [-Infinity, Infinity] as [number, number]);\nconst not_range = map(seq(str('!'), alt<number|[number, number]>(num_range, sign_range, num)), ([, range]) => ({ not: range }));\n\nconst _range = rep1sep(alt<number|[number, number]|{ not: number|[number, number] }>(star_range, num_range, sign_range, num, not_range), read1(space + ',;'), 'allow');\n\nexport const range = makeParser(_range, { trim: true });\n\nexport default range;\n","import { parseDate } from './parse';\nimport { dateRelToDate } from './index';\n\nexport function join(...strs: string[]): string {\n  return strs.filter(s => s).join('.');\n}\n\nexport interface Diff {\n  [path: string]: [any, any];\n}\n\nconst looseEqual = (v1: any, v2: any) => v1 == v2;\nconst strictEqual = (v1: any, v2: any) => v1 === v2;\nconst isNum = /^[\\d.]+$/;\nconst trueStrings = /^(true|on|yes)$/i;\nconst falseStrings = /^(false|off|no)$/i;\nconst sqlEqual = (v1: any, v2: any) => {\n  let tmp1: any, tmp2: any;\n  if ((typeof v1 === 'number' || typeof v1 === 'string' && isNum.test(v1)) && (typeof v2 === 'number' || typeof v2 === 'string' && isNum.test(v2))) {\n    return +v1 === +v2;\n  } else if ((typeof v1 === 'boolean' || typeof v2 === 'boolean') && (typeof v1 === 'string' || typeof v2 === 'string')) {\n    return trueStrings.test(v1) && trueStrings.test(v2) || falseStrings.test(v1) && falseStrings.test(v2);\n  } else if ((v1 instanceof Date || typeof v1 === 'string' && Array.isArray((tmp1 = parseDate(v1) as any)?.f)) && (v2 instanceof Date || typeof v2 === 'string' && Array.isArray((tmp2 = parseDate(v2) as any)?.f))) {\n    if (tmp1) tmp1 = dateRelToDate(tmp1);\n    else tmp1 = v1;\n    if (tmp2) tmp2 = dateRelToDate(tmp2);\n    else tmp2 = v2;\n    return +tmp1 === +tmp2;\n  }\n\n  else return v1 == v2;\n};\n\ntype Identifier = true|string|((v: any) => any);\nexport interface IdentityMap {\n  [path: string]: Identifier;\n}\n\ntype EqualizerValue = 'strict'|'loose'|'sql'|((v1: any, v2: any) => boolean);\ninterface EqualizerOptions {\n  type?: EqualizerValue;\n  /** A map of identity methods to use when comparing elements within an array, making arrays act as a set */\n  identity?: IdentityMap;\n}\ntype Equalizer = EqualizerOptions | EqualizerValue;\n\nconst fullnum = /^\\d+$/;\nfunction checkIdentity(map: IdentityMap, path: string) {\n  const p = path.split('.').reduce((a, c) => fullnum.test(c) ? `${a}[]` : `${a}${a.length ? '.' : ''}${c}`, '');\n  return map[`${p}[]`];\n}\n\nexport interface DiffOpts {\n  equal?: Equalizer;\n  keys?: 'all'|'common';\n}\n\nexport function diff(v1: any, v2: any, opts?: DiffOpts): Diff {\n  const type = opts?.equal && typeof opts.equal === 'object' ? opts.equal.type : opts?.equal;\n  const eq = typeof type === 'function' ? type : type === 'strict' ? strictEqual : type === 'sql' ? sqlEqual : looseEqual;\n  return _diff(v1, v2, '', {}, eq, typeof opts?.equal === 'object' ? opts?.equal.identity : undefined, opts?.keys || 'all');\n}\n\nfunction _diff(v1: any, v2: any, path: string, diff: Diff, equal: (v1: any, v2: any) => boolean, ident?: IdentityMap, keyMode?: 'all'|'common'): Diff {\n  if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n    if (v1 === v2) return diff;\n    diff[path] = [v1, v2];\n    return diff;\n  }\n\n  let id: Identifier;\n  if (Array.isArray(v1) && Array.isArray(v2) && ident && (id = checkIdentity(ident, path))) {\n    const v1ids = v1.map(v => id === true ? v : typeof id === 'string' ? (v && (typeof v === 'object' || typeof v === 'function') ? v[id] : v) : id(v));\n    const v2ids = v2.map(v => id === true ? v : typeof id === 'string' ? (v && (typeof v === 'object' || typeof v === 'function') ? v[id] : v) : id(v));\n    for (let i = 0; i < v1ids.length; i++) {\n      const idx = v2ids.indexOf(v1ids[i]);\n      if (~idx) {\n        const vv1 = v1[i];\n        const vv2 = v2[idx];\n\n        if (vv1 === vv2) continue;\n        else if (typeof vv1 === 'object' && typeof vv2 === 'object') _diff(vv1, vv2, join(path, `${i}`), diff, equal, ident);\n        else if (!equal(vv1, vv2)) diff[join(path, `${i}`)] = [vv1, vv2];\n      } else diff[join(path, `${i}`)] = [v1[i], undefined];\n    }\n\n    const found = v1ids.slice();\n    for (let i = 0; i < v1ids.length; i++) {\n      if (~found.indexOf(v2ids[i])) continue;\n      diff[join(path, `${i + found.length}`)] = [undefined, v2[i]];\n    }\n  } else {\n    const _v1 = v1 || {};\n    const _v2 = v2 || {};\n    const ks: string[] = [];\n    if (keyMode === 'common') {\n      for (const k of Object.keys(_v1)) if (k in _v2) ks.push(k);\n    } else {\n      ks.push.apply(ks, Object.keys(_v1));\n      for (const k of Object.keys(_v2)) if (!~ks.indexOf(k)) ks.push(k);\n    }\n\n    for (const k of ks) {\n      const vv1 = _v1[k];\n      const vv2 = _v2[k];\n\n      if (vv1 === vv2) continue;\n      else if (typeof vv1 === 'object' && typeof vv2 === 'object') _diff(vv1, vv2, join(path, k), diff, equal, ident);\n      else if (!equal(vv1, vv2)) diff[join(path, k)] = [vv1, vv2];\n    }\n  }\n\n  return diff;\n}\n\nexport function deepEqual(v1: any, v2: any, equal?: EqualizerValue): boolean {\n  const eq = typeof equal === 'function' ? equal : equal === 'strict' ? strictEqual : equal === 'sql' ? sqlEqual : looseEqual;\n  return _deepEqual(v1, v2, eq);\n}\n\nfunction _deepEqual(v1: any, v2: any, equal: (v1: any, v2: any) => boolean): boolean {\n  if (typeof v1 !== 'object' || typeof v2 !== 'object') return equal(v1, v2);\n  if ((!v1 || !v2) && v1 != v2) return false; // eslint-ignore-line eqeqeq\n\n  const ks = Object.keys(v1 || {});\n  for (const k of Object.keys(v2 || {})) if (!~ks.indexOf(k)) ks.push(k);\n\n  for (const k of ks) {\n    const vv1 = v1[k];\n    const vv2 = v2[k];\n\n    if (vv1 === vv2) continue;\n    else if (typeof vv1 === 'object' && typeof vv2 === 'object') {\n      if (!_deepEqual(vv1, vv2, equal)) return false;\n    } else if (!equal(vv1, vv2)) return false;\n  }\n\n  return true;\n}\n\nexport interface LabelOptions {\n  /** Omit keys in the original diff that aren't in the label. */\n  omit?: boolean;\n}\n\nexport function labelDiff(diff: Diff, label: any, opts?: LabelOptions): Diff {\n  const out: Diff = opts?.omit ? {} : Object.assign({}, diff);\n  _labelDiff(diff, label, '', '', out, opts);\n  return out;\n}\n\nconst num = /^\\d+/;\nfunction _labelDiff(diff: Diff, label: any, path: string, str: string, out: Diff, opts?: LabelOptions) {\n  for (const k in label) {\n    if (k.slice(-2) === '[]') {\n      const p = `${path}${path && '.'}${k.slice(0, -2)}`;\n      const l = Array.isArray(label[k]) ? label[k] : [label[k]];\n      const all = Object.keys(diff);\n      const nums: string[] = [];\n      for (const k of all) {\n        if (k.indexOf(p) === 0 && num.test(k.substr(p.length + 1))) {\n          const idx = k.indexOf('.', p.length + 1);\n          const num = k.substring(p.length + 1, ~idx ? idx : undefined);\n          if (!~nums.indexOf(num)) nums.push(num)\n        }\n      }\n      const lbl = `${str}${str && ' '}${l[0]}`;\n      for (const num of nums) {\n        const pp = `${p}${p && '.'}${num}`;\n        if (pp in diff) {\n          out[`${lbl}${lbl && ' '}${+num + 1}`] = diff[pp];\n          if (opts?.omit) delete out[pp];\n        }\n        if (l[1]) _labelDiff(diff, l[1], pp, `${lbl}${lbl && ' '}${+num + 1}`, out, opts);\n      }\n    } else {\n      const p = `${path}${path && '.'}${k}`;\n      let l = Array.isArray(label[k]) ? label[k] : [label[k]];\n      const lbl = `${str}${str && ' '}${l[0]}`;\n      if (p in diff) {\n        out[lbl] = diff[p];\n        if (opts?.omit) delete out[p];\n      }\n      if (l[1]) _labelDiff(diff, l[1], p, lbl, out, opts);\n    }\n  }\n}\n","import { Schema, Field, Type, TypeMap } from './index';\nimport { join } from './diff';\nimport { parseSchema, unparseSchema } from './parse/schema';\nimport { evalApply, Root, Context, safeGet, extend, isDateRel } from './index';\n\nconst date = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z$/;\nfunction isDate(v: any) {\n  if (typeof v === 'object') return isDateRel(v);\n  else if (typeof v === 'string' && date.test(v)) return true;\n  return false;\n}\n\nexport function isSchema(what: any): what is Schema {\n  return what && typeof what === 'object' && 'type' in what && typeof what.type === 'string';\n}\n\nexport function inspect(base: any, flat?: boolean): Schema {\n  const root = getType(base);\n  if (Array.isArray(base)) {\n    const fields: Field[] = [];\n    fields.push({ type: 'number', name: 'length' });\n    if (!flat && base.length > 0) {\n      const val = inspect(base[0]);\n      if (val.fields) fields.push({ type: val.type, fields: val.fields, name: '0' });\n      else fields.push({ type: val.type, name: '0' });\n    }\n    return { type: root, fields };\n  } else if (typeof base === 'object' && !isDate(base)) {\n    const fields: Field[] = [];\n    for (const k in base) {\n      fields.push(getField(k, base[k], flat));\n    }\n    return { type: root, fields };\n  }\n  return { type: root };\n}\n\nfunction getField(name: string, v: any, flat?: boolean): Field {\n  const type = getType(v);\n  if (!flat && (~type.indexOf('object') || type === 'array')) {\n    const cs = inspect(v);\n    if (cs.fields) return { type, fields: cs.fields, name };\n    else return { type, name };\n  }\n  return { type: getType(v), name };\n}\n\nfunction getType(v: any): Type {\n  if (typeof v === 'string') {\n    if (isDate(v)) return 'date';\n    else return 'string';\n  }\n  else if (typeof v === 'number') return 'number';\n  else if (typeof v === 'boolean') return 'boolean';\n  else if (Array.isArray(v)) {\n    if (v.length < 1) return 'array';\n    else if (typeof v[0] === 'string') {\n      if (isDate(v[0])) return 'date[]';\n      else return 'string[]';\n    }\n    else if (typeof v[0] === 'number') return 'number[]';\n    else if (typeof v[0] === 'boolean') return 'boolean[]';\n    else if (isDate(v[0])) return 'date[]';\n    else if (typeof v[0] === 'object') return 'object[]';\n    else return 'array';\n  } else if (typeof v === 'object') {\n    if (isDate(v)) return 'date';\n    else return 'object';\n  } else return 'any';\n}\n\nexport type ValidationResult = ValidationError[] | true;\nexport interface ValidationError {\n  error: string;\n  type?: 'strict'|'check'|'missing';\n  path?: string;\n  actual?: string;\n  expected?: string;\n  value?: any;\n  literal?: boolean;\n}\n\nexport function validate(value: any, schema: Schema|string, mode?: 'strict'|'missing'|'loose'): ValidationResult {\n  if (typeof schema === 'string') {\n    const parsed = parseSchema(schema);\n    if ('message' in parsed) return [{ error: 'invalid schema' }];\n    schema = parsed;\n  }\n\n  if (!schema) schema = { type: 'any' };\n  const ctx = new Root(value, { special: { types: schema.defs || {} } });\n  return _validate(value, schema, mode, '', ctx);\n}\n\nfunction _validate(value: any, schema: Schema, mode: 'strict'|'missing'|'loose', path: string, ctx: Context, required?: boolean): ValidationResult {\n  schema = schema || {};\n  let _schema = schema;\n  const errs: ValidationError[] = [];\n  const miss = mode === 'strict' || mode === 'missing';\n  if (_schema.ref) {\n    let s = _schema;\n    while (s && s.ref) s = safeGet(ctx, `@types.${s.ref}`);\n    if (s) _schema = s;\n    else if (miss) errs.push({ error: `missing type definition '${_schema.ref}'`, type: 'missing' });\n  }\n  let { checks } = _schema;\n  const { type, fields, rest, types, literal } = _schema;\n  if (!checkType(value, schema.type === 'array' ? 'array' : type, literal, required)) return [{ error: `type mismatch for${required ? ' required' : ''} ${type}`, actual: unparseSchema(inspect(value)), value, path, expected: unparseSchema(_schema, true), literal: type === 'literal' }];\n\n  if (_schema !== schema && schema.checks) {\n    if (!checks) checks = schema.checks;\n    else checks = checks.concat(schema.checks);\n  }\n\n  let tmp: ValidationResult;\n\n  if ((type === 'tuple' || type === 'tuple[]') && types) {\n    const arr = ~type.indexOf('[]');\n    const val: any[][] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      if (!Array.isArray(v)) {\n        errs.push({ error: 'expected a tuple', path: p, value: v });\n      } else if (v.length < types.length) {\n        const diff = types.length - v.length;\n        errs.push({ error: `missing ${diff} field${diff > 1 ? 's' : ''} in tuple`, path: p, expected: unparseSchema({ type: 'tuple', types }) });\n      } else {\n        for (let i = 0; i < types.length; i++) {\n          if ((tmp = _validate(v[i], types[i], mode, join(p, `${i}`), extend(ctx, { value: v[i], path: join(p, `${i}`) }))) !== true) errs.push.apply(errs, tmp);\n        }\n\n        if (mode === 'strict' && v.length > types.length) errs.push({ error: `too many values for tuple`, type: 'strict', path: p, expected: unparseSchema({ type: 'tuple', types }) });\n      }\n    }\n  } else if ((type === 'union' || type === 'union[]') && types) {\n    const arr = ~type.indexOf('[]');\n    const val: any[] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      let ok = false;\n      let legit: ValidationError[];\n      for (const u of types) {\n        if ((tmp = _validate(v, u, mode, p, ctx)) === true) {\n          ok = true;\n          break;\n        } else if (miss && tmp.find(e => e.type === 'missing') || tmp.find(e => e.type === 'check')) {\n          const t = tmp.filter(e => miss && e.type === 'missing' || e.type === 'check');\n        } else if (tmp.find(e => e.path !== p))  {\n          if (!legit) legit = tmp\n          else if (tmp.length < legit.length) legit = tmp;\n          else if (legit.filter(e => e.literal).length > tmp.filter(e => e.literal).length) legit = tmp;\n        }\n      }\n      if (!ok && !legit) errs.push({ error: `type mismatch for union`, actual: unparseSchema(inspect(v)), expected: unparseSchema({ type: 'union', types }), value: v, path: p });\n      else if (!ok && legit) errs.push.apply(errs, legit);\n    }\n  } else if ((type === 'object' || type === 'object[]' || type === 'any') && fields || rest) {\n    const arr = ~type.indexOf('[]') || schema.type === 'array';\n    const val: object[] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      if (typeof v !== 'object' && typeof v !== 'function') {\n        errs.push({ error: 'expected an object', value: v, path: p, actual: unparseSchema(inspect(v), true) });\n        continue;\n      }\n      if (fields) {\n        for (const f of fields) {\n          if (f.required && !(f.name in v)) errs.push({ error: `required field '${f.name}' is missing`, path: join(p, f.name), expected: f.type });\n          else if (v && f.name in v && (tmp = _validate(v[f.name], f, mode, join(p, f.name), extend(ctx, { value: v[f.name], path: join(p, f.name) }), f.required)) !== true) errs.push.apply(errs, tmp);\n        }\n      }\n      if (rest && v) {\n        for (const k in v) {\n          if (fields && fields.find(f => f.name === k)) continue;\n          if (v[k] != null && (tmp = _validate(v[k], rest, mode, join(p, k), extend(ctx, { value: v[k], path: join(p, k) }))) !== true) errs.push.apply(errs, tmp);\n        }\n      } else if (mode === 'strict' && v) {\n        for (const k in v) if (v[k] != null && !fields || !fields.find(f => f.name === k)) errs.push({ error: `unknown field '${k}'`, path: p, type: 'strict', value: v[k] });\n      }\n    }\n  }\n\n  if (!errs.length && checks && checks.length) {\n    let tmp: any;\n    for (let i = 0; i < checks.length; i++) {\n      const c = checks[i];\n      tmp = evalApply(ctx, c, [value]);\n      if (!tmp || typeof tmp == 'string') errs.push({ error: typeof tmp !== 'string' || !tmp ? `check ${i + 1} failed` : tmp, path, value, type: 'check', expected: unparseSchema(schema, true) });\n    }\n  }\n\n  return errs.length ? errs : true;\n}\n\nconst values = ['string', 'number', 'boolean', 'object'];\nexport function checkType(value: any, type?: Type, literal?: any, required?: boolean): boolean {\n  switch (type || 'any') {\n    case 'any':\n    case 'union':\n      return true;\n\n    case 'value': return !Array.isArray(value) && !!~values.indexOf(typeof value) && (typeof value !== 'object' || isDate(value));\n\n    case 'array':\n    case 'tuple':\n    case 'union[]':\n    case 'tuple[]':\n      return Array.isArray(value);\n\n    case 'literal': return value === literal;\n\n    case 'string': return typeof value === 'string';\n    case 'number': return typeof value === 'number';\n    case 'boolean': return typeof value === 'boolean';\n    case 'date': return isDate(value);\n    case 'object': return !Array.isArray(value) && typeof value === 'object' && (!required || value != null);\n    case 'string[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'string', true);\n    case 'number[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'number', true);\n    case 'boolean[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'boolean', true);\n    case 'date[]': return Array.isArray(value) && value.reduce((a, c) => a && isDate(c), true);\n    case 'object[]': return Array.isArray(value) && value.reduce((a, c) => a && !Array.isArray(c) && typeof c === 'object' && (!required || c != null), true);\n  }\n}\n","import { parser, ParseOptions, ParseNode, ParseError, concat, IParser, bracket, readTo, rep1sep, alt, map, repsep, rep, seq, skip, str, verify } from 'sprunge';\n\nexport const DEFAULTS = {\n  record: '\\n',\n  field: ',',\n  header: false,\n  quote: '\"',\n};\n\nexport function csv(options?: CSVOptions) {\n  const opts: typeof DEFAULTS = Object.assign({}, DEFAULTS, options);\n\n  const ws = skip(' \\t\\r\\n'.replace(opts.field, '').replace(opts.record, '').replace(opts.quote, ''));\n  const quote = str(opts.quote || '\"');\n  const quotedField = bracket(seq(ws, quote), map(rep(alt(readTo(opts.quote), map(seq(quote, quote), () => ''))), r => concat(r)), seq(quote, ws));\n  const unquotedField = readTo(opts.record + opts.field, true);\n  const field: IParser<string> = alt(quotedField, unquotedField);\n  const record = verify(rep1sep(field, seq(ws, str(opts.field), ws)), s => s.length > 1 || s[0].length > 0 || 'empty record');\n  const csv: IParser<string[][]> = map(seq(skip(' \\r\\n\\t'), repsep(record, str(opts.record), 'allow'), skip(' \\r\\n\\t')), ([, csv]) => csv);\n\n  const _parse = parser(csv, { consumeAll: true });\n\n  return function parse(input: string, options?: ParseOptions) {\n    const res: ParseNode|string[][]|ParseError = _parse(input, options);\n    if (Array.isArray(res) && res.length > 0) {\n      let header: Array<[string, number]> = undefined;\n      if (Array.isArray(opts.header)) header = opts.header.map((k, i) => [k, i]);\n      else if (typeof opts.header === 'object') header = res.shift().map((k, i) => [opts.header[k] ?? k, i]).filter(o => o[0]) as any[];\n      else if (!!opts.header) header = res.shift().map((k, i) => [k, i]);\n      if (header) {\n        header.sort((a, b) => `${a}`.toLowerCase() < `${b}`.toLowerCase() ? -1 : `${a}`.toLowerCase() > `${b}`.toLowerCase() ? 1 : 0);\n        return res.map(v => header.reduce((a, c) => (a[c[0]] = v[c[1]], a), {} as any));\n      }\n    }\n\n    return res;\n  }\n}\n\nexport interface CSVOptions {\n  field: string;\n  record: string;\n  quote: string;\n  fixedSize?: boolean;\n  order?: boolean;\n  header?: boolean|string[]|{[k: string]:any};\n}\n\n// TODO: handle ascii curses tables?\n\nexport function table(options?: TableOptions) {\n  const opts = Object.assign({ header: true }, options);\n\n  return function parse(input: string, options?: ParseOptions) {\n    const parts = input.split(/\\r?\\n/).filter(v => v);\n    \n    if (parts[1][0] === '|') {\n      for (let i = 0; i < parts.length; i++) {\n        const p = parts[i];\n        parts[i] = p.replace(/^\\|\\s*|\\s*\\|$/g, '');\n      }\n    }\n\n    return parts.map(p => p.trim().split(/\\s*\\|\\s*/));\n  }\n}\n\nexport interface TableOptions {\n  table: 1;\n  header?: boolean;\n  fixedSize?: boolean;\n  order?: boolean;\n}\n\nexport type DelimitedOptions = CSVOptions | TableOptions;\n\nconst fields = [',', '|', '\\t', ':', ';', '~'];\nconst records = ['\\r\\n', '\\r', '\\n'];\nconst quotes = ['\\'', '\"', '`', '$'];\n\nexport function detect(data: string, amount?: number): DelimitedOptions {\n  if (amount === undefined) {\n    amount = data.indexOf('\\n', data.indexOf('\\n', data.indexOf('\\n', 1) + 1) + 1);\n    amount = amount ?? 2048;\n    if (amount < 2048) amount = 2048;\n  }\n  const sample = data.slice(0, amount);\n  // look for tables\n  if (sample.split(/\\r?\\n/).filter(v => v)[1]?.match(/^[-|+\\s_=]+$/)) {\n    return { table: 1, header: true };\n  }\n\n  const fs = fields.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n  const rs = records.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n  const qs = quotes.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n\n  const res = { field: ',', record: '\\n', quote: '\"' };\n\n  let max = 0;\n  for (const k in fs) if (fs[k] > max) (res.field = k, max = fs[k]);\n  max = 0;\n  for (const k in rs) if (rs[k] > max) (res.record = k, max = rs[k]);\n  max = 0;\n  for (const k in qs) if (qs[k] > max) (res.quote = k, max = qs[k]);\n\n  return res;\n}\n\nfunction isTableOpts(opts?: DelimitedOptions): opts is TableOptions {\n  return opts && 'table' in opts && opts.table === 1;\n}\n\nexport function parse(data: string, options?: DelimitedOptions & { header: true|1|string[]|{[k: string]: any} }): any[];\nexport function parse(data: string, options?: DelimitedOptions & { header?: false }): string[][];\nexport function parse(data: string, options?: DelimitedOptions): Array<string[]|any> {\n  let values: string[][];\n  if (isTableOpts(options)) {\n    values = table(options)(data);\n    values.splice(1, 1);\n  } else {\n    const base = csv(Object.assign({}, options, { header: false }))(data);\n    if ('message' in base) return [];\n    values = base;\n  }\n\n  if (options.fixedSize ?? true) {\n    const min = values[0]?.length;\n    values = values.filter(v => v.length >= min);\n  }\n\n  if (options.header && values.length) {\n    let header: Array<[string, number]> = undefined;\n    if (Array.isArray(options.header)) {\n      header = options.header.map((k, i) => [k, i]);\n      if (isTableOpts(options)) values.shift();\n    } else if (typeof options.header === 'object') {\n      header = values.shift().map((k, i) => [options.header[k] ?? k, i]).filter(o => o[0]) as any[];\n    } else if (!!options.header) header = values.shift().map((k, i) => [k, i]);\n    if (header) {\n      header.sort((a, b) => `${a}`.toLowerCase() < `${b}`.toLowerCase() ? -1 : `${a}`.toLowerCase() > `${b}`.toLowerCase() ? 1 : 0);\n      return values.map(v => header.reduce((a, c) => (a[c[0]] = v[c[1]], a), {} as any));\n    }\n  }\n  return values;\n}\n","import { Parser, parser as makeParser, opt, repsep, seq, alt, map, readTo, read1To, rep1, rep, str, read, read1, chars } from 'sprunge';\n\nconst ws = read(' \\r\\n\\t');\nconst endTxt = '&<';\n\nconst entities = { amp: '&', gt: '>', lt: '<' };\nconst entity = map(seq(str('&'), str('amp', 'gt', 'lt'), str(';')), ([,which]) => entities[which] || '', 'entity');\n\nconst name = read1('abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-_:$', 'name');\nconst attr = map(seq(name, opt(seq(ws, str('='), ws, alt(name, quoted('\"'), quoted(\"'\"))))), ([name, rest]) => ({ name, value: rest ? rest[3] : true}), 'attr');\n\nfunction quoted(quote: string) {\n  return map(seq(str(quote), readTo(quote), str(quote)), ([,str]) => str);\n}\n\ninterface Attr {\n  name: string;\n  value: string|boolean;\n}\n\ninterface Open {\n  open: true;\n  name: string;\n  attrs?: Attr[];\n  empty?: boolean;\n}\n\ninterface Close {\n  close: true;\n  name: string;\n}\n\nconst open = map(seq(str('<'), ws, name, ws, repsep(attr, ws, 'allow'), opt(str('/')), str('>')), ([,,name,,attrs,close]) => ({ open: true, name, attrs, empty: !!close } as Open), 'open');\nconst close = map(seq(str('</'), ws, name, ws, str('>')), ([,,name]) => ({ close: true, name } as Close), 'close');\n\nconst content = map(rep1(alt(read1To(endTxt, true), entity), 'content'), txts => txts.join('').trim());\n\nconst stream = rep(alt<string|Open|Close>(open, content, close));\n\nconst _parse = makeParser(stream, { trim: true, consumeAll: true, undefinedOnError: true });\n\nfunction put(target: object, prop: string, value: any) {\n  if (prop in target) {\n    if (Array.isArray(target[prop])) target[prop].push(value);\n    else target[prop] = [target[prop], value];\n  } else {\n    target[prop] = value;\n  }\n}\n\nexport function parse(str: string, strict?: boolean): any {\n  const stack: any[] = [];\n  const names: string[] = [];\n  const res: any[] = [];\n  let content = '';\n  const stream = _parse(str) as Array<string|Open|Close>;\n  if (!stream || 'error' in stream) return undefined;\n\n  function close(end: string) {\n    const val = stack.pop();\n    if (!val) return;\n    const name = names.pop();\n    if (!stack.length) {\n      res.push(val);\n    } else {\n      if (!Object.keys(val).length) put(stack[stack.length - 1], name, content || '');\n      else put(stack[stack.length - 1], name, val);\n    }\n    if (end !== name) close(end);\n  }\n\n  for (const p of stream) {\n    if (typeof p === 'string') {\n      if (p) content += p;\n    } else if ('open' in p) {\n      content = '';\n      const val = p.attrs.reduce((a, c) => (put(a, c.name, c.value), a), {});\n      if (p.empty) {\n        if (stack.length) put(stack[stack.length - 1], p.name, val);\n        else res.push(val);\n      } else {\n        names.push(p.name);\n        stack.push(val);\n      }\n    } else if ('close' in p) {\n      if (strict && p.name !== names[names.length - 1]) return;\n      close(p.name);\n    }\n  }\n\n  if (names.length && !strict) close(names[0]);\n\n  return res.length > 1 ? res : res.length === 1 ? res[0] : undefined;\n}\n","import { filter, safeGet, safeSet, registerOperator, CheckResult, ValueOperator, ValueOrExpr, Context, evaluate, evalApply, evalValue, evalParse, template, extend, formats, virtualFormats, registerFormat, dateRelToRange, dateRelToExactRange, dateRelToDate, isDateRel, isKeypath, isTimespan, isApplication, dateAndTimespan, addTimespan, isValue, datesDiff, DateRel, getOperator, applyOperator, OperatorOptions, sort, toDataSet, Root } from './index';\nimport { date, dollar, ordinal, number, phone } from './format';\nimport { timespans, isTimespanMS, timeSpanToNumber, parseTime, parseDate, parseExpr, parse } from './parse';\nimport { parse as parseTemplate } from './parse/template';\nimport { parseSchema, unparseSchema } from './parse/schema';\nimport { stringify } from './parse/stringify';\nimport { range as parseRange, ParseError } from './parse/range';\nimport { validate, inspect, isSchema } from './schema';\nimport { diff, deepEqual, labelDiff } from './diff';\nimport { detect as csvDetect, parse as csvParse } from './csv';\nimport { style } from './parse/style';\nimport { parse as parseXML } from './parse/xml';\nimport { measure, escapeHTML } from '../render/index';\n\nfunction simple(names: string[], apply: (name: string, values: any[], opts: OperatorOptions, ctx: Context) => any): ValueOperator {\n  return {\n    type: 'value', names, apply\n  };\n}\n\nconst spanMap = {\n  y: [0, 12],\n  M: [1, 30],\n  d: [2, 24],\n};\n\nconst generateDefaults = {\n  max: 10000,\n};\n\nfunction stringTimes(str: string, times: number): string {\n  let res = '';\n  for (let i = 0; i < times; i++) res += str;\n  return res;\n}\n\ntype RoundingMethod = 'half-up'|'half-down'|'half-even'|'half-odd'|'half-to-0'|'half-from-0'|'to-0'|'from-0'|'up'|'down';\nconst roundDefaults = {\n  places: 2,\n  'all-numeric': false,\n  method: 'half-even' as RoundingMethod,\n};\nexport function round(amt: string|number, settings?: { places: number; method: RoundingMethod }): string {\n  const place = settings?.places ?? roundDefaults.places;\n  const type = settings?.method ?? roundDefaults.method;\n  if (place > 0) {\n    let str = (+amt || 0).toString();\n    const point = str.indexOf('.');\n    if (!~point) return (+str).toFixed(place);\n    let dec = str.slice(point + 1);\n    if (dec.length <= place) return (+str).toFixed(place);\n    str += '0';\n    dec += '0';\n    const l = +`${str.slice(place - dec.length, place - dec.length + 1)}` || 0;\n    const rest = parseInt(str.slice(place - dec.length) + '0');\n    if (type === 'up' && rest > 0) {\n      if (+amt > 0) return (+str.slice(0, place - dec.length) + +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return str.slice(0, place - dec.length);\n    } else if (type === 'down' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, place - dec.length) - +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return str.slice(0, place - dec.length);\n    } else if (type === 'to-0' && rest > 0) {\n      return str.slice(0, place - dec.length);\n    } else if (type === 'from-0' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, place - dec.length) - +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return (+str.slice(0, place - dec.length) + +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n    }\n    if (+l < 5) return str.slice(0, place - dec.length);\n    else if (+l > 5 || +`${str.slice(1 + place - dec.length)}`) return (+amt).toFixed(place);\n    else {\n      const pre = `${str.slice(0, place - dec.length)}`;\n      const f = +str.slice(place - dec.length - 1, place - dec.length);\n      if (type === 'half-odd') return (+`${pre}${f % 2 === 0 ? 6 : 4}`).toFixed(place);\n      else if (type === 'half-up') return (+`${pre}${+pre > 0 ? 6 : 4}`).toFixed(place);\n      else if (type === 'half-down') return (+`${pre}${+pre > 0 ? 4 : 6}`).toFixed(place);\n      else if (type === 'half-to-0') return (+`${pre}4`).toFixed(place);\n      else if (type === 'half-from-0') return (+`${pre}6`).toFixed(place);\n      else return (+`${pre}${f % 2 === 0 ? 4 : 6}`).toFixed(place);\n    }\n  } else if (place === 0) {\n    let str = (+amt || 0).toString();\n    const point = str.indexOf('.');\n    if (!~point) return str;\n    str = `${str}00`;\n    const p = +str.slice(point - 1, point);\n    const n = +str.slice(point + 1, point + 2);\n    const rest = parseInt(str.slice(point + 1) + '0');\n    if (type === 'up' && rest > 0) {\n      if (+amt > 0) return (+str.slice(0, point) + 1).toFixed(0);\n      else return str.slice(0, point);\n    } else if (type === 'down' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, point) - 1).toFixed(0);\n      else return str.slice(0, point);\n    } else if (type === 'to-0' && rest > 0) {\n      return str.slice(0, point);\n    } else if (type === 'from-0' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, point) - 1).toFixed(0);\n      else if (+amt > 0) return (+str.slice(0, point) + 1).toFixed(0);\n    }\n    if (n < 5) return str.slice(0, point);\n    else if (n > 5 || n === 5 && +str.slice(point + 2)) return (+`${str.slice(0, point - 1)}0` + (p + 1) * (+str < 0 ? -1 : 1)).toString();\n    else {\n      const base = +`${str.slice(0, point - 1)}0`;\n      if (type === 'half-odd') return (base + (p % 2 === 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-up') return (base + (+str > 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-down') return (base + (+str < 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-to-0') return base.toString();\n      else if (type === 'half-from-0') return (base + 1).toString();\n      else return (base + (p % 2 === 0 ? p : p + 1) * (+str < 0 ? -1 : 1)).toString();\n    }\n  } else {\n    let str = `${+amt < 0 ? Math.floor(+amt || 0) : Math.ceil(+amt || 0)}`;\n    if (0 - place > str.length && type !== 'up' && type !== 'down' && type !== 'to-0' && type !== 'from-0') return `0`;\n    const n = +str.slice(place, place === -1 ? undefined : place + 1);\n    const rest = +(str.slice(place) + '0');\n    let p = str.slice(place - 1, place);\n    if (p === '-') p = '';\n    const zeroes = `${Math.pow(10, 0 - place).toString().slice(1)}`\n    if (!p) {\n      const big = `${+str < 0 ? '-' : ''}1${zeroes}`;\n      if (type === 'up') {\n        if (+amt > 0) return big;\n        else return '0';\n      } else if (type === 'down') {\n        if (+amt < 0) return big;\n        else return '0';\n      } else if (type === 'to-0') {\n        return '0';\n      } else if (type === 'from-0') {\n        return big;\n      }\n      if (+str > 0 && +str < 5 || +str < 0 && +str > -5) return '0';\n      else if (+str > 0 && +str > 5 || +str < 0 && +str < -5) return big;\n      else {\n        if (type === 'half-odd') return big;\n        else if (type === 'half-up') return +str > 0 ? big : '0';\n        else if (type === 'half-down') return +str > 0 ? '0' : big;\n        else if (type === 'half-to-0') return '0';\n        else if (type === 'half-from-0') return big;\n        else return '0';\n      }\n    } else {\n      if (type === 'up' && rest > 0) {\n        if (+str > 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) + +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        else return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'down' && rest > 0) {\n        if (+str < 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) - +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        else return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'to-0' && rest > 0) {\n        return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'from-0' && rest > 0) {\n        if (+str > 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) + +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        return (+(str.slice(0, place) + stringTimes('0', place * -1)) - +`1${stringTimes('0', place * -1)}`).toFixed(0);\n      }\n      if (n < 5) return `${str.slice(0, place)}${zeroes}`\n      else if (n > 5 || place < -1 && +`${str.slice(place + 1)}`) return (+`${+str.slice(0, place - 1) || 0}${0}${zeroes}` + +`${+p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n      else {\n        const base = +`${str.slice(0, place - 1) || 0}0${zeroes}`;\n        if (type === 'half-odd') return (base + +`${+p % 2 === 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-up') return (base + +`${+str > 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-down') return (base + +`${+str < 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-to-0') return (base + +`${+p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-from-0') return (base + +`${+p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else return (base + +`${+p % 2 === 0 ? +p : +p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n      }\n    }\n  }\n}\n\nconst hasNum = /^[^\\d]*(\\d+(?:\\.\\d*)?)/;\n\nconst space = /^\\s*$/;\nfunction isNum(v: any): v is number {\n  return !isNaN(v) && !space.test(v);\n}\nfunction num(v: any): number {\n  if (isNaN(v) || !v) return 0;\n  return +v;\n}\n\nfunction equals(l: any, r: any): boolean {\n  if (l === r || l == r) return true; // eslint-disable-line eqeqeq\n  if (isDateRel(l) && isDateRel(r)) return +dateRelToDate(l) === +dateRelToDate(r);\n  if (typeof l === 'number' && typeof r === 'number') return isNaN(l) && isNaN(r);\n  return false;\n}\n\n/**\n * Find the first overlapping substring that contains threshhold percent characters of the smallest string length.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the percentage of the smaller string length needed to match\n * @returns - the substring that matches\n */\nexport function overlap(a: string, b: string, threshhold: number = 0.5): string {\n  const res = similar(a, b, threshhold, 0);\n  return res && res[1] || undefined;\n}\n\n/**\n * Finds the percentage similarity between two strings based on a minimum threshhold and a fudge factor. The minimum threshhold determins the earliest that the search can return. The fudge factor allows skipping characters in either string, though there is no backtracking.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the required similarity between two substrings, accounting for the fudge factor\n * @param fudges - the number skippable characters in either string without a match\n * @param whole - adjust the similarity account for the whole string rather than only the first matching substring\n * @returns - the similarity of the first qualifying match\n */\nexport function similarity(a: string, b: string, threshhold: number = 0.5, fudges: number = 2, whole = false): number {\n  const res = similar(a, b, threshhold, fudges);\n  if (res && whole) return (res[2] || 0) * (((res[0].length / a.length) + (res[1].length / b.length)) / 2);\n  return res && res[2] || 0;\n}\n\n/**\n * Finds the similarity between two strings based on a minimum threshhold and a fudge factor. The minimum threshhold determins the earliest that the search can return. The fudge factor allows skipping characters in either string, though there is no backtracking.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the required similarity between two substrings, accounting for the fudge factor\n * @param fudges - the number skippable characters in either string without a match\n * @returns - a tuple of the substrings from each string and the similarity percentage, accounting for the fudge factor\n */\nexport function similar(a: string, b: string, threshhold: number = 0.5, fudges: number = 2): [string, string, number] {\n  if (!a || !b) return;\n  const aa = a.toLowerCase();\n  const bb = b.toLowerCase();\n\n  // check containment\n  if (~aa.indexOf(bb)) bb;\n  if (~bb.indexOf(aa)) aa;\n\n  let i1 = 0;\n  let i2 = 0;\n  let oa = 0;\n  let ob = 0;\n  let f = 0;\n  let f1 = 0;\n  let f2 = 0;\n  let fs = 0;\n  let sim = 0;\n\n  const alen = a.length;\n  const blen = b.length;\n  let aolen = 0;\n  let bolen = 0;\n\n  // walk a\n  for (i1 = 0; i1 < alen; i1++) {\n    // walk b\n    for (i2 = 0; i2 < blen; i2++) {\n      // if there's a match, see how far it goes\n      if (aa[i1] === bb[i2]) {\n        aolen = alen - i1;\n        bolen = blen - i2;\n        fs = 0;\n        // walk the remaining pieces of each string checking for matches\n        matchy: for (oa = 1, ob = 1; oa < aolen && ob < bolen;) {\n          if (aa[i1 + oa] === bb[i2 + ob]) { // nailed it\n            oa++, ob++;\n          } else { // not so much, so compare closer chars in each string, walking outward\n            for (f = 0; f <= fudges; f++) {\n              for (f1 = 0; f1 <= f; f1++) {\n                for (f2 = 0; f2 <= f; f2++) {\n                  if (aa[i1 + oa + f1] === bb[i2 + ob + f2]) {\n                    oa += f1;\n                    ob += f2;\n                    fs += Math.max(f1, f2); // keep track of the fudge factor\n                    continue matchy;\n                  }\n                }\n              }\n            }\n            break matchy; // not even fudge could save it\n          }\n        }\n\n        sim = (Math.max(oa, ob) - fs) / Math.min(aa.length, bb.length); // get approximate similarity\n        if (sim >= threshhold) return [aa.substr(i1, oa), bb.substr(i2, ob), sim]; // and if it exceeds the threshold, we're good\n      }\n    }\n  }\n}\n\nexport function inRange(v: number, range: Array<number|[number, number]|{ not: number|[number, number] }>): boolean {\n  let found = false;\n  let excluded = false;\n  for (const r of range) {\n    if (Array.isArray(r) && v >= r[0] && v <= r[1]) found = true;\n    else if (typeof r === 'object' && 'not' in r) {\n      if (Array.isArray(r.not) && v >= r.not[0] && v <= r.not[1]) excluded = true;\n      else if (v == r.not) excluded = true;\n    } else if (v == r) found = true;\n  }\n  return found && !excluded;\n}\n\n// basic ops\nregisterOperator(\n  simple(['is', 'is-not', '==', '!='], (name: string, values: any[]): boolean => {\n    const [l, r] = values;\n    let cmp = equals(l, r);\n    if (!cmp && (name === 'is' || name === 'is-not') && isSchema(r)) cmp = validate(l, r, 'loose') === true;\n    return name === 'is' || name === '==' ? cmp : !cmp;\n  }),\n  simple(['strict-is', 'strict-is-not'], (name: string, values: any[]): boolean => {\n    const [l, r] = values;\n    let res = l === r;\n    if (!res && isSchema(r)) res = validate(l, r, 'strict') === true;\n    return name === 'strict-is' ? res : !res;\n  }),\n  simple(['deep-is', 'deep-is-not', '===', '!=='], (name: string, [l, r, equal]: any[], opts, ctx: Context): boolean => {\n    equal = equal || opts?.equal;\n    if (equal && isApplication(equal)) {\n      const eq = equal;\n      equal = (l: any, r: any) => evalApply(ctx, eq, [l, r]);\n    }\n    const res = deepEqual(l, r, equal);\n    return name === 'deep-is' || name === '===' ? res : !res;\n  }),\n  simple(['not'], (_name: string, values: any[]) => !values[0]),\n  simple(['<', '>', '<=', '>=', 'gt', 'gte', 'lt', 'lte'], (name: string, values: any[]): boolean => {\n    if (name === 'gt') name = '>';\n    else if (name === 'lt') name = '<';\n    else if (name === 'gte') name = '>=';\n    else if (name === 'lte') name = '<=';\n    let [l, r] = values;\n    if (l instanceof Date || r instanceof Date) {\n      if (typeof l === 'number' || typeof r === 'number') {\n        l = +l; r = +r;\n      } else if (typeof l === 'string' || typeof r === 'string') {\n        l = new Date(l); r = new Date(r);\n      } else if (l && 'f' in l && 'o' in l) {\n        l = dateRelToRange(l)[name[0] === '<' ? 1 : 0];\n        r = new Date(r);\n      } else if (r && 'f' in r && 'o' in r) {\n        r = dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1];\n        l = new Date(l);\n      }\n    } else if (isDateRel(l)) {\n      l = dateRelToRange(l)[name[0] === '<' ? 1 : 0];\n      r = isDateRel(r) ? dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1] : new Date(r);\n    } else if (isDateRel(r)) {\n      r = dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1];\n      l = new Date(l);\n    }\n    return name === '<' ? l < r :\n      name === '>' ? l > r :\n        name === '<=' ? l <= r :\n          name === '>=' ? l >= r :\n            false;\n  }),\n  simple(['like', 'not-like', 'ilike', 'not-ilike'], (name: string, values: any[]): boolean => {\n    const [target, pattern, arg] = values;\n    let res: boolean = false;\n    const patterns = typeof pattern === 'string' ? [pattern] : pattern;\n    const free = arg === 'free' || (typeof arg === 'object' && arg.free);\n    if (!Array.isArray(patterns)) return false;\n    for (let i = 0; i < patterns.length && !res; i++) {\n      const r = patterns[i];\n      if (typeof r !== 'string') continue;\n      const re = new RegExp(`${free ? '' : '^'}${r.replace(/[\\s\\%\\*]+/g, '[\\\\s\\\\S]*').replace(/\\?/g, '.')}${free ? '' : '$'}`, ~name.indexOf('ilike') ? 'i' : '');\n      if (Array.isArray(target)) res = !!target.find(v => re.test(v));\n      else res = re.test(target);\n    }\n    return name === 'like' || name === 'ilike' ? res : !res;\n  }),\n  simple(['in', 'not-in'], (name: string, values: any[], _opts, ctx: Context): boolean => {\n    const [l, r] = values;\n    let range: any;\n    if (isDateRel(r)) {\n      const range = dateRelToRange(r);\n      const d = isDateRel(l) ? dateRelToRange(l)[0] : new Date(l);\n      const n = d >= range[0] && d <= range[1];\n      return name === 'in' ? n : !n;\n    } else if (typeof l === 'string' && typeof r === 'object' && !Array.isArray(r)) {\n      return l in r;\n    } else if (Array.isArray(l) && l.length > 0 && typeof l[0] === 'string' && !Array.isArray(r) && r && typeof r === 'object') {\n      const keys = Object.keys(r);\n      const found = l.reduce((a, c) => a && ~keys.indexOf(c), true);\n      return name === 'in' ? found : !found;\n    } else if (typeof r === 'string' && isNum(l) && (range = _parseRange(ctx, r), Array.isArray(range))) {\n      const found = inRange(+l, range);\n      return name === 'in' ? found : !found;\n    } else if (isApplication(l)) {\n      let found: any = false;\n      if (Array.isArray(r) || r && typeof r === 'object' && '0' in r) found = Array.prototype.find.call(r, (e: any, i: number) => evalApply(ctx, l, [e, i], { index: i, key: i }));\n      else if (r && typeof r === 'object') found = Object.entries(r).find((e, i) => evalApply(ctx, l, [e[1], i, e[0]], { index: i, key: e[0] }));\n      return name === 'in' ? !!found : !found;\n    } else if (!Array.isArray(r) && typeof r !== 'string') {\n      return name === 'in' ? l == r : l != r;\n    } else if (Array.isArray(l) && Array.isArray(r)) {\n      const b = l.reduce((a, c) => a && ~r.indexOf(c), true);\n      return name === 'in' ? !!b : !b;\n    }\n    const res = !!~r.indexOf(l);\n    return name === 'in' ? res : !res;\n  }), \n  simple(['contains', 'does-not-contain'], (name: string, values: any[], _opts, ctx: Context): boolean => {\n    const [l, r] = values;\n    if (isDateRel(l)) {\n      const range = dateRelToRange(l);\n      const d = isDateRel(r) ? dateRelToRange(r)[0] : new Date(r);\n      const n = d >= range[0] && d <= range[1];\n      return name === 'contains' ? n : !n;\n    } else if (isApplication(r)) {\n      let found: any = false;\n      if (Array.isArray(l) || l && typeof l === 'object' && '0' in l) found = Array.prototype.find.call(l, (e: any, i: number) => evalApply(ctx, r, [e, i], { index: i, key: i }));\n      else if (r && typeof l === 'object') found = Object.entries(l).find((e, i) => evalApply(ctx, r, [e[1], i, e[0]], { index: i, key: e[0] }));\n      return name === 'contains' ? !!found : !found;\n    } else if (!Array.isArray(l) && typeof l !== 'string') {\n      return false;\n    } else if (Array.isArray(r) && Array.isArray(l)) {\n      const b = r.reduce((a, c) => a && ~l.indexOf(c), true);\n      return name === 'contains' ? !!b : !b;\n    }\n    const res = !!~l.indexOf(r);\n    return name === 'contains' ? res : !res;\n  }),\n  simple(['clamp'], (_name, [min, v, max]: any[]): any => {\n    return v < min ? min : v > max ? max : v;\n  }),\n  simple(['get'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    const [l, r] = values;\n    const c = extend(ctx, { value: l });\n    if (isKeypath(r)) return safeGet(c, r);\n    else if (typeof r === 'number') return safeGet(c, '' + r);\n    else return evaluate(c, r);\n  }),\n  simple(['generate'], (_name: string, [apply], opts, ctx) => {\n    let r: ParseError|Array<number|[number, number]|{ not: number|[number, number] }>;\n    if (apply && isApplication(apply)) {\n      const res = [];\n      let state = opts;\n      let it: any;\n      for (let i = 0; i < generateDefaults.max; i++) {\n        it = evalApply(ctx, apply, [state, it, i], { index: i, last: it, state });\n        if (Array.isArray(it)) it.forEach(v => res.push(v));\n        else if (it && typeof it === 'object') {\n          const keys = Object.keys(it);\n          if (keys.find(k => k !== 'value' && k !== 'state')) res.push(it);\n          else {\n            res.push(it.value);\n            state = it.state || state;\n            it = it.value;\n          }\n        } else if (it === undefined) break;\n        else res.push(it);\n      }\n      return res;\n    } else if ((r = parseRange(apply)) && Array.isArray(r)) {\n      r = r.filter(v => typeof v === 'number' || Array.isArray(v) && !v.find(v => v === Infinity || v === -Infinity) || typeof v === 'object' && !Array.isArray(v));\n      const nums: number[] = [];\n      const no: Array<[number, number]> = [];\n      for (const v of r) if (typeof v === 'object' && !Array.isArray(v)) no.push(typeof v.not === 'number' ? [v.not, v.not] : v.not);\n\n      for (const v of r) {\n        if (nums.length >= generateDefaults.max) break;\n        if (typeof v === 'number' && !no.find(([l, r]) => v >= l && v <= r)) nums.push(v);\n        else if (Array.isArray(v)) {\n          for (let i = v[0]; i <= v[1]; i++) {\n            if (!no.find(([l, r]) => i >= l && i <= r)) nums.push(i);\n            if (nums.length >= generateDefaults.max) break;\n          }\n        }\n      }\n\n      return nums;\n    }\n    return [];\n  }),\n  simple(['array'], (_name: string, values: any[], opts) => {\n    if (values.length === 1 && opts?.range) {\n      let range = values[0];\n      if (typeof range === 'string') range = parseRange(range);\n      if (Array.isArray(range)) {\n        const bounds = Array.isArray(opts.bounds) && opts.bounds.length === 2 && opts.bounds.filter(b => typeof b === 'number').length === 2 ? opts.bounds : [-100, 200];\n        bounds.slice().sort((l, r) => l < r ? -1 : l > r ? 1 : 0);\n        let [lower, upper] = bounds;\n        if (upper - lower > 10000) lower = upper - 10000;\n        const res = [];\n        for (let i = lower; i <= upper; i++) if (inRange(i, range)) res.push(i);\n        return res;\n      } else return [];\n    }\n    return values;\n  }),\n  simple(['object'], (_name: string, values: any[]) => {\n    const res: any = {};\n    if (values.length === 1 && Array.isArray(values[0])) values = values[0];\n    for (let i = 0; i < values.length; i += 2) {\n      res[values[i]] = values[i + 1];\n    }\n    return res;\n  }),\n  simple(['split'], (_name: string, [str, split]: any[]) => {\n    if (typeof str !== 'string') return [str];\n    else return str.split(split || '');\n  }),\n  simple(['filter'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, flt, sorts, groups] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else if (typeof arr === 'object' && arr) {\n        let step = Object.entries(arr).filter((e, i) => evalApply(ctx, flt, [e[1], i, e[0]], { index: i, key: e[0] }));\n        if (sorts) step = sort(ctx, step, sorts, (c, b, v) => evalApply(c, b, [v[1], v[0]], { key: v[0] }));\n        return step.reduce((a, c) => (a[c[0]] = c[1], a), {});\n      }\n      else return [];\n    }\n    return filter({ value: arr }, flt, sorts, groups, ctx).value;\n  }),\n  simple(['source'], (_name: string, values: any[], _opts, ctx): any => {\n    const [val, app] = values;\n    let source = toDataSet(val);\n    if (isApplication(app)) return evalApply(ctx, app, [], { source });\n    return source;\n  }),\n  simple(['group'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, groups] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else return {};\n    }\n    return filter({ value: arr }, null, null, groups, ctx).value;\n  }),\n  simple(['sort'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, sorts] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else if (arr && typeof arr === 'object') {\n        if (!sorts) sorts = [{ a: { r: { p: '@', k: ['key'] } } }];\n        return sort(ctx, Object.entries(arr), sorts, (c, b, v) => evalApply(c, b, [v[1], v[0]], { key: v[0] })).reduce((a, c) => (a[c[0]] = c[1], a), {});\n      }\n      else return {};\n    }\n    if (!sorts) sorts = [{ a: { r: { k: ['_'] } } }];\n    return sort(ctx, arr.slice(), sorts);\n  }),\n  simple(['time-span', 'time-span-ms'], (_name: string, args: any[], opts: any): any => {\n    const namedArgs = opts || {};\n    const span = isDateRel(args[0]) && isDateRel(args[1]) ? datesDiff(dateRelToDate(args[0]), dateRelToDate(args[1])) : isTimespan(args[0]) ? args[0] : 0;\n\n    // if a unit is specified, break the span up\n    if (namedArgs.unit) {\n      const u = ((Array.isArray(namedArgs.unit) ? namedArgs.unit : [namedArgs.unit]) as string[]).map(u => {\n        if (u[0] === 'y') return 'y'\n        else if (u[0] === 'M' || (u[0] === 'm' && u[1] !== 'i' && u[1] !== 'm')) return 'M';\n        else if (u[0] === 'w') return 'w';\n        else if (u[0] === 'd') return 'd';\n        else if (u[0] === 'h') return 'h';\n        else if (u[0] === 'm' && (!u[1] || u[1] === 'i' || u[1] === 'm')) return 'm';\n        else if (u[0] === 's') return 's'\n        else if (u[0] === 'm' && u[1] === 's') return 'l';\n        return '';\n      }).filter(u => !!u);\n\n      // fraction tracks what would be left for rounding\n      let fraction: number;\n      let res: number[];\n\n      // special case for full spans\n      if (typeof span !== 'number' && !isTimespanMS(span)) {\n        const us = u.join('');\n        if (us === 'd') {\n          if (span.s) {\n            const from = new Date(span.s);\n            from.setHours(0);\n            from.setMinutes(0);\n            from.setSeconds(0);\n            from.setMilliseconds(0);\n            const to = new Date(+from);\n            to.setDate(1);\n            to.setFullYear(to.getFullYear() + span.d[0]);\n            to.setMonth(from.getMonth() + span.d[1]);\n\n            const m = to.getMonth();\n            to.setDate(from.getDate());\n\n            // watch out for last day of month next to longer month\n            const end = new Date(+from);\n            const endM = end.getMonth();\n            end.setDate(end.getDate() + 1);\n            if (endM !== end.getMonth()) {\n              // make sure target date is last day of month\n              to.setMonth(to.getMonth() + 1);\n              to.setDate(0);\n            }\n\n            if (to.getMonth() !== m) to.setDate(0);\n            to.setDate(to.getDate() + span.d[2]);\n            const dist = +to - +from;\n            let d = Math.floor(dist / 86400000);\n            const r = dist % 86400000;\n            if (r >= 82800000) d++;\n            res = [d];\n          } else {\n            // this is an approximation\n            res[0] += span.d[0] * 365;\n            res[0] += span.d[1] * 30;\n          }\n        } else if (u.length < 4 && (us === 'y' || us === 'yM' || us === 'yMd' || us === 'M' || us === 'Md' || us === 'd')) {\n          res = u.map(u => {\n            fraction = span.d[spanMap[u][0] + 1] / spanMap[u][1];\n            return span.d[spanMap[u][0]];\n          });\n          if (u[0] === 'M') res[0] += span.d[0] * 12;\n        }\n      }\n\n      // this isn't special cased, so get a number of ms\n      if (!res) {\n        let ms = typeof span === 'number' || isTimespanMS(span) ? timeSpanToNumber(span) : span && 's' in span ? +dateAndTimespan(new Date(span.s), span, 1) - +new Date(span.s) : (\n          span.d[0] * timespans.y + span.d[1] * timespans.m + span.d[2] * timespans.d +\n          span.d[3] * timespans.h + span.d[4] * timespans.mm + span.d[5] * timespans.s + span.d[6]\n        );\n        res = u.map(() => 0);\n\n        const next = { y: 'm', M: 'w', w: 'd', d: 'h', h: 'mm', m: 's' };\n        const nextDiv = { y: 12, M: 4.3, w: 7, d: 24, h: 60, m: 60 };\n\n        for (let i = 0; i < res.length; i++) {\n          const k = u[i] === 'm' ? 'mm' : u[i] === 'M' ? 'm' : u[i];\n          if (k === 'l') {\n            res[i] = ms;\n            fraction = 0;\n            break;\n          }\n          res[i] = Math.floor(ms / timespans[k]);\n          ms -= res[i] * timespans[k];\n          if (next[u[i]]) fraction = (ms / timespans[next[u[i]]]) / nextDiv[u[i]];\n          else if (u[i] === 's') fraction = ms % 1000;\n        }\n      }\n\n      // check for rounding\n      if (namedArgs.round === true) {\n        if (fraction >= 0.5) res[res.length - 1]++;\n      } else if ((namedArgs.round || '')[0] === 'c') {\n        if (fraction > 0) res[res.length - 1]++;\n        // very special case for months that get rounded to a year\n        if (u[0] === 'y' && u[1] === 'M' && u.length === 2 && res[1] === 12) {\n          res[0]++;\n          res[1] = 0;\n        }\n      }\n\n      // check to see if stringification is needed\n      if (namedArgs.string) {\n        const units = { y: 'year', M: 'month', w: 'week', d: 'day', h: 'hour', m: 'minute', s: 'second', l: 'millisecond' };\n        let str = '';\n        for (let i = 0; i < u.length; i++) {\n          if (!res[i]) continue;\n          str += `${str.length ? ' ' : ''}${res[i]} ${units[u[i]]}${res[i] > 1 ? 's' : ''}`;\n        }\n        return str;\n      } else return Array.isArray(namedArgs.unit) ? res : res[0];\n    } else {\n      if (namedArgs.string) {\n        if (typeof span === 'number' || isTimespanMS(span)) {\n          let ms = timeSpanToNumber(span);\n          let res = '';\n          const order = ['w', 'd', 'h', 'mm', 's'];\n          const units = ['week', 'day', 'hour', 'minute', 'second', 'millisecond'];\n          for (let i = 0; i < order.length; i++) {\n            if (ms > timespans[order[i]]) {\n              const u = Math.floor(ms / timespans[order[i]]);\n              ms -= timespans[order[i]] * u;\n              res += `${res.length ? ' ' : ''}${u} ${units[i]}${u > 1 ? 's' : ''}`;\n            }\n          }\n          if (ms) {\n            res += `${res.length ? ' ' : ''}${ms} millisecond${ms > 1 ? 's' : ''}`;\n          }\n        } else {\n          let res = '';\n          const units = ['year', 'month', 'day', 'hour', 'minute', 'second', 'millisecond'];\n          for (let i = 0; i < span.d.length; i++) {\n            if (span.d[i]) res += `${res.length ? ' ' : ''}${span.d[i]} ${units[i]}${span.d[i] > 1 ? 's' : ''}`;\n          }\n          return res;\n        }\n      } else return span;\n    }\n  }),\n  simple(['string', 'unparse'], (name: string, args: any[], opts: any): string => {\n    const [value] = args;\n    opts = opts || args[1] || {};\n    if (!opts || typeof opts !== 'object') opts = {};\n    if (name === 'unparse') opts = Object.assign({}, opts, { raport: 1 });\n    if (opts.raport && opts.tpl) opts.template = 1;\n    if (!opts && (value === null || value === undefined)) return '';\n\n    if (typeof opts === 'object') {\n      if (opts.json) return JSON.stringify(value);\n      if (opts.schema) return unparseSchema(value);\n      if (opts.base64) return btoa(value);\n      else if (opts.raport) {\n        let v = stringify(value, opts);\n        if (v === undefined) v = stringify({ v: value }, opts);\n        return v;\n      } else if (typeof value === 'string' && opts.styled) return style(value);\n      else if (value == null) return '';\n    }\n\n    if (Array.isArray(value)) return value.join(', ');\n\n    let res = `${value}`;\n    if (res.slice(0, 7) === '[object') return JSON.stringify(value);\n    return res;\n  }),\n  simple(['log'], (_name: string, args: any[], _opts, ctx: Context) => {\n    try {\n      ctx.root.log(args);\n    } catch (e) {\n      console.error(e);\n      console.log(...args);\n    }\n  }),\n  simple(['call'], (_name: string, args: any[], _opts, ctx: Context): any => {\n    if (args[0] != null && typeof args[1] === 'string' && typeof args[0][args[1]] === 'function') {\n      const obj = args.shift();\n      const name = args.shift();\n      return obj[name].apply(obj, args);\n    }\n\n    if (typeof args[0] === 'function') {\n      const fn = args.shift();\n      return fn.apply(null, args);\n    }\n\n    if (isValue(args[0])) {\n      return evalApply(ctx, args[0], args.slice(1));\n    }\n  }),\n  simple(['intersect'], (_name, [left, right]: any[]): any => {\n    if (!Array.isArray(left) || !Array.isArray(right)) return [];\n    const res = [];\n    let el: any;\n    for (let i = 0; i < left.length; i++) {\n      el = left[i];\n      if (~right.indexOf(el) && !~res.indexOf(el)) res.push(el);\n    }\n    for (let i = 0; i < right.length; i++) {\n      el = right[i];\n      if (!~res.indexOf(el) && ~left.indexOf(el)) res.push(el);\n    }\n    return res;\n  }),\n  simple(['let'], (_name, [name, value]: any[], _opts, ctx: Context): any => {\n    return safeSet(ctx, name, value, true);\n  }),\n  simple(['set'], (_name, [name, value]: any[], _opts, ctx: Context): any => {\n    return safeSet(ctx, name, value);\n  }),\n  simple(['similarity'], (_name, [left, right, threshhold, fudges]: any[]): number => {\n    return similarity(`${left || ''}`, `${right || ''}`, threshhold, fudges);\n  }),\n  simple(['similar'], (_name, [left, right, threshhold, fudges]: any[]): any => {\n    return similar(`${left || ''}`, `${right || ''}`, threshhold, fudges);\n  }),\n  simple(['overlap'], (_name, [left, right, threshhold]: any[]): any => {\n    return overlap(`${left || ''}`, `${right || ''}`, threshhold);\n  }),\n  simple(['validate', 'valid'], (name, [left, right, mode], opts) => {\n    const res = validate(left, right, mode || opts?.mode || (opts?.strict && 'strict'));\n    if (name === 'valid') return res === true;\n    else return res;\n  }),\n  simple(['inspect'], (_name, [v, mode], opts) => {\n    if ((mode || opts?.mode) === 'schema') return unparseSchema(inspect(v, opts?.flat));\n    else return inspect(v);\n  }),\n  simple(['diff'], (_, [left, right, equal], opts, ctx: Context) => {\n    equal = equal || opts?.equal;\n    if (equal && isApplication(equal)) {\n      const eq = equal;\n      equal = (l: any, r: any) => evalApply(ctx, eq, [l, r]);\n    }\n    return diff(left, right, { equal, keys: opts?.keys });\n  }),\n  simple(['label-diff'], (_, [diff, label], opts) => {\n    return labelDiff(diff, label, opts as any);\n  }),\n  simple(['patch'], (_, values, opts) => {\n    const dir = opts?.dir || 'forward';\n    const strict = opts?.strict;\n    const base = JSON.parse(JSON.stringify(values.shift() || {}));\n    const r = new Root(base);\n    if (dir === 'backward') {\n      const vals = values.slice().reverse();\n      if (strict) {\n        for (const v of vals) for (const path in v) if (safeGet(r, path) == v[path][1]) safeSet(r, path, v[path][0]);\n      } else {\n        for (const v of vals) for (const path in v) safeSet(r, path, v[path][0]);\n      }\n    } else {\n      if (strict) {\n        for (const v of values) for (const path in v) if (safeGet(r, path) == v[path][0]) safeSet(r, path, v[path][1]);\n      } else {\n        for (const v of values) for (const path in v) safeSet(r, path, v[path][1]);\n      }\n    }\n    return base;\n  }),\n);\n\n// math\nregisterOperator(\n  simple(['+', 'add'], (_name, values: any[], _opts, ctx): any => {\n    if (values.length === 1) {\n      if (isDateRel(values[0])) return +dateRelToDate(values[0]);\n      else if (!values[0]) return 0;\n      return parseFloat(values[0]);\n    }\n    if (Array.isArray(values[0])) return values[0].concat.apply(values[0], values.slice(1));\n    else if (isDateRel(values[0]) && values.length > 1 && values.slice(1).reduce((a, c) => a && isTimespan(c), true)) return values.slice(1).reduce((a, c) => dateAndTimespan(a, c, 1), dateRelToDate(values[0])); \n    else if (typeof values[0] !== 'number' && values.length > 1 && isTimespan(values[0])) return values.slice(1).reduce((a, c) => addTimespan(a, c), values[0]);\n    else if (values.reduce((a, c) => a && typeof c === 'object' && !isDateRel(c), true)) return Object.assign.apply(Object, [{}].concat(values));\n    const num = values.reduce((a, c) => a && isNum(c), true);\n    if (num) {\n      if (ctx.special?.round) return +values.reduce((a, c) => +round(a + +c, ctx.special.round), 0);\n      else return values.reduce((a, c) => a + +c, 0);\n    } else {\n      return values.reduce((a, c) => a + (c === undefined || c === null ? '' : c), '');\n    }\n  }),\n  simple(['cat'], (_name, values: any[]): any => {\n    return values.reduce((a, c) => a + (c === undefined || c === null ? '' : c), '');\n  }),\n  simple(['num'], (_name: string, [v]) => {\n    let match: string[];\n    if (match = hasNum.exec(v)) return +match[1];\n    return parseInt(v);\n  }),\n  simple(['-', 'subtract'], (_name, values: any[], _opts, ctx): number => {\n    const first = values.shift();\n    if (!values.length) return -first;\n    if (isDateRel(first)) {\n      if (values.reduce((a, c) => a && isDateRel(c), true)) return values.reduce((a, c) => a - +dateRelToDate(c), +dateRelToDate(first));\n      if (values.reduce((a, c) => a && isTimespan(c), true)) return values.reduce((a, c) => dateAndTimespan(a, c, -1), dateRelToDate(first));\n    }\n    if (ctx.special?.round) return values.reduce((a, c) => +round(a - (!isNum(c) ? 0 : +c), ctx.special.round), !isNum(first) ? 0 : +first);\n    else return values.reduce((a, c) => a - (!isNum(c) ? 0 : +c), !isNum(first) ? 0 : +first);\n  }),\n  simple(['*', 'multiply'], (_name, values: any[], _opts, ctx): number|string|any[] => {\n    const first = values.shift();\n    if (!isNum(first)) {\n      if (values.length === 1 && isNum(values[0]) && +values[0] > 0) {\n        if (typeof first === 'string') {\n          return stringTimes(first, +values[0]);\n        } else if (Array.isArray(first) && +values[0] < 10000 && first.length < 1000) {\n          const res = [];\n          for (let i = 0; i < values[0]; i++) res.push.apply(res, first);\n          return res;\n        }\n      }\n      return 0;\n    }\n    if (ctx.special.round) return values.reduce((a, c) => +round(a * (!isNum(c) ? 0 : +c), ctx.special.round), +first);\n    else return values.reduce((a, c) => a * (!isNum(c) ? 0 : +c), +first);\n  }),\n  simple(['/', '/%', 'divide', 'intdiv'], (name: string, values: any[], _opts, ctx): number => {\n    const first = values.shift();\n    if (isNaN(first)) return 0;\n    if (name.length > 1 || name === 'intdiv') return values.reduce((a, c) => Math.floor(a / (isNaN(c) ? 1 : +c)), +first);\n    if (ctx.special?.round) return values.reduce((a, c) => +round(a / (isNaN(c) ? 1 : +c), ctx.special.round), +first);\n    else return values.reduce((a, c) => a / (isNaN(c) ? 1 : +c), +first);\n  }),\n  simple(['%', 'modulus'], (_name: string, values: any[]): number => {\n    const first = values.shift();\n    return values.reduce((a, c) => a % (isNaN(c) ? 1 : +c), isNaN(first) ? 0 : +first);\n  }),\n  simple(['pow', '**'], (_name, values: any[], _opts, ctx): number => {\n    const pow = values.pop();\n    const first = Math.pow(values.pop(), pow);\n    if (ctx.special?.round) return values.reverse().reduce((a, c) => +round(Math.pow(c, a), ctx.special.round), first);\n    else return values.reverse().reduce((a, c) => Math.pow(c, a), first);\n  }),\n  simple(['abs'], (_name: string, values: any[]) => {\n    if (typeof values[0] !== 'number') return values[0];\n    return Math.abs(values[0]);\n  }),\n  simple(['round'], (_name: string, [num, precision, method]: [number, number, string], opts): number|string => {\n    precision = precision ?? opts?.places;\n    if (precision !== undefined || roundDefaults['all-numeric']) {\n      const res = round(num, { places: precision, method: (method || opts?.method) as any });\n      if (opts?.string) return res;\n      return +res;\n    } else return Math.round(num);\n  }),\n  simple(['floor'], (_name: string, values: [number]): number => {\n    return Math.floor(values[0]);\n  }),\n  simple(['ceil'], (_name: string, values: [number]): number => {\n    return Math.ceil(values[0]);\n  }),\n  simple(['rand', 'random'], (_name: string, args: any[]): any => {\n    if (!args.length || typeof args[0] === 'number') {\n      const [min, max, dec] = args;\n      let res: number;\n      if (min == null) return Math.random();\n      else if (typeof max !== 'number') res = Math.random() * min;\n      else if (typeof max === 'number') res = Math.random() * (max - min) + min;\n\n      if (max === true || dec === true) return res;\n      else return Math.round(res);\n    } else if (Array.isArray(args[0])) {\n      const arr = args[0];\n      return arr[Math.floor(Math.random() * arr.length)];\n    } else if (typeof args[0] === 'string' && typeof args[1] === 'number') {\n      let res = '';\n      const [str, count] = args;\n      for (let i = 0; i < count; i++) res += str[Math.floor(Math.random() * str.length)];\n      return res;\n    } \n  }),\n);\n\n// string\nfunction pad(where: 'l'|'c'|'r', str: string, count: number, pad: string): string {\n  if (typeof str !== 'string') str = '' + str;\n  if (!isNum(count)) return str;\n  if (typeof pad !== 'string') pad = '' + pad;\n  if (!pad) pad = ' ';\n  if (pad.length !== 1) pad = ' ';\n\n  const ct = (count - str.length) / 2;\n  for (let i = 0; str.length < count; i++) {\n    if (where === 'l') str = pad + str;\n    else if (where === 'r') str = str + pad;\n    else if (i < ct) str = pad + str;\n    else str = str + pad;\n  }\n\n  return str;\n}\nconst triml = /^\\s*/;\nconst trimr = /\\s*$/;\nconst escapeRe = /([\\.\\[\\]\\{\\}\\(\\)\\^\\$\\*\\+\\-])/g;\nregisterOperator(\n  simple(['eval'], (_name: string, [v], opts, ctx: Context): any => {\n    if (opts?.template) return template(opts?.context || ctx, v);\n    else return evaluate(opts?.context || ctx, v);\n  }),\n  simple(['padl', 'padr', 'pad'], (name: string, args: any[]): string => {\n    let [str, count, val] = args;\n    return pad(name === 'padl' ? 'l' : name === 'padr' ? 'r' : 'c', str, count, val);\n  }),\n  simple(['trim', 'triml', 'trimr'], (name: string, args: any[]): string => {\n    let [str] = args;\n    str = '' + str;\n    if (name === 'trim' || name === 'trimr') str = str.replace(trimr, '');\n    if (name === 'trim' || name === 'triml') str = str.replace(triml, '');\n    return str;\n  }),\n  simple(['slice', 'substr'], (_name: string, [src, start, end]: any[], _opts, ctx: Context) => {\n    if (src && typeof src.slice === 'function') return src.slice(start, end);\n    else {\n      const op = getOperator<ValueOperator>('string');\n      if (op) return `${op.apply('string', [src], undefined, ctx)}`.slice(start, end);\n    }\n  }),\n  simple(['len', 'length'], (_name: string, [src]: any[]) => {\n    if (typeof src === 'string' || Array.isArray(src)) return src.length;\n    else if (typeof src === 'object' && Object.keys(src).length === 1 && Array.isArray(src.value)) return src.value.length;\n    else if (typeof src === 'object') return Object.keys(src).length;\n    return 0;\n  }),\n  simple(['replace', 'replace-all'], (name: string, [str, find, rep, flags]: any[]) => {\n    str = `${str}`;\n    const re = typeof flags === 'string';\n    if (name === 'replace-all' || re) {\n      return str.replace(new RegExp(re ? find : find.replace(escapeRe, '\\\\$1'), (name === 'replace' || (flags && ~flags.indexOf('g')) ? flags : `${flags || ''}g`) || 'g'), rep);\n    } else {\n      return str.replace(find, rep);\n    }\n  }),\n  simple(['reverse'], (_name: string, [src]): string|any[] => {\n    if (typeof src === 'string') {\n      let r = '';\n      for (let i = 0; i < src.length; i++) r = src[i] + r;\n      return r;\n    } else if (Array.isArray(src)) {\n      return src.slice().reverse();\n    }\n  }),\n  simple(['wrap-count'], (_name: string, [str, width, font], opts, ctx): number => {\n    let w = width || opts?.width;\n    const avail = safeGet(ctx, '@placement.availableX') || 48;\n    if (ctx.special?.widget) {\n      const ww = ctx.special.widget.width;\n      if (ww) {\n        if (ww === 'grow') w = avail;\n        else if (typeof ww === 'number') w = ww;\n        else if (typeof ww === 'object' && typeof ww.percent === 'number') w = (ww.percent / 100) * avail; \n        else if (typeof ww === 'object' && typeof ww.x === 'string') w = evaluate(ctx, ww.x);\n      }\n    }\n    if (!w) w = avail;\n    font = font || opts?.font || safeGet(ctx, '@widget.font');\n    if (opts) {\n      font = Object.assign({}, font);\n      for (const k of ['family', 'size', 'line', 'metric', 'break-word']) if (k in opts) font[k] = opts[k];\n    }\n    return measure(str, w, { context: ctx } as any, font);\n  }),\n  simple(['keys'], (_name: string, [src, proto]): string[] => {\n    if (!src) return [];\n    if (proto) {\n      const res: string[] = [];\n      for (const k in src) res.push(k);\n      return res;\n    } else {\n      return Object.keys(src);\n    }\n  }),\n  simple(['values'], (_name: string, [src]): any[] => {\n    if (!src) return [];\n    return Object.values(src);\n  }),\n  simple(['date'], (_name: string, args: any[], opts, ctx: Context): Date|DateRel => {\n    let [v, t] = args;\n    if (typeof opts !== 'object' || !opts) opts = {} as any;\n\n    let res: Date|DateRel;\n    if (v !== undefined) {\n      if (isDateRel(v)) res = dateRelToDate(v);\n      else if (typeof v === 'string') {\n        let dt = parseDate(v);\n        if (isDateRel(dt)) {\n          res = dt;\n        } else {\n          if (!dt) dt = new Date(v);\n          if (isNaN(dt as any)) {\n            let val = evaluate(ctx, ~v.indexOf('#') ? v : `#${v}#`);\n            if (isDateRel(val)) {\n              if (opts.rel || opts.parse) res = val;\n              else res = dateRelToDate(val);\n            }\n          }\n        }\n      }\n      if (!res) res = new Date(v);\n    }\n    else res = new Date();\n\n\n    if ((opts.rel || opts.parse) && isDateRel(res)) {\n      let rel = dateRelToExactRange(res);\n      if (typeof t === 'string') t = parseTime(t);\n\n      if (Array.isArray(t)) {\n        const f = rel.f;\n        f[3] = t[0], f[4] = t[1], f[5] = t[2], f[6] = t[3];\n        t = t[4];\n      }\n\n      if (typeof t === 'number') {\n        if (opts.shift) {\n          const diff = (+rel.f[7] || 0) - t;\n          const dt = dateRelToDate(rel);\n          dt.setMinutes(dt.getMinutes() - diff);\n          rel = dateRelToExactRange(dt);\n        }\n\n        rel.f[7] = t;\n        res = rel;\n      }\n    } else {\n      const rdt = isDateRel(res) ? dateRelToDate(res) : res as Date;\n      if ('y' in opts && !isNaN(opts.y)) rdt.setFullYear(opts.y);\n      const y = rdt.getFullYear();\n      if ('m' in opts && !isNaN(opts.m)) {\n        rdt.setMonth(+opts.m - 1);\n        if (opts.clamp && rdt.getFullYear() !== y) {\n          rdt.setFullYear(y);\n          rdt.setMonth(11);\n        }\n      }\n      const m = rdt.getMonth();\n      if ('d' in opts && !isNaN(opts.d)) {\n        rdt.setDate(opts.d);\n        if (opts.clamp && (rdt.getMonth() !== m || rdt.getFullYear() !== y)) {\n          rdt.setDate(1);\n          rdt.setFullYear(y);\n          rdt.setMonth(m + 1);\n          rdt.setDate(0);\n        }\n      }\n\n      if (t) {\n        if (res === v) {\n          if (typeof v === 'string') {\n            const dt = parseDate(v);\n            if (dt && isDateRel(dt)) res = dateRelToDate(dt);\n            else res = new Date(v);\n          } else res = new Date(v);\n        }\n\n        if (typeof t === 'string') t = parseTime(t);\n        if (Array.isArray(t)) {\n          rdt.setHours(t[0] || 0, t[1] || 0, t[2] || 0, t[3] || 0);\n          if (t[4] != null) {\n            const offset = -rdt.getTimezoneOffset() - t[4];\n            rdt.setMinutes(rdt.getMinutes() + offset);\n          }\n        } else if (typeof t === 'number') {\n          const offset = -rdt.getTimezoneOffset() - t;\n          rdt.setMinutes(rdt.getMinutes() + offset);\n        }\n      }\n\n      res = rdt;\n    }\n\n    if (res instanceof Date && isNaN(+res)) return undefined;\n    return res;\n  }),\n  simple(['interval'], (_name: string, [v]: any[], _opts, ctx: Context): DateRel => {\n    return evaluate(ctx, ~v.indexOf('#') ? v : `#${v}#`);\n  }),\n  simple(['upper', 'lower'], (name: string, [v]: any[]): string => {\n    v = v == null ? '' : v;\n    return name === 'upper' ? `${v}`.toUpperCase() : `${v}`.toLowerCase();\n  }),\n  simple(['format', 'fmt'], (_name: string, args: any[], opts, ctx): string => {\n    let [v, fmt, ...s] = args;\n    const op = formats[fmt];\n    if (!op) {\n      let op: any = getOperator(fmt);\n      if (!op) {\n        const o = safeGet(ctx, fmt) || safeGet(ctx.root, fmt);\n        if (isApplication(o)) op = o\n      }\n      if (op) {\n        const args = [v, ...s];\n        return applyOperator(ctx, { op: fmt, args: args.map(v => isApplication(v) ? v : ({ v })), opts: { v: opts || virtualFormats[fmt] } });\n      } else return `${v}`;\n    } else return op.apply(v, s, (opts || op.defaults) as any);\n  }),\n  simple(['set-defaults'], (_name: string, [type, name]: any[], opts, ctx) => {\n    if (type === 'format' && typeof name === 'string') {\n      const fmt = formats[name];\n      if (fmt) return Object.assign(fmt.defaults, opts);\n      const vfmt = virtualFormats[name];\n      if (vfmt) return Object.assign(vfmt.defaults, opts);\n    } else if (type === 'round') {\n      if (opts?.context) {\n        if (opts?.unset) {\n          if (ctx.special) delete ctx.special.round;\n        } else (ctx.special || (ctx.special = {})).round = Object.assign({}, opts, { context: undefined });\n      } else Object.assign(roundDefaults, opts);\n    } else if (type === 'generate') {\n      Object.assign(generateDefaults, opts);\n    }\n  }),\n  simple(['parse'], (_name: string, args: any[], opts: any): any => {\n    opts = opts || args[1] || {};\n    if (!opts || typeof opts !== 'object') opts = {};\n    const [v] = args;\n\n    if (opts.date) return parseDate(v, opts);\n    else if (opts.template || opts.tpl) return parseTemplate(v, opts);\n    else if (opts.time) return parseTime(v, opts);\n    else if (opts.expr) return parseExpr(v, opts);\n    else if (opts.json) return JSON.parse(v);\n    else if (opts.schema) return parseSchema(v);\n    else if (opts.range) return parseRange(v, opts);\n    else if (opts.xml) return parseXML(v, opts.strict);\n    else if (opts.csv || opts.delimited) {\n      if (opts.detect || (!opts.field && !opts.separator && !opts.record && !opts.quote)) opts = Object.assign(csvDetect(v, opts.context), opts);\n      return csvParse(v, opts);\n    } else if (opts.base64) return atob(v);\n    else return parse(v, opts);\n  }),\n  simple(['detect-delimiters'], (_name: string, [data, max]: any[], opts) => {\n    if (typeof data !== 'string') return {};\n    return csvDetect(data, max ?? opts?.context);\n  }),\n);\n\n// short circuiting\nregisterOperator({\n  type: 'checked',\n  names: ['and', '&&'],\n  checkArg(_name: string, _i: number, _total: number, value: any): CheckResult {\n    if (value) return 'continue';\n    else return { result: value };\n  },\n  apply(_name: string, args: any[]): boolean {\n    return args[args.length - 1]; // passed the check, all is well\n  },\n}, {\n  type: 'checked',\n  names: ['or', '||', '??'],\n  checkArg(name: string, _i: number, _total: number, value: any): CheckResult {\n    if (name === '??' ? value != null : value) return { result: value };\n    else return 'continue';\n  },\n  apply(name: string): boolean {\n    return name === '??' ? undefined : false; // if we made it this far, none were true\n  },\n}, {\n  type: 'checked',\n  names: ['if', 'unless'],\n  checkArg(name: string, i: number, last: number, value: any): CheckResult {\n    if (i % 2 === 0) {\n      if (i === last) return { result: value }; // else case\n      else if (name === 'if' ? !value : value) return { skip: 1 }; // non-matching branch, skip next\n      else return 'continue'; // matching, carry on to next\n    }\n    else return { result: value }; // odd branch that wasn't skipped means previous condition matched\n  },\n  apply() {}\n}, {\n  type: 'checked',\n  names: ['case', 'switch'],\n  checkArg(_name: string, i: number, last: number, value: any, _opts, ctx: Context, ast): CheckResult {\n    if (i === 0) { // set the value and move to the next\n      (ctx.special || (ctx.special = {})).case = value;\n      return 'continue';\n    } else if (i % 2 === 1) {\n      if (i === last) return { result: value }; // default case\n      if (equals(value, ctx.special.case)) return 'continue';\n      if (isValue(ast) && 'op' in ast && value === true) return 'continue'; // operators can also check for true\n      if (isValue(value)) {\n        const v = evalValue(ctx, value);\n        if (equals(v, ctx.special.case)) return 'continue';\n        if (v === true) return 'continue';\n      }\n      return { skip: 1 };\n    } else return { result: value }; // odd branch\n  },\n  apply() {},\n  extend: true,\n}, {\n  type: 'checked',\n  names: ['each'],\n  checkArg(_name: string, i: number, last: number, value: any): CheckResult {\n    if (i === 0) {\n      if (Array.isArray(value) && value.length || value && typeof value === 'object' && Object.keys(value).length) return 'continue';\n      else return { skip: 1 };\n    } else if (i === 1) return { skip: last - i, value };\n    else if (i === last) return { result: value };\n    else if (i % 2 === 0) { // condition\n      if (value) return 'continue';\n      else return { skip: 1 };\n    } else return { result: value };\n  },\n  apply(_name: string, [value, body]: [any[]|object, ValueOrExpr], opts, ctx: Context) {\n    if (Array.isArray(value)) {\n      const last = value.length - 1;\n      return value.map((v, i) => evalApply(ctx, body, [v, i], { last, index: i, key: i, 'last-key': last })).join(opts?.join || '');\n    } else if (typeof value === 'object' && value) {\n      const entries = Object.entries(value);\n      const lastKey = entries[entries.length - 1][0];\n      const last = entries.length - 1;\n      return Object.entries(value).map(([k, v], i) => evalApply(ctx, body, [v, k], { last, 'last-key': lastKey, index: i, key: k })).join('');\n    } else {\n      return '';\n    }\n  }\n}, {\n  type: 'checked',\n  names: ['with'],\n  checkArg(_name: string, i: number, last: number, value: any): CheckResult {\n    if (i === 0 && value && typeof value === 'object') return 'continue';\n    else if (i === 1) return { skip: last - i, value };\n    else if (i === last) return { result: value };\n    else if (i % 2 === 0) {\n      if (value) return 'continue';\n      else return { skip: 1 };\n    } else return { result: value };\n  },\n  apply(_name: string, [value, body]: [any, ValueOrExpr], _opts, ctx: Context) {\n    return evalApply(ctx, body, [value]);\n  }\n}, {\n  type: 'checked',\n  names: ['coalesce', 'coalesce-truth'],\n  checkArg(name: string, _i: number, _last: number, value: any): CheckResult {\n    if (name === 'coalesce' && value !== undefined && value !== null) return { result: value };\n    else if (value) return { result: value };\n    else return 'continue';\n  },\n  apply() {}\n});\n\n// aggregates\nregisterOperator({\n  type: 'aggregate',\n  names: ['avg'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (ctx.special?.round) return +round(arr.reduce((a, c) => +round(a + num(args[0] ? evalApply(ctx, args[0], [c]) : c)), 0) / arr.length)\n    else return arr.reduce((a, c) => a + num(args[0] ? evalApply(ctx, args[0], [c]) : c), 0) / arr.length;\n  },\n}, {\n  type: 'aggregate',\n  names: ['sum'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (ctx.special?.round) return arr.reduce((a, c) => +round(a + num(args[0] ? evalApply(ctx, args[0], [c]) : c)), 0);\n    else return arr.reduce((a, c) => a + num(args[0] ? evalApply(ctx, args[0], [c]) : c), 0);\n  }\n}, {\n  type: 'aggregate',\n  names: ['count'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (opts?.partition && isApplication(opts.partition)) {\n      return arr.reduce((a, e, i) => {\n        const key = evalApply(ctx, opts.partition, [e, i]);\n        if (key in a) a[key]++;\n        else a[key] = 1;\n        return a;\n      }, {});\n    } else if (opts?.sub && typeof opts.sub === 'object' && !Object.values(opts.sub).find(o => !isApplication(o))) {\n      return arr.reduce((a, e, i) => {\n        for (const k in opts.sub) {\n          let res = evalApply(ctx, opts.sub[k], [e, i]);\n          if (!res) continue;\n          if (typeof res === 'string') res = [res];\n          else if (!Array.isArray(res)) res = [k];\n          for (const k of res) {\n            if (k in a) a[k]++;\n            else a[k] = 1;\n          }\n        }\n        return a;\n      }, {});\n    } else if (args.length) return arr.filter((e, i) => evalApply(ctx, args[0], [e, i])).length;\n    else return arr.length;\n  }\n}, {\n  type: 'aggregate',\n  names: ['min', 'max'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (isApplication(args[0])) arr = arr.map(e => evalApply(ctx, args[0], [e]));\n    else if (args.length && !arr.length) arr = args.map(a => evalParse(ctx, a));\n    if (!arr.length) return 0;\n    return Math[name].apply(Math, arr.filter(e => !isNaN(e)));\n  }\n}, {\n  type: 'aggregate',\n  names: ['first', 'nth', 'last'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    let val: any;\n    let apply = 0;\n    if (name === 'first') val = arr[0];\n    else if (name === 'last') val = arr[arr.length - 1];\n    else if (args[0]) {\n      const i = evalParse(ctx, args[0]);\n      if (typeof i === 'number') {\n        val = i < 0 ? arr[arr.length + i] : arr[i - 1];\n        apply = 1;\n      }\n    }\n    if (args[apply]) val = evalParse(ctx, args[apply]);\n    return val;\n  }\n}, {\n  type: 'aggregate',\n  names: ['map'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (!args[0]) return arr;\n    let v: any[];\n    let app: any;\n    if (isApplication(args[0])) v = arr, app = evalParse(ctx, args[0]);\n    else if (isApplication(args[1])) v = evalParse(ctx, args[0]), app = evalParse(ctx, args[1]);\n    if ((Array.isArray(v) || v && '0' in v) && isApplication(app)) {\n      const res = Array.prototype.map.call(v, (e: any, i: number) => evalApply(ctx, app, [e, i], { index: i, key: i }));\n      if (opts && opts.flat) return flatten(res, opts.flat);\n      return res;\n    }\n    else if (v && typeof v === 'object' && isApplication(app)) {\n      if (opts && opts.array) {\n        const res = Object.entries(v as object).map((p, i) => evalApply(ctx, app, [p[1], i, p[0]], { index: i, key: p[0] }));\n        if (opts && opts.flat) return flatten(res, opts.flat);\n        return res;\n      }\n      if (opts && opts.entries) return Object.entries(v as object).reduce((a, p, i) => {\n        const r = evalApply(ctx, app, [p[1], i, p[0]], { index: i, key: p[0] });\n        if (r === null) return a;\n        if (Array.isArray(r) && r.length === 2 && typeof r[0] === 'string') a.push(r);\n        else a.push([p[0], r]);\n        return a;\n      }, [] as any[]);\n      const res: any = {};\n      Object.entries(v as object).forEach((e, i) => {\n        const r = evalApply(ctx, app, [e[1], i, e[0]], { index: i, key: e[0] });\n        if (Array.isArray(r) && r.length === 2 && typeof r[0] === 'string') res[r[0]] = r[1];\n        else if (r == null) return;\n        else res[e[0]] = r;\n      });\n      return res;\n    }\n  }\n}, {\n  type: 'aggregate',\n  names: ['index'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (!args[0]) return {};\n    const many = opts && opts.many;\n    return arr.reduce((a, c, i) => _indexPair(a, evalApply(ctx, args[0], [c, i], { index: i, all: a }), c, many), {});\n  },\n}, {\n  type: 'aggregate',\n  names: ['reduce'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (!args[0]) return arr;\n    return arr.reduce((a, c, i) => evalApply(ctx, args[0], [a, c, i]), evalParse(ctx, args[1]));\n  }\n}, {\n  type: 'aggregate',\n  names: ['unique', 'unique-map'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    const seen = [];\n    const res = [];\n    for (const e of arr) {\n      const f = args[0] ? evalApply(ctx, args[0], [e]) : e;\n      if (!~seen.indexOf(f)) {\n        seen.push(f);\n        res.push(e);\n      }\n    }\n    return name === 'unique' ? res : seen;\n  }\n}, {\n  type: 'aggregate',\n  names: ['join'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (isApplication(args[0])) {\n      arr = arr.map(e => evalApply(ctx, args[0], [e]));\n      args = args.slice(1);\n    }\n    if (args.length > 1 && arr.length > 2) return [arr.slice(0, -1).join(evalParse(ctx, args[0])), arr[arr.length - 1]].join(evalParse(ctx, args[1]));\n    else if (args.length > 2 && arr.length === 2) return arr.join(evalParse(ctx, args[2]));\n    return arr.join(evalParse(ctx, args[0]));\n  }\n}, {\n  type: 'aggregate',\n  names: ['find'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (!args[0]) return;\n    else if (isApplication(args[0])) return arr.find((e, i) => evalApply(ctx, args[0], [e, i], { index: i, key: i }));\n    else if (isApplication(args[1])) {\n      const v = evalParse(ctx, args[0]);\n      if (Array.isArray(v)) return v.find((e, i) => evalApply(ctx, args[1], [e, i], { index: i, key: i }));\n      else if (typeof v === 'object' && v) {\n        const e = Object.entries(v).find((e, i) => evalApply(ctx, args[1], [e[1], i, e[0]], { index: i, key: e[0] }));\n        if (e) return e[1];\n      }\n    } else {\n      const v = evalParse(ctx, args[0]);\n      return arr.find(e => e == v);\n    }\n  }\n}, {\n  type: 'aggregate',\n  names: ['flatten'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx) {\n    return flatten(arr, (args.length > 0 ? evalParse(ctx, args[0]) : 0) || opts?.flat);\n  }\n}, {\n  type: 'aggregate',\n  names: ['block'],\n  apply(_name: string, _arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    const last = args.length - 1;\n    if (last < 0) return;\n    const c = opts?.implicit ? ctx : extend(ctx, { locals: {}, fork: !ctx.locals });\n    for (let i = 0; i < last; i++) evalParse(c, args[i]);\n    const res = evalParse(c, args[last]);\n    if (opts && opts.implicit) ctx.locals = c.locals;\n    return res;\n  },\n  value: true,\n});\n\nfunction flatten(n: any[], levels: any = 1): any[] {\n  let res = n || [];\n  const count = typeof levels !== 'number' ? 1 : levels;\n  for (let i = 0; i < count; i++) {\n    if (res.find(v => Array.isArray(v))) res = [].concat(...res);\n    else return res;\n  }\n  return res;\n}\n\nfunction fmtDate(n: any, fmt: string): string {\n  if (typeof n === 'string') {\n    const d = parseDate(n);\n    if (d) n = d;\n  }\n  return date(isDateRel(n) ? dateRelToExactRange(n) : n, fmt);\n}\n\nfunction _parseRange(ctx: Context, range: string) {\n  const map = (ctx.root as any)._ranges || ((ctx.root as any)._ranges = {})\n  if (range in map) return map[range];\n  return (map[range] = parseRange(range));\n}\n\nfunction _indexPair(res: any, value: any, current: any, many: boolean): any {\n  if (Array.isArray(value)) {\n    if (value.length === 0) return res;\n    else if (value.length === 2) {\n      const [k, v] = value;\n      if (Array.isArray(k)) {\n        for (const kk of k) {\n          if (many) {\n            if (kk in res) res[kk].push(v)\n            else res[kk] = [v];\n          } else res[kk] = v;\n        }\n      } else {\n        if (many) {\n          if (k in res) res[k].push(v);\n          else res[k] = [v];\n        } else res[k] = v;\n      }\n    }\n  } else if (typeof value === 'object') {\n    const v = value as any;\n    if ('many' in v && Array.isArray(v.many)) for (const i of v.many) _indexPair(res, i, current, many);\n    else if ('key' in v || 'keys' in v) _indexPair(res, [v.key || v.keys, v.value || current], current, many);\n  } else {\n    if (many) {\n      if (value in res) res[value].push(current);\n      else res[value] = [current];\n    } else res[value] = current;\n  }\n  return res;\n}\n\n// basic formats\nregisterFormat('dollar', function(n, [dec, group, sign, neg], opts) {\n  return dollar(n, undefined, dec ?? opts?.dec ?? this.defaults.dec, group ?? opts?.group ?? this.defaults.group, sign ?? opts?.sign ?? this.defaults.sign, neg ?? opts?.neg ?? this.defaults.neg);\n}, { dec: 2, group: ',', sign: '$', neg: 'sign' });\n\nregisterFormat('date', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd' });\n\nregisterFormat('time', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'HH:mm:ss' });\n\nregisterFormat('timestamp', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd HH:mm:ss' });\n\nregisterFormat('timestamptz', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd HH:mm:sszzz' });\n\nregisterFormat('iso8601', n => {\n  return fmtDate(n, 'yyyy-MM-ddTHH:mm:sszzz');\n});\n\nregisterFormat(['integer', 'int'], function(n, [group, neg], opts) {\n  return number(n, 0, group ?? opts?.group ?? this.defaults.group, neg ?? opts?.neg ?? this.defaults.neg);\n}, { group: ',', neg: 'sign' });\n\nregisterFormat(['number', 'num'], function(n, [dec, group, neg], opts) {\n  return number(n, dec ?? opts?.dec ?? this.defaults.dev, group ?? opts?.group ?? this.defaults.group, neg ?? opts?.neg ?? this.defaults.neg);\n}, { dec: 2, group: ',', neg: 'sign' });\n\nregisterFormat('ordinal', function(n, [group], opts) {\n  return ordinal(n, group ?? opts?.group ?? this.defaults.group);\n}, { group: ',' });\n\nregisterFormat('phone', n => {\n  return phone(n);\n});\n\nregisterFormat('styled', n => {\n  return style(n);\n});\n\n{\n  const space = /\\s+/g;\n  const br = /[\\s;,.:\"]\\w/g;\n  const alphaNum = /[^a-zA-Z0-9]+([a-zA-Z0-9])/g;\n  const alphaNumSpace = /[^\\sa-zA-Z0-9]/g;\n  const camelBreak = /([a-z])([A-Z])/g;\n  const spaceChar = /\\s([^\\s])/g;\n  function normalize(s: string) {\n    return s.replace(alphaNum, (_m, c) => c ? ` ${c}` : '').replace(alphaNumSpace, '').replace(camelBreak, (_m, c1, c2) => `${c1} ${c2}`).trim();\n  }\n  registerFormat('case', (n, whiches) => {\n    let str = `${n || ''}`.trim();\n    for (const which of whiches) {\n      if (which === 'upper' || which === 'up') str = str.toUpperCase();\n      else if (which === 'lower' || which === 'down') str = str.toLowerCase();\n      else if (which === 'snake') str = normalize(str).toLowerCase().replace(space, '_');\n      else if (which === 'kebab') str = normalize(str).toLowerCase().replace(space, '-');\n      else if (which === 'pascal') {\n        const s = normalize(str);\n        str = s[0].toUpperCase() + s.toLowerCase().substr(1).replace(spaceChar, (_m, c) => (c || '').toUpperCase());\n      } else if (which === 'camel') {\n        const s = normalize(str);\n        str = s[0].toLowerCase() + s.toLowerCase().substr(1).replace(spaceChar, (_m, c) => (c || '').toUpperCase());\n      } else if (which === 'proper') {\n        if (/[a-z]/.test(str)) str = str.trim().replace(br, m => m.toUpperCase());\n        else str = str.toLowerCase().trim().replace(br, m => m.toUpperCase());\n        str = (str[0] || '').toUpperCase() + str.substr(1);\n      }\n    }\n    return str;\n  });\n}\n\nregisterFormat('hex', val => {\n  if (typeof val === 'number') return val.toString(16);\n  else {\n    const str = `${val}`;\n    const te = new TextEncoder();\n    return Array.from(te.encode(str)).map(c => c.toString(16).padStart(2, '0')).join('');\n  }\n});\n\nregisterFormat('base', (val, [n]) => {\n  try {\n    return val.toString(n);\n  } catch {\n    return val;\n  }\n});\n\nregisterFormat('noxml', val => escapeHTML(`${val}`));\n\nregisterFormat('xml', (val, [n]) => {\n  if (val && typeof val === 'object') return objectToXML(val, n);\n  else return val;\n});\n\nfunction objectToXML(object: object, indent: number|undefined = undefined) {\n  if (Array.isArray(object)) return _objectToXML({ values: { value: object } }, 0, indent);\n  const keys = Object.keys(object);\n  if (keys.length > 1) return _objectToXML({ root: object }, 0, indent);\n  if (keys.length < 1) return '<root />';\n  if (Array.isArray(object[keys[0]])) return _objectToXML({ root: object }, 0, indent);\n  return _objectToXML(object, 0, indent);\n}\n\nfunction _objectToXML(val: any, depth: number, indent: number|undefined, propname: string|undefined = undefined) {\n  if (Array.isArray(val)) {\n    return val.reduce((xml, entry) => {\n      const val = _objectToXML(entry, depth + 1, indent, propname);\n      const tag = val === '' || val === undefined ? `<${propname} />` : `<${propname}>${val}${indent && /\\n/.test(val) ? '\\n' + pad('l', '', depth * indent, ' ') : ''}</${propname}>`;\n      return `${xml}${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}${tag}`;\n    }, '');\n  }\n  if (val && typeof val === 'object') {\n    return Object.entries(val).reduce((xml, [name, value]) => {\n      const val = _objectToXML(value, depth + (Array.isArray(value) ? 0 : 1), indent, name);\n      const tag = val === '' ? `${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}<${name} />` : Array.isArray(value) ? val : `${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}<${name}>${val}${indent && /\\n/.test(val) ? '\\n' + pad('l', '', depth * indent, ' ') : ''}</${name}>`;\n      return `${xml}${tag}`;\n    }, '');\n  }\n  return escapeHTML(val);\n}\n\nregisterFormat('base64', val => {\n  return btoa(`${val}`);\n});\n"],"names":["Fail","detailedFail","_cause","_latestCause","getCause","getCauseCopy","name","suggestCauseName","undefined","slice","fail","pos","message","cause","causes","isNodeName","v","openNode","start","end","children","closeNode","node","parent","res","_compact","result","primary","c","length","push","reduce","last","i","extra","l","apply","getLineNum","input","n","lastIndexOf","getParseError","context","lines","first","t","unshift","substring","markerOffset","indexOf","source","marker","len","column","line","position","marked","join","map","parser","findLatestCause","startSpace","shared","error","mps","oerror","det","detailed","consume","consumeAll","trim","exec","seq","skip","a","d","tree","compact","unwrap","parse","undefinedOnError","ctx","contextLines","err","getLatestCause","latest","throw","ex","Error","Object","assign","uninit","_s","p","lazy","init","s","r","nop","concat","strings","outer","f","max","cs","contains0","contains1","str","x","contains2","contains3","contains4","contains5","contains6","contains7","contains8","contains9","contains10","containsFor","containsBinary","mid","getSearch","sorted","charList","chars","split","sort","seekWhileChar","contains","read","read1","JSON","stringify","count","allowed","search","substr","readTo","stop","skipped","seekUntilChar","read1To","op","resin","j","nlen","istr","copy","toLowerCase","toUpperCase","idx","opt","ps","not","alt","parsers","nm","lps","fails","overrideCauseName","verify","fn","e","cur","rep","empty","rep1","repsep","sep","trail","ps1","ps2","rr","m","rep1sep","bracket","content","right","Array","isArray","ends","ps3","r1","r2","r3","addCause","check","andNot","np","_hex","digits","identStart","hex","escmap","b","underscores","JNum","replace","JStringEscape","disallowed","notchars","JStringUnicode","String","fromCharCode","parseInt","JStringHex","JString","JBool","JNull","JIdentifier","ws","JArray","JObject","JValue","JKeyPair","pairs","pair","timespans","y","w","h","mm","isTimespanMS","ms","timeSpanToNumber","Math","floor","space","endSym","endRef","_comment","comment","prop","rws","skip1","keywords","ident","sexprop","args","array","block","object","value","values","application","inlineTemplate","pathesc","char","pathident","parts","dotpath","part","valueAnchor","anchor","bracketpath","keypath","prefix","k","u","localpath","parsePath","makeParser","parseLetPath","illegalRefs","ref","includes","stringInterp","q","meta","timespan","span","timezone","timeexact","parseTime","tm","z","dateend","daterel","o","tz","val","setIndex","index","dateexact","time","date","typelit","schema","parseDate","string","literal","Date","sexp","opts","bracket_op","binop","if_op","case_op","opName","call_op","operand","fmt","fmt_op","postfix_path","unop","arg","leftassoc","left","binop_e","arg1","more","pop","reverse","rightassoc","binop_md","binop_as","binop_cmp","binop_eq","binop_and","binop_or","replaceCase","found","cond1","block1","elifs","el","cond","val1","hit","miss","case_branch","branches","operation","objectOp","filter","namedArg","names","implicit","plain","obj","letter","setter","parseBlock","parseExpr","namespace","type","conditions","typedef","typedefs","defs","desc","arr","key","required","rest","keys","rests","fields","tuple","types","maybe_union","union_array","list","checks","union","root","txtEsc","text","txts","nestedText","endTxt","tag_value","tag_end","branch","min_one","else_tag","branch_tag","each_op","tag","apply_first","cond_branches","with_op","unless_op","interpolator","hasTag","_parse","toDataSet","safeGet","path","parameters","sources","which","special","pipe","lctx","locals","evalValue","dir","safeSet","islet","next","evaluate","isValueOrExpr","Root","isContext","evalParse","template","extend","parseTemplate","evalApply","isApplication","fork","expr","ns","cache","exprs","applyOperator","isDateRel","isTimespan","opMap","registerOperator","ops","getOperator","_defaultGetValue","sorts","getValue","sortArr","by","dirs","lower","cmp","ds","groups","_ds","_context","flt","forEach","row","grouped","level","group","all","order","g","hasPipeRef","getKeypath","local","isOperation","find","isReference","flts","checkArg","shift","src","isValue","constructor","this","log","console","formats","virtualFormats","registerFormat","format","defaults","dateRelToRange","rel","from","to","setUTCFullYear","getFullYear","getMonth","getDate","setUTCHours","dateAndTimespan","setUTCDate","getUTCDate","getUTCDay","setDate","setUTCMonth","getUTCMonth","getUTCFullYear","UTC","setUTCMilliseconds","getUTCMilliseconds","setUTCMinutes","getUTCMinutes","offset","getTimezoneOffset","dateRelToDate","range","dateRelToExactRange","dt","setMinutes","getMinutes","getHours","getSeconds","getMilliseconds","setFullYear","dd","setMonth","setHours","setSeconds","setMilliseconds","addStyle","id","style","styles","placement","output","height","isComputed","maybeComputed","report","extendContext","styleMap","commit","htmlChars","htmlReplace","escapeHTML","html","renderers","registerRenderer","renderer","options","render","avgs","measure","width","font","family","size","brw","avg","metric","test","word","wlen","renderWidget","state","hide","widget","container","getHeightWithMargin","maxY","isNaN","availableY","continue","cancel","extraHeight","margin","expandMargin","border","box","expandBorder","getWidthWithMargin","toFixed","layouts","registerLayout","layout","getWidth","pct","availableX","maxX","percent","getHeight","computed","linesize","maxFontSize","NaN","maxYOffset","points","maxXOffset","top","bottom","expandMacro","macro","props","properties","widgets","mapStyle","mapped","ids","nextStyleId","styleClass","cls","inline","inlineStyle","classPrefix","classifyStyles","offsetX","offsetY","computedHeight","lineSize","styleFont","styleBorder","styleExtra","bg","radius","color","align","weight","pre","clamp","br","initParameters","defaultParams","inits","applySources","srcs","base","runDelimited","headers","table","quote","field","record","rowContext","unquote","RegExp","findWidgets","results","zwsp","sp","integer","number","remOrPercent","places","valign","pad","fg","rotate","turn","origin","move","trash","bools","tags","blocks","aliases","parsed","stuff","open","bool","blockstack","drop","frame","getStyle","process","flexAlign","middle","borderStyle","dot","dash","bs","underline","overline","strike","sup","sub","italic","bold","vs","transforms","vv","onCommit","commitContext","sval","styled","styleText","wctx","extendData","cw","yo","lp","child","attempt","renderWidgets","bridge","groupNo","newPage","header","hctx","current","groupHeaders","headerPerPage","rctx","elide","usedX","usedY","initY","alternate","headerRepeat","footer","fctx","groupEnds","fit","url","styleImage","decRE","intRE","isNumRE","dec","negative","parseFloat","neg","dateRE","months","days","dateDefault","Y","M","D","DD","H","MM","S","SS","Z","getDay","prototype","toString","call","ordinal","min","bit","abs","num","setDefault","checkIdent","_noSym","_key","_sexprops","_listcommas","_noarr","_noobj","_tpl","_tplmode","_noindent","_listwrap","_html","_nochecks","_level","_first","deepops","binops","unops","precedence","in","like","ilike","gt","gte","lt","lte","is","and","or","noSymbols","SExprOps","listCommas","noArrayLiterals","noObjectLiterals","noIndent","listWrap","htmlSafe","noChecks","_stringify","stringifyRootBlock","padl","stringed","stringifyTemplateBlock","caseRE","stringifyTemplateCase","fill","wrapArgs","isBlock","long","cindent","outdentAll","trimLeft","trimRight","stringifyIf","wsplit","stringifyCase","findNestedStringOpL","flattenNestedBinopsL","re","_f","stringifyTemplate","stringifyBinopArg","amount","indentAll","stringifyOp","arrow","stringifySchema","stringifyDate","entries","stringifyLiteral","rem","spanKeys","spanExact","stringifyTimespan","agg","offsetToTimezone","mn","leadingSpace","allLeadingSpace","close","keyMod","wrapSetting","wrap","ts","strs","fin","def","l2","nl","lopen","lclose","parseSchema","num_range","sign_range","sign","Infinity","star_range","not_range","looseEqual","v1","v2","strictEqual","isNum","trueStrings","falseStrings","sqlEqual","tmp1","tmp2","fullnum","diff","equal","_diff","identity","keyMode","checkIdentity","v1ids","v2ids","vv1","vv2","_v1","_v2","ks","deepEqual","_deepEqual","labelDiff","label","out","omit","_labelDiff","nums","lbl","pp","isDate","isSchema","what","inspect","flat","getType","getField","validate","mode","_validate","_schema","errs","checkType","actual","unparseSchema","expected","tmp","legit","ok","DEFAULTS","csv","quotedField","records","quotes","detect","data","sample","match","fs","rs","qs","isTableOpts","splice","fixedSize","entities","amp","entity","attr","quoted","attrs","put","target","strict","stack","stream","simple","spanMap","generateDefaults","stringTimes","times","roundDefaults","method","round","amt","settings","place","point","ceil","zeroes","pow","big","hasNum","equals","overlap","threshhold","similar","similarity","fudges","whole","aa","bb","i1","i2","oa","ob","f1","f2","sim","alen","blen","aolen","bolen","matchy","inRange","excluded","where","ct","eq","_name","pattern","patterns","free","_opts","_parseRange","it","parseRange","no","bounds","upper","step","app","namedArgs","datesDiff","unit","fraction","us","endM","dist","nextDiv","units","raport","tpl","json","base64","btoa","_","vals","addTimespan","precision","random","triml","trimr","escapeRe","flatten","levels","fmtDate","_ranges","_indexPair","many","kk","flags","avail","ww","proto","rdt","vfmt","unset","xml","parseXML","delimited","separator","csvDetect","csvParse","atob","_i","_total","ast","case","body","lastKey","_last","partition","seen","_arr","dollar","dev","alphaNum","alphaNumSpace","camelBreak","spaceChar","normalize","_m","c1","c2","whiches","_objectToXML","depth","indent","propname","entry","te","TextEncoder","encode","padStart","objectToXML","legal","tabloid","a4","extraContext","repeater","_tmp","runAsDelimited","extras","orientation","yy","watermark","overlay","_k","head","foot","runFlow","page","pages","printX","printY","pageY","headSize","footSize","footPlace","headPlace","_p","runPage"],"mappings":"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"}