{"version":3,"file":"raport.umd.min.js","sources":["../node_modules/sprunge/src/base.ts","../node_modules/sprunge/src/search.ts","../node_modules/sprunge/src/parsers/char.ts","../node_modules/sprunge/src/parsers/str.ts","../node_modules/sprunge/src/parsers/base.ts","../node_modules/sprunge/src/parsers/rep.ts","../node_modules/sprunge/src/parsers/seq.ts","../node_modules/sprunge/src/json.ts","../src/lib/data/parse.ts","../src/lib/data/parse/template.ts","../src/lib/data/index.ts","../src/lib/render/error.ts","../src/lib/render/index.ts","../src/lib/render/style.ts","../src/lib/report.ts","../src/lib/data/parse/style.ts","../src/lib/render/builtins.ts","../src/lib/data/format.ts","../src/lib/data/parse/stringify.ts","../src/lib/data/parse/schema.ts","../src/lib/data/parse/range.ts","../src/lib/data/diff.ts","../src/lib/data/schema.ts","../src/lib/data/csv.ts","../src/lib/data/parse/xml.ts","../src/lib/data/builtins.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,"import { parser as makeParser, Parser, bracket, opt, alt, seq, str, istr, map, read, chars, repsep, rep1sep, read1To, read1, skip1, rep, rep1, check, verify, name, not, nop, readTo, unwrap, andNot } from 'sprunge/lib';\nimport { ws, digits, JNum, JStringEscape, JStringUnicode, JStringHex, JString } from 'sprunge/lib/json';\nimport { Value, DateRel, DateRelToDate, DateRelRange, DateRelSpan, DateExactRange, Literal, Keypath, TimeSpan, Operation, TimeSpanMS, Schema, Field, TypeMap, ValueWithAnchor } from './index';\n\nexport const timespans = {\n  y: 0,\n  m: 0,\n  w: 0,\n  d: 86400000,\n  h: 3600000,\n  mm: 60000,\n  s: 1000,\n};\n\ntimespans.w = timespans.d * 7;\ntimespans.y = Math.floor(timespans.d * 365.25);\ntimespans.m = Math.floor(timespans.d * 30.45);\n\nexport function isTimespanMS(v: any): v is TimeSpanMS {\n  return typeof v === 'object' && v && typeof v.ms === 'number';\n}\n\nexport function timeSpanToNumber(v: TimeSpan): number {\n  if (typeof v === 'number') return v;\n  else if (isTimespanMS(v)) return v.ms;\n  else return ((((((((((((v.d[0] || 0) * 12) + (v.d[1] || 0)) * 30.45) + (v.d[2] || 0)) * 24) + (v.d[3] || 0)) * 60) + (v.d[4] || 0)) * 60) + (v.d[5] || 0)) * 1000) + (v.d[6] || 0);\n}\n\nconst space = ' \\r\\n\\t';\nconst endSym = space + '():{}[]<>,\"\\'`\\\\;&#';\nexport const endRef = endSym + '.+/*|^%=!?';\n\nconst _comment = map(seq(ws, str('//'), opt(str(' ')), readTo('\\n'), str('\\n')), ([, , , c]) => ({ c }), { name: 'comment', primary: true });\nfunction comment<T extends any>(prop: string, p: Parser<T>): Parser<T> {\n  return map(seq(rep(_comment), ws, p), ([c, , v]) => {\n    if (c && c.length) v[prop] = c.map(c => c.c);\n    return v;\n  });\n}\n\nexport const rws = skip1(space, 'required-space');\n\nexport const keywords = map<string, any>(str('null', 'true', 'false', 'undefined'), v => {\n  switch (v) {\n    case 'null': return null;\n    case 'true': return true;\n    case 'false': return false;\n    case 'undefined': return undefined;\n  }\n}, { primary: true, name: 'primitive' });\n\nexport const ident = read1To(endRef, true);\nexport const sexprop = read1To(' \\r\\n\\t():{}[],\"\\'\\\\;&#@', true);\n\nexport const args: Parser<[Value[], Value]> = {};\nexport const array: Parser<Value> = {};\nexport const block: Parser<Value> = {};\nexport const object: Parser<Value> = {};\nexport const value: Parser<Value> = {};\nexport const values: Parser<Value> = {};\nexport const tpl: Parser<Value> = {};\nexport const application: Parser<Value> = {};\nexport const inlineTemplate: Parser<Value> = {};\n\nconst escmap: { [k: string]: string } = { n: '\\n', r: '\\r', t: '\\t', b: '\\b' };\nconst pathesc = map(seq(str('\\\\'), chars(1)), ([, char]) => escmap[char] || char);\nconst pathident = map(rep1(alt('ref-part', read1To(endRef, true), pathesc)), parts => parts.join(''), 'keypath-part');\nconst dotpath = map(seq(str('.'), pathident), ([, part]) => part);\nconst valueAnchor = map(seq(value, ws, opt(str('<')), ws, opt(seq(value, ws, opt(str('<'))))), ([v, , a, , s]) => {\n  if (a) (v as ValueWithAnchor).anchor = 'end';\n  if (s) {\n    const r = v as ValueWithAnchor;\n    r.slice = s[0];\n    if (s[2]) r.slice.anchor = 'end';\n  }\n  return v\n});\nconst bracketpath = bracket(seq(str('['), ws), valueAnchor, seq(ws, str(']')));\nexport const keypath = map(seq(alt<'!'|'~'|'*'|[string,string]>('ref-sigil', str('!', '~', '*') as any, seq(read('^'), opt(str('@', '.')))), alt<string|Value>('keypath', pathident, bracketpath), rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([prefix, init, parts]) => {\n  const res: Keypath = { k: [init].concat(parts).map(p => typeof p === 'object' && 'v' in p && (typeof p.v === 'string' || typeof p.v === 'number') && !('anchor' in p) && !('slice' in p) ? p.v : p) };\n  if (Array.isArray(prefix)) {\n    if (prefix[0]) res.u = prefix[0].length;\n    if (prefix[1] === '@') res.p = '@';\n  } else if (prefix) {\n    res.p = prefix;\n  }\n  return res;\n}, 'keypath');\nexport const localpath = map(seq(read('^'), pathident, rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([prefix, init, parts]) => {\n  const res: Keypath = { k: ([init] as Array<string|Value>).concat(parts).map(p => typeof p === 'object' && 'v' in p && (typeof p.v === 'string' || typeof p.v === 'number' && !('anchor' in p) && !('slice' in p)) ? p.v : p) };\n  if (prefix) res.u = prefix.length;\n  return res;\n}, 'localpath');\n\nexport const parsePath = makeParser(keypath);\nexport const parseLetPath = makeParser(localpath);\n\nconst illegalRefs = ['if', 'else', 'elif', 'elseif', 'elsif', 'fi', 'esac', 'unless', 'then', 'case', 'when', 'not', 'gte', 'gt', 'lte', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain', 'is-not', 'is', 'strict-is-not', 'strict-is', 'deep-is-not', 'deep-is', 'and', 'or', 'end', 'with', 'each'];\nexport const ref = map(keypath, (r, err) => {\n  if (r.k.length === 1 && !r.p && !r.u && illegalRefs.includes(r.k[0] as string)) err(`invalid reference name '${r.k[0] as string}'`);\n  return { r };\n}, { primary: true, name: 'reference' });\n\nfunction stringInterp(parts: Value[], q?: string): Value {\n  const res = parts.reduce((a, c) => {\n    if (a.length) {\n      if ('v' in c && 'v' in a[a.length - 1] && typeof c.v === 'string' && typeof (a[a.length - 1] as Literal).v === 'string') (a[a.length - 1] as Literal).v += c.v;\n      else a.push(c);\n    } else {\n      a.push(c);\n    }\n    return a;\n  }, [] as Value[]);\n\n  if (res.length > 0 && (!('v' in res[0]) || typeof res[0].v !== 'string')) res.unshift({ v: '' });\n\n  if (res.length === 0) return { v: '' };\n  else if (res.length === 1) return res[0];\n  return { op: '+', args: res, meta: q ? { q } : undefined };\n}\n\nconst timespan = map(rep1sep(seq(JNum, ws, istr('years', 'year', 'y', 'months', 'month', 'minutes', 'minute', 'milliseconds', 'millisecond', 'mm', 'ms', 'm', 'weeks', 'week', 'w', 'days', 'day', 'd', 'hours', 'hour', 'h', 'seconds', 'second', 's')), ws), parts => {\n  const span = { y: 0, m: 0, d: 0, h: 0, mm: 0, s: 0, ms: 0 };\n  for (let i = 0; i < parts.length; i++) {\n    if (parts[i][2][0] === 'y') span.y += parts[i][0];\n    else if (parts[i][2] === 'm' || parts[i][2] === 'months' || parts[i][2] === 'month') span.m += parts[i][0];\n    else if (parts[i][2][0] === 'd') span.d += parts[i][0];\n    else if (parts[i][2][0] === 'w') span.d += parts[i][0] * 7;\n    else if (parts[i][2][0] === 'h') span.h += parts[i][0];\n    else if (parts[i][2][0] === 's') span.s += parts[i][0];\n    else if (parts[i][2] === 'mm' || parts[i][2] === 'minutes' || parts[i][2] === 'minute') span.mm += parts[i][0];\n    else if (parts[i][2] === 'ms' || parts[i][2] === 'milliseconds' || parts[i][2] === 'millisecond') span.ms += parts[i][0];\n  }\n\n  if (!span.y && !span.m && !span.d) {\n    delete span.y; delete span.m; delete span.d;\n    let n = 0;\n    for (const k in span) n += span[k] * (timespans[k] || 1);\n    return { ms: n };\n  } else {\n    const s: [number?, number?, number?, number?, number?, number?, number?] = [];\n    if (span.y) s[0] = span.y;\n    if (span.m) s[1] = span.m;\n    if (span.d) s[2] = span.d;\n    if (span.h) s[3] = span.h;\n    if (span.mm) s[4] = span.mm;\n    if (span.s) s[5] = span.s;\n    if (span.ms) s[6] = span.ms;\n    return { d: s };\n  }\n}, { primary: true, name: 'timespan' });\n\nexport const timezone = map(seq(ws, alt<string|[string, string, [string, string]]>('timezone',\n  istr('z'),\n  seq(opt(chars(1, '+-')), alt(chars(4, digits), chars(2, digits), chars(1, digits)),\n    opt(seq(str(':'), chars(2, digits)))\n  )\n)), v => {\n  if (v[1][0] === 'z') return 0;\n  else {\n    let res: number;\n    if (v[1][1].length === 4) {\n      res = +v[1][1].substr(0, 2) * 60 + +v[1][1].substr(2, 2);\n    } else {\n      res = +v[1][1] * 60;\n      if (v[1][2]) res += +v[1][2][1];\n    }\n    if (v[1][0] === '-') res *= -1;\n    return res;\n  }\n});\n\nexport const timeexact = alt<[number, number?, number?, number?]>(\n  map(seq(\n    read1(digits),\n    opt(seq(\n      str(':'), chars(2, digits), opt(\n        seq(str(':'), chars(2, digits), opt(\n          seq(str('.'), chars(3, digits))\n        ))\n      )\n    ))\n  ), v => {\n    const h = v[0];\n    const m = v[1] && v[1][1];\n    const s = m && v[1][2] && v[1][2][1];\n    const ms = s && v[1][2][2] && v[1][2][2][1];\n    const res: [number, number?, number?, number?] = [+h];\n    if (m) res[1] = +m;\n    if (s) res[2] = +s;\n    if (ms) res[3] = +ms;\n    return res;\n  }),\n  map(istr('start', 'midnight'), () => [0, 0, 0, 0]),\n  map(istr('noon', 'mid'), () => [12, 0, 0, 0]),\n  map(istr('end'), () => [23, 59, 59, 999]),\n);\n\nexport const parseTime = makeParser(alt<number|[number, number?, number?, number?]>(map(seq(timeexact, opt(seq(ws, timezone))), ([tm, z]) => {\n  if (z) tm.push(z[1]);\n  return tm;\n}), timezone), { trim: true, consumeAll: true, undefinedOnError: true });\n\nconst dateend = opt(seq(ws, str('>')));\nconst daterel = alt<DateRel>('date',\n  map(seq(opt(istr('last', 'this', 'next')), rws, istr('week', 'month', 'year'), opt(timezone), dateend), ([o, , f, tz, e]) => {\n    const val: DateRelRange = { f: f[0] === 'w' ? 'w' : f[0] === 'm' ? 'm' : 'y', o: o === 'last' ? -1 : o === 'next' ? 1 : 0, e: e ? 1 : undefined };\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('week', 'month', 'year'), seq(rws, istr('to'), rws, istr('date')), opt(timezone), dateend), ([f, , tz, e]) => {\n    const val: DateRelToDate = { f: f[0] === 'w' ? 'w' : f[0] === 'm' ? 'm' : 'y', o: 0, d: 1, e: e ? 1 : undefined };\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('yesterday', 'today', 'tomorrow'), alt<any>(bracket(ws, istr('at'), ws), rws), timeexact, ws, opt(timezone)), v => {\n    const res: DateRel = { f: 'd', o: v[0] === 'yesterday' ? -1 : v[0] === 'today' ? 0 : 1, t: v[2] };\n    if (v[4] != null) res.t[4] = v[4];\n    return res;\n  }),\n  map(seq(istr('yesterday', 'today', 'tomorrow', 'now'), opt(timezone), dateend), ([v, tz, e]) => {\n    const val: DateRel = (v === 'now' ? { f: 'n', o: 0 } : { f: 'd', o: v === 'yesterday' ? -1 : v === 'today' ? 0 : 1, e: e ? 1 : undefined });\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('in'), rws, timespan), v => (typeof v[2] === 'number' || isTimespanMS(v[2]) ? { f: 'n', o: timeSpanToNumber(v[2]) } : { f: 'n', o: v[2].d })),\n  map(seq(timespan, rws, alt<string|any[]>('relative time anchor', istr('ago'), seq(istr('from'), rws, istr('now'))), opt(timezone)), ([span, , ref, tz]) => {\n    let val: DateRelSpan;\n    if (typeof span === 'number' || isTimespanMS(span)) {\n      val = { f: 'n', o: timeSpanToNumber(span) * (ref === 'ago' ? -1 : 1) };\n    } else {\n      val = { f: 'n', o: span.d, d: ref === 'ago' ? -1 : undefined };\n    }\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n);\n\nfunction setIndex<T, U = Array<T>>(array: U, index: number, value: T): U {\n  if (value == null) return array;\n  array[index] = value;\n  return array;\n}\nexport const dateexact: Parser<Date|DateRel> = map(seq(\n  chars(4, digits),\n  opt(seq(chars(1, '-/'), read1(digits),\n    opt(seq(chars(1, '-/'), read1(digits)))\n  )),\n  opt(seq(\n    alt(bracket(rws, istr('at'), rws), istr('t'), rws), timeexact\n  )),\n  opt(timezone),\n  dateend,\n), v => {\n  const y = v[0];\n  const m = v[1] && v[1][1];\n  const d = m && v[1][2] && v[1][2][1];\n  const time = v[2] && v[2][1];\n  const tz = v[3];\n  const e = v[4] ? 1 : undefined;\n  if (!m) return { f: setIndex([+y], 7, tz), e };\n  else if (!d) return { f: setIndex([+y, +m - 1], 7, tz), e };\n  else if (!time) return { f: setIndex([+y, +m - 1, +d], 7, tz), e }\n  else {\n    const res: DateExactRange = { f: [+y, +m - 1, +d], e };\n    for (let i = 0; i < time.length; i++) {\n      if (time[i] != null) res.f[i + 3] = time[i];\n    }\n    if (tz != null) res.f[7] = tz;\n    return res;\n  }\n});\n\nexport const date = bracket(str('#'), alt<Date|DateRel|TimeSpan>('date', dateexact, daterel, timespan), str('#'), { primary: true, name: 'date' });\n\nexport const typelit = map(seq(str('@['), ws, schema(), ws, str(']')), ([, , v]) => ({ v, s: 1 } as Value), { name: 'typelit', primary: true });\n\nexport const parseDate = makeParser(map(seq(opt(str('#')), alt<Date|DateRel|TimeSpan>('date', dateexact, daterel, timespan), opt(str('#'))), ([, d,]) => d), { trim: true, consumeAll: true, undefinedOnError: true });\n\nexport const string = alt<Value>({ primary: true, name: 'string' },\n  bracket(str('$$$'), inlineTemplate, str('$$$')),\n  map(seq(str(':'), read1To(endSym, true)), v => ({ v: v[1]})),\n  map(bracket(str('\"\"\"'), rep(alt<string>('string-part',\n    read1To('\\\\\"'), JStringEscape, JStringUnicode, JStringHex, andNot(str('\"'), str('\"\"')),\n  )), str('\"\"\"')), a => ({ v: ''.concat(...a), q: '\"\"\"' })),\n  map(bracket(str('\"'), rep(alt<string>('string-part',\n    read1To('\\\\\"'), JStringEscape, JStringUnicode, JStringHex\n  )), str('\"')), a => ({ v: ''.concat(...a) })), \n  map(bracket(str(`'''`), rep(alt('string-part',\n    map(read1To(`'\\\\$\\{`, true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${', '{'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n    map(andNot(str(`'`), str(`''`)), v => ({ v })),\n  )), str(`'''`)), v => stringInterp(v, \"'''\")),\n  map(bracket(str(`'`), rep(alt('string-part',\n    map(read1To(`'\\\\$\\{`, true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${', '{'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n  )), str(`'`)), v => stringInterp(v)),\n  map(bracket(str('```'), rep(alt('string-part',\n    map(read1To('`\\\\${', true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n    map(andNot(str('`'), str('``')), v => ({ v })),\n  )), str('```')), v => stringInterp(v, '```')),\n  map(bracket(str('`'), rep(alt('string-part',\n    map(read1To('`\\\\${', true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n  )), str('`')), v => stringInterp(v)),\n);\nexport const literal = map(alt('literal', map(JNum, v => v, { primary: true, name: 'number' }), keywords, date), v => {\n  if (v instanceof Date || v == null || typeof v !== 'object') return { v };\n  else return v;\n});\n\nexport const sexp = map(bracket(\n  check(str('('), ws),\n  seq(sexprop, ws, args),\n  check(ws, str(')')),\n), ([op, , args]) => {\n  const res: Value = { op };\n  if (args[0] && args[0].length) res.args = args[0];\n  if (args[1]) res.opts = args[1];\n  return res;\n}, { primary: true, name: 's-expression' });\n\nfunction fmt_op(parser: Parser<Value>): Parser<Value> {\n  return map(seq(parser, rep(seq(str('#'), ident, opt(alt<[Value[], Value]>(\n    map(seq(str(','), rep1sep(value, str(','), 'allow')), ([, value]) => [value, undefined]),\n    bracket_op(args),\n  ))), { primary: true, name: 'format-op' })), ([value, fmt]) => {\n    if (!fmt || !fmt.length) return value;\n    return fmt.reduce((a, c) => c[2] ?\n      { op: 'fmt', args: [a, { v: c[1] }, ...(c[2][0] || [])], opts: c[2][1] } :\n      { op: 'fmt', args: [a, { v: c[1] }] }, value);\n  }, 'fmt-op');\n}\n\nfunction bracket_op<T>(parser: Parser<T>): Parser<T> {\n  return bracket(seq(str('('), ws), parser, seq(ws, str(')')));\n}\n\nexport const binop: Parser<Value> = {};\nexport const if_op: Parser<Value> = {};\nexport const case_op: Parser<Value> = {};\n\nconst opName = read1('abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789');\nconst call_op = map(seq(name(opName, 'op'), bracket_op(args)), ([op, args]) => {\n  const res: Value = { op };\n  if (args[0] && args[0].length) res.args = args[0];\n  if (args[1]) res.opts = args[1];\n  return res;\n}, { primary: true, name: 'call' });\n\nexport const operand: Parser<Value> = fmt_op(postfix_path(alt('operand', bracket_op(application), bracket_op(if_op), bracket_op(case_op), verify(bracket_op(binop), v => 'op' in v || `expected bracketed op`), sexp, values)));\nexport const unop = map(seq(str('not ', '+', '-'), operand), ([op, arg]) => ({ op: op === 'not ' ? 'not' : op, args: [arg] }), 'unary op');\n\nfunction leftassoc(left: Value, [, op, , right]: [string, string, string, Value]) {\n  return { op, args: [left, right] };\n}\n\nfunction rightassoc(left: Value, more: Array<[string, string, string, Value]>) {\n  if (more.length === 1) return { op: more[0][1], args: [left, more[0][3]] };\n  const end = more.pop();\n  let op = more[more.length - 1][1];\n  const first = { op: end[1], args: [more.pop()[3], end[3]] }\n  const right = more.reverse().reduce((a, c) => {\n    const res = { op, args: [c[3], a] };\n    op = c[1];\n    return res;\n  }, first);\n  return { op, args: [left, right] };\n}\n\nexport const binop_pipe = map(seq(operand, rep(alt(\n  seq(nop, name(str('|'), 'pipe op'), nop, operand),\n  seq(rws, name(str('|'), 'pipe op'), rws, operand),\n))), ([arg1, more]) => more.length ? ({ op: 'pipe', args: [arg1].concat((more || []).map(a => a[3])), meta: { op: 1 } }) : arg1, 'pipe-op');\nexport const binop_e = map(seq(binop_pipe, rep(alt(\n  seq(nop, name(str('**'), 'exp op'), nop, binop_pipe),\n  seq(rws, name(str('**'), 'exp op'), rws, binop_pipe),\n))), ([arg1, more]) => more.length ? rightassoc(arg1, more) : arg1, 'exp-op');\nexport const binop_md = map(seq(binop_e, rep(alt(\n  seq(nop, name(str('*', '/%', '/', '%'), 'muldiv-op'), nop, binop_e),\n  seq(rws, name(str('*', '/%', '/', '%'), 'muldiv-op'), rws, binop_e),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'muldiv-op');\nexport const binop_as = map(seq(binop_md, rep(alt(\n  seq(nop, name(str('+', '-'), 'addsub-op'), nop, binop_md),\n  seq(rws, name(str('+', '-'), 'addsub-op'), rws, binop_md),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'addsub-op');\nexport const binop_cmp = map(seq(binop_as, rep(alt(\n  seq(nop, name(str('>=', '>', '<=', '<'), 'cmp-op'), nop, binop_as),\n  seq(rws, name(str('>=', '>', '<=', '<', 'gte', 'gt', 'lte', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain'), 'cmp-op'), rws, binop_as),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'cmp-op');\nexport const binop_eq = map(seq(binop_cmp, rep(alt(\n  seq(nop, name(str('===', '==', '!==', '!='), 'eq-op'), nop, binop_cmp),\n  seq(rws, name(str('===', '==', '!==', '!=', 'is-not', 'is', 'strict-is-not', 'strict-is', 'deep-is-not', 'deep-is'), 'eq-op'), rws, binop_cmp),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'eq-op');\nexport const binop_and = map(seq(binop_eq, rep(alt(\n  seq(nop, name(str('&&'), 'and-op'), nop, binop_eq),\n  seq(rws, name(str('and', '&&'), 'and-op'), rws, binop_eq),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'and-op');\nexport const binop_or = map(seq(binop_and, rep(alt(\n  seq(nop, name(str('||', '??'), 'or-op'), nop, binop_and),\n  seq(rws, name(str('or', '||', '??'), 'or-op'), rws, binop_and),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'or-op');\nbinop.parser = map(binop_or, v => v, { primary: true, name: 'binary-op' });\n\nconst branch_body = alt(map(seq(str('then'), rws, value), ([, , v]) => v), block);\nif_op.parser = alt({ primary: true, name: 'conditional' },\n  map(seq(str('if'), rws, value, rws, branch_body, rep(seq(rws, not(str('end', 'fi')), str('else if ', 'elseif', 'elsif', 'elif'), rws, value, rws, branch_body)), opt(seq(ws, str('else'), rws, value)), opt(seq(ws, str('end', 'fi')))), ([,, cond1,, body1, elifs, el]) => {\n    const op = { op: 'if', args: [cond1, body1] };\n    for (const [,,,, cond,, body] of elifs) op.args.push(cond, body);\n    if (el) op.args.push(el[3]);\n    return op;\n  }, 'if'),\n  map(seq(str('unless'), rws, value, rws, branch_body, opt(seq(rws, str('else'), rws, value)), opt(seq(rws, str('end')))), ([,, cond,, hit, miss]) => {\n    const op = { op: 'unless', args: [cond, hit] };\n    if (miss) op.args.push(miss[3]);\n    return op;\n  }),\n);\n\nexport function replaceCase(op: Operation): boolean {\n  if (!op.args || !op.args.length) return false;\n  let found = false;\n  for (let i = 0; i < op.args.length; i++) {\n    const arg = op.args[i] as Value;\n    if ('r' in arg && (arg.r === '_' || (typeof arg.r === 'object' && arg.r.k[0] === '_'))) {\n      arg.r = { k: ['case'].concat(((arg.r as any).k || []).slice(1)), p: '@' };\n      found = true;\n    } else if ('r' in arg && typeof arg.r === 'object' && arg.r.p === '@' && arg.r.k[0] === 'case') {\n      found = true;\n    } else if ('op' in arg) found = found || replaceCase(arg);\n  }\n  return found;\n}\n\nexport const case_branch = alt<[undefined|Value, Value]>(\n  map(seq(rws, not(str('end', 'esac')), str('when'), rws, value, rws, str('then'), rws, value), ([,,,, cond,,,, hit]) => [cond, hit], 'when-branch'),\n  map(seq(rws, not(str('end', 'esac')), str('else'), rws, value), ([,,,, hit]) => [undefined, hit], 'else-branch'),\n  map(seq(rws, not(str('end', 'esac')), str('when'), rws, value, rws, block), ([,,,, cond,, hit]) => [cond, hit], 'when-block'),\n);\ncase_op.parser = alt(\n  map(seq(str('case'), rws, value, rep(case_branch), opt(seq(rws, str('end', 'esac')))), ([,, val, branches]) => {\n    const op = { op: 'case', args: [val] };\n    for (let i = 0; i < branches.length; i++) {\n      if (branches[i][0] === undefined) op.args.push(branches[i][1]);\n      else {\n        let arg: Value = branches[i][0];\n        if ('op' in arg) replaceCase(arg);\n        op.args.push(arg);\n        op.args.push(branches[i][1]);\n      }\n    }\n    return op;\n  }, 'case'),\n);\n\nfunction postfix_path(parser: Parser<Value>): Parser<Value> {\n  return map(seq(parser, rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([v, k]) => {\n    if (k.length) return { op: 'get', args: [v, { v: { k } }] };\n    else return v;\n  }, 'postfix-path-op');\n}\n\nexport const operation = alt<Value>('expression', if_op, case_op, binop);\n\nconst pair: Parser<[Value, Value]> = map(seq(alt('key', string, map(ident, v => ({ v }))), ws, str(':'), ws, value), t => [t[0], t[4]], 'pair');\n\narray.parser = map(bracket(\n  check(str('['), ws),\n  repsep(value, read1(space + ','), 'allow'),\n  check(ws, str(']')),\n), args => args.filter(a => !('v' in a)).length ? { op: 'array', args } : { v: args.map(a => (a as Literal).v) }, { primary: true, name: 'array' });\n\nfunction objectOp(pairs: [Value, Value][]): Value {\n  return pairs.filter(p => !('v' in p[0] && 'v' in p[1])).length ?\n  { op: 'object', args: pairs.reduce((a, c) => (a.push(c[0], c[1]), a), []) } : \n  { v: pairs.reduce((a, c) => (a[(c[0] as Literal).v] = (c[1] as Literal).v, a), {}) };\n}\n\nobject.parser = map(bracket(\n  check(str('{'), ws),\n  repsep(pair, read1(space + ','), 'allow'),\n  check(ws, str('}')),\n), objectOp, { primary: true, name: 'object' });\n\nblock.parser = map(bracket(\n  check(str('{'), ws),\n  rep1sep(value, read1(space + ';'), 'allow'),\n  check(ws, str('}')),\n), args => ({ op: 'block', args }), { primary: true, name: 'block' });\n\nvalue.parser = unwrap(comment('c', operation));\n\nconst namedArg: Parser<[Value, Value]> = map(seq(ident, str(':'), ws, value), ([k, , , v]) => [{ v: k }, v], 'named-arg');\napplication.parser = map(seq(opt(bracket(check(str('|'), ws), rep1sep(opName, read1(space + ','), 'allow'), seq(str('|'), ws))), str('=>', '=\\\\'), ws, value), ([names, , , value]) => {\n  const res: Value = { a: value };\n  if (names) res.n = names;\n  if ('op' in value && value.op === 'block') {\n    value.opts = Object.assign({}, value.opts, { v: { implicit: 1 } });\n  }\n  return res;\n}, { primary: true, name: 'application' });\nargs.parser = map(repsep(alt<[Value, Value] | Value>('argument', namedArg, value), read1(space + ','), 'allow'), (args) => {\n  const [plain, obj] = args.reduce((a, c) => ((Array.isArray(c) ? a[1].push(c) : a[0].push(c)), a), [[], []] as [Array<Value>, Array<[Value, Value]>]);\n  if (obj.length) return [plain, objectOp(obj)];\n  return [plain, undefined];\n});\n\nconst letter = map(seq(str('let'), rws, name(localpath, { name: 'reference', primary: true }), ws, str('='), ws, value), ([, , k, , , , v]) => ({ op: 'let', args: [{ v: k }, v] }), { primary: true, name: 'let' });\nconst setter = map(seq(str('set'), rws, name(keypath, { name: 'reference', primary: true }), ws, str('='), ws, value), ([, , k, , , , v]) => ({ op: 'set', args: [{ v: k }, v] }), { primary: true, name: 'set' });\nvalues.parser = alt('expression', array, object, literal, typelit, string, application, unop, call_op, letter, setter, ref, block);\n\nexport const parseBlock = makeParser<Value>(map(rep1sep(value, read1(space + ';'), 'allow'), args => args.length === 1 ? args[0] : { op: 'block', args, opts: { v: { implicit: 1 } } }, 'expression-sequence'), { trim: true });\nexport const parseExpr = makeParser(value, { trim: true });\n(parseBlock as any).namespace = 'default';\nexport const parse: typeof parseBlock & { namespace: string } = parseBlock as any;\nexport default parse;\n\nexport function schema() {\n  const type: Parser<Schema> = {};\n  const conditions = opt(seq(ws, rep1sep(map(seq(name(str('?'), { name: 'condition', primary: true }), ws, application), ([, , a]) => a), rws, 'disallow')));\n  const value = map(seq(str('any[]', 'string[]', 'number[]', 'boolean[]', 'date[]', 'object[]', 'value[]', 'any', 'string', 'number', 'boolean', 'date', 'object', 'value'), not(read1To(endRef))), ([s]) => ({ type: s === 'any[]' ? 'array' : s } as Schema), { name: 'type', primary: true });\n  const typedef = comment('c', map(seq(str('type'), ws, name(ident, { name: 'type', primary: true }), ws, str('='), ws, type), ([, , name, , , , type]) => ({ name, type } as { name: string, type: Schema, c?: string[] })));\n  const typedefs = map(rep1sep(typedef, read1(' \\t\\n;'), 'allow'), defs => defs.reduce((a, c) => (c.type.desc = c.c, a[c.name] = c.type, a), {} as TypeMap));\n  const ref = map(seq(ident, opt(str('[]'))), ([ref, arr]) => ({ type: arr ? 'array' : 'any', ref } as Schema), { name: 'type', primary: true });\n  const key = map(seq(name(ident, { name: 'key', primary: true }), opt(str('?')), ws, str(':'), ws, type), ([name, opt, , , , type]) => {\n    const res: Field = type as Field;\n    res.name = name;\n    if (!opt) res.required = true;\n    return res;\n  });\n  const literal = alt<Schema>(\n    { name: 'literal', primary: true }, \n    map(alt<string|number>(JString, JNum), v => {\n      return { type: 'literal', literal: v } as Schema;\n    }),\n    map(str('true', 'false', 'null', 'undefined'), v => {\n      return { type: 'literal', literal: v === 'true' ? true : v === 'false' ? false : v === 'null' ? null : undefined } as Schema;\n    }),\n  );\n  const rest = map(seq(str('...'), ws, str(':'), ws, type), ([, , , , type]) => {\n    return Object.assign({ name: '...' }, type) as Field;\n  });\n  const object: Parser<Schema> = map(seq(str('{'), ws, repsep(comment('desc', alt('interface parts', key, rest)), read1(' \\t\\n,;'), 'allow'), ws, str('}'), opt(str('[]'))), ([, , keys, , , arr], fail) => {\n    const rests = keys.filter(k => k.name === '...');\n    if (rests.length > 1) fail('only one object rest can be specified');\n    else {\n      const rest = rests[0];\n      keys = keys.filter(k => k.name !== '...');\n      const type: Schema = { type: arr ? 'object[]' : 'object' };\n      if (keys.length) type.fields = keys;\n      if (rest) {\n        delete rest.name;\n        type.rest = rest;\n      }\n      return type;\n    }\n  });\n  const tuple = map(seq(str('['), ws, repsep(type, read1(' \\t\\r\\n,'), 'allow'), ws, str(']'), opt(str('[]'))), ([, , types, , , arr]) => {\n    return { type: arr ? 'tuple[]' : 'tuple', types } as Schema;\n  });\n  const maybe_union: Parser<Schema> = {};\n  const union_array: Parser<Schema> = {};\n\n  maybe_union.parser = map(rep1sep(seq(alt<Schema>('union', value, object, tuple, literal, union_array, ref), conditions), seq(ws, str('|'), ws), 'disallow'), list => {\n    const types = list.map(([t, c]) => {\n      if (c && c[1] && c[1].length) t.checks = c[1];\n      return t;\n    });\n    if (types.length === 1) return types[0];\n    else return { type: 'union', types: types } as Schema;\n  });\n  union_array.parser = alt<Schema>('union array',\n    map(seq(str('Array<'), ws, maybe_union, ws, str('>')), ([, , union], fail) => {\n      if (union.type === 'union') return { type: 'union[]', types: union.types } as Schema;\n      else if (union.type === 'literal') fail('literal types cannot be array types');\n      else if (union.type === 'array' || ~union.type.indexOf('[]')) return { type: 'union[]', types: [union] } as Schema;\n      else if (union.type === 'any') return { type: 'array', ref: union.ref } as Schema;\n      else {\n        union.type += '[]';\n        return union;\n      }\n    }),\n    map(seq(str('('), ws, maybe_union, ws, str(')')), ([, , union]) => union),\n  );\n\n  type.parser = map(seq(maybe_union, conditions), ([type, checks]) => {\n    if (checks && checks[1] && checks[1].length) type.checks = checks[1];\n    return type;\n  });\n\n  const root = map(seq(opt(typedefs), ws, type), ([defs, , type]) => {\n    if (defs) type.defs = defs;\n    return type;\n  });\n\n  return root;\n}\n","import { Value } from '../index';\nimport { value, rws, replaceCase, inlineTemplate } from '../parse';\nimport { Parser, parser as makeParser, rep, rep1, seq, alt, map, read1To, chars, str, readTo, check, andNot, name } from 'sprunge';\nimport { ws } from 'sprunge/lib/json';\n\nconst endTxt = '\\\\{';\n\nconst txtEsc = alt(map(str('\\\\{{'), () => '{{'), map(seq(str('\\\\'), chars(1)), ([, c]) => c));\nconst text = map(rep1(alt(read1To(endTxt, true), txtEsc, andNot(str('{'), str('{')))), txts => ({ v: txts.join('') }), 'text');\nconst nestedText = map(rep1(alt(read1To(endTxt + '$'), txtEsc, andNot(str('$'), str('$$')), andNot(str('{'), str('{')))), txts => ({ v: txts.join('') }), 'text');\n\nfunction tag_value(names: string[]): Parser<[string, Value]> {\n  return map(seq(str('{{'), ws, str(...names), rws, value, ws, str('}}')), arr => [arr[2], arr[4]], 'tag');\n}\n\nfunction case_value(names: string[]): Parser<[string, Value, Value]> {\n  return map(seq(str('{{'), ws, str(...names), rws, value, rws, str('when'), rws, value, str('}}')), arr => [arr[2], arr[4], arr[8]], 'tag');\n}\n\nconst tag_end = name(check(seq(str('{{/'), readTo('}'), str('}}'))), 'tag end');\n\nconst content: Parser<Value> = {};\n\ninterface Branch {\n  name: string;\n  value?: Value;\n}\n\ntype Content = Value|Branch;\n\nfunction branch(names: string[], value?: boolean): Parser<Branch> {\n  if (value) return map(tag_value(names), ([name, value]) => ({ name, value }));\n  else return map(seq(str('{{'), ws, str(...names), ws, str('}}')), ([, , name]) => ({ name }), 'tag');\n}\n\nfunction min_one<T>(values: Parser<Array<T>>): Parser<Array<T|Value>> {\n  return map(values, v => v.length < 1 ? [{ v: '' }] : v);\n}\n\nconst else_tag = branch(['else']);\nconst branch_tag = branch(['else if', 'elseif', 'elsif', 'elif'], true);\n\nconst each_op = map(seq(tag_value(['each']), min_one(rep(alt<Content>(branch_tag, else_tag, content))), tag_end), ([tag, content]) => ({ op: 'each', args: [tag[1]].concat(apply_first(cond_branches(content))) }), { primary: true, name: 'each-block' });\nconst if_op = map(seq(tag_value(['if']), min_one(rep(alt<Content>(branch_tag, else_tag, content))), tag_end), ([tag, content]) => ({ op: 'if', args: [tag[1]].concat(cond_branches(content)) }), { primary: true, name: 'if-block' });\nconst with_op = map(seq(tag_value(['with']), min_one(rep(alt<Content>(else_tag, content))), tag_end), ([tag, content]) => ({ op: 'with', args: [tag[1]].concat(apply_first(cond_branches(content))) }), { primary: true, name: 'with-block' });\nconst unless_op = map(seq(tag_value(['unless']), min_one(rep(content)), tag_end), ([tag, content]) => ({ op: 'unless', args: [tag[1]].concat(concat(content)) }), { primary: true, name: 'unless-block' });\nconst case_op = map(seq(case_value(['case']), min_one(rep(alt<Content>(branch(['when'], true), else_tag, content))), tag_end), ([tag, content]) => {\n  const op = { op: 'case', args: tag.slice(1).concat(cond_branches(content)) };\n  for (let i = 1; i < op.args.length; i += 2) {\n    const arg = op.args[i];\n    if (typeof arg === 'object' && 'op' in arg) replaceCase(arg);\n  }\n  return op;\n}, { primary: true, name: 'case-block' });\n\nconst interpolator = map(seq(str('{{'), ws, value, ws, str('}}')), ([, , value]) => ({ op: 'string', args: [value] }), { primary: true, name: 'interpolator' });\n\ncontent.parser = alt<Value>({ primary: true, name: 'content' }, text, each_op, if_op, with_op, case_op, unless_op, interpolator);\n\nfunction apply_first(content: Value[]): Value[] {\n  if (content.length) content[0] = { a: content[0] };\n  return content;\n}\n\nfunction cond_branches(content: Array<Value|Branch>): Value[] {\n  const res: Value[] = [];\n  let args = [];\n  let hasTag = false;\n\n  for (let i = 0; i < content.length; i++) {\n    const c = content[i];\n    if ('name' in c) {\n      hasTag = true;\n      if (args.length) res.push(concat(args));\n      else res.push({ v: '' });\n      if (c.value) res.push(c.value);\n      args = [];\n    } else args.push(c);\n  }\n  if (args.length) res.push(concat(args));\n  else if (hasTag) res.push({ v: '' });\n\n  if (res.length % 2) res.push({ v: '' });\n\n  return res;\n}\n\nfunction concat(values: Value[]): Value {\n  if (values.length === 1) return values[0];\n  return { op: 'cat', args: values, meta: { q: '$$$' } };\n}\n\nconst _parse = makeParser(alt<Value>(map(rep1(content), args => concat(args)), map(ws, () => ({ v: '' }))), { trim: true });\n(_parse as any).namespace = 'template';\nexport const parse: typeof _parse & { namespace: string } = _parse as any;\n\n(inlineTemplate as { parser?: Parser<Value> }).parser = map(rep1(alt<Value>({ name: 'inline-template' }, nestedText, each_op, if_op, with_op, case_op, unless_op, interpolator)), args => concat(args));\n","import { parse, parsePath, parseLetPath, isTimespanMS } from './parse';\nimport { parse as parseTemplate } from './parse/template';\nimport { ParseError } from 'sprunge/lib';\n\nexport interface TypeMap {\n  [name: string]: Schema;\n}\n\n// Data\nexport interface Schema {\n  /** An optional type for the value */\n  type?: Type;\n  /** Child fields belonging to the field */\n  fields?: Field[];\n  /** Types of unnamed fields in object prototypes */\n  rest?: Schema;\n  /** Types of tuple or union */\n  types?: Schema[];\n  /** Literal value of field */\n  literal?: string|number|boolean|undefined|null;\n  /** Addition validators on the value */\n  checks?: ValueOrExpr[];\n  /** An optional map of named types */\n  defs?: TypeMap;\n  /** If the type is 'any', this may be a name in a type map */\n  ref?: string;\n  /** Additional comments about the type */\n  desc?: string[];\n}\n\nexport interface DataSource<T = any, R = any> {\n  schema?: Schema;\n  values(parms?: T): Promise<DataSet<R>>;\n}\n\nexport interface DataSet<R = any> {\n  schema?: Schema;\n  value: R;\n}\n\nexport function toDataSet(value: any): DataSet {\n  if (Array.isArray(value)) return { value };\n  if (value && typeof value === 'object') {\n    for (const k in value) if (k !== 'schema' && k !== 'value') return { value };\n    return value;\n  }\n  return { value };\n}\n\nexport class CachedDataSource<R = any> implements DataSource<any, R> {\n  _schema: Schema;\n  _value: R;\n\n  constructor(value: R, schema?: Schema) {\n    this._value = value;\n    this._schema = schema;\n  }\n\n  values(): Promise<DataSet<R>> { return Promise.resolve({ schema: this._schema, value: this._value }); }\n}\n\nexport interface SourceMap { [key: string]: DataSet }\n\nexport type ValueType = 'string'|'number'|'boolean'|'date'|'object'|'literal';\nexport type ArrayType = 'string[]'|'number[]'|'boolean[]'|'date[]'|'object[]'|'tuple[]'|'union[]'|'value[]';\nexport type Type = ValueType|ArrayType|'value'|'array'|'union'|'tuple'|'any';\n\nexport interface Field extends Schema {\n  /** The property name for the field */\n  name: string;\n  /** Whether this field is required */\n  required?: true;\n  /** A user-friendly name for the field */\n  label?: string;\n  /** Additional information for special use cases */\n  meta?: any;\n}\n\nexport interface Operation {\n  op: string;\n  args?: ValueOrExpr[];\n  c?: string[];\n  opts?: ValueOrExpr;\n  meta?: any;\n}\n\nexport type Sort = ValueOrExpr|SortBy;\nexport type SortBy = SortBySQL|SortByDir;\nexport interface SortByBase {\n  by: ValueOrExpr;\n}\nexport interface SortBySQL extends SortByBase {\n  desc?: ValueOrExpr|boolean;\n}\nexport interface SortByDir extends SortByBase {\n  dir?: ValueOrExpr|'asc'|'desc';\n}\n\nexport type Operator = AggregateOperator | ValueOperator | CheckedOperator;\n\nexport interface OperatorOptions {\n  [key: string]: any;\n  // this is a dirty hack to make ts acknowledge that this isn't just any old object\n  __options: 1;\n}\n\nexport interface BaseOperator {\n  names: string[];\n}\nexport interface ValueOperator extends BaseOperator {\n  type: 'value';\n  apply(name: string, values: any[], opts: OperatorOptions, context: Context): any;\n}\n\nexport interface CheckedOperator extends BaseOperator {\n  type: 'checked';\n  apply(name: string, values: any[], opts: OperatorOptions, context: Context): any;\n  checkArg: (name: string, num: number, last: number, value: any, opts: OperatorOptions, context: Context, expr: ValueOrExpr) => CheckResult;\n  extend?: true;\n}\n\nexport interface AggregateOperator extends BaseOperator {\n  type: 'aggregate';\n  apply(name: string, values: any[], args: ValueOrExpr[], opts: OperatorOptions, context: Context): any;\n  extend?: true;\n  value?: true;\n}\n\nexport type CheckResult = 'continue'|{ result: any }|{ skip: number, value?: any };\n\nexport interface Group<R = any> {\n  grouped: number;\n  group: string;\n  value: R;\n  all: R[];\n  level: number;\n}\n\n// eval\nexport function getKeypath(ref: Reference): Keypath {\n  if (typeof ref.r === 'object') return ref.r;\n  const path = parsePath(ref.r);\n  if ('k' in path) return path;\n  else return { k: [] };\n}\n\nexport function safeGet(root: Context, path: string|Keypath): any {\n  if (!path) return root.value;\n  const p = typeof path === 'string' ? parsePath(path) : path;\n\n  if ('error' in p) return;\n  else if ('k' in p) {\n    let parts = p.k;\n    const prefix = p.p;\n    let idx = 0;\n    let ctx = root;\n    let o: any = root.value;\n\n    for (let i = 0; i < p.u; i++) ctx && (ctx = ctx.parent);\n    o = ctx ? ctx.value : undefined;\n\n    if (prefix) {\n      if (prefix === '!') o = root.root.parameters;\n      else if (prefix === '~') o = root.root.value;\n      else if (prefix === '*') {\n        o = root.root.sources[parts[idx++] as string];\n        if (o && idx < parts.length + 1 && parts[idx] !== 'value') o = o.value;\n      } else if (prefix === '@') {\n        const which = parts[idx++] as string;\n        if (which === 'locals' || which === 'specials') {\n          const key = which === 'locals' ? which : 'special';\n          while (ctx) {\n            if (ctx[key]) break;\n            ctx = ctx.parent;\n          }\n          if (ctx) o = ctx[key];\n        } else if (which === 'local' || which === 'special') {\n          const key = which === 'local' ? 'locals' : which;\n          o = ctx[key] || (ctx[key] = {});\n        } else if (which === 'parameters' || which === 'sources') {\n          o = root.root[which];\n        } else if (which !== 'value') {\n          while (ctx && (!ctx.special || !(which in ctx.special))) ctx = ctx.parent;\n          o = ctx && ctx.special[which];\n\n          if (o && which === 'source' && parts[idx] !== undefined && parts[idx] !== 'value' && o.value) o = o.value;\n          if (!o && which === 'date') o = root.root.special.date = new Date();\n        }\n      }\n    } else {\n      let first = parts[0];\n      if (typeof first === 'object' && 'v' in first) first = first.v;\n      if (first === '_') {\n        if (ctx.special && ctx.special.pipe) o = ctx.special.pipe;\n        idx++;\n      } else if (typeof first === 'string') {\n        let lctx = ctx;\n        while (lctx && (!lctx.locals || !(first in lctx.locals))) lctx = lctx.parent;\n        if (lctx && first in lctx.locals) {\n          o = lctx.locals[first];\n          idx++;\n        }\n      }\n    }\n\n    for (let i = idx; i < parts.length; i++) {\n      const part = parts[i];\n      const v = typeof part !== 'object' ? part : evalValue(root, part);\n      if (o != null && typeof v === 'number' && typeof part === 'object' && typeof o.length === 'number') {\n        if ('slice' in part && part.slice && typeof part.slice === 'object') {\n          let start = 'anchor' in part && part.anchor === 'end' ? o.length - 1 - v : v;\n          if (start < 0) start = 0;\n          if (start > o.length - 1) start = o.length - 1;\n          const e = typeof part.slice !== 'object' ? part : evalValue(root, part.slice);\n          let end = 'anchor' in part.slice && part.slice.anchor === 'end' ? o.length - 1 - e : e;\n          if (end < 0) end = 0;\n          if (end > o.length - 1) end = o.length - 1;\n          const dir = start > end ? -1 : 1;\n          let res = typeof o === 'string' ? '' : [];\n          for (let i = start; i !== end + dir; i += dir) typeof res === 'string' ? res = res + o[i] : res.push(o[i]);\n          o = res;\n        } else if ('anchor' in part && part.anchor === 'end') {\n          o = o[o.length - 1 - v];\n        } else {\n          o = o[v];\n        }\n      } else if (Array.isArray(v) && o && typeof o === 'object') {\n        const r = {};\n        for (const f of v) if (f in o) r[f] = o[f];\n        o = r;\n      } else o = o && o[v];\n      if (o === null || o === undefined) return;\n    }\n\n    return o;\n  }\n}\n\nexport function safeSet(root: Context, path: string|Keypath, value: any, islet?: boolean): any {\n  if (!path) return;\n  const p = typeof path === 'string' ? (islet ? parseLetPath(path) : parsePath(path)) : path;\n\n  if ('error' in p) return;\n  else if ('k' in p) {\n    let parts = p.k;\n    const prefix = p.p;\n    let ctx = root;\n    let o: any = root.value;\n\n    for (let i = 0; i < p.u; i++) ctx && (ctx = ctx.parent);\n    o = ctx ? ctx.value : undefined;\n\n    const keys = parts.map(p => typeof p !== 'object' ? p : evalValue(root, p));\n\n    if (islet) {\n      o = root.locals || (root.locals = {});\n    } else if (prefix) {\n      if (prefix === '~') o = root.root.value;\n      else return;\n    }\n\n    if (!islet) {\n      const first = keys[0];\n      while (ctx) {\n        if (ctx.locals && first in ctx.locals) break;\n        ctx = ctx.parent;\n      }\n      if (ctx) o = ctx.locals;\n    }\n\n    const last = keys.length - 1;\n    for (let i = 0; i < last; i++) {\n      if (typeof o !== 'object' && typeof o !== 'function' || !o) return;\n      let key = keys[i];\n      const part = parts[i];\n      if (o != null && typeof key === 'number' && typeof part === 'object' && 'anchor' in part && part.anchor === 'end' && typeof o.length === 'number') key = o.length - key;\n      const next = keys[i + 1];\n      if (!(key in o) || o[key] == null) o[key] = typeof next === 'number' ? [] : {};\n      o = o[key];\n    }\n    \n    if (o) {\n      const part = parts[last];\n      let k = keys[last];\n      if (o != null && typeof k === 'number' && typeof part === 'object' && 'anchor' in part && part.anchor === 'end' && typeof o.length === 'number') k = o.length- 1 - k;\n      const cur = o[k];\n      o[k] = value;\n      return cur;\n    }\n  }\n}\n\nexport function evaluate(value: ValueOrExpr): any;\nexport function evaluate(root: Context|{ context: Context }|any, value: ValueOrExpr): any;\nexport function evaluate(root: ValueOrExpr|Context|{ context: Context }|any, value?: ValueOrExpr): any {\n  let r: Context;\n  let e: ValueOrExpr;\n  if (!value && isValueOrExpr(root)) {\n    r = new Root();\n    e = root;\n  } else if (isContext(root)) {\n    r = root;\n    !Array.isArray(value) && (e = value);\n  } else if (root && typeof root === 'object' && 'context' in root && isContext(root.context)) {\n    r = root.context;\n    !Array.isArray(value) && (e = value);\n  } else if (isValueOrExpr(value)) {\n    r = new Root(root);\n    e = value;\n  } else {\n    r = new Root();\n    e = root;\n  }\n  return evalParse(r, e);\n}\n\nexport function template(template: string): string;\nexport function template(root: Context|{ context: Context }|any, template: string): string;\nexport function template(root: string|Context|{ context: Context }|any, template?: string): string {\n  let r: Context;\n  let t: string;\n  if (typeof root === 'string') {\n    r = new Root();\n    t = root;\n  } else if (isContext(root)) {\n    r = root;\n    t = template || '';\n  } else if (root && typeof root === 'object' && 'context' in root && isContext(root.context)) {\n    r = root.context;\n    t = template || '';\n  } else if (root && typeof root !== 'string') {\n    r = new Root(root);\n    t = template || '';\n  } else {\n    r = new Root();\n    t = root;\n  }\n  r = extend(r, { parser: parseTemplate });\n  return evalParse(r, t);\n}\n\n/**\n * Evaluate an applicative with the given locals, naming them if the applicative declares named arguments.\n * If swap is not true, then a new context extension will be used. Otherwise, the context locals will be\n * swapped for the evaluation and replaced afterwards. Swap should only be used for applications that are\n * passing the context value as the first local.\n */\nexport function evalApply(ctx: Context, value: ValueOrExpr, locals: any[], special?: object): any {\n  if (isApplication(value)) {\n    const c = extend(ctx, { value: locals[0], special, fork: !ctx.locals });\n    let res: any;\n    if ('n' in value) {\n      const map = value.n.reduce((a, c, i) => (a[c] = locals[i], a), {} as ParameterMap);\n      c.locals = map;\n    }\n    res = evalValue(c, value.a);\n    return res;\n  } else {\n    const v = evalParse(extend(ctx, { value: locals[0], special, fork: !ctx.locals }), value);\n    if (isApplication(v)) return evalApply(ctx, v, locals, special);\n    else return v;\n  }\n}\n\nexport function evalParse(ctx: Context, expr: ValueOrExpr): any {\n  if (typeof expr === 'string') {\n    const p = ctx.parser || parse;\n    const ns = p.namespace || 'unknown';\n    const cache = ctx.root.exprs[ns] || (ctx.root.exprs[ns] = {});\n    expr = cache[expr] || (cache[expr] = p(expr));\n  }\n  if (typeof expr !== 'object') expr = { v: expr };\n  return evalValue(ctx, expr);\n}\n\nexport function evalValue(ctx: Context, expr: Value): any {\n  if (!expr) return expr;\n  if ('r' in expr) return safeGet(ctx, expr.r);\n  else if ('v' in expr) return expr.v;\n  else if ('op' in expr) return applyOperator(ctx, expr);\n  else if (isApplication(expr)) return expr;\n  else if (isDateRel(expr) || isTimespan(expr)) return expr;\n}\n\nconst opMap: { [key: string]: Operator } = {};\nexport function registerOperator(...ops: Operator[]) {\n  for (const op of ops) {\n    for (const name of op.names) opMap[name] = op;\n  }\n}\nexport function unregisterOperator(...ops: Operator[]) {\n  for (const op of ops) {\n    for (const name of op.names) delete opMap[name];\n  }\n}\nexport function getOperatorMap(): { [key: string]: Operator } {\n  return Object.assign({}, opMap);\n}\nexport function getOperator<T extends Operator = Operator>(name: string): T {\n  return opMap[name] as T;\n}\n\nconst _defaultGetValue = (c: Context, b: ValueOrExpr, v: any) => evalApply(c, b, [v]);\nexport function sort(context: Context, arr: any[], sorts: Sort[]|ValueOrExpr, getValue?: (context: Context, by: ValueOrExpr, v: any) => any): any[] {\n  let sortArr: Sort[];\n  \n  if (Array.isArray(sorts)) {\n    sortArr = sorts;\n  } else if (isApplication(sorts)) {\n    sortArr = [sorts];\n  } else if (typeof sorts === 'object' && sorts && 'by' in sorts) {\n    sortArr = [sorts];\n  } else {\n    const s = evalParse(context, sorts);\n    if (Array.isArray(s)) sortArr = s;\n    else if (typeof s === 'string') sortArr = [{ v: s }];\n    else if (typeof sorts === 'string') sortArr = [sorts]\n  }\n\n  if (sortArr) {\n    let el: any;\n    for (let i = 0; i < sortArr.length; i++) {\n      el = sortArr[i];\n      const by = isLiteral(el) ? el.v : el;\n      if (typeof by === 'string') {\n        if (by[0] === '-') sortArr[i] = { by: by.slice(1), desc: true };\n        else sortArr[i] = { by: by[0] === '+' ? by.slice(1) : by, desc: false };\n      }\n    }\n  }\n\n  getValue = getValue || _defaultGetValue;\n  if (sortArr && sortArr.length) {\n    const dirs = sortArr.map(s => {\n      if (typeof s === 'object') {\n        if ('by' in s) {\n          if ('desc' in s) {\n            if (typeof s.desc === 'boolean') return s.desc;\n            return evalParse(context, s.desc);\n          } else if ('dir' in s) {\n            const lower = typeof s.dir === 'string' ? s.dir.toLowerCase() : s.dir;\n            const dir = lower === 'asc' || lower === 'desc' ? lower : evalParse(context, s.dir);\n            const val = typeof dir === 'string' ? dir.toLowerCase() : dir;\n            if (val === 'desc') return true;\n          }\n        }\n      }\n      // default to asc\n      return false;\n    });\n\n    arr.sort((a, b) => {\n      for (let i = 0; i < sortArr.length; i++) {\n        const s = sortArr[i];\n        const desc = dirs[i];\n        const by: ValueOrExpr = typeof s === 'string' ? s : s && (s as any).by ? (s as any).by : s;\n        const l = getValue(context, by, a);\n        const r = getValue(context, by, b);\n        const cmp = l == null && r != null ? -1 \n          : l != null && r == null ? 1\n          : (l < r) === (r < l) ? 0\n          : l < r ? -1\n          : l > r ? 1\n          : 0;\n        if (cmp) return (desc ? -1 : 1) * cmp;\n      }\n      return 0;\n    });\n  }\n\n  return arr;\n}\n\nexport function filter(arr: any[], filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): any[];\nexport function filter(ds: DataSet, filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): DataSet;\nexport function filter(ds: DataSet|any[], filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): DataSet|any[] {\n  const _ds = Array.isArray(ds) ? { value: ds } : ds;\n  if (!_ds || !Array.isArray(_ds.value)) return _ds;\n  let _context: Context;\n  if (!context) _context = new Root(_ds.value, { special: { source: _ds } });\n  else if (isContext(context)) _context = extend(context, { special: { source: _ds.value } });\n  else _context = new Root(context);\n  const values = filter ? [] : _ds.value.slice();\n\n  if (filter) {\n    let flt: Value = typeof filter === 'string' ? parse(filter) : filter;\n    if ('m' in flt) flt = { v: true };\n    _ds.value.forEach((row, index) => {\n      if (!!evalApply(extend(_context, { value: row, special: { value: row, index } }), flt, [row, index])) values.push(row);\n    });\n  }\n\n  if (sorts) sort(_context, values, sorts);\n\n  if (groups && !Array.isArray(groups)) groups = [groups];\n\n  if (Array.isArray(groups) && groups.length) {\n    return { value: { schema: _ds.schema, grouped: groups.length, level: 0, value: group(values, groups, _context, 1), all: values } };\n  }\n\n  if (Array.isArray(ds)) return values;\n  else return { schema: _ds.schema, value: values };\n}\n\ninterface GroupCache {\n  [group: string]: any[];\n}\n\nfunction group(arr: any[], groups: Array<ValueOrExpr>, ctx: Context, level: number = 0): Group[] {\n  const cache: GroupCache = {};\n  const res: Group[] = [];\n  const order: string[] = [];\n  for (const e of arr) {\n    const g = isApplication(groups[0]) ? `${evalApply(ctx, groups[0], [e])}` : `${evalParse(extend(ctx, { value: e }), groups[0])}`;\n    if (!cache[g]) {\n      order.push(g);\n      cache[g] = [];\n    }\n    cache[g].push(e);\n  }\n\n  for (const k of order) {\n    res.push({ group: k, grouped: groups.length - 1, value: groups.length > 1 ? group(cache[k], groups.slice(1), ctx, level + 1) : cache[k], all: cache[k], level });\n  }\n\n  return res;\n}\n\nfunction hasPipeRef(ref: Reference): boolean {\n  const path = getKeypath(ref);\n  return path.k[0] === '_' || path.p === '@' && path.k[0] === 'pipe';\n}\n\nexport function applyOperator(root: Context, operation: Operation): any {\n  const op = opMap[operation.op];\n\n  // if the operator doesn't exist, try a local, pipe, or skip\n  if (!op) {\n    const local = safeGet(root, operation.op) || safeGet(root.root, operation.op);\n    if (isApplication(local)) {\n      return evalApply(root, local, (operation.args || []).map(a => evalParse(root, a)));\n    } else if (operation.op === 'pipe') { // handle the special built-in pipe operator\n      if (!operation.args || !operation.args.length) return true;\n      let v = evalParse(root, operation.args[0]);\n      for (let i = 1; i < operation.args.length; i++) {\n        let a = operation.args[i];\n        if (isOperation(a) && (!a.args || !a.args.find(a => isReference(a) && hasPipeRef(a)))) a = Object.assign({}, a, { args: [{ r: { k: ['pipe'], p: '@' } } as ValueOrExpr].concat(a.args || []) });\n        \n        if (isApplication(a)) v = evalApply(root, a, [v]);\n        else v = evalParse(extend(root, { special: { pipe: v } }), a);\n      }\n      return v;\n    }\n    return true;\n  }\n\n  let args: any[];\n  if (op.type === 'checked') {\n    args = [];\n    const flts = operation.args || [];\n    const ctx = op.extend ? extend(root, {}) : root;\n    const opts = operation.opts ? evalParse(ctx, operation.opts) : undefined;\n    for (let i = 0; i < flts.length; i++) {\n      const a = flts[i];\n      const arg = evalParse(ctx, a);\n      const res = op.checkArg(operation.op, i, flts.length - 1, arg, opts, ctx, a);\n      if (res === 'continue') args.push(arg);\n      else if ('skip' in res) {\n        i += res.skip;\n        if ('value' in res) args.push(res.value);\n      } else if ('result' in res) return res.result;\n    }\n\n    return op.apply(operation.op, args, opts, ctx);\n  } else if (op.type === 'value') {\n    args = (operation.args || []).map(a => evalParse(root, a));\n    return op.apply(operation.op, args, operation.opts ? evalParse(root, operation.opts) : undefined, root);\n  } else {\n    let arr: any[];\n    const ctx = op.extend ? extend(root, {}) : root;\n    const args = (operation.args || []).slice();\n    const opts = operation.opts ? evalParse(ctx, operation.opts) : undefined;\n    let arg: any;\n    if (!op.value) {\n      arg = evalParse(ctx, args[0]);\n      if (Array.isArray(arg)) {\n        args.shift();\n        arr = arg;\n      } else if (typeof arg === 'object' && 'value' in arg && Array.isArray(arg.value)) {\n        args.shift();\n        arr = arg.value;\n      }\n      if (!arr) {\n        const src = evalValue(ctx, { r: '@source' });\n        if (Array.isArray(src)) arr = src;\n        else if (typeof src === 'object' && 'value' in src && Array.isArray(src.value)) arr = src.value;\n        else arr = [];\n      }\n    }\n    return op.apply(operation.op, Array.isArray(arr) ? arr : [], args, opts, ctx);\n  }\n}\n\nexport interface Keypath {\n  u?: number;\n  p?: '!'|'~'|'*'|'@';\n  k: Array<string|number|Value|ValueWithAnchor>;\n}\n\nexport function isKeypath(v: any): v is string|Keypath {\n  return typeof v === 'string' || (typeof v === 'object' && Array.isArray(v.k));\n}\n\nexport function isLiteral(v: any): v is Literal {\n  return typeof v === 'object' && 'v' in v;\n}\n\nexport function isReference(v: any): v is Reference {\n  return typeof v === 'object' && 'r' in v;\n}\n\nexport function isOperation(v: any): v is Operation {\n  return typeof v === 'object' && typeof v.op === 'string';\n}\n\nexport interface Reference { r: string|Keypath; c?: string[] };\nexport interface Application { a: Value; n?: string[]; c?: string[] };\nexport interface Literal { v: any; s?: 1; c?: string[]; q?: string };\n\nexport function isApplication(v: any): v is Application {\n  if (typeof v !== 'object' || !('a' in v) || typeof v.a !== 'object') return false;\n  const len = Object.keys(v).length;\n  return len === 1 || len === 2 && 'n' in v;\n}\n\n/** A timespan specified in milliseconds */\nexport interface DateRelSpanMS {\n  /** Starting point (now) */\n  f: 'n';\n  /** Offset in ms */\n  o: number;\n  /** Timezone offset */\n  z?: number;\n}\n/** A timespan specified in individual units years, months, days, hours, minutes, seconds, and/or milliseconds */\nexport interface DateRelSpanFull {\n  /** Starting point (now) */\n  f: 'n';\n  /** Offset array [years, months, days, hours, minutes, seconds, milliseconds] */\n  o: [number?, number?, number?, number?, number?, number?, number?];\n  /** Offset direction is before starting point */\n  d?: -1;\n  /** Timezone offset */\n  z?: number;\n}\nexport type DateRelSpan = DateRelSpanMS | DateRelSpanFull;\n\n/** A date span covering last|this|next day|week|month|year */\nexport interface DateRelRange {\n  /** Starting point (d: day, w: week, m: month, y: year) */\n  f: 'd'|'w'|'m'|'y';\n  /** Offset in units (-1: last, 0: this, 1: next) */\n  o: -1|0|1;\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n  /** Timezone offset */\n  z?: number;\n}\n/** A date span by time relative to yesterday, today, or tomorrow */\nexport interface DateRelTimeRange {\n  /** Starting point (day) */\n  f: 'd';\n  /** Offset in units (-1: yesterday, 0: today, 1: tomorrow) */\n  o: -1|0|1;\n  /** Time array [hour, minute, second, millisecond, timezone offset] */\n  t: [number, number?, number?, number?, number?];\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n}\n/** A date span covering this year, month, or week to the current date */\nexport interface DateRelToDate {\n  /** Starting point */\n  f: 'w'|'m'|'y';\n  /** Offset */\n  o: 0;\n  /** Relative to current date */\n  d: 1;\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n  /** Timezone offset */\n  z?: number;\n}\n/** A date range covering a specific range in time at most a year, optionally more specific by scoping farther\n * down with a month, date, hour, minute, second, and millisecond. It may also specify a timezone. */\nexport interface DateExactRange {\n  /** Starting point [year, month, date, hour, minute, second, millisecond, timezone] */\n  f: [number, number?, number?, number?, number?, number?, number?, number?];\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n}\nexport type DateRel = Date | DateRelSpan | DateRelRange | DateRelTimeRange | DateRelToDate | DateExactRange;\n\nexport type TimeSpan = number|TimeSpanMS|FullTimeSpan;\nexport interface TimeSpanMS {\n  ms: number;\n}\nexport interface FullTimeSpan {\n  s?: number;\n  d: [number?, number?, number?, number?, number?, number?, number?];\n}\n\nexport type ValueOrExpr = string|Value;\nexport type Value = Reference | Literal | Operation | Application | ParseError;\nexport type ValueWithAnchor = Value & { anchor?: 'start'|'end'; slice?: ValueWithAnchor };\n\nexport function isValueOrExpr(o: any): o is ValueOrExpr {\n  return typeof o === 'string' || isValue(o);\n}\n\nexport function isValue(o: any): o is Value {\n  return typeof o === 'object' && o && (\n    ('r' in o && typeof o.r === 'string') ||\n    ('op' in o && typeof o.op === 'string') ||\n    ('v' in o) ||\n    (isApplication(o))\n  );\n}\n\nexport type Parameter<T = any> = ParameterBase & T;\nexport interface ParameterBase {\n  name: string;\n  label?: string;\n  type?: Type;\n  required?: boolean;\n  refine?: string;\n  init?: ValueOrExpr;\n  options?: Array<string|{ label: string; value: any }>;\n}\n\nexport interface ParameterMap {\n  [name: string]: any;\n}\n\nexport function isContext(v: any): v is Context {\n  return typeof v === 'object' && typeof v.path === 'string' && typeof v.root == 'object' && 'value' in v && (typeof v.parent === 'object' || v.root === v);\n}\nexport interface Context {\n  path: string;\n  root: RootContext;\n  parent?: Context;\n  special?: ParameterMap;\n  locals?: ParameterMap;\n  value: any;\n  parser?: ((txt: string) => Value) & { namespace: string };\n}\n\nexport interface RootContext extends Context {\n  parameters: ParameterMap;\n  sources: SourceMap;\n  parent: undefined;\n  exprs: { [ns: string]: { [key: string]: Value } };\n  log: (...v: any[]) => void;\n}\n\nexport class Root implements RootContext {\n  value: any;\n  root: RootContext = this;\n  parameters: ParameterMap = {};\n  sources: SourceMap = {};\n  special: ParameterMap = {};\n  parent: undefined;\n  exprs = {} as { [ns: string]: { [key: string]: Value } };\n  parser?: ((txt: string) => Value) & { namespace: string };\n  path: '' = '';\n  log(v: any[]) {\n    console.log(...v);\n  }\n\n  constructor(root: any = {}, opts?: ExtendOptions & { parameters?: ParameterMap; log?: (...v: any[]) => void }) {\n    this.value = root;\n    if (opts) {\n      Object.assign(this.parameters, opts.parameters);\n      Object.assign(this.special, opts.special);\n      if (opts.parser) this.parser = opts.parser;\n      if (opts.log && typeof opts.log === 'function') this.log = opts.log;\n    }\n  }\n}\n\nexport function join(context: Context, path: string): Context {\n  return {\n    parent: context,\n    root: context.root,\n    path: context.path ? `${context.path}.${path}` : path,\n    value: safeGet(context, path)\n  };\n}\n\nexport interface ExtendOptions {\n  value?: any;\n  special?: any;\n  locals?: ParameterMap,\n  parser?: ((txt: string) => Value) & { namespace: string };\n  path?: string;\n  fork?: boolean;\n}\n\nexport function extend(context: Context, opts: ExtendOptions): Context {\n  return {\n    parent: opts.fork && (!opts.value || opts.value === context.value) ? (context.parent || context.root) : context,\n    root: context.root,\n    path: opts.path || '',\n    value: 'value' in opts ? opts.value : context.value,\n    special: opts.fork ? Object.assign({}, context.special, { pipe: undefined }, opts.special) : (opts.special || {}),\n    parser: opts.parser,\n    locals: opts.locals,\n  };\n}\n\nexport const formats: { [name: string]: { apply: (value: any, args?: any[], opts?: OperatorOptions) => string, defaults: { [key: string]: any } } } = {};\nexport const virtualFormats: { [name: string]: { defaults: { [key: string]: any } } } = {};\nexport function registerFormat<T = any>(name: string|string[], format: (value: T, args?: any[], opts?: OperatorOptions) => string, defaults: { [key: string]: any } = {}) {\n  if (Array.isArray(name)) name.forEach(n => formats[n] = { apply: format, defaults });\n  else formats[name] = { apply: format, defaults };\n}\nexport function unregisterFormat(name: string) {\n  delete formats[name];\n}\n\nexport function dateRelToRange(rel: DateRel): [Date, Date] {\n  if (rel instanceof Date) return [rel, rel];\n\n  let from = new Date();\n  let to: Date = 'd' in rel && rel.d ? new Date() : undefined;\n  from.setUTCFullYear(from.getFullYear(), from.getMonth(), from.getDate());\n  from.setUTCHours(0, 0, 0, 0);\n  let tz: number = 'z' in rel && rel.z != null ? rel.z : null;\n\n  if (rel.f === 'n') { // DateRelSpan (MS or Full)\n    from = typeof rel.o === 'number' ? new Date(+new Date() + rel.o) : dateAndTimespan(new Date(), { d: rel.o }, 'd' in rel ? rel.d : 1);\n    to = from;\n    tz = undefined;\n  } else if (rel.f === 'd') { // DateRelRange - day\n    from.setUTCDate(from.getUTCDate() + rel.o);\n    if (!to) to = new Date(from);\n    if ('t' in rel) { // DateRelTimeRange\n      const t = rel.t;\n      from.setUTCHours(t[0], t[1] || 0, t[2] || 0, t[3] || 0);\n      to.setUTCHours(t[0], t[1] == null ? 59 : t[1], t[2] == null ? 59 : t[2], t[3] == null ? 999 : t[3]);\n      if (t[4] != null) tz = t[4];\n    }\n  } else if (rel.f === 'w') { // DateRelRange - week\n    from.setUTCDate(from.getUTCDate() - (from.getUTCDay() + (rel.o === -1 ? 7 : rel.o === 1 ? -7 : 0)));\n    if (!to) {\n      to = new Date(from);\n      to.setDate(from.getUTCDate() + 6);\n    }\n    if ('z' in rel && rel.z != null) tz = rel.z;\n  } else if (rel.f === 'm') { // DateRelRange - month\n    from.setUTCDate(1);\n    from.setUTCMonth(from.getUTCMonth() + rel.o);\n    if (!to) {\n      to = new Date(from);\n      to.setUTCMonth(from.getUTCMonth() + 1);\n      to.setUTCDate(0);\n    }\n  } else if (rel.f === 'y') { // DateRelRange - year\n    from.setUTCDate(1);\n    from.setUTCMonth(0);\n    from.setUTCDate(1);\n    if (!to) {\n      to = new Date(from);\n      to.setUTCFullYear(from.getUTCFullYear() + 1);\n      to.setUTCDate(0);\n    }\n  } else if (Array.isArray(rel.f)) { // DateExactRange\n    const v = rel.f.slice();\n    from = new Date(Date.UTC(v[0], v[1] || 0, v[2] || 1, v[3] || 0, v[4] || 0, v[5] || 0, v[6] || 0));\n    for (let i = 1; i < 7; i++) {\n      if (v[i] == null) {\n        v[i - 1]++;\n        break;\n      }\n    }\n    if (v[6] != null) v[6]++;\n    to = new Date(Date.UTC(v[0], v[1] || 0, v[2] || 1, v[3] || 0, v[4] || 0, v[5] || 0, v[6] || 0));\n    to.setUTCMilliseconds(to.getUTCMilliseconds() - 1);\n    if (v[7] != null) tz = v[7];\n  }\n\n  if (rel.f === 'd' || rel.f === 'w' || rel.f === 'm' || rel.f === 'y') to.setUTCHours(23, 59, 59, 999);\n\n  if (tz !== undefined) {\n    if (tz != null) {\n      from.setUTCMinutes(from.getUTCMinutes() - tz);\n      if (from !== to) to.setUTCMinutes(to.getUTCMinutes() - tz);\n    } else { // shift to local time\n      const offset = from.getTimezoneOffset();\n      from.setUTCMinutes(from.getUTCMinutes() + offset);\n      if (from !== to) to.setUTCMinutes(to.getUTCMinutes() + offset);\n    }\n  }\n\n  return [from, to];\n}\n\nexport function isDateRel(v: any): v is DateRel {\n  return v && typeof v === 'object' && (('f' in v && (Array.isArray(v.f) || 'o' in v)) || v instanceof Date);\n}\n\nexport function isDateExactRange(v: any): v is DateExactRange {\n  return v && typeof v === 'object' && 'f' in v && Array.isArray(v.f);\n}\n\nexport function dateRelToDate(rel: DateRel): Date {\n  const range = dateRelToRange(rel);\n  if ('e' in rel && rel.e != null) return range[1];\n  else return range[0];\n}\n\nexport function dateRelToExactRange(rel: DateRel): DateExactRange {\n  if (!rel) return;\n  if (isDateExactRange(rel)) return rel;\n  const dt = dateRelToDate(rel);\n  const offset = dt.getTimezoneOffset();\n  const z = 'z' in rel && rel.z != null ? rel.z : 'f' in rel && rel.f === 'd' && 't' in rel && rel.t[4] != null ? rel.t[4] : null;\n  if (rel instanceof Date && z != null) dt.setMinutes(dt.getMinutes() - (offset + z));\n  return {\n    f: [dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours(), dt.getMinutes(), dt.getSeconds(), dt.getMilliseconds(), z != null ? z : -offset],\n  };\n}\n\nexport function isTimespan(v: any): v is TimeSpan {\n  return typeof v === 'number' || (typeof v === 'object' && Array.isArray(v.d)) || isTimespanMS(v);\n}\n\nexport function addTimespan(l: TimeSpan, r: TimeSpan): TimeSpan {\n  if (typeof l === 'number' && typeof r === 'number') return l + r;\n  else {\n    const res: TimeSpan = { d: [] };\n    if (typeof l === 'number') res.d[6] = l;\n    else if (isTimespanMS(l)) res.d[6] = l.ms;\n    else for (let i = 0; i < 7; i++) if (l.d[i]) res.d[i] = l.d[i];\n\n    if (typeof r === 'number') res.d[6] = (res.d[6] || 0) + r;\n    else if (isTimespanMS(r)) res.d[6] = (res.d[6] || 0) + r.ms;\n    else for (let i = 0; i < 7; i++) if (r.d[i]) res.d[i] = (res.d[i] || 0) + r.d[i];\n    return res;\n  }\n}\n\nexport function subtractTimespan(l: TimeSpan, r: TimeSpan): TimeSpan {\n  if (typeof l === 'number' && typeof r === 'number') return l - r;\n  else {\n    if (isTimespanMS(l)) l = l.ms;\n    if (isTimespanMS(r)) r = r.ms;\n    if (typeof l === 'number') {\n      const res = ({ d: (r as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      for (let i = 0; i < 7; i++) if (res.d[i]) res.d[i] = 0 - res.d[i];\n      res.d[6] = (res.d[6] || 0) + l;\n      return res;\n    } else if (typeof r === 'number') {\n      const res = ({ d: (l as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      res.d[6] = (res.d[6] || 0) - r;\n      return res;\n    } else {\n      const res = ({ d: (l as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      for (let i = 0; i < 7; i++) if (r.d[i]) l.d[i] = (l.d[i] || 0) - r.d[i];\n      return res;\n    }\n  }\n}\n\nexport function datesDiff(l: Date, r: Date): FullTimeSpan {\n  if (isNaN(+l) || isNaN(+r)) return { d: [] };\n  if (r < l) {\n    const s = r;\n    r = l;\n    l = s;\n  }\n  const a = new Date(l);\n  const b = r;\n  const res: FullTimeSpan = { d: [0, 0, 0, 0, 0, 0, 0], s: +a };\n  let num = b.getFullYear() - a.getFullYear() - 1;\n  let tmp1: number, tmp2: number;\n  if (num > 0) {\n    res.d[0] += num;\n    a.setFullYear(b.getFullYear() - 1);\n  }\n  a.setFullYear(a.getFullYear() + 1);\n  if (a > b) a.setFullYear(a.getFullYear() - 1);\n  else res.d[0]++;\n\n  // watch out for leap year\n  if (l.getMonth() === 1 && l.getDate() === 29 && a.getMonth() !== 1) {\n    a.setDate(29);\n    a.setMonth(1);\n  }\n\n  // jumping months can make days get weird\n  while (true) {\n    num = a.getDate();\n    tmp1 = a.getMonth();\n    tmp2 = a.getFullYear();\n    a.setDate(num + 1);\n    if (a.getMonth() !== tmp1) {\n      a.setDate(1);\n      a.setFullYear(tmp2);\n      a.setMonth(tmp1 + 2);\n      a.setDate(0);\n    } else {\n      a.setDate(num);\n      a.setMonth(tmp1 + 1);\n      if (tmp1 === 11 ? a.getMonth() !== 0 : a.getMonth() !== tmp1 + 1) {\n        a.setDate(1);\n        a.setFullYear(tmp2);\n        a.setMonth(tmp1 + 2);\n        a.setDate(0);\n      }\n    }\n    if (a > b) {\n      // make sure we stay in the correct year\n      a.setFullYear(tmp2);\n      a.setDate(1);\n      a.setMonth(tmp1);\n      a.setDate(num);\n      break;\n    } else res.d[1]++;\n  }\n\n  while (true) {\n    a.setDate(a.getDate() + 1);\n    if (a > b) {\n      a.setDate(a.getDate() - 1);\n      break;\n    } else res.d[2]++;\n  }\n\n  while (true) {\n    a.setHours(a.getHours() + 1);\n    if (a > b) {\n      a.setHours(a.getHours() - 1);\n      break;\n    } else res.d[3]++;\n  }\n\n  while (true) {\n    a.setMinutes(a.getMinutes() + 1);\n    if (a > b) {\n      a.setMinutes(a.getMinutes() - 1);\n      break;\n    } else res.d[4]++;\n  }\n\n  while (true) {\n    a.setSeconds(a.getSeconds() + 1);\n    if (a > b) {\n      a.setSeconds(a.getSeconds() - 1);\n      break;\n    } else res.d[5]++;\n  }\n\n  if (a.getMilliseconds() <= b.getMilliseconds()) res.d[6] = b.getMilliseconds() - a.getMilliseconds();\n  else res.d[6] = (1000 - a.getMilliseconds()) + b.getMilliseconds();\n\n  return res;\n}\n\nexport function dateAndTimespan(l: Date, r: TimeSpan, m: 1|-1): Date {\n  if (typeof r === 'number') return new Date(+l + r * m);\n  else if (isTimespanMS(r)) return new Date(+l + r.ms * m);\n  else {\n    let d = new Date(l);\n    if (r.d[0]) d.setFullYear(d.getFullYear() + r.d[0] * m);\n    if (r.d[1]) {\n      const dd = d.getDate();\n      d.setDate(1);\n      d.setMonth(d.getMonth() + r.d[1] * m);\n      const mm = d.getMonth();\n      d.setDate(dd);\n      if (mm !== d.getMonth()) d.setDate(0);\n    }\n    if (r.d[2]) d.setDate(d.getDate() + r.d[2] * m);\n    if (r.d[3]) d.setHours(d.getHours() + r.d[3] * m);\n    if (r.d[4]) d.setMinutes(d.getMinutes() + r.d[4] * m);\n    if (r.d[5]) d.setSeconds(d.getSeconds() + r.d[5] * m);\n    if (r.d[6]) d.setMilliseconds(d.getMilliseconds() + r.d[6] * m);\n    return d;\n  }\n}\n","import { Displayed, Placement } from '../report';\nimport { Context } from '../data/index';\n\nexport interface RenderContext {\n  parent?: RenderContext;\n  report: Displayed;\n  styles: StyleRegistry;\n  styleMap: StyleMap;\n  context: Context;\n  commit?: { [name: string]: any };\n}\n\nexport interface StyleRegistry {\n  [id: string]: string;\n}\n\ninterface StyleMap {\n  ids: { [id: string]: number };\n  styles: StyleRegistry;\n}\n\nexport function addStyle(context: RenderContext, id: string, style: string) {\n  if (!context.styles[id]) context.styles[id] = style;\n}\n\nexport function error(context: RenderContext, placement: Placement, message: string = 'Widget overflow error') {\n    addStyle(context, 'error', `.error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }`);\n    return { output: `<div class=\"error\" style=\"top: ${placement.y}rem;\">${message}</div>`, height: 2 };\n}\n","import { Displayed, Layout, Placement, Widget, Margin, MeasureFont, Computed, Borders } from '../report';\nimport { extend as extendContext, Context, ExtendOptions as ContextExtendOptions, evaluate, isValueOrExpr } from '../data/index';\nimport { error, RenderContext, addStyle } from './error';\n\nexport { RenderContext, error, addStyle } from './error';\n\nexport function isComputed(v: any): v is Computed {\n  return v && typeof v === 'object' && isValueOrExpr(v.x);\n}\n\nexport function maybeComputed<V, T = Exclude<V, Computed>>(v: V, context: RenderContext): T {\n  if (!isComputed(v)) return v as any;\n  else if (v.x) return evaluate(context, v.x);\n}\n\nexport interface ExtendOptions extends ContextExtendOptions {\n  commit?: { [key: string]: any };\n}\n\nexport function extend(context: RenderContext, opts: ExtendOptions): RenderContext {\n  return { parent: context, report: context.report, context: extendContext(context.context, opts), styles: context.styles, styleMap: context.styleMap, commit: opts.commit };\n}\n\nconst htmlChars = /[><&]/g;\nconst htmlReplace = { '<': '&lt;', '>': '&gt;', '&': '&amp;' };\nexport function escapeHTML(html: string): string {\n  return ('' + html).replace(htmlChars, m => htmlReplace[m] || '');\n}\n\nconst renderers: { [type: string]: Renderer } = {};\nexport function registerRenderer<T extends Widget = Widget, S = any>(type: string, renderer: ((widget: T, context: RenderContext, placement: Placement, state?: RenderState<S>) => RenderResult<S>) | Renderer<T, S>, options?: RendererOptions) {\n  renderers[type] = typeof renderer === 'function' ? { render: renderer } : renderer;\n  if (options) Object.assign(renderers[type], options);\n}\n\n/** Decent guesstimates for char width at 16px/em */\nconst avgs = {\n  sans: 7.4,\n  serif: 6.7,\n  mono: 7.85,\n  narrow: 5.9,\n}\n\n/** Text height measurement function for the given text, font, available width in rem, and line height in rem.\n * The text is assumed to be rendered as white-space: pre-wrap.\n */\nexport function measureEstimate(text: string, width: number, context: RenderContext, font?: MeasureFont): number {\n  const family = (font && maybeComputed(font.family, context)) || 'sans';\n  const size = (font && maybeComputed(font.size, context)) || 0.83;\n  const line = (font && maybeComputed(font.line, context)) || size;\n  const brw = font && 'break-word' in font ? font['break-word'] : true;\n  const avg = (((font && maybeComputed(font.metric, context)) || ((family === 'mono' || /fixed|mono/i.test(family) ? avgs.mono :\n    family === 'narrow' || /narrow|condensed/i.test(family) ? avgs.narrow :\n      family === 'sans' || /sans|arial|helvetica/i.test(family) ? avgs.sans :\n        avgs.serif))) * size) / 16;\n  \n  const lines = text.split(/\\r?\\n/g);\n  return lines.reduce((a, c) => {\n    const [word, lines] = c.split(/\\s|-/g).reduce((a, c) => {\n      const wlen = (c.length + 1) * avg;\n      if (a[0] + wlen > width) {\n        if (a[0] === 0 || wlen > width) {\n          if (brw) {\n            a[0] = (wlen - (width - a[0])) % width;\n            if (wlen > width) a[1] += Math.floor(wlen / width);\n          }\n          a[1]++;\n        } else {\n          a[0] = wlen;\n          a[1]++;\n        }\n      } else {\n        a[0] += wlen;\n      }\n      return a;\n    }, [0, 0]);\n    return a + ((lines + (word > 0 ? 1 : 0)) || 1);\n  }, 0) * line;\n}\n\n/** Text height measurement function for the given text, font, available width in rem, and line height in rem.\n * The text is assumed to be rendered as white-space: pre-wrap.\n */\nexport let measure: (text: string, width: number, context: RenderContext, font?: MeasureFont) => number = measureEstimate;\n\nexport interface RenderContinuation<T = any> {\n  output: string;\n  continue?: RenderState<T>;\n  height?: number;\n  width?: number;\n  cancel?: boolean;\n}\n\nexport type RenderResult<T = any> = string|RenderContinuation<T>;\n\nexport interface Renderer<T extends Widget = Widget, S = any> extends RendererOptions {\n  render(widget: T, context: RenderContext, placement: Placement, state?: RenderState<S>): RenderResult;\n}\n\nexport interface RendererOptions {\n  container?: boolean;\n}\n\nexport interface RenderState<T = any> {\n  child?: RenderState;\n  last?: number;\n  state?: T;\n  offset: number;\n  attempt?: number;\n}\n\n/** Render the given widget to string or a continuation using a registered renderer */\nexport function renderWidget(w: Widget, context: RenderContext, placement: Placement, state?: RenderState): RenderContinuation {\n  const renderer = renderers[w.type];\n  if (!renderer || (w.hide && evaluate(extendContext(context.context, { special: { widget: w, placement } }), w.hide))) return { output: '', height: 0 };\n\n  if (!('height' in w) && renderer.container) w.height = 'auto'; \n  const h = getHeightWithMargin(w, placement, context);\n\n  if (placement.maxY && !isNaN(h) && h > placement.maxY) return error(context, placement);\n\n  if (placement.availableY != null && h > placement.availableY) return { output: '', continue: { offset: 0 }, cancel: true };\n\n  let extraHeight = 0;\n\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    extraHeight += m[0] + m[2];\n    if (placement.availableY != null) placement.availableY -= m[0] + m[2];\n  }\n\n  if (w.border && !h && w.box === 'expand') {\n    const b = expandBorder(w, context, placement)\n    extraHeight += b[0] + b[2];\n    if (placement.availableY != null) placement.availableY -= b[0] + b[2];\n  }\n\n  const r = renderer.render(w, context, placement, state);\n  if (typeof r === 'string') return { output: r, height: h, width: getWidthWithMargin(w, placement, context) };\n\n  if (typeof r.height === 'number') r.height = +r.height.toFixed(6);\n  if (typeof r.width === 'number') r.width = +r.width.toFixed(6);\n  if (placement.availableY != null) placement.availableY = +placement.availableY.toFixed(6);\n  \n  if (placement.maxY && r.height > placement.maxY) return error(context, placement);\n\n  if (isNaN(h) && placement.availableY != null && r.height > placement.availableY) return { output: '', continue: { offset: 0 }, height: r.height || 0, cancel: true };\n\n  r.height = r.height || 0;\n\n  r.height += extraHeight;\n\n  r.height = +(r.height.toFixed(6));\n\n  return r;\n}\n\nconst layouts: { [name: string]: (widget: Widget, offset: number, margin: [number, number, number, number], placement: Placement, placements: Array<[number, number, number, number]>, context: RenderContext) => Placement } = {};\n\nexport function registerLayout(name: string, layout: (widget: Widget, offset: number, margin: [number, number, number, number], placement: Placement, placements: Array<[number, number, number, number]>, context: RenderContext) => Placement) {\n  layouts[name] = layout;\n}\n\nregisterLayout('row', (w, o, m, p, ps, context) => {\n  let n: Placement;\n  let br = isComputed(w.br) ? evaluate(extendContext(context.context, { special: { placement: p, widget: w } }), w.br.x) : w.br;\n  let availableX = p.maxX - ps[0][0] - ps[0][2] + ps[ps.length - 1][0];\n  if (availableX <= 0) {\n    availableX = p.maxX;\n    br = true;\n  }\n  if (br || ps[0][0] + ps[0][2] + getWidthWithMargin(w, { x: p.x, y: p.y, maxX: p.maxX, maxY: p.maxY, availableY: p.availableY, availableX }, context) - ps[ps.length - 1][0] > p.maxX) {\n    n = { x: m[3], y: maxYOffset(ps), availableX: p.maxX, maxX: p.maxX };\n    n.availableY = p.availableY - (n.y - o);\n  } else {\n    n = { x: ps[0][0] + ps[0][2], y: ps[0][1], availableX, maxX: p.maxX, availableY: p.availableY };\n  }\n\n  n.y -= o;\n\n  return n;\n});\n\n/** Render child widgets handling continuation across pages */\nexport function renderWidgets(widget: Widget, context: RenderContext, placement: Placement, state?: RenderState, layout?: Layout): RenderContinuation {\n  if (Array.isArray(widget.widgets)) {\n    let s = '';\n    const offset = (state || { offset: 0 }).offset;\n    const ps: Array<[number, number, number, number]> = [[0, offset, 0, 0]];\n\n    const m = expandMargin(widget, context, placement);\n    ps[0][0] += m[3];\n    ps[0][1] += m[0];\n\n    // placement starts with availableY shrunk for margins, so offset y by the top margin\n    const yo = m[0] || 0;\n\n    if (widget.border && widget.box === 'expand') {\n      const b = expandBorder(widget, context, placement);\n      if (placement.availableX != null) placement.availableX -= b[1] + b[3];\n      if (placement.availableY != null) placement.availableY -= b[0] + b[2];\n    }\n\n    for (let i = state && state.last || 0; i < widget.widgets.length; i++) {\n      let w: Widget = widget.widgets[i];\n      if (w.macro) w = expandMacro(w.macro, w, context, placement, state);\n      if (w.hide && evaluate(extendContext(context.context, { special: { widget: w, placement } }), w.hide)) continue;\n\n      // allow widgets that are taller than max height to be dropped\n      let h = placement && getHeightWithMargin(w, placement, context);\n      if (h > placement.maxY) h = 1;\n\n      if (placement && placement.availableY != null && h > placement.availableY) {\n        const offset = maxYOffset(ps);\n        state = state || { offset };\n        state.last = i;\n        return { output: s, continue: state, height: offset };\n      } else {\n        let lp = Array.isArray(layout) && (layout[i] || [0, 0]);\n        if (!lp || !Array.isArray(lp)) lp = [0, 0];\n        if (!lp[0]) lp[0] = 0;\n        if (!lp[1]) lp[1] = 0;\n        let p: Placement = Array.isArray(lp) ? { x: lp[0] < 0 ? lp[0] : lp[0] + m[3], y: lp[1] < 0 ? lp[1] : lp[1] + m[0], maxX: placement.maxX } : (lp || placement);\n        if (Array.isArray(lp)) p.availableX = p.maxX;\n\n        if (!layout || typeof layout === 'string') {\n          const l = layout ? layouts[layout as string] || layouts.row : layouts.row;\n          p = l(w, offset, m, placement, ps, context);\n          if (h > p.availableY) {\n            if (w.height === 'grow') h = getHeightWithMargin(w, p, context);\n            if (h > p.availableY) {\n              const offset = maxYOffset(ps);\n              state = state || { offset };\n              state.last = i;\n              return { output: s, continue: state, height: offset };\n            }\n          }\n        }\n\n        p.maxX = p.maxX || placement.maxX;\n        p.maxY = p.maxY || placement.maxY;\n\n        if (p.x < 0) {\n          p.offsetX = m[3];\n          p.x = (placement.availableX || 1) + p.x - getWidthWithMargin(w, placement, context) + 1;\n        }\n        if (p.y < 0) {\n          p.offsetY = m[0];\n          if (placement.availableY == null) p.y = 0;\n          else p.y = (placement.availableY || 1) + p.y - h + 1;\n        }\n\n        const { x, y } = p;\n        const r = renderWidget(w, context, p, state && state.child);\n\n        // skip empty output\n        if (typeof r === 'string' && !r || (!r.cancel && !r.output && !r.continue && !r.height)) continue;\n\n        if (typeof r === 'string') {\n          s += r;\n          ps.unshift([x, y, getWidthWithMargin(w, placement, context), getHeightWithMargin(w, placement, context)]);\n        } else {\n          if (r.cancel) return { output: '', cancel: true };\n          const h = r.height || getHeightWithMargin(w, placement, context) || 0;\n          if (y - yo + h > placement.availableY) {\n            const offset = maxYOffset(ps);\n            state = state || { offset };\n            state.last = i;\n            state.attempt = (+state.attempt || 0) + 1;\n            if (state.attempt > 1) return error(context, placement);\n            return { output: s, continue: state, height: offset };\n          }\n          s += r.output;\n          ps.unshift([x, y, r.width || getWidthWithMargin(w, placement, context), h]);\n          if (r.continue) {\n            state = state || { offset: 0 };\n            state.child = r.continue;\n            state.last = i;\n            state.offset = maxYOffset(ps);\n            return { output: s, continue: state, height: maxYOffset(ps), width: maxXOffset(ps) };\n          }\n        }\n\n        if (p.availableX === 0) ps[0][2] = p.maxX;\n      }\n    }\n\n    return { output: s, height: getHeightWithMargin(widget, placement, context) || maxYOffset(ps) - m[0], width: getWidthWithMargin(widget, placement, context) || maxXOffset(ps) - m[3] };\n  }\n  return { output: '', height: 0 };\n}\n\nexport function getWidth(w: Widget, placement: Placement, context: RenderContext): number {\n  let width = isComputed(w.width) ? evaluate(extendContext(context.context, { special: { widget: w, placement} }), w.width.x) : w.width;\n  const m = w.margin && expandMargin(w, context, placement);\n  let pct = false;\n  if (width === 'grow') width = placement.availableX || placement.maxX;\n  else if (!width && width !== 0) width = placement.maxX || 51;\n  else if (typeof width === 'number') width;\n  else {\n    width = +((width.percent / 100) * (placement.maxX || 51)).toFixed(4);\n    pct = true;\n  }\n  if (typeof width === 'number' && (w.box === 'contain' || (pct || width === placement.availableX) && w.box !== 'expand')) {\n    if (m) width -= m[1] + m[3];\n    else if (w.font && w.font.right) width -= w.font.right;\n  }\n  return width;\n}\n\nexport function getWidthWithMargin(w: Widget, placement: Placement, context: RenderContext): number {\n  let r = getWidth(w, placement, context);\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    r += m[1] + m[3];\n  } else if (w.font && w.font.right) {\n    r += w.font.right;\n  }\n  return r;\n}\n\nfunction maxFontSize(w: Widget) {\n  let n = w.height || 1;\n  if (w.font && w.font.size > n) n = w.font.size;\n  if ('text' in w && Array.isArray(w.text)) {\n    for (let i = 0; i < w.text.length; i++) {\n      const t = w.text[i];\n      if (typeof t === 'object' && 'font' in t && t.font && t.font.size > n) n = t.font.size;\n    }\n  }\n  return n;\n}\n\nexport function getHeight(w: Widget, placement: Placement, context: RenderContext, computed?: number, linesize?: boolean): number {\n  let r = 1;\n  let h = isComputed(w.height) ? evaluate(extendContext(context.context, { special: { widget: w, placement, computed, linesize } }), w.height.x) : w.height;\n  const m = w.margin && expandMargin(w, context, placement);\n  const b = w.border && expandBorder(w, context, placement);\n  let pct = false;\n  if (h == null && linesize) h = maxFontSize(w);\n\n  if (typeof h === 'number') r = h;\n  else if (h && typeof h === 'object' && 'percent' in h && h.percent && placement.maxY) {\n    r = +(placement.maxY * (h.percent / 100)).toFixed(4);\n    pct = true;\n  } else if (h === 'grow') {\n    r = placement.availableY || 0;\n  } else if (h === 'auto' || typeof h === 'string' || (h == null && w.type === 'container') || (computed && !h)) {\n    if (b && w.box === 'expand') return computed + b[0] + b[2] || NaN;\n    return computed || NaN;\n  }\n\n  if (typeof r === 'number' && (w.box === 'contain' || (pct || r === placement.availableY) && w.box !== 'expand')) {\n    if (m) r -= m[0] + m[2];\n  }\n\n  return r;\n}\n\nexport function getHeightWithMargin(w: Widget, placement: Placement, context: RenderContext, computed?: number, linesize?: boolean): number {\n  let h = getHeight(w, placement, context, computed, linesize);\n  if (typeof h === 'number' && w.margin) {\n    const m = expandMargin(w, context, placement);\n    h += m[0] + m[2];\n  }\n  return h;\n}\n\nfunction maxYOffset(points: Array<[number, number, number, number]>): number {\n  return points.reduce((a, c) => a > c[1] + c[3] ? a : c[1] + c[3], 0);\n}\n\nfunction maxXOffset(points: Array<[number, number, number, number]>): number {\n  return points.reduce((a, c) => a > c[0] + c[2] ? a : c[0] + c[2], 0);\n}\n\nexport function expandMargin(w: { margin?: Margin|Computed }, context: RenderContext, placement: Placement): [number, number, number, number] {\n  if (w.margin) {\n    const m = isComputed(w.margin) ? evaluate(extendContext(context.context, { special: { widget: w, placement} }), w.margin.x) : w.margin;\n    if (Array.isArray(m)) {\n      if (m.length === 4) return m.map(e => +e) as [number, number, number, number];\n      else if (m.length === 2) return [+m[0], +m[1], +m[0], +m[1]];\n    } else if (typeof m === 'number') return [m, m, m, m];\n  }\n\n  return [0, 0, 0, 0];\n}\n\nexport function expandBorder(w: { border?: number|number[]|Borders|string }, context: RenderContext, placement: Placement): [number, number, number, number] {\n  let b = w.border;\n  let res: [number, number, number, number] = [0, 0, 0, 0];\n  if (typeof b === 'string' || (b && !Array.isArray(b) && typeof b === 'object' && ('v' in b || 'r' in b || 'op' in b))) b = evaluate(extendContext(context.context, { special: { widget: w, placement } }), b as string);\n  if (typeof b === 'number') res = [0, 0, b, 0];\n  else if (Array.isArray(b)) {\n    if (b.length === 1) res = [b[0], b[0], b[0], b[0]];\n    else if (b.length === 2) res = [b[0], b[1], b[0], b[1]];\n    else if (b.length === 3) res = [b[0], b[1], b[2], b[1]];\n    else if (b.length >= 4) res = [b[0], b[1], b[2], b[3]];\n  } else if (b && typeof b === 'object') res = [b.top || 0, b.right || 0, b.bottom || 0, b.left || 0]\n\n  for (let i = 0; i < 4; i++) res[i] = res[i] * 0.0625;\n  return res;\n}\n\nexport function expandMacro(macro: string, w: Widget, ctx: RenderContext, placement: Placement, state: RenderState): Widget {\n  const res = evaluate(extendContext(ctx.context, { special: { widget: w, placement, state } }), macro);\n  const orig = w;\n  if (res && !Array.isArray(res) && typeof res === 'object') {\n    if ('content' in res || 'props' in res || 'properties' in res) w = Object.assign({}, w, res.props, res.properties, { widgets: Array.isArray(res.content) ? res.content : res.content ? [res.content] : w.widgets, macro: undefined });\n    else if ('replace' in res && res.replace && typeof res.replace === 'object' && 'type' in res.replace) return res.replace;\n    else w = Object.assign({}, w, { widgets: [res], macro: undefined });\n  } else if (Array.isArray(res)) w = Object.assign({}, w, { widgets: res, macro: undefined });\n  return w;\n}\n","import { Borders, Font, Placement, Widget } from '../report';\nimport { expandMargin, expandBorder, getHeightWithMargin, maybeComputed, getWidthWithMargin, RenderContext } from './index';\nimport { ValueOrExpr } from '../data/index';\n\nexport interface StyleOptions {\n  computedHeight?: number;\n  container?: boolean;\n  lineSize?: boolean;\n  font?: Font;\n}\n\nexport function nextStyleId(ctx: RenderContext, prefix: string): number {\n  if (!ctx.styleMap.ids[prefix]) ctx.styleMap.ids[prefix] = 0;\n  return ctx.styleMap.ids[prefix]++;\n}\n\nexport function mapStyle(ctx: RenderContext, style: string, prefix: string): string {\n  if (!style) return '';\n  const mapped = ctx.styleMap.styles[style];\n  if (mapped) return mapped;\n  const id = `${prefix}${nextStyleId(ctx, prefix)}`;\n  return ctx.styleMap.styles[style] = id;\n}\n\nexport function styleClass(ctx: RenderContext, cls: string[], [style, inline]: [string, string], inlineStyle?: string, classPrefix?: string): string {\n  if (ctx.report.classifyStyles !== false) {\n    const cs = [];\n    if (inline) cs.push(mapStyle(ctx, inline, 'h'));\n    cs.push(mapStyle(ctx, style, classPrefix || 's'));\n    return ` class=\"${cls.concat(cs).join(' ')}\"${inlineStyle ? ` style=\"${inlineStyle}\"` : ''}`;\n  } else {\n    const s = `${style}${inlineStyle || ''}${inline || ''}`;\n    const c = `${cls.length ? ` class=\"${cls.join(' ')}\"` : ''}`;\n    return `${c}${s ? ` style=\"${s}\"` : ''}`;\n  }\n}\n\nexport function style(w: Widget, placement: Placement, context: RenderContext, opts?: StyleOptions): [string, string] {\n  let s = `left:${(placement.x || 0) + (placement.offsetX || 0)}rem;top:${((placement.y || 0) + (placement.offsetY || 0))}rem;`;\n  let i = ``;\n\n  s += `width:${getWidthWithMargin(w, placement, context)}rem;`;\n\n  let h = getHeightWithMargin(w, placement, context, opts && opts.computedHeight, opts && opts.lineSize) || 1;\n  if (w.height === 'grow' && w.margin) {\n    const m = expandMargin(w, context, placement);\n    h += m[0] + m[2];\n  }\n  if (opts && opts.container && opts.computedHeight) i = `height:${h}rem;`;\n  else s += `height:${h}rem;`;\n\n  const line = w.font && maybeComputed(w.font.line, context);\n  const size = w.font && maybeComputed(w.font.size, context);\n  if (line != null || size != null) s += `line-height: ${line ?? size}rem;`;\n\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    if (m[0] || m[1] || m[2] || m[3]) s += `padding:${m[0]}rem ${m[1]}rem ${m[2]}rem ${m[3]}rem;`;\n  } else if (w.font && w.font.right) {\n    s += `padding-right:${w.font.right}rem;`;\n  }\n  \n  if ((opts && opts.font) || w.font) s += styleFont((opts && opts.font) || w.font, context);\n  if (w.border) s += styleBorder(w, context, placement);\n\n  s += styleExtra(w, context);\n\n  return [s, i];\n}\n\nexport function styleExtra(w: { bg?: ValueOrExpr; radius?: ValueOrExpr }, context: RenderContext): string {\n  let s = '';\n\n  const bg = maybeComputed(w.bg, context);\n  if (bg) s += `background-color:${bg};`;\n\n  const radius = maybeComputed(w.radius, context);\n  if (radius) s += `border-radius:${radius};`;\n\n  return s;\n}\n\nexport function styleFont(f: Font, context: RenderContext): string {\n  if (!f) return '';\n  let t: any;\n  let size: any;\n  let s = '';\n  if (t = maybeComputed(f.family, context)) s += `font-family:${t};`;\n  if (t = maybeComputed(f.color, context)) s += `color:${t};`;\n  if (t = maybeComputed(f.align, context)) s += `text-align:${t};`;\n  if (t = maybeComputed(f.size, context)) {\n    s += `font-size:${t}rem;`;\n    size = t;\n  }\n\n  t = maybeComputed(f.line, context);\n  if (t === 0) s += `line-height:initial;`;\n  else if (t != null) s += `line-height:${t}rem;`;\n  else if (size) s += `line-height:${size}rem;`;\n\n  if (t = maybeComputed(f.weight, context)) s += `font-weight:${t};`;\n  if (t = maybeComputed(f.pre, context)) s += `white-space:pre-wrap;word-break:break-word;`;\n  const pre = t;\n  if (t = maybeComputed(f.clamp, context)) s += `${pre ? '' : 'white-space:nowrap;'}overflow:hidden;`;\n  return s;\n}\n\nexport function styleBorder(w: { border?: number|Borders|number[]|string }, context: RenderContext, placement: Placement): string {\n  const b = expandBorder(w, context, placement);\n  if (b[0] + b[1] + b[2] + b[3]) return `border-style:solid;border-width:${b[0]}rem ${b[1]}rem ${b[2]}rem ${b[3]}rem;`;\n  return '';\n}\n\nexport function styleImage(fit?: string): [string, string] {\n  const s = `background-size:${!fit || fit === 'contain' ? 'contain;background-position:center' : fit === 'stretch' ? '100% 100%' : 'cover'};`;\n  \n  return [s, ''];\n}\n","import { Sort, ValueOrExpr, Parameter, ParameterMap, SourceMap, Root, Context, RootContext, extend, evaluate, filter, toDataSet } from './data/index';\n\nimport { renderWidget, RenderContext, RenderResult, RenderState, expandMargin, expandMacro } from './render/index';\nimport { styleClass, styleFont } from './render/style';\n\nimport { parse } from './data/parse';\nimport { parse as parseTemplate } from './data/parse/template';\n\nexport type ReportType = 'delimited'|'flow'|'page';\n\nexport type Report<T = {}> = Delimited<T> | Flow<T> | Page<T>;\n\nexport interface PartSource {\n  /** Filters to apply to the base value of the data source */\n  filter?: ValueOrExpr;\n  /** Sorts to apply to the base value of the data source */\n  sort?: Sort[]|ValueOrExpr;\n  /** Groupings to apply to the base data source */\n  group?: Array<ValueOrExpr>|ValueOrExpr;\n  /** An expression to apply to the base data source before filtering, sorting, or grouping */\n  base?: ValueOrExpr;\n  /** The name of the data source to be pulled from the root context */\n  source: string;\n}\n\nexport interface ReportSource extends PartSource {\n  /** The destination for the applied source, defaults to the source */\n  name?: string;\n  /** A user-friendly name for the source */\n  label?: string;\n  parameters?: { [name: string]: ValueOrExpr };\n}\n\ninterface BaseReport<T = {}> {\n  type: ReportType;\n  name?: string;\n  parameters?: Parameter<T>[];\n  sources?: ReportSource[];\n  /** An initial value for the root context. */\n  context?: ParameterMap;\n  /** An additional context expression to be merged with any fixed context just before the report is run. */\n  extraContext?: ValueOrExpr;\n  classifyStyles?: boolean;\n  defaultParams?: ParameterMap;\n}\n\n// delimited\nexport interface Delimited<T = {}> extends BaseReport<T> {\n  type: 'delimited';\n  source?: string;\n  fields: ValueOrExpr[];\n  headers?: ValueOrExpr[];\n  record?: string;\n  field?: string;\n  quote?: string;\n  rowContext?: ValueOrExpr;\n}\n\nexport interface Displayed<T = {}> extends BaseReport<T> {\n  widgets: Widget[];\n  font?: {\n    family?: string;\n    color?: string;\n    size?: number;\n    line?: number;\n  };\n  watermark?: Container;\n  overlay?: Container;\n}\n\n// flow\nexport interface Flow<T = {}> extends Displayed<T> {\n  type: 'flow';\n  width?: number;\n  margin?: Margin;\n  size?: PageSize;\n  orientation?: PageOrientation;\n}\n\n// page\nexport interface Page<T = {}> extends Displayed<T> {\n  type: 'page';\n  header?: Container & { outer?: boolean };\n  footer?: Container & { outer?: boolean };\n  size: PageSize;\n  orientation?: PageOrientation;\n  margin?: Margin;\n}\n\nexport type Dimension = number|{ percent: number };\n\nexport interface PageSize {\n  width: number;\n  height: number;\n  margin: [number, number];\n}\n\nexport type PageOrientation = 'portrait'|'landscape';\nexport const PageSizes: { [name: string]: PageSize } = {\n  letter: {\n    width: 51,\n    height: 66,\n    margin: [1.5, 1.5],\n  },\n  legal: {\n    width: 51,\n    height: 84,\n    margin: [1.5, 1.5],\n  },\n  tabloid: {\n    width: 66,\n    height: 102,\n    margin: [1.5, 1.5],\n  },\n  a4: {\n    width: 49.606302,\n    height: 70.15746,\n    margin: [1.5, 1.5],\n  }\n};\n\nexport function pageOffset(num: number, size: PageSize): number {\n  return num * size.height + size.margin[0];\n}\n\n// Attributes\nexport interface Font {\n  size?: number|Computed;\n  family?: string|Computed;\n  weight?: number|Computed;\n  color?: string|Computed;\n  align?: 'left'|'right'|'center'|'justify'|Computed;\n  line?: number|Computed;\n  right?: number;\n  pre?: boolean|Computed;\n  clamp?: boolean|Computed;\n}\n\nexport interface Placement {\n  x: number;\n  y: number;\n  availableX?: number;\n  availableY?: number;\n  maxX?: number;\n  maxY?: number;\n  offsetX?: number;\n  offsetY?: number;\n}\nexport type Layout = Array<[number, number]>|Placement[]|'row'|string;\n\nexport interface Borders {\n  top?: number;\n  left?: number;\n  bottom?: number;\n  right?: number;\n}\n\nexport interface Style {\n  font?: Font;\n  border?: number|Borders|number[]|string;\n}\n\nexport type Margin = number|[number, number]|[number, number, number, number];\n\nexport interface Computed {\n  x: ValueOrExpr;\n}\n\n// Widgets\nexport interface Widget extends Style {\n  type: string;\n  width?: Dimension|Computed|'grow'; // default 100%\n  height?: Dimension|'auto'|Computed|'grow'; // optional, defaulting to 1\n  margin?: Margin|Computed;\n  box?: 'expand'|'contain';\n  hide?: ValueOrExpr;\n  br?: boolean|Computed;\n  bg?: ValueOrExpr;\n  radius?: ValueOrExpr;\n\n  // container\n  widgets?: Widget[];\n  layout?: Layout;\n  context?: ValueOrExpr;\n  bridge?: boolean;\n  macro?: string;\n\n  // label\n  text?: ValueOrExpr|Array<ValueOrExpr|Span>;\n  format?: LabelFormat;\n  id?: string;\n  styled?: boolean;\n\n  // image\n  url?: ValueOrExpr;\n  fit?: 'cover'|'stretch'|Computed;\n\n  // html\n  html?: ValueOrExpr;\n\n  // repeater\n  source?: PartSource|ValueOrExpr;\n  header?: Container;\n  group?: Container[];\n  groupEnds?: boolean[];\n  groupHeaders?: boolean[];\n  row?: Container;\n  footer?: Container;\n  alternate?: Container;\n  headerPerPage?: boolean;\n\n  // repeater row\n  elide?: boolean|Computed;\n}\n\nexport interface Container extends Widget {\n  widgets: Widget[];\n  layout?: Layout;\n  context?: ValueOrExpr;\n  bridge?: boolean;\n  elide?: boolean|Computed;\n  macro?: string;\n}\n\nexport interface Image extends Widget {\n  url: ValueOrExpr;\n  fit?: 'cover'|'stretch'|Computed;\n}\n\nexport interface Span {\n  text: ValueOrExpr;\n  font?: Font;\n  bg?: ValueOrExpr;\n  radius?: ValueOrExpr;\n  id?: string;\n}\nexport interface LabelFormat {\n  name: string;\n  args?: ValueOrExpr[];\n}\nexport interface Label extends Widget {\n  text: ValueOrExpr|Array<ValueOrExpr|Span>;\n  format?: LabelFormat;\n  id?: string;\n  styled?: boolean;\n}\n\nexport interface HTML extends Widget {\n  html: ValueOrExpr;\n}\n\nexport interface Repeater extends Widget {\n  source: PartSource|ValueOrExpr;\n  header?: Container;\n  group?: Container[];\n  groupEnds?: boolean[];\n  groupHeaders?: boolean[];\n  row: Container;\n  footer?: Container;\n  alternate?: Container;\n  headerPerPage?: boolean;\n  headerRepeat?: number;\n}\n\nexport interface MeasureFont {\n  /** The font family for the label. The built-in estimator only works with sans, serif, narrow, and mono fonts, which should be relatively metric-compatible with Arial, Times New Roman, Arial Narrow, and, well, any fixed-width font. */\n  family?: 'sans'|'serif'|'narrow'|'mono'|string|Computed;\n  /** Font size in rem, where 1rem is 16px or 12pt based on the report html element style */\n  size?: number|Computed;\n  /** The line-height of the rendered font in rem */\n  line?: number|Computed;\n  /** Average width in px at font-size 16px. If this is supplied, it won't be guessed based on the font name. */\n  metric?: number|Computed;\n  /** Break words that exceed the line length */\n  'break-word'?: boolean;\n}\n\nexport interface MeasuredLabel extends Widget {\n  font?: MeasureFont;\n  text: ValueOrExpr;\n}\n\n// execution\ninterface ReportExtras {\n  /** Extra content to be rendered at the bottom of the <head> */\n  head?: string;\n  /** Extra content to be rendered at the bottom of the <body> */\n  foot?: string;\n  /** Run a delimited report to a table instead of using the defined delimiters */\n  table?: boolean;\n  /** Run a rendered report as a delimited report */\n  delimited?: boolean;\n  /** Record delimiter if running a rendered report as a delimited report */\n  record?: string;\n  /** Field delimiter if running a rendered report as a delimited report */\n  field?: string;\n  /** Field quoter if running a rendered report as a delimited report */\n  quote?: string;\n}\n\n/** Initialize a parameter map based on the parameters defined by the given report. */\nexport function initParameters(report: Report, sources: SourceMap, parameters?: ParameterMap|Root): ParameterMap {\n  const ctx = parameters && 'root' in parameters && parameters.root === parameters ? parameters as Root : new Root(Object.assign({}, report.context), { parameters });\n  ctx.parameters = Object.assign({}, report.defaultParams, ctx.parameters);\n  const inits: ParameterMap = {};\n\n  if (report.sources) applySources(ctx, report.sources, sources);\n\n  if (Array.isArray(report.parameters)) {\n    for (const p of report.parameters) {\n      if (p.init && p.name) {\n        inits[p.name] = evaluate(ctx, p.init);\n      }\n    }\n  }\n\n  return inits;\n}\n\n/** Run the given report to string. If the report is displayed, the result will be HTML. Otherwise, it will be plain text. */\nexport function run(report: Report, sources: SourceMap, parameters?: ParameterMap|Root, extra?: ReportExtras): string {\n  const ctx = parameters && 'root' in parameters && parameters.root === parameters ? parameters as Root : new Root(Object.assign({}, report.context), { parameters });\n\n  if (report.sources) applySources(ctx, report.sources, sources);\n  ctx.parameters = Object.assign({}, initParameters(report, sources), ctx.parameters);\n\n  if (report.extraContext) {\n    const res = evaluate(ctx, report.extraContext);\n    if (res && typeof res === 'object') ctx.value = Object.assign(ctx.value, res);\n  }\n\n  if (report.type === 'delimited') return runDelimited(report, ctx, { table: extra?.table });\n  else if (extra?.delimited) return runAsDelimited(report, ctx, extra);\n  else if (report.type === 'flow') return runFlow(report, ctx, extra);\n  else return runPage(report, ctx, extra);\n}\n\n/** Apply multiple sources to a context together. Each source base is available before filter/sort/group is applied in case a source needs to reference a later source for those purposes. */\nexport function applySources(context: RootContext, sources: ReportSource[], map: SourceMap) {\n  const srcs = context.sources;\n  for (const source of sources) {\n    let base = map[source.source || source.name] || { value: [] };\n    if (source.base) base = evaluate(extend(context, { value: base.value, special: { source: base } }), source.base);\n    srcs[source.name || source.source] = toDataSet(base);\n  }\n\n  for (const source of sources) {\n    if (source.filter || source.sort || source.group) srcs[source.name || source.source] = filter(srcs[source.name || source.source], source.filter, source.sort, source.group, context);\n  }\n}\n\nexport function applySource(context: RootContext, source: ReportSource, sources: SourceMap) {\n  let base = sources[source.source || source.name] || { value: [] };\n  if (source.base) base = { value: evaluate(extend(context, { value: base.value, special: { source: base } }), source.base) };\n  if (source.filter || source.sort || source.group) context.sources[source.name || source.source] = filter(base, source.filter, source.sort, source.group, context);\n  else context.sources[source.name || source.source] = toDataSet(base);\n}\n\nfunction runDelimited(report: Delimited, context: Context, options?: { table?: boolean }): string {\n  const source = context.root.sources[report.source ? report.source : (report.sources[0].name || report.sources[0].source)];\n  const values = Array.isArray(source.value) ?\n    source.value :\n    typeof source.value === 'object' && 'grouped' in source.value && Array.isArray(source.value.all) ? // watch out for grouped sources\n      source.value.all :\n      [source.value];\n  let fields = report.fields;\n  let headers = report.headers;\n\n  if ((!fields || !fields.length) && values.length && typeof values[0] === 'object' && values[0]) {\n    fields = Object.keys(values[0]);\n    if (Array.isArray(values[0])) fields = fields.map(i => `_.${i}`);\n    else if (!headers || !headers.length) headers = Object.keys(values[0]);\n  }\n\n  if (!fields) fields = [];\n\n  let res = '';\n  if (headers) {\n    const ctx = extend(context, { parser: parseTemplate });\n    if (options?.table) res += `<thead><tr><th class=index></th>${headers.map(h => `<th>${evaluate(ctx, h)}</th>`).join('')}</tr></thead>`;\n    else res += headers.map(h => `${report.quote || ''}${evaluate(ctx, h)}${report.quote || ''}`).join(report.field || ',') + (report.record || '\\n');\n  }\n\n  if (options?.table) {\n    res += '<tbody>'\n    let idx = 1;\n    for (const value of values) {\n      const c = extend(context, { value, special: { index: idx - 1 } });\n      if (report.rowContext) {\n        if (!c.locals) c.locals = {};\n        const v = evaluate(c, report.rowContext);\n        if (v) c.value = v;\n      }\n      res += `<tr><th class=index>${idx}</th>${fields.map(f => {\n        let val = f ? evaluate(c, f) : '';\n        if (val === undefined) val = '';\n        if (typeof val !== 'string') {\n          const v = val;\n          val = `${v}`;\n          if (val.slice(0, 7) === '[object') val = JSON.stringify(v);\n        }\n        return `<td>${val}</td>`;\n      }).join('')}</tr>`;\n      idx++;\n    }\n    res += '</tbody>';\n    res = `<table>${res}</table>`;\n  } else {\n    const unquote: RegExp = report.quote ? new RegExp(report.quote, 'g') : undefined;\n    let index = 0;\n    for (const value of values) {\n      const c = extend(context, { value, special: { index } });\n      if (report.rowContext) {\n        if (!c.locals) c.locals = {};\n        const v = evaluate(c, report.rowContext);\n        if (v) c.value = v;\n      }\n      res += fields.map(f => {\n        let val = f ? evaluate(c, f) : '';\n        if (val === undefined) val = '';\n        if (typeof val !== 'string') {\n          const v = val;\n          val = `${v}`;\n          if (val.slice(0, 7) === '[object') val = JSON.stringify(v);\n        }\n        if (unquote) val = val.replace(unquote, report.quote + report.quote);\n        return `${report.quote || ''}${val}${report.quote || ''}`;\n      }).join(report.field || ',') + (report.record || '\\n');\n      index++;\n    }\n  }\n\n  return res;\n}\n\nfunction runPage(report: Page, context: Context, extras?: ReportExtras): string {\n  let size: PageSize = report.orientation !== 'portrait' ? { width: report.size.height, height: report.size.width, margin: [report.size.margin[1], report.size.margin[0]] } : report.size;\n\n  const ctx: RenderContext = { context, report, styles: {}, styleMap: { ids: {}, styles: {} } };\n  const margin = expandMargin(report, ctx, { x: 0, y: 0 });\n  context.special = context.special || {};\n  context.special.page = 0;\n  context.special.pages = 0;\n\n  const pages: string[] = [''];\n  let page = 0;\n  const printX = size.width - 2 * size.margin[1];\n  const printY = size.height - 2 * size.margin[0];\n  let availableY = printY - margin[0] - margin[2];\n  const pageY = availableY;\n  let maxY = availableY;\n  let y = 0;\n  const availableX = printX - margin[1] - margin[3];\n  let state: RenderState<any> = null;\n\n  let headSize = 0;\n  if (report.header) {\n    const r = renderWidget(report.header, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY });\n    headSize = r.height;\n    if (!report.header?.outer) {\n      availableY -= headSize;\n      maxY -= headSize;\n      y += headSize;\n    }\n  }\n\n  let footSize = 0;\n  if (report.footer) {\n    const r = renderWidget(report.footer, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY });\n    footSize = r.height;\n    if (!report.footer?.outer) {\n      availableY -= footSize;\n      maxY -= footSize;\n    }\n  }\n\n  for (let w of report.widgets || []) {\n    if (w.macro) w = expandMacro(w.macro, w, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY }, state);\n    let r: RenderResult;\n    do {\n      context.special.page = page + 1;\n      r = renderWidget(w, ctx, { x: 0, y, availableX, availableY, maxX: availableX, maxY }, state);\n      pages[page] += r.output;\n      if (r.continue) {\n        page++;\n        pages[page] = '';\n        y = report.header?.outer ? 0 : headSize;\n        availableY = printY - (report.header?.outer ? 0 : headSize) - (report.footer?.outer ? 0 : footSize) - margin[0] - margin[2];\n        state = r.continue;\n      } else {\n        y += r.height;\n        availableY -= r.height;\n        state = null;\n      }\n    } while (state !== null)\n  }\n\n  context.special.pages = pages.length;\n  const footPlace = report.footer?.outer ?\n    { x: 0, y: printY - footSize, maxX: printX, maxY: printY } :\n    { x: 0 + margin[3], y: printY - margin[0] - footSize, maxX: printX - margin[3] - margin[1], maxY: printY - margin[0] - margin[2] };\n  const headPlace = report.header?.outer ?\n    { x: 0, y: 0, maxX: printX, maxY: printY } :\n    { x: 0 + margin[3], y: margin[0], maxX: printX - margin[3] - margin[1], maxY: printY - margin[0] - margin[2] };\n\n  context.special.size = { x: availableX, y: pageY };\n  pages.forEach((p, i) => {\n    let n = `<div class=\"page-back pb${i}\"><div${styleClass(ctx, ['page', `ps${i}`], ['', ''], '', 'p')}>\\n`;\n    context.special.page = i + 1;\n    if (report.watermark) {\n      const r = renderWidget(report.watermark, ctx, { x: 0, y: 0, maxX: printX, availableX: printX, maxY: printY, availableY: printY });\n      n += r.output + '\\n';\n    }\n    if (report.header) {\n      const r = renderWidget(report.header, ctx, headPlace);\n      n += r.output + '\\n';\n    }\n    n += `<div class=\"page-inner\">${p}</div>`;\n    if (report.footer) {\n      const r = renderWidget(report.footer, ctx, footPlace);\n      n += r.output + '\\n';\n    }\n    if (report.overlay) {\n      const r = renderWidget(report.overlay, ctx, { x: 0, y: 0, maxX: printX, availableX: printX, maxY: printY, availableY: printY });\n      n += r.output + '\\n';\n    }\n    n += '\\n</div></div>';\n    pages[i] = n;\n  });\n\n  return `<html style=\"font-size:100%;margin:0;padding:0;\"><head><style>\n    .page { width: ${printX}rem; height: ${printY}rem; position: absolute; overflow: hidden; left: ${size.margin[1]}rem; top: ${size.margin[0]}rem; ${report.font ? styleFont(report.font, ctx) : ''} }\n    .page-inner { position: absolute; width: ${printX - margin[1] - margin[3]}rem; height: ${printY - margin[0] - margin[2]}rem; left: ${margin[3]}rem; top: ${margin[0]}rem; }\n    .page-back { width: ${size.width}rem; height: ${size.height}rem; }\n    body { font-size: 0.83rem; }\n    @media screen {\n      html { min-width: ${size.width + 2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { margin: 0; padding: 0; ${size ? `width:${size.width}rem;` : ''}background-color: none; display: block; height: ${pages.length * size.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${pages.map((_p, i) => `.pb${i} { top: ${i * size.height}rem; }`).join('')}\n    }\n    @page {\n      size: ${size.width}em ${size.height}em;\n    }${Object.entries(ctx.styles).map(([_k, v]) => v).join('\\n')}${Object.entries(ctx.styleMap.styles).map(([style, id]) => `.${id} { ${style} }`).join('\\n')}\n  </style>${extras && extras.head || ''}</head><body>\\n${pages.reduce((a, c) => a + c, '')}${extras && extras.foot || ''}</body></html>`;\n}\n\nfunction runFlow(report: Flow, context: Context, extras?: ReportExtras): string {\n  const ctx: RenderContext = { context, report, styles: {}, styleMap: { ids: {}, styles: {} } };\n  let html = '';\n  let y = 0;\n  let state: RenderState<any> = null;\n\n  let width: number;\n\n  if (report.width) width = report.width;\n  else if (report.size) width = report.orientation !== 'portrait' ? report.size.height : report.size.width;\n\n  let margin: [number, number, number, number];\n  if (report.margin != null) margin = expandMargin(report, ctx, { x: 0, y: 0, availableX: width, maxX: width });\n  if (!margin && report.size && report.size.margin) margin = expandMargin(report.size, ctx, { x: 0, y: 0, availableX: width, maxX: width });\n  if (!margin) margin = [0, 0, 0, 0];\n\n  // account for margins\n  if (width) width -= (margin[1] || 0) + (margin[3] || 0);\n\n  function render(w: Widget, cls: string) {\n    html += `<div${styleClass(ctx, cls ? [cls] : [], [`position:absolute;right:0rem;left:0rem;${width ? `width:${width}rem;` : ''}`, ''], `top:${y}rem;`, 'p')}>\\n`;\n    let r: RenderResult;\n    let yy = 0;\n    do {\n      r = renderWidget(w, ctx, { x: 0, y: yy, availableX: width, maxX: width }, state);\n      if (typeof r === 'string') throw new Error(`Container widget didn't specify used height`);\n      else {\n        html += r.output;\n        yy += r.height;\n        if (r.continue) {\n          state = r.continue;\n        } else {\n          state = null;\n        }\n      }\n    } while (state !== null)\n    y += yy;\n    html += `</div>\\n`;\n  }\n\n  if (report.watermark) render(report.watermark, 'watermark');\n  let maxY = y || 0;\n  y = 0;\n  for (const w of report.widgets || []) render(w, 'main');\n  if (y > maxY) maxY = y;\n  y = 0;\n  if (report.overlay) render(report.overlay, 'overlay');\n  if (y > maxY) maxY = y;\n\n  return `<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${width ? ` width: ${width}rem;` : ''}; height: ${maxY}rem; position: relative; }\n    .page-back { ${width ? `width: ${width}rem; ` : 'width: 100%; box-sizing: border-box; '}padding: ${margin[0] || 0}rem ${margin[1] || 0}rem ${margin[2] || 0}rem ${margin[3] || 0}rem; position: absolute; left: 0; top: 0; }\n    #wrapper { height:${maxY}rem; position: relative; ${report.font ? styleFont(report.font, ctx) : ''} }\n    .watermark { z-index: 0; }\n    .main { z-index: 5; }\n    .overlay { z-index: 10; }\n    @media screen {\n      body { margin: 1rem${width ? ' auto' : ''}; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${margin[0]}rem ${margin[1]}rem ${margin[2]}rem ${margin[3]}rem !important; }\n    }${Object.entries(ctx.styles).map(([_k, v]) => v).join('\\n')}${Object.entries(ctx.styleMap.styles).map(([style, id]) => `.${id} { ${style} }`).join('\\n')}\n  </style>${extras && extras.head || ''}</head><body>\\n<div class=page-back><div id=wrapper>${html}</div></div>${extras && extras.foot || ''}</body></html>`;\n}\n\nfunction findWidgets(from: Widget, type: string, first?: boolean, results?: Widget[]): Widget[] {\n  results = results || [];\n  if (from.type === type) results.push(from);\n  if (first && results.length) return results;\n  if (from.widgets) for (const w of from.widgets) findWidgets(w, type, first, results);\n  return results;\n}\n\n// TODO: this could try harder to carry context forward and use non-named sources if it seems necessary\nfunction runAsDelimited(report: Flow|Page, context: RootContext, extra?: ReportExtras): string {\n  const [repeater] = findWidgets({ type: 'container', widgets: report.widgets }, 'repeater', true) as Repeater[];\n  if (repeater && typeof (repeater?.source as any)?.source === 'string') {\n    let headers: ValueOrExpr[];\n    let fields: ValueOrExpr[];\n    const rowContext = repeater.row.context;\n\n    if (repeater.header) {\n      const labels = findWidgets(repeater.header, 'label') as Label[];\n      headers = labels.map(l => typeof l.text === 'string' ? parse(l.text) : l.text) as ValueOrExpr[];\n    }\n\n    fields = (findWidgets(repeater.row, 'label') as Label[]).map(l => l.text) as ValueOrExpr[];\n\n    const source = '_tmp';\n    if (typeof repeater.source === 'object') {\n      const src = repeater.source;\n      let data;\n      if ('source' in src) {\n        const s = src as ReportSource;\n        let base = context.sources[s.source] || { value: [] };\n        if (s.base) base = { value: evaluate(extend(context, { value: base.value, special: { source: base } }), s.base) };\n        if (s.filter || s.sort || s.group) base = filter(base, s.filter, s.sort, s.group, context);\n        data = toDataSet(base);\n      } else data = toDataSet(evaluate(context, src));\n      context.sources._tmp = data;\n    }\n\n    return runDelimited(Object.assign({ type: 'delimited', headers, fields, source, rowContext }, extra) as Delimited, context, extra?.table ? { table: true } : {});\n  }\n  return '';\n}\n","import { Parser, parser as makeParser, opt, rep1sep, seq, alt, map, readTo, read1To, rep1, rep, str, read, read1, chars } from 'sprunge';\n\ntype Style = BoolStyle | ValueStyle<any>;\ninterface BoolStyle {\n  tag: string;\n}\ninterface ValueStyle<T> {\n  tag: string;\n  value: T|null;\n}\n\n// zero width space\nconst zwsp = '&#8203;';\n\nconst sp = read1(' \\r\\n\\t');\nconst ws = read(' \\r\\n\\t');\nconst hex = '0123456789abcdef';\nconst integer = map(read1('0123456789'), v => +v);\nconst number = map(seq(opt(str('-')), read1('0123456789'), opt(seq(str('.'), read1('0123456789')))), ([m, n, d]) => +[m, n, d?.[0], d?.[1]].filter(v => v).join(''));\nconst color = map(seq(opt(str('#')), alt(chars(8, hex), chars(6, hex), chars(4, hex), chars(3, hex))), ([, color]) => `#${color}`);\nconst remOrPercent = map(seq(number, opt(str('%'))), ([n, p]) => `${n}${p ? '%' : 'rem'}`);\nconst places = str('left', 'right', 'top', 'bottom', 'center');\n\nconst align = map(seq(str('align'), opt(seq(str('='), alt(\n  seq(str('top', 'middle', 'bottom', 'base'), opt(seq(sp, str('left', 'right', 'center')))),\n  seq(str('left', 'right', 'center'), opt(seq(sp, str('top', 'middle', 'bottom', 'base'))))\n)))), ([,v]) => ({ tag: 'align', value: v ? [v[1][0], v[1][1]?.[1]].filter(v => v) : null }));\nconst valign = map(seq(str('valign'), opt(seq(str('='), str('top', 'middle', 'bottom', 'base')))), ([, v]) => ({ tag: 'valign', value: v ? v[1] : null }));\n\nconst pad = map(seq(str('pad'), opt(seq(str('='), rep1sep(number, sp)))), ([, v]) => ({ tag: 'pad', value: v ? v[1] : null }));\nconst margin = map(seq(str('margin'), opt(seq(str('='), rep1sep(number, sp)))), ([, v]) => ({ tag: 'margin', value: v ? v[1] : null }));\nconst width = map(seq(str('width', 'w'), opt(seq(str('='), remOrPercent))), ([,v]) => ({ tag: 'width', value: v ? v[1] : null }));\nconst height = map(seq(str('height', 'h'), opt(seq(str('='), remOrPercent))), ([,v]) => ({ tag: 'height', value: v ? v[1] : null }));\nconst line = map(seq(str('line'), opt(seq(str('='), number))), ([,v]) => ({ tag: 'line', value: v ? v[1] : null }));\nconst fg = map(seq(str('fg', 'color', 'fore'), opt(seq(str('='), color))), ([,v]) => ({ tag: 'fg', value: v ? v[1] : null }));\nconst bg = map(seq(str('bg', 'background', 'back'), opt(seq(str('='), color))), ([,v]) => ({ tag: 'bg', value: v ? v[1] : null }));\nconst size = map(seq(str('size'), opt(seq(str('='), number))), ([,v]) => ({ tag: 'size', value: v ? v[1] : null }));\nconst font = map(seq(str('font'), opt(seq(str('='), read1To(',|')))), ([,v]) => ({ tag: 'font', value: v ? v[1] : null }));\nconst rotate = map(seq(str('rotate'), opt(seq(str('='), number, ws, opt(str('left', 'right')), opt(seq(sp, alt(remOrPercent, places), sp, alt(remOrPercent, places)))))), ([,v]) => ({ tag: 'rotate', value: v ? { turn: v[1] * (v[3] === 'left' ? -1 : 1), origin: v[4] ? [v[4][1], v[4][3]] : undefined } : null }));\nconst move = map(seq(str('move'), opt(seq(str('='), remOrPercent, sp, remOrPercent))), ([,v]) => ({ tag: 'move', value: v ? { x: v[1], y: v[3] } : null }));\n\nconst trash = map(readTo(',|'), v => ({ tag: 'trash', value: v }));\n\nconst border = map(seq(\n  str('border'), opt(seq(str('='),opt(str('solid', 'dot', 'dash', 'double')), ws,\n  rep1sep(integer, sp), ws, opt(seq(str('/'), ws, rep1sep(number, sp))), ws, opt(color),\n  ))), ([, v]) => ({ tag: 'border', value: v ? { style: v[1] || 'solid', width: v[3], radius: v[5]?.[2], color: v[7] } : null }));\n\nconst bools = map(alt(str('sub', 'sup', 'bold', 'italic', 'underline', 'strike', 'overline', 'overflow', 'nowrap', 'pre', 'br', 'b', 'i', 'u')), tag => ({ tag }));\n\nconst tag: Parser<Style[]> = map(seq(str('|'), ws, rep1sep(alt(border, align, fg, bg, valign, size, line, font, pad, margin, width, height, bools, rotate, move, trash), seq(ws, str(','), ws), 'allow'), readTo('|'), str('|')), ([, , tags]) => tags.filter(t => t.tag !== 'trash'));\nconst text = map(rep1(alt(read1To('\\\\|', true), map(str('\\\\|'), () => '|'))), txts => txts.join(''));\n\nconst all = rep(alt<Style[]|string>(text, tag))\n\nconst parser = makeParser(all, { consumeAll: true, undefinedOnError: true });\n\ninterface State {\n  bool: { [key: string]: boolean }\n  value: { [key: string]: any[] }\n}\n\nconst blocks = ['border', 'width', 'height', 'pad', 'margin', 'align', 'overflow', 'nowrap', 'rotate', 'move'];\n\nconst aliases = {\n  b: 'bold',\n  i: 'italic',\n  u: 'underline',\n}\n\nfunction process(stuff: Array<Style[]|string>): string {\n  let res = '';\n  let open = false;\n  const state: State = { bool: {}, value: {} };\n  const blockstack: string[][] = [];\n  for (const s of stuff) {\n    if (typeof s === 'string') {\n      if (!state.bool.pre && /^\\s/.test(s)) res += zwsp;\n      res += s;\n      if (!state.bool.pre && /\\s$/.test(s)) res += zwsp;\n    } else {\n      let drop = false;\n      let block: string[];\n      for (const style of s) {\n        const tag = aliases[style.tag] || style.tag;\n        if ('value' in style) {\n          if (style.value !== null) {\n            (state.value[tag] || (state.value[tag] = [])).push(style.value);\n            if (blocks.includes(tag) || block && tag === 'bg') (block || (block = [])).push(tag);\n          } else {\n            if (blocks.includes(tag)) drop = true;\n            else if (tag === 'bg' && (drop || blockstack && blockstack.length && blockstack[blockstack.length - 1].includes('bg'))) drop = true;\n            else (state.value[tag] || (state.value[tag] = [])).pop();\n          }\n        } else {\n          if (tag === 'br') res += '<br/>';\n          else if (blocks.includes(tag) && block.length) block.push(tag);\n          else state.bool[tag] = !state.bool[tag];\n        }\n      }\n      if (open) res += `</span>`;\n      open = true;\n      if (drop) {\n        const frame = blockstack.pop();\n        if (frame) {\n          res += '</span>';\n          for (const b of frame) (state.value[b] || (state.value[b] = [])).pop();\n        }\n      }\n      if (block) {\n        blockstack.push(block);\n        res += `<span style=\"${getStyle(state, block)}\">`;\n      }\n      res += `<span style=\"${getStyle(state, 'inline')}\">`;\n    }\n  }\n  if (open) res += `</span>`;\n  for (const f of blockstack) res += '</span>';\n  return res;\n}\n\nexport function style(str: string): string {\n  const parsed = parser(str);\n  if (Array.isArray(parsed)) return process(parsed);\n  return str;\n}\n\nconst flexAlign = { top: 'start', middle: 'center', bottom: 'end', base: 'baseline' };\nconst borderStyle = { dot: 'dotted', dash: 'dashed' };\nfunction getStyle(state: State, which: 'inline'|string[]) {\n  let res = '';\n\n  if (which === 'inline') {\n    const bs = state.bool;\n    if (bs.underline || bs.overline || bs.strike) res += `text-decoration-line:${[bs.underline && 'underline', bs.overline && 'overline', bs.strike && 'line-through'].filter(v => v).join(' ')};`\n    if (bs.sup || bs.sub) {\n      res += `font-size:70%;`;\n      if (bs.sup) res += `vertical-align:super;`;\n      if (bs.sub) res += `vertical-align:sub;`;\n    }\n    if (bs.italic) res += `font-style:italic;`;\n    if (bs.bold) res += `font-weight:bold;`;\n    if (bs.pre) res += `white-space:pre-wrap;`;\n\n    const vs = state.value;\n    if (Array.isArray(vs.valign)) {\n      const v = vs.valign[vs.valign.length - 1];\n      if (v) res += `vertical-align:${v === 'base' ? 'baseline' : v};`;\n    }\n\n    if (Array.isArray(vs.fg)) {\n      const v = vs.fg[vs.fg.length - 1];\n      if (v) res += `color:${v};`;\n    }\n\n    if (Array.isArray(vs.bg)) {\n      const v = vs.bg[vs.bg.length - 1];\n      if (v) res += `background-color:${v};`;\n    }\n\n    if (Array.isArray(vs.size)) {\n      const v = vs.size[vs.size.length - 1];\n      if (v != null) res += `font-size:${v}rem;`;\n    }\n\n    if (Array.isArray(vs.font)) {\n      const v = vs.font[vs.font.length - 1];\n      if (v != null) res += `font-family:${v};`;\n    }\n\n    if (Array.isArray(vs.line)) {\n      const v = vs.line[vs.line.length - 1];\n      if (v != null) res += `line-height:${v}rem;`;\n    }\n  } else {\n    res += `display:inline-flex;box-sizing:content-box;overflow:hidden;`;\n    const vs = state.value;\n\n    let transforms: string[];\n\n    if (which.includes('align') && Array.isArray(vs.align)) {\n      const v = vs.align[vs.align.length - 1];\n      if (Array.isArray(v)) {\n        let vv = v.find(v => ['top', 'middle', 'bottom', 'base'].includes(v));\n        if (vv) res += `align-items:${flexAlign[vv]};`;\n        vv = v.find(v => ['left', 'right', 'center'].includes(v));\n        if (vv) res += `justify-content:${vv};`;\n      }\n    }\n\n    if (which.includes('width') && Array.isArray(vs.width)) {\n      const v = vs.width[vs.width.length - 1];\n      if (v != null) res += `width:${v};`;\n    }\n\n    if (which.includes('height') && Array.isArray(vs.height)) {\n      const v = vs.height[vs.height.length - 1];\n      if (v != null) res += `height:${v};`;\n    }\n\n    if (which.includes('pad') && Array.isArray(vs.pad)) {\n      const v: number[] = vs.pad[vs.pad.length - 1];\n      if (Array.isArray(v) && v.length) {\n        res += `padding:${v[0]}rem`;\n        if (v.length > 1) res += ` ${v[1]}rem`;\n        if (v.length > 2) res += ` ${v[2]}rem`;\n        if (v.length > 3) res += ` ${v[3]}rem`;\n        res += ';';\n      }\n    }\n\n    if (which.includes('margin') && Array.isArray(vs.margin)) {\n      const v: number[] = vs.margin[vs.margin.length - 1];\n      if (Array.isArray(v) && v.length) {\n        res += `margin:${v[0]}rem`;\n        if (v.length > 1) res += ` ${v[1]}rem`;\n        if (v.length > 2) res += ` ${v[2]}rem`;\n        if (v.length > 3) res += ` ${v[3]}rem`;\n        res += ';';\n      }\n    }\n\n    if (which.includes('border') && Array.isArray(vs.border)) {\n      const v: { style: string; color?: string; width: number[]; radius: number[] } = vs.border[vs.border.length - 1];\n      if (v) {\n        res += `border-style:${borderStyle[v.style] || v.style};border-width:${v.width[0]}px`;\n        if (v.width.length > 1) res += ` ${v.width[1]}px`;\n        if (v.width.length > 2) res += ` ${v.width[2]}px`;\n        if (v.width.length > 3) res += ` ${v.width[3]}px`;\n        res += ';';\n        if (v.color) res += `border-color:${v.color};`;\n        if (v.radius) {\n          res += `border-radius:${v.radius[0]}rem`;\n          if (v.radius.length > 1) res += ` ${v.radius[1]}rem`;\n          if (v.radius.length > 2) res += ` ${v.radius[2]}rem`;\n          if (v.radius.length > 3) res += ` ${v.radius[3]}rem`;\n          res += ';';\n        }\n      }\n    }\n\n    if (which.includes('bg') && Array.isArray(vs.bg)) {\n      const v = vs.bg[vs.bg.length - 1];\n      if (v) res += `background-color:${v};`;\n    }\n\n    if (which.includes('rotate') && Array.isArray(vs.rotate)) {\n      const v: { turn: number; origin?: [string, string] } = vs.rotate[vs.rotate.length - 1];\n      if (v) {\n        if (v.origin) res += `transform-origin:${v.origin[0]} ${v.origin[1]};`;\n        (transforms || (transforms = []))[which.indexOf('rotate')] = `rotate(${v.turn}turn)`;\n      }\n    }\n\n    if (which.includes('move') && Array.isArray(vs.move)) {\n      const v: { x: string; y: string } = vs.move[vs.move.length - 1];\n      if (v) (transforms || (transforms = []))[which.indexOf('move')] = `translate(${v.x}, ${v.y})`;\n    }\n\n    if (transforms) res += `transform:${transforms.filter(v => v).join(' ')};`;\n\n    if (which.includes('nowrap')) res += `white-space:nowrap;`;\n    if (which.includes('overflow')) res += `overflow:visible;`;\n  }\n\n  return res;\n}\n","import { Container, Label, Repeater, Image, MeasuredLabel, HTML } from '../report';\nimport { evaluate, filter, Group, ValueOrExpr, isValueOrExpr, extend as extendData } from '../data/index';\nimport { parse as parseTemplate } from '../data/parse/template';\nimport { style as styleText } from '../data/parse/style';\nimport { error } from './error';\n\nimport { addStyle, escapeHTML, extend, getWidth, measure, registerRenderer, renderWidget, renderWidgets, RenderContinuation, RenderState, RenderContext, getHeightWithMargin, expandMargin, getWidthWithMargin, isComputed } from './index';\nimport { styleClass, style, styleFont, styleImage, styleExtra } from './style';\n\nfunction onCommit(ctx: RenderContext, key: string, value: any) {\n  let c = ctx;\n  while (c) {\n    if (c.commit) {\n      c.commit[key] = value;\n      return;\n    }\n    c = c.parent;\n  }\n}\n\nfunction commitContext(ctx: RenderContext) {\n  for (const k in ctx.commit) {\n    let l = ctx.context;\n    while (l) {\n      if (l.special && l.special.values) (l.special.values[k] || (l.special.values[k] = [])).push(ctx.commit[k]);\n      l = l.parent;\n    }\n  }\n}\n\nregisterRenderer<Label>('label', (w, ctx, placement) => {\n  addStyle(ctx, 'label', `.label {position:absolute;box-sizing:border-box;white-space:normal;}`);\n  let str = '';\n  let sval: any;\n  let val = (Array.isArray(w.text) ? w.text : [w.text]).map(v => {\n    let val = evaluate(ctx, typeof v === 'object' && 'text' in v ? v.text : v);\n    if (typeof val === 'string') val = escapeHTML(val);\n    if (typeof v === 'object' && 'id' in v) onCommit(ctx, v.id, val);\n    str += val;\n    sval = val;\n\n    if (w.styled) val = styleText(val);\n\n    if (typeof v === 'object' && 'text' in v) {\n      return `<span${styleClass(ctx, [], [styleFont(v.font, ctx) + styleExtra(v, ctx), ''])}>${val}</span>`;\n    } else {\n      return val\n    };\n  }).join('');\n\n  if (w.id) onCommit(ctx, w.id, str);\n\n  if (w.format && w.format.name) {\n    const args: ValueOrExpr[] = [{ v: !Array.isArray(w.text) || w.text.length === 1 ? sval : val }, { v: w.format.name }];\n    val = evaluate(ctx, { op: 'format', args: args.concat(w.format.args || []) });\n  }\n\n  return `<span${styleClass(ctx, ['label'], style(w, placement, ctx, { lineSize: true }))}>${val}</span>`\n});\n\nregisterRenderer<Container>('container', (w, ctx, placement, state) => {\n  addStyle(ctx, 'container', `.container {position:absolute;box-sizing:border-box;}`);\n  let h: number;\n  if (!w.height) w.height = 'auto';\n  else if (w.height !== 'auto') h = getHeightWithMargin(w, placement, ctx);\n  const wctx = ((state || {}).state || {}).ctx ? Object.assign({}, ctx, { context: state.state.ctx }) : ctx;\n  if (w.context && !((state || {}).state || {}).ctx) {\n    if (!wctx.context.locals) wctx.context.locals = {};\n    const value = evaluate(extend(wctx, { special: { placement, widget: w }, locals: wctx.context.locals }), w.context);\n    if (value) wctx.context = extendData(wctx.context, { value, special: { placement, widget: w } });\n  }\n  const cw = getWidth(w, placement, ctx) || placement.availableX;\n  const r = renderWidgets(w, wctx, { x: 0, y: 0, availableX: cw, availableY: h || placement.availableY, maxX: cw, maxY: h != null && !isNaN(h) ? h : placement.maxY }, state, w.layout);\n  if (!r.cancel) {\n    r.output = `<div${styleClass(ctx, ['container'], style(w, placement, ctx, { computedHeight: h || r.height, container: true }))}>${r.output}</div>`;\n    r.height = h || r.height;\n    r.width = getWidthWithMargin(w, placement, ctx);\n  }\n  if ((r.cancel || r.continue) && !w.bridge) {\n    const state = r.continue || {} as RenderState;\n    state.offset = 0;\n    // must start over\n    delete state.last;\n    state.attempt = (state.attempt || 0) + 1;\n    if (state.attempt > 1) return error(ctx, placement);\n    return { continue: state, output: '' };\n  } else if (r.continue) {\n    if (w.context) r.continue.state = { ctx: wctx.context };\n    r.continue.offset = 0;\n  }\n  return r;\n}, { container: true });\n\ntype RepeatState = { part: 'group'|'header'|'body'|'footer'; group?: 'header'|'body'; src: Group|any[]; current: number; context?: RenderContext; newPage?: boolean };\nregisterRenderer<Repeater, RepeatState>('repeater', (w, ctx, placement, state) => {\n  addStyle(ctx, 'container', `.container {position:absolute;box-sizing:border-box;}`);\n  if (!w.height) w.height = 'auto';\n  let availableY = placement.availableY;\n  let availableX = placement.availableX;\n\n  let r: RenderContinuation;\n  let html = '';\n  let commit = false;\n  const m = expandMargin(w, ctx, placement);\n  let y = !state || !state.state || state.state.part === 'header' ? m[0] : 0;\n  if (availableY != null) {\n    availableY -= y;\n    availableY = +availableY.toFixed(6)\n  }\n  let group: Group;\n  let groupNo: number|boolean = false;\n  const newPage = state && state.state && state.state.newPage;\n\n  let src: Group|any[] = state && state.state && state.state.src;\n  if (!src) {\n    if (!w.source) return '';\n    src = isValueOrExpr(w.source) ?\n      evaluate(ctx, w.source) :\n      filter(ctx.context.root.sources[w.source.source] || { value: [] }, w.source.filter, w.source.sort, w.source.group, ctx.context).value;\n    (ctx.context.special || (ctx.context.special = {})).values || (ctx.context.special.values = {});\n  }\n    \n  let arr: any[];\n\n  if (!Array.isArray(src)) {\n    if (!src || !Array.isArray(src.value)) return { output: '', height: 0 };\n    group = src;\n    arr = group.value;\n    if (w.group) {\n      groupNo = w.group.length > group.grouped ? w.group.length - group.grouped - 1 : false;\n    }\n  } else {\n    arr = src;\n  }\n\n  if ((w.header || w.group) && (newPage || !state || !state.state || state.state.part === 'header' || state.state.part === 'group')) {\n    const hctx = state && state.state && state.state.context && state.state.context.context;\n\n    if (group) {\n      const c = extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: (hctx && hctx.special || {}).values } });\n\n      if (w.group && groupNo !== false && (!state || !state.state || state.state.part === 'group')) {\n        r = renderWidget(w.group[groupNo], extend(ctx, { value: group, special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: true, group: group.group } }), { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n\n        if (r) {\n          if (r.height > availableY) {\n            if (html) html = `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`;\n            return { output: html, height: y, continue: { offset: 0, state: { part: 'group', src, current: 0, newPage: true } } }\n          } else if (availableY != null) {\n            availableY -= r.height;\n            availableY = +availableY.toFixed(6);\n          }\n\n          html += r.output;\n          y += r.height;\n        }\n      }\n\n      if (w.header && (w.groupHeaders && w.groupHeaders[group.grouped] && (!state || !state.state || !state.state.current) || newPage && w.headerPerPage !== false)) r = renderWidget(w.header, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n      else r = { output: '', height: 0 };\n\n      if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'header', src, current: 0, context: ctx, newPage: true } } }\n      else if (availableY != null) {\n        availableY -= r.height;\n        availableY = +availableY.toFixed(6);\n      }\n\n      html += r.output;\n      y += r.height;\n    } else if (w.header) {\n      if (!state || newPage && w.headerPerPage !== false) r = renderWidget(w.header, ctx, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n      else r = { output: '', height: 0 };\n\n      if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'header', src, current: 0, context: ctx, newPage: true } } }\n      else if (availableY != null) {\n        availableY -= r.height;\n        availableY = +availableY.toFixed(6);\n      }\n\n      html += r.output;\n      y += r.height;\n    }\n  }\n\n  if (newPage) state.state.newPage = false;\n  if (state && state.child && state.child.state) state.child.state.newPage = false;\n\n  let rctx: RenderContext = state && state.state && state.state.context || extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: {}, last: arr.length - 1, count: arr.length } });\n  const elide = w.row && (isComputed(w.row.elide) ? evaluate(extend(rctx, { special: { placement, widget: w } }), w.row.elide.x) : w.row.elide);\n\n  if (!state || !state.state || state.state.part !== 'footer') {\n    let usedX = 0;\n    let usedY = 0;\n    let initY = y;\n    if (!elide && !arr.length && w.alternate) {\n      if (w.alternate) {\n        r = renderWidget(w.alternate, rctx, { x: usedX, y, availableX: availableX - usedX, maxX: placement.maxX, availableY, maxY: placement.maxY }, state ? state.child : undefined);\n        if (r.height > availableY) return { output: html, height: 0, continue: { offset: 0, state: { part: 'body', src, current: 0, newPage: true } } }\n        else if (availableY != null) {\n          availableY -= r.height;\n          availableY = +availableY.toFixed(6);\n        }\n\n        html += r.output;\n        y += r.height;\n      }\n    } else {\n      for (let i = (state && state.state && state.state.current) || 0; i < arr.length; i++) {\n        let row = false;\n        const c = group && group.grouped ?\n          extend(rctx, { value: arr[i], special: { index: i, values: {} }, commit: {} }) :\n          extend(rctx, { value: arr[i], special: { index: i } });\n\n        if (group && group.grouped) {\n          const s: RenderState<RepeatState> = (state && state.child) || { offset: 0, state: { current: 0, src: arr[i], part: 'group' } };\n          r = renderWidget(w, c, { x: 0, y, availableX: availableX - usedX, availableY, maxX: placement.maxX, maxY: placement.maxY }, s);\n        } else {\n          c.commit = {};\n          if (elide) {\n            renderWidget(w.row, c, { x: 0, y: 0, availableX: placement.maxX, maxX: placement.maxX, availableY: placement.maxY, maxY: placement.maxY }, state ? state.child : undefined);\n            commitContext(c);\n            continue;\n          } else {\n            r = renderWidget(w.row, c, { x: usedX, y, availableX: availableX - usedX, maxX: placement.maxX, availableY, maxY: placement.maxY }, state ? state.child : undefined);\n            row = true;\n          }\n        }\n\n        if (state) state.child = null;\n\n        if (r.width && r.width <= availableX - usedX && r.width !== availableX) {\n          usedX += r.width;\n          if (r.height > usedY) {\n            usedY = r.height;\n            if (r.height > availableY) initY -= r.height;\n          }\n        } else if (r.width && usedX && r.width > availableX - usedX) {\n          y += usedY;\n          initY = y;\n          if (availableY != null) {\n            availableY -= usedY;\n            availableY = +availableY.toFixed(6);\n          }\n          usedY = 0;\n          usedX = 0;\n          i--;\n          continue;\n        }\n\n        if (r.height > availableY || r.cancel) {\n          if (initY === y && usedY) y += usedY;\n          if (commit) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: r.continue } };\n          else return { output: '', height: y, continue: { offset: y, state: { part: state && state.state && state.state.part || 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: r.continue } };\n        }\n\n        if (!usedY) {\n          y += r.height;\n          if (availableY != null) {\n            availableY -= r.height;\n            availableY = +availableY.toFixed(6);\n          }\n        }\n\n        html += r.output;\n        commit = true;\n\n        if (row && w.header && ctx.report.type === 'flow' && w.headerRepeat > 0 && i + 1 && (i + 1) % w.headerRepeat === 0) {\n          const h = renderWidget(w.header, ctx, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n          html += h.output;\n          y += h.height;\n        }\n\n        if (r.continue) {\n          if (initY === y && usedY) y += usedY;\n          if (w.row.bridge) commitContext(c);\n          return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: w.row.bridge || (group && group.grouped) ? r.continue : undefined } };\n        }\n\n        commitContext(c);\n      }\n    }\n\n    if (initY === y && usedY) y += usedY;\n  }\n\n  if (w.footer) {\n    const fctx = (rctx && rctx.context) || (state && state.state && state.state.context && state.state.context.context);\n    const c = extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: (fctx && fctx.special || {}).values }, commit: {} });\n\n    if (group) {\n      if (w.groupEnds && w.groupEnds[group.grouped]) r = renderWidget(w.footer, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY, availableY });\n      else r = { output: '', height: 0 };\n    } else r = renderWidget(w.footer, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY, availableY });\n\n    if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'footer', current: 0, src, context: rctx, newPage: true } } }\n    else if (r.continue) {\n      if (w.footer.bridge) commitContext(c);\n      return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'footer', src, current: 0, context: rctx, newPage: true }, child: w.footer.bridge ? r.continue : undefined } }\n    }\n\n    commitContext(c);\n\n    html += r.output;\n    y += r.height;\n  }\n\n  return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y };\n}, { container: true });\n\nregisterRenderer<Image>('image', (w, ctx, placement) => {\n  addStyle(ctx, 'image', `.image {position:absolute;box-sizing:border-box;} .image .inner {background-repeat:no-repeat;height:100%;}`);\n\n  const fit = w.fit && typeof w.fit === 'object' ? evaluate(ctx, w.fit.x) : w.fit;\n  if (fit === 'stretch') {\n    return `<img src=\"${evaluate(ctx, w.url)}\" ${styleClass(ctx, ['image'], style(w, placement, ctx))} />`;\n  } else {\n    return `<div ${styleClass(ctx, ['image'], style(w, placement, ctx))}><div ${styleClass(ctx, ['inner'], styleImage(fit), `background-image:url('${evaluate(ctx, w.url)}');`)}></div></div>`;\n  }\n});\n\nregisterRenderer<MeasuredLabel>('measured', (w, ctx, placement, state) => {\n  addStyle(ctx, 'measured', `.measured {position:absolute;box-sizing:border-box;white-space:pre-wrap;font-family:serif;font-size:0.83rem;word-break:break-word;}`);\n  const text = evaluate(ctx, w.text);\n  const height = measure(text, getWidth(w, placement, ctx) || placement.availableX, ctx, w.font);\n  \n  if (!state && height > placement.availableY) {\n    return { output: '', height: 0, continue: { state: {}, offset: 0 } };\n  } else {\n    let s = style(w, placement, ctx, { computedHeight: height, container: true });\n    s[0] = `line-height:1em;` + s[0];\n    return {\n      height, output: `<span${styleClass(ctx, ['measured', 'label'], s)}>${escapeHTML(text)}</span>`\n    };\n  }\n});\n\nregisterRenderer<HTML>('html', (w, ctx, placement) => {\n  addStyle(ctx, 'html', `.html {position:absolute;box-sizing:border-box;overflow:hidden;line-height:1rem;}`);\n  const html = evaluate(extend(ctx, { parser: parseTemplate }), w.html);\n  return `<div${styleClass(ctx, ['html'], style(w, placement, ctx, { container: true }))}>${html}</div>`;\n});\n","import { DateExactRange } from \"./index\";\n\nconst decRE = /(\\d)(?=(\\d{3})+\\.)/g;\nconst intRE = /(\\d)(?=(\\d{3})+$)/g;\nconst isNumRE = /^[-0-9\\\\.,]+$/;\n\nexport function number(v: string|number, dec: number = 2, group: string = ',', negative: 'sign'|'wrap'|'both' = 'sign'): string {\n  v = typeof v !== 'number' ? parseFloat(v || '') : v;\n  if (isNaN(v)) return '';\n  const neg = v < 0;\n  v = v.toFixed(dec);\n  if (dec === 0) v = v.replace(/\\..*/, '');\n  if (neg && negative !== 'sign') v = `(${negative === 'both' ? v : v.substr(1)})`\n  if (group) return v.replace(v.indexOf('.') === -1 ? intRE : decRE, `$1${group}`);\n  else return v;\n}\n\nexport function dollar(v: string, alt: string, dec: number = 2, group: string = ',', sign: string = '$', negative: 'sign'|'wrap'|'both' = 'sign'): string {\n  if (v != null && isNumRE.test(v)) {\n    if (!isNaN(+v)) return `${sign}${number(v, dec, group, negative)}`;\n    else return alt !== undefined ? alt : v;\n  } else {\n    return alt !== undefined ? alt : v;\n  }\n}\n\nexport function phone(v: string|number): string {\n  if (!v) v = '';\n  if (typeof v !== 'string') v = v.toString();\n  v = v || '';\n  v = v.replace(/[^\\d]/g, '');\n\n  if (v.length === 7) return `${v.substr(0, 3)}-${v.substr(3, 4)}`;\n  else if (v.length === 10) return `(${v.substr(0, 3)}) ${v.substr(3, 3)}-${v.substr(6, 4)}`;\n  else if (v.length === 11) return `${v[0]}-${v.substr(1, 3)}-${v.substr(4, 3)}-${v.substr(7, 4)}`;\n  else return v;\n}\n\nconst dateRE = /\\\\.|y+|M+|d+|E+|H+|m+|s+|k+|h+|a+|S+|z+/g;\nconst months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\nconst days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nlet dateDefault: string;\nexport function date(d: string|Date|DateExactRange, fmt: string): string {\n  if (!d) return '';\n  let Y: number, M: number, D: number, DD: number, H: number, MM: number, S: number, SS: number, Z: number;\n\n  // convert an exact range to numbers\n  if (typeof d === 'object' && 'f' in d && Array.isArray(d.f)) {\n    const f = d.f, l = f.length, e = d.e;\n    Y = f[0], M = l > 1 && f[1] != null ? f[1] : e ? 11 : 0, D = l > 2 && f[2] != null ? f[2] : e ? 0 : 1,\n      H = l > 3 && f[3] != null ? f[3] : e ? 23 : 0, MM = l > 4 && f[4] != null ? f[4] : e ? 59 : 0, S = l > 5 && f[5] != null ? f[5] : e ? 59 : 0,\n      SS = l > 6 && f[6] != null ? f[6] : e ? 999 : 0;\n    let dt = new Date(Y, M, D || 1, H, MM, S, SS);\n    Z = l > 7 && f[7] != null ? -f[7] : dt.getTimezoneOffset();\n    if (!D) {\n      dt.setMonth(M + 1);\n      dt.setDate(0);\n      D = dt.getDate();\n    }\n    DD = dt.getDay();\n  } else {\n    if (typeof d === 'string') d = new Date(d);\n    if (Object.prototype.toString.call(d) !== '[object Date]') return '';\n    if (isNaN(d as any)) return '';\n\n    const v = d as Date;\n    Y = v.getFullYear(), M = v.getMonth(), D = v.getDate(), DD = v.getDay(), H = v.getHours(), MM = v.getMinutes(), S = v.getSeconds(), SS = v.getMilliseconds(), Z = v.getTimezoneOffset();\n  }\n\n\n  if (!fmt) fmt = dateDefault || 'yyyy-MM-dd';\n\n  return fmt.replace(dateRE, m => {\n    if (m[0] === '\\\\') {\n      return m[1];\n    } else if (m[0] === 'y') {\n      return m.length <= 2 ? (`${Y}`).substr(2, 2) : `${Y}`;\n    } else if (m[0] === 'M') {\n      if (m.length === 1) return `${M + 1}`;\n      else if (m.length === 2) return M < 9 ? `0${M + 1}` : `${M + 1}`;\n      else if (m.length === 3) return months[M].substr(0, 3);\n      else return months[M];\n    } else if (m[0] === 'd') {\n      if (m.length === 1) return `${D}`;\n      else if (m.length === 2) return D <= 9 ? `0${D}` : `${D}`;\n      else return ordinal(D);\n    } else if (m[0] === 'E') {\n      if (m.length === 1) return `${DD + 1}`;\n      else if (m.length === 2) return days[DD].substr(0, 3);\n      else return days[DD];\n    } else if (m[0] === 'H') {\n      return m.length === 1 ? `${H}` : H <= 9 ? `0${H}` : `${H}`;\n    } else if (m[0] === 'm') {\n      return m.length === 1 ? `${MM}` : MM <= 9 ? `0${MM}` : `${MM}`;\n    } else if (m[0] === 's') {\n      return m.length === 1 ? `${S}` : S <= 9 ? `0${S}` : `${S}`;\n    } else if (m[0] === 'S') {\n      const ms = SS;\n      if (m.length === 1) return `${ms}`;\n      return ms < 10 ? `00${ms}` : ms < 100 ? `0${ms}` : `${ms}`;\n    } else if (m[0] === 'k' || m[0] === 'h') {\n      let r = `${H % 12}`;\n      if (r === '0') r = '12';\n      return `${r}`;\n    } else if (m[0] === 'a') {\n      return H > 11 ? 'PM' : 'AM';\n    } else if (m[0] === 'z') {\n      let min = 0 - Z;\n      const bit = min < 0 ? '-' : '+';\n      min = Math.abs(min);\n      let r: number = min;\n      if (m.length === 1) {\n        r = Math.floor(min / 60);\n      } else if (m.length === 2) {\n        const mm = min % 60;\n        const h = Math.floor(min / 60);\n        return `${bit}${h < 10 ? '0' : ''}${h}${mm < 10 ? '0' : ''}${mm}`;\n      } else if (m.length === 3) {\n        const mm = min % 60;\n        const h = Math.floor(min / 60);\n        return `${bit}${h < 10 ? '0' : ''}${h}:${mm < 10 ? '0' : ''}${mm}`;\n      } else r = min;\n      return `${bit}${r}`;\n    }\n  });\n}\n\ndate.setDefault = function(format?: string) {\n  dateDefault = format;\n}\n\nexport function ordinal(num: number|string, group?: string): string {\n  num = number(num, 0, group);\n  let n = `${num}`;\n  n = n.substr(-2, 2);\n  if (n.length > 1 && n[0] === '1') return `${num}th`;\n  switch (n[1] || n[0]) {\n    case '1':\n      return `${num}st`;\n    case '2':\n      return `${num}nd`;\n    case '3':\n      return `${num}rd`;\n    default:\n      return `${num}th`;\n  }\n}\n","import { ValueOrExpr, Operation, Literal, DateRel, DateRelRange, isDateRel, isTimespan, TimeSpan, isApplication, ValueWithAnchor } from '../index';\nimport { endRef, isTimespanMS, timespans, timeSpanToNumber } from '../parse';\nimport { Schema } from '../index';\n\nconst checkIdent = new RegExp(`[${endRef.split('').map(v => `\\\\${v}`).join('')}]`);\n\nexport interface ListOverride {\n  base: boolean|number;\n  array?: boolean|number;\n  union?: boolean|number;\n  args?: boolean|number;\n  keys?: boolean|number;\n  ops?: boolean|number;\n  opchain?: boolean|number;\n}\n\ninterface _ListOverride {\n  array: number;\n  union: number;\n  args: number;\n  keys: number;\n  ops: number;\n  opchain: number;\n}\n\nexport type StringifyOpts = SimpleStringifyOpts | SExprStringifyOpts;\nexport interface BaseStringifyOpts {\n  /** Disable the use of symbol style :strings. */\n  noSymbols?: boolean;\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps?: boolean;\n  /** Enable comma separators in lists of values. */\n  listCommas?: boolean;\n  /** Whether to wrap lists of items. `true` wraps every item. A number targets that many characters in the output to cause a wrap. The default is 60 chars. */\n  listWrap?: boolean|number|ListOverride;\n  /** Output template formatted expressions. */\n  template?: boolean;\n  /** Output unindented single line expressions. */\n  noIndent?: boolean;\n  /** Output HTML-friendly syntax */\n  htmlSafe?: boolean;\n  /** Strip checks out of schema types */\n  noChecks?: boolean;\n}\nexport interface SimpleStringifyOpts extends BaseStringifyOpts {\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps?: false;\n  /** How to render pipes: op as a binary operator, call as a function call, or default/undefined as originally specified */\n  pipes?: 'op'|'call';\n}\nexport interface SExprStringifyOpts extends BaseStringifyOpts {\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps: true;\n  /** Output array function calls rather than sugared array literals. */\n  noArrayLiterals?: boolean;\n  /** Output object function calls rather than sugared object literals. */\n  noObjectLiterals?: boolean;\n}\n\nlet _noSym: boolean = false;\nlet _key: boolean = false;\nlet _sexprops: boolean = false;\nlet _listcommas: boolean = false;\nlet _noarr: boolean = false;\nlet _noobj: boolean = false;\nlet _tpl: boolean = false;\nlet _tplmode: boolean = false;\nlet _noindent: boolean = false;\nlet _listwrap: _ListOverride = { array: 60, union: 60, args: 60, keys: 60, ops: 30, opchain: 60 };\nlet _html: boolean = false;\nlet _nochecks: boolean = false;\nlet _pipes: 'op'|'call'|undefined;\n\nlet _level = 0;\nlet _first = false;\n\nconst deepops = ['===', '!==', 'deep-is', 'deep-is-not'];\nconst binops = deepops.concat(['|', '**', '*', '/%', '/', '%', '+', '-', '>=', 'gte', '>', 'gt', '<=', 'lte', '<', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain', 'is', 'is-not', '==', '!=', 'strict-is', 'strict-is-not', 'and', '&&', 'or', '||', '??']);\nconst unops = ['+', 'not'];\nconst precedence = {\n  '|': 1,\n  '**': 2,\n  '*': 3, '/%': 3, '/': 3, '%': 3,\n  '+': 4, '-': 4,\n  '>=': 5, '>': 5, '<=': 5, '<': 5, in: 5, like: 5, ilike: 5, 'not-in': 5, 'not-like': 5, 'not-ilike': 5, 'contains': 5, 'does-not-contain': 5, gt: 5, gte: 5, lt: 5, lte: 5,\n  'is': 6, 'is-not': 6, '==': 6, '!=': 6, 'strict-is': 6, 'strict-is-not': 6, 'deep-is': 6, 'deep-is-not': 6, '===': 6, '!==': 6,\n  'and': 7, '&&': 7,\n  'or': 8, '||': 8, '??': 8,\n}\n\nconst call_op = /^[-a-zA-Z_$0-9]/;\n\nexport function stringify(value: ValueOrExpr, opts?: StringifyOpts): string {\n  opts = opts || {};\n  _noSym = opts.noSymbols;\n  _sexprops = opts.SExprOps;\n  _listcommas = opts.listCommas;\n  _noarr = opts.SExprOps && opts.noArrayLiterals;\n  _noobj = opts.SExprOps && opts.noObjectLiterals;\n  _key = false;\n  _tpl = _tplmode = opts.template;\n  _noindent = opts.noIndent;\n  _level = 0;\n  _first = true;\n  if ('listWrap' in opts) {\n    const o = opts.listWrap;\n    if (typeof o === 'boolean') _listwrap = !o ? { array: 0, union: 0, args: 0, keys: 0, ops: 0, opchain: 0 } : { array: 1, union: 1, args: 1, keys: 1, ops: 30, opchain: 1 };\n    else if (typeof o === 'number') _listwrap = { array: o, union: o, args: o, keys: o, ops: 30, opchain: o };\n    else {\n      const b = !o.base ? 0 : o.base === true ? 1 : o.base;\n      _listwrap = Object.keys(_listwrap).reduce((a, c) => (a[c] = c in o && o[c] != null ? (!o[c] ? 0 : o[c] === true ? 1 : o[c]) : b, a), {} as any);\n    }\n  } else _listwrap = { array: 60, union: 60, args: 60, keys: 60, ops: 30, opchain: 60 };\n  _html = opts.htmlSafe;\n  _nochecks = opts.noChecks;\n  _pipes = (opts as any).pipes;\n  if (!_sexprops && typeof value === 'object' && value && 'op' in value && value.op === 'block') return stringifyRootBlock(value);\n  else return _stringify(value);\n}\n\nfunction padl(v: any, pad: string, len: number): string {\n  v = `${v}`;\n  if (!pad) return v;\n  for (let i = v.length; i < len; i++) {\n    v = pad + v;\n  }\n  return v;\n}\n\nfunction fill(char: string, len: number): string {\n  let res = '';\n  for (let i = 0; i < len; i++) res += char;\n  return res;\n}\n\nfunction _stringify(value: ValueOrExpr): string {\n  if (typeof value === 'string') return value;\n  let stringed: string;\n  if (value == null || typeof value === 'number' || typeof value === 'boolean') return `${value}`;\n  if (_tpl && ('op' in value || 'r' in value)) {\n    if ('op' in value) {\n      if (value.op === 'if' || value.op === 'with' || value.op === 'unless' || value.op === 'each') {\n        stringed = stringifyTemplateBlock(value);\n      } else if (value.op === 'case') {\n        stringed = stringifyTemplateCase(value);\n      } else if (value.op) {\n        if (value.op === '+') return value.args.map(a => _stringify(a)).join('');\n        else {\n          _tpl = false;\n          const res = `{{${_stringify(value.op === 'string' ? value.args[0] : value)}}}`;\n          _tpl = true;\n          stringed = res;\n        }\n      }\n    } else {\n      _tpl = false;\n      const res = `{{${_stringify(value)}}}`;\n      _tpl = true;\n      stringed = res;\n    }\n  } else if ('r' in value) {\n    if (typeof value.r === 'string') stringed = /^[0-9]/.test(value.r) ? `.${value.r}` : value.r;\n    else {\n      const r = value.r;\n      stringed = `${fill('^', r.u || 0)}${r.p || ''}${r.k.map((p, i) => {\n        if (typeof p === 'string' && checkIdent.test(p)) return `${i ? '' : '_'}[${_stringify({ v: p })}]`;\n        else if (typeof p === 'string' || typeof p === 'number') return `${i ? '.' : ''}${p}`;\n        else {\n          const v = p as ValueWithAnchor;\n          return `[${_stringify(p)}${v.anchor === 'end' ? '<' : ''}${v.slice ? ` ${_stringify(v.slice)}${v.slice.anchor === 'end' ? '<' : ''}` : ''}]`\n        }\n      }).join('')}`;\n    }\n  } else if ('op' in value) {\n    stringed = stringifyOp(value);\n  } else if (isApplication(value)) {\n    const arrow = ((_tplmode && _html !== false) || _html) ? '\\\\' : '>';\n    if ('n' in value) stringed = `|${value.n.join(_listcommas ? ', ' : ' ')}| =${arrow} ${_stringify(value.a)}`;\n    else stringed = `=${arrow}${_stringify(value.a)}`;\n  } else if ('v' in value) {\n    stringed = stringifyLiteral(value);\n  } else if (isDateRel(value)) {\n    stringed = stringifyDate(value);\n  } else if (isTimespan(value)) {\n    stringed = stringifyTimespan(value);\n  }\n\n  if ('c' in value && value.c.length) stringed = (_first ? '' : '\\n') + value.c.map(c => `${padl('', '  ', _level)}// ${c}\\n`).join('') + `${padl('', '  ', _level)}${stringed}`;\n\n  return stringed;\n}\n\nfunction stringifyBinopArg(op: string, arg: ValueOrExpr, pos: 1|2): string {\n  let res: string;\n  if (op === '**' && pos === 1 && typeof arg !== 'string' && 'op' in arg && arg.op === '**') res = `(${_stringify(arg)})`;\n  if (typeof arg !== 'string' && 'op' in arg) {\n    if (binops.includes(arg.op) && precedence[arg.op] > precedence[op]) res = `(${_stringify(arg)})`;\n    else if (arg.op === 'if' || arg.op === 'unless' || arg.op === 'case' || arg.op === 'fmt' || arg.op === 'format') res = `(${_stringify(arg)})`;\n    else res = _stringify(arg);\n  } else res = _stringify(arg);\n  return res;\n}\n\nfunction findNestedStringOpL(op: string, value: Operation): boolean {\n  if (value.args && value.args.find(a => typeof a === 'object' && typeof (a as any).v === 'string')) return true;\n  if (!value.args || !value.args.length) return false;\n  const left = value.args[0];\n  if (typeof left === 'object' && 'op' in left && left.op === op) return findNestedStringOpL(op, left);\n  return false;\n}\n\nfunction flattenNestedBinopsL(op: string, value: Operation, agg: ValueOrExpr[] = []): ValueOrExpr[] {\n  if (value.args && value.args.length) {\n    let i = 0;\n    for (; i < value.args.length; i++) {\n      if (typeof value.args[i] === 'object' && typeof (value.args[i] as any).v === 'string') agg.push(value.args[i]);\n      else break;\n    }\n    const left = value.args[i];\n    if (typeof left === 'object' && 'op' in left && left.op === op) flattenNestedBinopsL(op, left, agg);\n    else agg.push(left);\n    agg.push.apply(agg, value.args.slice(i + 1));\n  }\n  return agg;\n}\n\nfunction stringifyOp(value: Operation): string {\n  let op = value.op;\n  if ((_tplmode && _html !== false) || _html) {\n    if (op === '>') op = 'gt';\n    else if (op === '>=') op = 'gte';\n    else if (op === '<') op = 'lt';\n    else if (op === '<=') op = 'lte';\n    else if (op === '&&') op = 'and';\n  }\n  if (!_noarr && op === 'array' && !value.opts) {\n    return wrapArgs('[', value.args, value.opts, ']');\n  } else if (!_noobj && op === 'object' && value.args && !value.args.find((a, i) => i % 2 === 0 && (typeof a === 'string' || !('v' in a) || typeof a.v !== 'string'))) {\n    if (!value.args || !value.args.length) return '{}';\n    return wrapArgs('{', value.args, value.opts, '}', 2);\n  } else if (_sexprops) {\n    if (!value.args || !value.args.length) return `(${op})`;\n    return wrapArgs(`(${op} `, value.args, value.opts, ')', 0);\n  } else if (op === 'if' || op === 'unless' && value.args && value.args.length > 2) {\n    return stringifyIf(value);\n  } else if (op === 'case' && value.args && value.args.length > 2) {\n    return stringifyCase(value);\n  } else if (op === '+' && value.args && value.args.length > 1 && findNestedStringOpL(op, value)) {\n    const args = flattenNestedBinopsL(op, value);\n    if (value.meta && value.meta.q) {\n      const re = new RegExp(`(\\\\{|${value.meta.q})`, 'g');\n      return `${value.meta.q}${args.map(a => typeof a !== 'string' && 'v' in a && typeof a.v === 'string' ? a.v.replace(re, v => `\\\\$1`).replace(/\\$$/, '\\\\$') : `{${_stringify(a)}}`).join('')}${value.meta.q}`\n    } else return `'${args.map(a => typeof a !== 'string' && 'v' in a && typeof a.v === 'string' ? a.v.replace(/[{']/g, v => `\\\\${v}`).replace(/\\$$/, '\\\\$') : `{${_stringify(a)}}`).join('')}'`\n  } else if ((op === 'fmt' || op === 'format') && value.args && typeof value.args[1] === 'object' && 'v' in value.args[1] && typeof value.args[1].v === 'string') {\n    const val = value.args[0];\n    let vs = _stringify(val);\n    if (typeof val !== 'string' && 'op' in val && (binops.includes(val.op) || unops.includes(val.op))) vs = `(${vs})`;\n    if (value.opts || value.args?.length > 3) return `${vs}#${[value.args[1].v]}${wrapArgs('(', value.args.slice(2), value.opts, ')')}`;\n    else return `${vs}#${[value.args[1].v].concat(value.args.slice(2).map(a => _stringify(a))).join(',')}`;\n  } else if (binops.includes(op) && value.args && value.args.length > 1 && !value.opts && (!deepops.includes(op) || value.args.length === 2)) {\n    let parts = value.args.map((a, i) => stringifyBinopArg(op, a, i === 0 ? 1 : 2));\n    const long = parts.find(p => p.length > _listwrap.ops || ~p.indexOf('\\n')) || parts.reduce((a, c) => a + c.length, 0) > _listwrap.opchain && parts.length > 2;\n    const split = _noindent ? ' ' : long ? `\\n${padl('', '  ', _level + 1)}` : ' ';\n    if (split.length > 1 || (!_noindent && long)) parts = [parts[0]].concat(parts.slice(1).map(p => indentAll('  ', p)));\n    return `${parts[0]} ${op}${split}${parts.slice(1).join(` ${op}${split.length > 1 ? `${split}` : split}`)}`;\n  } else if (unops.includes(op) && value.args && value.args.length === 1) {\n    const arg = value.args[0];\n    if (typeof arg !== 'string' && 'op' in arg && (binops.includes(arg.op) || unops.includes(arg.op))) return `${op}(${_stringify(arg)})`;\n    else return `${op}${call_op.test(op) ? ' ' : ''}${_stringify(arg)}`;\n  } else if (op === 'block') {\n    if (!value.args || !value.args.length) return '';\n\n    _level++;\n    const _f = _first;\n    const parts = value.args.map((a, i) => (_first = i === 0, _stringify(a)));\n    _first = _f;\n    let split = _noindent ? '' : `\\n${padl('', '  ', _level)}`;\n    _level--;\n    if (parts.length === 1 && !~parts[0].indexOf('\\n')) return `{ ${parts[0]} }`;\n    return `{${split}${parts.join(split)}\\n${padl('', '  ', _level)}}`;\n  } else if ((op === 'let' || op === 'set') && value.args && value.args.length === 2) {\n    let path: string;\n    let arg = value.args[0];\n    if (typeof arg === 'string') path = arg;\n    else if ('v' in arg && typeof arg.v === 'string') path = arg.v;\n    else if ('v' in arg && typeof arg.v === 'object' && 'k' in arg.v) path = _stringify({ r: arg.v });\n    else path = _stringify(arg);\n    return `${op} ${path} = ${_stringify(value.args[1])}`;\n  } else if (op === 'get' && value.args.length === 2 && typeof value.args[1] === 'object' && 'v' in value.args[1] && typeof value.args[1].v === 'object' && 'k' in value.args[1].v) {\n    return `${_stringify(value.args[0])}${_stringify({ r: { k: ['r'].concat(value.args[1].v.k) } }).substr(1)}`;\n  } else if (op === 'cat' && value.meta?.q === '$$$') {\n    return `$$$${stringifyTemplate(value.args)}$$$`;\n  } else if (op === 'pipe' && (_pipes === 'op' || !_pipes && value.meta?.op) && value.args?.length > 1) {\n    let parts = value.args.map((a, i) => stringifyBinopArg('|', a, i === 0 ? 1 : 2));\n    const long = parts.find(p => p.length > _listwrap.ops || ~p.indexOf('\\n')) || parts.reduce((a, c) => a + c.length, 0) > _listwrap.opchain && parts.length > 2;\n    const split = _noindent ? ' ' : long ? `\\n${padl('', '  ', _level + 1)}` : ' ';\n    if (split.length > 1 || (!_noindent && long)) parts = [parts[0]].concat(parts.slice(1).map(p => indentAll('  ', p)));\n    return `${parts[0]} |${split}${parts.slice(1).join(` |${split.length > 1 ? `${split}` : split}`)}`;\n  } else if (call_op.test(op)) {\n    return wrapArgs(`${op}(`, value.args || [], value.opts, ')', 0);\n  } else {\n    if (!value.args || !value.args.length) return `(${op})`;\n    return wrapArgs(`(${op} `, value.args, value.opts, ')', 0);\n  }\n}\n\nfunction stringifyRootBlock(block: Operation): string {\n  if (!block.args || !block.args.length) return '';\n  return block.args.map((a, i) => (_first = i === 0, _stringify(a))).join('\\n');\n}\n\nfunction stringifyLiteral(value: Literal): string {\n  if (value.s === 1) {\n    _level++;\n    const res = stringifySchema(value.v);\n    _level--;\n    if (~res.indexOf('\\n')) {\n      const level = _noindent ? ' ' : `\\n${padl('', '  ', _level)}`;\n      return `@[${level}${level !== ' ' ? '  ' : ''}${res}${level}]`;\n    } else return `@[${res}]`;\n  } else if (typeof value.v === 'string') {\n    if (_tpl) return value.v.replace(/\\\\(.)/g, '\\\\\\\\$1').replace(/{{/g, '\\\\{{');\n    if ((_key || !_noSym) && !checkIdent.test(value.v) && value.v.length) return `${_key ? '' : ':'}${value.v}`;\n    else if (value.q) return `${value.q}${value.v.replace(new RegExp(value.q, 'g'), `\\\\${value.q}`)}${value.q}`;\n    else if (!~value.v.indexOf(\"'\")) return `'${value.v.replace(/[{']/g, v => `\\\\${v}`).replace(/\\${/g, '\\\\${')}'`;\n    else if (!~value.v.indexOf('`')) return `\\`${value.v.replace(/[{`]/g, v => `\\\\${v}`).replace(/\\${/g, '\\\\${')}\\``;\n    else if (!~value.v.indexOf('\"')) return `\"${value.v}\"`;\n    else return `'${value.v.replace(/['{]/g, s => `\\\\${s}`).replace(/\\${/g, '\\\\${')}'`;\n  } else if (typeof value.v === 'number' || typeof value.v === 'boolean' || value.v === 'true' || value.v === 'false') {\n    return `${value.v}`;\n  } else if (value.v === 'undefined' || value.v === undefined) {\n    return 'undefined';\n  } else if (value.v === 'null' || value.v === null) {\n    return 'null';\n  } else if (Array.isArray(value.v)) {\n    if (_noarr) return wrapArgs('(array', value.v.map(v => ({ v })), null, ')', null, 'array');\n    return wrapArgs('[', value.v.map(v => ({ v })), null, ']', null, 'array');\n  } else if (typeof value.v === 'object') {\n    if (isDateRel(value.v)) {\n      return stringifyDate(value.v);\n    } else {\n      return wrapArgs('{', Object.entries(value.v).reduce((a, c) => (a.push({ v: c[0] }, { v: c[1] }), a), []), null, '}', 2, 'keys');\n    }\n  }\n}\n\nfunction offsetToTimezone(dir: 1|-1, offset?: number): string {\n  if (offset == null) return '';\n  offset = offset * dir;\n  const o = Math.abs(offset);\n  const h = Math.floor(o / 60);\n  const m = o % 60;\n  if (!offset) return 'Z';\n  else return `${offset > 0 ? '-' : '+'}${h}${m ? `:${padl(m, '0', 2)}` : ''}`;\n}\n\nconst spanKeys = ['w', 'd', 'h', 'mm', 's'];\nconst spanExact = ['y', 'm', 'd', 'h', 'mm', 's', 'ms'];\nfunction stringifyDate(value: DateRel): string {\n  let str = '';\n  if (value instanceof Date) { // date object\n    const y = value.getFullYear();\n    const m = value.getMonth() + 1;\n    const d = value.getDate();\n    const h = value.getHours();\n    const mn = value.getMinutes();\n    const s = value.getSeconds();\n    const ms = value.getMilliseconds();\n    str = `${y}-${padl(m, '0', 2)}-${padl(d, '0', 2)}`;\n    if (h + mn + s + ms > 0) {\n      str += ` ${padl(h, '0', 2)}:${padl(mn, '0', 2)}`;\n      if (s + ms > 0) {\n        str += `:${padl(s, '0', 2)}`;\n        if (ms > 0) str += `.${padl(ms, '0', 3)}`;\n      }\n    }\n    return `#${str}${offsetToTimezone(1, value.getTimezoneOffset())}#`;\n  } else if (Array.isArray(value.f)) { // precise date\n    const a = value.f;\n    str = `${a[0]}`;\n    if (a[1] != null) str += `-${padl(a[1] + 1, '0', 2)}`;\n    if (a[2] != null) str += `-${padl(a[2], '0', 2)}`;\n    if (a[3] != null) str += ` ${padl(a[3], '0', 2)}`;\n    if (a[4] != null) str += `:${padl(a[4], '0', 2)}`;\n    if (a[5] != null) str += `:${padl(a[5], '0', 2)}`;\n    if (a[6] != null) str += `.${padl(a[6], '0', 3)}`;\n    if (a[7] != null) str += ` ${offsetToTimezone(-1, a[7])}`;\n    if ('e' in value && value.e) str += '<';\n    return `#${str}#`;\n  } else if (value.f === 'n') { // relative point in time\n    if (Array.isArray(value.o)) { // inconsistent units\n      spanExact.forEach((k, i) => {\n        if (value.o[i] != null) str += `${value.o[i]}${k}`;\n      });\n      str += `${'d' in value && value.d === -1 ? ' ago' : ' from now'}${offsetToTimezone(-1, value.z)}`;\n      return `#${str}#`;\n    } else if (typeof value.o === 'number') { // milliseconds\n      if (value.o === 0) return `#now#`;\n      let rem = Math.abs(value.o);\n      spanKeys.forEach(k => {\n        const t = Math.floor(rem / timespans[k]);\n        rem = rem % timespans[k];\n        if (t) str += `${t}${k}`;\n      });\n      if (rem) str += `${rem}ms`;\n      return `#${str}${value.o < 0 ? ' ago' : value.o > 0 ? ' from now' : ''}${offsetToTimezone(-1, value.z)}#`;\n    }\n  } else if ('d' in value && value.d === 1 && value.o === 0) { // span to date\n    str = `#${value.f === 'w' ? 'week' : value.f === 'm' ? 'month' : 'year'} to date${offsetToTimezone(-1, value.z)}${value.e && '>' || ''}#`;\n  } else if ('t' in value && Array.isArray(value.t)) { // time on relative day\n    const a = value.t;\n    str = `${value.o < 0 ? 'yesterday' : value.o > 0 ? 'tomorrow' : 'today'} at `;\n    if (!a[0] && !a[1] && !a[2] && !a[3]) str += 'midnight';\n    else if (a[0] === 12 && !a[1] && !a[2] && !a[3]) str += 'noon';\n    else {\n      str += a[0];\n      if (a[1] != null) str += `:${padl(a[1], '0', 2)}`;\n      if (a[2] != null) str += `:${padl(a[2], '0', 2)}`;\n      if (a[3] != null) str += `.${padl(a[3], '0', 3)}`;\n    }\n    return `#${str}${offsetToTimezone(-1, a[4])}${value.e ? '>' : ''}#`;\n  } else if (!('t' in value) && !('d' in value) && !Array.isArray(value.f)) { // relative span\n    const v = value as DateRelRange;\n    if (v.f === 'd') {\n      str += `${v.o < 0 ? 'yesterday' : v.o > 0 ? 'tomorrow' : 'today'}`;\n    } else {\n      str += `${v.o < 0 ? 'last' : v.o > 0 ? 'next' : 'this'} ${v.f === 'w' ? 'week' : v.f === 'm' ? 'month' : 'year'}`;\n    }\n    return `#${str}${offsetToTimezone(-1, v.z)}${v.e ? '>' : ''}#`;\n  }\n\n  return str;\n}\n\nfunction stringifyTimespan(value: TimeSpan): string {\n  if (typeof value === 'number' || isTimespanMS(value)) {\n    let str = '';\n    let rem = Math.abs(timeSpanToNumber(value));\n    spanKeys.forEach(k => {\n      const t = Math.floor(rem / timespans[k]);\n      rem = rem % timespans[k];\n      if (t) str += `${t}${k}`;\n    });\n    if (rem) str += `${rem}ms`;\n    return `#${str}#`;\n  } else {\n    const o = value.d;\n    let str = '';\n    spanExact.forEach((k, i) => {\n      if (o[i] != null) str += `${o[i]}${k}`;\n    });\n    return `#${str}#`;\n  }\n}\n\nconst leadingSpace = /^\\s+/;\nconst allLeadingSpace = /^\\s+/gm;\nfunction outdentAll(amount: string, str: string): string {\n  if (amount) return str.replace(allLeadingSpace, s => s.substr(amount.length));\n  else return str;\n}\nfunction indentAll(amount: string, str: string): string {\n  return str.replace(/\\n/gm, `\\n${amount}`);\n}\n\nfunction wrapArgs(open: string, args: ValueOrExpr[], opts: ValueOrExpr, close: string, keyMod?: number, wrapSetting?: keyof _ListOverride): string {\n  if ((!args || !args.length) && !opts) return `${open}${close}`;\n  _level++;\n  const _f = _first;\n  let parts: string[];\n  if (keyMod) {\n    parts = [];\n    for (let i = 0; i < args.length; i++) {\n      if (i % keyMod === 0) {\n        _key = true;\n        parts.push(_stringify(args[i]) + ':');\n        _key = false;\n      } else {\n        _level++;\n        _first = i === 1;\n        const res = _stringify(args[i]);\n        if (res[0] === '\\n')  parts[parts.length - 1] += ' ' + res.replace(leadingSpace, '');\n        else parts[parts.length - 1] += res;\n        _level--;\n      }\n    }\n  } else {\n    parts = args.map((a, i) => {\n      _first = i === 0;\n      return _stringify(a);\n    });\n  }\n  if (opts && typeof opts === 'object') {\n    const args = 'op' in opts && opts.args ? opts.args : 'v' in opts ? Object.entries(opts.v).reduce((a, c) => (a.push({ v: c[0] }, { v: c[1] }), a), []) : [];\n    for (let i = 0; i < args.length; i++) {\n      if (i % 2 === 0) {\n        _key = true;\n        parts.push(_stringify(args[i]) + ':');\n        _key = false;\n      } else {\n        _level++;\n        _first = i === 1;\n        const res = _stringify(args[i]);\n        if (res[0] === '\\n')  parts[parts.length - 1] += ' ' + res.replace(leadingSpace, '');\n        else parts[parts.length - 1] += res;\n        _level--;\n      }\n    }\n  }\n  _level--;\n  _first = _f;\n\n  let join = _listcommas ? ', ' : ' ';\n  if (_noindent || (parts.length == 1 && !~parts[0].indexOf('\\n'))) return `${open}${parts.join(join)}${close}`;\n  let wrap = _listwrap[wrapSetting || 'args'];\n  const base = parts.join(_listcommas ? ', ' : ' ');\n  if (!wrap && ~base.indexOf('\\n')) wrap = 1;\n  if (wrap === 1 && _listcommas) join = ',\\n';\n\n  const level = padl('', '  ', _level);\n\n  if (!wrap) return `${open}${base}${close}`;\n  else if (wrap === 1) return `${open}\\n${parts.map(p => `${level}  ${p}`).join(join)}\\n${level}${close}`;\n  if (base.length <= wrap) return `${open}${base}${close}`;\n\n  let res = `${open}`;\n  let str = '';\n  const last = parts.length - 1;\n  for (let i = 0; i < parts.length; i++) {\n    if (~parts[i].indexOf('\\n')) {\n      if (str) res += str;\n      res += `\\n${parts[i][0] === ' ' ? '' : level + '  '}${parts[i]}${i !== last ? join : ''}`;\n      str = '';\n      continue;\n    }\n    if (!str) str += `\\n${level}  `;\n    str += `${parts[i]}${i !== last ? join : ''}`;\n    if (str.length >= wrap) {\n      res += str;\n      str = '';\n    }\n  }\n  if (str) res += str;\n  return `${res}\\n${level}${close}`;\n}\n\nfunction isBlock(v: any): boolean {\n  return typeof v === 'object' && 'op' in v && v.op === 'block';\n}\n\nfunction stringifyIf(op: Operation): string {\n  if (!op.args || op.args.length < 2) return 'false';\n\n  let str = '';\n\n  const last = op.args.length - 1;\n  const block = !!op.args.find((p, i) => (i % 2 === 1 || i === last) && isBlock(p));\n\n  _level++;\n  const parts = op.args.map((a, i) => _stringify(block && (i % 2 === 1 || i === last) && !isBlock(a) ? { op: 'block', args: [a] } : a));\n  _level--;\n\n  const long = parts.find(p => p.length > _listwrap.ops || ~p.indexOf('\\n')) || '';\n  let split = _noindent ? '' : parts.length > 3 || long ? `\\n${padl('', '  ', _level)}` : '';\n  const cindent = long && `${split}  ` || ' ';\n  split = split || ' ';\n  for (let i = 0; i <= last; i++) {\n    if (i === 0) {\n      if (block) str += `if ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else {\n        const cond = parts[i++];\n        str += `if ${cond}${~cond.indexOf('\\n') ? split : ' '}then${cindent}${parts[i].trimLeft()}`\n      }\n    } else if (i === last) {\n      if (block) str = str.trimRight() + ` else ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${split}else${cindent}${parts[i].trimLeft()}`;\n    } else {\n      if (block) str = str.trimRight() + ` elif ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${split}elif ${parts[i++]} then${cindent}${parts[i].trimLeft()}`;\n    }\n  }\n  if (!block && _level) str += `${split}end`;\n\n  return str;\n}\n\nconst caseRE = /@case\\b/g;\nfunction stringifyCase(op: Operation): string {\n  if (!op.args || op.args.length < 2) return 'false';\n\n  let str = '';\n\n  const last = op.args.length - 1;\n  const block = !!op.args.find((p, i) => ((i > 1 && i % 2 === 0) || i === last) && isBlock(p));\n\n  _level++;\n  const parts = op.args.map((a, i) => {\n    let res: string;\n    if (i !== 0) _level++;\n\n    if (block && (i > 1 && i % 2 === 0 || i === last)) {\n      res = _stringify(isBlock(a) ? a : { op: 'block', args: [a] });\n    } else if (i % 2 === 0 || i === last) {\n      res = _stringify(a);\n    } else {\n      res = typeof a === 'object' && 'op' in a ? _stringify(a).replace(caseRE, '_') : _stringify(a);\n    }\n\n    if (i !== 0) _level--;\n\n    return res;\n  });\n  _level--;\n\n  const long = parts.find(p => p.length > _listwrap.ops || ~p.indexOf('\\n')) || '';\n  let split = _noindent ? '' : parts.length > 3 || long ? `\\n${padl('', '  ', _level)}` : '';\n  const wsplit = split ? `${split}  ` : ' ';\n  const cindent = long && `${wsplit}  ` || ' ';\n  split = split || ' ';\n  for (let i = 0; i <= last; i++) {\n    if (i === 0) {\n      if (block) str += `case ${parts[i]}`;\n      else str += `case ${parts[i]}`\n    } else if (i === last) {\n      if (block) str = str.trimRight() + wsplit + `else ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${wsplit}else${cindent}${parts[i].trimLeft()}`\n    } else {\n      if (block) str = str.trimRight() + wsplit + `when ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else {\n        const cond = parts[i++];\n        str += `${wsplit}when ${cond}${~cond.indexOf('\\n') ? wsplit : ' '}then${cindent}${parts[i].trimLeft()}`;\n      }\n    }\n  }\n  if (!block && _level) str += `${split}end`;\n\n  return str;\n}\n\nfunction stringifyTemplate(parts: ValueOrExpr[]) {\n  const start = _tpl;\n  _tpl = true;\n  const res = parts.map(p => _stringify(p)).join('');\n  _tpl = start;\n  return res;\n}\n\nfunction stringifyTemplateBlock(op: Operation): string {\n  _tpl = false;\n  const cond = _stringify(op.args[0]);\n  _tpl = true;\n  const first = _stringify(op.args[1]);\n  let res = `{{${op.op} ${cond}}}${op.op === 'with' || op.op === 'each' ? first.slice(2) : first}`;\n  if (op.op === 'unless') return `${res}{{/}}`;\n  for (let i = 2; i < op.args.length; i++) {\n    if (i + 1 >= op.args.length) {\n      const arg = op.args[i];\n      if (typeof arg === 'object' && 'v' in arg && arg.v === '') continue;\n      else res += `{{else}}${_stringify(arg)}`;\n    } else {\n      _tpl = false;\n      res += `{{elseif ${_stringify(op.args[i++])}}}`;\n      _tpl = true;\n      res += _stringify(op.args[i]);\n    }\n  }\n  res += '{{/}}';\n  return res;\n}\n\nfunction stringifyTemplateCase(op: Operation): string {\n  const last = op.args.length - 1;\n  const parts = op.args.map((a, i) => {\n    _tpl = true;\n    if (i === 0 || i % 2 === 1) _tpl = false;\n    if (i === last) _tpl = true;\n    return typeof a === 'object' && 'op' in a ? _stringify(a).replace(caseRE, '_') : _stringify(a);\n  });\n  _tpl = true;\n  let res = `{{${op.op} ${parts[0]} when ${parts[1]}}}`;\n  for (let i = 2; i <= last; i++) {\n    if (i === last) res += `{{else}}${parts[i]}`;\n    else if (i % 2 === 1) res += `{{when ${parts[i]}}}`;\n    else res += parts[i];\n  }\n  res += '{{/}}';\n  return res;\n}\n\nexport function stringifySchema(schema: Schema, noChecks?: boolean): string {\n  if (noChecks !== undefined) _nochecks = noChecks;\n\n  if (!schema) return 'any';\n  const t = schema.type;\n  const ts = schema.types;\n\n  let strs: string[];\n  let fin = '', open = '', close = '', join = '';\n  let wrap: number = _listwrap.array;\n\n  switch (t) {\n    case 'object':\n    case 'object[]':\n      const arr = !!~t.indexOf('[]');\n      if ((!schema.fields || !schema.fields.length) && !schema.rest) {\n        fin = `{}${arr ? '[]' : ''}`;\n        break;\n      }\n      wrap = _listwrap.keys;\n      _level++;\n      strs = schema.fields ? schema.fields.map((f, i) => {\n        const str = stringifySchema(f);\n        return (f.desc && f.desc.length ? (i === 0 ? '' : `\\n${padl('', '  ', _level)}`) + f.desc.map(c => `// ${c}`).join(`\\n${padl('', '  ', _level)}`) + `\\n${padl('', '  ', _level)}` : '') + `${f.name}${f.required ? '' : '?'}: ${str}`;\n      }) : [];\n      if (schema.rest) strs.push(`...: ${stringifySchema(schema.rest)}`);\n      _level--;\n      open = '{';\n      close = `}${arr ? '[]' : ''}`;\n      join = ', ';\n      break;\n    case 'union':\n    case 'union[]':\n      if (~t.indexOf('[]')) open = 'Array<', close = '>';\n      else if (schema.checks && schema.checks.length) open = '(', close = ')';\n      if (open) _level++;\n      strs = ts.map(u => stringifySchema(u));\n      wrap = _listwrap.union;\n      join = strs.length > 6 || strs.find(s => ~s.indexOf('\\n')) ? ' | ' : '|';\n      if (open) _level--;\n      break;\n    case 'literal':\n      if (typeof schema.literal === 'string') fin = `'${schema.literal.replace(/'/g, '\\\\\\'')}'`;\n      else fin = `${schema.literal}`;\n      break;\n    case 'tuple':\n    case 'tuple[]':\n      if (!t || t.length === 0) {\n        fin = '[]';\n        break;\n      }\n\n      _level++;\n      open = '[', close = `]${~t.indexOf('\\n') ? '[]' : ''}`;\n      join = ', ';\n      strs = ts.map(t => stringifySchema(t));\n      _level--;\n      break;\n    default:\n      fin = schema.ref || t || 'any';\n      if (schema.ref && t === 'array') fin += '[]';\n      break;\n  }\n\n  let defs: string;\n  const level = _noindent ? ' ' : padl('', '  ', _level);\n\n  if (schema.defs) {\n    const keys = Object.keys(schema.defs).sort();\n    defs = keys.map((k, i) => {\n      const def = schema.defs[k];\n      return (def.desc && def.desc.length ? (i === 0 ? '' : `\\n${level}`) + def.desc.map(c => `// ${c}`).join(`\\n${level}`) + `\\n${level}` : '') + `type ${k} = ${stringifySchema(def)}`;\n    }).join(`\\n${level}`);\n  }\n\n  if (!fin) {\n    const l2 = open && !_noindent ? `${level}  ` : level;\n    const nl = _noindent ? '' : '\\n';\n    const lopen = open ? `${open}${nl}${l2}` : '';\n    const lclose = close ? `${nl}${level}${close}` : '';\n    if (wrap === 0) fin = `${lopen}${strs.join(join)}${lclose}`;\n    else if (wrap === 1) fin = `${lopen}${strs.join(`${join}${nl}${l2}`)}${lclose}`;\n    else {\n      let line = '';\n      \n      const last = strs.length - 1;\n      for (let i = 0; i < strs.length; i++) {\n        if (~strs[i].indexOf('\\n')) {\n          line = '';\n          fin += (i === 0 ? '' : '\\n' + l2) + strs[i] + (i !== last ? join : '');\n        } else {\n          fin += strs[i], line += strs[i];\n          if (i !== last) fin += join, line += join;\n        }\n\n        if (line.length > wrap && i !== last && !~(strs[i + 1] || '').indexOf('\\n')) {\n          fin += `${nl}${l2}`;\n          line = '';\n          if (~join.indexOf('|')) fin += '  ';\n        }\n      }\n\n      if (~fin.indexOf('\\n')) fin = `${lopen}${fin}${lclose}`;\n      else fin = `${open}${open === '{' ? ' ' : ''}${fin}${open === '{' && fin.substr(-1) !== ' ' ? ' ' : ''}${close}`;\n    }\n  }\n\n  if (!_nochecks && schema.checks && schema.checks.length) {\n    fin += ` ?${schema.checks.map(c => _stringify(c)).join(' ?')} `;\n  }\n\n  if (defs) fin = `${defs}\\n${level}\\n${level}${fin}`;\n\n  return fin;\n}\n","import { parser as makeParser, map, seq, str, opt } from 'sprunge';\nimport { ws } from 'sprunge/lib/json';\nimport { schema } from '../parse';\n\nexport const parseSchema = makeParser(\n  map(seq(opt(str('@[')), ws, schema(), ws, opt(str(']'))), ([, , schema]) => schema),\n  { trim: true, consumeAll: true },\n);\nexport { stringifySchema as unparseSchema } from './stringify';\n","import { parser as makeParser, opt, str, alt, seq, map, rep1sep, read1 } from 'sprunge/lib';\nimport { digits, ws } from 'sprunge/lib/json';\nexport { ParseError } from 'sprunge/lib';\n\nconst space = ' \\t\\r\\n';\n\nconst num = map(seq(opt(str('-')), read1(digits)), ([neg, num]) => neg ? -num : +num);\nconst num_range = map(seq(num, str('-', ':'), num), ([start,, end]) => [start, end].sort((l, r) => l < r ? -1 : l > r ? 1 : 0) as [number, number]);\nconst sign_range = map(seq(str('<', '>'), ws, num), ([sign,, num]) => sign === '<' ? [-Infinity, num - 1] as [number, number] : [num + 1, Infinity] as [number, number]);\nconst star_range = map(str('*'), () => [-Infinity, Infinity] as [number, number]);\nconst not_range = map(seq(str('!'), alt<number|[number, number]>(num_range, sign_range, num)), ([, range]) => ({ not: range }));\n\nconst _range = rep1sep(alt<number|[number, number]|{ not: number|[number, number] }>(star_range, num_range, sign_range, num, not_range), read1(space + ',;'), 'allow');\n\nexport const range = makeParser(_range, { trim: true });\n\nexport default range;\n","import { parseDate } from './parse';\nimport { dateRelToDate } from './index';\n\nexport function join(...strs: string[]): string {\n  return strs.filter(s => s).join('.');\n}\n\nexport interface Diff {\n  [path: string]: [any, any];\n}\n\nconst looseEqual = (v1: any, v2: any) => v1 == v2;\nconst strictEqual = (v1: any, v2: any) => v1 === v2;\nconst isNum = /^[\\d.]+$/;\nconst trueStrings = /^(true|on|yes)$/i;\nconst falseStrings = /^(false|off|no)$/i;\nconst sqlEqual = (v1: any, v2: any) => {\n  let tmp1: any, tmp2: any;\n  if ((typeof v1 === 'number' || typeof v1 === 'string' && isNum.test(v1)) && (typeof v2 === 'number' || typeof v2 === 'string' && isNum.test(v2))) {\n    return +v1 === +v2;\n  } else if ((typeof v1 === 'boolean' || typeof v2 === 'boolean') && (typeof v1 === 'string' || typeof v2 === 'string')) {\n    return trueStrings.test(v1) && trueStrings.test(v2) || falseStrings.test(v1) && falseStrings.test(v2);\n  } else if ((v1 instanceof Date || typeof v1 === 'string' && Array.isArray((tmp1 = parseDate(v1) as any)?.f)) && (v2 instanceof Date || typeof v2 === 'string' && Array.isArray((tmp2 = parseDate(v2) as any)?.f))) {\n    if (tmp1) tmp1 = dateRelToDate(tmp1);\n    else tmp1 = v1;\n    if (tmp2) tmp2 = dateRelToDate(tmp2);\n    else tmp2 = v2;\n    return +tmp1 === +tmp2;\n  }\n\n  else return v1 == v2;\n};\n\ntype Identifier = true|string|((v: any) => any);\nexport interface IdentityMap {\n  [path: string]: Identifier;\n}\n\ntype EqualizerValue = 'strict'|'loose'|'sql'|((v1: any, v2: any) => boolean);\ninterface EqualizerOptions {\n  type?: EqualizerValue;\n  /** A map of identity methods to use when comparing elements within an array, making arrays act as a set */\n  identity?: IdentityMap;\n}\ntype Equalizer = EqualizerOptions | EqualizerValue;\n\nconst fullnum = /^\\d+$/;\nfunction checkIdentity(map: IdentityMap, path: string) {\n  const p = path.split('.').reduce((a, c) => fullnum.test(c) ? `${a}[]` : `${a}${a.length ? '.' : ''}${c}`, '');\n  return map[`${p}[]`];\n}\n\nexport interface DiffOpts {\n  equal?: Equalizer;\n  keys?: 'all'|'common';\n}\n\nexport function diff(v1: any, v2: any, opts?: DiffOpts): Diff {\n  const type = opts?.equal && typeof opts.equal === 'object' ? opts.equal.type : opts?.equal;\n  const eq = typeof type === 'function' ? type : type === 'strict' ? strictEqual : type === 'sql' ? sqlEqual : looseEqual;\n  return _diff(v1, v2, '', {}, eq, typeof opts?.equal === 'object' ? opts?.equal.identity : undefined, opts?.keys || 'all');\n}\n\nfunction _diff(v1: any, v2: any, path: string, diff: Diff, equal: (v1: any, v2: any) => boolean, ident?: IdentityMap, keyMode?: 'all'|'common'): Diff {\n  if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n    if (v1 === v2) return diff;\n    diff[path] = [v1, v2];\n    return diff;\n  }\n\n  let id: Identifier;\n  if (Array.isArray(v1) && Array.isArray(v2) && ident && (id = checkIdentity(ident, path))) {\n    const v1ids = v1.map(v => id === true ? v : typeof id === 'string' ? (v && (typeof v === 'object' || typeof v === 'function') ? v[id] : v) : id(v));\n    const v2ids = v2.map(v => id === true ? v : typeof id === 'string' ? (v && (typeof v === 'object' || typeof v === 'function') ? v[id] : v) : id(v));\n    for (let i = 0; i < v1ids.length; i++) {\n      const idx = v2ids.indexOf(v1ids[i]);\n      if (~idx) {\n        const vv1 = v1[i];\n        const vv2 = v2[idx];\n\n        if (vv1 === vv2) continue;\n        else if (typeof vv1 === 'object' && typeof vv2 === 'object') _diff(vv1, vv2, join(path, `${i}`), diff, equal, ident);\n        else if (!equal(vv1, vv2)) diff[join(path, `${i}`)] = [vv1, vv2];\n      } else diff[join(path, `${i}`)] = [v1[i], undefined];\n    }\n\n    const found = v1ids.slice();\n    for (let i = 0; i < v1ids.length; i++) {\n      if (~found.indexOf(v2ids[i])) continue;\n      diff[join(path, `${i + found.length}`)] = [undefined, v2[i]];\n    }\n  } else {\n    const _v1 = v1 || {};\n    const _v2 = v2 || {};\n    const ks: string[] = [];\n    if (keyMode === 'common') {\n      for (const k of Object.keys(_v1)) if (k in _v2) ks.push(k);\n    } else {\n      ks.push.apply(ks, Object.keys(_v1));\n      for (const k of Object.keys(_v2)) if (!~ks.indexOf(k)) ks.push(k);\n    }\n\n    for (const k of ks) {\n      const vv1 = _v1[k];\n      const vv2 = _v2[k];\n\n      if (vv1 === vv2) continue;\n      else if (typeof vv1 === 'object' && typeof vv2 === 'object') _diff(vv1, vv2, join(path, k), diff, equal, ident);\n      else if (!equal(vv1, vv2)) diff[join(path, k)] = [vv1, vv2];\n    }\n  }\n\n  return diff;\n}\n\nexport function deepEqual(v1: any, v2: any, equal?: EqualizerValue): boolean {\n  const eq = typeof equal === 'function' ? equal : equal === 'strict' ? strictEqual : equal === 'sql' ? sqlEqual : looseEqual;\n  return _deepEqual(v1, v2, eq);\n}\n\nfunction _deepEqual(v1: any, v2: any, equal: (v1: any, v2: any) => boolean): boolean {\n  if (typeof v1 !== 'object' || typeof v2 !== 'object') return equal(v1, v2);\n  if ((!v1 || !v2) && v1 != v2) return false; // eslint-ignore-line eqeqeq\n\n  const ks = Object.keys(v1 || {});\n  for (const k of Object.keys(v2 || {})) if (!~ks.indexOf(k)) ks.push(k);\n\n  for (const k of ks) {\n    const vv1 = v1[k];\n    const vv2 = v2[k];\n\n    if (vv1 === vv2) continue;\n    else if (typeof vv1 === 'object' && typeof vv2 === 'object') {\n      if (!_deepEqual(vv1, vv2, equal)) return false;\n    } else if (!equal(vv1, vv2)) return false;\n  }\n\n  return true;\n}\n\nexport interface LabelOptions {\n  /** Omit keys in the original diff that aren't in the label. */\n  omit?: boolean;\n}\n\nexport function labelDiff(diff: Diff, label: any, opts?: LabelOptions): Diff {\n  const out: Diff = opts?.omit ? {} : Object.assign({}, diff);\n  _labelDiff(diff, label, '', '', out, opts);\n  return out;\n}\n\nconst num = /^\\d+/;\nfunction _labelDiff(diff: Diff, label: any, path: string, str: string, out: Diff, opts?: LabelOptions) {\n  for (const k in label) {\n    if (k.slice(-2) === '[]') {\n      const p = `${path}${path && '.'}${k.slice(0, -2)}`;\n      const l = Array.isArray(label[k]) ? label[k] : [label[k]];\n      const all = Object.keys(diff);\n      const nums: string[] = [];\n      for (const k of all) {\n        if (k.indexOf(p) === 0 && num.test(k.substr(p.length + 1))) {\n          const idx = k.indexOf('.', p.length + 1);\n          const num = k.substring(p.length + 1, ~idx ? idx : undefined);\n          if (!~nums.indexOf(num)) nums.push(num)\n        }\n      }\n      const lbl = `${str}${str && ' '}${l[0]}`;\n      for (const num of nums) {\n        const pp = `${p}${p && '.'}${num}`;\n        if (pp in diff) {\n          out[`${lbl}${lbl && ' '}${+num + 1}`] = diff[pp];\n          if (opts?.omit) delete out[pp];\n        }\n        if (l[1]) _labelDiff(diff, l[1], pp, `${lbl}${lbl && ' '}${+num + 1}`, out, opts);\n      }\n    } else {\n      const p = `${path}${path && '.'}${k}`;\n      let l = Array.isArray(label[k]) ? label[k] : [label[k]];\n      const lbl = `${str}${str && ' '}${l[0]}`;\n      if (p in diff) {\n        out[lbl] = diff[p];\n        if (opts?.omit) delete out[p];\n      }\n      if (l[1]) _labelDiff(diff, l[1], p, lbl, out, opts);\n    }\n  }\n}\n","import { Schema, Field, Type, TypeMap } from './index';\nimport { join } from './diff';\nimport { parseSchema, unparseSchema } from './parse/schema';\nimport { evalApply, Root, Context, safeGet, extend, isDateRel } from './index';\n\nconst date = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z$/;\nfunction isDate(v: any) {\n  if (typeof v === 'object') return isDateRel(v);\n  else if (typeof v === 'string' && date.test(v)) return true;\n  return false;\n}\n\nexport function isSchema(what: any): what is Schema {\n  return what && typeof what === 'object' && 'type' in what && typeof what.type === 'string';\n}\n\nexport function inspect(base: any, flat?: boolean): Schema {\n  const root = getType(base);\n  if (Array.isArray(base)) {\n    const fields: Field[] = [];\n    fields.push({ type: 'number', name: 'length' });\n    if (!flat && base.length > 0) {\n      const val = inspect(base[0]);\n      if (val.fields) fields.push({ type: val.type, fields: val.fields, name: '0' });\n      else fields.push({ type: val.type, name: '0' });\n    }\n    return { type: root, fields };\n  } else if (typeof base === 'object' && !isDate(base)) {\n    const fields: Field[] = [];\n    for (const k in base) {\n      fields.push(getField(k, base[k], flat));\n    }\n    return { type: root, fields };\n  }\n  return { type: root };\n}\n\nfunction getField(name: string, v: any, flat?: boolean): Field {\n  const type = getType(v);\n  if (!flat && (~type.indexOf('object') || type === 'array')) {\n    const cs = inspect(v);\n    if (cs.fields) return { type, fields: cs.fields, name };\n    else return { type, name };\n  }\n  return { type: getType(v), name };\n}\n\nfunction getType(v: any): Type {\n  if (typeof v === 'string') {\n    if (isDate(v)) return 'date';\n    else return 'string';\n  }\n  else if (typeof v === 'number') return 'number';\n  else if (typeof v === 'boolean') return 'boolean';\n  else if (Array.isArray(v)) {\n    if (v.length < 1) return 'array';\n    else if (typeof v[0] === 'string') {\n      if (isDate(v[0])) return 'date[]';\n      else return 'string[]';\n    }\n    else if (typeof v[0] === 'number') return 'number[]';\n    else if (typeof v[0] === 'boolean') return 'boolean[]';\n    else if (isDate(v[0])) return 'date[]';\n    else if (typeof v[0] === 'object') return 'object[]';\n    else return 'array';\n  } else if (typeof v === 'object') {\n    if (isDate(v)) return 'date';\n    else return 'object';\n  } else return 'any';\n}\n\nexport type ValidationResult = ValidationError[] | true;\nexport interface ValidationError {\n  error: string;\n  type?: 'strict'|'check'|'missing';\n  path?: string;\n  actual?: string;\n  expected?: string;\n  value?: any;\n  literal?: boolean;\n}\n\nexport function validate(value: any, schema: Schema|string, mode?: 'strict'|'missing'|'loose'): ValidationResult {\n  if (typeof schema === 'string') {\n    const parsed = parseSchema(schema);\n    if ('message' in parsed) return [{ error: 'invalid schema' }];\n    schema = parsed;\n  }\n\n  if (!schema) schema = { type: 'any' };\n  const ctx = new Root(value, { special: { types: schema.defs || {} } });\n  return _validate(value, schema, mode, '', ctx);\n}\n\nfunction _validate(value: any, schema: Schema, mode: 'strict'|'missing'|'loose', path: string, ctx: Context, required?: boolean): ValidationResult {\n  schema = schema || {};\n  let _schema = schema;\n  const errs: ValidationError[] = [];\n  const miss = mode === 'strict' || mode === 'missing';\n  if (_schema.ref) {\n    let s = _schema;\n    while (s && s.ref) s = safeGet(ctx, `@types.${s.ref}`);\n    if (s) _schema = s;\n    else if (miss) errs.push({ error: `missing type definition '${_schema.ref}'`, type: 'missing' });\n  }\n  let { checks } = _schema;\n  const { type, fields, rest, types, literal } = _schema;\n  if (!checkType(value, schema.type === 'array' ? 'array' : type, literal, required)) return [{ error: `type mismatch for${required ? ' required' : ''} ${type}`, actual: unparseSchema(inspect(value)), value, path, expected: unparseSchema(_schema, true), literal: type === 'literal' }];\n\n  if (_schema !== schema && schema.checks) {\n    if (!checks) checks = schema.checks;\n    else checks = checks.concat(schema.checks);\n  }\n\n  let tmp: ValidationResult;\n\n  if ((type === 'tuple' || type === 'tuple[]') && types) {\n    const arr = ~type.indexOf('[]');\n    const val: any[][] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      if (!Array.isArray(v)) {\n        errs.push({ error: 'expected a tuple', path: p, value: v });\n      } else if (v.length < types.length) {\n        const diff = types.length - v.length;\n        errs.push({ error: `missing ${diff} field${diff > 1 ? 's' : ''} in tuple`, path: p, expected: unparseSchema({ type: 'tuple', types }) });\n      } else {\n        for (let i = 0; i < types.length; i++) {\n          if ((tmp = _validate(v[i], types[i], mode, join(p, `${i}`), extend(ctx, { value: v[i], path: join(p, `${i}`) }))) !== true) errs.push.apply(errs, tmp);\n        }\n\n        if (mode === 'strict' && v.length > types.length) errs.push({ error: `too many values for tuple`, type: 'strict', path: p, expected: unparseSchema({ type: 'tuple', types }) });\n      }\n    }\n  } else if ((type === 'union' || type === 'union[]') && types) {\n    const arr = ~type.indexOf('[]');\n    const val: any[] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      let ok = false;\n      let legit: ValidationError[];\n      for (const u of types) {\n        if ((tmp = _validate(v, u, mode, p, ctx)) === true) {\n          ok = true;\n          break;\n        } else if (miss && tmp.find(e => e.type === 'missing') || tmp.find(e => e.type === 'check')) {\n          const t = tmp.filter(e => miss && e.type === 'missing' || e.type === 'check');\n        } else if (tmp.find(e => e.path !== p))  {\n          if (!legit) legit = tmp\n          else if (tmp.length < legit.length) legit = tmp;\n          else if (legit.filter(e => e.literal).length > tmp.filter(e => e.literal).length) legit = tmp;\n        }\n      }\n      if (!ok && !legit) errs.push({ error: `type mismatch for union`, actual: unparseSchema(inspect(v)), expected: unparseSchema({ type: 'union', types }), value: v, path: p });\n      else if (!ok && legit) errs.push.apply(errs, legit);\n    }\n  } else if ((type === 'object' || type === 'object[]' || type === 'any') && fields || rest) {\n    const arr = ~type.indexOf('[]') || schema.type === 'array';\n    const val: object[] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      if (typeof v !== 'object' && typeof v !== 'function') {\n        errs.push({ error: 'expected an object', value: v, path: p, actual: unparseSchema(inspect(v), true) });\n        continue;\n      }\n      if (fields) {\n        for (const f of fields) {\n          if (f.required && !(f.name in v)) errs.push({ error: `required field '${f.name}' is missing`, path: join(p, f.name), expected: f.type });\n          else if (v && f.name in v && (tmp = _validate(v[f.name], f, mode, join(p, f.name), extend(ctx, { value: v[f.name], path: join(p, f.name) }), f.required)) !== true) errs.push.apply(errs, tmp);\n        }\n      }\n      if (rest && v) {\n        for (const k in v) {\n          if (fields && fields.find(f => f.name === k)) continue;\n          if (v[k] != null && (tmp = _validate(v[k], rest, mode, join(p, k), extend(ctx, { value: v[k], path: join(p, k) }))) !== true) errs.push.apply(errs, tmp);\n        }\n      } else if (mode === 'strict' && v) {\n        for (const k in v) if (v[k] != null && !fields || !fields.find(f => f.name === k)) errs.push({ error: `unknown field '${k}'`, path: p, type: 'strict', value: v[k] });\n      }\n    }\n  }\n\n  if (!errs.length && checks && checks.length) {\n    let tmp: any;\n    for (let i = 0; i < checks.length; i++) {\n      const c = checks[i];\n      tmp = evalApply(ctx, c, [value]);\n      if (!tmp || typeof tmp == 'string') errs.push({ error: typeof tmp !== 'string' || !tmp ? `check ${i + 1} failed` : tmp, path, value, type: 'check', expected: unparseSchema(schema, true) });\n    }\n  }\n\n  return errs.length ? errs : true;\n}\n\nconst values = ['string', 'number', 'boolean', 'object'];\nexport function checkType(value: any, type?: Type, literal?: any, required?: boolean): boolean {\n  switch (type || 'any') {\n    case 'any':\n    case 'union':\n      return true;\n\n    case 'value': return !Array.isArray(value) && !!~values.indexOf(typeof value) && (typeof value !== 'object' || isDate(value));\n    case 'value[]': return Array.isArray(value) && value.reduce((a, c) => a && !Array.isArray(c) && !!~values.indexOf(typeof c) && (typeof c !== 'object' || isDate(c)), true);\n\n    case 'array':\n    case 'tuple':\n    case 'union[]':\n    case 'tuple[]':\n      return Array.isArray(value);\n\n    case 'literal': return value === literal;\n\n    case 'string': return typeof value === 'string';\n    case 'number': return typeof value === 'number';\n    case 'boolean': return typeof value === 'boolean';\n    case 'date': return isDate(value);\n    case 'object': return !Array.isArray(value) && typeof value === 'object' && (!required || value != null);\n    case 'string[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'string', true);\n    case 'number[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'number', true);\n    case 'boolean[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'boolean', true);\n    case 'date[]': return Array.isArray(value) && value.reduce((a, c) => a && isDate(c), true);\n    case 'object[]': return Array.isArray(value) && value.reduce((a, c) => a && !Array.isArray(c) && typeof c === 'object' && (!required || c != null), true);\n  }\n}\n","import { parser, ParseOptions, ParseNode, ParseError, concat, IParser, bracket, readTo, rep1sep, alt, map, repsep, rep, seq, skip, str, verify } from 'sprunge';\n\nexport const DEFAULTS = {\n  record: '\\n',\n  field: ',',\n  header: false,\n  quote: '\"',\n};\n\nexport function csv(options?: CSVOptions) {\n  const opts: typeof DEFAULTS = Object.assign({}, DEFAULTS, options);\n\n  const ws = skip(' \\t\\r\\n'.replace(opts.field, '').replace(opts.record, '').replace(opts.quote, ''));\n  const quote = str(opts.quote || '\"');\n  const quotedField = bracket(seq(ws, quote), map(rep(alt(readTo(opts.quote || '\"'), map(seq(quote, quote), () => ''))), r => concat(r)), seq(quote, ws));\n  const unquotedField = readTo(opts.record + opts.field, true);\n  const field: IParser<string> = opts.quote ? alt(quotedField, unquotedField) : unquotedField;\n  const record = verify(rep1sep(field, seq(ws, str(opts.field), ws)), s => s.length > 1 || s[0].length > 0 || 'empty record');\n  const csv: IParser<string[][]> = map(seq(skip(' \\r\\n\\t'), repsep(record, str(opts.record), 'allow'), skip(' \\r\\n\\t')), ([, csv]) => csv);\n\n  const _parse = parser(csv, { consumeAll: true });\n\n  return function parse(input: string, options?: ParseOptions) {\n    const res: ParseNode|string[][]|ParseError = _parse(input, options);\n    if (Array.isArray(res) && res.length > 0) {\n      let header: Array<[string, number]> = undefined;\n      if (Array.isArray(opts.header)) header = opts.header.map((k, i) => [k, i]);\n      else if (typeof opts.header === 'object') header = res.shift().map((k, i) => [opts.header[k] ?? k, i]).filter(o => o[0]) as any[];\n      else if (!!opts.header) header = res.shift().map((k, i) => [k, i]);\n      if (header) {\n        if ((opts as any).order !== false) header.sort((a, b) => `${a}`.toLowerCase() < `${b}`.toLowerCase() ? -1 : `${a}`.toLowerCase() > `${b}`.toLowerCase() ? 1 : 0);\n        return res.map(v => header.reduce((a, c) => (a[c[0]] = v[c[1]], a), {} as any));\n      }\n    }\n\n    return res;\n  }\n}\n\nexport interface CSVOptions {\n  field: string;\n  record: string;\n  quote: string;\n  fixedSize?: boolean;\n  order?: boolean;\n  header?: boolean|string[]|{[k: string]:any};\n}\n\n// TODO: handle ascii curses tables?\n\nexport function table(options?: TableOptions) {\n  const opts = Object.assign({ header: true }, options);\n\n  return function parse(input: string, options?: ParseOptions) {\n    const parts = input.split(/\\r?\\n/).filter(v => v);\n    \n    if (parts[1][0] === '|') {\n      for (let i = 0; i < parts.length; i++) {\n        const p = parts[i];\n        parts[i] = p.replace(/^\\|\\s*|\\s*\\|$/g, '');\n      }\n    }\n\n    return parts.map(p => p.trim().split(/\\s*\\|\\s*/));\n  }\n}\n\nexport interface TableOptions {\n  table: 1;\n  header?: boolean;\n  fixedSize?: boolean;\n  order?: boolean;\n}\n\nexport type DelimitedOptions = CSVOptions | TableOptions;\n\nconst fields = [',', '|', '\\t', ':', ';', '~'];\nconst records = ['\\r\\n', '\\r', '\\n'];\nconst quotes = ['\\'', '\"', '`', '$'];\n\nexport function detect(data: string, amount?: number): DelimitedOptions {\n  if (amount === undefined) {\n    amount = data.indexOf('\\n', data.indexOf('\\n', data.indexOf('\\n', 1) + 1) + 1);\n    amount = amount ?? 2048;\n    if (amount < 2048) amount = 2048;\n  }\n  const sample = data.slice(0, amount);\n  // look for tables\n  if (sample.split(/\\r?\\n/).filter(v => v)[1]?.match(/^[-|+\\s_=]+$/)) {\n    return { table: 1, header: true };\n  }\n\n  const fs = fields.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n  const rs = records.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n  const qs = quotes.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n\n  const res = { field: ',', record: '\\n', quote: '\"' };\n\n  let max = 0;\n  for (const k in fs) if (fs[k] > max) (res.field = k, max = fs[k]);\n  max = 0;\n  for (const k in rs) if (rs[k] > max) (res.record = k, max = rs[k]);\n  max = 0;\n  for (const k in qs) if (qs[k] > max) (res.quote = k, max = qs[k]);\n\n  return res;\n}\n\nfunction isTableOpts(opts?: DelimitedOptions): opts is TableOptions {\n  return opts && 'table' in opts && opts.table === 1;\n}\n\nexport function parse(data: string, options?: DelimitedOptions & { header: true|1|string[]|{[k: string]: any} }): any[];\nexport function parse(data: string, options?: DelimitedOptions & { header?: false }): string[][];\nexport function parse(data: string, options?: DelimitedOptions): Array<string[]|any> {\n  let values: string[][];\n  if (isTableOpts(options)) {\n    values = table(options)(data);\n    values.splice(1, 1);\n  } else {\n    const base = csv(Object.assign({}, options, { header: false }))(data);\n    if ('message' in base) return [];\n    values = base;\n  }\n\n  if (options.fixedSize ?? true) {\n    const min = values[0]?.length;\n    values = values.filter(v => v.length >= min);\n  }\n\n  if (options.header && values.length) {\n    let header: Array<[string, number]> = undefined;\n    if (Array.isArray(options.header)) {\n      header = options.header.map((k, i) => [k, i]);\n      if (isTableOpts(options)) values.shift();\n    } else if (typeof options.header === 'object') {\n      header = values.shift().map((k, i) => [options.header[k] ?? k, i]).filter(o => o[0]) as any[];\n    } else if (!!options.header) header = values.shift().map((k, i) => [k, i]);\n    if (header) {\n      if (options?.order !== false) header.sort((a, b) => `${a}`.toLowerCase() < `${b}`.toLowerCase() ? -1 : `${a}`.toLowerCase() > `${b}`.toLowerCase() ? 1 : 0);\n      return values.map(v => header.reduce((a, c) => (a[c[0]] = v[c[1]], a), {} as any));\n    }\n  }\n  return values;\n}\n","import { Parser, parser as makeParser, opt, repsep, seq, alt, map, readTo, read1To, rep1, rep, str, read, read1, chars } from 'sprunge';\n\nconst ws = read(' \\r\\n\\t');\nconst endTxt = '&<';\n\nconst entities = { amp: '&', gt: '>', lt: '<' };\nconst entity = map(seq(str('&'), str('amp', 'gt', 'lt'), str(';')), ([,which]) => entities[which] || '', 'entity');\n\nconst name = read1('abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-_:$', 'name');\nconst attr = map(seq(name, opt(seq(ws, str('='), ws, alt(name, quoted('\"'), quoted(\"'\"))))), ([name, rest]) => ({ name, value: rest ? rest[3] : true}), 'attr');\n\nfunction quoted(quote: string) {\n  return map(seq(str(quote), readTo(quote), str(quote)), ([,str]) => str);\n}\n\ninterface Attr {\n  name: string;\n  value: string|boolean;\n}\n\ninterface Open {\n  open: true;\n  name: string;\n  attrs?: Attr[];\n  empty?: boolean;\n}\n\ninterface Close {\n  close: true;\n  name: string;\n}\n\nconst open = map(seq(str('<'), ws, name, ws, repsep(attr, ws, 'allow'), opt(str('/')), str('>')), ([,,name,,attrs,close]) => ({ open: true, name, attrs, empty: !!close } as Open), 'open');\nconst close = map(seq(str('</'), ws, name, ws, str('>')), ([,,name]) => ({ close: true, name } as Close), 'close');\n\nconst content = map(rep1(alt(read1To(endTxt, true), entity), 'content'), txts => txts.join('').trim());\n\nconst stream = rep(alt<string|Open|Close>(open, content, close));\n\nconst _parse = makeParser(stream, { trim: true, consumeAll: true, undefinedOnError: true });\n\nfunction put(target: object, prop: string, value: any) {\n  if (prop in target) {\n    if (Array.isArray(target[prop])) target[prop].push(value);\n    else target[prop] = [target[prop], value];\n  } else {\n    target[prop] = value;\n  }\n}\n\nexport function parse(str: string, strict?: boolean): any {\n  const stack: any[] = [];\n  const names: string[] = [];\n  const res: any[] = [];\n  let content = '';\n  const stream = _parse(str) as Array<string|Open|Close>;\n  if (!stream || 'error' in stream) return undefined;\n\n  function close(end: string) {\n    const val = stack.pop();\n    if (!val) return;\n    const name = names.pop();\n    if (!stack.length) {\n      res.push(val);\n    } else {\n      if (!Object.keys(val).length) put(stack[stack.length - 1], name, content || '');\n      else put(stack[stack.length - 1], name, val);\n    }\n    if (end !== name) close(end);\n  }\n\n  for (const p of stream) {\n    if (typeof p === 'string') {\n      if (p) content += p;\n    } else if ('open' in p) {\n      content = '';\n      const val = p.attrs.reduce((a, c) => (put(a, c.name, c.value), a), {});\n      if (p.empty) {\n        if (stack.length) put(stack[stack.length - 1], p.name, val);\n        else res.push(val);\n      } else {\n        names.push(p.name);\n        stack.push(val);\n      }\n    } else if ('close' in p) {\n      if (strict && p.name !== names[names.length - 1]) return;\n      close(p.name);\n    }\n  }\n\n  if (names.length && !strict) close(names[0]);\n\n  return res.length > 1 ? res : res.length === 1 ? res[0] : undefined;\n}\n","import { filter, safeGet, safeSet, registerOperator, CheckResult, ValueOperator, ValueOrExpr, Context, evaluate, evalApply, evalValue, evalParse, template, extend, formats, virtualFormats, registerFormat, dateRelToRange, dateRelToExactRange, dateRelToDate, isDateRel, isKeypath, isTimespan, isApplication, dateAndTimespan, addTimespan, isValue, datesDiff, DateRel, getOperator, applyOperator, OperatorOptions, sort, toDataSet, Root } from './index';\nimport { date, dollar, ordinal, number, phone } from './format';\nimport { timespans, isTimespanMS, timeSpanToNumber, parseTime, parseDate, parseExpr, parse } from './parse';\nimport { parse as parseTemplate } from './parse/template';\nimport { parseSchema, unparseSchema } from './parse/schema';\nimport { stringify } from './parse/stringify';\nimport { range as parseRange, ParseError } from './parse/range';\nimport { validate, inspect, isSchema } from './schema';\nimport { diff, deepEqual, labelDiff } from './diff';\nimport { detect as csvDetect, parse as csvParse } from './csv';\nimport { style } from './parse/style';\nimport { parse as parseXML } from './parse/xml';\nimport { measure, escapeHTML } from '../render/index';\n\nfunction simple(names: string[], apply: (name: string, values: any[], opts: OperatorOptions, ctx: Context) => any): ValueOperator {\n  return {\n    type: 'value', names, apply\n  };\n}\n\nconst spanMap = {\n  y: [0, 12],\n  M: [1, 30],\n  d: [2, 24],\n};\n\nconst generateDefaults = {\n  max: 10000,\n};\n\nfunction stringTimes(str: string, times: number): string {\n  let res = '';\n  for (let i = 0; i < times; i++) res += str;\n  return res;\n}\n\ntype RoundingMethod = 'half-up'|'half-down'|'half-even'|'half-odd'|'half-to-0'|'half-from-0'|'to-0'|'from-0'|'up'|'down';\nconst roundDefaults = {\n  places: 2,\n  'all-numeric': false,\n  method: 'half-even' as RoundingMethod,\n};\nexport function round(amt: string|number, settings?: { places: number; method: RoundingMethod }): string {\n  const place = settings?.places ?? roundDefaults.places;\n  const type = settings?.method ?? roundDefaults.method;\n  if (place > 0) {\n    let str = (+amt || 0).toString();\n    const point = str.indexOf('.');\n    if (!~point) return (+str).toFixed(place);\n    let dec = str.slice(point + 1);\n    if (dec.length <= place) return (+str).toFixed(place);\n    str += '0';\n    dec += '0';\n    const l = +`${str.slice(place - dec.length, place - dec.length + 1)}` || 0;\n    const rest = parseInt(str.slice(place - dec.length) + '0');\n    if (type === 'up' && rest > 0) {\n      if (+amt > 0) return (+str.slice(0, place - dec.length) + +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return str.slice(0, place - dec.length);\n    } else if (type === 'down' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, place - dec.length) - +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return str.slice(0, place - dec.length);\n    } else if (type === 'to-0' && rest > 0) {\n      return str.slice(0, place - dec.length);\n    } else if (type === 'from-0' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, place - dec.length) - +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return (+str.slice(0, place - dec.length) + +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n    }\n    if (+l < 5) return str.slice(0, place - dec.length);\n    else if (+l > 5 || +`${str.slice(1 + place - dec.length)}`) return (+amt).toFixed(place);\n    else {\n      const pre = `${str.slice(0, place - dec.length)}`;\n      const f = +str.slice(place - dec.length - 1, place - dec.length);\n      if (type === 'half-odd') return (+`${pre}${f % 2 === 0 ? 6 : 4}`).toFixed(place);\n      else if (type === 'half-up') return (+`${pre}${+pre > 0 ? 6 : 4}`).toFixed(place);\n      else if (type === 'half-down') return (+`${pre}${+pre > 0 ? 4 : 6}`).toFixed(place);\n      else if (type === 'half-to-0') return (+`${pre}4`).toFixed(place);\n      else if (type === 'half-from-0') return (+`${pre}6`).toFixed(place);\n      else return (+`${pre}${f % 2 === 0 ? 4 : 6}`).toFixed(place);\n    }\n  } else if (place === 0) {\n    let str = (+amt || 0).toString();\n    const point = str.indexOf('.');\n    if (!~point) return str;\n    str = `${str}00`;\n    const p = +str.slice(point - 1, point);\n    const n = +str.slice(point + 1, point + 2);\n    const rest = parseInt(str.slice(point + 1) + '0');\n    if (type === 'up' && rest > 0) {\n      if (+amt > 0) return (+str.slice(0, point) + 1).toFixed(0);\n      else return str.slice(0, point);\n    } else if (type === 'down' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, point) - 1).toFixed(0);\n      else return str.slice(0, point);\n    } else if (type === 'to-0' && rest > 0) {\n      return str.slice(0, point);\n    } else if (type === 'from-0' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, point) - 1).toFixed(0);\n      else if (+amt > 0) return (+str.slice(0, point) + 1).toFixed(0);\n    }\n    if (n < 5) return str.slice(0, point);\n    else if (n > 5 || n === 5 && +str.slice(point + 2)) return (+`${str.slice(0, point - 1)}0` + (p + 1) * (+str < 0 ? -1 : 1)).toString();\n    else {\n      const base = +`${str.slice(0, point - 1)}0`;\n      if (type === 'half-odd') return (base + (p % 2 === 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-up') return (base + (+str > 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-down') return (base + (+str < 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-to-0') return base.toString();\n      else if (type === 'half-from-0') return (base + 1).toString();\n      else return (base + (p % 2 === 0 ? p : p + 1) * (+str < 0 ? -1 : 1)).toString();\n    }\n  } else {\n    let str = `${+amt < 0 ? Math.floor(+amt || 0) : Math.ceil(+amt || 0)}`;\n    if (0 - place > str.length && type !== 'up' && type !== 'down' && type !== 'to-0' && type !== 'from-0') return `0`;\n    const n = +str.slice(place, place === -1 ? undefined : place + 1);\n    const rest = +(str.slice(place) + '0');\n    let p = str.slice(place - 1, place);\n    if (p === '-') p = '';\n    const zeroes = `${Math.pow(10, 0 - place).toString().slice(1)}`\n    if (!p) {\n      const big = `${+str < 0 ? '-' : ''}1${zeroes}`;\n      if (type === 'up') {\n        if (+amt > 0) return big;\n        else return '0';\n      } else if (type === 'down') {\n        if (+amt < 0) return big;\n        else return '0';\n      } else if (type === 'to-0') {\n        return '0';\n      } else if (type === 'from-0') {\n        return big;\n      }\n      if (+str > 0 && +str < 5 || +str < 0 && +str > -5) return '0';\n      else if (+str > 0 && +str > 5 || +str < 0 && +str < -5) return big;\n      else {\n        if (type === 'half-odd') return big;\n        else if (type === 'half-up') return +str > 0 ? big : '0';\n        else if (type === 'half-down') return +str > 0 ? '0' : big;\n        else if (type === 'half-to-0') return '0';\n        else if (type === 'half-from-0') return big;\n        else return '0';\n      }\n    } else {\n      if (type === 'up' && rest > 0) {\n        if (+str > 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) + +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        else return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'down' && rest > 0) {\n        if (+str < 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) - +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        else return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'to-0' && rest > 0) {\n        return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'from-0' && rest > 0) {\n        if (+str > 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) + +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        return (+(str.slice(0, place) + stringTimes('0', place * -1)) - +`1${stringTimes('0', place * -1)}`).toFixed(0);\n      }\n      if (n < 5) return `${str.slice(0, place)}${zeroes}`\n      else if (n > 5 || place < -1 && +`${str.slice(place + 1)}`) return (+`${+str.slice(0, place - 1) || 0}${0}${zeroes}` + +`${+p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n      else {\n        const base = +`${str.slice(0, place - 1) || 0}0${zeroes}`;\n        if (type === 'half-odd') return (base + +`${+p % 2 === 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-up') return (base + +`${+str > 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-down') return (base + +`${+str < 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-to-0') return (base + +`${+p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-from-0') return (base + +`${+p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else return (base + +`${+p % 2 === 0 ? +p : +p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n      }\n    }\n  }\n}\n\nconst hasNum = /^[^\\d]*(\\d+(?:\\.\\d*)?)/;\n\nconst space = /^\\s*$/;\nfunction isNum(v: any): v is number {\n  return !isNaN(v) && !space.test(v);\n}\nfunction num(v: any): number {\n  if (isNaN(v) || !v) return 0;\n  return +v;\n}\n\nfunction equals(l: any, r: any): boolean {\n  if (l === r || l == r) return true; // eslint-disable-line eqeqeq\n  if (isDateRel(l) && isDateRel(r)) return +dateRelToDate(l) === +dateRelToDate(r);\n  if (typeof l === 'number' && typeof r === 'number') return isNaN(l) && isNaN(r);\n  return false;\n}\n\n/**\n * Find the first overlapping substring that contains threshhold percent characters of the smallest string length.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the percentage of the smaller string length needed to match\n * @returns - the substring that matches\n */\nexport function overlap(a: string, b: string, threshhold: number = 0.5): string {\n  const res = similar(a, b, threshhold, 0);\n  return res && res[1] || undefined;\n}\n\n/**\n * Finds the percentage similarity between two strings based on a minimum threshhold and a fudge factor. The minimum threshhold determins the earliest that the search can return. The fudge factor allows skipping characters in either string, though there is no backtracking.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the required similarity between two substrings, accounting for the fudge factor\n * @param fudges - the number skippable characters in either string without a match\n * @param whole - adjust the similarity account for the whole string rather than only the first matching substring\n * @returns - the similarity of the first qualifying match\n */\nexport function similarity(a: string, b: string, threshhold: number = 0.5, fudges: number = 2, whole = false): number {\n  const res = similar(a, b, threshhold, fudges);\n  if (res && whole) return (res[2] || 0) * (((res[0].length / a.length) + (res[1].length / b.length)) / 2);\n  return res && res[2] || 0;\n}\n\n/**\n * Finds the similarity between two strings based on a minimum threshhold and a fudge factor. The minimum threshhold determins the earliest that the search can return. The fudge factor allows skipping characters in either string, though there is no backtracking.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the required similarity between two substrings, accounting for the fudge factor\n * @param fudges - the number skippable characters in either string without a match\n * @returns - a tuple of the substrings from each string and the similarity percentage, accounting for the fudge factor\n */\nexport function similar(a: string, b: string, threshhold: number = 0.5, fudges: number = 2): [string, string, number] {\n  if (!a || !b) return;\n  const aa = a.toLowerCase();\n  const bb = b.toLowerCase();\n\n  // check containment\n  if (~aa.indexOf(bb)) bb;\n  if (~bb.indexOf(aa)) aa;\n\n  let i1 = 0;\n  let i2 = 0;\n  let oa = 0;\n  let ob = 0;\n  let f = 0;\n  let f1 = 0;\n  let f2 = 0;\n  let fs = 0;\n  let sim = 0;\n\n  const alen = a.length;\n  const blen = b.length;\n  let aolen = 0;\n  let bolen = 0;\n\n  // walk a\n  for (i1 = 0; i1 < alen; i1++) {\n    // walk b\n    for (i2 = 0; i2 < blen; i2++) {\n      // if there's a match, see how far it goes\n      if (aa[i1] === bb[i2]) {\n        aolen = alen - i1;\n        bolen = blen - i2;\n        fs = 0;\n        // walk the remaining pieces of each string checking for matches\n        matchy: for (oa = 1, ob = 1; oa < aolen && ob < bolen;) {\n          if (aa[i1 + oa] === bb[i2 + ob]) { // nailed it\n            oa++, ob++;\n          } else { // not so much, so compare closer chars in each string, walking outward\n            for (f = 0; f <= fudges; f++) {\n              for (f1 = 0; f1 <= f; f1++) {\n                for (f2 = 0; f2 <= f; f2++) {\n                  if (aa[i1 + oa + f1] === bb[i2 + ob + f2]) {\n                    oa += f1;\n                    ob += f2;\n                    fs += Math.max(f1, f2); // keep track of the fudge factor\n                    continue matchy;\n                  }\n                }\n              }\n            }\n            break matchy; // not even fudge could save it\n          }\n        }\n\n        sim = (Math.max(oa, ob) - fs) / Math.min(aa.length, bb.length); // get approximate similarity\n        if (sim >= threshhold) return [aa.substr(i1, oa), bb.substr(i2, ob), sim]; // and if it exceeds the threshold, we're good\n      }\n    }\n  }\n}\n\nexport function inRange(v: number, range: Array<number|[number, number]|{ not: number|[number, number] }>): boolean {\n  let found = false;\n  let excluded = false;\n  for (const r of range) {\n    if (Array.isArray(r) && v >= r[0] && v <= r[1]) found = true;\n    else if (typeof r === 'object' && 'not' in r) {\n      if (Array.isArray(r.not) && v >= r.not[0] && v <= r.not[1]) excluded = true;\n      else if (v == r.not) excluded = true;\n    } else if (v == r) found = true;\n  }\n  return found && !excluded;\n}\n\n// basic ops\nregisterOperator(\n  simple(['is', 'is-not', '==', '!='], (name: string, values: any[]): boolean => {\n    const [l, r] = values;\n    let cmp = equals(l, r);\n    if (!cmp && (name === 'is' || name === 'is-not') && isSchema(r)) cmp = validate(l, r, 'loose') === true;\n    return name === 'is' || name === '==' ? cmp : !cmp;\n  }),\n  simple(['strict-is', 'strict-is-not'], (name: string, values: any[]): boolean => {\n    const [l, r] = values;\n    let res = l === r;\n    if (!res && isSchema(r)) res = validate(l, r, 'strict') === true;\n    return name === 'strict-is' ? res : !res;\n  }),\n  simple(['deep-is', 'deep-is-not', '===', '!=='], (name: string, [l, r, equal]: any[], opts, ctx: Context): boolean => {\n    equal = equal || opts?.equal;\n    if (equal && isApplication(equal)) {\n      const eq = equal;\n      equal = (l: any, r: any) => evalApply(ctx, eq, [l, r]);\n    }\n    const res = deepEqual(l, r, equal);\n    return name === 'deep-is' || name === '===' ? res : !res;\n  }),\n  simple(['not'], (_name: string, values: any[]) => !values[0]),\n  simple(['<', '>', '<=', '>=', 'gt', 'gte', 'lt', 'lte'], (name: string, values: any[]): boolean => {\n    if (name === 'gt') name = '>';\n    else if (name === 'lt') name = '<';\n    else if (name === 'gte') name = '>=';\n    else if (name === 'lte') name = '<=';\n    let [l, r] = values;\n    if (l instanceof Date || r instanceof Date) {\n      if (typeof l === 'number' || typeof r === 'number') {\n        l = +l; r = +r;\n      } else if (typeof l === 'string' || typeof r === 'string') {\n        l = new Date(l); r = new Date(r);\n      } else if (l && 'f' in l && 'o' in l) {\n        l = dateRelToRange(l)[name[0] === '<' ? 1 : 0];\n        r = new Date(r);\n      } else if (r && 'f' in r && 'o' in r) {\n        r = dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1];\n        l = new Date(l);\n      }\n    } else if (isDateRel(l)) {\n      l = dateRelToRange(l)[name[0] === '<' ? 1 : 0];\n      r = isDateRel(r) ? dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1] : new Date(r);\n    } else if (isDateRel(r)) {\n      r = dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1];\n      l = new Date(l);\n    }\n    return name === '<' ? l < r :\n      name === '>' ? l > r :\n        name === '<=' ? l <= r :\n          name === '>=' ? l >= r :\n            false;\n  }),\n  simple(['like', 'not-like', 'ilike', 'not-ilike'], (name: string, values: any[]): boolean => {\n    const [target, pattern, arg] = values;\n    let res: boolean = false;\n    const patterns = typeof pattern === 'string' ? [pattern] : pattern;\n    const free = arg === 'free' || (typeof arg === 'object' && arg.free);\n    if (!Array.isArray(patterns)) return false;\n    for (let i = 0; i < patterns.length && !res; i++) {\n      const r = patterns[i];\n      if (typeof r !== 'string') continue;\n      const re = new RegExp(`${free ? '' : '^'}${r.replace(/[\\s\\%\\*]+/g, '[\\\\s\\\\S]*').replace(/\\?/g, '.')}${free ? '' : '$'}`, ~name.indexOf('ilike') ? 'i' : '');\n      if (Array.isArray(target)) res = !!target.find(v => re.test(v));\n      else res = re.test(target);\n    }\n    return name === 'like' || name === 'ilike' ? res : !res;\n  }),\n  simple(['in', 'not-in'], (name: string, values: any[], _opts, ctx: Context): boolean => {\n    const [l, r] = values;\n    let range: any;\n    if (isDateRel(r)) {\n      const range = dateRelToRange(r);\n      const d = isDateRel(l) ? dateRelToRange(l)[0] : new Date(l);\n      const n = d >= range[0] && d <= range[1];\n      return name === 'in' ? n : !n;\n    } else if (typeof l === 'string' && typeof r === 'object' && !Array.isArray(r)) {\n      return l in r;\n    } else if (Array.isArray(l) && l.length > 0 && typeof l[0] === 'string' && !Array.isArray(r) && r && typeof r === 'object') {\n      const keys = Object.keys(r);\n      const found = l.reduce((a, c) => a && ~keys.indexOf(c), true);\n      return name === 'in' ? found : !found;\n    } else if (typeof r === 'string' && isNum(l) && (range = _parseRange(ctx, r), Array.isArray(range))) {\n      const found = inRange(+l, range);\n      return name === 'in' ? found : !found;\n    } else if (isApplication(l)) {\n      let found: any = false;\n      if (Array.isArray(r) || r && typeof r === 'object' && '0' in r) found = Array.prototype.find.call(r, (e: any, i: number) => evalApply(ctx, l, [e, i], { index: i, key: i }));\n      else if (r && typeof r === 'object') found = Object.entries(r).find((e, i) => evalApply(ctx, l, [e[1], i, e[0]], { index: i, key: e[0] }));\n      return name === 'in' ? !!found : !found;\n    } else if (!Array.isArray(r) && typeof r !== 'string') {\n      return name === 'in' ? l == r : l != r;\n    } else if (Array.isArray(l) && Array.isArray(r)) {\n      const b = l.reduce((a, c) => a && ~r.indexOf(c), true);\n      return name === 'in' ? !!b : !b;\n    }\n    const res = !!~r.indexOf(l);\n    return name === 'in' ? res : !res;\n  }), \n  simple(['contains', 'does-not-contain'], (name: string, values: any[], _opts, ctx: Context): boolean => {\n    const [l, r] = values;\n    if (isDateRel(l)) {\n      const range = dateRelToRange(l);\n      const d = isDateRel(r) ? dateRelToRange(r)[0] : new Date(r);\n      const n = d >= range[0] && d <= range[1];\n      return name === 'contains' ? n : !n;\n    } else if (isApplication(r)) {\n      let found: any = false;\n      if (Array.isArray(l) || l && typeof l === 'object' && '0' in l) found = Array.prototype.find.call(l, (e: any, i: number) => evalApply(ctx, r, [e, i], { index: i, key: i }));\n      else if (r && typeof l === 'object') found = Object.entries(l).find((e, i) => evalApply(ctx, r, [e[1], i, e[0]], { index: i, key: e[0] }));\n      return name === 'contains' ? !!found : !found;\n    } else if (!Array.isArray(l) && typeof l !== 'string') {\n      return false;\n    } else if (Array.isArray(r) && Array.isArray(l)) {\n      const b = r.reduce((a, c) => a && ~l.indexOf(c), true);\n      return name === 'contains' ? !!b : !b;\n    }\n    const res = !!~l.indexOf(r);\n    return name === 'contains' ? res : !res;\n  }),\n  simple(['clamp'], (_name, [min, v, max]: any[]): any => {\n    return v < min ? min : v > max ? max : v;\n  }),\n  simple(['get'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    const [l, r] = values;\n    const c = extend(ctx, { value: l });\n    if (isKeypath(r)) return safeGet(c, r);\n    else if (typeof r === 'number') return safeGet(c, '' + r);\n    else return evaluate(c, r);\n  }),\n  simple(['generate'], (_name: string, [apply], opts, ctx) => {\n    let r: ParseError|Array<number|[number, number]|{ not: number|[number, number] }>;\n    if (apply && isApplication(apply)) {\n      const res = [];\n      let state = opts;\n      let it: any;\n      for (let i = 0; i < generateDefaults.max; i++) {\n        it = evalApply(ctx, apply, [state, it, i], { index: i, last: it, state });\n        if (Array.isArray(it)) it.forEach(v => res.push(v));\n        else if (it && typeof it === 'object') {\n          const keys = Object.keys(it);\n          if (keys.find(k => k !== 'value' && k !== 'state')) res.push(it);\n          else {\n            res.push(it.value);\n            state = it.state || state;\n            it = it.value;\n          }\n        } else if (it === undefined) break;\n        else res.push(it);\n      }\n      return res;\n    } else if ((r = parseRange(apply)) && Array.isArray(r)) {\n      r = r.filter(v => typeof v === 'number' || Array.isArray(v) && !v.find(v => v === Infinity || v === -Infinity) || typeof v === 'object' && !Array.isArray(v));\n      const nums: number[] = [];\n      const no: Array<[number, number]> = [];\n      for (const v of r) if (typeof v === 'object' && !Array.isArray(v)) no.push(typeof v.not === 'number' ? [v.not, v.not] : v.not);\n\n      for (const v of r) {\n        if (nums.length >= generateDefaults.max) break;\n        if (typeof v === 'number' && !no.find(([l, r]) => v >= l && v <= r)) nums.push(v);\n        else if (Array.isArray(v)) {\n          for (let i = v[0]; i <= v[1]; i++) {\n            if (!no.find(([l, r]) => i >= l && i <= r)) nums.push(i);\n            if (nums.length >= generateDefaults.max) break;\n          }\n        }\n      }\n\n      return nums;\n    }\n    return [];\n  }),\n  simple(['array'], (_name: string, values: any[], opts) => {\n    if (values.length === 1 && opts?.range) {\n      let range = values[0];\n      if (typeof range === 'string') range = parseRange(range);\n      if (Array.isArray(range)) {\n        const bounds = Array.isArray(opts.bounds) && opts.bounds.length === 2 && opts.bounds.filter(b => typeof b === 'number').length === 2 ? opts.bounds : [-100, 200];\n        bounds.slice().sort((l, r) => l < r ? -1 : l > r ? 1 : 0);\n        let [lower, upper] = bounds;\n        if (upper - lower > 10000) lower = upper - 10000;\n        const res = [];\n        for (let i = lower; i <= upper; i++) if (inRange(i, range)) res.push(i);\n        return res;\n      } else return [];\n    }\n    return values;\n  }),\n  simple(['object'], (_name: string, values: any[]) => {\n    const res: any = {};\n    if (values.length === 1 && Array.isArray(values[0])) values = values[0];\n    for (let i = 0; i < values.length; i += 2) {\n      res[values[i]] = values[i + 1];\n    }\n    return res;\n  }),\n  simple(['split'], (_name: string, [str, split]: any[]) => {\n    if (typeof str !== 'string') return [str];\n    else return str.split(split || '');\n  }),\n  simple(['filter'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, flt, sorts, groups] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else if (typeof arr === 'object' && arr) {\n        let step = Object.entries(arr).filter((e, i) => evalApply(ctx, flt, [e[1], i, e[0]], { index: i, key: e[0] }));\n        if (sorts) step = sort(ctx, step, sorts, (c, b, v) => evalApply(c, b, [v[1], v[0]], { key: v[0] }));\n        return step.reduce((a, c) => (a[c[0]] = c[1], a), {});\n      }\n      else return [];\n    }\n    return filter({ value: arr }, flt, sorts, groups, ctx).value;\n  }),\n  simple(['source'], (_name: string, values: any[], _opts, ctx): any => {\n    const [val, app] = values;\n    let source = toDataSet(val);\n    if (isApplication(app)) return evalApply(ctx, app, [], { source });\n    return source;\n  }),\n  simple(['group'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, groups] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else return {};\n    }\n    return filter({ value: arr }, null, null, groups, ctx).value;\n  }),\n  simple(['sort'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, sorts] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else if (arr && typeof arr === 'object') {\n        if (!sorts) sorts = [{ a: { r: { p: '@', k: ['key'] } } }];\n        return sort(ctx, Object.entries(arr), sorts, (c, b, v) => evalApply(c, b, [v[1], v[0]], { key: v[0] })).reduce((a, c) => (a[c[0]] = c[1], a), {});\n      }\n      else return {};\n    }\n    if (!sorts) sorts = [{ a: { r: { k: ['_'] } } }];\n    return sort(ctx, arr.slice(), sorts);\n  }),\n  simple(['time-span', 'time-span-ms'], (_name: string, args: any[], opts: any): any => {\n    const namedArgs = opts || {};\n    const span = isDateRel(args[0]) && isDateRel(args[1]) ? datesDiff(dateRelToDate(args[0]), dateRelToDate(args[1])) : isTimespan(args[0]) ? args[0] : 0;\n\n    // if a unit is specified, break the span up\n    if (namedArgs.unit) {\n      const u = ((Array.isArray(namedArgs.unit) ? namedArgs.unit : [namedArgs.unit]) as string[]).map(u => {\n        if (u[0] === 'y') return 'y'\n        else if (u[0] === 'M' || (u[0] === 'm' && u[1] !== 'i' && u[1] !== 'm')) return 'M';\n        else if (u[0] === 'w') return 'w';\n        else if (u[0] === 'd') return 'd';\n        else if (u[0] === 'h') return 'h';\n        else if (u[0] === 'm' && (!u[1] || u[1] === 'i' || u[1] === 'm')) return 'm';\n        else if (u[0] === 's') return 's'\n        else if (u[0] === 'm' && u[1] === 's') return 'l';\n        return '';\n      }).filter(u => !!u);\n\n      // fraction tracks what would be left for rounding\n      let fraction: number;\n      let res: number[];\n\n      // special case for full spans\n      if (typeof span !== 'number' && !isTimespanMS(span)) {\n        const us = u.join('');\n        if (us === 'd') {\n          if (span.s) {\n            const from = new Date(span.s);\n            from.setHours(0);\n            from.setMinutes(0);\n            from.setSeconds(0);\n            from.setMilliseconds(0);\n            const to = new Date(+from);\n            to.setDate(1);\n            to.setFullYear(to.getFullYear() + span.d[0]);\n            to.setMonth(from.getMonth() + span.d[1]);\n\n            const m = to.getMonth();\n            to.setDate(from.getDate());\n\n            // watch out for last day of month next to longer month\n            const end = new Date(+from);\n            const endM = end.getMonth();\n            end.setDate(end.getDate() + 1);\n            if (endM !== end.getMonth()) {\n              // make sure target date is last day of month\n              to.setMonth(to.getMonth() + 1);\n              to.setDate(0);\n            }\n\n            if (to.getMonth() !== m) to.setDate(0);\n            to.setDate(to.getDate() + span.d[2]);\n            const dist = +to - +from;\n            let d = Math.floor(dist / 86400000);\n            const r = dist % 86400000;\n            if (r >= 82800000) d++;\n            res = [d];\n          } else {\n            // this is an approximation\n            res[0] += span.d[0] * 365;\n            res[0] += span.d[1] * 30;\n          }\n        } else if (u.length < 4 && (us === 'y' || us === 'yM' || us === 'yMd' || us === 'M' || us === 'Md' || us === 'd')) {\n          res = u.map(u => {\n            fraction = span.d[spanMap[u][0] + 1] / spanMap[u][1];\n            return span.d[spanMap[u][0]];\n          });\n          if (u[0] === 'M') res[0] += span.d[0] * 12;\n        }\n      }\n\n      // this isn't special cased, so get a number of ms\n      if (!res) {\n        let ms = typeof span === 'number' || isTimespanMS(span) ? timeSpanToNumber(span) : span && 's' in span ? +dateAndTimespan(new Date(span.s), span, 1) - +new Date(span.s) : (\n          span.d[0] * timespans.y + span.d[1] * timespans.m + span.d[2] * timespans.d +\n          span.d[3] * timespans.h + span.d[4] * timespans.mm + span.d[5] * timespans.s + span.d[6]\n        );\n        res = u.map(() => 0);\n\n        const next = { y: 'm', M: 'w', w: 'd', d: 'h', h: 'mm', m: 's' };\n        const nextDiv = { y: 12, M: 4.3, w: 7, d: 24, h: 60, m: 60 };\n\n        for (let i = 0; i < res.length; i++) {\n          const k = u[i] === 'm' ? 'mm' : u[i] === 'M' ? 'm' : u[i];\n          if (k === 'l') {\n            res[i] = ms;\n            fraction = 0;\n            break;\n          }\n          res[i] = Math.floor(ms / timespans[k]);\n          ms -= res[i] * timespans[k];\n          if (next[u[i]]) fraction = (ms / timespans[next[u[i]]]) / nextDiv[u[i]];\n          else if (u[i] === 's') fraction = ms % 1000;\n        }\n      }\n\n      // check for rounding\n      if (namedArgs.round === true) {\n        if (fraction >= 0.5) res[res.length - 1]++;\n      } else if ((namedArgs.round || '')[0] === 'c') {\n        if (fraction > 0) res[res.length - 1]++;\n        // very special case for months that get rounded to a year\n        if (u[0] === 'y' && u[1] === 'M' && u.length === 2 && res[1] === 12) {\n          res[0]++;\n          res[1] = 0;\n        }\n      }\n\n      // check to see if stringification is needed\n      if (namedArgs.string) {\n        const units = { y: 'year', M: 'month', w: 'week', d: 'day', h: 'hour', m: 'minute', s: 'second', l: 'millisecond' };\n        let str = '';\n        for (let i = 0; i < u.length; i++) {\n          if (!res[i]) continue;\n          str += `${str.length ? ' ' : ''}${res[i]} ${units[u[i]]}${res[i] > 1 ? 's' : ''}`;\n        }\n        return str;\n      } else return Array.isArray(namedArgs.unit) ? res : res[0];\n    } else {\n      if (namedArgs.string) {\n        if (typeof span === 'number' || isTimespanMS(span)) {\n          let ms = timeSpanToNumber(span);\n          let res = '';\n          const order = ['w', 'd', 'h', 'mm', 's'];\n          const units = ['week', 'day', 'hour', 'minute', 'second', 'millisecond'];\n          for (let i = 0; i < order.length; i++) {\n            if (ms > timespans[order[i]]) {\n              const u = Math.floor(ms / timespans[order[i]]);\n              ms -= timespans[order[i]] * u;\n              res += `${res.length ? ' ' : ''}${u} ${units[i]}${u > 1 ? 's' : ''}`;\n            }\n          }\n          if (ms) {\n            res += `${res.length ? ' ' : ''}${ms} millisecond${ms > 1 ? 's' : ''}`;\n          }\n        } else {\n          let res = '';\n          const units = ['year', 'month', 'day', 'hour', 'minute', 'second', 'millisecond'];\n          for (let i = 0; i < span.d.length; i++) {\n            if (span.d[i]) res += `${res.length ? ' ' : ''}${span.d[i]} ${units[i]}${span.d[i] > 1 ? 's' : ''}`;\n          }\n          return res;\n        }\n      } else return span;\n    }\n  }),\n  simple(['string', 'unparse'], (name: string, args: any[], opts: any): string => {\n    const [value] = args;\n    opts = opts || args[1] || {};\n    if (!opts || typeof opts !== 'object') opts = {};\n    if (name === 'unparse') opts = Object.assign({}, opts, { raport: 1 });\n    if (opts.raport && opts.tpl) opts.template = 1;\n    if (!opts && (value === null || value === undefined)) return '';\n\n    if (typeof opts === 'object') {\n      if (opts.json) return JSON.stringify(value);\n      if (opts.schema) return unparseSchema(value);\n      if (opts.base64) return btoa(value);\n      else if (opts.raport) {\n        let v = stringify(value, opts);\n        if (v === undefined) v = stringify({ v: value }, opts);\n        return v;\n      } else if (typeof value === 'string' && opts.styled) return style(value);\n      else if (value == null) return '';\n    }\n\n    if (isDateRel(value)) return fmtDate(value, 'yyyy-MM-dd HH:mm:ssz');\n\n    if (Array.isArray(value)) return value.join(', ');\n\n    let res = `${value}`;\n    if (res.slice(0, 7) === '[object') return JSON.stringify(value);\n    return res;\n  }),\n  simple(['log'], (_name: string, args: any[], _opts, ctx: Context) => {\n    try {\n      ctx.root.log(args);\n    } catch (e) {\n      console.error(e);\n      console.log(...args);\n    }\n  }),\n  simple(['call'], (_name: string, args: any[], _opts, ctx: Context): any => {\n    if (args[0] != null && typeof args[1] === 'string' && typeof args[0][args[1]] === 'function') {\n      const obj = args.shift();\n      const name = args.shift();\n      return obj[name].apply(obj, args);\n    }\n\n    if (typeof args[0] === 'function') {\n      const fn = args.shift();\n      return fn.apply(null, args);\n    }\n\n    if (isValue(args[0])) {\n      return evalApply(ctx, args[0], args.slice(1));\n    }\n  }),\n  simple(['intersect'], (_name, [left, right]: any[]): any => {\n    if (!Array.isArray(left) || !Array.isArray(right)) return [];\n    const res = [];\n    let el: any;\n    for (let i = 0; i < left.length; i++) {\n      el = left[i];\n      if (~right.indexOf(el) && !~res.indexOf(el)) res.push(el);\n    }\n    for (let i = 0; i < right.length; i++) {\n      el = right[i];\n      if (!~res.indexOf(el) && ~left.indexOf(el)) res.push(el);\n    }\n    return res;\n  }),\n  simple(['let'], (_name, [name, value]: any[], _opts, ctx: Context): any => {\n    return safeSet(ctx, name, value, true);\n  }),\n  simple(['set'], (_name, [name, value]: any[], _opts, ctx: Context): any => {\n    return safeSet(ctx, name, value);\n  }),\n  simple(['similarity'], (_name, [left, right, threshhold, fudges]: any[]): number => {\n    return similarity(`${left || ''}`, `${right || ''}`, threshhold, fudges);\n  }),\n  simple(['similar'], (_name, [left, right, threshhold, fudges]: any[]): any => {\n    return similar(`${left || ''}`, `${right || ''}`, threshhold, fudges);\n  }),\n  simple(['overlap'], (_name, [left, right, threshhold]: any[]): any => {\n    return overlap(`${left || ''}`, `${right || ''}`, threshhold);\n  }),\n  simple(['validate', 'valid'], (name, [left, right, mode], opts) => {\n    const res = validate(left, right, mode || opts?.mode || (opts?.strict && 'strict'));\n    if (name === 'valid') return res === true;\n    else return res;\n  }),\n  simple(['inspect'], (_name, [v, mode], opts) => {\n    if ((mode || opts?.mode) === 'schema') return unparseSchema(inspect(v, opts?.flat));\n    else return inspect(v);\n  }),\n  simple(['diff'], (_, [left, right, equal], opts, ctx: Context) => {\n    equal = equal || opts?.equal;\n    if (equal && isApplication(equal)) {\n      const eq = equal;\n      equal = (l: any, r: any) => evalApply(ctx, eq, [l, r]);\n    }\n    return diff(left, right, { equal, keys: opts?.keys });\n  }),\n  simple(['label-diff'], (_, [diff, label], opts) => {\n    return labelDiff(diff, label, opts as any);\n  }),\n  simple(['patch'], (_, values, opts) => {\n    const dir = opts?.dir || 'forward';\n    const strict = opts?.strict;\n    const base = JSON.parse(JSON.stringify(values.shift() || {}));\n    const r = new Root(base);\n    if (dir === 'backward') {\n      const vals = values.slice().reverse();\n      if (strict) {\n        for (const v of vals) for (const path in v) if (safeGet(r, path) == v[path][1]) safeSet(r, path, v[path][0]);\n      } else {\n        for (const v of vals) for (const path in v) safeSet(r, path, v[path][0]);\n      }\n    } else {\n      if (strict) {\n        for (const v of values) for (const path in v) if (safeGet(r, path) == v[path][0]) safeSet(r, path, v[path][1]);\n      } else {\n        for (const v of values) for (const path in v) safeSet(r, path, v[path][1]);\n      }\n    }\n    return base;\n  }),\n);\n\n// math\nregisterOperator(\n  simple(['+', 'add'], (_name, values: any[], _opts, ctx): any => {\n    if (values.length === 1) {\n      if (isDateRel(values[0])) return +dateRelToDate(values[0]);\n      else if (!values[0]) return 0;\n      return parseFloat(values[0]);\n    }\n    if (Array.isArray(values[0])) return values[0].concat.apply(values[0], values.slice(1));\n    else if (isDateRel(values[0]) && values.length > 1 && values.slice(1).reduce((a, c) => a && isTimespan(c), true)) return values.slice(1).reduce((a, c) => dateAndTimespan(a, c, 1), dateRelToDate(values[0])); \n    else if (typeof values[0] !== 'number' && values.length > 1 && isTimespan(values[0])) return values.slice(1).reduce((a, c) => addTimespan(a, c), values[0]);\n    else if (values.reduce((a, c) => a && typeof c === 'object' && !isDateRel(c), true)) return Object.assign.apply(Object, [{}].concat(values));\n    const num = values.reduce((a, c) => a && isNum(c), true);\n    if (num) {\n      if (ctx.special?.round) return +values.reduce((a, c) => +round(a + +c, ctx.special.round), 0);\n      else return values.reduce((a, c) => a + +c, 0);\n    } else {\n      return values.reduce((a, c) => a + (c === undefined || c === null ? '' : c), '');\n    }\n  }),\n  simple(['cat'], (_name, values: any[]): any => {\n    return values.reduce((a, c) => a + (c === undefined || c === null ? '' : c), '');\n  }),\n  simple(['num'], (_name: string, [v]) => {\n    let match: string[];\n    if (match = hasNum.exec(v)) return +match[1];\n    return parseInt(v);\n  }),\n  simple(['-', 'subtract'], (_name, values: any[], _opts, ctx): number => {\n    const first = values.shift();\n    if (!values.length) return -first;\n    if (isDateRel(first)) {\n      if (values.reduce((a, c) => a && isDateRel(c), true)) return values.reduce((a, c) => a - +dateRelToDate(c), +dateRelToDate(first));\n      if (values.reduce((a, c) => a && isTimespan(c), true)) return values.reduce((a, c) => dateAndTimespan(a, c, -1), dateRelToDate(first));\n    }\n    if (ctx.special?.round) return values.reduce((a, c) => +round(a - (!isNum(c) ? 0 : +c), ctx.special.round), !isNum(first) ? 0 : +first);\n    else return values.reduce((a, c) => a - (!isNum(c) ? 0 : +c), !isNum(first) ? 0 : +first);\n  }),\n  simple(['*', 'multiply'], (_name, values: any[], _opts, ctx): number|string|any[] => {\n    const first = values.shift();\n    if (!isNum(first)) {\n      if (values.length === 1 && isNum(values[0]) && +values[0] > 0) {\n        if (typeof first === 'string') {\n          return stringTimes(first, +values[0]);\n        } else if (isApplication(first) && +values[0] < 10000) {\n          const res = [];\n          for (let i = 0; i < +values[0]; i++) res.push(evalApply(ctx, first, [i]));\n          return res;\n        } else if (Array.isArray(first) && +values[0] < 10000 && first.length < 1000) {\n          const res = [];\n          for (let i = 0; i < values[0]; i++) res.push.apply(res, first);\n          return res;\n        }\n      }\n      return 0;\n    }\n    if (ctx.special.round) return values.reduce((a, c) => +round(a * (!isNum(c) ? 0 : +c), ctx.special.round), +first);\n    else return values.reduce((a, c) => a * (!isNum(c) ? 0 : +c), +first);\n  }),\n  simple(['/', '/%', 'divide', 'intdiv'], (name: string, values: any[], _opts, ctx): number => {\n    const first = values.shift();\n    if (isNaN(first)) return 0;\n    if (name.length > 1 || name === 'intdiv') return values.reduce((a, c) => Math.floor(a / (isNaN(c) ? 1 : +c)), +first);\n    if (ctx.special?.round) return values.reduce((a, c) => +round(a / (isNaN(c) ? 1 : +c), ctx.special.round), +first);\n    else return values.reduce((a, c) => a / (isNaN(c) ? 1 : +c), +first);\n  }),\n  simple(['%', 'modulus'], (_name: string, values: any[]): number => {\n    const first = values.shift();\n    return values.reduce((a, c) => a % (isNaN(c) ? 1 : +c), isNaN(first) ? 0 : +first);\n  }),\n  simple(['pow', '**'], (_name, values: any[], _opts, ctx): number => {\n    const pow = values.pop();\n    const first = Math.pow(values.pop(), pow);\n    if (ctx.special?.round) return values.reverse().reduce((a, c) => +round(Math.pow(c, a), ctx.special.round), first);\n    else return values.reverse().reduce((a, c) => Math.pow(c, a), first);\n  }),\n  simple(['abs'], (_name: string, values: any[]) => {\n    if (typeof values[0] !== 'number') return values[0];\n    return Math.abs(values[0]);\n  }),\n  simple(['round'], (_name: string, [num, precision, method]: [number, number, string], opts): number|string => {\n    precision = precision ?? opts?.places;\n    if (precision !== undefined || roundDefaults['all-numeric']) {\n      const res = round(num, { places: precision, method: (method || opts?.method) as any });\n      if (opts?.string) return res;\n      return +res;\n    } else return Math.round(num);\n  }),\n  simple(['floor'], (_name: string, values: [number]): number => {\n    return Math.floor(values[0]);\n  }),\n  simple(['ceil'], (_name: string, values: [number]): number => {\n    return Math.ceil(values[0]);\n  }),\n  simple(['rand', 'random'], (_name: string, args: any[]): any => {\n    if (!args.length || typeof args[0] === 'number') {\n      const [min, max, dec] = args;\n      let res: number;\n      if (min == null) return Math.random();\n      else if (typeof max !== 'number') res = Math.random() * min;\n      else if (typeof max === 'number') res = Math.random() * (max - min) + min;\n\n      if (max === true || dec === true) return res;\n      else return Math.round(res);\n    } else if (Array.isArray(args[0])) {\n      const arr = args[0];\n      return arr[Math.floor(Math.random() * arr.length)];\n    } else if (typeof args[0] === 'string' && typeof args[1] === 'number') {\n      let res = '';\n      const [str, count] = args;\n      for (let i = 0; i < count; i++) res += str[Math.floor(Math.random() * str.length)];\n      return res;\n    } \n  }),\n);\n\n// string\nfunction pad(where: 'l'|'c'|'r', str: string, count: number, pad: string): string {\n  if (typeof str !== 'string') str = '' + str;\n  if (!isNum(count)) return str;\n  if (typeof pad !== 'string') pad = '' + pad;\n  if (!pad) pad = ' ';\n  if (pad.length !== 1) pad = ' ';\n\n  const ct = (count - str.length) / 2;\n  for (let i = 0; str.length < count; i++) {\n    if (where === 'l') str = pad + str;\n    else if (where === 'r') str = str + pad;\n    else if (i < ct) str = pad + str;\n    else str = str + pad;\n  }\n\n  return str;\n}\nconst triml = /^\\s*/;\nconst trimr = /\\s*$/;\nconst escapeRe = /([\\.\\[\\]\\{\\}\\(\\)\\^\\$\\*\\+\\-])/g;\nregisterOperator(\n  simple(['eval'], (_name: string, [v], opts, ctx: Context): any => {\n    if (opts?.template) return template(opts?.context || ctx, v);\n    else return evaluate(opts?.context || ctx, v);\n  }),\n  simple(['padl', 'padr', 'pad'], (name: string, args: any[]): string => {\n    let [str, count, val] = args;\n    return pad(name === 'padl' ? 'l' : name === 'padr' ? 'r' : 'c', str, count, val);\n  }),\n  simple(['trim', 'triml', 'trimr'], (name: string, args: any[]): string => {\n    let [str] = args;\n    str = '' + str;\n    if (name === 'trim' || name === 'trimr') str = str.replace(trimr, '');\n    if (name === 'trim' || name === 'triml') str = str.replace(triml, '');\n    return str;\n  }),\n  simple(['slice', 'substr'], (_name: string, [src, start, end]: any[], _opts, ctx: Context) => {\n    if (src && typeof src.slice === 'function') return src.slice(start, end);\n    else {\n      const op = getOperator<ValueOperator>('string');\n      if (op) return `${op.apply('string', [src], undefined, ctx)}`.slice(start, end);\n    }\n  }),\n  simple(['len', 'length'], (_name: string, [src]: any[]) => {\n    if (typeof src === 'string' || Array.isArray(src)) return src.length;\n    else if (typeof src === 'object' && Object.keys(src).length === 1 && Array.isArray(src.value)) return src.value.length;\n    else if (typeof src === 'object') return Object.keys(src).length;\n    return 0;\n  }),\n  simple(['replace', 'replace-all'], (name: string, [str, find, rep, flags]: any[]) => {\n    str = `${str}`;\n    const re = typeof flags === 'string';\n    if (name === 'replace-all' || re) {\n      return str.replace(new RegExp(re ? find : find.replace(escapeRe, '\\\\$1'), (name === 'replace' || (flags && ~flags.indexOf('g')) ? flags : `${flags || ''}g`) || 'g'), rep);\n    } else {\n      return str.replace(find, rep);\n    }\n  }),\n  simple(['reverse'], (_name: string, [src]): string|any[] => {\n    if (typeof src === 'string') {\n      let r = '';\n      for (let i = 0; i < src.length; i++) r = src[i] + r;\n      return r;\n    } else if (Array.isArray(src)) {\n      return src.slice().reverse();\n    }\n  }),\n  simple(['wrap-count'], (_name: string, [str, width, font], opts, ctx): number => {\n    let w = width || opts?.width;\n    const avail = safeGet(ctx, '@placement.availableX') || 48;\n    if (ctx.special?.widget) {\n      const ww = ctx.special.widget.width;\n      if (ww) {\n        if (ww === 'grow') w = avail;\n        else if (typeof ww === 'number') w = ww;\n        else if (typeof ww === 'object' && typeof ww.percent === 'number') w = (ww.percent / 100) * avail; \n        else if (typeof ww === 'object' && typeof ww.x === 'string') w = evaluate(ctx, ww.x);\n      }\n    }\n    if (!w) w = avail;\n    font = font || opts?.font || safeGet(ctx, '@widget.font');\n    if (opts) {\n      font = Object.assign({}, font);\n      for (const k of ['family', 'size', 'line', 'metric', 'break-word']) if (k in opts) font[k] = opts[k];\n    }\n    return measure(str, w, { context: ctx } as any, font);\n  }),\n  simple(['keys'], (_name: string, [src, proto]): string[] => {\n    if (!src) return [];\n    if (proto) {\n      const res: string[] = [];\n      for (const k in src) res.push(k);\n      return res;\n    } else {\n      return Object.keys(src);\n    }\n  }),\n  simple(['values'], (_name: string, [src]): any[] => {\n    if (!src) return [];\n    return Object.values(src);\n  }),\n  simple(['date'], (_name: string, args: any[], opts, ctx: Context): Date|DateRel => {\n    let [v, t] = args;\n    if (typeof opts !== 'object' || !opts) opts = {} as any;\n\n    let res: Date|DateRel;\n    if (v !== undefined) {\n      if (isDateRel(v)) res = dateRelToDate(v);\n      else if (typeof v === 'string') {\n        let dt = parseDate(v);\n        if (isDateRel(dt)) {\n          res = dt;\n        } else {\n          if (!dt) dt = new Date(v);\n          if (isNaN(dt as any)) {\n            let val = evaluate(ctx, ~v.indexOf('#') ? v : `#${v}#`);\n            if (isDateRel(val)) {\n              if (opts.rel || opts.parse) res = val;\n              else res = dateRelToDate(val);\n            }\n          }\n        }\n      }\n      if (!res) res = new Date(v);\n    }\n    else res = new Date();\n\n\n    if ((opts.rel || opts.parse) && isDateRel(res)) {\n      let rel = dateRelToExactRange(res);\n      if (typeof t === 'string') t = parseTime(t);\n\n      if (Array.isArray(t)) {\n        const f = rel.f;\n        f[3] = t[0], f[4] = t[1], f[5] = t[2], f[6] = t[3];\n        t = t[4];\n      }\n\n      if (typeof t === 'number') {\n        if (opts.shift) {\n          const diff = (+rel.f[7] || 0) - t;\n          const dt = dateRelToDate(rel);\n          dt.setMinutes(dt.getMinutes() - diff);\n          rel = dateRelToExactRange(dt);\n        }\n\n        rel.f[7] = t;\n        res = rel;\n      }\n    } else {\n      const rdt = isDateRel(res) ? dateRelToDate(res) : res as Date;\n      if ('y' in opts && !isNaN(opts.y)) rdt.setFullYear(opts.y);\n      const y = rdt.getFullYear();\n      if ('m' in opts && !isNaN(opts.m)) {\n        rdt.setMonth(+opts.m - 1);\n        if (opts.clamp && rdt.getFullYear() !== y) {\n          rdt.setFullYear(y);\n          rdt.setMonth(11);\n        }\n      }\n      const m = rdt.getMonth();\n      if ('d' in opts && !isNaN(opts.d)) {\n        rdt.setDate(opts.d);\n        if (opts.clamp && (rdt.getMonth() !== m || rdt.getFullYear() !== y)) {\n          rdt.setDate(1);\n          rdt.setFullYear(y);\n          rdt.setMonth(m + 1);\n          rdt.setDate(0);\n        }\n      }\n\n      if (t) {\n        if (res === v) {\n          if (typeof v === 'string') {\n            const dt = parseDate(v);\n            if (dt && isDateRel(dt)) res = dateRelToDate(dt);\n            else res = new Date(v);\n          } else res = new Date(v);\n        }\n\n        if (typeof t === 'string') t = parseTime(t);\n        if (Array.isArray(t)) {\n          rdt.setHours(t[0] || 0, t[1] || 0, t[2] || 0, t[3] || 0);\n          if (t[4] != null) {\n            const offset = -rdt.getTimezoneOffset() - t[4];\n            rdt.setMinutes(rdt.getMinutes() + offset);\n          }\n        } else if (typeof t === 'number') {\n          const offset = -rdt.getTimezoneOffset() - t;\n          rdt.setMinutes(rdt.getMinutes() + offset);\n        }\n      }\n\n      res = rdt;\n    }\n\n    if (res instanceof Date && isNaN(+res)) return undefined;\n    return res;\n  }),\n  simple(['interval'], (_name: string, [v]: any[], _opts, ctx: Context): DateRel => {\n    return evaluate(ctx, ~v.indexOf('#') ? v : `#${v}#`);\n  }),\n  simple(['upper', 'lower'], (name: string, [v]: any[]): string => {\n    v = v == null ? '' : v;\n    return name === 'upper' ? `${v}`.toUpperCase() : `${v}`.toLowerCase();\n  }),\n  simple(['format', 'fmt'], (_name: string, args: any[], opts, ctx): string => {\n    let [v, fmt, ...s] = args;\n    const op = formats[fmt];\n    if (!op) {\n      let op: any = getOperator(fmt);\n      if (!op) {\n        const o = safeGet(ctx, fmt) || safeGet(ctx.root, fmt);\n        if (isApplication(o)) op = o\n      }\n      if (op) {\n        const args = [v, ...s];\n        return applyOperator(ctx, { op: fmt, args: args.map(v => isApplication(v) ? v : ({ v })), opts: { v: opts || virtualFormats[fmt] } });\n      } else return `${v}`;\n    } else return op.apply(v, s, (opts || op.defaults) as any);\n  }),\n  simple(['set-defaults'], (_name: string, [type, name]: any[], opts, ctx) => {\n    if (type === 'format' && typeof name === 'string') {\n      const fmt = formats[name];\n      if (fmt) return Object.assign(fmt.defaults, opts);\n      const vfmt = virtualFormats[name];\n      if (vfmt) return Object.assign(vfmt.defaults, opts);\n    } else if (type === 'round') {\n      if (opts?.context) {\n        if (opts?.unset) {\n          if (ctx.special) delete ctx.special.round;\n        } else (ctx.special || (ctx.special = {})).round = Object.assign({}, opts, { context: undefined });\n      } else Object.assign(roundDefaults, opts);\n    } else if (type === 'generate') {\n      Object.assign(generateDefaults, opts);\n    }\n  }),\n  simple(['parse'], (_name: string, args: any[], opts: any): any => {\n    opts = opts || args[1] || {};\n    if (!opts || typeof opts !== 'object') opts = {};\n    const [v] = args;\n\n    if (opts.date) return parseDate(v, opts);\n    else if (opts.template || opts.tpl) return parseTemplate(v, opts);\n    else if (opts.time) return parseTime(v, opts);\n    else if (opts.expr) return parseExpr(v, opts);\n    else if (opts.json) return JSON.parse(v);\n    else if (opts.schema) return parseSchema(v);\n    else if (opts.range) return parseRange(v, opts);\n    else if (opts.xml) return parseXML(v, opts.strict);\n    else if (opts.csv || opts.delimited) {\n      if (opts.detect || !opts.field || !opts.record) opts = Object.assign(csvDetect(v, opts.context), opts);\n      return csvParse(v, opts);\n    } else if (opts.base64) return atob(v);\n    else return parse(v, opts);\n  }),\n  simple(['detect-delimiters'], (_name: string, [data, max]: any[], opts) => {\n    if (typeof data !== 'string') return {};\n    return csvDetect(data, max ?? opts?.context);\n  }),\n);\n\n// short circuiting\nregisterOperator({\n  type: 'checked',\n  names: ['and', '&&'],\n  checkArg(_name: string, _i: number, _total: number, value: any): CheckResult {\n    if (value) return 'continue';\n    else return { result: value };\n  },\n  apply(_name: string, args: any[]): boolean {\n    return args[args.length - 1]; // passed the check, all is well\n  },\n}, {\n  type: 'checked',\n  names: ['or', '||', '??'],\n  checkArg(name: string, _i: number, _total: number, value: any): CheckResult {\n    if (name === '??' ? value != null : value) return { result: value };\n    else return 'continue';\n  },\n  apply(name: string): boolean {\n    return name === '??' ? undefined : false; // if we made it this far, none were true\n  },\n}, {\n  type: 'checked',\n  names: ['if', 'unless'],\n  checkArg(name: string, i: number, last: number, value: any): CheckResult {\n    if (i % 2 === 0) {\n      if (i === last) return { result: value }; // else case\n      else if (name === 'if' ? !value : value) return { skip: 1 }; // non-matching branch, skip next\n      else return 'continue'; // matching, carry on to next\n    }\n    else return { result: value }; // odd branch that wasn't skipped means previous condition matched\n  },\n  apply() {}\n}, {\n  type: 'checked',\n  names: ['case', 'switch'],\n  checkArg(_name: string, i: number, last: number, value: any, _opts, ctx: Context, ast): CheckResult {\n    if (i === 0) { // set the value and move to the next\n      (ctx.special || (ctx.special = {})).case = value;\n      return 'continue';\n    } else if (i % 2 === 1) {\n      if (i === last) return { result: value }; // default case\n      if (equals(value, ctx.special.case)) return 'continue';\n      if (isValue(ast) && 'op' in ast && value === true) return 'continue'; // operators can also check for true\n      if (isValue(value)) {\n        const v = evalValue(ctx, value);\n        if (equals(v, ctx.special.case)) return 'continue';\n        if (v === true) return 'continue';\n      }\n      return { skip: 1 };\n    } else return { result: value }; // odd branch\n  },\n  apply() {},\n  extend: true,\n}, {\n  type: 'checked',\n  names: ['each'],\n  checkArg(_name: string, i: number, last: number, value: any): CheckResult {\n    if (i === 0) {\n      if (Array.isArray(value) && value.length || value && typeof value === 'object' && Object.keys(value).length) return 'continue';\n      else return { skip: 1 };\n    } else if (i === 1) return { skip: last - i, value };\n    else if (i === last) return { result: value };\n    else if (i % 2 === 0) { // condition\n      if (value) return 'continue';\n      else return { skip: 1 };\n    } else return { result: value };\n  },\n  apply(_name: string, [value, body]: [any[]|object, ValueOrExpr], opts, ctx: Context) {\n    if (Array.isArray(value)) {\n      const last = value.length - 1;\n      return value.map((v, i) => evalApply(ctx, body, [v, i], { last, index: i, key: i, 'last-key': last })).join(opts?.join || '');\n    } else if (typeof value === 'object' && value) {\n      const entries = Object.entries(value);\n      const lastKey = entries[entries.length - 1][0];\n      const last = entries.length - 1;\n      return Object.entries(value).map(([k, v], i) => evalApply(ctx, body, [v, k], { last, 'last-key': lastKey, index: i, key: k })).join('');\n    } else {\n      return '';\n    }\n  }\n}, {\n  type: 'checked',\n  names: ['with'],\n  checkArg(_name: string, i: number, last: number, value: any): CheckResult {\n    if (i === 0 && value && typeof value === 'object') return 'continue';\n    else if (i === 1) return { skip: last - i, value };\n    else if (i === last) return { result: value };\n    else if (i % 2 === 0) {\n      if (value) return 'continue';\n      else return { skip: 1 };\n    } else return { result: value };\n  },\n  apply(_name: string, [value, body]: [any, ValueOrExpr], _opts, ctx: Context) {\n    return evalApply(ctx, body, [value]);\n  }\n}, {\n  type: 'checked',\n  names: ['coalesce', 'coalesce-truth'],\n  checkArg(name: string, _i: number, _last: number, value: any): CheckResult {\n    if (name === 'coalesce' && value !== undefined && value !== null) return { result: value };\n    else if (value) return { result: value };\n    else return 'continue';\n  },\n  apply() {}\n});\n\n// aggregates\nregisterOperator({\n  type: 'aggregate',\n  names: ['avg'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (ctx.special?.round) return +round(arr.reduce((a, c) => +round(a + num(args[0] ? evalApply(ctx, args[0], [c]) : c)), 0) / arr.length)\n    else return arr.reduce((a, c) => a + num(args[0] ? evalApply(ctx, args[0], [c]) : c), 0) / arr.length;\n  },\n}, {\n  type: 'aggregate',\n  names: ['sum'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (ctx.special?.round) return arr.reduce((a, c) => +round(a + num(args[0] ? evalApply(ctx, args[0], [c]) : c)), 0);\n    else return arr.reduce((a, c) => a + num(args[0] ? evalApply(ctx, args[0], [c]) : c), 0);\n  }\n}, {\n  type: 'aggregate',\n  names: ['count'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (opts?.partition && isApplication(opts.partition)) {\n      return arr.reduce((a, e, i) => {\n        const key = evalApply(ctx, opts.partition, [e, i]);\n        if (key in a) a[key]++;\n        else a[key] = 1;\n        return a;\n      }, {});\n    } else if (opts?.sub && typeof opts.sub === 'object' && !Object.values(opts.sub).find(o => !isApplication(o))) {\n      return arr.reduce((a, e, i) => {\n        for (const k in opts.sub) {\n          let res = evalApply(ctx, opts.sub[k], [e, i]);\n          if (!res) continue;\n          if (typeof res === 'string') res = [res];\n          else if (!Array.isArray(res)) res = [k];\n          for (const k of res) {\n            if (k in a) a[k]++;\n            else a[k] = 1;\n          }\n        }\n        return a;\n      }, {});\n    } else if (args.length) return arr.filter((e, i) => evalApply(ctx, args[0], [e, i])).length;\n    else return arr.length;\n  }\n}, {\n  type: 'aggregate',\n  names: ['min', 'max'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (isApplication(args[0])) arr = arr.map(e => evalApply(ctx, args[0], [e]));\n    else if (args.length && !arr.length) arr = args.map(a => evalParse(ctx, a));\n    if (!arr.length) return 0;\n    return Math[name].apply(Math, arr.filter(e => !isNaN(e)));\n  }\n}, {\n  type: 'aggregate',\n  names: ['first', 'nth', 'last'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    let val: any;\n    let apply = 0;\n    if (name === 'first') val = arr[0];\n    else if (name === 'last') val = arr[arr.length - 1];\n    else if (args[0]) {\n      const i = evalParse(ctx, args[0]);\n      if (typeof i === 'number') {\n        val = i < 0 ? arr[arr.length + i] : arr[i - 1];\n        apply = 1;\n      }\n    }\n    if (args[apply]) val = evalParse(ctx, args[apply]);\n    return val;\n  }\n}, {\n  type: 'aggregate',\n  names: ['map'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (!args[0]) return arr;\n    let v: any[];\n    let app: any;\n    if (isApplication(args[0])) v = arr, app = evalParse(ctx, args[0]);\n    else if (isApplication(args[1])) v = evalParse(ctx, args[0]), app = evalParse(ctx, args[1]);\n    if ((Array.isArray(v) || v && '0' in v) && isApplication(app)) {\n      const res = Array.prototype.map.call(v, (e: any, i: number) => evalApply(ctx, app, [e, i], { index: i, key: i }));\n      if (opts && opts.flat) return flatten(res, opts.flat);\n      return res;\n    }\n    else if (v && typeof v === 'object' && isApplication(app)) {\n      if (opts && opts.array) {\n        const res = Object.entries(v as object).map((p, i) => evalApply(ctx, app, [p[1], i, p[0]], { index: i, key: p[0] }));\n        if (opts && opts.flat) return flatten(res, opts.flat);\n        return res;\n      }\n      if (opts && opts.entries) return Object.entries(v as object).reduce((a, p, i) => {\n        const r = evalApply(ctx, app, [p[1], i, p[0]], { index: i, key: p[0] });\n        if (r === null) return a;\n        if (Array.isArray(r) && r.length === 2 && typeof r[0] === 'string') a.push(r);\n        else a.push([p[0], r]);\n        return a;\n      }, [] as any[]);\n      const res: any = {};\n      Object.entries(v as object).forEach((e, i) => {\n        const r = evalApply(ctx, app, [e[1], i, e[0]], { index: i, key: e[0] });\n        if (Array.isArray(r) && r.length === 2 && typeof r[0] === 'string') res[r[0]] = r[1];\n        else if (r == null) return;\n        else res[e[0]] = r;\n      });\n      return res;\n    }\n  }\n}, {\n  type: 'aggregate',\n  names: ['index'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (!args[0]) return {};\n    const many = opts && opts.many;\n    return arr.reduce((a, c, i) => _indexPair(a, evalApply(ctx, args[0], [c, i], { index: i, all: a }), c, many), {});\n  },\n}, {\n  type: 'aggregate',\n  names: ['reduce'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (!args[0]) return arr;\n    return arr.reduce((a, c, i) => evalApply(ctx, args[0], [a, c, i]), evalParse(ctx, args[1]));\n  }\n}, {\n  type: 'aggregate',\n  names: ['unique', 'unique-map'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    const seen = [];\n    const res = [];\n    for (const e of arr) {\n      const f = args[0] ? evalApply(ctx, args[0], [e]) : e;\n      if (!~seen.indexOf(f)) {\n        seen.push(f);\n        res.push(e);\n      }\n    }\n    return name === 'unique' ? res : seen;\n  }\n}, {\n  type: 'aggregate',\n  names: ['join'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (isApplication(args[0])) {\n      arr = arr.map(e => evalApply(ctx, args[0], [e]));\n      args = args.slice(1);\n    }\n    if (args.length > 1 && arr.length > 2) return [arr.slice(0, -1).join(evalParse(ctx, args[0])), arr[arr.length - 1]].join(evalParse(ctx, args[1]));\n    else if (args.length > 2 && arr.length === 2) return arr.join(evalParse(ctx, args[2]));\n    return arr.join(evalParse(ctx, args[0]));\n  }\n}, {\n  type: 'aggregate',\n  names: ['find'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (!args[0]) return;\n    else if (isApplication(args[0])) return arr.find((e, i) => evalApply(ctx, args[0], [e, i], { index: i, key: i }));\n    else if (isApplication(args[1])) {\n      const v = evalParse(ctx, args[0]);\n      if (Array.isArray(v)) return v.find((e, i) => evalApply(ctx, args[1], [e, i], { index: i, key: i }));\n      else if (typeof v === 'object' && v) {\n        const e = Object.entries(v).find((e, i) => evalApply(ctx, args[1], [e[1], i, e[0]], { index: i, key: e[0] }));\n        if (e) return e[1];\n      }\n    } else {\n      const v = evalParse(ctx, args[0]);\n      return arr.find(e => e == v);\n    }\n  }\n}, {\n  type: 'aggregate',\n  names: ['flatten'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx) {\n    return flatten(arr, (args.length > 0 ? evalParse(ctx, args[0]) : 0) || opts?.flat);\n  }\n}, {\n  type: 'aggregate',\n  names: ['block'],\n  apply(_name: string, _arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    const last = args.length - 1;\n    if (last < 0) return;\n    const c = opts?.implicit ? ctx : extend(ctx, { locals: {}, fork: !ctx.locals });\n    for (let i = 0; i < last; i++) evalParse(c, args[i]);\n    const res = evalParse(c, args[last]);\n    if (opts && opts.implicit) ctx.locals = c.locals;\n    return res;\n  },\n  value: true,\n});\n\nfunction flatten(n: any[], levels: any = 1): any[] {\n  let res = n || [];\n  const count = typeof levels !== 'number' ? 1 : levels;\n  for (let i = 0; i < count; i++) {\n    if (res.find(v => Array.isArray(v))) res = [].concat(...res);\n    else return res;\n  }\n  return res;\n}\n\nfunction fmtDate(n: any, fmt: string): string {\n  if (typeof n === 'string') {\n    const d = parseDate(n);\n    if (d) n = d;\n  }\n  return date(isDateRel(n) ? dateRelToExactRange(n) : n, fmt);\n}\n\nfunction _parseRange(ctx: Context, range: string) {\n  const map = (ctx.root as any)._ranges || ((ctx.root as any)._ranges = {})\n  if (range in map) return map[range];\n  return (map[range] = parseRange(range));\n}\n\nfunction _indexPair(res: any, value: any, current: any, many: boolean): any {\n  if (Array.isArray(value)) {\n    if (value.length === 0) return res;\n    else if (value.length === 2) {\n      const [k, v] = value;\n      if (Array.isArray(k)) {\n        for (const kk of k) {\n          if (many) {\n            if (kk in res) res[kk].push(v)\n            else res[kk] = [v];\n          } else res[kk] = v;\n        }\n      } else {\n        if (many) {\n          if (k in res) res[k].push(v);\n          else res[k] = [v];\n        } else res[k] = v;\n      }\n    }\n  } else if (typeof value === 'object') {\n    const v = value as any;\n    if ('many' in v && Array.isArray(v.many)) for (const i of v.many) _indexPair(res, i, current, many);\n    else if ('key' in v || 'keys' in v) _indexPair(res, [v.key || v.keys, v.value || current], current, many);\n  } else {\n    if (many) {\n      if (value in res) res[value].push(current);\n      else res[value] = [current];\n    } else res[value] = current;\n  }\n  return res;\n}\n\n// basic formats\nregisterFormat('dollar', function(n, [dec, group, sign, neg], opts) {\n  return dollar(n, undefined, dec ?? opts?.dec ?? this.defaults.dec, group ?? opts?.group ?? this.defaults.group, sign ?? opts?.sign ?? this.defaults.sign, neg ?? opts?.neg ?? this.defaults.neg);\n}, { dec: 2, group: ',', sign: '$', neg: 'sign' });\n\nregisterFormat('date', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd' });\n\nregisterFormat('time', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'HH:mm:ss' });\n\nregisterFormat('timestamp', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd HH:mm:ss' });\n\nregisterFormat('timestamptz', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd HH:mm:sszzz' });\n\nregisterFormat('iso8601', n => {\n  return fmtDate(n, 'yyyy-MM-ddTHH:mm:sszzz');\n});\n\nregisterFormat(['integer', 'int'], function(n, [group, neg], opts) {\n  return number(n, 0, group ?? opts?.group ?? this.defaults.group, neg ?? opts?.neg ?? this.defaults.neg);\n}, { group: ',', neg: 'sign' });\n\nregisterFormat(['number', 'num'], function(n, [dec, group, neg], opts) {\n  return number(n, dec ?? opts?.dec ?? this.defaults.dev, group ?? opts?.group ?? this.defaults.group, neg ?? opts?.neg ?? this.defaults.neg);\n}, { dec: 2, group: ',', neg: 'sign' });\n\nregisterFormat('ordinal', function(n, [group], opts) {\n  return ordinal(n, group ?? opts?.group ?? this.defaults.group);\n}, { group: ',' });\n\nregisterFormat('phone', n => {\n  return phone(n);\n});\n\nregisterFormat('styled', n => {\n  return style(n);\n});\n\n{\n  const space = /\\s+/g;\n  const br = /[\\s;,.:\"]\\w/g;\n  const alphaNum = /[^a-zA-Z0-9]+([a-zA-Z0-9])/g;\n  const alphaNumSpace = /[^\\sa-zA-Z0-9]/g;\n  const camelBreak = /([a-z])([A-Z])/g;\n  const spaceChar = /\\s([^\\s])/g;\n  function normalize(s: string) {\n    return s.replace(alphaNum, (_m, c) => c ? ` ${c}` : '').replace(alphaNumSpace, '').replace(camelBreak, (_m, c1, c2) => `${c1} ${c2}`).trim();\n  }\n  registerFormat('case', (n, whiches) => {\n    let str = `${n || ''}`.trim();\n    for (const which of whiches) {\n      if (which === 'upper' || which === 'up') str = str.toUpperCase();\n      else if (which === 'lower' || which === 'down') str = str.toLowerCase();\n      else if (which === 'snake') str = normalize(str).toLowerCase().replace(space, '_');\n      else if (which === 'kebab') str = normalize(str).toLowerCase().replace(space, '-');\n      else if (which === 'pascal') {\n        const s = normalize(str);\n        str = s[0].toUpperCase() + s.toLowerCase().substr(1).replace(spaceChar, (_m, c) => (c || '').toUpperCase());\n      } else if (which === 'camel') {\n        const s = normalize(str);\n        str = s[0].toLowerCase() + s.toLowerCase().substr(1).replace(spaceChar, (_m, c) => (c || '').toUpperCase());\n      } else if (which === 'proper') {\n        if (/[a-z]/.test(str)) str = str.trim().replace(br, m => m.toUpperCase());\n        else str = str.toLowerCase().trim().replace(br, m => m.toUpperCase());\n        str = (str[0] || '').toUpperCase() + str.substr(1);\n      }\n    }\n    return str;\n  });\n}\n\nregisterFormat('hex', val => {\n  if (typeof val === 'number') return val.toString(16);\n  else {\n    const str = `${val}`;\n    const te = new TextEncoder();\n    return Array.from(te.encode(str)).map(c => c.toString(16).padStart(2, '0')).join('');\n  }\n});\n\nregisterFormat('base', (val, [n]) => {\n  try {\n    return val.toString(n);\n  } catch {\n    return val;\n  }\n});\n\nregisterFormat('noxml', val => escapeHTML(`${val}`));\n\nregisterFormat('xml', (val, [n]) => {\n  if (val && typeof val === 'object') return objectToXML(val, n);\n  else return val;\n});\n\nfunction objectToXML(object: object, indent: number|undefined = undefined) {\n  if (Array.isArray(object)) return _objectToXML({ values: { value: object } }, 0, indent);\n  const keys = Object.keys(object);\n  if (keys.length > 1) return _objectToXML({ root: object }, 0, indent);\n  if (keys.length < 1) return '<root />';\n  if (Array.isArray(object[keys[0]])) return _objectToXML({ root: object }, 0, indent);\n  return _objectToXML(object, 0, indent);\n}\n\nfunction _objectToXML(val: any, depth: number, indent: number|undefined, propname: string|undefined = undefined) {\n  if (Array.isArray(val)) {\n    return val.reduce((xml, entry) => {\n      const val = _objectToXML(entry, depth + 1, indent, propname);\n      const tag = val === '' || val === undefined ? `<${propname} />` : `<${propname}>${val}${indent && /\\n/.test(val) ? '\\n' + pad('l', '', depth * indent, ' ') : ''}</${propname}>`;\n      return `${xml}${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}${tag}`;\n    }, '');\n  }\n  if (val && typeof val === 'object') {\n    return Object.entries(val).reduce((xml, [name, value]) => {\n      const val = _objectToXML(value, depth + (Array.isArray(value) ? 0 : 1), indent, name);\n      const tag = val === '' ? `${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}<${name} />` : Array.isArray(value) ? val : `${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}<${name}>${val}${indent && /\\n/.test(val) ? '\\n' + pad('l', '', depth * indent, ' ') : ''}</${name}>`;\n      return `${xml}${tag}`;\n    }, '');\n  }\n  return escapeHTML(val);\n}\n\nregisterFormat('base64', val => {\n  return btoa(`${val}`);\n});\n"],"names":["Fail","detailedFail","_cause","_latestCause","getCause","getCauseCopy","name","suggestCauseName","undefined","slice","fail","pos","message","cause","causes","isNodeName","v","openNode","start","end","children","closeNode","node","parent","res","_compact","result","primary","c","length","push","reduce","last","i","extra","l","apply","getLineNum","input","n","lastIndexOf","getParseError","context","lines","first","t","unshift","substring","markerOffset","indexOf","source","marker","len","column","line","position","marked","join","map","parser","findLatestCause","startSpace","shared","error","mps","oerror","det","detailed","consume","consumeAll","trim","exec","seq","skip","a","d","tree","compact","unwrap","parse","undefinedOnError","ctx","contextLines","err","getLatestCause","latest","throw","ex","Error","Object","assign","uninit","_s","p","lazy","init","s","r","nop","concat","strings","outer","f","max","cs","contains0","contains1","str","x","contains2","contains3","contains4","contains5","contains6","contains7","contains8","contains9","contains10","containsFor","containsBinary","mid","getSearch","sorted","charList","chars","split","sort","seekWhileChar","contains","read","read1","JSON","stringify","count","allowed","search","substr","readTo","stop","skipped","seekUntilChar","read1To","op","resin","j","nlen","istr","copy","toLowerCase","toUpperCase","idx","opt","ps","not","alt","parsers","nm","lps","fails","overrideCauseName","verify","fn","e","cur","rep","empty","rep1","repsep","sep","trail","ps1","ps2","rr","m","rep1sep","bracket","content","right","Array","isArray","ends","ps3","r1","r2","r3","addCause","check","andNot","np","_hex","digits","identStart","hex","escmap","b","underscores","JNum","replace","JStringEscape","disallowed","notchars","JStringUnicode","String","fromCharCode","parseInt","JStringHex","JString","JBool","JNull","JIdentifier","ws","JArray","JObject","JValue","JKeyPair","pairs","pair","timespans","y","w","h","mm","isTimespanMS","ms","timeSpanToNumber","Math","floor","space","endSym","endRef","_comment","comment","prop","rws","skip1","keywords","ident","sexprop","args","array","block","object","value","values","application","inlineTemplate","pathesc","char","pathident","parts","dotpath","part","valueAnchor","anchor","bracketpath","keypath","prefix","k","u","localpath","parsePath","makeParser","parseLetPath","illegalRefs","ref","includes","stringInterp","q","meta","timespan","span","timezone","timeexact","parseTime","tm","z","dateend","daterel","o","tz","val","setIndex","index","dateexact","time","date","typelit","schema","parseDate","string","literal","Date","sexp","opts","bracket_op","binop","if_op","case_op","opName","call_op","operand","fmt","fmt_op","postfix_path","unop","arg","leftassoc","left","binop_pipe","arg1","more","binop_e","pop","reverse","rightassoc","binop_md","binop_as","binop_cmp","binop_eq","binop_and","binop_or","branch_body","replaceCase","found","cond1","body1","elifs","el","cond","body","hit","miss","case_branch","branches","operation","objectOp","filter","namedArg","names","implicit","plain","obj","letter","setter","parseBlock","parseExpr","namespace","type","conditions","typedef","typedefs","defs","desc","arr","key","required","rest","keys","rests","fields","tuple","types","maybe_union","union_array","list","checks","union","root","txtEsc","text","txts","nestedText","endTxt","tag_value","tag_end","branch","min_one","else_tag","branch_tag","each_op","tag","apply_first","cond_branches","with_op","unless_op","interpolator","hasTag","_parse","toDataSet","safeGet","path","parameters","sources","which","special","pipe","lctx","locals","evalValue","dir","safeSet","islet","next","evaluate","isValueOrExpr","Root","isContext","evalParse","template","extend","parseTemplate","evalApply","isApplication","fork","expr","ns","cache","exprs","applyOperator","isDateRel","isTimespan","opMap","registerOperator","ops","getOperator","_defaultGetValue","sorts","getValue","sortArr","by","dirs","lower","cmp","ds","groups","_ds","_context","flt","forEach","row","grouped","level","group","all","order","g","hasPipeRef","getKeypath","local","isOperation","find","isReference","flts","checkArg","shift","src","isValue","constructor","this","log","console","formats","virtualFormats","registerFormat","format","defaults","dateRelToRange","rel","from","to","setUTCFullYear","getFullYear","getMonth","getDate","setUTCHours","dateAndTimespan","setUTCDate","getUTCDate","getUTCDay","setDate","setUTCMonth","getUTCMonth","getUTCFullYear","UTC","setUTCMilliseconds","getUTCMilliseconds","setUTCMinutes","getUTCMinutes","offset","getTimezoneOffset","dateRelToDate","range","dateRelToExactRange","dt","setMinutes","getMinutes","getHours","getSeconds","getMilliseconds","setFullYear","dd","setMonth","setHours","setSeconds","setMilliseconds","addStyle","id","style","styles","placement","output","height","isComputed","maybeComputed","report","extendContext","styleMap","commit","htmlChars","htmlReplace","escapeHTML","html","renderers","registerRenderer","renderer","options","render","avgs","measure","width","font","family","size","brw","avg","metric","test","word","wlen","renderWidget","state","hide","widget","container","getHeightWithMargin","maxY","isNaN","availableY","continue","cancel","extraHeight","margin","expandMargin","border","box","expandBorder","getWidthWithMargin","toFixed","layouts","registerLayout","layout","getWidth","pct","availableX","maxX","percent","getHeight","computed","linesize","maxFontSize","NaN","maxYOffset","points","maxXOffset","top","bottom","expandMacro","macro","props","properties","widgets","mapStyle","mapped","ids","nextStyleId","styleClass","cls","inline","inlineStyle","classPrefix","classifyStyles","offsetX","offsetY","computedHeight","lineSize","styleFont","styleBorder","styleExtra","bg","radius","color","align","weight","pre","clamp","br","initParameters","defaultParams","inits","applySources","srcs","base","runDelimited","headers","table","quote","field","record","rowContext","unquote","RegExp","findWidgets","results","zwsp","sp","integer","number","remOrPercent","places","valign","pad","fg","rotate","turn","origin","move","trash","bools","tags","blocks","aliases","parsed","stuff","open","bool","blockstack","drop","frame","getStyle","process","flexAlign","middle","borderStyle","dot","dash","bs","underline","overline","strike","sup","sub","italic","bold","vs","transforms","vv","onCommit","commitContext","sval","styled","styleText","wctx","extendData","cw","yo","lp","child","attempt","renderWidgets","bridge","groupNo","newPage","header","hctx","current","groupHeaders","headerPerPage","rctx","elide","usedX","usedY","initY","alternate","headerRepeat","footer","fctx","groupEnds","fit","url","styleImage","decRE","intRE","isNumRE","dec","negative","parseFloat","neg","dateRE","months","days","dateDefault","Y","M","D","DD","H","MM","S","SS","Z","getDay","prototype","toString","call","ordinal","min","bit","abs","num","setDefault","checkIdent","_pipes","_noSym","_key","_sexprops","_listcommas","_noarr","_noobj","_tpl","_tplmode","_noindent","_listwrap","opchain","_html","_nochecks","_level","_first","deepops","binops","unops","precedence","in","like","ilike","gt","gte","lt","lte","is","and","or","noSymbols","SExprOps","listCommas","noArrayLiterals","noObjectLiterals","noIndent","listWrap","htmlSafe","noChecks","pipes","_stringify","stringifyRootBlock","padl","stringed","stringifyTemplateBlock","caseRE","stringifyTemplateCase","fill","wrapArgs","isBlock","long","cindent","outdentAll","trimLeft","trimRight","stringifyIf","wsplit","stringifyCase","findNestedStringOpL","flattenNestedBinopsL","re","_f","stringifyTemplate","stringifyBinopArg","indentAll","stringifyOp","arrow","stringifySchema","stringifyDate","entries","stringifyLiteral","rem","spanKeys","spanExact","stringifyTimespan","agg","offsetToTimezone","mn","leadingSpace","allLeadingSpace","amount","close","keyMod","wrapSetting","wrap","ts","strs","fin","def","l2","nl","lopen","lclose","parseSchema","num_range","sign_range","sign","Infinity","star_range","not_range","looseEqual","v1","v2","strictEqual","isNum","trueStrings","falseStrings","sqlEqual","tmp1","tmp2","fullnum","diff","equal","_diff","identity","keyMode","checkIdentity","v1ids","v2ids","vv1","vv2","_v1","_v2","ks","deepEqual","_deepEqual","labelDiff","label","out","omit","_labelDiff","nums","lbl","pp","isDate","isSchema","what","inspect","flat","getType","getField","validate","mode","_validate","_schema","errs","checkType","actual","unparseSchema","expected","tmp","legit","ok","DEFAULTS","csv","quotedField","unquotedField","records","quotes","detect","data","sample","match","fs","rs","qs","isTableOpts","splice","fixedSize","entities","amp","entity","attr","quoted","attrs","put","target","strict","stack","stream","simple","spanMap","generateDefaults","stringTimes","times","roundDefaults","method","round","amt","settings","place","point","ceil","zeroes","pow","big","hasNum","equals","overlap","threshhold","similar","similarity","fudges","whole","aa","bb","i1","i2","oa","ob","f1","f2","sim","alen","blen","aolen","bolen","matchy","inRange","excluded","where","ct","eq","_name","pattern","patterns","free","_opts","_parseRange","it","parseRange","no","bounds","upper","step","app","namedArgs","datesDiff","unit","fraction","us","endM","dist","nextDiv","units","raport","tpl","json","base64","btoa","fmtDate","_","vals","addTimespan","precision","random","triml","trimr","escapeRe","flatten","levels","_ranges","_indexPair","many","kk","flags","avail","ww","proto","rdt","vfmt","unset","xml","parseXML","delimited","csvDetect","csvParse","atob","_i","_total","ast","case","lastKey","_last","partition","seen","_arr","dollar","dev","alphaNum","alphaNumSpace","camelBreak","spaceChar","normalize","_m","c1","c2","whiches","_objectToXML","depth","indent","propname","entry","te","TextEncoder","encode","padStart","objectToXML","legal","tabloid","a4","extraContext","repeater","_tmp","runAsDelimited","extras","orientation","yy","watermark","overlay","_k","head","foot","runFlow","page","pages","printX","printY","pageY","headSize","footSize","footPlace","headPlace","_p","runPage"],"mappings":"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"}