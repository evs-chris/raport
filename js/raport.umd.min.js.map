{"version":3,"file":"raport.umd.min.js","sources":["../node_modules/sprunge/src/base.ts","../node_modules/sprunge/src/search.ts","../node_modules/sprunge/src/parsers/char.ts","../node_modules/sprunge/src/parsers/str.ts","../node_modules/sprunge/src/parsers/base.ts","../node_modules/sprunge/src/parsers/rep.ts","../node_modules/sprunge/src/parsers/seq.ts","../node_modules/sprunge/src/json.ts","../src/lib/data/parse.ts","../src/lib/data/parse/template.ts","../src/lib/data/index.ts","../src/lib/render/error.ts","../src/lib/render/index.ts","../src/lib/render/style.ts","../src/lib/report.ts","../src/lib/data/parse/style.ts","../src/lib/render/builtins.ts","../src/lib/data/format.ts","../src/lib/data/parse/stringify.ts","../src/lib/data/parse/schema.ts","../src/lib/data/parse/range.ts","../src/lib/data/diff.ts","../src/lib/data/schema.ts","../src/lib/data/csv.ts","../src/lib/data/parse/xml.ts","../src/lib/data/builtins.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,"import { parser as makeParser, Parser, bracket, opt, alt, seq, str, istr, map, read, chars, repsep, rep1sep, read1To, read1, skip1, rep, rep1, check, verify, name, not, readTo, unwrap } from 'sprunge/lib';\nimport { ws, digits, JNum, JStringEscape, JStringUnicode, JStringHex, JString } from 'sprunge/lib/json';\nimport { Value, DateRel, DateRelToDate, DateRelRange, DateRelSpan, DateExactRange, Literal, Keypath, TimeSpan, Operation, TimeSpanMS, Schema, Field, TypeMap } from './index';\n\nexport const timespans = {\n  y: 0,\n  m: 0,\n  w: 0,\n  d: 86400000,\n  h: 3600000,\n  mm: 60000,\n  s: 1000,\n};\n\ntimespans.w = timespans.d * 7;\ntimespans.y = Math.floor(timespans.d * 365.25);\ntimespans.m = Math.floor(timespans.d * 30.45);\n\nexport function isTimespanMS(v: any): v is TimeSpanMS {\n  return typeof v === 'object' && v && typeof v.ms === 'number';\n}\n\nexport function timeSpanToNumber(v: TimeSpan): number {\n  if (typeof v === 'number') return v;\n  else if (isTimespanMS(v)) return v.ms;\n  else return ((((((((((((v.d[0] || 0) * 12) + (v.d[1] || 0)) * 30.45) + (v.d[2] || 0)) * 24) + (v.d[3] || 0)) * 60) + (v.d[4] || 0)) * 60) + (v.d[5] || 0)) * 1000) + (v.d[6] || 0);\n}\n\nconst space = ' \\r\\n\\t';\nconst endSym = space + '():{}[]<>,\"\\'`\\\\;&#';\nexport const endRef = endSym + '.+/*|^%=!?';\n\nconst _comment = map(seq(ws, str('//'), opt(str(' ')), readTo('\\n'), str('\\n')), ([, , , c]) => ({ c }), { name: 'comment', primary: true });\nfunction comment<T extends any>(prop: string, p: Parser<T>): Parser<T> {\n  return map(seq(rep(_comment), ws, p), ([c, , v]) => {\n    if (c && c.length) v[prop] = c.map(c => c.c);\n    return v;\n  });\n}\n\nexport const rws = skip1(space, 'required-space');\n\nexport const keywords = map<string, any>(str('null', 'true', 'false', 'undefined'), v => {\n  switch (v) {\n    case 'null': return null;\n    case 'true': return true;\n    case 'false': return false;\n    case 'undefined': return undefined;\n  }\n}, { primary: true, name: 'primitive' });\n\nexport const ident = read1To(endRef, true);\nexport const sexprop = read1To(' \\r\\n\\t():{}[],\"\\'\\\\;&#@', true);\n\nexport const args: Parser<[Value[], Value]> = {};\nexport const array: Parser<Value> = {};\nexport const block: Parser<Value> = {};\nexport const object: Parser<Value> = {};\nexport const value: Parser<Value> = {};\nexport const values: Parser<Value> = {};\nexport const tpl: Parser<Value> = {};\nexport const application: Parser<Value> = {};\n\nconst escmap: { [k: string]: string } = { n: '\\n', r: '\\r', t: '\\t', b: '\\b' };\nconst pathesc = map(seq(str('\\\\'), chars(1)), ([, char]) => escmap[char] || char);\nconst pathident = map(rep1(alt('ref-part', read1To(endRef, true), pathesc)), parts => parts.join(''), 'keypath-part');\nconst dotpath = map(seq(str('.'), pathident), ([, part]) => part);\nconst bracketpath = bracket(seq(str('['), ws), value, seq(ws, str(']')));\nexport const keypath = map(seq(alt<'!'|'~'|'*'|[string,string]>('ref-sigil', str('!', '~', '*') as any, seq(read('^'), opt(str('@', '.')))), alt<string|Value>('keypath', pathident, bracketpath), rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([prefix, init, parts]) => {\n  const res: Keypath = { k: [init].concat(parts).map(p => typeof p === 'object' && 'v' in p && (typeof p.v === 'string' || typeof p.v === 'number') ? p.v : p) };\n  if (Array.isArray(prefix)) {\n    if (prefix[0]) res.u = prefix[0].length;\n    if (prefix[1] === '@') res.p = '@';\n  } else if (prefix) {\n    res.p = prefix;\n  }\n  return res;\n}, 'keypath');\nexport const localpath = map(seq(read('^'), pathident, rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([prefix, init, parts]) => {\n  const res: Keypath = { k: ([init] as Array<string|Value>).concat(parts).map(p => typeof p === 'object' && 'v' in p && (typeof p.v === 'string' || typeof p.v === 'number') ? p.v : p) };\n  if (prefix) res.u = prefix.length;\n  return res;\n}, 'localpath');\n\nexport const parsePath = makeParser(keypath);\nexport const parseLetPath = makeParser(localpath);\n\nconst illegalRefs = ['if', 'else', 'elif', 'elseif', 'elsif', 'fi', 'esac', 'unless', 'then', 'case', 'when', 'not', 'gte', 'gt', 'lte', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain', 'is-not', 'is', 'strict-is-not', 'strict-is', 'deep-is-not', 'deep-is', 'and', 'or', 'end', 'with', 'each'];\nexport const ref = map(keypath, (r, err) => {\n  if (r.k.length === 1 && !r.p && !r.u && illegalRefs.includes(r.k[0] as string)) err(`invalid reference name '${r.k[0] as string}'`);\n  return { r };\n}, { primary: true, name: 'reference' });\n\nfunction stringInterp(parts: Value[]): Value {\n  const res = parts.reduce((a, c) => {\n    if (a.length) {\n      if ('v' in c && 'v' in a[a.length - 1] && typeof c.v === 'string' && typeof (a[a.length - 1] as Literal).v === 'string') (a[a.length - 1] as Literal).v += c.v;\n      else a.push(c);\n    } else {\n      a.push(c);\n    }\n    return a;\n  }, [] as Value[]);\n\n  if (res.length > 0 && (!('v' in res[0]) || typeof res[0].v !== 'string')) res.unshift({ v: '' });\n\n  if (res.length === 0) return { v: '' };\n  else if (res.length === 1) return res[0];\n  return { op: '+', args: res };\n}\n\nconst timespan = map(rep1sep(seq(JNum, ws, istr('years', 'year', 'y', 'months', 'month', 'minutes', 'minute', 'milliseconds', 'millisecond', 'mm', 'ms', 'm', 'weeks', 'week', 'w', 'days', 'day', 'd', 'hours', 'hour', 'h', 'seconds', 'second', 's')), ws), parts => {\n  const span = { y: 0, m: 0, d: 0, h: 0, mm: 0, s: 0, ms: 0 };\n  for (let i = 0; i < parts.length; i++) {\n    if (parts[i][2][0] === 'y') span.y += parts[i][0];\n    else if (parts[i][2] === 'm' || parts[i][2] === 'months' || parts[i][2] === 'month') span.m += parts[i][0];\n    else if (parts[i][2][0] === 'd') span.d += parts[i][0];\n    else if (parts[i][2][0] === 'w') span.d += parts[i][0] * 7;\n    else if (parts[i][2][0] === 'h') span.h += parts[i][0];\n    else if (parts[i][2][0] === 's') span.s += parts[i][0];\n    else if (parts[i][2] === 'mm' || parts[i][2] === 'minutes' || parts[i][2] === 'minute') span.mm += parts[i][0];\n    else if (parts[i][2] === 'ms' || parts[i][2] === 'milliseconds' || parts[i][2] === 'millisecond') span.ms += parts[i][0];\n  }\n\n  if (!span.y && !span.m && !span.d) {\n    delete span.y; delete span.m; delete span.d;\n    let n = 0;\n    for (const k in span) n += span[k] * (timespans[k] || 1);\n    return { ms: n };\n  } else {\n    const s: [number?, number?, number?, number?, number?, number?, number?] = [];\n    if (span.y) s[0] = span.y;\n    if (span.m) s[1] = span.m;\n    if (span.d) s[2] = span.d;\n    if (span.h) s[3] = span.h;\n    if (span.mm) s[4] = span.mm;\n    if (span.s) s[5] = span.s;\n    if (span.ms) s[6] = span.ms;\n    return { d: s };\n  }\n}, { primary: true, name: 'timespan' });\n\nexport const timezone = map(seq(ws, alt<string|[string, string, [string, string]]>('timezone',\n  istr('z'),\n  seq(opt(chars(1, '+-')), alt(chars(4, digits), chars(2, digits), chars(1, digits)),\n    opt(seq(str(':'), chars(2, digits)))\n  )\n)), v => {\n  if (v[1][0] === 'z') return 0;\n  else {\n    let res: number;\n    if (v[1][1].length === 4) {\n      res = +v[1][1].substr(0, 2) * 60 + +v[1][1].substr(2, 2);\n    } else {\n      res = +v[1][1] * 60;\n      if (v[1][2]) res += +v[1][2][1];\n    }\n    if (v[1][0] === '-') res *= -1;\n    return res;\n  }\n});\n\nexport const timeexact = alt<[number, number?, number?, number?]>(\n  map(seq(\n    read1(digits),\n    opt(seq(\n      str(':'), chars(2, digits), opt(\n        seq(str(':'), chars(2, digits), opt(\n          seq(str('.'), chars(3, digits))\n        ))\n      )\n    ))\n  ), v => {\n    const h = v[0];\n    const m = v[1] && v[1][1];\n    const s = m && v[1][2] && v[1][2][1];\n    const ms = s && v[1][2][2] && v[1][2][2][1];\n    const res: [number, number?, number?, number?] = [+h];\n    if (m) res[1] = +m;\n    if (s) res[2] = +s;\n    if (ms) res[3] = +ms;\n    return res;\n  }),\n  map(istr('start', 'midnight'), () => [0, 0, 0, 0]),\n  map(istr('noon', 'mid'), () => [12, 0, 0, 0]),\n  map(istr('end'), () => [23, 59, 59, 999]),\n);\n\nexport const parseTime = makeParser(alt<number|[number, number?, number?, number?]>(map(seq(timeexact, opt(seq(ws, timezone))), ([tm, z]) => {\n  if (z) tm.push(z[1]);\n  return tm;\n}), timezone), { trim: true, consumeAll: true, undefinedOnError: true });\n\nconst dateend = opt(seq(ws, str('>')));\nconst daterel = alt<DateRel>('date',\n  map(seq(opt(istr('last', 'this', 'next')), rws, istr('week', 'month', 'year'), opt(timezone), dateend), ([o, , f, tz, e]) => {\n    const val: DateRelRange = { f: f[0] === 'w' ? 'w' : f[0] === 'm' ? 'm' : 'y', o: o === 'last' ? -1 : o === 'next' ? 1 : 0, e: e ? 1 : undefined };\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('week', 'month', 'year'), seq(rws, istr('to'), rws, istr('date')), opt(timezone), dateend), ([f, , tz, e]) => {\n    const val: DateRelToDate = { f: f[0] === 'w' ? 'w' : f[0] === 'm' ? 'm' : 'y', o: 0, d: 1, e: e ? 1 : undefined };\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('yesterday', 'today', 'tomorrow'), alt<any>(bracket(ws, istr('at'), ws), rws), timeexact, ws, opt(timezone)), v => {\n    const res: DateRel = { f: 'd', o: v[0] === 'yesterday' ? -1 : v[0] === 'today' ? 0 : 1, t: v[2] };\n    if (v[4] != null) res.t[4] = v[4];\n    return res;\n  }),\n  map(seq(istr('yesterday', 'today', 'tomorrow', 'now'), opt(timezone), dateend), ([v, tz, e]) => {\n    const val: DateRel = (v === 'now' ? { f: 'n', o: 0 } : { f: 'd', o: v === 'yesterday' ? -1 : v === 'today' ? 0 : 1, e: e ? 1 : undefined });\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('in'), rws, timespan), v => (typeof v[2] === 'number' || isTimespanMS(v[2]) ? { f: 'n', o: timeSpanToNumber(v[2]) } : { f: 'n', o: v[2].d })),\n  map(seq(timespan, rws, alt<string|any[]>('relative time anchor', istr('ago'), seq(istr('from'), rws, istr('now'))), opt(timezone)), ([span, , ref, tz]) => {\n    let val: DateRelSpan;\n    if (typeof span === 'number' || isTimespanMS(span)) {\n      val = { f: 'n', o: timeSpanToNumber(span) * (ref === 'ago' ? -1 : 1) };\n    } else {\n      val = { f: 'n', o: span.d, d: ref === 'ago' ? -1 : undefined };\n    }\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n);\n\nfunction setIndex<T, U = Array<T>>(array: U, index: number, value: T): U {\n  if (value == null) return array;\n  array[index] = value;\n  return array;\n}\nexport const dateexact: Parser<Date|DateRel> = map(seq(\n  chars(4, digits),\n  opt(seq(chars(1, '-/'), read1(digits),\n    opt(seq(chars(1, '-/'), read1(digits)))\n  )),\n  opt(seq(\n    alt(bracket(rws, istr('at'), rws), istr('t'), rws), timeexact\n  )),\n  opt(timezone),\n  dateend,\n), v => {\n  const y = v[0];\n  const m = v[1] && v[1][1];\n  const d = m && v[1][2] && v[1][2][1];\n  const time = v[2] && v[2][1];\n  const tz = v[3];\n  const e = v[4] ? 1 : undefined;\n  if (!m) return { f: setIndex([+y], 7, tz), e };\n  else if (!d) return { f: setIndex([+y, +m - 1], 7, tz), e };\n  else if (!time) return { f: setIndex([+y, +m - 1, +d], 7, tz), e }\n  else {\n    const res: DateExactRange = { f: [+y, +m - 1, +d], e };\n    for (let i = 0; i < time.length; i++) {\n      if (time[i] != null) res.f[i + 3] = time[i];\n    }\n    if (tz != null) res.f[7] = tz;\n    return res;\n  }\n});\n\nexport const date = bracket(str('#'), alt<Date|DateRel|TimeSpan>('date', dateexact, daterel, timespan), str('#'), { primary: true, name: 'date' });\n\nexport const typelit = map(seq(str('@['), ws, schema(), ws, str(']')), ([, , v]) => ({ v, s: 1 } as Value), { name: 'typelit', primary: true });\n\nexport const parseDate = makeParser(map(seq(opt(str('#')), alt<Date|DateRel|TimeSpan>('date', dateexact, daterel, timespan), opt(str('#'))), ([, d,]) => d), { trim: true, consumeAll: true, undefinedOnError: true });\n\nexport const string = alt<Value>({ primary: true, name: 'string' },\n  map(seq(str(':'), read1To(endSym, true)), v => ({ v: v[1]})),\n  map(bracket(str('\"'), rep(alt<string>('string-part',\n    read1To('\\\\\"'), JStringEscape, JStringUnicode, JStringHex\n  )), str('\"')), a => ({ v: ''.concat(...a) })), \n  map(bracket(str(`'`), rep(alt('string-part',\n    map(read1To(`'\\\\$\\{`, true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${', '{'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n  )), str(`'`)), stringInterp),\n  map(bracket(str('`'), rep(alt('string-part',\n    map(read1To('`\\\\${', true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n  )), str('`')), stringInterp),\n);\nexport const literal = map(alt('literal', map(JNum, v => v, { primary: true, name: 'number' }), keywords, date), v => {\n  if (v instanceof Date || v == null || typeof v !== 'object') return { v };\n  else return v;\n});\n\nexport const sexp = map(bracket(\n  check(str('('), ws),\n  seq(sexprop, ws, args),\n  check(ws, str(')')),\n), ([op, , args]) => {\n  const res: Value = { op };\n  if (args[0] && args[0].length) res.args = args[0];\n  if (args[1]) res.opts = args[1];\n  return res;\n}, { primary: true, name: 's-expression' });\n\nfunction fmt_op(parser: Parser<Value>): Parser<Value> {\n  return map(seq(parser, rep(seq(str('#'), ident, opt(alt<[Value[], Value]>(\n    map(seq(str(','), rep1sep(value, str(','), 'allow')), ([, value]) => [value, undefined]),\n    bracket_op(args),\n  ))), { primary: true, name: 'format-op' })), ([value, fmt]) => {\n    if (!fmt || !fmt.length) return value;\n    return fmt.reduce((a, c) => c[2] ?\n      { op: 'fmt', args: [a, { v: c[1] }, ...(c[2][0] || [])], opts: c[2][1] } :\n      { op: 'fmt', args: [a, { v: c[1] }] }, value);\n  }, 'fmt-op');\n}\n\nfunction bracket_op<T>(parser: Parser<T>): Parser<T> {\n  return bracket(seq(str('('), ws), parser, seq(ws, str(')')));\n}\n\nexport const binop: Parser<Value> = {};\nexport const if_op: Parser<Value> = {};\nexport const case_op: Parser<Value> = {};\n\nconst opName = read1('abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789');\nconst call_op = map(seq(name(opName, 'op'), bracket_op(args)), ([op, args]) => {\n  const res: Value = { op };\n  if (args[0] && args[0].length) res.args = args[0];\n  if (args[1]) res.opts = args[1];\n  return res;\n}, { primary: true, name: 'call' });\n\nexport const operand: Parser<Value> = fmt_op(postfix_path(alt('operand', bracket_op(application), bracket_op(if_op), bracket_op(case_op), verify(bracket_op(binop), v => 'op' in v || `expected bracketed op`), sexp, values)));\nexport const unop = map(seq(str('not ', '+', '-'), operand), ([op, arg]) => ({ op: op === 'not ' ? 'not' : op, args: [arg] }), 'unary op');\n\nfunction leftassoc(left: Value, [, op, , right]: [string, string, string, Value]) {\n  return { op, args: [left, right] };\n}\n\nfunction rightassoc(left: Value, more: Array<[string, string, string, Value]>) {\n  if (more.length === 1) return { op: more[0][1], args: [left, more[0][3]] };\n  const end = more.pop();\n  let op = more[more.length - 1][1];\n  const first = { op: end[1], args: [more.pop()[3], end[3]] }\n  const right = more.reverse().reduce((a, c) => {\n    const res = { op, args: [c[3], a] };\n    op = c[1];\n    return res;\n  }, first);\n  return { op, args: [left, right] };\n}\n\nexport const binop_e = map(seq(operand, rep(seq(rws, name(str('**'), 'exp op'), rws, operand))), ([arg1, more]) => more.length ? rightassoc(arg1, more) : arg1, 'exp-op');\nexport const binop_md = map(seq(binop_e, rep(seq(rws, name(str('*', '/%', '/', '%'), 'muldiv-op'), rws, binop_e))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'muldiv-op');\nexport const binop_as = map(seq(binop_md, rep(seq(rws, name(str('+', '-'), 'addsub-op'), rws, binop_md))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'addsub-op');\nexport const binop_cmp = map(seq(binop_as, rep(seq(rws, name(str('>=', '>', '<=', '<', 'gte', 'gt', 'lte', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain'), 'cmp-op'), rws, binop_as))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'cmp-op');\nexport const binop_eq = map(seq(binop_cmp, rep(seq(rws, name(str('is-not', 'is', 'strict-is-not', 'strict-is', 'deep-is-not', 'deep-is', '===', '==', '!==', '!='), 'eq-op'), rws, binop_cmp))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'eq-op');\nexport const binop_and = map(seq(binop_eq, rep(seq(rws, name(str('and', '&&'), 'and-op'), rws, binop_eq))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'and-op');\nexport const binop_or = map(seq(binop_and, rep(seq(rws, name(str('or', '||', '??'), 'or-op'), rws, binop_and))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'or-op');\nbinop.parser = map(binop_or, v => v, { primary: true, name: 'binary-op' });\n\nif_op.parser = alt({ primary: true, name: 'conditional' },\n  map(seq(str('if'), rws, value, rws, block, rep(seq(ws, str('else if', 'elseif', 'elsif', 'elif'), rws, value, rws, block)), opt(seq(ws, str('else'), rws, block))), ([,, cond1,, block1, elifs, el]) => {\n    const op =  { op: 'if', args: [cond1, block1] };\n    for (const [,,, cond,, block] of elifs) op.args.push(cond, block);\n    if (el) op.args.push(el[3]);\n    return op;\n  }, 'if-block'),\n  map(seq(str('if'), rws, value, rws, str('then'), rws, value, rep(seq(rws, not(str('end', 'fi')), str('else if', 'elseif', 'elsif', 'elif'), rws, value, rws, str('then'), rws, value)), opt(seq(rws, str('else'), rws, value)), opt(seq(rws, str('end', 'fi')))), ([,, cond1,,,, val1, elifs, el]) => {\n    const op = { op: 'if', args: [cond1, val1] };\n    for (const [,,,, cond,,,, val] of elifs) op.args.push(cond, val);\n    if (el) op.args.push(el[3]);\n    return op;\n  }, 'if'),\n  map(seq(str('unless'), rws, value, rws, str('then'), rws, value, opt(seq(rws, str('else'), rws, value)), opt(seq(rws, str('end')))), ([, , cond, , , , hit, miss]) => {\n    const op = { op: 'unless', args: [cond, hit] };\n    if (miss) op.args.push(miss[3]);\n    return op;\n  }),\n);\n\nexport function replaceCase(op: Operation): boolean {\n  if (!op.args || !op.args.length) return false;\n  let found = false;\n  for (let i = 0; i < op.args.length; i++) {\n    const arg = op.args[i] as Value;\n    if ('r' in arg && (arg.r === '_' || (typeof arg.r === 'object' && arg.r.k[0] === '_'))) {\n      arg.r = { k: ['case'].concat(((arg.r as any).k || []).slice(1)), p: '@' };\n      found = true;\n    } else if ('r' in arg && typeof arg.r === 'object' && arg.r.p === '@' && arg.r.k[0] === 'case') {\n      found = true;\n    } else if ('op' in arg) found = found || replaceCase(arg);\n  }\n  return found;\n}\n\nexport const case_branch = alt<[undefined|Value, Value]>(\n  map(seq(rws, not(str('end', 'esac')), str('when'), rws, value, rws, str('then'), rws, value), ([,,,, cond,,,, hit]) => [cond, hit], 'when-branch'),\n  map(seq(rws, not(str('end', 'esac')), str('else'), rws, value), ([,,,, hit]) => [undefined, hit], 'else-branch'),\n  map(seq(rws, not(str('end', 'esac')), str('when'), rws, value, rws, block), ([,,,, cond,, hit]) => [cond, hit], 'when-block'),\n);\ncase_op.parser = alt(\n  map(seq(str('case'), rws, value, rep(case_branch), opt(seq(rws, str('end', 'esac')))), ([,, val, branches]) => {\n    const op = { op: 'case', args: [val] };\n    for (let i = 0; i < branches.length; i++) {\n      if (branches[i][0] === undefined) op.args.push(branches[i][1]);\n      else {\n        let arg: Value = branches[i][0];\n        if ('op' in arg) replaceCase(arg);\n        op.args.push(arg);\n        op.args.push(branches[i][1]);\n      }\n    }\n    return op;\n  }, 'case'),\n);\n\nfunction postfix_path(parser: Parser<Value>): Parser<Value> {\n  return map(seq(parser, rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([v, k]) => {\n    if (k.length) return { op: 'get', args: [v, { v: { k } }] };\n    else return v;\n  }, 'postfix-path-op');\n}\n\nexport const operation = alt<Value>('expression', if_op, case_op, binop);\n\nconst pair: Parser<[Value, Value]> = map(seq(alt('key', string, map(ident, v => ({ v }))), ws, str(':'), ws, value), t => [t[0], t[4]], 'pair');\n\narray.parser = map(bracket(\n  check(ws, str('['), ws),\n  repsep(value, read1(space + ','), 'allow'),\n  check(ws, str(']')),\n), args => args.filter(a => !('v' in a)).length ? { op: 'array', args } : { v: args.map(a => (a as Literal).v) }, { primary: true, name: 'array' });\n\nfunction objectOp(pairs: [Value, Value][]): Value {\n  return pairs.filter(p => !('v' in p[0] && 'v' in p[1])).length ?\n  { op: 'object', args: pairs.reduce((a, c) => (a.push(c[0], c[1]), a), []) } : \n  { v: pairs.reduce((a, c) => (a[(c[0] as Literal).v] = (c[1] as Literal).v, a), {}) };\n}\n\nobject.parser = map(bracket(\n  check(ws, str('{'), ws),\n  repsep(pair, read1(space + ','), 'allow'),\n  check(ws, str('}')),\n), objectOp, { primary: true, name: 'object' });\n\nblock.parser = map(bracket(\n  check(ws, str('{'), ws),\n  rep1sep(value, read1(space + ';'), 'allow'),\n  check(ws, str('}')),\n), args => ({ op: 'block', args }), { primary: true, name: 'block' });\n\nvalue.parser = unwrap(comment('c', operation));\n\nconst namedArg: Parser<[Value, Value]> = map(seq(ident, str(':'), ws, value), ([k, , , v]) => [{ v: k }, v], 'named-arg');\napplication.parser = map(seq(opt(bracket(check(str('|'), ws), rep1sep(opName, read1(space + ','), 'allow'), str('|'))), ws, str('=>', '=\\\\'), ws, value), ([names, , , , value]) => (names ? { a: value, n: names } : { a: value }), { primary: true, name: 'application' });\nargs.parser = map(repsep(alt<[Value, Value] | Value>('argument', namedArg, value), read1(space + ','), 'allow'), (args) => {\n  const [plain, obj] = args.reduce((a, c) => ((Array.isArray(c) ? a[1].push(c) : a[0].push(c)), a), [[], []] as [Array<Value>, Array<[Value, Value]>]);\n  if (obj.length) return [plain, objectOp(obj)];\n  return [plain, undefined];\n});\n\nconst letter = map(seq(str('let'), rws, name(localpath, { name: 'reference', primary: true }), ws, str('='), ws, value), ([, , k, , , , v]) => ({ op: 'let', args: [{ v: k }, v] }), { primary: true, name: 'let' });\nconst setter = map(seq(str('set'), rws, name(keypath, { name: 'reference', primary: true }), ws, str('='), ws, value), ([, , k, , , , v]) => ({ op: 'set', args: [{ v: k }, v] }), { primary: true, name: 'set' });\nvalues.parser = alt('expression', array, object, literal, typelit, string, application, unop, call_op, letter, setter, ref, block);\n\nexport const parseBlock = makeParser<Value>(map(rep1sep(value, read1(space + ';'), 'allow'), args => args.length === 1 ? args[0] : { op: 'block', args, opts: { v: { implicit: 1 } } }, 'expression-sequence'), { trim: true });\nexport const parseExpr = makeParser(value, { trim: true });\n(parseBlock as any).namespace = 'default';\nexport const parse: typeof parseBlock & { namespace: string } = parseBlock as any;\nexport default parse;\n\nexport function schema() {\n  const type: Parser<Schema> = {};\n  const conditions = opt(seq(ws, rep1sep(map(seq(name(str('?'), { name: 'condition', primary: true }), ws, application), ([, , a]) => a), rws, 'disallow')));\n  const value = map(seq(str('string[]', 'number[]', 'boolean[]', 'date[]', 'any', 'string', 'number', 'boolean', 'date'), not(read1To(endRef))), ([s]) => ({ type: s } as Schema), { name: 'type', primary: true });\n  const typedef = comment('c', map(seq(str('type'), ws, name(ident, { name: 'type', primary: true }), ws, str('='), ws, type), ([, , name, , , , type]) => ({ name, type } as { name: string, type: Schema, c?: string[] })));\n  const typedefs = map(rep1sep(typedef, read1(' \\t\\n;'), 'allow'), defs => defs.reduce((a, c) => (c.type.desc = c.c, a[c.name] = c.type, a), {} as TypeMap));\n  const ref = map(seq(ident, opt(str('[]'))), ([ref, arr]) => ({ type: arr ? 'array' : 'any', ref } as Schema), { name: 'type', primary: true });\n  const key = map(seq(name(ident, { name: 'key', primary: true }), opt(str('?')), ws, str(':'), ws, type), ([name, opt, , , , type]) => {\n    const res: Field = type as Field;\n    res.name = name;\n    if (!opt) res.required = true;\n    return res;\n  });\n  const literal = alt<Schema>(\n    { name: 'literal', primary: true }, \n    map(alt<string|number>(JString, JNum), v => {\n      return { type: 'literal', literal: v } as Schema;\n    }),\n    map(str('true', 'false', 'null', 'undefined'), v => {\n      return { type: 'literal', literal: v === 'true' ? true : v === 'false' ? false : v === 'null' ? null : undefined } as Schema;\n    }),\n  );\n  const rest = map(seq(str('...'), ws, str(':'), ws, type), ([, , , , type]) => {\n    return Object.assign({ name: '...' }, type) as Field;\n  });\n  const object: Parser<Schema> = map(seq(str('{'), ws, repsep(comment('desc', alt(key, rest)), read1(' \\t\\n,;'), 'allow'), ws, str('}'), opt(str('[]'))), ([, , keys, , , arr], fail) => {\n    const rests = keys.filter(k => k.name === '...');\n    if (rests.length > 1) fail('only one object rest can be specified');\n    else {\n      const rest = rests[0];\n      keys = keys.filter(k => k.name !== '...');\n      const type: Schema = { type: arr ? 'object[]' : 'object' };\n      if (keys.length) type.fields = keys;\n      if (rest) {\n        delete rest.name;\n        type.rest = rest;\n      }\n      return type;\n    }\n  });\n  const tuple = map(seq(str('['), ws, repsep(type, read1(' \\t\\r\\n,'), 'allow'), ws, str(']'), opt(str('[]'))), ([, , types, , , arr]) => {\n    return { type: arr ? 'tuple[]' : 'tuple', types } as Schema;\n  });\n  const maybe_union = map(rep1sep(seq(alt<Schema>(value, object, tuple, literal, ref), conditions), seq(ws, str('|'), ws), 'disallow'), list => {\n    const types = list.map(([t, c]) => {\n      if (c && c[1] && c[1].length) t.checks = c[1];\n      return t;\n    });\n    if (types.length === 1) return types[0];\n    else return { type: 'union', types: types } as Schema;\n  });\n  const union_array = alt<Schema>(\n    map(seq(str('Array<'), ws, maybe_union, ws, str('>')), ([, , union], fail) => {\n      if (union.type === 'union') return { type: 'union[]', types: union.types } as Schema;\n      else if (union.type === 'literal') fail('literal types cannot be array types');\n      else if (union.type === 'array' || ~union.type.indexOf('[]')) fail('array types cannot be array types');\n      else if (union.type === 'any') fail('any cannot be an array type');\n      else {\n        union.type += '[]';\n        return union;\n      }\n    }),\n    map(seq(str('('), ws, maybe_union, ws, str(')')), ([, , union]) => union),\n    maybe_union,\n  );\n\n  type.parser = map(seq(union_array, conditions), ([type, checks]) => {\n    if (checks && checks[1] && checks[1].length) type.checks = checks[1];\n    return type;\n  });\n\n  const root = map(seq(opt(typedefs), ws, type), ([defs, , type]) => {\n    if (defs) type.defs = defs;\n    return type;\n  });\n\n  return root;\n}\n","import { Value } from '../index';\nimport { value, rws, replaceCase } from '../parse';\nimport { Parser, parser as makeParser, rep, rep1, seq, alt, map, read1To, chars, str, readTo, check, andNot, name } from 'sprunge';\nimport { ws } from 'sprunge/lib/json';\n\nconst endTxt = '\\\\{';\n\nconst txtEsc = alt(map(str('\\\\{{'), () => '{{'), map(seq(str('\\\\'), chars(1)), ([, c]) => c));\nconst text = map(rep1(alt(read1To(endTxt, true), txtEsc, andNot(str('{'), str('{')))), txts => ({ v: txts.join('') }), 'text');\n\nfunction tag_value(names: string[]): Parser<[string, Value]> {\n  return map(seq(str('{{'), ws, str(...names), rws, value, ws, str('}}')), arr => [arr[2], arr[4]], 'tag');\n}\n\nfunction case_value(names: string[]): Parser<[string, Value, Value]> {\n  return map(seq(str('{{'), ws, str(...names), rws, value, rws, str('when'), rws, value, str('}}')), arr => [arr[2], arr[4], arr[8]], 'tag');\n}\n\nconst tag_end = name(check(seq(str('{{/'), readTo('}'), str('}}'))), 'tag end');\n\nconst content: Parser<Value> = {};\n\ninterface Branch {\n  name: string;\n  value?: Value;\n}\n\ntype Content = Value|Branch;\n\nfunction branch(names: string[], value?: boolean): Parser<Branch> {\n  if (value) return map(tag_value(names), ([name, value]) => ({ name, value }));\n  else return map(seq(str('{{'), ws, str(...names), ws, str('}}')), ([, , name]) => ({ name }), 'tag');\n}\n\nfunction min_one<T>(values: Parser<Array<T>>): Parser<Array<T|Value>> {\n  return map(values, v => v.length < 1 ? [{ v: '' }] : v);\n}\n\nconst else_tag = branch(['else']);\nconst branch_tag = branch(['else if', 'elseif', 'elsif', 'elif'], true);\n\nconst each_op = map(seq(tag_value(['each']), min_one(rep(alt<Content>(branch_tag, else_tag, content))), tag_end), ([tag, content]) => ({ op: 'each', args: [tag[1]].concat(apply_first(cond_branches(content))) }), { primary: true, name: 'each-block' });\nconst if_op = map(seq(tag_value(['if']), min_one(rep(alt<Content>(branch_tag, else_tag, content))), tag_end), ([tag, content]) => ({ op: 'if', args: [tag[1]].concat(cond_branches(content)) }), { primary: true, name: 'if-block' });\nconst with_op = map(seq(tag_value(['with']), min_one(rep(alt<Content>(else_tag, content))), tag_end), ([tag, content]) => ({ op: 'with', args: [tag[1]].concat(apply_first(cond_branches(content))) }), { primary: true, name: 'with-block' });\nconst unless_op = map(seq(tag_value(['unless']), min_one(rep(content)), tag_end), ([tag, content]) => ({ op: 'unless', args: [tag[1]].concat(concat(content)) }), { primary: true, name: 'unless-block' });\nconst case_op = map(seq(case_value(['case']), min_one(rep(alt<Content>(branch(['when'], true), else_tag, content))), tag_end), ([tag, content]) => {\n  const op = { op: 'case', args: tag.slice(1).concat(cond_branches(content)) };\n  for (let i = 1; i < op.args.length; i += 2) {\n    const arg = op.args[i];\n    if (typeof arg === 'object' && 'op' in arg) replaceCase(arg);\n  }\n  return op;\n}, { primary: true, name: 'case-block' });\n\nconst interpolator = map(seq(str('{{'), ws, value, ws, str('}}')), ([, , value]) => ({ op: 'string', args: [value] }), { primary: true, name: 'interpolator' });\n\ncontent.parser = alt<Value>({ primary: true, name: 'content' }, text, each_op, if_op, with_op, case_op, unless_op, interpolator);\n\nfunction apply_first(content: Value[]): Value[] {\n  if (content.length) content[0] = { a: content[0] };\n  return content;\n}\n\nfunction cond_branches(content: Array<Value|Branch>): Value[] {\n  const res: Value[] = [];\n  let args = [];\n  let hasTag = false;\n\n  for (let i = 0; i < content.length; i++) {\n    const c = content[i];\n    if ('name' in c) {\n      hasTag = true;\n      if (args.length) res.push(concat(args));\n      else res.push({ v: '' });\n      if (c.value) res.push(c.value);\n      args = [];\n    } else args.push(c);\n  }\n  if (args.length) res.push(concat(args));\n  else if (hasTag) res.push({ v: '' });\n\n  if (res.length % 2) res.push({ v: '' });\n\n  return res;\n}\n\nfunction concat(values: Value[]): Value {\n  if (values.length === 1) return values[0];\n  return { op: '+', args: values };\n}\n\nconst _parse = makeParser(alt<Value>(map(rep1(content), args => concat(args)), map(ws, () => ({ v: '' }))), { trim: true });\n(_parse as any).namespace = 'template';\nexport const parse: typeof _parse & { namespace: string } = _parse as any;\n","import { parse, parsePath, parseLetPath, isTimespanMS } from './parse';\nimport { parse as parseTemplate } from './parse/template';\nimport { ParseError } from 'sprunge/lib';\n\nexport interface TypeMap {\n  [name: string]: Schema;\n}\n\n// Data\nexport interface Schema {\n  /** An optional type for the value */\n  type?: Type;\n  /** Child fields belonging to the field */\n  fields?: Field[];\n  /** Types of unnamed fields in object prototypes */\n  rest?: Schema;\n  /** Types of tuple or union */\n  types?: Schema[];\n  /** Literal value of field */\n  literal?: string|number|boolean|undefined|null;\n  /** Addition validators on the value */\n  checks?: ValueOrExpr[];\n  /** An optional map of named types */\n  defs?: TypeMap;\n  /** If the type is 'any', this may be a name in a type map */\n  ref?: string;\n  /** Additional comments about the type */\n  desc?: string[];\n}\n\nexport interface DataSource<T = any, R = any> {\n  schema?: Schema;\n  values(parms?: T): Promise<DataSet<R>>;\n}\n\nexport interface DataSet<R = any> {\n  schema?: Schema;\n  value: R;\n}\n\nexport function toDataSet(value: any): DataSet {\n  if (Array.isArray(value)) return { value };\n  if (value && typeof value === 'object') {\n    for (const k in value) if (k !== 'schema' && k !== 'value') return { value };\n    return value;\n  }\n  return { value };\n}\n\nexport class CachedDataSource<R = any> implements DataSource<any, R> {\n  _schema: Schema;\n  _value: R;\n\n  constructor(value: R, schema?: Schema) {\n    this._value = value;\n    this._schema = schema;\n  }\n\n  values(): Promise<DataSet<R>> { return Promise.resolve({ schema: this._schema, value: this._value }); }\n}\n\nexport interface SourceMap { [key: string]: DataSet }\n\nexport type ValueType = 'string'|'number'|'boolean'|'date'|'object'|'literal';\nexport type ArrayType = 'string[]'|'number[]'|'boolean[]'|'date[]'|'object[]'|'tuple[]'|'union[]';\nexport type Type = ValueType|ArrayType|'value'|'array'|'union'|'tuple'|'any';\n\nexport interface Field extends Schema {\n  /** The property name for the field */\n  name: string;\n  /** Whether this field is required */\n  required?: true;\n  /** A user-friendly name for the field */\n  label?: string;\n  /** Additional information for special use cases */\n  meta?: any;\n}\n\nexport interface Operation {\n  op: string;\n  args?: ValueOrExpr[];\n  c?: string[];\n  opts?: ValueOrExpr;\n}\n\nexport type Sort = ValueOrExpr|SortBy;\nexport type SortBy = SortBySQL|SortByDir;\nexport interface SortByBase {\n  by: ValueOrExpr;\n}\nexport interface SortBySQL extends SortByBase {\n  desc?: ValueOrExpr|boolean;\n}\nexport interface SortByDir extends SortByBase {\n  dir?: ValueOrExpr|'asc'|'desc';\n}\n\nexport type Operator = AggregateOperator | ValueOperator | CheckedOperator;\n\nexport interface OperatorOptions {\n  [key: string]: any;\n  // this is a dirty hack to make ts acknowledge that this isn't just any old object\n  __options: 1;\n}\n\nexport interface BaseOperator {\n  names: string[];\n}\nexport interface ValueOperator extends BaseOperator {\n  type: 'value';\n  apply(name: string, values: any[], opts: OperatorOptions, context: Context): any;\n}\n\nexport interface CheckedOperator extends BaseOperator {\n  type: 'checked';\n  apply(name: string, values: any[], opts: OperatorOptions, context: Context): any;\n  checkArg: (name: string, num: number, last: number, value: any, opts: OperatorOptions, context: Context, expr: ValueOrExpr) => CheckResult;\n  extend?: true;\n}\n\nexport interface AggregateOperator extends BaseOperator {\n  type: 'aggregate';\n  apply(name: string, values: any[], args: ValueOrExpr[], opts: OperatorOptions, context: Context): any;\n  extend?: true;\n  value?: true;\n}\n\nexport type CheckResult = 'continue'|{ result: any }|{ skip: number, value?: any };\n\nexport interface Group<R = any> {\n  grouped: number;\n  group: string;\n  value: R;\n  all: R[];\n  level: number;\n}\n\n// eval\nexport function getKeypath(ref: Reference): Keypath {\n  if (typeof ref.r === 'object') return ref.r;\n  const path = parsePath(ref.r);\n  if ('k' in path) return path;\n  else return { k: [] };\n}\n\nexport function safeGet(root: Context, path: string|Keypath): any {\n  if (!path) return root.value;\n  const p = typeof path === 'string' ? parsePath(path) : path;\n\n  if ('error' in p) return;\n  else if ('k' in p) {\n    let parts = p.k;\n    const prefix = p.p;\n    let idx = 0;\n    let ctx = root;\n    let o: any = root.value;\n\n    for (let i = 0; i < p.u; i++) ctx && (ctx = ctx.parent);\n    o = ctx ? ctx.value : undefined;\n\n    if (prefix) {\n      if (prefix === '!') o = root.root.parameters;\n      else if (prefix === '~') o = root.root.value;\n      else if (prefix === '*') {\n        o = root.root.sources[parts[idx++] as string];\n        if (o && idx < parts.length + 1 && parts[idx] !== 'value') o = o.value;\n      } else if (prefix === '@') {\n        const which = parts[idx++] as string;\n        if (which === 'locals' || which === 'specials') {\n          const key = which === 'locals' ? which : 'special';\n          while (ctx) {\n            if (ctx[key]) break;\n            ctx = ctx.parent;\n          }\n          if (ctx) o = ctx[key];\n        } else if (which === 'local' || which === 'special') {\n          const key = which === 'local' ? 'locals' : which;\n          o = ctx[key] || (ctx[key] = {});\n        } else if (which === 'parameters' || which === 'sources') {\n          o = root.root[which];\n        } else if (which !== 'value') {\n          while (ctx && (!ctx.special || !(which in ctx.special))) ctx = ctx.parent;\n          o = ctx && ctx.special[which];\n\n          if (o && which === 'source' && parts[idx] !== undefined && parts[idx] !== 'value' && o.value) o = o.value;\n          if (!o && which === 'date') o = root.root.special.date = new Date();\n        }\n      }\n    } else {\n      const first = parts[0];\n      if (first === '_') {\n        if (ctx.special && ctx.special.pipe) o = ctx.special.pipe;\n        idx++;\n      } else if (typeof first === 'string') {\n        let lctx = ctx;\n        while (lctx && (!lctx.locals || !(first in lctx.locals))) lctx = lctx.parent;\n        if (lctx && first in lctx.locals) {\n          o = lctx.locals[first];\n          idx++;\n        }\n      }\n    }\n\n    for (let i = idx; i < parts.length; i++) {\n      const part = parts[i];\n      const v = typeof part !== 'object' ? part : evalValue(root, part);\n      if (Array.isArray(o) && typeof v === 'number' && v < 0) o = o[o.length + v];\n      else o = o && o[v];\n      if (o === null || o === undefined) return;\n    }\n\n    return o;\n  }\n}\n\nexport function safeSet(root: Context, path: string|Keypath, value: any, islet?: boolean): any {\n  if (!path) return;\n  const p = typeof path === 'string' ? (islet ? parseLetPath(path) : parsePath(path)) : path;\n\n  if ('error' in p) return;\n  else if ('k' in p) {\n    let parts = p.k;\n    const prefix = p.p;\n    let ctx = root;\n    let o: any = root.value;\n\n    for (let i = 0; i < p.u; i++) ctx && (ctx = ctx.parent);\n    o = ctx ? ctx.value : undefined;\n\n    const keys = parts.map(p => typeof p !== 'object' ? p : evalValue(root, p));\n\n    if (islet) {\n      o = root.locals || (root.locals = {});\n    } else if (prefix) {\n      if (prefix === '~') o = root.root.value;\n      else return;\n    }\n\n    if (!islet) {\n      const first = keys[0];\n      while (ctx) {\n        if (ctx.locals && first in ctx.locals) break;\n        ctx = ctx.parent;\n      }\n      if (ctx) o = ctx.locals;\n    }\n\n    const last = keys.length - 1;\n    for (let i = 0; i < last; i++) {\n      if (typeof o !== 'object' && typeof o !== 'function' || !o) return;\n      const key = keys[i];\n      const next = keys[i + 1];\n      if (!(key in o) || o[key] == null) o[key] = typeof next === 'number' ? [] : {};\n      o = o[key];\n    }\n    \n    if (o) {\n      const cur = o[keys[last]];\n      o[keys[last]] = value;\n      return cur;\n    }\n  }\n}\n\nexport function evaluate(value: ValueOrExpr): any;\nexport function evaluate(root: Context|{ context: Context }|any, value: ValueOrExpr): any;\nexport function evaluate(root: ValueOrExpr|Context|{ context: Context }|any, value?: ValueOrExpr): any {\n  let r: Context;\n  let e: ValueOrExpr;\n  if (isValueOrExpr(root)) {\n    r = new Root();\n    e = root;\n  } else if (isContext(root)) {\n    r = root;\n    !Array.isArray(value) && (e = value);\n  } else if (root && typeof root === 'object' && 'context' in root && isContext(root.context)) {\n    r = root.context;\n    !Array.isArray(value) && (e = value);\n  } else if (isValueOrExpr(value)) {\n    r = new Root(root);\n    e = value;\n  } else {\n    r = new Root();\n    e = root;\n  }\n  return evalParse(r, e);\n}\n\nexport function template(template: string): string;\nexport function template(root: Context|{ context: Context }|any, template: string): string;\nexport function template(root: string|Context|{ context: Context }|any, template?: string): string {\n  let r: Context;\n  let t: string;\n  if (typeof root === 'string') {\n    r = new Root();\n    t = root;\n  } else if (isContext(root)) {\n    r = root;\n    t = template || '';\n  } else if (root && typeof root === 'object' && 'context' in root && isContext(root.context)) {\n    r = root.context;\n    t = template || '';\n  } else if (root && typeof root !== 'string') {\n    r = new Root(root);\n    t = template || '';\n  } else {\n    r = new Root();\n    t = root;\n  }\n  r = extend(r, { parser: parseTemplate });\n  return evalParse(r, t);\n}\n\n/**\n * Evaluate an applicative with the given locals, naming them if the applicative declares named arguments.\n * If swap is not true, then a new context extension will be used. Otherwise, the context locals will be\n * swapped for the evaluation and replaced afterwards. Swap should only be used for applications that are\n * passing the context value as the first local.\n */\nexport function evalApply(ctx: Context, value: ValueOrExpr, locals: any[], special?: object): any {\n  if (isApplication(value)) {\n    const c = extend(ctx, { value: locals[0], special, fork: !ctx.locals });\n    let res: any;\n    if ('n' in value) {\n      const map = value.n.reduce((a, c, i) => (a[c] = locals[i], a), {} as ParameterMap);\n      c.locals = map;\n    }\n    res = evalValue(c, value.a);\n    return res;\n  } else {\n    const v = evalParse(extend(ctx, { value: locals[0], special, fork: !ctx.locals }), value);\n    if (isApplication(v)) return evalApply(ctx, v, locals, special);\n    else return v;\n  }\n}\n\nexport function evalParse(ctx: Context, expr: ValueOrExpr): any {\n  if (typeof expr === 'string') {\n    const p = ctx.parser || parse;\n    const ns = p.namespace || 'unknown';\n    const cache = ctx.root.exprs[ns] || (ctx.root.exprs[ns] = {});\n    expr = cache[expr] || (cache[expr] = p(expr));\n  }\n  if (typeof expr !== 'object') expr = { v: expr };\n  return evalValue(ctx, expr);\n}\n\nexport function evalValue(ctx: Context, expr: Value): any {\n  if (!expr) return expr;\n  if ('r' in expr) return safeGet(ctx, expr.r);\n  else if ('v' in expr) return expr.v;\n  else if ('op' in expr) return applyOperator(ctx, expr);\n  else if (isApplication(expr)) return expr;\n  else if (isDateRel(expr) || isTimespan(expr)) return expr;\n}\n\nconst opMap: { [key: string]: Operator } = {};\nexport function registerOperator(...ops: Operator[]) {\n  for (const op of ops) {\n    for (const name of op.names) opMap[name] = op;\n  }\n}\nexport function unregisterOperator(...ops: Operator[]) {\n  for (const op of ops) {\n    for (const name of op.names) delete opMap[name];\n  }\n}\nexport function getOperatorMap(): { [key: string]: Operator } {\n  return Object.assign({}, opMap);\n}\nexport function getOperator<T extends Operator = Operator>(name: string): T {\n  return opMap[name] as T;\n}\n\nconst _defaultGetValue = (c: Context, b: ValueOrExpr, v: any) => evalApply(c, b, [v]);\nexport function sort(context: Context, arr: any[], sorts: Sort[]|ValueOrExpr, getValue?: (context: Context, by: ValueOrExpr, v: any) => any): any[] {\n  let sortArr: Sort[];\n  \n  if (Array.isArray(sorts)) {\n    sortArr = sorts;\n  } else if (isApplication(sorts)) {\n    sortArr = [sorts];\n  } else if (typeof sorts === 'object' && sorts && 'by' in sorts) {\n    sortArr = [sorts];\n  } else {\n    const s = evalParse(context, sorts);\n    if (Array.isArray(s)) sortArr = s;\n    else if (typeof s === 'string') sortArr = [{ v: s }];\n    else if (typeof sorts === 'string') sortArr = [sorts]\n  }\n\n  if (sortArr) {\n    let el: any;\n    for (let i = 0; i < sortArr.length; i++) {\n      el = sortArr[i];\n      const by = isLiteral(el) ? el.v : el;\n      if (typeof by === 'string') {\n        if (by[0] === '-') sortArr[i] = { by: by.slice(1), desc: true };\n        else sortArr[i] = { by: by[0] === '+' ? by.slice(1) : by, desc: false };\n      }\n    }\n  }\n\n  getValue = getValue || _defaultGetValue;\n  if (sortArr && sortArr.length) {\n    const dirs = sortArr.map(s => {\n      if (typeof s === 'object') {\n        if ('by' in s) {\n          if ('desc' in s) {\n            if (typeof s.desc === 'boolean') return s.desc;\n            return evalParse(context, s.desc);\n          } else if ('dir' in s) {\n            const lower = typeof s.dir === 'string' ? s.dir.toLowerCase() : s.dir;\n            const dir = lower === 'asc' || lower === 'desc' ? lower : evalParse(context, s.dir);\n            const val = typeof dir === 'string' ? dir.toLowerCase() : dir;\n            if (val === 'desc') return true;\n          }\n        }\n      }\n      // default to asc\n      return false;\n    });\n\n    arr.sort((a, b) => {\n      for (let i = 0; i < sortArr.length; i++) {\n        const s = sortArr[i];\n        const desc = dirs[i];\n        const by: ValueOrExpr = typeof s === 'string' ? s : s && (s as any).by ? (s as any).by : s;\n        const l = getValue(context, by, a);\n        const r = getValue(context, by, b);\n        const cmp = l == null && r != null ? -1 \n          : l != null && r == null ? 1\n          : (l < r) === (r < l) ? 0\n          : l < r ? -1\n          : l > r ? 1\n          : 0;\n        if (cmp) return (desc ? -1 : 1) * cmp;\n      }\n      return 0;\n    });\n  }\n\n  return arr;\n}\n\nexport function filter(arr: any[], filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): any[];\nexport function filter(ds: DataSet, filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): DataSet;\nexport function filter(ds: DataSet|any[], filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): DataSet|any[] {\n  const _ds = Array.isArray(ds) ? { value: ds } : ds;\n  if (!_ds || !Array.isArray(_ds.value)) return _ds;\n  let _context: Context;\n  if (!context) _context = new Root(_ds.value, { special: { source: _ds } });\n  else if (isContext(context)) _context = extend(context, { special: { source: _ds.value } });\n  else _context = new Root(context);\n  const values = filter ? [] : _ds.value.slice();\n\n  if (filter) {\n    let flt: Value = typeof filter === 'string' ? parse(filter) : filter;\n    if ('m' in flt) flt = { v: true };\n    _ds.value.forEach((row, index) => {\n      if (!!evalApply(extend(_context, { value: row, special: { value: row, index } }), flt, [row, index])) values.push(row);\n    });\n  }\n\n  if (sorts) sort(_context, values, sorts);\n\n  if (groups && !Array.isArray(groups)) groups = [groups];\n\n  if (Array.isArray(groups) && groups.length) {\n    return { value: { schema: _ds.schema, grouped: groups.length, level: 0, value: group(values, groups, _context, 1), all: values } };\n  }\n\n  if (Array.isArray(ds)) return values;\n  else return { schema: _ds.schema, value: values };\n}\n\ninterface GroupCache {\n  [group: string]: any[];\n}\n\nfunction group(arr: any[], groups: Array<ValueOrExpr>, ctx: Context, level: number = 0): Group[] {\n  const cache: GroupCache = {};\n  const res: Group[] = [];\n  const order: string[] = [];\n  for (const e of arr) {\n    const g = isApplication(groups[0]) ? `${evalApply(ctx, groups[0], [e])}` : `${evalParse(extend(ctx, { value: e }), groups[0])}`;\n    if (!cache[g]) {\n      order.push(g);\n      cache[g] = [];\n    }\n    cache[g].push(e);\n  }\n\n  for (const k of order) {\n    res.push({ group: k, grouped: groups.length - 1, value: groups.length > 1 ? group(cache[k], groups.slice(1), ctx, level + 1) : cache[k], all: cache[k], level });\n  }\n\n  return res;\n}\n\nfunction hasPipeRef(ref: Reference): boolean {\n  const path = getKeypath(ref);\n  return path.k[0] === '_' || path.p === '@' && path.k[0] === 'pipe';\n}\n\nfunction applyOperator(root: Context, operation: Operation): any {\n  const op = opMap[operation.op];\n\n  // if the operator doesn't exist, try a local, pipe, or skip\n  if (!op) {\n    const local = safeGet(root, operation.op) || safeGet(root.root, operation.op);\n    if (isApplication(local)) {\n      return evalApply(root, local, (operation.args || []).map(a => evalParse(root, a)));\n    } else if (operation.op === 'pipe') { // handle the special built-in pipe operator\n      if (!operation.args || !operation.args.length) return true;\n      let v = evalParse(root, operation.args[0]);\n      for (let i = 1; i < operation.args.length; i++) {\n        let a = operation.args[i];\n        if (isOperation(a) && (!a.args || !a.args.find(a => isReference(a) && hasPipeRef(a)))) a = Object.assign({}, a, { args: [{ r: { k: ['pipe'], p: '@' } } as ValueOrExpr].concat(a.args || []) });\n        \n        if (isApplication(a)) v = evalApply(root, a, [v]);\n        else v = evalParse(extend(root, { special: { pipe: v } }), a);\n      }\n      return v;\n    }\n    return true;\n  }\n\n  let args: any[];\n  if (op.type === 'checked') {\n    args = [];\n    const flts = operation.args || [];\n    const ctx = op.extend ? extend(root, {}) : root;\n    const opts = operation.opts ? evalParse(ctx, operation.opts) : undefined;\n    for (let i = 0; i < flts.length; i++) {\n      const a = flts[i];\n      const arg = evalParse(ctx, a);\n      const res = op.checkArg(operation.op, i, flts.length - 1, arg, opts, ctx, a);\n      if (res === 'continue') args.push(arg);\n      else if ('skip' in res) {\n        i += res.skip;\n        if ('value' in res) args.push(res.value);\n      } else if ('result' in res) return res.result;\n    }\n\n    return op.apply(operation.op, args, opts, ctx);\n  } else if (op.type === 'value') {\n    args = (operation.args || []).map(a => evalParse(root, a));\n    return op.apply(operation.op, args, operation.opts ? evalParse(root, operation.opts) : undefined, root);\n  } else {\n    let arr: any[];\n    const ctx = op.extend ? extend(root, {}) : root;\n    const args = (operation.args || []).slice();\n    const opts = operation.opts ? evalParse(ctx, operation.opts) : undefined;\n    let arg: any;\n    if (!op.value) {\n      arg = evalParse(ctx, args[0]);\n      if (Array.isArray(arg)) {\n        args.shift();\n        arr = arg;\n      } else if (typeof arg === 'object' && 'value' in arg && Array.isArray(arg.value)) {\n        args.shift();\n        arr = arg.value;\n      }\n      if (!arr) {\n        const src = evalValue(ctx, { r: '@source' });\n        if (Array.isArray(src)) arr = src;\n        else if (typeof src === 'object' && 'value' in src && Array.isArray(src.value)) arr = src.value;\n        else arr = [];\n      }\n    }\n    return op.apply(operation.op, Array.isArray(arr) ? arr : [], args, opts, ctx);\n  }\n}\n\nexport interface Keypath {\n  u?: number;\n  p?: '!'|'~'|'*'|'@';\n  k: Array<string|number|Value>;\n}\n\nexport function isKeypath(v: any): v is string|Keypath {\n  return typeof v === 'string' || (typeof v === 'object' && Array.isArray(v.k));\n}\n\nexport function isLiteral(v: any): v is Literal {\n  return typeof v === 'object' && 'v' in v;\n}\n\nexport function isReference(v: any): v is Reference {\n  return typeof v === 'object' && 'r' in v;\n}\n\nexport function isOperation(v: any): v is Operation {\n  return typeof v === 'object' && typeof v.op === 'string';\n}\n\nexport interface Reference { r: string|Keypath; c?: string[] };\nexport interface Application { a: Value; n?: string[]; c?: string[] };\nexport interface Literal { v: any; s?: 1; c?: string[] };\n\nexport function isApplication(v: any): v is Application {\n  if (typeof v !== 'object' || !('a' in v) || typeof v.a !== 'object') return false;\n  const len = Object.keys(v).length;\n  return len === 1 || len === 2 && 'n' in v;\n}\n\n/** A timespan specified in milliseconds */\nexport interface DateRelSpanMS {\n  /** Starting point (now) */\n  f: 'n';\n  /** Offset in ms */\n  o: number;\n  /** Timezone offset */\n  z?: number;\n}\n/** A timespan specified in individual units years, months, days, hours, minutes, seconds, and/or milliseconds */\nexport interface DateRelSpanFull {\n  /** Starting point (now) */\n  f: 'n';\n  /** Offset array [years, months, days, hours, minutes, seconds, milliseconds] */\n  o: [number?, number?, number?, number?, number?, number?, number?];\n  /** Offset direction is before starting point */\n  d?: -1;\n  /** Timezone offset */\n  z?: number;\n}\nexport type DateRelSpan = DateRelSpanMS | DateRelSpanFull;\n\n/** A date span covering last|this|next day|week|month|year */\nexport interface DateRelRange {\n  /** Starting point (d: day, w: week, m: month, y: year) */\n  f: 'd'|'w'|'m'|'y';\n  /** Offset in units (-1: last, 0: this, 1: next) */\n  o: -1|0|1;\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n  /** Timezone offset */\n  z?: number;\n}\n/** A date span by time relative to yesterday, today, or tomorrow */\nexport interface DateRelTimeRange {\n  /** Starting point (day) */\n  f: 'd';\n  /** Offset in units (-1: yesterday, 0: today, 1: tomorrow) */\n  o: -1|0|1;\n  /** Time array [hour, minute, second, millisecond, timezone offset] */\n  t: [number, number?, number?, number?, number?];\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n}\n/** A date span covering this year, month, or week to the current date */\nexport interface DateRelToDate {\n  /** Starting point */\n  f: 'w'|'m'|'y';\n  /** Offset */\n  o: 0;\n  /** Relative to current date */\n  d: 1;\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n  /** Timezone offset */\n  z?: number;\n}\n/** A date range covering a specific range in time at most a year, optionally more specific by scoping farther\n * down with a month, date, hour, minute, second, and millisecond. It may also specify a timezone. */\nexport interface DateExactRange {\n  /** Starting point [year, month, date, hour, minute, second, millisecond, timezone] */\n  f: [number, number?, number?, number?, number?, number?, number?, number?];\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n}\nexport type DateRel = Date | DateRelSpan | DateRelRange | DateRelTimeRange | DateRelToDate | DateExactRange;\n\nexport type TimeSpan = number|TimeSpanMS|FullTimeSpan;\nexport interface TimeSpanMS {\n  ms: number;\n}\nexport interface FullTimeSpan {\n  s?: number;\n  d: [number?, number?, number?, number?, number?, number?, number?];\n}\n\nexport type ValueOrExpr = string|Value;\nexport type Value = Reference | Literal | Operation | Application | ParseError;\n\nexport function isValueOrExpr(o: any): o is ValueOrExpr {\n  return typeof o === 'string' || isValue(o);\n}\n\nexport function isValue(o: any): o is Value {\n  return typeof o === 'object' && o && (\n    ('r' in o && typeof o.r === 'string') ||\n    ('op' in o && typeof o.op === 'string') ||\n    ('v' in o) ||\n    (isApplication(o))\n  );\n}\n\nexport type Parameter<T = any> = ParameterBase & T;\nexport interface ParameterBase {\n  name: string;\n  label?: string;\n  type?: Type;\n  required?: boolean;\n  refine?: string;\n  init?: ValueOrExpr;\n  options?: Array<string|{ label: string; value: any }>;\n}\n\nexport interface ParameterMap {\n  [name: string]: any;\n}\n\nexport function isContext(v: any): v is Context {\n  return typeof v === 'object' && typeof v.path === 'string' && typeof v.root == 'object' && 'value' in v && (typeof v.parent === 'object' || v.root === v);\n}\nexport interface Context {\n  path: string;\n  root: RootContext;\n  parent?: Context;\n  special?: ParameterMap;\n  locals?: ParameterMap;\n  value: any;\n  parser?: ((txt: string) => Value) & { namespace: string };\n}\n\nexport interface RootContext extends Context {\n  parameters: ParameterMap;\n  sources: SourceMap;\n  parent: undefined;\n  exprs: { [ns: string]: { [key: string]: Value } };\n}\n\nexport class Root implements RootContext {\n  value: any;\n  root: RootContext = this;\n  parameters: ParameterMap = {};\n  sources: SourceMap = {};\n  special: ParameterMap = {};\n  parent: undefined;\n  exprs = {} as { [ns: string]: { [key: string]: Value } };\n  parser?: ((txt: string) => Value) & { namespace: string };\n  path: '' = '';\n\n  constructor(root: any = {}, opts?: ExtendOptions & { parameters?: ParameterMap }) {\n    this.value = root;\n    if (opts) {\n      Object.assign(this.parameters, opts.parameters);\n      Object.assign(this.special, opts.special);\n      if (opts.parser) this.parser = opts.parser;\n    }\n  }\n}\n\nexport function join(context: Context, path: string): Context {\n  return {\n    parent: context,\n    root: context.root,\n    path: context.path ? `${context.path}.${path}` : path,\n    value: safeGet(context, path)\n  };\n}\n\nexport interface ExtendOptions {\n  value?: any;\n  special?: any;\n  locals?: ParameterMap,\n  parser?: ((txt: string) => Value) & { namespace: string };\n  path?: string;\n  fork?: boolean;\n}\n\nexport function extend(context: Context, opts: ExtendOptions): Context {\n  return {\n    parent: opts.fork ? (context.parent || context.root) : context,\n    root: context.root,\n    path: opts.path || '',\n    value: 'value' in opts ? opts.value : context.value,\n    special: opts.fork ? Object.assign({}, context.special, { pipe: undefined }, opts.special) : (opts.special || {}),\n    parser: opts.parser,\n    locals: opts.locals,\n  };\n}\n\nexport const formats: { [name: string]: { apply: (value: any, args?: any[], opts?: OperatorOptions) => string, defaults: { [key: string]: any } } } = {};\nexport const virtualFormats: { [name: string]: { defaults: { [key: string]: any } } } = {};\nexport function registerFormat<T = any>(name: string|string[], format: (value: T, args?: any[], opts?: OperatorOptions) => string, defaults: { [key: string]: any } = {}) {\n  if (Array.isArray(name)) name.forEach(n => formats[n] = { apply: format, defaults });\n  else formats[name] = { apply: format, defaults };\n}\nexport function unregisterFormat(name: string) {\n  delete formats[name];\n}\n\nexport function dateRelToRange(rel: DateRel): [Date, Date] {\n  if (rel instanceof Date) return [rel, rel];\n\n  let from = new Date();\n  let to: Date = 'd' in rel && rel.d ? new Date() : undefined;\n  from.setUTCFullYear(from.getFullYear(), from.getMonth(), from.getDate());\n  from.setUTCHours(0, 0, 0, 0);\n  let tz: number = 'z' in rel && rel.z != null ? rel.z : null;\n\n  if (rel.f === 'n') { // DateRelSpan (MS or Full)\n    from = typeof rel.o === 'number' ? new Date(+new Date() + rel.o) : dateAndTimespan(new Date(), { d: rel.o }, 'd' in rel ? rel.d : 1);\n    to = from;\n    tz = undefined;\n  } else if (rel.f === 'd') { // DateRelRange - day\n    from.setUTCDate(from.getUTCDate() + rel.o);\n    if (!to) to = new Date(from);\n    if ('t' in rel) { // DateRelTimeRange\n      const t = rel.t;\n      from.setUTCHours(t[0], t[1] || 0, t[2] || 0, t[3] || 0);\n      to.setUTCHours(t[0], t[1] == null ? 59 : t[1], t[2] == null ? 59 : t[2], t[3] == null ? 999 : t[3]);\n      if (t[4] != null) tz = t[4];\n    }\n  } else if (rel.f === 'w') { // DateRelRange - week\n    from.setUTCDate(from.getUTCDate() - (from.getUTCDay() + (rel.o === -1 ? 7 : rel.o === 1 ? -7 : 0)));\n    if (!to) {\n      to = new Date(from);\n      to.setDate(from.getUTCDate() + 6);\n    }\n    if ('z' in rel && rel.z != null) tz = rel.z;\n  } else if (rel.f === 'm') { // DateRelRange - month\n    from.setUTCDate(1);\n    from.setUTCMonth(from.getUTCMonth() + rel.o);\n    if (!to) {\n      to = new Date(from);\n      to.setUTCMonth(from.getUTCMonth() + 1);\n      to.setUTCDate(0);\n    }\n  } else if (rel.f === 'y') { // DateRelRange - year\n    from.setUTCDate(1);\n    from.setUTCMonth(0);\n    from.setUTCDate(1);\n    if (!to) {\n      to = new Date(from);\n      to.setUTCFullYear(from.getUTCFullYear() + 1);\n      to.setUTCDate(0);\n    }\n  } else if (Array.isArray(rel.f)) { // DateExactRange\n    const v = rel.f.slice();\n    from = new Date(Date.UTC(v[0], v[1] || 0, v[2] || 1, v[3] || 0, v[4] || 0, v[5] || 0, v[6] || 0));\n    for (let i = 1; i < 7; i++) {\n      if (v[i] == null) {\n        v[i - 1]++;\n        break;\n      }\n    }\n    if (v[6] != null) v[6]++;\n    to = new Date(Date.UTC(v[0], v[1] || 0, v[2] || 1, v[3] || 0, v[4] || 0, v[5] || 0, v[6] || 0));\n    to.setUTCMilliseconds(to.getUTCMilliseconds() - 1);\n    if (v[7] != null) tz = v[7];\n  }\n\n  if (rel.f === 'd' || rel.f === 'w' || rel.f === 'm' || rel.f === 'y') to.setUTCHours(23, 59, 59, 999);\n\n  if (tz !== undefined) {\n    if (tz != null) {\n      from.setUTCMinutes(from.getUTCMinutes() - tz);\n      if (from !== to) to.setUTCMinutes(to.getUTCMinutes() - tz);\n    } else { // shift to local time\n      const offset = from.getTimezoneOffset();\n      from.setUTCMinutes(from.getUTCMinutes() + offset);\n      if (from !== to) to.setUTCMinutes(to.getUTCMinutes() + offset);\n    }\n  }\n\n  return [from, to];\n}\n\nexport function isDateRel(v: any): v is DateRel {\n  return v && typeof v === 'object' && (('f' in v && (Array.isArray(v.f) || 'o' in v)) || v instanceof Date);\n}\n\nexport function isDateExactRange(v: any): v is DateExactRange {\n  return v && typeof v === 'object' && 'f' in v && Array.isArray(v.f);\n}\n\nexport function dateRelToDate(rel: DateRel): Date {\n  const range = dateRelToRange(rel);\n  if ('e' in rel && rel.e != null) return range[1];\n  else return range[0];\n}\n\nexport function dateRelToExactRange(rel: DateRel): DateExactRange {\n  if (!rel) return;\n  if (isDateExactRange(rel)) return rel;\n  const dt = dateRelToDate(rel);\n  const offset = dt.getTimezoneOffset();\n  const z = 'z' in rel && rel.z != null ? rel.z : 'f' in rel && rel.f === 'd' && 't' in rel && rel.t[4] != null ? rel.t[4] : null;\n  if (rel instanceof Date && z != null) dt.setMinutes(dt.getMinutes() - (offset + z));\n  return {\n    f: [dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours(), dt.getMinutes(), dt.getSeconds(), dt.getMilliseconds(), z != null ? z : -offset],\n  };\n}\n\nexport function isTimespan(v: any): v is TimeSpan {\n  return typeof v === 'number' || (typeof v === 'object' && Array.isArray(v.d)) || isTimespanMS(v);\n}\n\nexport function addTimespan(l: TimeSpan, r: TimeSpan): TimeSpan {\n  if (typeof l === 'number' && typeof r === 'number') return l + r;\n  else {\n    const res: TimeSpan = { d: [] };\n    if (typeof l === 'number') res.d[6] = l;\n    else if (isTimespanMS(l)) res.d[6] = l.ms;\n    else for (let i = 0; i < 7; i++) if (l.d[i]) res.d[i] = l.d[i];\n\n    if (typeof r === 'number') res.d[6] = (res.d[6] || 0) + r;\n    else if (isTimespanMS(r)) res.d[6] = (res.d[6] || 0) + r.ms;\n    else for (let i = 0; i < 7; i++) if (r.d[i]) res.d[i] = (res.d[i] || 0) + r.d[i];\n    return res;\n  }\n}\n\nexport function subtractTimespan(l: TimeSpan, r: TimeSpan): TimeSpan {\n  if (typeof l === 'number' && typeof r === 'number') return l - r;\n  else {\n    if (isTimespanMS(l)) l = l.ms;\n    if (isTimespanMS(r)) r = r.ms;\n    if (typeof l === 'number') {\n      const res = ({ d: (r as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      for (let i = 0; i < 7; i++) if (res.d[i]) res.d[i] = 0 - res.d[i];\n      res.d[6] = (res.d[6] || 0) + l;\n      return res;\n    } else if (typeof r === 'number') {\n      const res = ({ d: (l as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      res.d[6] = (res.d[6] || 0) - r;\n      return res;\n    } else {\n      const res = ({ d: (l as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      for (let i = 0; i < 7; i++) if (r.d[i]) l.d[i] = (l.d[i] || 0) - r.d[i];\n      return res;\n    }\n  }\n}\n\nexport function datesDiff(l: Date, r: Date): FullTimeSpan {\n  if (isNaN(+l) || isNaN(+r)) return { d: [] };\n  if (r < l) {\n    const s = r;\n    r = l;\n    l = s;\n  }\n  const a = new Date(l);\n  const b = r;\n  const res: FullTimeSpan = { d: [0, 0, 0, 0, 0, 0, 0], s: +a };\n  let num = b.getFullYear() - a.getFullYear() - 1;\n  let tmp1: number, tmp2: number;\n  if (num > 0) {\n    res.d[0] += num;\n    a.setFullYear(b.getFullYear() - 1);\n  }\n  a.setFullYear(a.getFullYear() + 1);\n  if (a > b) a.setFullYear(a.getFullYear() - 1);\n  else res.d[0]++;\n\n  // watch out for leap year\n  if (l.getMonth() === 1 && l.getDate() === 29 && a.getMonth() !== 1) {\n    a.setDate(29);\n    a.setMonth(1);\n  }\n\n  // jumping months can make days get weird\n  while (true) {\n    num = a.getDate();\n    tmp1 = a.getMonth();\n    tmp2 = a.getFullYear();\n    a.setDate(num + 1);\n    if (a.getMonth() !== tmp1) {\n      a.setDate(1);\n      a.setMonth(tmp1 + 2);\n      a.setDate(0);\n    } else {\n      a.setDate(num);\n      a.setMonth(tmp1 + 1);\n      if (tmp1 === 11 ? a.getMonth() !== 0 : a.getMonth() !== tmp1 + 1) {\n        a.setDate(1);\n        a.setMonth(tmp1 + 2);\n        a.setDate(0);\n      }\n    }\n    if (a > b) {\n      // make sure we stay in the correct year\n      a.setFullYear(tmp2);\n      a.setDate(1);\n      a.setMonth(tmp1);\n      a.setDate(num);\n      break;\n    } else res.d[1]++;\n  }\n\n  while (true) {\n    a.setDate(a.getDate() + 1);\n    if (a > b) {\n      a.setDate(a.getDate() - 1);\n      break;\n    } else res.d[2]++;\n  }\n\n  while (true) {\n    a.setHours(a.getHours() + 1);\n    if (a > b) {\n      a.setHours(a.getHours() - 1);\n      break;\n    } else res.d[3]++;\n  }\n\n  while (true) {\n    a.setMinutes(a.getMinutes() + 1);\n    if (a > b) {\n      a.setMinutes(a.getMinutes() - 1);\n      break;\n    } else res.d[4]++;\n  }\n\n  while (true) {\n    a.setSeconds(a.getSeconds() + 1);\n    if (a > b) {\n      a.setSeconds(a.getSeconds() - 1);\n      break;\n    } else res.d[5]++;\n  }\n\n  if (a.getMilliseconds() <= b.getMilliseconds()) res.d[6] = b.getMilliseconds() - a.getMilliseconds();\n  else res.d[6] = (1000 - a.getMilliseconds()) + b.getMilliseconds();\n\n  return res;\n}\n\nexport function dateAndTimespan(l: Date, r: TimeSpan, m: 1|-1): Date {\n  if (typeof r === 'number') return new Date(+l + r * m);\n  else if (isTimespanMS(r)) return new Date(+l + r.ms * m);\n  else {\n    let d = new Date(l);\n    if (r.d[0]) d.setFullYear(d.getFullYear() + r.d[0] * m);\n    if (r.d[1]) {\n      const dd = d.getDate();\n      d.setDate(1);\n      d.setMonth(d.getMonth() + r.d[1] * m);\n      const mm = d.getMonth();\n      d.setDate(dd);\n      if (mm !== d.getMonth()) d.setDate(0);\n    }\n    if (r.d[2]) d.setDate(d.getDate() + r.d[2] * m);\n    if (r.d[3]) d.setHours(d.getHours() + r.d[3] * m);\n    if (r.d[4]) d.setMinutes(d.getMinutes() + r.d[4] * m);\n    if (r.d[5]) d.setSeconds(d.getSeconds() + r.d[5] * m);\n    if (r.d[6]) d.setMilliseconds(d.getMilliseconds() + r.d[6] * m);\n    return d;\n  }\n}\n","import { Displayed, Placement } from '../report';\nimport { Context } from '../data/index';\n\nexport interface RenderContext {\n  parent?: RenderContext;\n  report: Displayed;\n  styles: StyleRegistry;\n  styleMap: StyleMap;\n  context: Context;\n  commit?: { [name: string]: any };\n}\n\nexport interface StyleRegistry {\n  [id: string]: string;\n}\n\ninterface StyleMap {\n  ids: { [id: string]: number };\n  styles: StyleRegistry;\n}\n\nexport function addStyle(context: RenderContext, id: string, style: string) {\n  if (!context.styles[id]) context.styles[id] = style;\n}\n\nexport function error(context: RenderContext, placement: Placement, message: string = 'Widget overflow error') {\n    addStyle(context, 'error', `.error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }`);\n    return { output: `<div class=\"error\" style=\"top: ${placement.y}rem;\">${message}</div>`, height: 2 };\n}\n","import { Displayed, Layout, Placement, Widget, Margin, MeasureFont, Computed, Borders } from '../report';\nimport { extend as extendContext, Context, ExtendOptions as ContextExtendOptions, evaluate, isValueOrExpr } from '../data/index';\nimport { error, RenderContext, addStyle } from './error';\n\nexport { RenderContext, error, addStyle } from './error';\n\nexport function isComputed(v: any): v is Computed {\n  return v && typeof v === 'object' && isValueOrExpr(v.x);\n}\n\nexport function maybeComputed<V, T = Exclude<V, Computed>>(v: V, context: RenderContext): T {\n  if (!isComputed(v)) return v as any;\n  else if (v.x) return evaluate(context, v.x);\n}\n\nexport interface ExtendOptions extends ContextExtendOptions {\n  commit?: { [key: string]: any };\n}\n\nexport function extend(context: RenderContext, opts: ExtendOptions): RenderContext {\n  return { parent: context, report: context.report, context: extendContext(context.context, opts), styles: context.styles, styleMap: context.styleMap, commit: opts.commit };\n}\n\nconst htmlChars = /[><&]/g;\nconst htmlReplace = { '<': '&lt;', '>': '&gt;', '&': '&amp;' };\nexport function escapeHTML(html: string): string {\n  return ('' + html).replace(htmlChars, m => htmlReplace[m] || '');\n}\n\nconst renderers: { [type: string]: Renderer } = {};\nexport function registerRenderer<T extends Widget = Widget, S = any>(type: string, renderer: ((widget: T, context: RenderContext, placement: Placement, state?: RenderState<S>) => RenderResult<S>) | Renderer<T, S>, options?: RendererOptions) {\n  renderers[type] = typeof renderer === 'function' ? { render: renderer } : renderer;\n  if (options) Object.assign(renderers[type], options);\n}\n\n/** Decent guesstimates for char width at 16px/em */\nconst avgs = {\n  sans: 7.4,\n  serif: 6.7,\n  mono: 7.85,\n  narrow: 5.9,\n}\n\n/** Text height measurement function for the given text, font, available width in rem, and line height in rem.\n * The text is assumed to be rendered as white-space: pre-wrap.\n */\nexport function measureEstimate(text: string, width: number, context: RenderContext, font?: MeasureFont): number {\n  const family = (font && maybeComputed(font.family, context)) || 'sans';\n  const size = (font && maybeComputed(font.size, context)) || 0.83;\n  const line = (font && maybeComputed(font.line, context)) || size;\n  const brw = font && 'break-word' in font ? font['break-word'] : true;\n  const avg = (((font && maybeComputed(font.metric, context)) || ((family === 'mono' || /fixed|mono/i.test(family) ? avgs.mono :\n    family === 'narrow' || /narrow|condensed/i.test(family) ? avgs.narrow :\n      family === 'sans' || /sans|arial|helvetica/i.test(family) ? avgs.sans :\n        avgs.serif))) * size) / 16;\n  \n  const lines = text.split(/\\r?\\n/g);\n  return lines.reduce((a, c) => {\n    const [word, lines] = c.split(/\\s|-/g).reduce((a, c) => {\n      const wlen = (c.length + 1) * avg;\n      if (a[0] + wlen > width) {\n        if (a[0] === 0 || wlen > width) {\n          if (brw) {\n            a[0] = (wlen - (width - a[0])) % width;\n            if (wlen > width) a[1] += Math.floor(wlen / width);\n          }\n          a[1]++;\n        } else {\n          a[0] = wlen;\n          a[1]++;\n        }\n      } else {\n        a[0] += wlen;\n      }\n      return a;\n    }, [0, 0]);\n    return a + ((lines + (word > 0 ? 1 : 0)) || 1);\n  }, 0) * line;\n}\n\n/** Text height measurement function for the given text, font, available width in rem, and line height in rem.\n * The text is assumed to be rendered as white-space: pre-wrap.\n */\nexport let measure: (text: string, width: number, context: RenderContext, font?: MeasureFont) => number = measureEstimate;\n\nexport interface RenderContinuation<T = any> {\n  output: string;\n  continue?: RenderState<T>;\n  height?: number;\n  width?: number;\n  cancel?: boolean;\n}\n\nexport type RenderResult<T = any> = string|RenderContinuation<T>;\n\nexport interface Renderer<T extends Widget = Widget, S = any> extends RendererOptions {\n  render(widget: T, context: RenderContext, placement: Placement, state?: RenderState<S>): RenderResult;\n}\n\nexport interface RendererOptions {\n  container?: boolean;\n}\n\nexport interface RenderState<T = any> {\n  child?: RenderState;\n  last?: number;\n  state?: T;\n  offset: number;\n  attempt?: number;\n}\n\n/** Render the given widget to string or a continuation using a registered renderer */\nexport function renderWidget(w: Widget, context: RenderContext, placement: Placement, state?: RenderState): RenderContinuation {\n  const renderer = renderers[w.type];\n  if (!renderer || (w.hide && evaluate(extendContext(context.context, { special: { widget: w, placement } }), w.hide))) return { output: '', height: 0 };\n\n  if (!('height' in w) && renderer.container) w.height = 'auto'; \n  const h = getHeightWithMargin(w, placement, context);\n\n  if (placement.maxY && !isNaN(h) && h > placement.maxY) return error(context, placement);\n\n  if (placement.availableY != null && h > placement.availableY) return { output: '', continue: { offset: 0 }, cancel: true };\n\n  let extraHeight = 0;\n\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    extraHeight += m[0] + m[2];\n    if (placement.availableY != null) placement.availableY -= m[0] + m[2];\n  }\n\n  if (w.border && !h && w.box === 'expand') {\n    const b = expandBorder(w, context, placement)\n    extraHeight += b[0] + b[2];\n    if (placement.availableY != null) placement.availableY -= b[0] + b[2];\n  }\n\n  const r = renderer.render(w, context, placement, state);\n  if (typeof r === 'string') return { output: r, height: h, width: getWidthWithMargin(w, placement, context) };\n\n  if (typeof r.height === 'number') r.height = +r.height.toFixed(6);\n  if (typeof r.width === 'number') r.width = +r.width.toFixed(6);\n  if (placement.availableY != null) placement.availableY = +placement.availableY.toFixed(6);\n  \n  if (placement.maxY && r.height > placement.maxY) return error(context, placement);\n\n  if (isNaN(h) && placement.availableY != null && r.height > placement.availableY) return { output: '', continue: { offset: 0 }, height: r.height || 0, cancel: true };\n\n  r.height = r.height || 0;\n\n  r.height += extraHeight;\n\n  r.height = +(r.height.toFixed(6));\n\n  return r;\n}\n\nconst layouts: { [name: string]: (widget: Widget, offset: number, margin: [number, number, number, number], placement: Placement, placements: Array<[number, number, number, number]>, context: RenderContext) => Placement } = {};\n\nexport function registerLayout(name: string, layout: (widget: Widget, offset: number, margin: [number, number, number, number], placement: Placement, placements: Array<[number, number, number, number]>, context: RenderContext) => Placement) {\n  layouts[name] = layout;\n}\n\nregisterLayout('row', (w, o, m, p, ps, context) => {\n  let n: Placement;\n  let br = isComputed(w.br) ? evaluate(extendContext(context.context, { special: { placement: p, widget: w } }), w.br.x) : w.br;\n  let availableX = p.maxX - ps[0][0] - ps[0][2] + ps[ps.length - 1][0];\n  if (availableX <= 0) {\n    availableX = p.maxX;\n    br = true;\n  }\n  if (br || ps[0][0] + ps[0][2] + getWidthWithMargin(w, { x: p.x, y: p.y, maxX: p.maxX, maxY: p.maxY, availableY: p.availableY, availableX }, context) - ps[ps.length - 1][0] > p.maxX) {\n    n = { x: m[3], y: maxYOffset(ps), availableX: p.maxX, maxX: p.maxX };\n    n.availableY = p.availableY - (n.y - o);\n  } else {\n    n = { x: ps[0][0] + ps[0][2], y: ps[0][1], availableX, maxX: p.maxX, availableY: p.availableY };\n  }\n\n  n.y -= o;\n\n  return n;\n});\n\n/** Render child widgets handling continuation across pages */\nexport function renderWidgets(widget: Widget, context: RenderContext, placement: Placement, state?: RenderState, layout?: Layout): RenderContinuation {\n  if (Array.isArray(widget.widgets)) {\n    let s = '';\n    const offset = (state || { offset: 0 }).offset;\n    const ps: Array<[number, number, number, number]> = [[0, offset, 0, 0]];\n\n    const m = expandMargin(widget, context, placement);\n    ps[0][0] += m[3];\n    ps[0][1] += m[0];\n\n    // placement starts with availableY shrunk for margins, so offset y by the top margin\n    const yo = m[0] || 0;\n\n    if (widget.border && widget.box === 'expand') {\n      const b = expandBorder(widget, context, placement);\n      if (placement.availableX != null) placement.availableX -= b[1] + b[3];\n      if (placement.availableY != null) placement.availableY -= b[0] + b[2];\n    }\n\n    for (let i = state && state.last || 0; i < widget.widgets.length; i++) {\n      let w: Widget = widget.widgets[i];\n      if (w.macro) w = expandMacro(w.macro, w, context, placement, state);\n      if (w.hide && evaluate(extendContext(context.context, { special: { widget: w, placement } }), w.hide)) continue;\n\n      // allow widgets that are taller than max height to be dropped\n      let h = placement && getHeightWithMargin(w, placement, context);\n      if (h > placement.maxY) h = 1;\n\n      if (placement && placement.availableY != null && h > placement.availableY) {\n        const offset = maxYOffset(ps);\n        state = state || { offset };\n        state.last = i;\n        return { output: s, continue: state, height: offset };\n      } else {\n        let lp = Array.isArray(layout) && (layout[i] || [0, 0]);\n        if (!lp || !Array.isArray(lp)) lp = [0, 0];\n        if (!lp[0]) lp[0] = 0;\n        if (!lp[1]) lp[1] = 0;\n        let p: Placement = Array.isArray(lp) ? { x: lp[0] < 0 ? lp[0] : lp[0] + m[3], y: lp[1] < 0 ? lp[1] : lp[1] + m[0], maxX: placement.maxX } : (lp || placement);\n        if (Array.isArray(lp)) p.availableX = p.maxX;\n\n        if (!layout || typeof layout === 'string') {\n          const l = layout ? layouts[layout as string] || layouts.row : layouts.row;\n          p = l(w, offset, m, placement, ps, context);\n          if (h > p.availableY) {\n            const offset = maxYOffset(ps);\n            state = state || { offset };\n            state.last = i;\n            return { output: s, continue: state, height: offset };\n          }\n        }\n\n        p.maxX = p.maxX || placement.maxX;\n        p.maxY = p.maxY || placement.maxY;\n\n        if (p.x < 0) {\n          p.offsetX = m[3];\n          p.x = (placement.availableX || 1) + p.x - getWidthWithMargin(w, placement, context) + 1;\n        }\n        if (p.y < 0) {\n          p.offsetY = m[0];\n          if (placement.availableY == null) p.y = 0;\n          else p.y = (placement.availableY || 1) + p.y - h + 1;\n        }\n\n        const { x, y } = p;\n        const r = renderWidget(w, context, p, state && state.child);\n\n        // skip empty output\n        if (typeof r === 'string' && !r || (!r.cancel && !r.output && !r.continue && !r.height)) continue;\n\n        if (typeof r === 'string') {\n          s += r;\n          ps.unshift([x, y, getWidthWithMargin(w, placement, context), getHeightWithMargin(w, placement, context)]);\n        } else {\n          if (r.cancel) return { output: '', cancel: true };\n          const h = r.height || getHeightWithMargin(w, placement, context) || 0;\n          if (y - yo + h > placement.availableY) {\n            const offset = maxYOffset(ps);\n            state = state || { offset };\n            state.last = i;\n            state.attempt = (+state.attempt || 0) + 1;\n            if (state.attempt > 1) return error(context, placement);\n            return { output: s, continue: state, height: offset };\n          }\n          s += r.output;\n          ps.unshift([x, y, r.width || getWidthWithMargin(w, placement, context), h]);\n          if (r.continue) {\n            state = state || { offset: 0 };\n            state.child = r.continue;\n            state.last = i;\n            state.offset = maxYOffset(ps);\n            return { output: s, continue: state, height: maxYOffset(ps), width: maxXOffset(ps) };\n          }\n        }\n\n        if (p.availableX === 0) ps[0][2] = p.maxX;\n      }\n    }\n\n    return { output: s, height: getHeightWithMargin(widget, placement, context) || maxYOffset(ps) - m[0], width: getWidthWithMargin(widget, placement, context) || maxXOffset(ps) - m[3] };\n  }\n  return { output: '', height: 0 };\n}\n\nexport function getWidth(w: Widget, placement: Placement, context: RenderContext): number {\n  let width = isComputed(w.width) ? evaluate(extendContext(context.context, { special: { widget: w, placement} }), w.width.x) : w.width;\n  const m = w.margin && expandMargin(w, context, placement);\n  let pct = false;\n  if (width === 'grow') width = placement.availableX || placement.maxX;\n  else if (!width && width !== 0) width = placement.maxX || 51;\n  else if (typeof width === 'number') width;\n  else {\n    width = +((width.percent / 100) * (placement.maxX || 51)).toFixed(4);\n    pct = true;\n  }\n  if (typeof width === 'number' && (w.box === 'contain' || (pct || width === placement.availableX) && w.box !== 'expand')) {\n    if (m) width -= m[1] + m[3];\n    else if (w.font && w.font.right) width -= w.font.right;\n  }\n  return width;\n}\n\nexport function getWidthWithMargin(w: Widget, placement: Placement, context: RenderContext): number {\n  let r = getWidth(w, placement, context);\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    r += m[1] + m[3];\n  } else if (w.font && w.font.right) {\n    r += w.font.right;\n  }\n  return r;\n}\n\nfunction maxFontSize(w: Widget) {\n  let n = w.height || 1;\n  if (w.font && w.font.size > n) n = w.font.size;\n  if ('text' in w && Array.isArray(w.text)) {\n    for (let i = 0; i < w.text.length; i++) {\n      const t = w.text[i];\n      if (typeof t === 'object' && 'font' in t && t.font && t.font.size > n) n = t.font.size;\n    }\n  }\n  return n;\n}\n\nexport function getHeight(w: Widget, placement: Placement, context: RenderContext, computed?: number, linesize?: boolean): number {\n  let r = 1;\n  let h = isComputed(w.height) ? evaluate(extendContext(context.context, { special: { widget: w, placement, computed, linesize } }), w.height.x) : w.height;\n  const m = w.margin && expandMargin(w, context, placement);\n  const b = w.border && expandBorder(w, context, placement);\n  let pct = false;\n  if (h == null && linesize) h = maxFontSize(w);\n\n  if (typeof h === 'number') r = h;\n  else if (h && typeof h === 'object' && 'percent' in h && h.percent && placement.maxY) {\n    r = +(placement.maxY * (h.percent / 100)).toFixed(4);\n    pct = true;\n  } else if (h === 'grow') {\n    r = placement.availableY || 0;\n  } else if (h === 'auto' || typeof h === 'string' || (h == null && w.type === 'container') || (computed && !h)) {\n    if (b && w.box === 'expand') return computed + b[0] + b[2] || NaN;\n    return computed || NaN;\n  }\n\n  if (typeof r === 'number' && (w.box === 'contain' || (pct || r === placement.availableY) && w.box !== 'expand')) {\n    if (m) r -= m[0] + m[2];\n  }\n\n  return r;\n}\n\nexport function getHeightWithMargin(w: Widget, placement: Placement, context: RenderContext, computed?: number, linesize?: boolean): number {\n  let h = getHeight(w, placement, context, computed, linesize);\n  if (typeof h === 'number' && w.margin) {\n    const m = expandMargin(w, context, placement);\n    h += m[0] + m[2];\n  }\n  return h;\n}\n\nfunction maxYOffset(points: Array<[number, number, number, number]>): number {\n  return points.reduce((a, c) => a > c[1] + c[3] ? a : c[1] + c[3], 0);\n}\n\nfunction maxXOffset(points: Array<[number, number, number, number]>): number {\n  return points.reduce((a, c) => a > c[0] + c[2] ? a : c[0] + c[2], 0);\n}\n\nexport function expandMargin(w: { margin?: Margin|Computed }, context: RenderContext, placement: Placement): [number, number, number, number] {\n  if (w.margin) {\n    const m = isComputed(w.margin) ? evaluate(extendContext(context.context, { special: { widget: w, placement} }), w.margin.x) : w.margin;\n    if (Array.isArray(m)) {\n      if (m.length === 4) return m.map(e => +e) as [number, number, number, number];\n      else if (m.length === 2) return [+m[0], +m[1], +m[0], +m[1]];\n    } else if (typeof m === 'number') return [m, m, m, m];\n  }\n\n  return [0, 0, 0, 0];\n}\n\nexport function expandBorder(w: { border?: number|number[]|Borders|string }, context: RenderContext, placement: Placement): [number, number, number, number] {\n  let b = w.border;\n  let res: [number, number, number, number] = [0, 0, 0, 0];\n  if (typeof b === 'string' || (b && !Array.isArray(b) && typeof b === 'object' && ('v' in b || 'r' in b || 'op' in b))) b = evaluate(extendContext(context.context, { special: { widget: w, placement } }), b as string);\n  if (typeof b === 'number') res = [0, 0, b, 0];\n  else if (Array.isArray(b)) {\n    if (b.length === 1) res = [b[0], b[0], b[0], b[0]];\n    else if (b.length === 2) res = [b[0], b[1], b[0], b[1]];\n    else if (b.length === 3) res = [b[0], b[1], b[2], b[1]];\n    else if (b.length >= 4) res = [b[0], b[1], b[2], b[3]];\n  } else if (b && typeof b === 'object') res = [b.top || 0, b.right || 0, b.bottom || 0, b.left || 0]\n\n  for (let i = 0; i < 4; i++) res[i] = res[i] * 0.0625;\n  return res;\n}\n\nexport function expandMacro(macro: string, w: Widget, ctx: RenderContext, placement: Placement, state: RenderState): Widget {\n  const res = evaluate(extendContext(ctx.context, { special: { widget: w, placement, state } }), macro);\n  const orig = w;\n  if (res && !Array.isArray(res) && typeof res === 'object') {\n    if ('content' in res || 'props' in res || 'properties' in res) w = Object.assign({}, w, res.props, res.properties, { widgets: Array.isArray(res.content) ? res.content : res.content ? [res.content] : w.widgets, macro: undefined });\n    else if ('replace' in res && res.replace && typeof res.replace === 'object' && 'type' in res.replace) return res.replace;\n    else w = Object.assign({}, w, { widgets: [res], macro: undefined });\n  } else if (Array.isArray(res)) w = Object.assign({}, w, { widgets: res, macro: undefined });\n  return w;\n}\n","import { Borders, Font, Placement, Widget } from '../report';\nimport { expandMargin, expandBorder, getHeightWithMargin, maybeComputed, getWidthWithMargin, RenderContext } from './index';\nimport { ValueOrExpr } from '../data/index';\n\nexport interface StyleOptions {\n  computedHeight?: number;\n  container?: boolean;\n  lineSize?: boolean;\n  font?: Font;\n}\n\nexport function nextStyleId(ctx: RenderContext, prefix: string): number {\n  if (!ctx.styleMap.ids[prefix]) ctx.styleMap.ids[prefix] = 0;\n  return ctx.styleMap.ids[prefix]++;\n}\n\nexport function mapStyle(ctx: RenderContext, style: string, prefix: string): string {\n  if (!style) return '';\n  const mapped = ctx.styleMap.styles[style];\n  if (mapped) return mapped;\n  const id = `${prefix}${nextStyleId(ctx, prefix)}`;\n  return ctx.styleMap.styles[style] = id;\n}\n\nexport function styleClass(ctx: RenderContext, cls: string[], [style, inline]: [string, string], inlineStyle?: string, classPrefix?: string): string {\n  if (ctx.report.classifyStyles !== false) {\n    const cs = [];\n    if (inline) cs.push(mapStyle(ctx, inline, 'h'));\n    cs.push(mapStyle(ctx, style, classPrefix || 's'));\n    return ` class=\"${cls.concat(cs).join(' ')}\"${inlineStyle ? ` style=\"${inlineStyle}\"` : ''}`;\n  } else {\n    const s = `${style}${inlineStyle || ''}${inline || ''}`;\n    const c = `${cls.length ? ` class=\"${cls.join(' ')}\"` : ''}`;\n    return `${c}${s ? ` style=\"${s}\"` : ''}`;\n  }\n}\n\nexport function style(w: Widget, placement: Placement, context: RenderContext, opts?: StyleOptions): [string, string] {\n  let s = `left:${(placement.x || 0) + (placement.offsetX || 0)}rem;top:${((placement.y || 0) + (placement.offsetY || 0))}rem;`;\n  let i = ``;\n\n  s += `width:${getWidthWithMargin(w, placement, context)}rem;`;\n\n  let h = getHeightWithMargin(w, placement, context, opts && opts.computedHeight, opts && opts.lineSize) || 1;\n  if (w.height === 'grow' && w.margin) {\n    const m = expandMargin(w, context, placement);\n    h += m[0] + m[2];\n  }\n  if (opts && opts.container && opts.computedHeight) i = `height:${h}rem;`;\n  else s += `height:${h}rem;`;\n\n  const line = w.font && maybeComputed(w.font.line, context);\n  const size = w.font && maybeComputed(w.font.size, context);\n  if (line != null || size != null) s += `line-height: ${line ?? size}rem;`;\n\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    if (m[0] || m[1] || m[2] || m[3]) s += `padding:${m[0]}rem ${m[1]}rem ${m[2]}rem ${m[3]}rem;`;\n  } else if (w.font && w.font.right) {\n    s += `padding-right:${w.font.right}rem;`;\n  }\n  \n  if ((opts && opts.font) || w.font) s += styleFont((opts && opts.font) || w.font, context);\n  if (w.border) s += styleBorder(w, context, placement);\n\n  s += styleExtra(w, context);\n\n  return [s, i];\n}\n\nexport function styleExtra(w: { bg?: ValueOrExpr; radius?: ValueOrExpr }, context: RenderContext): string {\n  let s = '';\n\n  const bg = maybeComputed(w.bg, context);\n  if (bg) s += `background-color:${bg};`;\n\n  const radius = maybeComputed(w.radius, context);\n  if (radius) s += `border-radius:${radius};`;\n\n  return s;\n}\n\nexport function styleFont(f: Font, context: RenderContext): string {\n  if (!f) return '';\n  let t: any;\n  let size: any;\n  let s = '';\n  if (t = maybeComputed(f.family, context)) s += `font-family:${t};`;\n  if (t = maybeComputed(f.color, context)) s += `color:${t};`;\n  if (t = maybeComputed(f.align, context)) s += `text-align:${t};`;\n  if (t = maybeComputed(f.size, context)) {\n    s += `font-size:${t}rem;`;\n    size = t;\n  }\n\n  t = maybeComputed(f.line, context);\n  if (t === 0) s += `line-height:initial;`;\n  else if (t != null) s += `line-height:${t}rem;`;\n  else if (size) s += `line-height:${size}rem;`;\n\n  if (t = maybeComputed(f.weight, context)) s += `font-weight:${t};`;\n  if (t = maybeComputed(f.pre, context)) s += `white-space:pre-wrap;word-break:break-word;`;\n  const pre = t;\n  if (t = maybeComputed(f.clamp, context)) s += `${pre ? '' : 'white-space:nowrap;'}overflow:hidden;`;\n  return s;\n}\n\nexport function styleBorder(w: { border?: number|Borders|number[]|string }, context: RenderContext, placement: Placement): string {\n  const b = expandBorder(w, context, placement);\n  if (b[0] + b[1] + b[2] + b[3]) return `border-style:solid;border-width:${b[0]}rem ${b[1]}rem ${b[2]}rem ${b[3]}rem;`;\n  return '';\n}\n\nexport function styleImage(fit?: string): [string, string] {\n  const s = `background-size:${!fit || fit === 'contain' ? 'contain;background-position:center' : fit === 'stretch' ? '100% 100%' : 'cover'};`;\n  \n  return [s, ''];\n}\n","import { Sort, ValueOrExpr, Parameter, ParameterMap, SourceMap, Root, Context, RootContext, extend, evaluate, filter, toDataSet } from './data/index';\n\nimport { renderWidget, RenderContext, RenderResult, RenderState, expandMargin, expandMacro } from './render/index';\nimport { styleClass, styleFont } from './render/style';\n\nimport { parse as parseTemplate } from './data/parse/template';\n\nexport type ReportType = 'delimited'|'flow'|'page';\n\nexport type Report<T = {}> = Delimited<T> | Flow<T> | Page<T>;\n\nexport interface PartSource {\n  /** Filters to apply to the base value of the data source */\n  filter?: ValueOrExpr;\n  /** Sorts to apply to the base value of the data source */\n  sort?: Sort[]|ValueOrExpr;\n  /** Groupings to apply to the base data source */\n  group?: Array<ValueOrExpr>|ValueOrExpr;\n  /** An expression to apply to the base data source before filtering, sorting, or grouping */\n  base?: ValueOrExpr;\n  /** The name of the data source to be pulled from the root context */\n  source: string;\n}\n\nexport interface ReportSource extends PartSource {\n  /** The destination for the applied source, defaults to the source */\n  name?: string;\n  /** A user-friendly name for the source */\n  label?: string;\n  parameters?: { [name: string]: ValueOrExpr };\n}\n\ninterface BaseReport<T = {}> {\n  type: ReportType;\n  name?: string;\n  parameters?: Parameter<T>[];\n  sources?: ReportSource[];\n  /** An initial value for the root context. */\n  context?: ParameterMap;\n  /** An additional context expression to be merged with any fixed context just before the report is run. */\n  extraContext?: ValueOrExpr;\n  classifyStyles?: boolean;\n  defaultParams?: ParameterMap;\n}\n\n// delimited\nexport interface Delimited<T = {}> extends BaseReport<T> {\n  type: 'delimited';\n  source?: string;\n  fields: ValueOrExpr[];\n  headers?: ValueOrExpr[];\n  record?: string;\n  field?: string;\n  quote?: string;\n  rowContext?: ValueOrExpr;\n}\n\nexport interface Displayed<T = {}> extends BaseReport<T> {\n  widgets: Widget[];\n  font?: {\n    family?: string;\n    color?: string;\n    size?: number;\n    line?: number;\n  };\n  watermark?: Container;\n  overlay?: Container;\n}\n\n// flow\nexport interface Flow<T = {}> extends Displayed<T> {\n  type: 'flow';\n  width?: number;\n  margin?: Margin;\n  size?: PageSize;\n  orientation?: PageOrientation;\n}\n\n// page\nexport interface Page<T = {}> extends Displayed<T> {\n  type: 'page';\n  header?: Container & { outer?: boolean };\n  footer?: Container & { outer?: boolean };\n  size: PageSize;\n  orientation?: PageOrientation;\n  margin?: Margin;\n}\n\nexport type Dimension = number|{ percent: number };\n\nexport interface PageSize {\n  width: number;\n  height: number;\n  margin: [number, number];\n}\n\nexport type PageOrientation = 'portrait'|'landscape';\nexport const PageSizes: { [name: string]: PageSize } = {\n  letter: {\n    width: 51,\n    height: 66,\n    margin: [1.5, 1.5],\n  },\n  legal: {\n    width: 51,\n    height: 84,\n    margin: [1.5, 1.5],\n  },\n  tabloid: {\n    width: 66,\n    height: 102,\n    margin: [1.5, 1.5],\n  },\n  a4: {\n    width: 49.606302,\n    height: 70.15746,\n    margin: [1.5, 1.5],\n  }\n};\n\nexport function pageOffset(num: number, size: PageSize): number {\n  return num * size.height + size.margin[0];\n}\n\n// Attributes\nexport interface Font {\n  size?: number|Computed;\n  family?: string|Computed;\n  weight?: number|Computed;\n  color?: string|Computed;\n  align?: 'left'|'right'|'center'|'justify'|Computed;\n  line?: number|Computed;\n  right?: number;\n  pre?: boolean|Computed;\n  clamp?: boolean|Computed;\n}\n\nexport interface Placement {\n  x: number;\n  y: number;\n  availableX?: number;\n  availableY?: number;\n  maxX?: number;\n  maxY?: number;\n  offsetX?: number;\n  offsetY?: number;\n}\nexport type Layout = Array<[number, number]>|Placement[]|'row'|string;\n\nexport interface Borders {\n  top?: number;\n  left?: number;\n  bottom?: number;\n  right?: number;\n}\n\nexport interface Style {\n  font?: Font;\n  border?: number|Borders|number[]|string;\n}\n\nexport type Margin = number|[number, number]|[number, number, number, number];\n\nexport interface Computed {\n  x: ValueOrExpr;\n}\n\n// Widgets\nexport interface Widget extends Style {\n  type: string;\n  width?: Dimension|Computed|'grow'; // default 100%\n  height?: Dimension|'auto'|Computed|'grow'; // optional, defaulting to 1\n  margin?: Margin|Computed;\n  box?: 'expand'|'contain';\n  hide?: ValueOrExpr;\n  br?: boolean|Computed;\n  bg?: ValueOrExpr;\n  radius?: ValueOrExpr;\n\n  // container\n  widgets?: Widget[];\n  layout?: Layout;\n  context?: ValueOrExpr;\n  bridge?: boolean;\n  macro?: string;\n\n  // label\n  text?: ValueOrExpr|Array<ValueOrExpr|Span>;\n  format?: LabelFormat;\n  id?: string;\n  styled?: boolean;\n\n  // image\n  url?: ValueOrExpr;\n  fit?: 'cover'|'stretch'|Computed;\n\n  // html\n  html?: ValueOrExpr;\n\n  // repeater\n  source?: PartSource|ValueOrExpr;\n  header?: Container;\n  group?: Container[];\n  groupEnds?: boolean[];\n  groupHeaders?: boolean[];\n  row?: Container;\n  footer?: Container;\n  alternate?: Container;\n  headerPerPage?: boolean;\n\n  // repeater row\n  elide?: boolean|Computed;\n}\n\nexport interface Container extends Widget {\n  widgets: Widget[];\n  layout?: Layout;\n  context?: ValueOrExpr;\n  bridge?: boolean;\n  elide?: boolean|Computed;\n  macro?: string;\n}\n\nexport interface Image extends Widget {\n  url: ValueOrExpr;\n  fit?: 'cover'|'stretch'|Computed;\n}\n\nexport interface Span {\n  text: ValueOrExpr;\n  font?: Font;\n  bg?: ValueOrExpr;\n  radius?: ValueOrExpr;\n  id?: string;\n}\nexport interface LabelFormat {\n  name: string;\n  args?: ValueOrExpr[];\n}\nexport interface Label extends Widget {\n  text: ValueOrExpr|Array<ValueOrExpr|Span>;\n  format?: LabelFormat;\n  id?: string;\n  styled?: boolean;\n}\n\nexport interface HTML extends Widget {\n  html: ValueOrExpr;\n}\n\nexport interface Repeater extends Widget {\n  source: PartSource|ValueOrExpr;\n  header?: Container;\n  group?: Container[];\n  groupEnds?: boolean[];\n  groupHeaders?: boolean[];\n  row: Container;\n  footer?: Container;\n  alternate?: Container;\n  headerPerPage?: boolean;\n}\n\nexport interface MeasureFont {\n  /** The font family for the label. The built-in estimator only works with sans, serif, narrow, and mono fonts, which should be relatively metric-compatible with Arial, Times New Roman, Arial Narrow, and, well, any fixed-width font. */\n  family?: 'sans'|'serif'|'narrow'|'mono'|string|Computed;\n  /** Font size in rem, where 1rem is 16px or 12pt based on the report html element style */\n  size?: number|Computed;\n  /** The line-height of the rendered font in rem */\n  line?: number|Computed;\n  /** Average width in px at font-size 16px. If this is supplied, it won't be guessed based on the font name. */\n  metric?: number|Computed;\n  /** Break words that exceed the line length */\n  'break-word'?: boolean;\n}\n\nexport interface MeasuredLabel extends Widget {\n  font?: MeasureFont;\n  text: ValueOrExpr;\n}\n\n// execution\ninterface ReportExtras {\n  /** Extra content to be rendered at the bottom of the <head> */\n  head?: string;\n  /** Extra content to be rendered at the bottom of the <body> */\n  foot?: string;\n  /** Run a delimited report to a table instead of using the defined delimiters */\n  table?: boolean;\n}\n\n/** Initialize a parameter map based on the parameters defined by the given report. */\nexport function initParameters(report: Report, sources: SourceMap, parameters?: ParameterMap|Root): ParameterMap {\n  const ctx = parameters && 'root' in parameters && parameters.root === parameters ? parameters as Root : new Root(Object.assign({}, report.context), { parameters });\n  ctx.parameters = Object.assign({}, report.defaultParams, ctx.parameters);\n  const inits: ParameterMap = {};\n\n  if (report.sources) applySources(ctx, report.sources, sources);\n\n  if (Array.isArray(report.parameters)) {\n    for (const p of report.parameters) {\n      if (p.init && p.name) {\n        inits[p.name] = evaluate(ctx, p.init);\n      }\n    }\n  }\n\n  return inits;\n}\n\n/** Run the given report to string. If the report is displayed, the result will be HTML. Otherwise, it will be plain text. */\nexport function run(report: Report, sources: SourceMap, parameters?: ParameterMap|Root, extra?: ReportExtras): string {\n  const ctx = parameters && 'root' in parameters && parameters.root === parameters ? parameters as Root : new Root(Object.assign({}, report.context), { parameters });\n\n  if (report.sources) applySources(ctx, report.sources, sources);\n  ctx.parameters = Object.assign({}, initParameters(report, sources), ctx.parameters);\n\n  if (report.extraContext) {\n    const res = evaluate(ctx, report.extraContext);\n    if (res && typeof res === 'object') ctx.value = Object.assign(ctx.value, res);\n  }\n\n  if (report.type === 'delimited') return runDelimited(report, ctx, { table: extra?.table });\n  else if (report.type === 'flow') return runFlow(report, ctx, extra);\n  else return runPage(report, ctx, extra);\n}\n\n/** Apply multiple sources to a context together. Each source base is available before filter/sort/group is applied in case a source needs to reference a later source for those purposes. */\nexport function applySources(context: RootContext, sources: ReportSource[], map: SourceMap) {\n  const srcs = context.sources;\n  for (const source of sources) {\n    let base = map[source.source || source.name] || { value: [] };\n    if (source.base) base = evaluate(extend(context, { value: base.value, special: { source: base } }), source.base);\n    srcs[source.name || source.source] = toDataSet(base);\n  }\n\n  for (const source of sources) {\n    if (source.filter || source.sort || source.group) srcs[source.name || source.source] = filter(srcs[source.name || source.source], source.filter, source.sort, source.group, context);\n  }\n}\n\nexport function applySource(context: RootContext, source: ReportSource, sources: SourceMap) {\n  let base = sources[source.source || source.name] || { value: [] };\n  if (source.base) base = { value: evaluate(extend(context, { value: base.value, special: { source: base } }), source.base) };\n  if (source.filter || source.sort || source.group) context.sources[source.name || source.source] = filter(base, source.filter, source.sort, source.group, context);\n  else context.sources[source.name || source.source] = toDataSet(base);\n}\n\nfunction runDelimited(report: Delimited, context: Context, options?: { table?: boolean }): string {\n  const source = context.root.sources[report.source ? report.source : (report.sources[0].name || report.sources[0].source)];\n  const values = Array.isArray(source.value) ?\n    source.value :\n    typeof source.value === 'object' && 'grouped' in source.value && Array.isArray(source.value.all) ? // watch out for grouped sources\n      source.value.all :\n      [source.value];\n  let fields = report.fields;\n  let headers = report.headers;\n\n  if (!fields || !fields.length && values.length) {\n    fields = Object.keys(values[0]);\n    if (!headers || !headers.length) headers = Object.keys(values[0]).map(k => `'${k.replace(/'/g, '\\\\\\'')}'`);\n  }\n\n  let res = '';\n  if (headers) {\n    const ctx = extend(context, { parser: parseTemplate });\n    if (options?.table) res += `<tr class=header><th style=\"border-right: 2px solid;\"></th>${headers.map(h => `<th>${evaluate(ctx, h)}</th>`).join('')}</tr>`;\n    else res += headers.map(h => `${report.quote || ''}${evaluate(ctx, h)}${report.quote || ''}`).join(report.field || ',') + (report.record || '\\n');\n  }\n\n  if (options?.table) {\n    let idx = 1;\n    for (const value of values) {\n      const c = extend(context, { value });\n      if (report.rowContext) {\n        if (!c.locals) c.locals = {};\n        const v = evaluate(c, report.rowContext);\n        if (v) c.value = v;\n      }\n      res += `<tr class=row><th>${idx}</th>${fields.map(f => {\n        let val = f ? evaluate(c, f) : '';\n        if (val === undefined) val = '';\n        if (typeof val !== 'string') val = `${val}`;\n        return `<td>${val}</td>`;\n      }).join('')}</tr>`;\n      idx++;\n    }\n    res = `<table>${res}</table>`;\n  } else {\n    const unquote: RegExp = report.quote ? new RegExp(report.quote, 'g') : undefined;\n    for (const value of values) {\n      const c = extend(context, { value });\n      if (report.rowContext) {\n        if (!c.locals) c.locals = {};\n        const v = evaluate(c, report.rowContext);\n        if (v) c.value = v;\n      }\n      res += fields.map(f => {\n        let val = f ? evaluate(c, f) : '';\n        if (val === undefined) val = '';\n        if (typeof val !== 'string') val = `${val}`;\n        if (unquote) val = val.replace(unquote, report.quote + report.quote);\n        return `${report.quote || ''}${val}${report.quote || ''}`;\n      }).join(report.field || ',') + (report.record || '\\n');\n    }\n  }\n\n  return res;\n}\n\nfunction runPage(report: Page, context: Context, extras?: ReportExtras): string {\n  let size: PageSize = report.orientation !== 'portrait' ? { width: report.size.height, height: report.size.width, margin: [report.size.margin[1], report.size.margin[0]] } : report.size;\n\n  const ctx: RenderContext = { context, report, styles: {}, styleMap: { ids: {}, styles: {} } };\n  const margin = expandMargin(report, ctx, { x: 0, y: 0 });\n  context.special = context.special || {};\n  context.special.page = 0;\n  context.special.pages = 0;\n\n  const pages: string[] = [''];\n  let page = 0;\n  const printX = size.width - 2 * size.margin[1];\n  const printY = size.height - 2 * size.margin[0];\n  let availableY = printY - margin[0] - margin[2];\n  const pageY = availableY;\n  let maxY = availableY;\n  let y = 0;\n  const availableX = printX - margin[1] - margin[3];\n  let state: RenderState<any> = null;\n\n  let headSize = 0;\n  if (report.header) {\n    const r = renderWidget(report.header, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY });\n    headSize = r.height;\n    if (!report.header?.outer) {\n      availableY -= headSize;\n      maxY -= headSize;\n      y += headSize;\n    }\n  }\n\n  let footSize = 0;\n  if (report.footer) {\n    const r = renderWidget(report.footer, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY });\n    footSize = r.height;\n    if (!report.footer?.outer) {\n      availableY -= footSize;\n      maxY -= footSize;\n    }\n  }\n\n  for (let w of report.widgets) {\n    if (w.macro) w = expandMacro(w.macro, w, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY }, state);\n    let r: RenderResult;\n    do {\n      r = renderWidget(w, ctx, { x: 0, y, availableX, availableY, maxX: availableX, maxY }, state);\n      pages[page] += r.output;\n      if (r.continue) {\n        page++;\n        pages[page] = '';\n        y = report.header?.outer ? 0 : headSize;\n        availableY = printY - (report.header?.outer ? 0 : headSize) - (report.footer?.outer ? 0 : footSize) - margin[0] - margin[2];\n        state = r.continue;\n      } else {\n        y += r.height;\n        availableY -= r.height;\n        state = null;\n      }\n    } while (state !== null)\n  }\n\n  context.special.pages = pages.length;\n  const footPlace = report.footer?.outer ?\n    { x: 0, y: printY - footSize, maxX: printX, maxY: printY } :\n    { x: 0 + margin[3], y: printY - margin[0] - footSize, maxX: printX - margin[3] - margin[1], maxY: printY - margin[0] - margin[2] };\n  const headPlace = report.header?.outer ?\n    { x: 0, y: 0, maxX: printX, maxY: printY } :\n    { x: 0 + margin[3], y: margin[0], maxX: printX - margin[3] - margin[1], maxY: printY - margin[0] - margin[2] };\n\n  context.special.size = { x: availableX, y: pageY };\n  pages.forEach((p, i) => {\n    let n = `<div class=\"page-back pb${i}\"><div${styleClass(ctx, ['page', `ps${i}`], ['', ''], '', 'p')}>\\n`;\n    context.special.page = i + 1;\n    if (report.watermark) {\n      const r = renderWidget(report.watermark, ctx, { x: 0, y: 0, maxX: printX, availableX: printX, maxY: printY, availableY: printY });\n      n += r.output + '\\n';\n    }\n    if (report.header) {\n      const r = renderWidget(report.header, ctx, headPlace);\n      n += r.output + '\\n';\n    }\n    n += `<div class=\"page-inner\">${p}</div>`;\n    if (report.footer) {\n      const r = renderWidget(report.footer, ctx, footPlace);\n      n += r.output + '\\n';\n    }\n    if (report.overlay) {\n      const r = renderWidget(report.overlay, ctx, { x: 0, y: 0, maxX: printX, availableX: printX, maxY: printY, availableY: printY });\n      n += r.output + '\\n';\n    }\n    n += '\\n</div></div>';\n    pages[i] = n;\n  });\n\n  return `<html style=\"font-size:100%;margin:0;padding:0;\"><head><style>\n    .page { width: ${printX}rem; height: ${printY}rem; position: absolute; overflow: hidden; left: ${size.margin[1]}rem; top: ${size.margin[0]}rem; ${report.font ? styleFont(report.font, ctx) : ''} }\n    .page-inner { position: absolute; width: ${printX - margin[1] - margin[3]}rem; height: ${printY - margin[0] - margin[2]}rem; left: ${margin[3]}rem; top: ${margin[0]}rem; }\n    .page-back { width: ${size.width}rem; height: ${size.height}rem; }\n    body { font-size: 0.83rem; }\n    @media screen {\n      html { min-width: ${size.width + 2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { margin: 0; padding: 0; ${size ? `width:${size.width}rem;` : ''}background-color: none; display: block; height: ${pages.length * size.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${pages.map((_p, i) => `.pb${i} { top: ${i * size.height}rem; }`).join('')}\n    }\n    @page {\n      size: ${size.width}em ${size.height}em;\n    }${Object.entries(ctx.styles).map(([_k, v]) => v).join('\\n')}${Object.entries(ctx.styleMap.styles).map(([style, id]) => `.${id} { ${style} }`).join('\\n')}\n  </style>${extras && extras.head || ''}</head><body>\\n${pages.reduce((a, c) => a + c, '')}${extras && extras.foot || ''}</body></html>`;\n}\n\nfunction runFlow(report: Flow, context: Context, extras?: ReportExtras): string {\n  const ctx: RenderContext = { context, report, styles: {}, styleMap: { ids: {}, styles: {} } };\n  let html = '';\n  let y = 0;\n  let state: RenderState<any> = null;\n\n  let width: number;\n\n  if (report.width) width = report.width;\n  else if (report.size) width = report.orientation !== 'portrait' ? report.size.height : report.size.width;\n\n  let margin: [number, number, number, number];\n  if (report.margin != null) margin = expandMargin(report, ctx, { x: 0, y: 0, availableX: width, maxX: width });\n  if (!margin && report.size && report.size.margin) margin = expandMargin(report.size, ctx, { x: 0, y: 0, availableX: width, maxX: width });\n  if (!margin) margin = [0, 0, 0, 0];\n\n  // account for margins\n  if (width) width -= (margin[1] || 0) + (margin[3] || 0);\n\n  function render(w: Widget, cls: string) {\n    html += `<div${styleClass(ctx, cls ? [cls] : [], [`position:absolute;right:0rem;left:0rem;${width ? `width:${width}rem;` : ''}`, ''], `top:${y}rem;`, 'p')}>\\n`;\n    let r: RenderResult;\n    let yy = 0;\n    do {\n      r = renderWidget(w, ctx, { x: 0, y: yy, availableX: width, maxX: width }, state);\n      if (typeof r === 'string') throw new Error(`Container widget didn't specify used height`);\n      else {\n        html += r.output;\n        yy += r.height;\n        if (r.continue) {\n          state = r.continue;\n        } else {\n          state = null;\n        }\n      }\n    } while (state !== null)\n    y += yy;\n    html += `</div>\\n`;\n  }\n\n  if (report.watermark) render(report.watermark, 'watermark');\n  let maxY = y || 0;\n  y = 0;\n  for (const w of report.widgets) render(w, 'main');\n  if (y > maxY) maxY = y;\n  y = 0;\n  if (report.overlay) render(report.overlay, 'overlay');\n  if (y > maxY) maxY = y;\n\n  return `<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${width ? ` width: ${width}rem;` : ''}; height: ${maxY}rem; position: relative; }\n    .page-back { ${width ? `width: ${width}rem; ` : 'width: 100%; box-sizing: border-box; '}padding: ${margin[0] || 0}rem ${margin[1] || 0}rem ${margin[2] || 0}rem ${margin[3] || 0}rem; position: absolute; left: 0; top: 0; }\n    #wrapper { height:${maxY}rem; position: relative; ${report.font ? styleFont(report.font, ctx) : ''} }\n    .watermark { z-index: 0; }\n    .main { z-index: 5; }\n    .overlay { z-index: 10; }\n    @media screen {\n      body { margin: 1rem${width ? ' auto' : ''}; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${margin[0]}rem ${margin[1]}rem ${margin[2]}rem ${margin[3]}rem !important; }\n    }${Object.entries(ctx.styles).map(([_k, v]) => v).join('\\n')}${Object.entries(ctx.styleMap.styles).map(([style, id]) => `.${id} { ${style} }`).join('\\n')}\n  </style>${extras && extras.head || ''}</head><body>\\n<div class=page-back><div id=wrapper>${html}</div></div>${extras && extras.foot || ''}</body></html>`;\n}\n","import { Parser, parser as makeParser, opt, rep1sep, seq, alt, map, readTo, read1To, rep1, rep, str, read, read1, chars } from 'sprunge';\n\ntype Style = BoolStyle | ValueStyle<any>;\ninterface BoolStyle {\n  tag: string;\n}\ninterface ValueStyle<T> {\n  tag: string;\n  value: T|null;\n}\n\n// zero width space\nconst zwsp = '&#8203;';\n\nconst sp = read1(' \\r\\n\\t');\nconst ws = read(' \\r\\n\\t');\nconst hex = '0123456789abcdef';\nconst integer = map(read1('0123456789'), v => +v);\nconst number = map(seq(opt(str('-')), read1('0123456789'), opt(seq(str('.'), read1('0123456789')))), ([m, n, d]) => +[m, n, d?.[0], d?.[1]].filter(v => v).join(''));\nconst color = map(seq(opt(str('#')), alt(chars(8, hex), chars(6, hex), chars(4, hex), chars(3, hex))), ([, color]) => `#${color}`);\nconst remOrPercent = map(seq(number, opt(str('%'))), ([n, p]) => `${n}${p ? '%' : 'rem'}`);\nconst places = str('left', 'right', 'top', 'bottom', 'center');\n\nconst align = map(seq(str('align'), opt(seq(str('='), alt(\n  seq(str('top', 'middle', 'bottom', 'base'), opt(seq(sp, str('left', 'right', 'center')))),\n  seq(str('left', 'right', 'center'), opt(seq(sp, str('top', 'middle', 'bottom', 'base'))))\n)))), ([,v]) => ({ tag: 'align', value: v ? [v[1][0], v[1][1]?.[1]].filter(v => v) : null }));\nconst valign = map(seq(str('valign'), opt(seq(str('='), str('top', 'middle', 'bottom', 'base')))), ([, v]) => ({ tag: 'valign', value: v ? v[1] : null }));\n\nconst pad = map(seq(str('pad'), opt(seq(str('='), rep1sep(number, sp)))), ([, v]) => ({ tag: 'pad', value: v ? v[1] : null }));\nconst margin = map(seq(str('margin'), opt(seq(str('='), rep1sep(number, sp)))), ([, v]) => ({ tag: 'margin', value: v ? v[1] : null }));\nconst width = map(seq(str('width', 'w'), opt(seq(str('='), remOrPercent))), ([,v]) => ({ tag: 'width', value: v ? v[1] : null }));\nconst height = map(seq(str('height', 'h'), opt(seq(str('='), remOrPercent))), ([,v]) => ({ tag: 'height', value: v ? v[1] : null }));\nconst line = map(seq(str('line'), opt(seq(str('='), number))), ([,v]) => ({ tag: 'line', value: v ? v[1] : null }));\nconst fg = map(seq(str('fg', 'color', 'fore'), opt(seq(str('='), color))), ([,v]) => ({ tag: 'fg', value: v ? v[1] : null }));\nconst bg = map(seq(str('bg', 'background', 'back'), opt(seq(str('='), color))), ([,v]) => ({ tag: 'bg', value: v ? v[1] : null }));\nconst size = map(seq(str('size'), opt(seq(str('='), number))), ([,v]) => ({ tag: 'size', value: v ? v[1] : null }));\nconst font = map(seq(str('font'), opt(seq(str('='), read1To(',|')))), ([,v]) => ({ tag: 'font', value: v ? v[1] : null }));\nconst rotate = map(seq(str('rotate'), opt(seq(str('='), number, ws, opt(str('left', 'right')), opt(seq(sp, alt(remOrPercent, places), sp, alt(remOrPercent, places)))))), ([,v]) => ({ tag: 'rotate', value: v ? { turn: v[1] * (v[3] === 'left' ? -1 : 1), origin: v[4] ? [v[4][1], v[4][3]] : undefined } : null }));\nconst move = map(seq(str('move'), opt(seq(str('='), remOrPercent, sp, remOrPercent))), ([,v]) => ({ tag: 'move', value: v ? { x: v[1], y: v[3] } : null }));\n\nconst trash = map(readTo(',|'), v => ({ tag: 'trash', value: v }));\n\nconst border = map(seq(\n  str('border'), opt(seq(str('='),opt(str('solid', 'dot', 'dash', 'double')), ws,\n  rep1sep(integer, sp), ws, opt(seq(str('/'), ws, rep1sep(number, sp))), ws, opt(color),\n  ))), ([, v]) => ({ tag: 'border', value: v ? { style: v[1] || 'solid', width: v[3], radius: v[5]?.[2], color: v[7] } : null }));\n\nconst bools = map(alt(str('sub', 'sup', 'bold', 'italic', 'underline', 'strike', 'overline', 'overflow', 'nowrap', 'pre', 'br', 'b', 'i', 'u')), tag => ({ tag }));\n\nconst tag: Parser<Style[]> = map(seq(str('|'), ws, rep1sep(alt(border, align, fg, bg, valign, size, line, font, pad, margin, width, height, bools, rotate, move, trash), seq(ws, str(','), ws), 'allow'), readTo('|'), str('|')), ([, , tags]) => tags.filter(t => t.tag !== 'trash'));\nconst text = map(rep1(alt(read1To('\\\\|', true), map(str('\\\\|'), () => '|'))), txts => txts.join(''));\n\nconst all = rep(alt<Style[]|string>(text, tag))\n\nconst parser = makeParser(all, { consumeAll: true, undefinedOnError: true });\n\ninterface State {\n  bool: { [key: string]: boolean }\n  value: { [key: string]: any[] }\n}\n\nconst blocks = ['border', 'width', 'height', 'pad', 'margin', 'align', 'overflow', 'nowrap', 'rotate', 'move'];\n\nconst aliases = {\n  b: 'bold',\n  i: 'italic',\n  u: 'underline',\n}\n\nfunction process(stuff: Array<Style[]|string>): string {\n  let res = '';\n  let open = false;\n  const state: State = { bool: {}, value: {} };\n  const blockstack: string[][] = [];\n  for (const s of stuff) {\n    if (typeof s === 'string') {\n      if (!state.bool.pre && /^\\s/.test(s)) res += zwsp;\n      res += s;\n      if (!state.bool.pre && /\\s$/.test(s)) res += zwsp;\n    } else {\n      let drop = false;\n      let block: string[];\n      for (const style of s) {\n        const tag = aliases[style.tag] || style.tag;\n        if ('value' in style) {\n          if (style.value !== null) {\n            (state.value[tag] || (state.value[tag] = [])).push(style.value);\n            if (blocks.includes(tag) || block && tag === 'bg') (block || (block = [])).push(tag);\n          } else {\n            if (blocks.includes(tag)) drop = true;\n            else if (tag === 'bg' && (drop || blockstack && blockstack.length && blockstack[blockstack.length - 1].includes('bg'))) drop = true;\n            else (state.value[tag] || (state.value[tag] = [])).pop();\n          }\n        } else {\n          if (tag === 'br') res += '<br/>';\n          else if (blocks.includes(tag) && block.length) block.push(tag);\n          else state.bool[tag] = !state.bool[tag];\n        }\n      }\n      if (open) res += `</span>`;\n      open = true;\n      if (drop) {\n        const frame = blockstack.pop();\n        if (frame) {\n          res += '</span>';\n          for (const b of frame) (state.value[b] || (state.value[b] = [])).pop();\n        }\n      }\n      if (block) {\n        blockstack.push(block);\n        res += `<span style=\"${getStyle(state, block)}\">`;\n      }\n      res += `<span style=\"${getStyle(state, 'inline')}\">`;\n    }\n  }\n  if (open) res += `</span>`;\n  for (const f of blockstack) res += '</span>';\n  return res;\n}\n\nexport function style(str: string): string {\n  const parsed = parser(str);\n  if (Array.isArray(parsed)) return process(parsed);\n  return str;\n}\n\nconst flexAlign = { top: 'start', middle: 'center', bottom: 'end', base: 'baseline' };\nconst borderStyle = { dot: 'dotted', dash: 'dashed' };\nfunction getStyle(state: State, which: 'inline'|string[]) {\n  let res = '';\n\n  if (which === 'inline') {\n    const bs = state.bool;\n    if (bs.underline || bs.overline || bs.strike) res += `text-decoration-line:${[bs.underline && 'underline', bs.overline && 'overline', bs.strike && 'line-through'].filter(v => v).join(' ')};`\n    if (bs.sup || bs.sub) {\n      res += `font-size:70%;`;\n      if (bs.sup) res += `vertical-align:super;`;\n      if (bs.sub) res += `vertical-align:sub;`;\n    }\n    if (bs.italic) res += `font-style:italic;`;\n    if (bs.bold) res += `font-weight:bold;`;\n    if (bs.pre) res += `white-space:pre-wrap;`;\n\n    const vs = state.value;\n    if (Array.isArray(vs.valign)) {\n      const v = vs.valign[vs.valign.length - 1];\n      if (v) res += `vertical-align:${v === 'base' ? 'baseline' : v};`;\n    }\n\n    if (Array.isArray(vs.fg)) {\n      const v = vs.fg[vs.fg.length - 1];\n      if (v) res += `color:${v};`;\n    }\n\n    if (Array.isArray(vs.bg)) {\n      const v = vs.bg[vs.bg.length - 1];\n      if (v) res += `background-color:${v};`;\n    }\n\n    if (Array.isArray(vs.size)) {\n      const v = vs.size[vs.size.length - 1];\n      if (v != null) res += `font-size:${v}rem;`;\n    }\n\n    if (Array.isArray(vs.font)) {\n      const v = vs.font[vs.font.length - 1];\n      if (v != null) res += `font-family:${v};`;\n    }\n\n    if (Array.isArray(vs.line)) {\n      const v = vs.line[vs.line.length - 1];\n      if (v != null) res += `line-height:${v}rem;`;\n    }\n  } else {\n    res += `display:inline-flex;box-sizing:content-box;overflow:hidden;`;\n    const vs = state.value;\n\n    let transforms: string[];\n\n    if (which.includes('align') && Array.isArray(vs.align)) {\n      const v = vs.align[vs.align.length - 1];\n      if (Array.isArray(v)) {\n        let vv = v.find(v => ['top', 'middle', 'bottom', 'base'].includes(v));\n        if (vv) res += `align-items:${flexAlign[vv]};`;\n        vv = v.find(v => ['left', 'right', 'center'].includes(v));\n        if (vv) res += `justify-content:${vv};`;\n      }\n    }\n\n    if (which.includes('width') && Array.isArray(vs.width)) {\n      const v = vs.width[vs.width.length - 1];\n      if (v != null) res += `width:${v};`;\n    }\n\n    if (which.includes('height') && Array.isArray(vs.height)) {\n      const v = vs.height[vs.height.length - 1];\n      if (v != null) res += `height:${v};`;\n    }\n\n    if (which.includes('pad') && Array.isArray(vs.pad)) {\n      const v: number[] = vs.pad[vs.pad.length - 1];\n      if (Array.isArray(v) && v.length) {\n        res += `padding:${v[0]}rem`;\n        if (v.length > 1) res += ` ${v[1]}rem`;\n        if (v.length > 2) res += ` ${v[2]}rem`;\n        if (v.length > 3) res += ` ${v[3]}rem`;\n        res += ';';\n      }\n    }\n\n    if (which.includes('margin') && Array.isArray(vs.margin)) {\n      const v: number[] = vs.margin[vs.margin.length - 1];\n      if (Array.isArray(v) && v.length) {\n        res += `margin:${v[0]}rem`;\n        if (v.length > 1) res += ` ${v[1]}rem`;\n        if (v.length > 2) res += ` ${v[2]}rem`;\n        if (v.length > 3) res += ` ${v[3]}rem`;\n        res += ';';\n      }\n    }\n\n    if (which.includes('border') && Array.isArray(vs.border)) {\n      const v: { style: string; color?: string; width: number[]; radius: number[] } = vs.border[vs.border.length - 1];\n      if (v) {\n        res += `border-style:${borderStyle[v.style] || v.style};border-width:${v.width[0]}px`;\n        if (v.width.length > 1) res += ` ${v.width[1]}px`;\n        if (v.width.length > 2) res += ` ${v.width[2]}px`;\n        if (v.width.length > 3) res += ` ${v.width[3]}px`;\n        res += ';';\n        if (v.color) res += `border-color:${v.color};`;\n        if (v.radius) {\n          res += `border-radius:${v.radius[0]}rem`;\n          if (v.radius.length > 1) res += ` ${v.radius[1]}rem`;\n          if (v.radius.length > 2) res += ` ${v.radius[2]}rem`;\n          if (v.radius.length > 3) res += ` ${v.radius[3]}rem`;\n          res += ';';\n        }\n      }\n    }\n\n    if (which.includes('bg') && Array.isArray(vs.bg)) {\n      const v = vs.bg[vs.bg.length - 1];\n      if (v) res += `background-color:${v};`;\n    }\n\n    if (which.includes('rotate') && Array.isArray(vs.rotate)) {\n      const v: { turn: number; origin?: [string, string] } = vs.rotate[vs.rotate.length - 1];\n      if (v) {\n        if (v.origin) res += `transform-origin:${v.origin[0]} ${v.origin[1]};`;\n        (transforms || (transforms = []))[which.indexOf('rotate')] = `rotate(${v.turn}turn)`;\n      }\n    }\n\n    if (which.includes('move') && Array.isArray(vs.move)) {\n      const v: { x: string; y: string } = vs.move[vs.move.length - 1];\n      if (v) (transforms || (transforms = []))[which.indexOf('move')] = `translate(${v.x}, ${v.y})`;\n    }\n\n    if (transforms) res += `transform:${transforms.filter(v => v).join(' ')};`;\n\n    if (which.includes('nowrap')) res += `white-space:nowrap;`;\n    if (which.includes('overflow')) res += `overflow:visible;`;\n  }\n\n  return res;\n}\n","import { Container, Label, Repeater, Image, MeasuredLabel, HTML } from '../report';\nimport { evaluate, filter, Group, ValueOrExpr, isValueOrExpr, extend as extendData } from '../data/index';\nimport { parse as parseTemplate } from '../data/parse/template';\nimport { style as styleText } from '../data/parse/style';\nimport { error } from './error';\n\nimport { addStyle, escapeHTML, extend, getWidth, measure, registerRenderer, renderWidget, renderWidgets, RenderContinuation, RenderState, RenderContext, getHeightWithMargin, expandMargin, getWidthWithMargin, isComputed } from './index';\nimport { styleClass, style, styleFont, styleImage, styleExtra } from './style';\n\nfunction onCommit(ctx: RenderContext, key: string, value: any) {\n  let c = ctx;\n  while (c) {\n    if (c.commit) {\n      c.commit[key] = value;\n      return;\n    }\n    c = c.parent;\n  }\n}\n\nfunction commitContext(ctx: RenderContext) {\n  for (const k in ctx.commit) {\n    let l = ctx.context;\n    while (l) {\n      if (l.special && l.special.values) (l.special.values[k] || (l.special.values[k] = [])).push(ctx.commit[k]);\n      l = l.parent;\n    }\n  }\n}\n\nregisterRenderer<Label>('label', (w, ctx, placement) => {\n  addStyle(ctx, 'label', `.label {position:absolute;box-sizing:border-box;white-space:normal;}`);\n  let str = '';\n  let sval: any;\n  let val = (Array.isArray(w.text) ? w.text : [w.text]).map(v => {\n    let val = evaluate(ctx, typeof v === 'object' && 'text' in v ? v.text : v);\n    if (typeof val === 'string') val = escapeHTML(val);\n    if (typeof v === 'object' && 'id' in v) onCommit(ctx, v.id, val);\n    str += val;\n    sval = val;\n\n    if (w.styled) val = styleText(val);\n\n    if (typeof v === 'object' && 'text' in v) {\n      return `<span${styleClass(ctx, [], [styleFont(v.font, ctx) + styleExtra(v, ctx), ''])}>${val}</span>`;\n    } else {\n      return val\n    };\n  }).join('');\n\n  if (w.id) onCommit(ctx, w.id, str);\n\n  if (w.format && w.format.name) {\n    const args: ValueOrExpr[] = [{ v: !Array.isArray(w.text) || w.text.length === 1 ? sval : val }, { v: w.format.name }];\n    val = evaluate(ctx, { op: 'format', args: args.concat(w.format.args || []) });\n  }\n\n  return `<span${styleClass(ctx, ['label'], style(w, placement, ctx, { lineSize: true }))}>${val}</span>`\n});\n\nregisterRenderer<Container>('container', (w, ctx, placement, state) => {\n  addStyle(ctx, 'container', `.container {position:absolute;box-sizing:border-box;}`);\n  let h: number;\n  if (!w.height) w.height = 'auto';\n  else if (w.height !== 'auto') h = getHeightWithMargin(w, placement, ctx);\n  const wctx = ((state || {}).state || {}).ctx ? Object.assign({}, ctx, { context: state.state.ctx }) : ctx;\n  if (w.context && !((state || {}).state || {}).ctx) {\n    if (!wctx.context.locals) wctx.context.locals = {};\n    const value = evaluate(extend(wctx, { special: { placement, widget: w }, locals: wctx.context.locals }), w.context);\n    if (value) wctx.context = extendData(wctx.context, { value, special: { placement, widget: w } });\n  }\n  const cw = getWidth(w, placement, ctx) || placement.availableX;\n  const r = renderWidgets(w, wctx, { x: 0, y: 0, availableX: cw, availableY: h || placement.availableY, maxX: cw, maxY: h != null && !isNaN(h) ? h : placement.maxY }, state, w.layout);\n  if (!r.cancel) {\n    r.output = `<div${styleClass(ctx, ['container'], style(w, placement, ctx, { computedHeight: h || r.height, container: true }))}>${r.output}</div>`;\n    r.height = h || r.height;\n    r.width = getWidthWithMargin(w, placement, ctx);\n  }\n  if ((r.cancel || r.continue) && !w.bridge) {\n    const state = r.continue || {} as RenderState;\n    state.offset = 0;\n    // must start over\n    delete state.last;\n    state.attempt = (state.attempt || 0) + 1;\n    if (state.attempt > 1) return error(ctx, placement);\n    return { continue: state, output: '' };\n  } else if (r.continue) {\n    if (w.context) r.continue.state = { ctx: wctx.context };\n    r.continue.offset = 0;\n  }\n  return r;\n}, { container: true });\n\ntype RepeatState = { part: 'group'|'header'|'body'|'footer'; group?: 'header'|'body'; src: Group|any[]; current: number; context?: RenderContext; newPage?: boolean };\nregisterRenderer<Repeater, RepeatState>('repeater', (w, ctx, placement, state) => {\n  addStyle(ctx, 'container', `.container {position:absolute;box-sizing:border-box;}`);\n  if (!w.height) w.height = 'auto';\n  let availableY = placement.availableY;\n  let availableX = placement.availableX;\n\n  let r: RenderContinuation;\n  let html = '';\n  let commit = false;\n  const m = expandMargin(w, ctx, placement);\n  let y = !state || !state.state || state.state.part === 'header' ? m[0] : 0;\n  if (availableY != null) {\n    availableY -= y;\n    availableY = +availableY.toFixed(6)\n  }\n  let group: Group;\n  let groupNo: number|boolean = false;\n  const newPage = state && state.state && state.state.newPage;\n\n  let src: Group|any[] = state && state.state && state.state.src;\n  if (!src) {\n    if (!w.source) return '';\n    src = isValueOrExpr(w.source) ?\n      evaluate(ctx, w.source) :\n      filter(ctx.context.root.sources[w.source.source] || { value: [] }, w.source.filter, w.source.sort, w.source.group, ctx.context).value;\n    (ctx.context.special || (ctx.context.special = {})).values || (ctx.context.special.values = {});\n  }\n    \n  let arr: any[];\n\n  if (!Array.isArray(src)) {\n    if (!src || !Array.isArray(src.value)) return { output: '', height: 0 };\n    group = src;\n    arr = group.value;\n    if (w.group) {\n      groupNo = w.group.length > group.grouped ? w.group.length - group.grouped - 1 : false;\n    }\n  } else {\n    arr = src;\n  }\n\n  if ((w.header || w.group) && (newPage || !state || !state.state || state.state.part === 'header' || state.state.part === 'group')) {\n    const hctx = state && state.state && state.state.context && state.state.context.context;\n\n    if (group) {\n      const c = extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: (hctx && hctx.special || {}).values } });\n\n      if (w.group && groupNo !== false && (!state || !state.state || state.state.part === 'group')) {\n        r = renderWidget(w.group[groupNo], extend(ctx, { value: group, special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: true, group: group.group } }), { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n\n        if (r) {\n          if (r.height > availableY) {\n            if (html) html = `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`;\n            return { output: html, height: y, continue: { offset: 0, state: { part: 'group', src, current: 0, newPage: true } } }\n          } else if (availableY != null) {\n            availableY -= r.height;\n            availableY = +availableY.toFixed(6);\n          }\n\n          html += r.output;\n          y += r.height;\n        }\n      }\n\n      if (w.header && (w.groupHeaders && w.groupHeaders[group.grouped] && (!state || !state.state || !state.state.current) || newPage && w.headerPerPage !== false)) r = renderWidget(w.header, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n      else r = { output: '', height: 0 };\n\n      if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'header', src, current: 0, context: ctx, newPage: true } } }\n      else if (availableY != null) {\n        availableY -= r.height;\n        availableY = +availableY.toFixed(6);\n      }\n\n      html += r.output;\n      y += r.height;\n    } else if (w.header) {\n      if (!state || newPage && w.headerPerPage !== false) r = renderWidget(w.header, ctx, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n      else r = { output: '', height: 0 };\n\n      if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'header', src, current: 0, context: ctx, newPage: true } } }\n      else if (availableY != null) {\n        availableY -= r.height;\n        availableY = +availableY.toFixed(6);\n      }\n\n      html += r.output;\n      y += r.height;\n    }\n  }\n\n  if (newPage) state.state.newPage = false;\n  if (state && state.child && state.child.state) state.child.state.newPage = false;\n\n  let rctx: RenderContext = state && state.state && state.state.context || extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: {}, last: arr.length - 1, count: arr.length } });\n  const elide = w.row && (isComputed(w.row.elide) ? evaluate(extend(rctx, { special: { placement, widget: w } }), w.row.elide.x) : w.row.elide);\n\n  if (!state || !state.state || state.state.part !== 'footer') {\n    let usedX = 0;\n    let usedY = 0;\n    let initY = y;\n    if (!elide && !arr.length && w.alternate) {\n      if (w.alternate) {\n        r = renderWidget(w.alternate, rctx, { x: usedX, y, availableX: availableX - usedX, maxX: placement.maxX, availableY, maxY: placement.maxY }, state ? state.child : undefined);\n        if (r.height > availableY) return { output: html, height: 0, continue: { offset: 0, state: { part: 'body', src, current: 0, newPage: true } } }\n        else if (availableY != null) {\n          availableY -= r.height;\n          availableY = +availableY.toFixed(6);\n        }\n\n        html += r.output;\n        y += r.height;\n      }\n    } else {\n      for (let i = (state && state.state && state.state.current) || 0; i < arr.length; i++) {\n        const c = group && group.grouped ?\n          extend(rctx, { value: arr[i], special: { index: i, values: {} }, commit: {} }) :\n          extend(rctx, { value: arr[i], special: { index: i } });\n\n        if (group && group.grouped) {\n          const s: RenderState<RepeatState> = (state && state.child) || { offset: 0, state: { current: 0, src: arr[i], part: 'group' } };\n          r = renderWidget(w, c, { x: 0, y, availableX: availableX - usedX, availableY, maxX: placement.maxX, maxY: placement.maxY }, s);\n        } else {\n          c.commit = {};\n          if (elide) {\n            renderWidget(w.row, c, { x: 0, y: 0, availableX: placement.maxX, maxX: placement.maxX, availableY: placement.maxY, maxY: placement.maxY }, state ? state.child : undefined);\n            commitContext(c);\n            continue;\n          } else {\n            r = renderWidget(w.row, c, { x: usedX, y, availableX: availableX - usedX, maxX: placement.maxX, availableY, maxY: placement.maxY }, state ? state.child : undefined);\n          }\n        }\n\n        if (state) state.child = null;\n\n        if (r.width && r.width <= availableX - usedX && r.width !== availableX) {\n          usedX += r.width;\n          if (r.height > usedY) {\n            usedY = r.height;\n            if (r.height > availableY) initY -= r.height;\n          }\n        } else if (r.width && usedX && r.width > availableX - usedX) {\n          y += usedY;\n          initY = y;\n          if (availableY != null) {\n            availableY -= usedY;\n            availableY = +availableY.toFixed(6);\n          }\n          usedY = 0;\n          usedX = 0;\n          i--;\n          continue;\n        }\n\n        if (r.height > availableY || r.cancel) {\n          if (initY === y && usedY) y += usedY;\n          if (commit) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: r.continue } };\n          else return { output: '', height: y, continue: { offset: y, state: { part: state && state.state && state.state.part || 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: r.continue } };\n        }\n\n        if (!usedY) {\n          y += r.height;\n          if (availableY != null) {\n            availableY -= r.height;\n            availableY = +availableY.toFixed(6);\n          }\n        }\n\n        html += r.output;\n        commit = true;\n\n        if (r.continue) {\n          if (initY === y && usedY) y += usedY;\n          if (w.row.bridge) commitContext(c);\n          return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: w.row.bridge || (group && group.grouped) ? r.continue : undefined } };\n        }\n\n        commitContext(c);\n      }\n    }\n\n    if (initY === y && usedY) y += usedY;\n  }\n\n  if (w.footer) {\n    const fctx = (rctx && rctx.context) || (state && state.state && state.state.context && state.state.context.context);\n    const c = extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: (fctx && fctx.special || {}).values }, commit: {} });\n\n    if (group) {\n      if (w.groupEnds && w.groupEnds[group.grouped]) r = renderWidget(w.footer, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY, availableY });\n      else r = { output: '', height: 0 };\n    } else r = renderWidget(w.footer, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY, availableY });\n\n    if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'footer', current: 0, src, context: rctx, newPage: true } } }\n    else if (r.continue) {\n      if (w.footer.bridge) commitContext(c);\n      return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'footer', src, current: 0, context: rctx, newPage: true }, child: w.footer.bridge ? r.continue : undefined } }\n    }\n\n    commitContext(c);\n\n    html += r.output;\n    y += r.height;\n  }\n\n  return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y };\n}, { container: true });\n\nregisterRenderer<Image>('image', (w, ctx, placement) => {\n  addStyle(ctx, 'image', `.image {position:absolute;box-sizing:border-box;} .image .inner {background-repeat:no-repeat;height:100%;}`);\n\n  const fit = w.fit && typeof w.fit === 'object' ? evaluate(ctx, w.fit.x) : w.fit;\n  if (fit === 'stretch') {\n    return `<img src=\"${evaluate(ctx, w.url)}\" ${styleClass(ctx, ['image'], style(w, placement, ctx))} />`;\n  } else {\n    return `<div ${styleClass(ctx, ['image'], style(w, placement, ctx))}><div ${styleClass(ctx, ['inner'], styleImage(fit), `background-image:url('${evaluate(ctx, w.url)}');`)}></div></div>`;\n  }\n});\n\nregisterRenderer<MeasuredLabel>('measured', (w, ctx, placement, state) => {\n  addStyle(ctx, 'measured', `.measured {position:absolute;box-sizing:border-box;white-space:pre-wrap;font-family:serif;font-size:0.83rem;word-break:break-word;}`);\n  const text = evaluate(ctx, w.text);\n  const height = measure(text, getWidth(w, placement, ctx) || placement.availableX, ctx, w.font);\n  \n  if (!state && height > placement.availableY) {\n    return { output: '', height: 0, continue: { state: {}, offset: 0 } };\n  } else {\n    let s = style(w, placement, ctx, { computedHeight: height, container: true });\n    s[0] = `line-height:1em;` + s[0];\n    return {\n      height, output: `<span${styleClass(ctx, ['measured', 'label'], s)}>${escapeHTML(text)}</span>`\n    };\n  }\n});\n\nregisterRenderer<HTML>('html', (w, ctx, placement) => {\n  addStyle(ctx, 'html', `.html {position:absolute;box-sizing:border-box;overflow:hidden;line-height:1rem;}`);\n  const html = evaluate(extend(ctx, { parser: parseTemplate }), w.html);\n  return `<div${styleClass(ctx, ['html'], style(w, placement, ctx, { container: true }))}>${html}</div>`;\n});\n","import { DateExactRange } from \"./index\";\n\nconst decRE = /(\\d)(?=(\\d{3})+\\.)/g;\nconst intRE = /(\\d)(?=(\\d{3})+$)/g;\nconst isNumRE = /^[-0-9\\\\.,]+$/;\n\nexport function number(v: string|number, dec: number = 2, group: string = ',', negative: 'sign'|'wrap'|'both' = 'sign'): string {\n  v = typeof v !== 'number' ? parseFloat(v || '') : v;\n  if (isNaN(v)) return '';\n  const neg = v < 0;\n  v = v.toFixed(dec);\n  if (dec === 0) v = v.replace(/\\..*/, '');\n  if (neg && negative !== 'sign') v = `(${negative === 'both' ? v : v.substr(1)})`\n  if (group) return v.replace(v.indexOf('.') === -1 ? intRE : decRE, `$1${group}`);\n  else return v;\n}\n\nexport function dollar(v: string, alt: string, dec: number = 2, group: string = ',', sign: string = '$', negative: 'sign'|'wrap'|'both' = 'sign'): string {\n  if (v != null && isNumRE.test(v)) {\n    if (!isNaN(+v)) return `${sign}${number(v, dec, group, negative)}`;\n    else return alt !== undefined ? alt : v;\n  } else {\n    return alt !== undefined ? alt : v;\n  }\n}\n\nexport function phone(v: string|number): string {\n  if (!v) v = '';\n  if (typeof v !== 'string') v = v.toString();\n  v = v || '';\n  v = v.replace(/[^\\d]/g, '');\n\n  if (v.length === 7) return `${v.substr(0, 3)}-${v.substr(3, 4)}`;\n  else if (v.length === 10) return `(${v.substr(0, 3)}) ${v.substr(3, 3)}-${v.substr(6, 4)}`;\n  else if (v.length === 11) return `${v[0]}-${v.substr(1, 3)}-${v.substr(4, 3)}-${v.substr(7, 4)}`;\n  else return v;\n}\n\nconst dateRE = /y+|M+|d+|E+|H+|m+|s+|k+|h+|a+|S+|z+/g;\nconst months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\nconst days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nlet dateDefault: string;\nexport function date(d: string|Date|DateExactRange, fmt: string): string {\n  if (!d) return '';\n  let Y: number, M: number, D: number, DD: number, H: number, MM: number, S: number, SS: number, Z: number;\n\n  // convert an exact range to numbers\n  if (typeof d === 'object' && 'f' in d && Array.isArray(d.f)) {\n    const f = d.f, l = f.length, e = d.e;\n    Y = f[0], M = l > 1 && f[1] != null ? f[1] : e ? 11 : 0, D = l > 2 && f[2] != null ? f[2] : e ? 0 : 1,\n      H = l > 3 && f[3] != null ? f[3] : e ? 23 : 0, MM = l > 4 && f[4] != null ? f[4] : e ? 59 : 0, S = l > 5 && f[5] != null ? f[5] : e ? 59 : 0,\n      SS = l > 6 && f[6] != null ? f[6] : e ? 999 : 0;\n    let dt = new Date(Y, M, D || 1, H, MM, S, SS);\n    Z = l > 7 && f[7] != null ? -f[7] : dt.getTimezoneOffset();\n    if (!D) {\n      dt.setMonth(M + 1);\n      dt.setDate(0);\n      D = dt.getDate();\n    }\n    DD = dt.getDay();\n  } else {\n    if (typeof d === 'string') d = new Date(d);\n    if (Object.prototype.toString.call(d) !== '[object Date]') return '';\n    if (isNaN(d as any)) return '';\n\n    const v = d as Date;\n    Y = v.getFullYear(), M = v.getMonth(), D = v.getDate(), DD = v.getDay(), H = v.getHours(), MM = v.getMinutes(), S = v.getSeconds(), SS = v.getMilliseconds(), Z = v.getTimezoneOffset();\n  }\n\n\n  if (!fmt) fmt = dateDefault || 'yyyy-MM-dd';\n\n  return fmt.replace(dateRE, m => {\n    if (m[0] === 'y') {\n      return m.length <= 2 ? (`${Y}`).substr(2, 2) : `${Y}`;\n    } else if (m[0] === 'M') {\n      if (m.length === 1) return `${M + 1}`;\n      else if (m.length === 2) return M < 9 ? `0${M + 1}` : `${M + 1}`;\n      else if (m.length === 3) return months[M].substr(0, 3);\n      else return months[M];\n    } else if (m[0] === 'd') {\n      if (m.length === 1) return `${D}`;\n      else if (m.length === 2) return D <= 9 ? `0${D}` : `${D}`;\n      else return ordinal(D);\n    } else if (m[0] === 'E') {\n      if (m.length === 1) return `${DD + 1}`;\n      else if (m.length === 2) return days[DD].substr(0, 3);\n      else return days[DD];\n    } else if (m[0] === 'H') {\n      return m.length === 1 ? `${H}` : H <= 9 ? `0${H}` : `${H}`;\n    } else if (m[0] === 'm') {\n      return m.length === 1 ? `${MM}` : MM <= 9 ? `0${MM}` : `${MM}`;\n    } else if (m[0] === 's') {\n      return m.length === 1 ? `${S}` : S <= 9 ? `0${S}` : `${S}`;\n    } else if (m[0] === 'S') {\n      const ms = SS;\n      if (m.length === 1) return `${ms}`;\n      return ms < 10 ? `00${ms}` : ms < 100 ? `0${ms}` : `${ms}`;\n    } else if (m[0] === 'k' || m[0] === 'h') {\n      let r = `${H % 12}`;\n      if (r === '0') r = '12';\n      return `${r}`;\n    } else if (m[0] === 'a') {\n      return H > 11 ? 'PM' : 'AM';\n    } else if (m[0] === 'z') {\n      let min = 0 - Z;\n      const bit = min < 0 ? '-' : '+';\n      min = Math.abs(min);\n      let r: number = min;\n      if (m.length === 1) {\n        r = Math.floor(min / 60);\n      } else if (m.length === 2) {\n        const mm = min % 60;\n        const h = Math.floor(min / 60);\n        return `${bit}${h < 10 ? '0' : ''}${h}${mm < 10 ? '0' : ''}${mm}`;\n      } else if (m.length === 3) {\n        const mm = min % 60;\n        const h = Math.floor(min / 60);\n        return `${bit}${h < 10 ? '0' : ''}${h}:${mm < 10 ? '0' : ''}${mm}`;\n      } else r = min;\n      return `${bit}${r}`;\n    }\n  });\n}\n\ndate.setDefault = function(format?: string) {\n  dateDefault = format;\n}\n\nexport function ordinal(num: number|string, group?: string): string {\n  num = number(num, 0, group);\n  let n = `${num}`;\n  n = n.substr(-2, 2);\n  if (n.length > 1 && n[0] === '1') return `${num}th`;\n  switch (n[1] || n[0]) {\n    case '1':\n      return `${num}st`;\n    case '2':\n      return `${num}nd`;\n    case '3':\n      return `${num}rd`;\n    default:\n      return `${num}th`;\n  }\n}\n","import { ValueOrExpr, Operation, Literal, DateRel, DateRelRange, isDateRel, isTimespan, TimeSpan, isApplication } from '../index';\nimport { endRef, isTimespanMS, timespans, timeSpanToNumber } from '../parse';\nimport { Schema } from '../index';\n\nconst checkIdent = new RegExp(`[${endRef.split('').map(v => `\\\\${v}`).join('')}]`);\n\nexport interface ListOverride {\n  base: boolean|number;\n  array?: boolean|number;\n  union?: boolean|number;\n  args?: boolean|number;\n  keys?: boolean|number;\n}\n\ninterface _ListOverride {\n  array: number;\n  union: number;\n  args: number;\n  keys: number;\n}\n\nexport type StringifyOpts = SimpleStringifyOpts | SExprStringifyOpts;\nexport interface BaseStringifyOpts {\n  /** Disable the use of symbol style :strings. */\n  noSymbols?: boolean;\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps?: boolean;\n  /** Enable comma separators in lists of values. */\n  listCommas?: boolean;\n  /** Whether to wrap lists of items. `true` wraps every item. A number targets that many characters in the output to cause a wrap. The default is 60 chars. */\n  listWrap?: boolean|number|ListOverride;\n  /** Output template formatted expressions. */\n  template?: boolean;\n  /** Output unindented single line expressions. */\n  noIndent?: boolean;\n  /** Output HTML-friendly syntax */\n  htmlSafe?: boolean;\n  /** Strip checks out of schema types */\n  noChecks?: boolean;\n}\nexport interface SimpleStringifyOpts extends BaseStringifyOpts {\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps?: false;\n}\nexport interface SExprStringifyOpts extends BaseStringifyOpts {\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps: true;\n  /** Output array function calls rather than sugared array literals. */\n  noArrayLiterals?: boolean;\n  /** Output object function calls rather than sugared object literals. */\n  noObjectLiterals?: boolean;\n}\n\nlet _noSym: boolean = false;\nlet _key: boolean = false;\nlet _sexprops: boolean = false;\nlet _listcommas: boolean = false;\nlet _noarr: boolean = false;\nlet _noobj: boolean = false;\nlet _tpl: boolean = false;\nlet _tplmode: boolean = false;\nlet _noindent: boolean = false;\nlet _listwrap: _ListOverride = { array: 60, union: 60, args: 60, keys: 60 };\nlet _html: boolean = false;\nlet _nochecks: boolean = false;\n\nlet _level = 0;\nlet _first = false;\n\nconst deepops = ['===', '!==', 'deep-is', 'deep-is-not'];\nconst binops = deepops.concat(['**', '*', '/%', '/', '%', '+', '-', '>=', 'gte', '>', 'gt', '<=', 'lte', '<', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain', 'is', 'is-not', '==', '!=', 'strict-is', 'strict-is-not', 'and', '&&', 'or', '||', '??']);\nconst unops = ['+', 'not'];\nconst precedence = {\n  '**': 1,\n  '*': 2, '/%': 2, '/': 2, '%': 2,\n  '+': 3, '-': 3,\n  '>=': 4, '>': 4, '<=': 4, '<': 4, in: 4, like: 4, ilike: 4, 'not-in': 4, 'not-like': 4, 'not-ilike': 4, 'contains': 4, 'does-not-contain': 4, gt: 4, gte: 4, lt: 4, lte: 4,\n  'is': 5, 'is-not': 5, '==': 5, '!=': 5, 'strict-is': 5, 'strict-is-not': 5, 'deep-is': 5, 'deep-is-not': 5, '===': 5, '!==': 5,\n  'and': 6, '&&': 6,\n  'or': 7, '||': 7, '??': 7,\n}\n\nconst call_op = /^[-a-zA-Z_$0-9]/;\n\nexport function stringify(value: ValueOrExpr, opts?: StringifyOpts): string {\n  opts = opts || {};\n  _noSym = opts.noSymbols;\n  _sexprops = opts.SExprOps;\n  _listcommas = opts.listCommas;\n  _noarr = opts.SExprOps && opts.noArrayLiterals;\n  _noobj = opts.SExprOps && opts.noObjectLiterals;\n  _key = false;\n  _tpl = _tplmode = opts.template;\n  _noindent = opts.noIndent;\n  _level = 0;\n  _first = true;\n  if ('listWrap' in opts) {\n    const o = opts.listWrap;\n    if (typeof o === 'boolean') _listwrap = !o ? { array: 0, union: 0, args: 0, keys: 0 } : { array: 1, union: 1, args: 1, keys: 1 };\n    else if (typeof o === 'number') _listwrap = { array: o, union: o, args: o, keys: o };\n    else {\n      const b = !o.base ? 0 : o.base === true ? 1 : o.base;\n      _listwrap = Object.keys(_listwrap).reduce((a, c) => (a[c] = c in o && o[c] != null ? (!o[c] ? 0 : o[c] === true ? 1 : o[c]) : b, a), {} as any);\n    }\n  } else _listwrap = { array: 60, union: 60, args: 60, keys: 60 };\n  _html = opts.htmlSafe;\n  _nochecks = opts.noChecks;\n  if (!_sexprops && typeof value === 'object' && value && 'op' in value && value.op === 'block') return stringifyRootBlock(value);\n  else return _stringify(value);\n}\n\nfunction padl(v: any, pad: string, len: number): string {\n  v = `${v}`;\n  if (!pad) return v;\n  for (let i = v.length; i < len; i++) {\n    v = pad + v;\n  }\n  return v;\n}\n\nfunction fill(char: string, len: number): string {\n  let res = '';\n  for (let i = 0; i < len; i++) res += char;\n  return res;\n}\n\nfunction _stringify(value: ValueOrExpr): string {\n  if (typeof value === 'string') return value;\n  let stringed: string;\n  if (value == null || typeof value === 'number' || typeof value === 'boolean') return `${value}`;\n  if (_tpl && ('op' in value || 'r' in value)) {\n    if ('op' in value) {\n      if (value.op === 'if' || value.op === 'with' || value.op === 'unless' || value.op === 'each') {\n        stringed = stringifyTemplateBlock(value);\n      } else if (value.op === 'case') {\n        stringed = stringifyTemplateCase(value);\n      } else if (value.op) {\n        if (value.op === '+') return value.args.map(a => _stringify(a)).join('');\n        else {\n          _tpl = false;\n          const res = `{{${_stringify(value.op === 'string' ? value.args[0] : value)}}}`;\n          _tpl = true;\n          stringed = res;\n        }\n      }\n    } else {\n      _tpl = false;\n      const res = `{{${_stringify(value)}}}`;\n      _tpl = true;\n      stringed = res;\n    }\n  } else if ('r' in value) {\n    if (typeof value.r === 'string') stringed = /^[0-9]/.test(value.r) ? `.${value.r}` : value.r;\n    else {\n      const r = value.r;\n      stringed = `${fill('^', r.u || 0)}${r.p || ''}${r.k.map((p, i) => {\n        if (typeof p === 'string' && checkIdent.test(p)) return `${i ? '' : '_'}[${_stringify({ v: p })}]`;\n        else if (typeof p === 'string' || typeof p === 'number') return `${i ? '.' : ''}${p}`;\n        else return `[${_stringify(p)}]`\n      }).join('')}`;\n    }\n  } else if ('op' in value) {\n    stringed = stringifyOp(value);\n  } else if (isApplication(value)) {\n    const arrow = ((_tplmode && _html !== false) || _html) ? '\\\\' : '>';\n    if ('n' in value) stringed = `|${value.n.join(_listcommas ? ', ' : ' ')}| =${arrow} ${_stringify(value.a)}`;\n    else stringed = `=${arrow}${_stringify(value.a)}`;\n  } else if ('v' in value) {\n    stringed = stringifyLiteral(value);\n  } else if (isDateRel(value)) {\n    stringed = stringifyDate(value);\n  } else if (isTimespan(value)) {\n    stringed = stringifyTimespan(value);\n  }\n\n  if ('c' in value && value.c.length) stringed = (_first ? '' : '\\n') + value.c.map(c => `${padl('', '  ', _level)}// ${c}\\n`).join('') + `${padl('', '  ', _level)}${stringed}`;\n\n  return stringed;\n}\n\nfunction stringifyBinopArg(op: string, arg: ValueOrExpr, pos: 1|2): string {\n  let res: string;\n  if (op === '**' && pos === 1 && typeof arg !== 'string' && 'op' in arg && arg.op === '**') res = `(${_stringify(arg)})`;\n  if (typeof arg !== 'string' && 'op' in arg) {\n    if (binops.includes(arg.op) && precedence[arg.op] > precedence[op]) res = `(${_stringify(arg)})`;\n    else if (arg.op === 'if' || arg.op === 'unless' || arg.op === 'case' || arg.op === 'fmt' || arg.op === 'format') res = `(${_stringify(arg)})`;\n    else res = _stringify(arg);\n  } else res = _stringify(arg);\n  return res;\n}\n\nfunction findNestedStringOpL(op: string, value: Operation): boolean {\n  if (value.args && value.args.find(a => typeof a === 'object' && typeof (a as any).v === 'string')) return true;\n  if (!value.args || !value.args.length) return false;\n  const left = value.args[0];\n  if (typeof left === 'object' && 'op' in left && left.op === op) return findNestedStringOpL(op, left);\n  return false;\n}\n\nfunction flattenNestedBinopsL(op: string, value: Operation, agg: ValueOrExpr[] = []): ValueOrExpr[] {\n  if (value.args && value.args.length) {\n    let i = 0;\n    for (; i < value.args.length; i++) {\n      if (typeof value.args[i] === 'object' && typeof (value.args[i] as any).v === 'string') agg.push(value.args[i]);\n      else break;\n    }\n    const left = value.args[i];\n    if (typeof left === 'object' && 'op' in left && left.op === op) flattenNestedBinopsL(op, left, agg);\n    else agg.push(left);\n    agg.push.apply(agg, value.args.slice(i + 1));\n  }\n  return agg;\n}\n\nfunction stringifyOp(value: Operation): string {\n  let op = value.op;\n  if ((_tplmode && _html !== false) || _html) {\n    if (op === '>') op = 'gt';\n    else if (op === '>=') op = 'gte';\n    else if (op === '<') op = 'lt';\n    else if (op === '<=') op = 'lte';\n    else if (op === '&&') op = 'and';\n  }\n  if (!_noarr && op === 'array' && !value.opts) {\n    return wrapArgs('[', value.args, value.opts, ']');\n  } else if (!_noobj && op === 'object' && value.args && !value.args.find((a, i) => i % 2 === 0 && (typeof a === 'string' || !('v' in a) || typeof a.v !== 'string'))) {\n    if (!value.args || !value.args.length) return '{}';\n    return wrapArgs('{', value.args, value.opts, '}', 2);\n  } else if (_sexprops) {\n    if (!value.args || !value.args.length) return `(${op})`;\n    return wrapArgs(`(${op} `, value.args, value.opts, ')', 0);\n  } else if (op === 'if' || op === 'unless' && value.args && value.args.length > 2) {\n    return stringifyIf(value);\n  } else if (op === 'case' && value.args && value.args.length > 2) {\n    return stringifyCase(value);\n  } else if (op === '+' && value.args && value.args.length > 1 && findNestedStringOpL(op, value)) {\n    const args = flattenNestedBinopsL(op, value);\n    return `'${args.map(a => typeof a !== 'string' && 'v' in a && typeof a.v === 'string' ? a.v.replace(/[{']/g, v => `\\\\${v}`).replace(/\\$$/, '\\\\$') : `{${_stringify(a)}}`).join('')}'`\n  } else if ((op === 'fmt' || op === 'format') && value.args && typeof value.args[1] === 'object' && 'v' in value.args[1] && typeof value.args[1].v === 'string') {\n    const val = value.args[0];\n    let vs = _stringify(val);\n    if (typeof val !== 'string' && 'op' in val && (binops.includes(val.op) || unops.includes(val.op))) vs = `(${vs})`;\n    if (value.opts) return `${vs}#${[value.args[1].v]}${wrapArgs('(', value.args.slice(2), value.opts, ')')}`;\n    else return `${vs}#${[value.args[1].v].concat(value.args.slice(2).map(a => _stringify(a))).join(',')}`;\n  } else if (binops.includes(op) && value.args && value.args.length > 1 && !value.opts && (!deepops.includes(op) || value.args.length === 2)) {\n    let parts = value.args.map((a, i) => stringifyBinopArg(op, a, i === 0 ? 1 : 2));\n    const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || parts.reduce((a, c) => a + c.length, 0) && parts.length > 2;\n    const split = _noindent ? ' ' : long ? `\\n${padl('', '  ', _level + 1)}` : ' ';\n    if (split.length > 1 || (!_noindent && long)) parts = [parts[0]].concat(parts.slice(1).map(p => indentAll('  ', p)));\n    return `${parts[0]} ${op}${split}${parts.slice(1).join(` ${op}${split.length > 1 ? `${split}` : split}`)}`;\n  } else if (unops.includes(op) && value.args && value.args.length === 1) {\n    const arg = value.args[0];\n    if (typeof arg !== 'string' && 'op' in arg && (binops.includes(arg.op) || unops.includes(arg.op))) return `${op}(${_stringify(arg)})`;\n    else return `${op}${call_op.test(op) ? ' ' : ''}${_stringify(arg)}`;\n  } else if (op === 'block') {\n    if (!value.args || !value.args.length) return '';\n\n    _level++;\n    const _f = _first;\n    const parts = value.args.map((a, i) => (_first = i === 0, _stringify(a)));\n    _first = _f;\n    let split = _noindent ? '' : `\\n${padl('', '  ', _level)}`;\n    _level--;\n    if (parts.length === 1 && !~parts[0].indexOf('\\n')) return `{ ${parts[0]} }`;\n    return `{${split}${parts.join(split)}\\n${padl('', '  ', _level)}}`;\n  } else if ((op === 'let' || op === 'set') && value.args && value.args.length === 2) {\n    let path: string;\n    let arg = value.args[0];\n    if (typeof arg === 'string') path = arg;\n    else if ('v' in arg && typeof arg.v === 'string') path = arg.v;\n    else if ('v' in arg && typeof arg.v === 'object' && 'k' in arg.v) path = _stringify({ r: arg.v });\n    else path = _stringify(arg);\n    return `${op} ${path} = ${_stringify(value.args[1])}`;\n  } else if (op === 'get' && value.args.length === 2 && typeof value.args[1] === 'object' && 'v' in value.args[1] && typeof value.args[1].v === 'object' && 'k' in value.args[1].v) {\n    return `${_stringify(value.args[0])}${_stringify({ r: { k: ['r'].concat(value.args[1].v.k) } }).substr(1)}`;\n  } else if (call_op.test(op)) {\n    return wrapArgs(`${op}(`, value.args || [], value.opts, ')', 0);\n  } else {\n    if (!value.args || !value.args.length) return `(${op})`;\n    return wrapArgs(`(${op} `, value.args, value.opts, ')', 0);\n  }\n}\n\nfunction stringifyRootBlock(block: Operation): string {\n  if (!block.args || !block.args.length) return '';\n  return block.args.map((a, i) => (_first = i === 0, _stringify(a))).join('\\n');\n}\n\nfunction stringifyLiteral(value: Literal): string {\n  if (value.s === 1) {\n    _level++;\n    const res = stringifySchema(value.v);\n    _level--;\n    if (~res.indexOf('\\n')) {\n      const level = _noindent ? ' ' : `\\n${padl('', '  ', _level)}`;\n      return `@[${level}${level !== ' ' ? '  ' : ''}${res}${level}]`;\n    } else return `@[${res}]`;\n  } else if (typeof value.v === 'string') {\n    if (_tpl) return value.v.replace(/\\\\(.)/g, '\\\\\\\\$1').replace(/{{/g, '\\\\{{');\n    if ((_key || !_noSym) && !checkIdent.test(value.v) && value.v.length) return `${_key ? '' : ':'}${value.v}`;\n    else if (!~value.v.indexOf(\"'\")) return `'${value.v.replace(/[{']/g, v => `\\\\${v}`).replace(/\\${/g, '\\\\${')}'`;\n    else if (!~value.v.indexOf('`')) return `\\`${value.v.replace(/[{`]/g, v => `\\\\${v}`).replace(/\\${/g, '\\\\${')}\\``;\n    else if (!~value.v.indexOf('\"')) return `\"${value.v}\"`;\n    else return `'${value.v.replace(/['{]/g, s => `\\\\${s}`).replace(/\\${/g, '\\\\${')}'`;\n  } else if (typeof value.v === 'number' || typeof value.v === 'boolean' || value.v === 'true' || value.v === 'false') {\n    return `${value.v}`;\n  } else if (value.v === 'undefined' || value.v === undefined) {\n    return 'undefined';\n  } else if (value.v === 'null' || value.v === null) {\n    return 'null';\n  } else if (Array.isArray(value.v)) {\n    if (_noarr) return wrapArgs('(array', value.v.map(v => ({ v })), null, ')', null, 'array');\n    return wrapArgs('[', value.v.map(v => ({ v })), null, ']', null, 'array');\n  } else if (typeof value.v === 'object') {\n    if (isDateRel(value.v)) {\n      return stringifyDate(value.v);\n    } else {\n      return wrapArgs('{', Object.entries(value.v).reduce((a, c) => (a.push({ v: c[0] }, { v: c[1] }), a), []), null, '}', 2, 'keys');\n    }\n  }\n}\n\nfunction offsetToTimezone(dir: 1|-1, offset?: number): string {\n  if (offset == null) return '';\n  offset = offset * dir;\n  const o = Math.abs(offset);\n  const h = Math.floor(o / 60);\n  const m = o % 60;\n  if (!offset) return 'Z';\n  else return `${offset > 0 ? '-' : '+'}${h}${m ? `:${padl(m, '0', 2)}` : ''}`;\n}\n\nconst spanKeys = ['w', 'd', 'h', 'mm', 's'];\nconst spanExact = ['y', 'm', 'd', 'h', 'mm', 's', 'ms'];\nfunction stringifyDate(value: DateRel): string {\n  let str = '';\n  if (value instanceof Date) { // date object\n    const y = value.getFullYear();\n    const m = value.getMonth() + 1;\n    const d = value.getDate();\n    const h = value.getHours();\n    const mn = value.getMinutes();\n    const s = value.getSeconds();\n    const ms = value.getMilliseconds();\n    str = `${y}-${padl(m, '0', 2)}-${padl(d, '0', 2)}`;\n    if (h + mn + s + ms > 0) {\n      str += ` ${padl(h, '0', 2)}:${padl(mn, '0', 2)}`;\n      if (s + ms > 0) {\n        str += `:${padl(s, '0', 2)}`;\n        if (ms > 0) str += `.${padl(ms, '0', 3)}`;\n      }\n    }\n    return `#${str}${offsetToTimezone(1, value.getTimezoneOffset())}#`;\n  } else if (Array.isArray(value.f)) { // precise date\n    const a = value.f;\n    str = `${a[0]}`;\n    if (a[1] != null) str += `-${padl(a[1] + 1, '0', 2)}`;\n    if (a[2] != null) str += `-${padl(a[2], '0', 2)}`;\n    if (a[3] != null) str += ` ${padl(a[3], '0', 2)}`;\n    if (a[4] != null) str += `:${padl(a[4], '0', 2)}`;\n    if (a[5] != null) str += `:${padl(a[5], '0', 2)}`;\n    if (a[6] != null) str += `.${padl(a[6], '0', 3)}`;\n    if (a[7] != null) str += ` ${offsetToTimezone(-1, a[7])}`;\n    if ('e' in value && value.e) str += '<';\n    return `#${str}#`;\n  } else if (value.f === 'n') { // relative point in time\n    if (Array.isArray(value.o)) { // inconsistent units\n      spanExact.forEach((k, i) => {\n        if (value.o[i] != null) str += `${value.o[i]}${k}`;\n      });\n      str += `${'d' in value && value.d === -1 ? ' ago' : ' from now'}${offsetToTimezone(-1, value.z)}`;\n      return `#${str}#`;\n    } else if (typeof value.o === 'number') { // milliseconds\n      if (value.o === 0) return `#now#`;\n      let rem = Math.abs(value.o);\n      spanKeys.forEach(k => {\n        const t = Math.floor(rem / timespans[k]);\n        rem = rem % timespans[k];\n        if (t) str += `${t}${k}`;\n      });\n      if (rem) str += `${rem}ms`;\n      return `#${str}${value.o < 0 ? ' ago' : value.o > 0 ? ' from now' : ''}${offsetToTimezone(-1, value.z)}#`;\n    }\n  } else if ('d' in value && value.d === 1 && value.o === 0) { // span to date\n    str = `#${value.f === 'w' ? 'week' : value.f === 'm' ? 'month' : 'year'} to date${offsetToTimezone(-1, value.z)}${value.e && '>' || ''}#`;\n  } else if ('t' in value && Array.isArray(value.t)) { // time on relative day\n    const a = value.t;\n    str = `${value.o < 0 ? 'yesterday' : value.o > 0 ? 'tomorrow' : 'today'} at `;\n    if (!a[0] && !a[1] && !a[2] && !a[3]) str += 'midnight';\n    else if (a[0] === 12 && !a[1] && !a[2] && !a[3]) str += 'noon';\n    else {\n      str += a[0];\n      if (a[1] != null) str += `:${padl(a[1], '0', 2)}`;\n      if (a[2] != null) str += `:${padl(a[2], '0', 2)}`;\n      if (a[3] != null) str += `.${padl(a[3], '0', 3)}`;\n    }\n    return `#${str}${offsetToTimezone(-1, a[4])}${value.e ? '>' : ''}#`;\n  } else if (!('t' in value) && !('d' in value) && !Array.isArray(value.f)) { // relative span\n    const v = value as DateRelRange;\n    if (v.f === 'd') {\n      str += `${v.o < 0 ? 'yesterday' : v.o > 0 ? 'tomorrow' : 'today'}`;\n    } else {\n      str += `${v.o < 0 ? 'last' : v.o > 0 ? 'next' : 'this'} ${v.f === 'w' ? 'week' : v.f === 'm' ? 'month' : 'year'}`;\n    }\n    return `#${str}${offsetToTimezone(-1, v.z)}${v.e ? '>' : ''}#`;\n  }\n\n  return str;\n}\n\nfunction stringifyTimespan(value: TimeSpan): string {\n  if (typeof value === 'number' || isTimespanMS(value)) {\n    let str = '';\n    let rem = Math.abs(timeSpanToNumber(value));\n    spanKeys.forEach(k => {\n      const t = Math.floor(rem / timespans[k]);\n      rem = rem % timespans[k];\n      if (t) str += `${t}${k}`;\n    });\n    if (rem) str += `${rem}ms`;\n    return `#${str}#`;\n  } else {\n    const o = value.d;\n    let str = '';\n    spanExact.forEach((k, i) => {\n      if (o[i] != null) str += `${o[i]}${k}`;\n    });\n    return `#${str}#`;\n  }\n}\n\nconst leadingSpace = /^\\s+/;\nconst allLeadingSpace = /^\\s+/gm;\nfunction outdentAll(amount: string, str: string): string {\n  if (amount) return str.replace(allLeadingSpace, s => s.substr(amount.length));\n  else return str;\n}\nfunction indentAll(amount: string, str: string): string {\n  return str.replace(/\\n/gm, `\\n${amount}`);\n}\n\nfunction wrapArgs(open: string, args: ValueOrExpr[], opts: ValueOrExpr, close: string, keyMod?: number, wrapSetting?: keyof _ListOverride): string {\n  if ((!args || !args.length) && !opts) return `${open}${close}`;\n  _level++;\n  const _f = _first;\n  let parts: string[];\n  if (keyMod) {\n    parts = [];\n    for (let i = 0; i < args.length; i++) {\n      if (i % keyMod === 0) {\n        _key = true;\n        parts.push(_stringify(args[i]) + ':');\n        _key = false;\n      } else {\n        _level++;\n        _first = i === 1;\n        const res = _stringify(args[i]);\n        if (res[0] === '\\n')  parts[parts.length - 1] += ' ' + res.replace(leadingSpace, '');\n        else parts[parts.length - 1] += res;\n        _level--;\n      }\n    }\n  } else {\n    parts = args.map((a, i) => {\n      _first = i === 0;\n      return _stringify(a);\n    });\n  }\n  if (opts && typeof opts === 'object') {\n    const args = 'op' in opts && opts.args ? opts.args : 'v' in opts ? Object.entries(opts.v).reduce((a, c) => (a.push({ v: c[0] }, { v: c[1] }), a), []) : [];\n    for (let i = 0; i < args.length; i++) {\n      if (i % 2 === 0) {\n        _key = true;\n        parts.push(_stringify(args[i]) + ':');\n        _key = false;\n      } else {\n        _level++;\n        _first = i === 1;\n        const res = _stringify(args[i]);\n        if (res[0] === '\\n')  parts[parts.length - 1] += ' ' + res.replace(leadingSpace, '');\n        else parts[parts.length - 1] += res;\n        _level--;\n      }\n    }\n  }\n  _level--;\n  _first = _f;\n\n  let join = _listcommas ? ', ' : ' ';\n  if (_noindent || (parts.length == 1 && !~parts[0].indexOf('\\n'))) return `${open}${parts.join(join)}${close}`;\n  let wrap = _listwrap[wrapSetting || 'args'];\n  const base = parts.join(_listcommas ? ', ' : ' ');\n  if (!wrap && ~base.indexOf('\\n')) wrap = 1;\n  if (wrap === 1 && _listcommas) join = ',\\n';\n\n  const level = padl('', '  ', _level);\n\n  if (!wrap) return `${open}${base}${close}`;\n  else if (wrap === 1) return `${open}\\n${parts.map(p => `${level}  ${p}`).join(join)}\\n${level}${close}`;\n  if (base.length <= wrap) return `${open}${base}${close}`;\n\n  let res = `${open}`;\n  let str = '';\n  const last = parts.length - 1;\n  for (let i = 0; i < parts.length; i++) {\n    if (~parts[i].indexOf('\\n')) {\n      if (str) res += str;\n      res += `\\n${parts[i][0] === ' ' ? '' : level + '  '}${parts[i]}${i !== last ? join : ''}`;\n      str = '';\n      continue;\n    }\n    if (!str) str += `\\n${level}  `;\n    str += `${parts[i]}${i !== last ? join : ''}`;\n    if (str.length >= wrap) {\n      res += str;\n      str = '';\n    }\n  }\n  if (str) res += str;\n  return `${res}\\n${level}${close}`;\n}\n\nfunction isBlock(v: any): boolean {\n  return typeof v === 'object' && 'op' in v && v.op === 'block';\n}\n\nfunction stringifyIf(op: Operation): string {\n  if (!op.args || op.args.length < 2) return 'false';\n\n  let str = '';\n\n  const last = op.args.length - 1;\n  const block = !!op.args.find((p, i) => (i % 2 === 1 || i === last) && isBlock(p));\n\n  _level++;\n  const parts = op.args.map((a, i) => _stringify(block && (i % 2 === 1 || i === last) && !isBlock(a) ? { op: 'block', args: [a] } : a));\n  _level--;\n\n  const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || '';\n  let split = _noindent ? '' : parts.length > 3 || long ? `\\n${padl('', '  ', _level)}` : '';\n  const cindent = long && `${split}  ` || ' ';\n  split = split || ' ';\n  for (let i = 0; i <= last; i++) {\n    if (i === 0) {\n      if (block) str += `if ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else {\n        const cond = parts[i++];\n        str += `if ${cond}${~cond.indexOf('\\n') ? split : ' '}then${cindent}${parts[i].trimLeft()}`\n      }\n    } else if (i === last) {\n      if (block) str = str.trimRight() + ` else ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${split}else${cindent}${parts[i].trimLeft()}`;\n    } else {\n      if (block) str = str.trimRight() + ` elif ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${split}elif ${parts[i++]} then${cindent}${parts[i].trimLeft()}`;\n    }\n  }\n  if (!block && _level) str += `${split}end`;\n\n  return str;\n}\n\nconst caseRE = /@case\\b/g;\nfunction stringifyCase(op: Operation): string {\n  if (!op.args || op.args.length < 2) return 'false';\n\n  let str = '';\n\n  const last = op.args.length - 1;\n  const block = !!op.args.find((p, i) => ((i > 1 && i % 2 === 0) || i === last) && isBlock(p));\n\n  _level++;\n  const parts = op.args.map((a, i) => {\n    let res: string;\n    if (i !== 0) _level++;\n\n    if (block && (i > 1 && i % 2 === 0 || i === last)) {\n      res = _stringify(isBlock(a) ? a : { op: 'block', args: [a] });\n    } else if (i % 2 === 0 || i === last) {\n      res = _stringify(a);\n    } else {\n      res = typeof a === 'object' && 'op' in a ? _stringify(a).replace(caseRE, '_') : _stringify(a);\n    }\n\n    if (i !== 0) _level--;\n\n    return res;\n  });\n  _level--;\n\n  const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || '';\n  let split = _noindent ? '' : parts.length > 3 || long ? `\\n${padl('', '  ', _level)}` : '';\n  const wsplit = split ? `${split}  ` : ' ';\n  const cindent = long && `${wsplit}  ` || ' ';\n  split = split || ' ';\n  for (let i = 0; i <= last; i++) {\n    if (i === 0) {\n      if (block) str += `case ${parts[i]}`;\n      else str += `case ${parts[i]}`\n    } else if (i === last) {\n      if (block) str = str.trimRight() + wsplit + `else ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${wsplit}else${cindent}${parts[i].trimLeft()}`\n    } else {\n      if (block) str = str.trimRight() + wsplit + `when ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else {\n        const cond = parts[i++];\n        str += `${wsplit}when ${cond}${~cond.indexOf('\\n') ? wsplit : ' '}then${cindent}${parts[i].trimLeft()}`;\n      }\n    }\n  }\n  if (!block && _level) str += `${split}end`;\n\n  return str;\n}\n\nfunction stringifyTemplateBlock(op: Operation): string {\n  _tpl = false;\n  const cond = _stringify(op.args[0]);\n  _tpl = true;\n  const first = _stringify(op.args[1]);\n  let res = `{{${op.op} ${cond}}}${op.op === 'with' || op.op === 'each' ? first.slice(2) : first}`;\n  if (op.op === 'unless') return `${res}{{/}}`;\n  for (let i = 2; i < op.args.length; i++) {\n    if (i + 1 >= op.args.length) {\n      const arg = op.args[i];\n      if (typeof arg === 'object' && 'v' in arg && arg.v === '') continue;\n      else res += `{{else}}${_stringify(arg)}`;\n    } else {\n      _tpl = false;\n      res += `{{elseif ${_stringify(op.args[i++])}}}`;\n      _tpl = true;\n      res += _stringify(op.args[i]);\n    }\n  }\n  res += '{{/}}';\n  return res;\n}\n\nfunction stringifyTemplateCase(op: Operation): string {\n  const last = op.args.length - 1;\n  const parts = op.args.map((a, i) => {\n    _tpl = true;\n    if (i === 0 || i % 2 === 1) _tpl = false;\n    if (i === last) _tpl = true;\n    return typeof a === 'object' && 'op' in a ? _stringify(a).replace(caseRE, '_') : _stringify(a);\n  });\n  _tpl = true;\n  let res = `{{${op.op} ${parts[0]} when ${parts[1]}}}`;\n  for (let i = 2; i <= last; i++) {\n    if (i === last) res += `{{else}}${parts[i]}`;\n    else if (i % 2 === 1) res += `{{when ${parts[i]}}}`;\n    else res += parts[i];\n  }\n  res += '{{/}}';\n  return res;\n}\n\nexport function stringifySchema(schema: Schema, noChecks?: boolean): string {\n  if (noChecks !== undefined) _nochecks = noChecks;\n\n  if (!schema) return 'any';\n  const t = schema.type;\n  const ts = schema.types;\n\n  let strs: string[];\n  let fin = '', open = '', close = '', join = '';\n  let wrap: number = _listwrap.array;\n\n  switch (t) {\n    case 'object':\n    case 'object[]':\n      const arr = !!~t.indexOf('[]');\n      if ((!schema.fields || !schema.fields.length) && !schema.rest) {\n        fin = `{}${arr ? '[]' : ''}`;\n        break;\n      }\n      wrap = _listwrap.keys;\n      _level++;\n      strs = schema.fields ? schema.fields.map((f, i) => {\n        const str = stringifySchema(f);\n        return (f.desc && f.desc.length ? (i === 0 ? '' : `\\n${padl('', '  ', _level)}`) + f.desc.map(c => `// ${c}`).join(`\\n${padl('', '  ', _level)}`) + `\\n${padl('', '  ', _level)}` : '') + `${f.name}${f.required ? '' : '?'}: ${str}`;\n      }) : [];\n      if (schema.rest) strs.push(`...: ${stringifySchema(schema.rest)}`);\n      _level--;\n      open = '{';\n      close = `}${arr ? '[]' : ''}`;\n      join = ', ';\n      break;\n    case 'union':\n    case 'union[]':\n      if (~t.indexOf('[]')) open = 'Array<', close = '>';\n      else if (schema.checks && schema.checks.length) open = '(', close = ')';\n      if (open) _level++;\n      strs = ts.map(u => stringifySchema(u));\n      wrap = _listwrap.union;\n      join = strs.length > 6 || strs.find(s => ~s.indexOf('\\n')) ? ' | ' : '|';\n      if (open) _level--;\n      break;\n    case 'literal':\n      if (typeof schema.literal === 'string') fin = `'${schema.literal.replace(/'/g, '\\\\\\'')}'`;\n      else fin = `${schema.literal}`;\n      break;\n    case 'tuple':\n    case 'tuple[]':\n      if (!t || t.length === 0) {\n        fin = '[]';\n        break;\n      }\n\n      _level++;\n      open = '[', close = `]${~t.indexOf('\\n') ? '[]' : ''}`;\n      join = ', ';\n      strs = ts.map(t => stringifySchema(t));\n      _level--;\n      break;\n    default:\n      fin = schema.ref || t || 'any';\n      if (schema.ref && t === 'array') fin += '[]';\n      break;\n  }\n\n  let defs: string;\n  const level = _noindent ? ' ' : padl('', '  ', _level);\n\n  if (schema.defs) {\n    const keys = Object.keys(schema.defs).sort();\n    defs = keys.map((k, i) => {\n      const def = schema.defs[k];\n      return (def.desc && def.desc.length ? (i === 0 ? '' : `\\n${level}`) + def.desc.map(c => `// ${c}`).join(`\\n${level}`) + `\\n${level}` : '') + `type ${k} = ${stringifySchema(def)}`;\n    }).join(`\\n${level}`);\n  }\n\n  if (!fin) {\n    const l2 = open && !_noindent ? `${level}  ` : level;\n    const nl = _noindent ? '' : '\\n';\n    const lopen = open ? `${open}${nl}${l2}` : '';\n    const lclose = close ? `${nl}${level}${close}` : '';\n    if (wrap === 0) fin = `${lopen}${strs.join(join)}${lclose}`;\n    else if (wrap === 1) fin = `${lopen}${strs.join(`${join}${nl}${l2}`)}${lclose}`;\n    else {\n      let line = '';\n      \n      const last = strs.length - 1;\n      for (let i = 0; i < strs.length; i++) {\n        if (~strs[i].indexOf('\\n')) {\n          line = '';\n          fin += (i === 0 ? '' : '\\n' + l2) + strs[i] + (i !== last ? join : '');\n        } else {\n          fin += strs[i], line += strs[i];\n          if (i !== last) fin += join, line += join;\n        }\n\n        if (line.length > wrap && i !== last && !~(strs[i + 1] || '').indexOf('\\n')) {\n          fin += `${nl}${l2}`;\n          line = '';\n          if (~join.indexOf('|')) fin += '  ';\n        }\n      }\n\n      if (~fin.indexOf('\\n')) fin = `${lopen}${fin}${lclose}`;\n      else fin = `${open}${open === '{' ? ' ' : ''}${fin}${open === '{' && fin.substr(-1) !== ' ' ? ' ' : ''}${close}`;\n    }\n  }\n\n  if (!_nochecks && schema.checks && schema.checks.length) {\n    fin += ` ?${schema.checks.map(c => _stringify(c)).join(' ?')} `;\n  }\n\n  if (defs) fin = `${defs}\\n${level}\\n${level}${fin}`;\n\n  return fin;\n}\n","import { parser as makeParser, map, seq, str, opt } from 'sprunge';\nimport { ws } from 'sprunge/lib/json';\nimport { schema } from '../parse';\n\nexport const parseSchema = makeParser(\n  map(seq(opt(str('@[')), ws, schema(), ws, opt(str(']'))), ([, , schema]) => schema),\n  { trim: true, consumeAll: true },\n);\nexport { stringifySchema as unparseSchema } from './stringify';\n","import { parser as makeParser, opt, str, alt, seq, map, rep1sep, read1 } from 'sprunge/lib';\nimport { digits, ws } from 'sprunge/lib/json';\n\nconst space = ' \\t\\r\\n';\n\nconst num = map(seq(opt(str('-')), read1(digits)), ([neg, num]) => neg ? -num : +num);\nconst num_range = map(seq(num, str('-', ':'), num), ([start,, end]) => [start, end] as [number, number]);\nconst sign_range = map(seq(str('<', '>'), ws, num), ([sign,, num]) => sign === '<' ? [-Infinity, num - 1] as [number, number] : [num + 1, Infinity] as [number, number]);\nconst star_range = map(str('*'), () => [-Infinity, Infinity] as [number, number]);\nconst not_range = map(seq(str('!'), alt<number|[number, number]>(num_range, sign_range, num)), ([, range]) => ({ not: range }));\n\nconst _range = rep1sep(alt<number|[number, number]|{ not: number|[number, number] }>(star_range, num_range, sign_range, num, not_range), read1(space + ',;'), 'allow');\n\nexport const range = makeParser(_range, { trim: true });\n\nexport default range;\n","import { parseDate } from './parse';\nimport { dateRelToDate } from './index';\n\nexport function join(...strs: string[]): string {\n  return strs.filter(s => s).join('.');\n}\n\nexport interface Diff {\n  [path: string]: [any, any];\n}\n\nconst looseEqual = (v1: any, v2: any) => v1 == v2;\nconst strictEqual = (v1: any, v2: any) => v1 === v2;\nconst isNum = /^[\\d.]+$/;\nconst trueStrings = /^(true|on|yes)$/i;\nconst falseStrings = /^(false|off|no)$/i;\nconst sqlEqual = (v1: any, v2: any) => {\n  let tmp1: any, tmp2: any;\n  if ((typeof v1 === 'number' || typeof v1 === 'string' && isNum.test(v1)) && (typeof v2 === 'number' || typeof v2 === 'string' && isNum.test(v2))) {\n    return +v1 === +v2;\n  } else if ((typeof v1 === 'boolean' || typeof v2 === 'boolean') && (typeof v1 === 'string' || typeof v2 === 'string')) {\n    return trueStrings.test(v1) && trueStrings.test(v2) || falseStrings.test(v1) && falseStrings.test(v2);\n  } else if ((v1 instanceof Date || typeof v1 === 'string' && Array.isArray((tmp1 = parseDate(v1) as any)?.f)) && (v2 instanceof Date || typeof v2 === 'string' && Array.isArray((tmp2 = parseDate(v2) as any)?.f))) {\n    if (tmp1) tmp1 = dateRelToDate(tmp1);\n    else tmp1 = v1;\n    if (tmp2) tmp2 = dateRelToDate(tmp2);\n    else tmp2 = v2;\n    return +tmp1 === +tmp2;\n  }\n\n  else return v1 == v2;\n};\n\ntype Identifier = true|string|((v: any) => any);\nexport interface IdentityMap {\n  [path: string]: Identifier;\n}\n\ntype EqualizerValue = 'strict'|'loose'|'sql'|((v1: any, v2: any) => boolean);\ninterface EqualizerOptions {\n  type?: EqualizerValue;\n  /** A map of identity methods to use when comparing elements within an array, making arrays act as a set */\n  identity?: IdentityMap;\n}\ntype Equalizer = EqualizerOptions | EqualizerValue;\n\nconst fullnum = /^\\d+$/;\nfunction checkIdentity(map: IdentityMap, path: string) {\n  const p = path.split('.').reduce((a, c) => fullnum.test(c) ? `${a}[]` : `${a}${a.length ? '.' : ''}${c}`, '');\n  return map[`${p}[]`];\n}\n\nexport function diff(v1: any, v2: any, equal?: Equalizer): Diff {\n  const type = equal && typeof equal === 'object' ? equal.type : equal;\n  const eq = typeof type === 'function' ? type : type === 'strict' ? strictEqual : type === 'sql' ? sqlEqual : looseEqual;\n  return _diff(v1, v2, '', {}, eq, typeof equal === 'object' ? equal.identity : undefined);\n}\n\nfunction _diff(v1: any, v2: any, path: string, diff: Diff, equal: (v1: any, v2: any) => boolean, ident?: IdentityMap): Diff {\n  if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n    if (v1 === v2) return diff;\n    diff[path] = [v1, v2];\n    return diff;\n  }\n\n  let id: Identifier;\n  if (Array.isArray(v1) && Array.isArray(v2) && ident && (id = checkIdentity(ident, path))) {\n    const v1ids = v1.map(v => id === true ? v : typeof id === 'string' ? (v && (typeof v === 'object' || typeof v === 'function') ? v[id] : v) : id(v));\n    const v2ids = v2.map(v => id === true ? v : typeof id === 'string' ? (v && (typeof v === 'object' || typeof v === 'function') ? v[id] : v) : id(v));\n    for (let i = 0; i < v1ids.length; i++) {\n      const idx = v2ids.indexOf(v1ids[i]);\n      if (~idx) {\n        const vv1 = v1[i];\n        const vv2 = v2[idx];\n\n        if (vv1 === vv2) continue;\n        else if (typeof vv1 === 'object' && typeof vv2 === 'object') _diff(vv1, vv2, join(path, `${i}`), diff, equal, ident);\n        else if (!equal(vv1, vv2)) diff[join(path, `${i}`)] = [vv1, vv2];\n      } else diff[join(path, `${i}`)] = [v1[i], undefined];\n    }\n\n    const found = v1ids.slice();\n    for (let i = 0; i < v1ids.length; i++) {\n      if (~found.indexOf(v2ids[i])) continue;\n      diff[join(path, `${i + found.length}`)] = [undefined, v2[i]];\n    }\n  } else {\n    const _v1 = v1 || {};\n    const _v2 = v2 || {};\n    const ks = Object.keys(_v1);\n    for (const k of Object.keys(_v2)) if (!~ks.indexOf(k)) ks.push(k);\n\n    for (const k of ks) {\n      const vv1 = _v1[k];\n      const vv2 = _v2[k];\n\n      if (vv1 === vv2) continue;\n      else if (typeof vv1 === 'object' && typeof vv2 === 'object') _diff(vv1, vv2, join(path, k), diff, equal, ident);\n      else if (!equal(vv1, vv2)) diff[join(path, k)] = [vv1, vv2];\n    }\n  }\n\n  return diff;\n}\n\nexport function deepEqual(v1: any, v2: any, equal?: EqualizerValue): boolean {\n  const eq = typeof equal === 'function' ? equal : equal === 'strict' ? strictEqual : equal === 'sql' ? sqlEqual : looseEqual;\n  return _deepEqual(v1, v2, eq);\n}\n\nfunction _deepEqual(v1: any, v2: any, equal: (v1: any, v2: any) => boolean): boolean {\n  if (typeof v1 !== 'object' || typeof v2 !== 'object') return equal(v1, v2);\n  if ((!v1 || !v2) && v1 != v2) return false; // eslint-ignore-line eqeqeq\n\n  const ks = Object.keys(v1 || {});\n  for (const k of Object.keys(v2 || {})) if (!~ks.indexOf(k)) ks.push(k);\n\n  for (const k of ks) {\n    const vv1 = v1[k];\n    const vv2 = v2[k];\n\n    if (vv1 === vv2) continue;\n    else if (typeof vv1 === 'object' && typeof vv2 === 'object') {\n      if (!_deepEqual(vv1, vv2, equal)) return false;\n    } else if (!equal(vv1, vv2)) return false;\n  }\n\n  return true;\n}\n\nexport interface LabelOptions {\n  /** Omit keys in the original diff that aren't in the label. */\n  omit?: boolean;\n}\n\nexport function labelDiff(diff: Diff, label: any, opts?: LabelOptions): Diff {\n  const out: Diff = opts?.omit ? {} : Object.assign({}, diff);\n  _labelDiff(diff, label, '', '', out, opts);\n  return out;\n}\n\nconst num = /^\\d+/;\nfunction _labelDiff(diff: Diff, label: any, path: string, str: string, out: Diff, opts?: LabelOptions) {\n  for (const k in label) {\n    if (k.slice(-2) === '[]') {\n      const p = `${path}${path && '.'}${k.slice(0, -2)}`;\n      const l = Array.isArray(label[k]) ? label[k] : [label[k]];\n      const all = Object.keys(diff);\n      const nums: string[] = [];\n      for (const k of all) {\n        if (k.indexOf(p) === 0 && num.test(k.substr(p.length + 1))) {\n          const idx = k.indexOf('.', p.length + 1);\n          const num = k.substring(p.length + 1, ~idx ? idx : undefined);\n          if (!~nums.indexOf(num)) nums.push(num)\n        }\n      }\n      const lbl = `${str}${str && ' '}${l[0]}`;\n      for (const num of nums) {\n        const pp = `${p}${p && '.'}${num}`;\n        if (pp in diff) {\n          out[`${lbl}${lbl && ' '}${+num + 1}`] = diff[pp];\n          if (opts?.omit) delete out[pp];\n        }\n        if (l[1]) _labelDiff(diff, l[1], pp, `${lbl}${lbl && ' '}${+num + 1}`, out, opts);\n      }\n    } else {\n      const p = `${path}${path && '.'}${k}`;\n      let l = Array.isArray(label[k]) ? label[k] : [label[k]];\n      const lbl = `${str}${str && ' '}${l[0]}`;\n      if (p in diff) {\n        out[lbl] = diff[p];\n        if (opts?.omit) delete out[p];\n      }\n      if (l[1]) _labelDiff(diff, l[1], p, lbl, out, opts);\n    }\n  }\n}\n","import { Schema, Field, Type, TypeMap } from './index';\nimport { join } from './diff';\nimport { parseSchema, unparseSchema } from './parse/schema';\nimport { evalApply, Root, Context, safeGet, extend, isDateRel } from './index';\n\nconst date = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z$/;\nfunction isDate(v: any) {\n  if (typeof v === 'object') return isDateRel(v);\n  else if (typeof v === 'string' && date.test(v)) return true;\n  return false;\n}\n\nexport function isSchema(what: any): what is Schema {\n  return what && typeof what === 'object' && 'type' in what && typeof what.type === 'string';\n}\n\nexport function inspect(base: any, flat?: boolean): Schema {\n  const root = getType(base);\n  if (Array.isArray(base)) {\n    const fields: Field[] = [];\n    fields.push({ type: 'number', name: 'length' });\n    if (!flat && base.length > 0) {\n      const val = inspect(base[0]);\n      if (val.fields) fields.push({ type: val.type, fields: val.fields, name: '0' });\n      else fields.push({ type: val.type, name: '0' });\n    }\n    return { type: root, fields };\n  } else if (typeof base === 'object' && !isDate(base)) {\n    const fields: Field[] = [];\n    for (const k in base) {\n      fields.push(getField(k, base[k], flat));\n    }\n    return { type: root, fields };\n  }\n  return { type: root };\n}\n\nfunction getField(name: string, v: any, flat?: boolean): Field {\n  const type = getType(v);\n  if (!flat && (~type.indexOf('object') || type === 'array')) {\n    const cs = inspect(v);\n    if (cs.fields) return { type, fields: cs.fields, name };\n    else return { type, name };\n  }\n  return { type: getType(v), name };\n}\n\nfunction getType(v: any): Type {\n  if (typeof v === 'string') {\n    if (isDate(v)) return 'date';\n    else return 'string';\n  }\n  else if (typeof v === 'number') return 'number';\n  else if (typeof v === 'boolean') return 'boolean';\n  else if (Array.isArray(v)) {\n    if (v.length < 1) return 'array';\n    else if (typeof v[0] === 'string') {\n      if (isDate(v[0])) return 'date[]';\n      else return 'string[]';\n    }\n    else if (typeof v[0] === 'number') return 'number[]';\n    else if (typeof v[0] === 'boolean') return 'boolean[]';\n    else if (isDate(v[0])) return 'date[]';\n    else if (typeof v[0] === 'object') return 'object[]';\n    else return 'array';\n  } else if (typeof v === 'object') {\n    if (isDate(v)) return 'date';\n    else return 'object';\n  } else return 'any';\n}\n\nexport type ValidationResult = ValidationError[] | true;\nexport interface ValidationError {\n  error: string;\n  type?: 'strict'|'check'|'missing';\n  path?: string;\n  actual?: string;\n  expected?: string;\n  value?: any;\n}\n\nexport function validate(value: any, schema: Schema|string, mode?: 'strict'|'missing'|'loose'): ValidationResult {\n  if (typeof schema === 'string') {\n    const parsed = parseSchema(schema);\n    if ('message' in parsed) return [{ error: 'invalid schema' }];\n    schema = parsed;\n  }\n\n  if (!schema) schema = { type: 'any' };\n  const ctx = new Root(value, { special: { types: schema.defs || {} } });\n  return _validate(value, schema, mode, '', ctx);\n}\n\nfunction _validate(value: any, schema: Schema, mode: 'strict'|'missing'|'loose', path: string, ctx: Context, required?: boolean): ValidationResult {\n  schema = schema || {};\n  let _schema = schema;\n  const errs: ValidationError[] = [];\n  const miss = mode === 'strict' || mode === 'missing';\n  if (_schema.ref) {\n    let s = _schema;\n    while (s && s.ref) s = safeGet(ctx, `@types.${s.ref}`);\n    if (s) _schema = s;\n    else if (miss) errs.push({ error: `missing type definition '${_schema.ref}'`, type: 'missing' });\n  }\n  let { checks } = _schema;\n  const { type, fields, rest, types, literal } = _schema;\n  if (!checkType(value, schema.type === 'array' ? 'array' : type, literal, required)) return [{ error: `type mismatch for${required ? ' required' : ''} '${type}'`, actual: unparseSchema(inspect(value)), value, path, expected: unparseSchema(_schema, true) }];\n\n  if (_schema !== schema && schema.checks) {\n    if (!checks) checks = schema.checks;\n    else checks = checks.concat(schema.checks);\n  }\n\n  let tmp: ValidationResult;\n\n  if ((type === 'tuple' || type === 'tuple[]') && types) {\n    const arr = ~type.indexOf('[]');\n    const val: any[][] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      if (!Array.isArray(v)) {\n        errs.push({ error: 'expected a tuple', path: p, value: v });\n      } else if (v.length < types.length) {\n        const diff = types.length - v.length;\n        errs.push({ error: `missing ${diff} field${diff > 1 ? 's' : ''} in tuple`, path: p, expected: unparseSchema({ type: 'tuple', types }) });\n      } else {\n        for (let i = 0; i < types.length; i++) {\n          if ((tmp = _validate(v[i], types[i], mode, join(p, `${i}`), extend(ctx, { value: v[i], path: join(p, `${i}`) }))) !== true) errs.push.apply(errs, tmp);\n        }\n\n        if (mode === 'strict' && v.length > types.length) errs.push({ error: `too many values for tuple`, type: 'strict', path: p, expected: unparseSchema({ type: 'tuple', types }) });\n      }\n    }\n  } else if ((type === 'union' || type === 'union[]') && types) {\n    const arr = ~type.indexOf('[]');\n    const val: any[] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      let ok = false;\n      let legit: ValidationError[];\n      for (const u of types) {\n        if ((tmp = _validate(v, u, mode, p, ctx)) === true) {\n          ok = true;\n          break;\n        } else if (miss && tmp.find(e => e.type === 'missing') || tmp.find(e => e.type === 'check')) {\n          legit = tmp.filter(e => miss && e.type === 'missing' || e.type === 'check');\n        } else if (tmp.find(e => e.path !== p))  {\n          legit = tmp;\n        }\n      }\n      if (!ok && !legit) errs.push({ error: `type mismatch for union`, actual: unparseSchema(inspect(v)), expected: unparseSchema({ type: 'union', types }), value: v, path: p });\n      else if (!ok && legit) errs.push.apply(errs, legit);\n    }\n  } else if ((type === 'object' || type === 'object[]' || type === 'any') && fields || rest) {\n    const arr = ~type.indexOf('[]') || schema.type === 'array';\n    const val: object[] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      if (typeof v !== 'object' && typeof v !== 'function') {\n        errs.push({ error: 'expected an object', value: v, path: p, actual: unparseSchema(inspect(v), true) });\n        continue;\n      }\n      if (fields) {\n        for (const f of fields) {\n          if (f.required && !(f.name in v)) errs.push({ error: `requried field ${f.name} is missing`, path: join(p, f.name) });\n          else if (v && f.name in v && (tmp = _validate(v[f.name], f, mode, join(p, f.name), extend(ctx, { value: v[f.name], path: join(p, f.name) }), f.required)) !== true) errs.push.apply(errs, tmp);\n        }\n      }\n      if (rest && v) {\n        for (const k in v) {\n          if (fields && fields.find(f => f.name === k)) continue;\n          if (v[k] != null && (tmp = _validate(v[k], rest, mode, join(p, k), extend(ctx, { value: v[k], path: join(p, k) }))) !== true) errs.push.apply(errs, tmp);\n        }\n      } else if (mode === 'strict' && v) {\n        for (const k in v) if (v[k] != null && !fields || !fields.find(f => f.name === k)) errs.push({ error: `unknown field ${k}`, path: p, type: 'strict', value: v[k] });\n      }\n    }\n  }\n\n  if (!errs.length && checks && checks.length) {\n    let tmp: any;\n    for (let i = 0; i < checks.length; i++) {\n      const c = checks[i];\n      tmp = evalApply(ctx, c, [value]);\n      if (!tmp || typeof tmp == 'string') errs.push({ error: typeof tmp !== 'string' || !tmp ? `check ${i + 1} failed` : tmp, path, value, type: 'check', expected: unparseSchema(schema, true) });\n    }\n  }\n\n  return errs.length ? errs : true;\n}\n\nconst values = ['string', 'number', 'boolean', 'object'];\nexport function checkType(value: any, type?: Type, literal?: any, required?: boolean): boolean {\n  switch (type || 'any') {\n    case 'any':\n    case 'union':\n      return true;\n\n    case 'value': return !Array.isArray(value) && !!~values.indexOf(typeof value) && (typeof value !== 'object' || isDate(value));\n\n    case 'array':\n    case 'tuple':\n    case 'union[]':\n    case 'tuple[]':\n      return Array.isArray(value);\n\n    case 'literal': return value === literal;\n\n    case 'string': return typeof value === 'string';\n    case 'number': return typeof value === 'number';\n    case 'boolean': return typeof value === 'boolean';\n    case 'date': return isDate(value);\n    case 'object': return !Array.isArray(value) && typeof value === 'object' && (!required || value != null);\n    case 'string[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'string', true);\n    case 'number[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'number', true);\n    case 'boolean[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'boolean', true);\n    case 'date[]': return Array.isArray(value) && value.reduce((a, c) => a && isDate(c), true);\n    case 'object[]': return Array.isArray(value) && value.reduce((a, c) => a && !Array.isArray(c) && typeof c === 'object' && (!required || c != null), true);\n  }\n}\n","import { parser, ParseOptions, ParseNode, ParseError, concat, IParser, bracket, readTo, rep1sep, alt, map, repsep, rep, seq, skip, str, verify } from 'sprunge';\n\nexport const DEFAULTS = {\n  record: '\\n',\n  field: ',',\n  header: false,\n  quote: '\"',\n};\n\nexport function csv(options?: CSVOptions) {\n  const opts: typeof DEFAULTS = Object.assign({}, DEFAULTS, options);\n\n  const ws = skip(' \\t\\r\\n'.replace(opts.field, '').replace(opts.record, '').replace(opts.quote, ''));\n  const quote = str(opts.quote || '\"');\n  const quotedField = bracket(seq(ws, quote), map(rep(alt(readTo(opts.quote), map(seq(quote, quote), () => ''))), r => concat(r)), seq(quote, ws));\n  const unquotedField = readTo(opts.record + opts.field, true);\n  const field: IParser<string> = alt(quotedField, unquotedField);\n  const record = verify(rep1sep(field, seq(ws, str(opts.field), ws)), s => s.length > 1 || s[0].length > 0 || 'empty record');\n  const csv: IParser<string[][]> = repsep(record, str(opts.record), 'allow');\n\n  const _parse = parser(csv, { consumeAll: true });\n\n  return function parse(input: string, options?: ParseOptions) {\n    const res: ParseNode|string[][]|ParseError = _parse(input, options);\n    if (Array.isArray(res) && res.length > 0) {\n      if (opts.header) {\n        const header: Array<[string, number]> = res.shift().map((k, i) => [k, i]);\n        header.sort((a, b) => a < b ? -1 : a > b ? 1 : 0);\n        for (let i = 0; i < res.length; i++) {\n          for (let j = 0; j < header.length; j++) (res[i] as any)[header[j][0]] = res[i][header[j][1]];\n        }\n      }\n    }\n\n    return res;\n  }\n}\n\nexport interface CSVOptions {\n  field: string;\n  record: string;\n  quote: string;\n  header?: boolean;\n}\n\nconst fields = [',', '|', '\\t', ':', ';', '~'];\nconst records = ['\\r\\n', '\\r', '\\n'];\nconst quotes = ['\\'', '\"', '`', '$'];\n\nexport function detect(data: string, amount = 2048): CSVOptions {\n  const sample = data.slice(0, amount);\n  const fs = fields.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n  const rs = records.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n  const qs = quotes.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n\n  const res = { field: ',', record: '\\n', quote: '\"' };\n\n  let max = 0;\n  for (const k in fs) if (fs[k] > max) (res.field = k, max = fs[k]);\n  max = 0;\n  for (const k in rs) if (rs[k] > max) (res.record = k, max = rs[k]);\n  max = 0;\n  for (const k in qs) if (qs[k] > max) (res.quote = k, max = qs[k]);\n\n  return res;\n}\n\nexport function parse(data: string, options?: CSVOptions & { header: true }): any[];\nexport function parse(data: string, options?: CSVOptions & { header?: false }): string[][];\nexport function parse(data: string, options?: CSVOptions): Array<string[]|any> {\n  const base = csv(Object.assign({}, options, { header: false }))(data);\n  if ('message' in base) return [];\n  if (options.header && base.length) {\n    const header = base.shift().map((k, i) => [k, i]);\n    header.sort((a, b) => a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0);\n    return base.map(v => header.reduce((a, c) => (a[c[0]] = v[c[1]], a), {} as any));\n  }\n  return base;\n}\n","import { Parser, parser as makeParser, opt, repsep, seq, alt, map, readTo, read1To, rep1, rep, str, read, read1, chars } from 'sprunge';\n\nconst ws = read(' \\r\\n\\t');\nconst endTxt = '&<';\n\nconst entities = { amp: '&', gt: '>', lt: '<' };\nconst entity = map(seq(str('&'), str('amp', 'gt', 'lt'), str(';')), ([,which]) => entities[which] || '', 'entity');\n\nconst name = read1('abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-_:$', 'name');\nconst attr = map(seq(name, opt(seq(ws, str('='), ws, alt(name, quoted('\"'), quoted(\"'\"))))), ([name, rest]) => ({ name, value: rest ? rest[3] : true}), 'attr');\n\nfunction quoted(quote: string) {\n  return map(seq(str(quote), readTo(quote), str(quote)), ([,str]) => str);\n}\n\ninterface Attr {\n  name: string;\n  value: string|boolean;\n}\n\ninterface Open {\n  open: true;\n  name: string;\n  attrs?: Attr[];\n  empty?: boolean;\n}\n\ninterface Close {\n  close: true;\n  name: string;\n}\n\nconst open = map(seq(str('<'), ws, name, ws, repsep(attr, ws, 'allow'), opt(str('/')), str('>')), ([,,name,,attrs,close]) => ({ open: true, name, attrs, empty: !!close } as Open), 'open');\nconst close = map(seq(str('</'), ws, name, ws, str('>')), ([,,name]) => ({ close: true, name } as Close), 'close');\n\nconst content = map(rep1(alt(read1To(endTxt, true), entity), 'content'), txts => txts.join('').trim());\n\nconst stream = rep(alt<string|Open|Close>(open, content, close));\n\nconst _parse = makeParser(stream, { trim: true, consumeAll: true, undefinedOnError: true });\n\nfunction put(target: object, prop: string, value: any) {\n  if (prop in target) {\n    if (Array.isArray(target[prop])) target[prop].push(value);\n    else target[prop] = [target[prop], value];\n  } else {\n    target[prop] = value;\n  }\n}\n\nexport function parse(str: string, strict?: boolean): any {\n  const stack: any[] = [];\n  const names: string[] = [];\n  const res: any[] = [];\n  let content = '';\n  const stream = _parse(str) as Array<string|Open|Close>;\n  if (!stream || 'error' in stream) return undefined;\n\n  function close(end: string) {\n    const val = stack.pop();\n    if (!val) return;\n    const name = names.pop();\n    if (!stack.length) {\n      res.push(val);\n    } else {\n      if (!Object.keys(val).length) put(stack[stack.length - 1], name, content || '');\n      else put(stack[stack.length - 1], name, val);\n    }\n    if (end !== name) close(end);\n  }\n\n  for (const p of stream) {\n    if (typeof p === 'string') {\n      if (p) content += p;\n    } else if ('open' in p) {\n      content = '';\n      const val = p.attrs.reduce((a, c) => (put(a, c.name, c.value), a), {});\n      if (p.empty) {\n        if (stack.length) put(stack[stack.length - 1], p.name, val);\n        else res.push(val);\n      } else {\n        names.push(p.name);\n        stack.push(val);\n      }\n    } else if ('close' in p) {\n      if (strict && p.name !== names[names.length - 1]) return;\n      close(p.name);\n    }\n  }\n\n  if (names.length && !strict) close(names[0]);\n\n  return res.length > 1 ? res : res.length === 1 ? res[0] : undefined;\n}\n","import { filter, safeGet, safeSet, registerOperator, CheckResult, ValueOperator, ValueOrExpr, Context, evaluate, evalApply, evalValue, evalParse, template, extend, formats, virtualFormats, registerFormat, dateRelToRange, dateRelToExactRange, dateRelToDate, isDateRel, isKeypath, isTimespan, isApplication, dateAndTimespan, addTimespan, isValue, datesDiff, DateRel, getOperator, OperatorOptions, sort, toDataSet } from './index';\nimport { date, dollar, ordinal, number, phone } from './format';\nimport { timespans, isTimespanMS, timeSpanToNumber, parseTime, parseDate, parseExpr, parse } from './parse';\nimport { parse as parseTemplate } from './parse/template';\nimport { parseSchema, unparseSchema } from './parse/schema';\nimport { stringify } from './parse/stringify';\nimport { range as parseRange } from './parse/range';\nimport { validate, inspect, isSchema } from './schema';\nimport { diff, deepEqual, labelDiff } from './diff';\nimport { detect as csvDetect, parse as csvParse } from './csv';\nimport { style } from './parse/style';\nimport { parse as parseXML } from './parse/xml';\nimport { measure, escapeHTML } from '../render/index';\n\nfunction simple(names: string[], apply: (name: string, values: any[], opts: OperatorOptions, ctx: Context) => any): ValueOperator {\n  return {\n    type: 'value', names, apply\n  };\n}\n\nconst spanMap = {\n  y: [0, 12],\n  M: [1, 30],\n  d: [2, 24],\n};\n\nconst generateDefaults = {\n  max: 10000,\n};\n\ntype RoundingMethod = 'half-up'|'half-down'|'half-even'|'half-odd'|'to-0'|'from-0';\nconst roundDefaults = {\n  places: 2,\n  'all-numeric': false,\n  method: 'half-even' as RoundingMethod,\n};\nexport function round(amt: string|number, settings?: { places: number; method: RoundingMethod }): string {\n  const place = settings?.places ?? roundDefaults.places;\n  const type = settings?.method ?? roundDefaults.method;\n  if (place > 0) {\n    let str = (+amt || 0).toString();\n    const point = str.indexOf('.');\n    if (!~point) return (+str).toFixed(place);\n    let dec = str.slice(point + 1);\n    if (dec.length <= place) return (+str).toFixed(place);\n    str += '0';\n    dec += '0';\n    const l = +`${str.slice(place - dec.length, place - dec.length + 1)}` || 0;\n    if (+l < 5) return str.slice(0, place - dec.length);\n    else if (+l > 5 || +`${str.slice(1 + place - dec.length)}`) return (+amt).toFixed(place);\n    else {\n      const pre = `${str.slice(0, place - dec.length)}`;\n      const f = +str.slice(place - dec.length - 1, place - dec.length);\n      if (type === 'half-odd') return (+`${pre}${f % 2 === 0 ? 6 : 4}`).toFixed(place);\n      else if (type === 'half-up') return (+`${pre}${+pre > 0 ? 6 : 4}`).toFixed(place);\n      else if (type === 'half-down') return (+`${pre}${+pre > 0 ? 4 : 6}`).toFixed(place);\n      else if (type === 'to-0') return (+`${pre}4`).toFixed(place);\n      else if (type === 'from-0') return (+`${pre}6`).toFixed(place);\n      else return (+`${pre}${f % 2 === 0 ? 4 : 6}`).toFixed(place);\n    }\n  } else if (place === 0) {\n    let str = (+amt || 0).toString();\n    const point = str.indexOf('.');\n    if (!~point) return str;\n    str = `${str}00`;\n    const p = +str.slice(point - 1, point);\n    const n = +str.slice(point + 1, point + 2);\n    if (n < 5) return str.slice(0, point);\n    else if (n > 5 || n === 5 && +str.slice(point + 2)) return (+`${str.slice(0, point - 1)}0` + (p + 1) * (+str < 0 ? -1 : 1)).toString();\n    else {\n      const base = +`${str.slice(0, point - 1)}0`;\n      if (type === 'half-odd') return (base + (p % 2 === 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-up') return (base + (+str > 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-down') return (base + (+str < 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'to-0') return base.toString();\n      else if (type === 'from-0') return (base + 1).toString();\n      else return (base + (p % 2 === 0 ? p : p + 1) * (+str < 0 ? -1 : 1)).toString();\n    }\n  } else {\n    let str = `${+amt < 0 ? Math.floor(+amt || 0) : Math.ceil(+amt || 0)}`;\n    if (0 - place > str.length) return `0`;\n    const n = +str.slice(place, place === -1 ? undefined : place + 1);\n    let p = str.slice(place - 1, place);\n    if (p === '-') p = '';\n    const zeroes = `${Math.pow(10, 0 - place).toString().slice(1)}`\n    if (!p) {\n      const big = `${+str < 0 ? '-' : ''}1${zeroes}`;\n      if (+str > 0 && +str < 5 || +str < 0 && +str > -5) return '0';\n      else if (+str > 0 && +str > 5 || +str < 0 && +str < -5) return big;\n      else {\n        if (type === 'half-odd') return big;\n        else if (type === 'half-up') return +str > 0 ? big : '0';\n        else if (type === 'half-down') return +str > 0 ? '0' : big;\n        else if (type === 'to-0') return '0';\n        else if (type === 'from-0') return big;\n        else return '0';\n      }\n    } else {\n      if (n < 5) return `${str.slice(0, place)}${zeroes}`\n      else if (n > 5 || place < -1 && +`${str.slice(place + 1)}`) return (+`${+str.slice(0, place - 1) || 0}${0}${zeroes}` + +`${+p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n      else {\n        const base = +`${str.slice(0, place - 1) || 0}0${zeroes}`;\n        if (type === 'half-odd') return (base + +`${+p % 2 === 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-up') return (base + +`${+str > 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-down') return (base + +`${+str < 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'to-0') return (base + +`${+p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'from-0') return (base + +`${+p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else return (base + +`${+p % 2 === 0 ? +p : +p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n      }\n    }\n  }\n}\n\nconst hasNum = /^[^\\d]*(\\d+(?:\\.\\d*)?)/;\n\nconst space = /^\\s*$/;\nfunction isNum(v: any): v is number {\n  return !isNaN(v) && !space.test(v);\n}\nfunction num(v: any): number {\n  if (isNaN(v) || !v) return 0;\n  return +v;\n}\n\nfunction equals(l: any, r: any): boolean {\n  if (l === r || l == r) return true; // eslint-disable-line eqeqeq\n  if (isDateRel(l) && isDateRel(r)) return +dateRelToDate(l) === +dateRelToDate(r);\n  if (typeof l === 'number' && typeof r === 'number') return isNaN(l) && isNaN(r);\n  return false;\n}\n\n/**\n * Find a the first overlapping substring that contains threshhold percent characters of the smallest string length.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the percentage of the smaller string length needed to match\n * @returns - the substring that matches\n */\nexport function overlap(a: string, b: string, threshhold: number = 0.5): string {\n  const res = similar(a, b, threshhold, 0);\n  return res && res[1] || undefined;\n}\n\n/**\n * Finds the percentage similarity between two strings based on a minimum threshhold and a fudge factor. The minimum threshhold determins the earliest that the search can return. The fudge factor allows skipping characters in either string, though there is no backtracking.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the required similarity between two substrings, accounting for the fidge factor\n * @param fudges - the number skippable characters in either string without a match\n * @returns - the similarity of the first qualifying match\n */\nexport function similarity(a: string, b: string, threshhold: number = 0.5, fudges: number = 2): number {\n  const res = similar(a, b, threshhold, fudges);\n  return res && res[2] || 0;\n}\n\n/**\n * Finds the similarity between two strings based on a minimum threshhold and a fudge factor. The minimum threshhold determins the earliest that the search can return. The fudge factor allows skipping characters in either string, though there is no backtracking.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the required similarity between two substrings, accounting for the fudge factor\n * @param fudges - the number skippable characters in either string without a match\n * @returns - a tuple of the substrings from each string and the similarity percentage, accounting for the fudge factor\n */\nexport function similar(a: string, b: string, threshhold: number = 0.5, fudges: number = 2): [string, string, number] {\n  if (!a || !b) return;\n  const aa = a.toLowerCase();\n  const bb = b.toLowerCase();\n\n  // check containment\n  if (~aa.indexOf(bb)) bb;\n  if (~bb.indexOf(aa)) aa;\n\n  let i1 = 0;\n  let i2 = 0;\n  let oa = 0;\n  let ob = 0;\n  let f = 0;\n  let f1 = 0;\n  let f2 = 0;\n  let fs = 0;\n  let sim = 0;\n\n  const alen = a.length;\n  const blen = b.length;\n  let aolen = 0;\n  let bolen = 0;\n\n  // walk a\n  for (i1 = 0; i1 < alen; i1++) {\n    // walk b\n    for (i2 = 0; i2 < blen; i2++) {\n      // if there's a match, see how far it goes\n      if (aa[i1] === bb[i2]) {\n        aolen = alen - i1;\n        bolen = blen - i2;\n        fs = 0;\n        // walk the remaining pieces of each string checking for matches\n        matchy: for (oa = 1, ob = 1; oa < aolen && ob < bolen;) {\n          if (aa[i1 + oa] === bb[i2 + ob]) { // nailed it\n            oa++, ob++;\n          } else { // not so much, so compare closer chars in each string, walking outward\n            for (f = 0; f <= fudges; f++) {\n              for (f1 = 0; f1 <= f; f1++) {\n                for (f2 = 0; f2 <= f; f2++) {\n                  if (aa[i1 + oa + f1] === bb[i2 + ob + f2]) {\n                    oa += f1;\n                    ob += f2;\n                    fs += Math.max(f1, f2); // keep track of the fudge factor\n                    continue matchy;\n                  }\n                }\n              }\n            }\n            break matchy; // not even fudge could save it\n          }\n        }\n\n        sim = (Math.max(oa, ob) - fs) / Math.min(aa.length, bb.length); // get approximate similarity\n        if (sim >= threshhold) return [aa.substr(i1, oa), bb.substr(i2, ob), sim]; // and if it exceeds the threshold, we're good\n      }\n    }\n  }\n}\n\nexport function inRange(v: number, range: Array<number|[number, number]|{ not: number|[number, number] }>): boolean {\n  let found = false;\n  let excluded = false;\n  for (const r of range) {\n    if (Array.isArray(r) && v >= r[0] && v <= r[1]) found = true;\n    else if (typeof r === 'object' && 'not' in r) {\n      if (Array.isArray(r.not) && v >= r.not[0] && v <= r.not[1]) excluded = true;\n      else if (v == r.not) excluded = true;\n    } else if (v == r) found = true;\n  }\n  return found && !excluded;\n}\n\n// basic ops\nregisterOperator(\n  simple(['is', 'is-not', '==', '!='], (name: string, values: any[]): boolean => {\n    const [l, r] = values;\n    let cmp = equals(l, r);\n    if (!cmp && (name === 'is' || name === 'is-not') && isSchema(r)) cmp = validate(l, r, 'loose') === true;\n    return name === 'is' || name === '==' ? cmp : !cmp;\n  }),\n  simple(['strict-is', 'strict-is-not'], (name: string, values: any[]): boolean => {\n    const [l, r] = values;\n    let res = l === r;\n    if (!res && isSchema(r)) res = validate(l, r, 'strict') === true;\n    return name === 'strict-is' ? res : !res;\n  }),\n  simple(['deep-is', 'deep-is-not', '===', '!=='], (name: string, [l, r, equal]: any[], opts, ctx: Context): boolean => {\n    equal = equal || opts?.equal;\n    if (equal && isApplication(equal)) {\n      const eq = equal;\n      equal = (l: any, r: any) => evalApply(ctx, eq, [l, r]);\n    }\n    const res = deepEqual(l, r, equal);\n    return name === 'deep-is' || name === '===' ? res : !res;\n  }),\n  simple(['not'], (_name: string, values: any[]) => !values[0]),\n  simple(['<', '>', '<=', '>=', 'gt', 'gte', 'lt', 'lte'], (name: string, values: any[]): boolean => {\n    if (name === 'gt') name = '>';\n    else if (name === 'lt') name = '<';\n    else if (name === 'gte') name = '>=';\n    else if (name === 'lte') name = '<=';\n    let [l, r] = values;\n    if (l instanceof Date || r instanceof Date) {\n      if (typeof l === 'number' || typeof r === 'number') {\n        l = +l; r = +r;\n      } else if (typeof l === 'string' || typeof r === 'string') {\n        l = new Date(l); r = new Date(r);\n      } else if (l && 'f' in l && 'o' in l) {\n        l = dateRelToRange(l)[name[0] === '<' ? 1 : 0];\n        r = new Date(r);\n      } else if (r && 'f' in r && 'o' in r) {\n        r = dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1];\n        l = new Date(l);\n      }\n    } else if (isDateRel(l)) {\n      l = dateRelToRange(l)[name[0] === '<' ? 1 : 0];\n      r = isDateRel(r) ? dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1] : new Date(r);\n    } else if (isDateRel(r)) {\n      r = dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1];\n      l = new Date(l);\n    }\n    return name === '<' ? l < r :\n      name === '>' ? l > r :\n        name === '<=' ? l <= r :\n          name === '>=' ? l >= r :\n            false;\n  }),\n  simple(['like', 'not-like', 'ilike', 'not-ilike'], (name: string, values: any[]): boolean => {\n    const [target, pattern, arg] = values;\n    let res: boolean = false;\n    const patterns = typeof pattern === 'string' ? [pattern] : pattern;\n    const free = arg === 'free' || (typeof arg === 'object' && arg.free);\n    if (!Array.isArray(patterns)) return false;\n    for (let i = 0; i < patterns.length && !res; i++) {\n      const r = patterns[i];\n      if (typeof r !== 'string') continue;\n      const re = new RegExp(`${free ? '' : '^'}${r.replace(/[\\s\\%\\*]+/g, '[\\\\s\\\\S]*').replace(/\\?/g, '.')}${free ? '' : '$'}`, ~name.indexOf('ilike') ? 'i' : '');\n      if (Array.isArray(target)) res = !!target.find(v => re.test(v));\n      else res = re.test(target);\n    }\n    return name === 'like' || name === 'ilike' ? res : !res;\n  }),\n  simple(['in', 'not-in'], (name: string, values: any[], _opts, ctx: Context): boolean => {\n    const [l, r] = values;\n    let range: any;\n    if (isDateRel(r)) {\n      const range = dateRelToRange(r);\n      const d = isDateRel(l) ? dateRelToRange(l)[0] : new Date(l);\n      const n = d >= range[0] && d <= range[1];\n      return name === 'in' ? n : !n;\n    } else if (typeof l === 'string' && typeof r === 'object' && !Array.isArray(r)) {\n      return l in r;\n    } else if (Array.isArray(l) && l.length > 0 && typeof l[0] === 'string' && !Array.isArray(r) && r && typeof r === 'object') {\n      const keys = Object.keys(r);\n      const found = l.reduce((a, c) => a && ~keys.indexOf(c), true);\n      return name === 'in' ? found : !found;\n    } else if (typeof r === 'string' && isNum(l) && (range = _parseRange(ctx, r), Array.isArray(range))) {\n      const found = inRange(+l, range);\n      return name === 'in' ? found : !found;\n    } else if (isApplication(l)) {\n      let found: any = false;\n      if (Array.isArray(r) || r && typeof r === 'object' && '0' in r) found = Array.prototype.find.call(r, (e: any, i: number) => evalApply(ctx, l, [e, i], { index: i, key: i }));\n      else if (r && typeof r === 'object') found = Object.entries(r).find((e, i) => evalApply(ctx, l, [e[1], i, e[0]], { index: i, key: e[0] }));\n      return name === 'in' ? !!found : !found;\n    } else if (!Array.isArray(r) && typeof r !== 'string') {\n      return name === 'in' ? l == r : l != r;\n    } else if (Array.isArray(l) && Array.isArray(r)) {\n      const b = l.reduce((a, c) => a && ~r.indexOf(c), true);\n      return name === 'in' ? !!b : !b;\n    }\n    const res = !!~r.indexOf(l);\n    return name === 'in' ? res : !res;\n  }), \n  simple(['contains', 'does-not-contain'], (name: string, values: any[], _opts, ctx: Context): boolean => {\n    const [l, r] = values;\n    if (isDateRel(l)) {\n      const range = dateRelToRange(l);\n      const d = isDateRel(r) ? dateRelToRange(r)[0] : new Date(r);\n      const n = d >= range[0] && d <= range[1];\n      return name === 'contains' ? n : !n;\n    } else if (isApplication(r)) {\n      let found: any = false;\n      if (Array.isArray(l) || l && typeof l === 'object' && '0' in l) found = Array.prototype.find.call(l, (e: any, i: number) => evalApply(ctx, r, [e, i], { index: i, key: i }));\n      else if (r && typeof l === 'object') found = Object.entries(l).find((e, i) => evalApply(ctx, r, [e[1], i, e[0]], { index: i, key: e[0] }));\n      return name === 'contains' ? !!found : !found;\n    } else if (!Array.isArray(l) && typeof l !== 'string') {\n      return false;\n    } else if (Array.isArray(r) && Array.isArray(l)) {\n      const b = r.reduce((a, c) => a && ~l.indexOf(c), true);\n      return name === 'contains' ? !!b : !b;\n    }\n    const res = !!~l.indexOf(r);\n    return name === 'contains' ? res : !res;\n  }),\n  simple(['clamp'], (_name, [min, v, max]: any[]): any => {\n    return v < min ? min : v > max ? max : v;\n  }),\n  simple(['get'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    const [l, r] = values;\n    const c = extend(ctx, { value: l });\n    if (isKeypath(r)) return safeGet(c, r);\n    else if (typeof r === 'number') return safeGet(c, '' + r);\n    else return evaluate(c, r);\n  }),\n  simple(['generate'], (_name: string, [apply], opts, ctx) => {\n    if (apply && isApplication(apply)) {\n      const res = [];\n      let state = opts;\n      let it: any;\n      for (let i = 0; i < generateDefaults.max; i++) {\n        it = evalApply(ctx, apply, [state, it, i], { index: i, last: it, state });\n        if (Array.isArray(it)) it.forEach(v => res.push(v));\n        else if (it && typeof it === 'object') {\n          const keys = Object.keys(it);\n          if (keys.find(k => k !== 'value' && k !== 'state')) res.push(it);\n          else {\n            res.push(it.value);\n            state = it.state || state;\n            it = it.value;\n          }\n        } else if (it === undefined) break;\n        else res.push(it);\n      }\n      return res;\n    }\n    return [];\n  }),\n  simple(['array'], (_name: string, values: any[], opts) => {\n    if (values.length === 1 && opts?.range) {\n      let range = values[0];\n      if (typeof range === 'string') range = parseRange(range);\n      if (Array.isArray(range)) {\n        const bounds = Array.isArray(opts.bounds) && opts.bounds.length === 2 && opts.bounds.filter(b => typeof b === 'number').length === 2 ? opts.bounds : [-100, 200];\n        bounds.slice().sort((l, r) => l < r ? -1 : l > r ? 1 : 0);\n        let [lower, upper] = bounds;\n        if (upper - lower > 10000) lower = upper - 10000;\n        const res = [];\n        for (let i = lower; i <= upper; i++) if (inRange(i, range)) res.push(i);\n        return res;\n      } else return [];\n    }\n    return values;\n  }),\n  simple(['object'], (_name: string, values: any[]) => {\n    const res: any = {};\n    for (let i = 0; i < values.length; i += 2) {\n      res[values[i]] = values[i + 1];\n    }\n    return res;\n  }),\n  simple(['split'], (_name: string, [str, split]: any[]) => {\n    if (typeof str !== 'string') return [str];\n    else return str.split(split || '');\n  }),\n  simple(['filter'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, flt, sorts, groups] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else if (typeof arr === 'object' && arr) {\n        let step = Object.entries(arr).filter((e, i) => evalApply(ctx, flt, [e[1], i, e[0]], { index: i, key: e[0] }));\n        if (sorts) step = sort(ctx, step, sorts, (c, b, v) => evalApply(c, b, [v[1], v[0]], { key: v[0] }));\n        return step.reduce((a, c) => (a[c[0]] = c[1], a), {});\n      }\n      else return [];\n    }\n    return filter({ value: arr }, flt, sorts, groups, ctx).value;\n  }),\n  simple(['source'], (_name: string, values: any[], _opts, ctx): any => {\n    const [val, app] = values;\n    let source = toDataSet(val);\n    if (isApplication(app)) return evalApply(ctx, app, [], { source });\n    return source;\n  }),\n  simple(['group'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, groups] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else return {};\n    }\n    return filter({ value: arr }, null, null, groups, ctx).value;\n  }),\n  simple(['sort'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, sorts] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else if (arr && typeof arr === 'object') {\n        if (!sorts) sorts = [{ a: { r: { p: '@', k: ['key'] } } }];\n        return sort(ctx, Object.entries(arr), sorts, (c, b, v) => evalApply(c, b, [v[1], v[0]], { key: v[0] })).reduce((a, c) => (a[c[0]] = c[1], a), {});\n      }\n      else return {};\n    }\n    if (!sorts) sorts = [{ a: { r: { k: ['_'] } } }];\n    return sort(ctx, arr.slice(), sorts);\n  }),\n  simple(['time-span', 'time-span-ms'], (_name: string, args: any[], opts: any): any => {\n    const namedArgs = opts || {};\n    const span = isDateRel(args[0]) && isDateRel(args[1]) ? datesDiff(dateRelToDate(args[0]), dateRelToDate(args[1])) : isTimespan(args[0]) ? args[0] : 0;\n\n    // if a unit is specified, break the span up\n    if (namedArgs.unit) {\n      const u = ((Array.isArray(namedArgs.unit) ? namedArgs.unit : [namedArgs.unit]) as string[]).map(u => {\n        if (u[0] === 'y') return 'y'\n        else if (u[0] === 'M' || (u[0] === 'm' && u[1] !== 'i' && u[1] !== 'm')) return 'M';\n        else if (u[0] === 'w') return 'w';\n        else if (u[0] === 'd') return 'd';\n        else if (u[0] === 'h') return 'h';\n        else if (u[0] === 'm' && (!u[1] || u[1] === 'i' || u[1] === 'm')) return 'm';\n        else if (u[0] === 's') return 's'\n        else if (u[0] === 'm' && u[1] === 's') return 'l';\n        return '';\n      }).filter(u => !!u);\n\n      // fraction tracks what would be left for rounding\n      let fraction: number;\n      let res: number[];\n\n      // special case for full spans\n      if (typeof span !== 'number' && !isTimespanMS(span)) {\n        const us = u.join('');\n        if (us === 'd') {\n          if (span.s) {\n            const from = new Date(span.s);\n            from.setHours(0);\n            from.setMinutes(0);\n            from.setSeconds(0);\n            from.setMilliseconds(0);\n            const to = new Date(+from);\n            to.setDate(1);\n            to.setFullYear(to.getFullYear() + span.d[0]);\n            to.setMonth(from.getMonth() + span.d[1]);\n\n            const m = to.getMonth();\n            to.setDate(from.getDate());\n\n            // watch out for last day of month next to longer month\n            const end = new Date(+from);\n            const endM = end.getMonth();\n            end.setDate(end.getDate() + 1);\n            if (endM !== end.getMonth()) {\n              // make sure target date is last day of month\n              to.setMonth(to.getMonth() + 1);\n              to.setDate(0);\n            }\n\n            if (to.getMonth() !== m) to.setDate(0);\n            to.setDate(to.getDate() + span.d[2]);\n            const dist = +to - +from;\n            let d = Math.floor(dist / 86400000);\n            const r = dist % 86400000;\n            if (r >= 82800000) d++;\n            res = [d];\n          } else {\n            // this is an approximation\n            res[0] += span.d[0] * 365;\n            res[0] += span.d[1] * 30;\n          }\n        } else if (u.length < 4 && (us === 'y' || us === 'yM' || us === 'yMd' || us === 'M' || us === 'Md' || us === 'd')) {\n          res = u.map(u => {\n            fraction = span.d[spanMap[u][0] + 1] / spanMap[u][1];\n            return span.d[spanMap[u][0]];\n          });\n          if (u[0] === 'M') res[0] += span.d[0] * 12;\n        }\n      }\n\n      // this isn't special cased, so get a number of ms\n      if (!res) {\n        let ms = typeof span === 'number' || isTimespanMS(span) ? timeSpanToNumber(span) : span && 's' in span ? +dateAndTimespan(new Date(span.s), span, 1) - +new Date(span.s) : (\n          span.d[0] * timespans.y + span.d[1] * timespans.m + span.d[2] * timespans.d +\n          span.d[3] * timespans.h + span.d[4] * timespans.mm + span.d[5] * timespans.s + span.d[6]\n        );\n        res = u.map(() => 0);\n\n        const next = { y: 'm', M: 'w', w: 'd', d: 'h', h: 'mm', m: 's' };\n        const nextDiv = { y: 12, M: 4.3, w: 7, d: 24, h: 60, m: 60 };\n\n        for (let i = 0; i < res.length; i++) {\n          const k = u[i] === 'm' ? 'mm' : u[i] === 'M' ? 'm' : u[i];\n          if (k === 'l') {\n            res[i] = ms;\n            fraction = 0;\n            break;\n          }\n          res[i] = Math.floor(ms / timespans[k]);\n          ms -= res[i] * timespans[k];\n          if (next[u[i]]) fraction = (ms / timespans[next[u[i]]]) / nextDiv[u[i]];\n          else if (u[i] === 's') fraction = ms % 1000;\n        }\n      }\n\n      // check for rounding\n      if (namedArgs.round === true) {\n        if (fraction >= 0.5) res[res.length - 1]++;\n      } else if ((namedArgs.round || '')[0] === 'c') {\n        if (fraction > 0) res[res.length - 1]++;\n        // very special case for months that get rounded to a year\n        if (u[0] === 'y' && u[1] === 'M' && u.length === 2 && res[1] === 12) {\n          res[0]++;\n          res[1] = 0;\n        }\n      }\n\n      // check to see if stringification is needed\n      if (namedArgs.string) {\n        const units = { y: 'year', M: 'month', w: 'week', d: 'day', h: 'hour', m: 'minute', s: 'second', l: 'millisecond' };\n        let str = '';\n        for (let i = 0; i < u.length; i++) {\n          if (!res[i]) continue;\n          str += `${str.length ? ' ' : ''}${res[i]} ${units[u[i]]}${res[i] > 1 ? 's' : ''}`;\n        }\n        return str;\n      } else return Array.isArray(namedArgs.unit) ? res : res[0];\n    } else {\n      if (namedArgs.string) {\n        if (typeof span === 'number' || isTimespanMS(span)) {\n          let ms = timeSpanToNumber(span);\n          let res = '';\n          const order = ['w', 'd', 'h', 'mm', 's'];\n          const units = ['week', 'day', 'hour', 'minute', 'second', 'millisecond'];\n          for (let i = 0; i < order.length; i++) {\n            if (ms > timespans[order[i]]) {\n              const u = Math.floor(ms / timespans[order[i]]);\n              ms -= timespans[order[i]] * u;\n              res += `${res.length ? ' ' : ''}${u} ${units[i]}${u > 1 ? 's' : ''}`;\n            }\n          }\n          if (ms) {\n            res += `${res.length ? ' ' : ''}${ms} millisecond${ms > 1 ? 's' : ''}`;\n          }\n        } else {\n          let res = '';\n          const units = ['year', 'month', 'day', 'hour', 'minute', 'second', 'millisecond'];\n          for (let i = 0; i < span.d.length; i++) {\n            if (span.d[i]) res += `${res.length ? ' ' : ''}${span.d[i]} ${units[i]}${span.d[i] > 1 ? 's' : ''}`;\n          }\n          return res;\n        }\n      } else return span;\n    }\n  }),\n  simple(['string', 'unparse'], (name: string, args: any[], opts: any): string => {\n    const [value] = args;\n    opts = opts || args[1] || {};\n    if (!opts || typeof opts !== 'object') opts = {};\n    if (name === 'unparse') opts = Object.assign({}, opts, { raport: 1 });\n    if (opts.raport && opts.tpl) opts.template = 1;\n    if (!opts && (value === null || value === undefined)) return '';\n\n    if (typeof opts === 'object') {\n      if (opts.json) return JSON.stringify(value);\n      if (opts.schema) return unparseSchema(value);\n      else if (opts.raport) {\n        let v = stringify(value, opts);\n        if (v === undefined) v = stringify({ v: value }, opts);\n        return v;\n      } else if (typeof value === 'string' && opts.styled) return style(value);\n      else if (value == null) return '';\n    }\n\n    if (Array.isArray(value)) return value.join(', ');\n\n    let res = `${value}`;\n    if (res.slice(0, 7) === '[object') return JSON.stringify(value);\n    return res;\n  }),\n  simple(['call'], (_name: string, args: any[], _opts, ctx: Context): any => {\n    if (args[0] != null && typeof args[1] === 'string' && typeof args[0][args[1]] === 'function') {\n      const obj = args.shift();\n      const name = args.shift();\n      return obj[name].apply(obj, args);\n    }\n\n    if (typeof args[0] === 'function') {\n      const fn = args.shift();\n      return fn.apply(null, args);\n    }\n\n    if (isValue(args[0])) {\n      return evalApply(ctx, args[0], args.slice(1));\n    }\n  }),\n  simple(['intersect'], (_name, [left, right]: any[]): any => {\n    if (!Array.isArray(left) || !Array.isArray(right)) return [];\n    const res = [];\n    let el: any;\n    for (let i = 0; i < left.length; i++) {\n      el = left[i];\n      if (~right.indexOf(el) && !~res.indexOf(el)) res.push(el);\n    }\n    for (let i = 0; i < right.length; i++) {\n      el = right[i];\n      if (!~res.indexOf(el) && ~left.indexOf(el)) res.push(el);\n    }\n    return res;\n  }),\n  simple(['let'], (_name, [name, value]: any[], _opts, ctx: Context): any => {\n    return safeSet(ctx, name, value, true);\n  }),\n  simple(['set'], (_name, [name, value]: any[], _opts, ctx: Context): any => {\n    return safeSet(ctx, name, value);\n  }),\n  simple(['similarity'], (_name, [left, right, threshhold, fudges]: any[]): number => {\n    return similarity(`${left || ''}`, `${right || ''}`, threshhold, fudges);\n  }),\n  simple(['similar'], (_name, [left, right, threshhold, fudges]: any[]): any => {\n    return similar(`${left || ''}`, `${right || ''}`, threshhold, fudges);\n  }),\n  simple(['overlap'], (_name, [left, right, threshhold]: any[]): any => {\n    return overlap(`${left || ''}`, `${right || ''}`, threshhold);\n  }),\n  simple(['validate', 'valid'], (name, [left, right, mode], opts) => {\n    const res = validate(left, right, mode || opts?.mode || (opts?.strict && 'strict'));\n    if (name === 'valid') return res === true;\n    else return res;\n  }),\n  simple(['inspect'], (_name, [v, mode], opts) => {\n    if ((mode || opts?.mode) === 'schema') return unparseSchema(inspect(v, opts?.flat));\n    else return inspect(v);\n  }),\n  simple(['diff'], (_, [left, right, equal], opts, ctx: Context) => {\n    equal = equal || opts?.equal;\n    if (equal && isApplication(equal)) {\n      const eq = equal;\n      equal = (l: any, r: any) => evalApply(ctx, eq, [l, r]);\n    }\n    return diff(left, right, equal);\n  }),\n  simple(['label-diff'], (_, [diff, label], opts) => {\n    return labelDiff(diff, label, opts as any);\n  }),\n);\n\n// math\nregisterOperator(\n  simple(['+', 'add'], (_name, values: any[], _opts, ctx): any => {\n    if (values.length === 1) {\n      if (isDateRel(values[0])) return +dateRelToDate(values[0]);\n      else if (!values[0]) return 0;\n      return parseFloat(values[0]);\n    }\n    if (Array.isArray(values[0])) return values[0].concat.apply(values[0], values.slice(1));\n    else if (isDateRel(values[0]) && values.length > 1 && values.slice(1).reduce((a, c) => a && isTimespan(c), true)) return values.slice(1).reduce((a, c) => dateAndTimespan(a, c, 1), dateRelToDate(values[0])); \n    else if (typeof values[0] !== 'number' && values.length > 1 && isTimespan(values[0])) return values.slice(1).reduce((a, c) => addTimespan(a, c), values[0]);\n    else if (values.reduce((a, c) => a && typeof c === 'object' && !isDateRel(c), true)) return Object.assign.apply(Object, [{}].concat(values));\n    const num = values.reduce((a, c) => a && isNum(c), true);\n    if (num) {\n      if (ctx.special?.round) return +values.reduce((a, c) => +round(a + +c, ctx.special.round), 0);\n      else return values.reduce((a, c) => a + +c, 0);\n    } else {\n      return values.reduce((a, c) => a + (c === undefined || c === null ? '' : c), '');\n    }\n  }),\n  simple(['num'], (_name: string, [v]) => {\n    let match: string[];\n    if (match = hasNum.exec(v)) return +match[1];\n    return parseInt(v);\n  }),\n  simple(['-', 'subtract'], (_name, values: any[], _opts, ctx): number => {\n    const first = values.shift();\n    if (!values.length) return -first;\n    if (isDateRel(first)) {\n      if (values.reduce((a, c) => a && isDateRel(c), true)) return values.reduce((a, c) => a - +dateRelToDate(c), +dateRelToDate(first));\n      if (values.reduce((a, c) => a && isTimespan(c), true)) return values.reduce((a, c) => dateAndTimespan(a, c, -1), dateRelToDate(first));\n    }\n    if (ctx.special?.round) return values.reduce((a, c) => +round(a - (!isNum(c) ? 0 : +c), ctx.special.round), !isNum(first) ? 0 : +first);\n    else return values.reduce((a, c) => a - (!isNum(c) ? 0 : +c), !isNum(first) ? 0 : +first);\n  }),\n  simple(['*', 'multiply'], (_name, values: any[], _opts, ctx): number|string|any[] => {\n    const first = values.shift();\n    if (!isNum(first)) {\n      if (values.length === 1 && isNum(values[0]) && +values[0] > 0) {\n        if (typeof first === 'string') {\n          let s = '';\n          for (let i = 0; i < values[0]; i++) s += first;\n          return s;\n        } else if (Array.isArray(first) && +values[0] < 10000 && first.length < 1000) {\n          const res = [];\n          for (let i = 0; i < values[0]; i++) res.push.apply(res, first);\n          return res;\n        }\n      }\n      return 0;\n    }\n    if (ctx.special.round) return values.reduce((a, c) => +round(a * (!isNum(c) ? 0 : +c), ctx.special.round), +first);\n    else return values.reduce((a, c) => a * (!isNum(c) ? 0 : +c), +first);\n  }),\n  simple(['/', '/%', 'divide', 'intdiv'], (name: string, values: any[], _opts, ctx): number => {\n    const first = values.shift();\n    if (isNaN(first)) return 0;\n    if (name.length > 1 || name === 'intdiv') return values.reduce((a, c) => Math.floor(a / (isNaN(c) ? 1 : +c)), +first);\n    if (ctx.special?.round) return values.reduce((a, c) => +round(a / (isNaN(c) ? 1 : +c), ctx.special.round), +first);\n    else return values.reduce((a, c) => a / (isNaN(c) ? 1 : +c), +first);\n  }),\n  simple(['%', 'modulus'], (_name: string, values: any[]): number => {\n    const first = values.shift();\n    return values.reduce((a, c) => a % (isNaN(c) ? 1 : +c), isNaN(first) ? 0 : +first);\n  }),\n  simple(['pow', '**'], (_name, values: any[], _opts, ctx): number => {\n    const pow = values.pop();\n    const first = Math.pow(values.pop(), pow);\n    if (ctx.special?.round) return values.reverse().reduce((a, c) => +round(Math.pow(c, a), ctx.special.round), first);\n    else return values.reverse().reduce((a, c) => Math.pow(c, a), first);\n  }),\n  simple(['abs'], (_name: string, values: any[]) => {\n    if (typeof values[0] !== 'number') return values[0];\n    return Math.abs(values[0]);\n  }),\n  simple(['round'], (_name: string, [num, precision, method]: [number, number, string]): number => {\n    if (precision !== undefined || roundDefaults['all-numeric']) return +round(num, { places: precision, method: method as any });\n    else return Math.round(num);\n  }),\n  simple(['floor'], (_name: string, values: [number]): number => {\n    return Math.floor(values[0]);\n  }),\n  simple(['ceil'], (_name: string, values: [number]): number => {\n    return Math.ceil(values[0]);\n  }),\n  simple(['rand', 'random'], (_name: string, [min, max, dec]: [number, number|boolean, boolean]): number => {\n    let res: number;\n    if (min == null) return Math.random();\n    else if (typeof max !== 'number') res = Math.random() * min;\n    else if (typeof max === 'number') res = Math.random() * (max - min) + min;\n\n    if (max === true || dec === true) return res;\n    else return Math.round(res);\n  }),\n);\n\n// string\nfunction pad(where: 'l'|'c'|'r', str: string, count: number, pad: string): string {\n  if (typeof str !== 'string') str = '' + str;\n  if (!isNum(count)) return str;\n  if (!pad) pad = ' ';\n  if (typeof pad !== 'string') pad = '' + pad;\n  if (pad.length < 1) pad = ' ';\n\n  const ct = (count - str.length) / 2;\n  for (let i = 0; str.length < count; i++) {\n    if (where === 'l') str = pad + str;\n    else if (where === 'r') str = str + pad;\n    else if (i < ct) str = pad + str;\n    else str = str + pad;\n  }\n\n  return str;\n}\nconst triml = /^\\s*/;\nconst trimr = /\\s*$/;\nconst escapeRe = /([\\.\\[\\]\\{\\}\\(\\)\\^\\$\\*\\+\\-])/g;\nregisterOperator(\n  simple(['eval'], (_name: string, [v], opts, ctx: Context): any => {\n    if (opts?.template) return template(opts?.context || ctx, v);\n    else return evaluate(opts?.context || ctx, v);\n  }),\n  simple(['padl', 'padr', 'pad'], (name: string, args: any[]): string => {\n    let [str, count, val] = args;\n    return pad(name === 'padl' ? 'l' : name === 'padr' ? 'r' : 'c', str, count, val);\n  }),\n  simple(['trim', 'triml', 'trimr'], (name: string, args: any[]): string => {\n    let [str] = args;\n    str = '' + str;\n    if (name === 'trim' || name === 'trimr') str = str.replace(trimr, '');\n    if (name === 'trim' || name === 'triml') str = str.replace(triml, '');\n    return str;\n  }),\n  simple(['slice', 'substr'], (_name: string, [src, start, end]: any[], _opts, ctx: Context) => {\n    if (src && typeof src.slice === 'function') return src.slice(start, end);\n    else {\n      const op = getOperator<ValueOperator>('string');\n      if (op) return `${op.apply('string', [src], undefined, ctx)}`.slice(start, end);\n    }\n  }),\n  simple(['len', 'length'], (_name: string, [src]: any[]) => {\n    if (typeof src === 'string' || src && 'length' in src) return src.length;\n    return 0;\n  }),\n  simple(['replace', 'replace-all'], (name: string, [str, find, rep, flags]: any[]) => {\n    str = `${str}`;\n    const re = typeof flags === 'string';\n    if (name === 'replace-all' || re) {\n      return str.replace(new RegExp(re ? find : find.replace(escapeRe, '\\\\$1'), (name === 'replace' || (flags && ~flags.indexOf('g')) ? flags : `${flags || ''}g`) || 'g'), rep);\n    } else {\n      return str.replace(find, rep);\n    }\n  }),\n  simple(['reverse'], (_name: string, [src]): string|any[] => {\n    if (typeof src === 'string') {\n      let r = '';\n      for (let i = 0; i < src.length; i++) r = src[i] + r;\n      return r;\n    } else if (Array.isArray(src)) {\n      return src.slice().reverse();\n    }\n  }),\n  simple(['wrap-count'], (_name: string, [str, width, font], opts, ctx): number => {\n    let w = width || opts?.width;\n    const avail = safeGet(ctx, '@placement.availableX') || 48;\n    if (ctx.special?.widget) {\n      const ww = ctx.special.widget.width;\n      if (ww) {\n        if (ww === 'grow') w = avail;\n        else if (typeof ww === 'number') w = ww;\n        else if (typeof ww === 'object' && typeof ww.percent === 'number') w = (ww.percent / 100) * avail; \n        else if (typeof ww === 'object' && typeof ww.x === 'string') w = evaluate(ctx, ww.x);\n      }\n    }\n    if (!w) w = avail;\n    font = font || opts?.font || safeGet(ctx, '@widget.font');\n    if (opts) {\n      font = Object.assign({}, font);\n      for (const k of ['family', 'size', 'line', 'metric', 'break-word']) if (k in opts) font[k] = opts[k];\n    }\n    return measure(str, w, { context: ctx } as any, font);\n  }),\n  simple(['keys'], (_name: string, [src, proto]): string[] => {\n    if (!src) return [];\n    if (proto) {\n      const res: string[] = [];\n      for (const k in src) res.push(k);\n      return res;\n    } else {\n      return Object.keys(src);\n    }\n  }),\n  simple(['values'], (_name: string, [src]): any[] => {\n    if (!src) return [];\n    return Object.values(src);\n  }),\n  simple(['date'], (_name: string, args: any[], opts, ctx: Context): Date|DateRel => {\n    let [v, t] = args;\n    if (typeof opts !== 'object' || !opts) opts = {} as any;\n\n    let res: Date|DateRel;\n    if (v !== undefined) {\n      if (isDateRel(v)) res = dateRelToDate(v);\n      else if (typeof v === 'string') {\n        let dt = parseDate(v);\n        if (isDateRel(dt)) {\n          res = dt;\n        } else {\n          if (!dt) dt = new Date(v);\n          if (isNaN(dt as any)) {\n            let val = evaluate(ctx, ~v.indexOf('#') ? v : `#${v}#`);\n            if (isDateRel(val)) {\n              if (opts.rel || opts.parse) res = val;\n              else res = dateRelToDate(val);\n            }\n          }\n        }\n      }\n      if (!res) res = new Date(v);\n    }\n    else res = new Date();\n\n\n    if ((opts.rel || opts.parse) && isDateRel(res)) {\n      let rel = dateRelToExactRange(res);\n      if (typeof t === 'string') t = parseTime(t);\n\n      if (Array.isArray(t)) {\n        const f = rel.f;\n        f[3] = t[0], f[4] = t[1], f[5] = t[2], f[6] = t[3];\n        t = t[4];\n      }\n\n      if (typeof t === 'number') {\n        if (opts.shift) {\n          const diff = (+rel.f[7] || 0) - t;\n          const dt = dateRelToDate(rel);\n          dt.setMinutes(dt.getMinutes() - diff);\n          rel = dateRelToExactRange(dt);\n        }\n\n        rel.f[7] = t;\n        res = rel;\n      }\n    } else {\n      const rdt = isDateRel(res) ? dateRelToDate(res) : res as Date;\n      if ('y' in opts && !isNaN(opts.y)) rdt.setFullYear(opts.y);\n      const y = rdt.getFullYear();\n      if ('m' in opts && !isNaN(opts.m)) {\n        rdt.setMonth(+opts.m - 1);\n        if (opts.clamp && rdt.getFullYear() !== y) {\n          rdt.setFullYear(y);\n          rdt.setMonth(11);\n        }\n      }\n      const m = rdt.getMonth();\n      if ('d' in opts && !isNaN(opts.d)) {\n        rdt.setDate(opts.d);\n        if (opts.clamp && (rdt.getMonth() !== m || rdt.getFullYear() !== y)) {\n          rdt.setDate(1);\n          rdt.setFullYear(y);\n          rdt.setMonth(m + 1);\n          rdt.setDate(0);\n        }\n      }\n\n      if (t) {\n        if (res === v) {\n          if (typeof v === 'string') {\n            const dt = parseDate(v);\n            if (dt && isDateRel(dt)) res = dateRelToDate(dt);\n            else res = new Date(v);\n          } else res = new Date(v);\n        }\n\n        if (typeof t === 'string') t = parseTime(t);\n        if (Array.isArray(t)) {\n          rdt.setHours(t[0] || 0, t[1] || 0, t[2] || 0, t[3] || 0);\n          if (t[4] != null) {\n            const offset = -rdt.getTimezoneOffset() - t[4];\n            rdt.setMinutes(rdt.getMinutes() + offset);\n          }\n        } else if (typeof t === 'number') {\n          const offset = -rdt.getTimezoneOffset() - t;\n          rdt.setMinutes(rdt.getMinutes() + offset);\n        }\n      }\n\n      res = rdt;\n    }\n\n    if (res instanceof Date && isNaN(+res)) return undefined;\n    return res;\n  }),\n  simple(['interval'], (_name: string, [v]: any[], _opts, ctx: Context): DateRel => {\n    return evaluate(ctx, ~v.indexOf('#') ? v : `#${v}#`);\n  }),\n  simple(['upper', 'lower'], (name: string, [v]: any[]): string => {\n    v = v == null ? '' : v;\n    return name === 'upper' ? `${v}`.toUpperCase() : `${v}`.toLowerCase();\n  }),\n  simple(['format', 'fmt'], (_name: string, args: any[], opts, ctx): string => {\n    let [v, fmt, ...s] = args;\n    const op = formats[fmt];\n    if (!op) {\n      const op = getOperator(fmt);\n      if (op) {\n        const args = [v, ...s];\n        if (op.type === 'aggregate') return op.apply(fmt, Array.isArray(v) ? v : [v], s.map(v => ({ v })), (opts || virtualFormats[fmt]) as any, ctx);\n        if (op.type === 'checked') {\n          for (let i = 0; i < args.length; i++) {\n            const res = op.checkArg(fmt, i, args.length - 1, args[i], (opts || virtualFormats[fmt]) as any, ctx, { v: args[i] });\n            if (typeof res !== 'object' || !('result' in res)) continue;\n            else return res.result;\n          }\n          return op.apply(fmt, args, (opts || virtualFormats[fmt]) as any, ctx);\n        }\n        return op.apply(fmt, args, (opts || virtualFormats[fmt]) as any, ctx);\n      } else return `${v}`;\n    } else return op.apply(v, s, (opts || op.defaults) as any);\n  }),\n  simple(['set-defaults'], (_name: string, [type, name]: any[], opts, ctx) => {\n    if (type === 'format' && typeof name === 'string') {\n      const fmt = formats[name];\n      if (fmt) return Object.assign(fmt.defaults, opts);\n      const vfmt = virtualFormats[name];\n      if (vfmt) return Object.assign(vfmt.defaults, opts);\n    } else if (type === 'round') {\n      if (opts?.context) {\n        if (opts?.unset) {\n          if (ctx.special) delete ctx.special.round;\n        } else (ctx.special || (ctx.special = {})).round = Object.assign({}, opts, { context: undefined });\n      } else Object.assign(roundDefaults, opts);\n    } else if (type === 'generate') {\n      Object.assign(generateDefaults, opts);\n    }\n  }),\n  simple(['parse'], (_name: string, args: any[], opts: any): any => {\n    opts = opts || args[1] || {};\n    if (!opts || typeof opts !== 'object') opts = {};\n    const [v] = args;\n\n    if (opts.date) return parseDate(v, opts);\n    else if (opts.template || opts.tpl) return parseTemplate(v, opts);\n    else if (opts.time) return parseTime(v, opts);\n    else if (opts.expr) return parseExpr(v, opts);\n    else if (opts.schema) return parseSchema(v);\n    else if (opts.range) return parseRange(v, opts);\n    else if (opts.xml) return parseXML(v, opts.strict);\n    else if (opts.csv) {\n      if (opts.detect) opts = Object.assign(csvDetect(v), opts);\n      return csvParse(v, opts);\n    } else if (opts.base64) return atob(v);\n    else return parse(v, opts);\n  }),\n  simple(['detect-delimiters'], (_name: string, [data]: any[]) => {\n    if (typeof data !== 'string') return {};\n    return csvDetect(data);\n  }),\n);\n\n// short circuiting\nregisterOperator({\n  type: 'checked',\n  names: ['and', '&&'],\n  checkArg(_name: string, _i: number, _total: number, value: any): CheckResult {\n    if (value) return 'continue';\n    else return { result: value };\n  },\n  apply(_name: string, args: any[]): boolean {\n    return args[args.length - 1]; // passed the check, all is well\n  },\n}, {\n  type: 'checked',\n  names: ['or', '||', '??'],\n  checkArg(name: string, _i: number, _total: number, value: any): CheckResult {\n    if (name === '??' ? value != null : value) return { result: value };\n    else return 'continue';\n  },\n  apply(name: string): boolean {\n    return name === '??' ? undefined : false; // if we made it this far, none were true\n  },\n}, {\n  type: 'checked',\n  names: ['if', 'unless'],\n  checkArg(name: string, i: number, last: number, value: any): CheckResult {\n    if (i % 2 === 0) {\n      if (i === last) return { result: value }; // else case\n      else if (name === 'if' ? !value : value) return { skip: 1 }; // non-matching branch, skip next\n      else return 'continue'; // matching, carry on to next\n    }\n    else return { result: value }; // odd branch that wasn't skipped means previous condition matched\n  },\n  apply() {}\n}, {\n  type: 'checked',\n  names: ['case', 'switch'],\n  checkArg(_name: string, i: number, last: number, value: any, _opts, ctx: Context, ast): CheckResult {\n    if (i === 0) { // set the value and move to the next\n      (ctx.special || (ctx.special = {})).case = value;\n      return 'continue';\n    } else if (i % 2 === 1) {\n      if (i === last) return { result: value }; // default case\n      if (equals(value, ctx.special.case)) return 'continue';\n      if (isValue(ast) && 'op' in ast && value === true) return 'continue'; // operators can also check for true\n      if (isValue(value)) {\n        const v = evalValue(ctx, value);\n        if (equals(v, ctx.special.case)) return 'continue';\n        if (v === true) return 'continue';\n      }\n      return { skip: 1 };\n    } else return { result: value }; // odd branch\n  },\n  apply() {},\n  extend: true,\n}, {\n  type: 'checked',\n  names: ['each'],\n  checkArg(_name: string, i: number, last: number, value: any): CheckResult {\n    if (i === 0) {\n      if (Array.isArray(value) && value.length || value && typeof value === 'object' && Object.keys(value).length) return 'continue';\n      else return { skip: 1 };\n    } else if (i === 1) return { skip: last - i, value };\n    else if (i === last) return { result: value };\n    else if (i % 2 === 0) { // condition\n      if (value) return 'continue';\n      else return { skip: 1 };\n    } else return { result: value };\n  },\n  apply(_name: string, [value, body]: [any[]|object, ValueOrExpr], opts, ctx: Context) {\n    if (Array.isArray(value)) {\n      const last = value.length - 1;\n      return value.map((v, i) => evalApply(extend(ctx, { value: v, special: { last, index: i, key: i, 'last-key': last } }), body, [v, i])).join(opts?.join || '');\n    } else if (typeof value === 'object' && value) {\n      const entries = Object.entries(value);\n      const lastKey = entries[entries.length - 1][0];\n      const last = entries.length - 1;\n      return Object.entries(value).map(([k, v], i) => evalApply(extend(ctx, { value: v, special: { last, 'last-key': lastKey, index: i, key: k } }), body, [v, k])).join('');\n    } else {\n      return '';\n    }\n  }\n}, {\n  type: 'checked',\n  names: ['with'],\n  checkArg(_name: string, i: number, last: number, value: any): CheckResult {\n    if (i === 0 && value && typeof value === 'object') return 'continue';\n    else if (i === 1) return { skip: last - i, value };\n    else if (i === last) return { result: value };\n    else if (i % 2 === 0) {\n      if (value) return 'continue';\n      else return { skip: 1 };\n    } else return { result: value };\n  },\n  apply(_name: string, [value, body]: [any, ValueOrExpr], _opts, ctx: Context) {\n    return evalApply(extend(ctx, { value }), body, [value]);\n  }\n}, {\n  type: 'checked',\n  names: ['coalesce', 'coalesce-truth'],\n  checkArg(name: string, _i: number, _last: number, value: any): CheckResult {\n    if (name === 'coalesce' && value !== undefined && value !== null) return { result: value };\n    else if (value) return { result: value };\n    else return 'continue';\n  },\n  apply() {}\n});\n\n// aggregates\nregisterOperator({\n  type: 'aggregate',\n  names: ['avg'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (ctx.special?.round) return +round(arr.reduce((a, c) => +round(a + num(args[0] ? evalApply(ctx, args[0], [c]) : c)), 0) / arr.length)\n    else return arr.reduce((a, c) => a + num(args[0] ? evalApply(ctx, args[0], [c]) : c), 0) / arr.length;\n  },\n}, {\n  type: 'aggregate',\n  names: ['sum'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (ctx.special?.round) return arr.reduce((a, c) => +round(a + num(args[0] ? evalApply(ctx, args[0], [c]) : c)), 0);\n    else return arr.reduce((a, c) => a + num(args[0] ? evalApply(ctx, args[0], [c]) : c), 0);\n  }\n}, {\n  type: 'aggregate',\n  names: ['count'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (args.length) return arr.filter((e, i) => evalApply(ctx, args[0], [e, i])).length;\n    else return arr.length;\n  }\n}, {\n  type: 'aggregate',\n  names: ['min', 'max'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (isApplication(args[0])) arr = arr.map(e => evalApply(ctx, args[0], [e]));\n    else if (args.length && !arr.length) arr = args.map(a => evalParse(ctx, a));\n    if (!arr.length) return 0;\n    return Math[name].apply(Math, arr.filter(e => !isNaN(e)));\n  }\n}, {\n  type: 'aggregate',\n  names: ['first', 'nth', 'last'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    let val: any;\n    let apply = 0;\n    if (name === 'first') val = arr[0];\n    else if (name === 'last') val = arr[arr.length - 1];\n    else if (args[0]) {\n      const i = evalParse(ctx, args[0]);\n      if (typeof i === 'number') {\n        val = i < 0 ? arr[arr.length + i] : arr[i - 1];\n        apply = 1;\n      }\n    }\n    if (args[apply]) val = evalParse(ctx, args[apply]);\n    return val;\n  }\n}, {\n  type: 'aggregate',\n  names: ['map'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (!args[0]) return arr;\n    let v: any[];\n    let app: any;\n    if (isApplication(args[0])) v = arr, app = evalParse(ctx, args[0]);\n    else if (isApplication(args[1])) v = evalParse(ctx, args[0]), app = evalParse(ctx, args[1]);\n    if ((Array.isArray(v) || v && '0' in v) && isApplication(app)) {\n      const res = Array.prototype.map.call(v, (e: any, i: number) => evalApply(ctx, app, [e, i], { index: i, key: i }));\n      if (opts && opts.flat) return flatten(res, opts.flat);\n      return res;\n    }\n    else if (v && typeof v === 'object' && isApplication(app)) {\n      if (opts && opts.array) {\n        const res = Object.entries(v as object).map((p, i) => evalApply(ctx, app, [p[1], i, p[0]], { index: i, key: p[0] }));\n        if (opts && opts.flat) return flatten(res, opts.flat);\n        return res;\n      }\n      if (opts && opts.entries) return Object.entries(v as object).reduce((a, p, i) => {\n        const r = evalApply(ctx, app, [p[1], i, p[0]], { index: i, key: p[0] });\n        if (r === null) return a;\n        if (Array.isArray(r) && r.length === 2 && typeof r[0] === 'string') a.push(r);\n        else a.push([p[0], r]);\n        return a;\n      }, [] as any[]);\n      const res: any = {};\n      Object.entries(v as object).forEach((e, i) => {\n        const r = evalApply(ctx, app, [e[1], i, e[0]], { index: i, key: e[0] });\n        if (Array.isArray(r) && r.length === 2 && typeof r[0] === 'string') res[r[0]] = r[1];\n        else if (r == null) return;\n        else res[e[0]] = r;\n      });\n      return res;\n    }\n  }\n}, {\n  type: 'aggregate',\n  names: ['index'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (!args[0]) return {};\n    const many = opts && opts.many;\n    return arr.reduce((a, c, i) => _indexPair(a, evalApply(ctx, args[0], [c, i], { index: i, all: a }), c, many), {});\n  },\n}, {\n  type: 'aggregate',\n  names: ['reduce'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (!args[0]) return arr;\n    return arr.reduce((a, c, i) => evalApply(ctx, args[0], [a, c, i]), evalParse(ctx, args[1]));\n  }\n}, {\n  type: 'aggregate',\n  names: ['unique', 'unique-map'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    const seen = [];\n    const res = [];\n    for (const e of arr) {\n      const f = args[0] ? evalApply(ctx, args[0], [e]) : e;\n      if (!~seen.indexOf(f)) {\n        seen.push(f);\n        res.push(e);\n      }\n    }\n    return name === 'unique' ? res : seen;\n  }\n}, {\n  type: 'aggregate',\n  names: ['join'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (isApplication(args[0])) {\n      arr = arr.map(e => evalApply(ctx, args[0], [e]));\n      args = args.slice(1);\n    }\n    if (args.length > 1 && arr.length > 2) return [arr.slice(0, -1).join(evalParse(ctx, args[0])), arr[arr.length - 1]].join(evalParse(ctx, args[1]));\n    else if (args.length > 2 && arr.length === 2) return arr.join(evalParse(ctx, args[2]));\n    return arr.join(evalParse(ctx, args[0]));\n  }\n}, {\n  type: 'aggregate',\n  names: ['find'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (!args[0]) return;\n    else if (isApplication(args[0])) return arr.find((e, i) => evalApply(ctx, args[0], [e, i], { index: i, key: i }));\n    else if (isApplication(args[1])) {\n      const v = evalParse(ctx, args[0]);\n      if (Array.isArray(v)) return v.find((e, i) => evalApply(ctx, args[1], [e, i], { index: i, key: i }));\n      else if (typeof v === 'object' && v) {\n        const e = Object.entries(v).find((e, i) => evalApply(ctx, args[1], [e[1], i, e[0]], { index: i, key: e[0] }));\n        if (e) return e[1];\n      }\n    } else {\n      const v = evalParse(ctx, args[0]);\n      return arr.find(e => e == v);\n    }\n  }\n}, {\n  type: 'aggregate',\n  names: ['flatten'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx) {\n    return flatten(arr, (args.length > 0 ? evalParse(ctx, args[0]) : 0) || opts?.flat);\n  }\n}, {\n  type: 'aggregate',\n  names: ['block'],\n  apply(_name: string, _arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    const last = args.length - 1;\n    if (last < 0) return;\n    const c = extend(ctx, { locals: opts && opts.implicit ? ctx.locals || {} : {}, fork: !ctx.locals });\n    for (let i = 0; i < last; i++) evalParse(c, args[i]);\n    const res = evalParse(c, args[last]);\n    if (opts && opts.implicit) ctx.locals = c.locals;\n    return res;\n  },\n  value: true,\n});\n\nfunction flatten(n: any[], levels: any = 1): any[] {\n  let res = n || [];\n  const count = typeof levels !== 'number' ? 1 : levels;\n  for (let i = 0; i < count; i++) {\n    if (res.find(v => Array.isArray(v))) res = [].concat(...res);\n    else return res;\n  }\n  return res;\n}\n\nfunction fmtDate(n: any, fmt: string): string {\n  if (typeof n === 'string') {\n    const d = parseDate(n);\n    if (d) n = d;\n  }\n  return date(isDateRel(n) ? dateRelToExactRange(n) : n, fmt);\n}\n\nfunction _parseRange(ctx: Context, range: string) {\n  const map = (ctx.root as any)._ranges || ((ctx.root as any)._ranges = {})\n  if (range in map) return map[range];\n  return (map[range] = parseRange(range));\n}\n\nfunction _indexPair(res: any, value: any, current: any, many: boolean): any {\n  if (Array.isArray(value)) {\n    if (value.length === 0) return res;\n    else if (value.length === 2) {\n      const [k, v] = value;\n      if (Array.isArray(k)) {\n        for (const kk of k) {\n          if (many) {\n            if (kk in res) res[kk].push(v)\n            else res[kk] = [v];\n          } else res[kk] = v;\n        }\n      } else {\n        if (many) {\n          if (k in res) res[k].push(v);\n          else res[k] = [v];\n        } else res[k] = v;\n      }\n    }\n  } else if (typeof value === 'object') {\n    const v = value as any;\n    if ('many' in v && Array.isArray(v.many)) for (const i of v.many) _indexPair(res, i, current, many);\n    else if ('key' in v || 'keys' in v) _indexPair(res, [v.key || v.keys, v.value || current], current, many);\n  } else {\n    if (many) {\n      if (value in res) res[value].push(current);\n      else res[value] = [current];\n    } else res[value] = current;\n  }\n  return res;\n}\n\n// basic formats\nregisterFormat('dollar', function(n, [dec, group, sign, neg], opts) {\n  return dollar(n, undefined, dec ?? opts?.dec ?? this.defaults.dec, group ?? opts?.group ?? this.defaults.group, sign ?? opts?.sign ?? this.defaults.sign, neg ?? opts?.neg ?? this.defaults.neg);\n}, { dec: 2, group: ',', sign: '$', neg: 'sign' });\n\nregisterFormat('date', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd' });\n\nregisterFormat('time', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'HH:mm:ss' });\n\nregisterFormat('timestamp', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd HH:mm:ss' });\n\nregisterFormat('timestamptz', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd HH:mm:sszzz' });\n\nregisterFormat('iso8601', n => {\n  return fmtDate(n, 'yyyy-MM-ddTHH:mm:sszzz');\n});\n\nregisterFormat(['integer', 'int'], function(n, [group, neg], opts) {\n  return number(n, 0, group ?? opts?.group ?? this.defaults.group, neg ?? opts?.neg ?? this.defaults.neg);\n}, { group: ',', neg: 'sign' });\n\nregisterFormat(['number', 'num'], function(n, [dec, group, neg], opts) {\n  return number(n, dec ?? opts?.dec ?? this.defaults.dev, group ?? opts?.group ?? this.defaults.group, neg ?? opts?.neg ?? this.defaults.neg);\n}, { dec: 2, group: ',', neg: 'sign' });\n\nregisterFormat('ordinal', function(n, [group], opts) {\n  return ordinal(n, group ?? opts?.group ?? this.defaults.group);\n}, { group: ',' });\n\nregisterFormat('phone', n => {\n  return phone(n);\n});\n\nregisterFormat('styled', n => {\n  return style(n);\n});\n\n{\n  const space = /\\s+/g;\n  const br = /[\\s;,.:\"]\\w/g;\n  const alphaNum = /[^a-zA-Z0-9]+([a-zA-Z0-9])/g;\n  const alphaNumSpace = /[^\\sa-zA-Z0-9]/g;\n  const camelBreak = /([a-z])([A-Z])/g;\n  const spaceChar = /\\s([^\\s])/g;\n  function normalize(s: string) {\n    return s.replace(alphaNum, (_m, c) => c ? ` ${c}` : '').replace(alphaNumSpace, '').replace(camelBreak, (_m, c1, c2) => `${c1} ${c2}`).trim();\n  }\n  registerFormat('case', (n, whiches) => {\n    let str = `${n || ''}`.trim();\n    for (const which of whiches) {\n      if (which === 'upper' || which === 'up') str = str.toUpperCase();\n      else if (which === 'lower' || which === 'down') str = str.toLowerCase();\n      else if (which === 'snake') str = normalize(str).toLowerCase().replace(space, '_');\n      else if (which === 'kebab') str = normalize(str).toLowerCase().replace(space, '-');\n      else if (which === 'pascal') {\n        const s = normalize(str);\n        str = s[0].toUpperCase() + s.toLowerCase().substr(1).replace(spaceChar, (_m, c) => (c || '').toUpperCase());\n      } else if (which === 'camel') {\n        const s = normalize(str);\n        str = s[0].toLowerCase() + s.toLowerCase().substr(1).replace(spaceChar, (_m, c) => (c || '').toUpperCase());\n      } else if (which === 'proper') {\n        if (/[a-z]/.test(str)) str = str.trim().replace(br, m => m.toUpperCase());\n        else str = str.toLowerCase().trim().replace(br, m => m.toUpperCase());\n        str = (str[0] || '').toUpperCase() + str.substr(1);\n      }\n    }\n    return str;\n  });\n}\n\nregisterFormat('hex', val => {\n  if (typeof val === 'number') return val.toString(16);\n  else {\n    const str = `${val}`;\n    const te = new TextEncoder();\n    return Array.from(te.encode(str)).map(c => c.toString(16).padStart(2, '0')).join('');\n  }\n});\n\nregisterFormat('base', (val, [n]) => {\n  try {\n    return val.toString(n);\n  } catch {\n    return val;\n  }\n});\n\nregisterFormat('noxml', val => escapeHTML(`${val}`));\n\nregisterFormat('xml', (val, [n]) => {\n  if (val && typeof val === 'object') return objectToXML(val, n);\n  else return val;\n});\n\nfunction objectToXML(object: object, indent: number|undefined = undefined) {\n  if (Array.isArray(object)) return _objectToXML({ values: { value: object } }, 0, indent);\n  const keys = Object.keys(object);\n  if (keys.length > 1) return _objectToXML({ root: object }, 0, indent);\n  if (keys.length < 1) return '<root />';\n  if (Array.isArray(object[keys[0]])) return _objectToXML({ root: object }, 0, indent);\n  return _objectToXML(object, 0, indent);\n}\n\nfunction _objectToXML(val: any, depth: number, indent: number|undefined, propname: string|undefined = undefined) {\n  if (Array.isArray(val)) {\n    return val.reduce((xml, entry) => {\n      const val = _objectToXML(entry, depth + 1, indent, propname);\n      const tag = val === '' || val === undefined ? `<${propname} />` : `<${propname}>${val}${indent && /\\n/.test(val) ? '\\n' + pad('l', '', depth * indent, ' ') : ''}</${propname}>`;\n      return `${xml}${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}${tag}`;\n    }, '');\n  }\n  if (val && typeof val === 'object') {\n    return Object.entries(val).reduce((xml, [name, value]) => {\n      const val = _objectToXML(value, depth + (Array.isArray(value) ? 0 : 1), indent, name);\n      const tag = val === '' ? `${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}<${name} />` : Array.isArray(value) ? val : `${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}<${name}>${val}${indent && /\\n/.test(val) ? '\\n' + pad('l', '', depth * indent, ' ') : ''}</${name}>`;\n      return `${xml}${tag}`;\n    }, '');\n  }\n  return escapeHTML(val);\n}\n\nregisterFormat('base64', val => {\n  return btoa(`${val}`);\n});\n"],"names":["Fail","detailedFail","_cause","_latestCause","getCause","getCauseCopy","name","suggestCauseName","undefined","slice","fail","pos","message","cause","causes","isNodeName","v","openNode","start","end","children","closeNode","node","parent","res","_compact","result","primary","c","length","push","reduce","last","i","extra","l","apply","getLineNum","input","n","lastIndexOf","getParseError","context","lines","first","t","unshift","substring","markerOffset","indexOf","source","marker","len","column","line","position","marked","join","map","parser","findLatestCause","startSpace","shared","error","mps","oerror","det","detailed","consume","consumeAll","trim","exec","seq","skip","a","d","tree","compact","unwrap","parse","undefinedOnError","ctx","contextLines","err","getLatestCause","latest","throw","ex","Error","Object","assign","uninit","_s","p","lazy","init","s","r","concat","strings","outer","f","max","cs","contains0","contains1","str","x","contains2","contains3","contains4","contains5","contains6","contains7","contains8","contains9","contains10","containsFor","containsBinary","mid","getSearch","sorted","charList","chars","split","sort","seekWhileChar","contains","read","read1","JSON","stringify","count","allowed","search","substr","readTo","stop","skipped","seekUntilChar","read1To","op","resin","j","nlen","istr","copy","toLowerCase","toUpperCase","idx","opt","ps","not","alt","parsers","nm","lps","fails","overrideCauseName","verify","fn","e","cur","rep","empty","rep1","repsep","sep","trail","ps1","ps2","rr","m","rep1sep","bracket","content","right","Array","isArray","ends","ps3","r1","r2","r3","addCause","check","_hex","digits","identStart","hex","escmap","b","underscores","JNum","replace","JStringEscape","disallowed","notchars","JStringUnicode","String","fromCharCode","parseInt","JStringHex","JString","JBool","JNull","JIdentifier","ws","JArray","JObject","JValue","JKeyPair","pairs","pair","timespans","y","w","h","mm","isTimespanMS","ms","timeSpanToNumber","Math","floor","space","endSym","endRef","_comment","comment","prop","rws","skip1","keywords","ident","sexprop","args","array","block","object","value","values","application","pathesc","char","pathident","parts","dotpath","part","bracketpath","keypath","prefix","k","u","localpath","parsePath","makeParser","parseLetPath","illegalRefs","ref","includes","stringInterp","timespan","span","timezone","timeexact","parseTime","tm","z","dateend","daterel","o","tz","val","setIndex","index","dateexact","time","date","typelit","schema","parseDate","string","literal","Date","sexp","opts","bracket_op","binop","if_op","case_op","opName","call_op","operand","fmt","fmt_op","postfix_path","unop","arg","leftassoc","left","binop_e","arg1","more","pop","reverse","rightassoc","binop_md","binop_as","binop_cmp","binop_eq","binop_and","binop_or","replaceCase","found","cond1","block1","elifs","el","cond","val1","hit","miss","case_branch","branches","operation","objectOp","filter","namedArg","names","plain","obj","letter","setter","parseBlock","implicit","parseExpr","namespace","type","conditions","typedef","typedefs","defs","desc","arr","key","required","rest","keys","rests","fields","tuple","types","maybe_union","list","checks","union_array","union","root","txtEsc","text","np","andNot","txts","tag_value","tag_end","branch","min_one","else_tag","branch_tag","each_op","tag","apply_first","cond_branches","with_op","unless_op","interpolator","hasTag","_parse","toDataSet","safeGet","path","parameters","sources","which","special","pipe","lctx","locals","evalValue","safeSet","islet","next","evaluate","isValueOrExpr","Root","isContext","evalParse","template","extend","parseTemplate","evalApply","isApplication","fork","expr","ns","cache","exprs","opMap","local","isOperation","find","isReference","hasPipeRef","flts","checkArg","shift","src","applyOperator","isDateRel","isTimespan","registerOperator","ops","getOperator","_defaultGetValue","sorts","getValue","sortArr","by","dirs","lower","dir","cmp","ds","groups","_ds","_context","flt","forEach","row","grouped","level","group","all","order","g","getKeypath","isValue","constructor","this","formats","virtualFormats","registerFormat","format","defaults","dateRelToRange","rel","from","to","setUTCFullYear","getFullYear","getMonth","getDate","setUTCHours","dateAndTimespan","setUTCDate","getUTCDate","getUTCDay","setDate","setUTCMonth","getUTCMonth","getUTCFullYear","UTC","setUTCMilliseconds","getUTCMilliseconds","setUTCMinutes","getUTCMinutes","offset","getTimezoneOffset","dateRelToDate","range","dateRelToExactRange","dt","setMinutes","getMinutes","getHours","getSeconds","getMilliseconds","setFullYear","dd","setMonth","setHours","setSeconds","setMilliseconds","addStyle","id","style","styles","placement","output","height","isComputed","maybeComputed","report","extendContext","styleMap","commit","htmlChars","htmlReplace","escapeHTML","html","renderers","registerRenderer","renderer","options","render","avgs","measure","width","font","family","size","brw","avg","metric","test","word","wlen","renderWidget","state","hide","widget","container","getHeightWithMargin","maxY","isNaN","availableY","continue","cancel","extraHeight","margin","expandMargin","border","box","expandBorder","getWidthWithMargin","toFixed","layouts","registerLayout","layout","getWidth","pct","availableX","maxX","percent","getHeight","computed","linesize","maxFontSize","NaN","maxYOffset","points","maxXOffset","top","bottom","expandMacro","macro","props","properties","widgets","mapStyle","mapped","ids","nextStyleId","styleClass","cls","inline","inlineStyle","classPrefix","classifyStyles","offsetX","offsetY","computedHeight","lineSize","styleFont","styleBorder","styleExtra","bg","radius","color","align","weight","pre","clamp","br","initParameters","defaultParams","inits","applySources","srcs","base","zwsp","sp","integer","number","remOrPercent","places","valign","pad","fg","rotate","turn","origin","move","trash","bools","tags","blocks","aliases","parsed","stuff","open","bool","blockstack","drop","frame","getStyle","process","flexAlign","middle","borderStyle","dot","dash","bs","underline","overline","strike","sup","sub","italic","bold","vs","transforms","vv","onCommit","commitContext","sval","styled","styleText","wctx","extendData","cw","yo","lp","child","attempt","renderWidgets","bridge","groupNo","newPage","header","hctx","current","groupHeaders","headerPerPage","rctx","elide","usedX","usedY","initY","alternate","footer","fctx","groupEnds","fit","url","styleImage","decRE","intRE","isNumRE","dec","negative","parseFloat","neg","dateRE","months","days","dateDefault","Y","M","D","DD","H","MM","S","SS","Z","getDay","prototype","toString","call","ordinal","min","bit","abs","num","setDefault","checkIdent","RegExp","_noSym","_key","_sexprops","_listcommas","_noarr","_noobj","_tpl","_tplmode","_noindent","_listwrap","_html","_nochecks","_level","_first","deepops","binops","unops","precedence","in","like","ilike","gt","gte","lt","lte","is","and","or","noSymbols","SExprOps","listCommas","noArrayLiterals","noObjectLiterals","noIndent","listWrap","htmlSafe","noChecks","_stringify","stringifyRootBlock","padl","stringed","stringifyTemplateBlock","caseRE","stringifyTemplateCase","fill","wrapArgs","isBlock","long","cindent","outdentAll","trimLeft","trimRight","stringifyIf","wsplit","stringifyCase","findNestedStringOpL","flattenNestedBinopsL","_f","stringifyBinopArg","amount","indentAll","stringifyOp","arrow","stringifySchema","stringifyDate","entries","stringifyLiteral","rem","spanKeys","spanExact","stringifyTimespan","agg","offsetToTimezone","mn","leadingSpace","allLeadingSpace","close","keyMod","wrapSetting","wrap","ts","strs","fin","def","l2","nl","lopen","lclose","parseSchema","num_range","sign_range","sign","Infinity","star_range","not_range","looseEqual","v1","v2","strictEqual","isNum","trueStrings","falseStrings","sqlEqual","tmp1","tmp2","fullnum","diff","equal","_diff","identity","checkIdentity","v1ids","v2ids","vv1","vv2","_v1","_v2","ks","deepEqual","_deepEqual","labelDiff","label","out","omit","_labelDiff","nums","lbl","pp","isDate","isSchema","what","inspect","flat","getType","getField","validate","mode","_validate","_schema","errs","checkType","actual","unparseSchema","expected","tmp","legit","ok","DEFAULTS","record","field","quote","csv","quotedField","records","quotes","detect","data","sample","fs","rs","qs","entities","amp","entity","attr","quoted","attrs","put","target","strict","stack","stream","simple","spanMap","generateDefaults","roundDefaults","method","round","amt","settings","place","point","ceil","zeroes","pow","big","hasNum","equals","overlap","threshhold","similar","similarity","fudges","aa","bb","i1","i2","oa","ob","f1","f2","sim","alen","blen","aolen","bolen","matchy","inRange","excluded","where","ct","eq","_name","pattern","patterns","free","re","_opts","_parseRange","it","parseRange","bounds","upper","step","app","namedArgs","datesDiff","unit","fraction","us","endM","dist","nextDiv","units","raport","tpl","json","_","addTimespan","match","precision","random","triml","trimr","escapeRe","flatten","levels","fmtDate","_ranges","_indexPair","many","kk","flags","avail","ww","proto","rdt","vfmt","unset","xml","parseXML","csvDetect","csvParse","base64","atob","_i","_total","ast","case","body","lastKey","_last","seen","_arr","dollar","dev","alphaNum","alphaNumSpace","camelBreak","spaceChar","normalize","_m","c1","c2","whiches","_objectToXML","depth","indent","propname","entry","te","TextEncoder","encode","padStart","objectToXML","btoa","legal","tabloid","a4","extraContext","headers","table","rowContext","unquote","runDelimited","extras","orientation","yy","watermark","overlay","_k","head","foot","runFlow","page","pages","printX","printY","pageY","headSize","footSize","footPlace","headPlace","_p","runPage"],"mappings":"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"}