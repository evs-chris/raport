{"version":3,"file":"raport.umd.min.js","sources":["../node_modules/sprunge/src/base.ts","../node_modules/sprunge/src/search.ts","../node_modules/sprunge/src/parsers/char.ts","../node_modules/sprunge/src/parsers/str.ts","../node_modules/sprunge/src/parsers/base.ts","../node_modules/sprunge/src/parsers/rep.ts","../node_modules/sprunge/src/parsers/seq.ts","../node_modules/sprunge/src/json.ts","../src/lib/data/parse.ts","../src/lib/data/parse/template.ts","../src/lib/data/index.ts","../src/lib/render/error.ts","../src/lib/render/index.ts","../src/lib/render/style.ts","../src/lib/report.ts","../src/lib/data/parse/style.ts","../src/lib/render/builtins.ts","../src/lib/data/format.ts","../src/lib/data/parse/stringify.ts","../src/lib/data/parse/schema.ts","../src/lib/data/parse/range.ts","../src/lib/data/diff.ts","../src/lib/data/schema.ts","../src/lib/data/csv.ts","../src/lib/data/parse/xml.ts","../src/lib/data/builtins.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,"import { parser as makeParser, Parser, bracket, opt, alt, seq, str, istr, map, read, chars, repsep, rep1sep, read1To, read1, skip1, rep, rep1, check, verify, name, not, nop, readTo, unwrap, andNot } from 'sprunge/lib';\nimport { ws, digits, JNum, JStringEscape, JStringUnicode, JStringHex, JString } from 'sprunge/lib/json';\nimport { Value, DateRel, DateRelToDate, DateRelRange, DateRelSpan, DateExactRange, Literal, Keypath, TimeSpan, Operation, TimeSpanMS, Schema, Field, TypeMap } from './index';\n\nexport const timespans = {\n  y: 0,\n  m: 0,\n  w: 0,\n  d: 86400000,\n  h: 3600000,\n  mm: 60000,\n  s: 1000,\n};\n\ntimespans.w = timespans.d * 7;\ntimespans.y = Math.floor(timespans.d * 365.25);\ntimespans.m = Math.floor(timespans.d * 30.45);\n\nexport function isTimespanMS(v: any): v is TimeSpanMS {\n  return typeof v === 'object' && v && typeof v.ms === 'number';\n}\n\nexport function timeSpanToNumber(v: TimeSpan): number {\n  if (typeof v === 'number') return v;\n  else if (isTimespanMS(v)) return v.ms;\n  else return ((((((((((((v.d[0] || 0) * 12) + (v.d[1] || 0)) * 30.45) + (v.d[2] || 0)) * 24) + (v.d[3] || 0)) * 60) + (v.d[4] || 0)) * 60) + (v.d[5] || 0)) * 1000) + (v.d[6] || 0);\n}\n\nconst space = ' \\r\\n\\t';\nconst endSym = space + '():{}[]<>,\"\\'`\\\\;&#';\nexport const endRef = endSym + '.+/*|^%=!?';\n\nconst _comment = map(seq(ws, str('//'), opt(str(' ')), readTo('\\n'), str('\\n')), ([, , , c]) => ({ c }), { name: 'comment', primary: true });\nfunction comment<T extends any>(prop: string, p: Parser<T>): Parser<T> {\n  return map(seq(rep(_comment), ws, p), ([c, , v]) => {\n    if (c && c.length) v[prop] = c.map(c => c.c);\n    return v;\n  });\n}\n\nexport const rws = skip1(space, 'required-space');\n\nexport const keywords = map<string, any>(str('null', 'true', 'false', 'undefined'), v => {\n  switch (v) {\n    case 'null': return null;\n    case 'true': return true;\n    case 'false': return false;\n    case 'undefined': return undefined;\n  }\n}, { primary: true, name: 'primitive' });\n\nexport const ident = read1To(endRef, true);\nexport const sexprop = read1To(' \\r\\n\\t():{}[],\"\\'\\\\;&#@', true);\n\nexport const args: Parser<[Value[], Value]> = {};\nexport const array: Parser<Value> = {};\nexport const block: Parser<Value> = {};\nexport const object: Parser<Value> = {};\nexport const value: Parser<Value> = {};\nexport const values: Parser<Value> = {};\nexport const tpl: Parser<Value> = {};\nexport const application: Parser<Value> = {};\nexport const inlineTemplate: Parser<Value> = {};\n\nconst escmap: { [k: string]: string } = { n: '\\n', r: '\\r', t: '\\t', b: '\\b' };\nconst pathesc = map(seq(str('\\\\'), chars(1)), ([, char]) => escmap[char] || char);\nconst pathident = map(rep1(alt('ref-part', read1To(endRef, true), pathesc)), parts => parts.join(''), 'keypath-part');\nconst dotpath = map(seq(str('.'), pathident), ([, part]) => part);\nconst bracketpath = bracket(seq(str('['), ws), value, seq(ws, str(']')));\nexport const keypath = map(seq(alt<'!'|'~'|'*'|[string,string]>('ref-sigil', str('!', '~', '*') as any, seq(read('^'), opt(str('@', '.')))), alt<string|Value>('keypath', pathident, bracketpath), rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([prefix, init, parts]) => {\n  const res: Keypath = { k: [init].concat(parts).map(p => typeof p === 'object' && 'v' in p && (typeof p.v === 'string' || typeof p.v === 'number') ? p.v : p) };\n  if (Array.isArray(prefix)) {\n    if (prefix[0]) res.u = prefix[0].length;\n    if (prefix[1] === '@') res.p = '@';\n  } else if (prefix) {\n    res.p = prefix;\n  }\n  return res;\n}, 'keypath');\nexport const localpath = map(seq(read('^'), pathident, rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([prefix, init, parts]) => {\n  const res: Keypath = { k: ([init] as Array<string|Value>).concat(parts).map(p => typeof p === 'object' && 'v' in p && (typeof p.v === 'string' || typeof p.v === 'number') ? p.v : p) };\n  if (prefix) res.u = prefix.length;\n  return res;\n}, 'localpath');\n\nexport const parsePath = makeParser(keypath);\nexport const parseLetPath = makeParser(localpath);\n\nconst illegalRefs = ['if', 'else', 'elif', 'elseif', 'elsif', 'fi', 'esac', 'unless', 'then', 'case', 'when', 'not', 'gte', 'gt', 'lte', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain', 'is-not', 'is', 'strict-is-not', 'strict-is', 'deep-is-not', 'deep-is', 'and', 'or', 'end', 'with', 'each'];\nexport const ref = map(keypath, (r, err) => {\n  if (r.k.length === 1 && !r.p && !r.u && illegalRefs.includes(r.k[0] as string)) err(`invalid reference name '${r.k[0] as string}'`);\n  return { r };\n}, { primary: true, name: 'reference' });\n\nfunction stringInterp(parts: Value[]): Value {\n  const res = parts.reduce((a, c) => {\n    if (a.length) {\n      if ('v' in c && 'v' in a[a.length - 1] && typeof c.v === 'string' && typeof (a[a.length - 1] as Literal).v === 'string') (a[a.length - 1] as Literal).v += c.v;\n      else a.push(c);\n    } else {\n      a.push(c);\n    }\n    return a;\n  }, [] as Value[]);\n\n  if (res.length > 0 && (!('v' in res[0]) || typeof res[0].v !== 'string')) res.unshift({ v: '' });\n\n  if (res.length === 0) return { v: '' };\n  else if (res.length === 1) return res[0];\n  return { op: '+', args: res };\n}\n\nconst timespan = map(rep1sep(seq(JNum, ws, istr('years', 'year', 'y', 'months', 'month', 'minutes', 'minute', 'milliseconds', 'millisecond', 'mm', 'ms', 'm', 'weeks', 'week', 'w', 'days', 'day', 'd', 'hours', 'hour', 'h', 'seconds', 'second', 's')), ws), parts => {\n  const span = { y: 0, m: 0, d: 0, h: 0, mm: 0, s: 0, ms: 0 };\n  for (let i = 0; i < parts.length; i++) {\n    if (parts[i][2][0] === 'y') span.y += parts[i][0];\n    else if (parts[i][2] === 'm' || parts[i][2] === 'months' || parts[i][2] === 'month') span.m += parts[i][0];\n    else if (parts[i][2][0] === 'd') span.d += parts[i][0];\n    else if (parts[i][2][0] === 'w') span.d += parts[i][0] * 7;\n    else if (parts[i][2][0] === 'h') span.h += parts[i][0];\n    else if (parts[i][2][0] === 's') span.s += parts[i][0];\n    else if (parts[i][2] === 'mm' || parts[i][2] === 'minutes' || parts[i][2] === 'minute') span.mm += parts[i][0];\n    else if (parts[i][2] === 'ms' || parts[i][2] === 'milliseconds' || parts[i][2] === 'millisecond') span.ms += parts[i][0];\n  }\n\n  if (!span.y && !span.m && !span.d) {\n    delete span.y; delete span.m; delete span.d;\n    let n = 0;\n    for (const k in span) n += span[k] * (timespans[k] || 1);\n    return { ms: n };\n  } else {\n    const s: [number?, number?, number?, number?, number?, number?, number?] = [];\n    if (span.y) s[0] = span.y;\n    if (span.m) s[1] = span.m;\n    if (span.d) s[2] = span.d;\n    if (span.h) s[3] = span.h;\n    if (span.mm) s[4] = span.mm;\n    if (span.s) s[5] = span.s;\n    if (span.ms) s[6] = span.ms;\n    return { d: s };\n  }\n}, { primary: true, name: 'timespan' });\n\nexport const timezone = map(seq(ws, alt<string|[string, string, [string, string]]>('timezone',\n  istr('z'),\n  seq(opt(chars(1, '+-')), alt(chars(4, digits), chars(2, digits), chars(1, digits)),\n    opt(seq(str(':'), chars(2, digits)))\n  )\n)), v => {\n  if (v[1][0] === 'z') return 0;\n  else {\n    let res: number;\n    if (v[1][1].length === 4) {\n      res = +v[1][1].substr(0, 2) * 60 + +v[1][1].substr(2, 2);\n    } else {\n      res = +v[1][1] * 60;\n      if (v[1][2]) res += +v[1][2][1];\n    }\n    if (v[1][0] === '-') res *= -1;\n    return res;\n  }\n});\n\nexport const timeexact = alt<[number, number?, number?, number?]>(\n  map(seq(\n    read1(digits),\n    opt(seq(\n      str(':'), chars(2, digits), opt(\n        seq(str(':'), chars(2, digits), opt(\n          seq(str('.'), chars(3, digits))\n        ))\n      )\n    ))\n  ), v => {\n    const h = v[0];\n    const m = v[1] && v[1][1];\n    const s = m && v[1][2] && v[1][2][1];\n    const ms = s && v[1][2][2] && v[1][2][2][1];\n    const res: [number, number?, number?, number?] = [+h];\n    if (m) res[1] = +m;\n    if (s) res[2] = +s;\n    if (ms) res[3] = +ms;\n    return res;\n  }),\n  map(istr('start', 'midnight'), () => [0, 0, 0, 0]),\n  map(istr('noon', 'mid'), () => [12, 0, 0, 0]),\n  map(istr('end'), () => [23, 59, 59, 999]),\n);\n\nexport const parseTime = makeParser(alt<number|[number, number?, number?, number?]>(map(seq(timeexact, opt(seq(ws, timezone))), ([tm, z]) => {\n  if (z) tm.push(z[1]);\n  return tm;\n}), timezone), { trim: true, consumeAll: true, undefinedOnError: true });\n\nconst dateend = opt(seq(ws, str('>')));\nconst daterel = alt<DateRel>('date',\n  map(seq(opt(istr('last', 'this', 'next')), rws, istr('week', 'month', 'year'), opt(timezone), dateend), ([o, , f, tz, e]) => {\n    const val: DateRelRange = { f: f[0] === 'w' ? 'w' : f[0] === 'm' ? 'm' : 'y', o: o === 'last' ? -1 : o === 'next' ? 1 : 0, e: e ? 1 : undefined };\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('week', 'month', 'year'), seq(rws, istr('to'), rws, istr('date')), opt(timezone), dateend), ([f, , tz, e]) => {\n    const val: DateRelToDate = { f: f[0] === 'w' ? 'w' : f[0] === 'm' ? 'm' : 'y', o: 0, d: 1, e: e ? 1 : undefined };\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('yesterday', 'today', 'tomorrow'), alt<any>(bracket(ws, istr('at'), ws), rws), timeexact, ws, opt(timezone)), v => {\n    const res: DateRel = { f: 'd', o: v[0] === 'yesterday' ? -1 : v[0] === 'today' ? 0 : 1, t: v[2] };\n    if (v[4] != null) res.t[4] = v[4];\n    return res;\n  }),\n  map(seq(istr('yesterday', 'today', 'tomorrow', 'now'), opt(timezone), dateend), ([v, tz, e]) => {\n    const val: DateRel = (v === 'now' ? { f: 'n', o: 0 } : { f: 'd', o: v === 'yesterday' ? -1 : v === 'today' ? 0 : 1, e: e ? 1 : undefined });\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n  map(seq(istr('in'), rws, timespan), v => (typeof v[2] === 'number' || isTimespanMS(v[2]) ? { f: 'n', o: timeSpanToNumber(v[2]) } : { f: 'n', o: v[2].d })),\n  map(seq(timespan, rws, alt<string|any[]>('relative time anchor', istr('ago'), seq(istr('from'), rws, istr('now'))), opt(timezone)), ([span, , ref, tz]) => {\n    let val: DateRelSpan;\n    if (typeof span === 'number' || isTimespanMS(span)) {\n      val = { f: 'n', o: timeSpanToNumber(span) * (ref === 'ago' ? -1 : 1) };\n    } else {\n      val = { f: 'n', o: span.d, d: ref === 'ago' ? -1 : undefined };\n    }\n    if (tz != null) val.z = tz;\n    return val;\n  }),\n);\n\nfunction setIndex<T, U = Array<T>>(array: U, index: number, value: T): U {\n  if (value == null) return array;\n  array[index] = value;\n  return array;\n}\nexport const dateexact: Parser<Date|DateRel> = map(seq(\n  chars(4, digits),\n  opt(seq(chars(1, '-/'), read1(digits),\n    opt(seq(chars(1, '-/'), read1(digits)))\n  )),\n  opt(seq(\n    alt(bracket(rws, istr('at'), rws), istr('t'), rws), timeexact\n  )),\n  opt(timezone),\n  dateend,\n), v => {\n  const y = v[0];\n  const m = v[1] && v[1][1];\n  const d = m && v[1][2] && v[1][2][1];\n  const time = v[2] && v[2][1];\n  const tz = v[3];\n  const e = v[4] ? 1 : undefined;\n  if (!m) return { f: setIndex([+y], 7, tz), e };\n  else if (!d) return { f: setIndex([+y, +m - 1], 7, tz), e };\n  else if (!time) return { f: setIndex([+y, +m - 1, +d], 7, tz), e }\n  else {\n    const res: DateExactRange = { f: [+y, +m - 1, +d], e };\n    for (let i = 0; i < time.length; i++) {\n      if (time[i] != null) res.f[i + 3] = time[i];\n    }\n    if (tz != null) res.f[7] = tz;\n    return res;\n  }\n});\n\nexport const date = bracket(str('#'), alt<Date|DateRel|TimeSpan>('date', dateexact, daterel, timespan), str('#'), { primary: true, name: 'date' });\n\nexport const typelit = map(seq(str('@['), ws, schema(), ws, str(']')), ([, , v]) => ({ v, s: 1 } as Value), { name: 'typelit', primary: true });\n\nexport const parseDate = makeParser(map(seq(opt(str('#')), alt<Date|DateRel|TimeSpan>('date', dateexact, daterel, timespan), opt(str('#'))), ([, d,]) => d), { trim: true, consumeAll: true, undefinedOnError: true });\n\nexport const string = alt<Value>({ primary: true, name: 'string' },\n  bracket(str('$$$'), inlineTemplate, str('$$$')),\n  map(seq(str(':'), read1To(endSym, true)), v => ({ v: v[1]})),\n  map(bracket(str('\"\"\"'), rep(alt<string>('string-part',\n    read1To('\\\\\"'), JStringEscape, JStringUnicode, JStringHex, andNot(str('\"'), str('\"\"')),\n  )), str('\"\"\"')), a => ({ v: ''.concat(...a) })),\n  map(bracket(str('\"'), rep(alt<string>('string-part',\n    read1To('\\\\\"'), JStringEscape, JStringUnicode, JStringHex\n  )), str('\"')), a => ({ v: ''.concat(...a) })), \n  map(bracket(str(`'''`), rep(alt('string-part',\n    map(read1To(`'\\\\$\\{`, true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${', '{'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n    map(andNot(str(`'`), str(`''`)), v => ({ v })),\n  )), str(`'''`)), stringInterp),\n  map(bracket(str(`'`), rep(alt('string-part',\n    map(read1To(`'\\\\$\\{`, true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${', '{'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n  )), str(`'`)), stringInterp),\n  map(bracket(str('```'), rep(alt('string-part',\n    map(read1To('`\\\\${', true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n    map(andNot(str('`'), str('``')), v => ({ v })),\n  )), str('```')), stringInterp),\n  map(bracket(str('`'), rep(alt('string-part',\n    map(read1To('`\\\\${', true), v => ({ v } as Value)),\n    map(str('\\\\$', '$$'), () => ({ v: '$' })),\n    bracket(str('${'), value, str('}'), { primary: true, name: 'string-interpolation' }),\n    map(str('$', '{'), v => ({ v })),\n    map(JStringUnicode, v => ({ v })),\n    map(JStringHex, v => ({ v })),\n    map(JStringEscape, v => ({ v })),\n  )), str('`')), stringInterp),\n);\nexport const literal = map(alt('literal', map(JNum, v => v, { primary: true, name: 'number' }), keywords, date), v => {\n  if (v instanceof Date || v == null || typeof v !== 'object') return { v };\n  else return v;\n});\n\nexport const sexp = map(bracket(\n  check(str('('), ws),\n  seq(sexprop, ws, args),\n  check(ws, str(')')),\n), ([op, , args]) => {\n  const res: Value = { op };\n  if (args[0] && args[0].length) res.args = args[0];\n  if (args[1]) res.opts = args[1];\n  return res;\n}, { primary: true, name: 's-expression' });\n\nfunction fmt_op(parser: Parser<Value>): Parser<Value> {\n  return map(seq(parser, rep(seq(str('#'), ident, opt(alt<[Value[], Value]>(\n    map(seq(str(','), rep1sep(value, str(','), 'allow')), ([, value]) => [value, undefined]),\n    bracket_op(args),\n  ))), { primary: true, name: 'format-op' })), ([value, fmt]) => {\n    if (!fmt || !fmt.length) return value;\n    return fmt.reduce((a, c) => c[2] ?\n      { op: 'fmt', args: [a, { v: c[1] }, ...(c[2][0] || [])], opts: c[2][1] } :\n      { op: 'fmt', args: [a, { v: c[1] }] }, value);\n  }, 'fmt-op');\n}\n\nfunction bracket_op<T>(parser: Parser<T>): Parser<T> {\n  return bracket(seq(str('('), ws), parser, seq(ws, str(')')));\n}\n\nexport const binop: Parser<Value> = {};\nexport const if_op: Parser<Value> = {};\nexport const case_op: Parser<Value> = {};\n\nconst opName = read1('abcdefghifghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_$0123456789');\nconst call_op = map(seq(name(opName, 'op'), bracket_op(args)), ([op, args]) => {\n  const res: Value = { op };\n  if (args[0] && args[0].length) res.args = args[0];\n  if (args[1]) res.opts = args[1];\n  return res;\n}, { primary: true, name: 'call' });\n\nexport const operand: Parser<Value> = fmt_op(postfix_path(alt('operand', bracket_op(application), bracket_op(if_op), bracket_op(case_op), verify(bracket_op(binop), v => 'op' in v || `expected bracketed op`), sexp, values)));\nexport const unop = map(seq(str('not ', '+', '-'), operand), ([op, arg]) => ({ op: op === 'not ' ? 'not' : op, args: [arg] }), 'unary op');\n\nfunction leftassoc(left: Value, [, op, , right]: [string, string, string, Value]) {\n  return { op, args: [left, right] };\n}\n\nfunction rightassoc(left: Value, more: Array<[string, string, string, Value]>) {\n  if (more.length === 1) return { op: more[0][1], args: [left, more[0][3]] };\n  const end = more.pop();\n  let op = more[more.length - 1][1];\n  const first = { op: end[1], args: [more.pop()[3], end[3]] }\n  const right = more.reverse().reduce((a, c) => {\n    const res = { op, args: [c[3], a] };\n    op = c[1];\n    return res;\n  }, first);\n  return { op, args: [left, right] };\n}\n\nexport const binop_e = map(seq(operand, rep(alt(\n  seq(nop, name(str('**'), 'exp op'), nop, operand),\n  seq(rws, name(str('**'), 'exp op'), rws, operand),\n))), ([arg1, more]) => more.length ? rightassoc(arg1, more) : arg1, 'exp-op');\nexport const binop_md = map(seq(binop_e, rep(alt(\n  seq(nop, name(str('*', '/%', '/', '%'), 'muldiv-op'), nop, binop_e),\n  seq(rws, name(str('*', '/%', '/', '%'), 'muldiv-op'), rws, binop_e),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'muldiv-op');\nexport const binop_as = map(seq(binop_md, rep(alt(\n  seq(nop, name(str('+', '-'), 'addsub-op'), nop, binop_md),\n  seq(rws, name(str('+', '-'), 'addsub-op'), rws, binop_md),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'addsub-op');\nexport const binop_cmp = map(seq(binop_as, rep(alt(\n  seq(nop, name(str('>=', '>', '<=', '<'), 'cmp-op'), nop, binop_as),\n  seq(rws, name(str('>=', '>', '<=', '<', 'gte', 'gt', 'lte', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain'), 'cmp-op'), rws, binop_as),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'cmp-op');\nexport const binop_eq = map(seq(binop_cmp, rep(alt(\n  seq(nop, name(str('===', '==', '!==', '!='), 'eq-op'), nop, binop_cmp),\n  seq(rws, name(str('===', '==', '!==', '!=', 'is-not', 'is', 'strict-is-not', 'strict-is', 'deep-is-not', 'deep-is'), 'eq-op'), rws, binop_cmp),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'eq-op');\nexport const binop_and = map(seq(binop_eq, rep(alt(\n  seq(nop, name(str('&&'), 'and-op'), nop, binop_eq),\n  seq(rws, name(str('and', '&&'), 'and-op'), rws, binop_eq),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'and-op');\nexport const binop_or = map(seq(binop_and, rep(alt(\n  seq(nop, name(str('||', '??'), 'or-op'), nop, binop_and),\n  seq(rws, name(str('or', '||', '??'), 'or-op'), rws, binop_and),\n))), ([arg1, more]) => more.length ? more.reduce(leftassoc, arg1) : arg1, 'or-op');\nbinop.parser = map(binop_or, v => v, { primary: true, name: 'binary-op' });\n\nif_op.parser = alt({ primary: true, name: 'conditional' },\n  map(seq(str('if'), rws, value, rws, block, rep(seq(ws, str('else if', 'elseif', 'elsif', 'elif'), rws, value, rws, block)), opt(seq(ws, str('else'), rws, block))), ([,, cond1,, block1, elifs, el]) => {\n    const op =  { op: 'if', args: [cond1, block1] };\n    for (const [,,, cond,, block] of elifs) op.args.push(cond, block);\n    if (el) op.args.push(el[3]);\n    return op;\n  }, 'if-block'),\n  map(seq(str('if'), rws, value, rws, str('then'), rws, value, rep(seq(rws, not(str('end', 'fi')), str('else if', 'elseif', 'elsif', 'elif'), rws, value, rws, str('then'), rws, value)), opt(seq(rws, str('else'), rws, value)), opt(seq(rws, str('end', 'fi')))), ([,, cond1,,,, val1, elifs, el]) => {\n    const op = { op: 'if', args: [cond1, val1] };\n    for (const [,,,, cond,,,, val] of elifs) op.args.push(cond, val);\n    if (el) op.args.push(el[3]);\n    return op;\n  }, 'if'),\n  map(seq(str('unless'), rws, value, rws, str('then'), rws, value, opt(seq(rws, str('else'), rws, value)), opt(seq(rws, str('end')))), ([, , cond, , , , hit, miss]) => {\n    const op = { op: 'unless', args: [cond, hit] };\n    if (miss) op.args.push(miss[3]);\n    return op;\n  }),\n);\n\nexport function replaceCase(op: Operation): boolean {\n  if (!op.args || !op.args.length) return false;\n  let found = false;\n  for (let i = 0; i < op.args.length; i++) {\n    const arg = op.args[i] as Value;\n    if ('r' in arg && (arg.r === '_' || (typeof arg.r === 'object' && arg.r.k[0] === '_'))) {\n      arg.r = { k: ['case'].concat(((arg.r as any).k || []).slice(1)), p: '@' };\n      found = true;\n    } else if ('r' in arg && typeof arg.r === 'object' && arg.r.p === '@' && arg.r.k[0] === 'case') {\n      found = true;\n    } else if ('op' in arg) found = found || replaceCase(arg);\n  }\n  return found;\n}\n\nexport const case_branch = alt<[undefined|Value, Value]>(\n  map(seq(rws, not(str('end', 'esac')), str('when'), rws, value, rws, str('then'), rws, value), ([,,,, cond,,,, hit]) => [cond, hit], 'when-branch'),\n  map(seq(rws, not(str('end', 'esac')), str('else'), rws, value), ([,,,, hit]) => [undefined, hit], 'else-branch'),\n  map(seq(rws, not(str('end', 'esac')), str('when'), rws, value, rws, block), ([,,,, cond,, hit]) => [cond, hit], 'when-block'),\n);\ncase_op.parser = alt(\n  map(seq(str('case'), rws, value, rep(case_branch), opt(seq(rws, str('end', 'esac')))), ([,, val, branches]) => {\n    const op = { op: 'case', args: [val] };\n    for (let i = 0; i < branches.length; i++) {\n      if (branches[i][0] === undefined) op.args.push(branches[i][1]);\n      else {\n        let arg: Value = branches[i][0];\n        if ('op' in arg) replaceCase(arg);\n        op.args.push(arg);\n        op.args.push(branches[i][1]);\n      }\n    }\n    return op;\n  }, 'case'),\n);\n\nfunction postfix_path(parser: Parser<Value>): Parser<Value> {\n  return map(seq(parser, rep(alt<string|Value>('keypath', dotpath, bracketpath))), ([v, k]) => {\n    if (k.length) return { op: 'get', args: [v, { v: { k } }] };\n    else return v;\n  }, 'postfix-path-op');\n}\n\nexport const operation = alt<Value>('expression', if_op, case_op, binop);\n\nconst pair: Parser<[Value, Value]> = map(seq(alt('key', string, map(ident, v => ({ v }))), ws, str(':'), ws, value), t => [t[0], t[4]], 'pair');\n\narray.parser = map(bracket(\n  check(str('['), ws),\n  repsep(value, read1(space + ','), 'allow'),\n  check(ws, str(']')),\n), args => args.filter(a => !('v' in a)).length ? { op: 'array', args } : { v: args.map(a => (a as Literal).v) }, { primary: true, name: 'array' });\n\nfunction objectOp(pairs: [Value, Value][]): Value {\n  return pairs.filter(p => !('v' in p[0] && 'v' in p[1])).length ?\n  { op: 'object', args: pairs.reduce((a, c) => (a.push(c[0], c[1]), a), []) } : \n  { v: pairs.reduce((a, c) => (a[(c[0] as Literal).v] = (c[1] as Literal).v, a), {}) };\n}\n\nobject.parser = map(bracket(\n  check(str('{'), ws),\n  repsep(pair, read1(space + ','), 'allow'),\n  check(ws, str('}')),\n), objectOp, { primary: true, name: 'object' });\n\nblock.parser = map(bracket(\n  check(str('{'), ws),\n  rep1sep(value, read1(space + ';'), 'allow'),\n  check(ws, str('}')),\n), args => ({ op: 'block', args }), { primary: true, name: 'block' });\n\nvalue.parser = unwrap(comment('c', operation));\n\nconst namedArg: Parser<[Value, Value]> = map(seq(ident, str(':'), ws, value), ([k, , , v]) => [{ v: k }, v], 'named-arg');\napplication.parser = map(seq(opt(bracket(check(str('|'), ws), rep1sep(opName, read1(space + ','), 'allow'), seq(str('|'), ws))), str('=>', '=\\\\'), ws, value), ([names, , , value]) => (names ? { a: value, n: names } : { a: value }), { primary: true, name: 'application' });\nargs.parser = map(repsep(alt<[Value, Value] | Value>('argument', namedArg, value), read1(space + ','), 'allow'), (args) => {\n  const [plain, obj] = args.reduce((a, c) => ((Array.isArray(c) ? a[1].push(c) : a[0].push(c)), a), [[], []] as [Array<Value>, Array<[Value, Value]>]);\n  if (obj.length) return [plain, objectOp(obj)];\n  return [plain, undefined];\n});\n\nconst letter = map(seq(str('let'), rws, name(localpath, { name: 'reference', primary: true }), ws, str('='), ws, value), ([, , k, , , , v]) => ({ op: 'let', args: [{ v: k }, v] }), { primary: true, name: 'let' });\nconst setter = map(seq(str('set'), rws, name(keypath, { name: 'reference', primary: true }), ws, str('='), ws, value), ([, , k, , , , v]) => ({ op: 'set', args: [{ v: k }, v] }), { primary: true, name: 'set' });\nvalues.parser = alt('expression', array, object, literal, typelit, string, application, unop, call_op, letter, setter, ref, block);\n\nexport const parseBlock = makeParser<Value>(map(rep1sep(value, read1(space + ';'), 'allow'), args => args.length === 1 ? args[0] : { op: 'block', args, opts: { v: { implicit: 1 } } }, 'expression-sequence'), { trim: true });\nexport const parseExpr = makeParser(value, { trim: true });\n(parseBlock as any).namespace = 'default';\nexport const parse: typeof parseBlock & { namespace: string } = parseBlock as any;\nexport default parse;\n\nexport function schema() {\n  const type: Parser<Schema> = {};\n  const conditions = opt(seq(ws, rep1sep(map(seq(name(str('?'), { name: 'condition', primary: true }), ws, application), ([, , a]) => a), rws, 'disallow')));\n  const value = map(seq(str('any[]', 'string[]', 'number[]', 'boolean[]', 'date[]', 'any', 'string', 'number', 'boolean', 'date'), not(read1To(endRef))), ([s]) => ({ type: s === 'any[]' ? 'array' : s } as Schema), { name: 'type', primary: true });\n  const typedef = comment('c', map(seq(str('type'), ws, name(ident, { name: 'type', primary: true }), ws, str('='), ws, type), ([, , name, , , , type]) => ({ name, type } as { name: string, type: Schema, c?: string[] })));\n  const typedefs = map(rep1sep(typedef, read1(' \\t\\n;'), 'allow'), defs => defs.reduce((a, c) => (c.type.desc = c.c, a[c.name] = c.type, a), {} as TypeMap));\n  const ref = map(seq(ident, opt(str('[]'))), ([ref, arr]) => ({ type: arr ? 'array' : 'any', ref } as Schema), { name: 'type', primary: true });\n  const key = map(seq(name(ident, { name: 'key', primary: true }), opt(str('?')), ws, str(':'), ws, type), ([name, opt, , , , type]) => {\n    const res: Field = type as Field;\n    res.name = name;\n    if (!opt) res.required = true;\n    return res;\n  });\n  const literal = alt<Schema>(\n    { name: 'literal', primary: true }, \n    map(alt<string|number>(JString, JNum), v => {\n      return { type: 'literal', literal: v } as Schema;\n    }),\n    map(str('true', 'false', 'null', 'undefined'), v => {\n      return { type: 'literal', literal: v === 'true' ? true : v === 'false' ? false : v === 'null' ? null : undefined } as Schema;\n    }),\n  );\n  const rest = map(seq(str('...'), ws, str(':'), ws, type), ([, , , , type]) => {\n    return Object.assign({ name: '...' }, type) as Field;\n  });\n  const object: Parser<Schema> = map(seq(str('{'), ws, repsep(comment('desc', alt(key, rest)), read1(' \\t\\n,;'), 'allow'), ws, str('}'), opt(str('[]'))), ([, , keys, , , arr], fail) => {\n    const rests = keys.filter(k => k.name === '...');\n    if (rests.length > 1) fail('only one object rest can be specified');\n    else {\n      const rest = rests[0];\n      keys = keys.filter(k => k.name !== '...');\n      const type: Schema = { type: arr ? 'object[]' : 'object' };\n      if (keys.length) type.fields = keys;\n      if (rest) {\n        delete rest.name;\n        type.rest = rest;\n      }\n      return type;\n    }\n  });\n  const tuple = map(seq(str('['), ws, repsep(type, read1(' \\t\\r\\n,'), 'allow'), ws, str(']'), opt(str('[]'))), ([, , types, , , arr]) => {\n    return { type: arr ? 'tuple[]' : 'tuple', types } as Schema;\n  });\n  const maybe_union: Parser<Schema> = {};\n  const union_array: Parser<Schema> = {};\n\n  maybe_union.parser = map(rep1sep(seq(alt<Schema>(value, object, tuple, literal, union_array, ref), conditions), seq(ws, str('|'), ws), 'disallow'), list => {\n    const types = list.map(([t, c]) => {\n      if (c && c[1] && c[1].length) t.checks = c[1];\n      return t;\n    });\n    if (types.length === 1) return types[0];\n    else return { type: 'union', types: types } as Schema;\n  });\n  union_array.parser = alt<Schema>(\n    map(seq(str('Array<'), ws, maybe_union, ws, str('>')), ([, , union], fail) => {\n      if (union.type === 'union') return { type: 'union[]', types: union.types } as Schema;\n      else if (union.type === 'literal') fail('literal types cannot be array types');\n      else if (union.type === 'array' || ~union.type.indexOf('[]')) return { type: 'union[]', types: [union] } as Schema;\n      else if (union.type === 'any') return { type: 'array' } as Schema;\n      else {\n        union.type += '[]';\n        return union;\n      }\n    }),\n    map(seq(str('('), ws, maybe_union, ws, str(')')), ([, , union]) => union),\n    maybe_union,\n  );\n\n  type.parser = map(seq(union_array, conditions), ([type, checks]) => {\n    if (checks && checks[1] && checks[1].length) type.checks = checks[1];\n    return type;\n  });\n\n  const root = map(seq(opt(typedefs), ws, type), ([defs, , type]) => {\n    if (defs) type.defs = defs;\n    return type;\n  });\n\n  return root;\n}\n","import { Value } from '../index';\nimport { value, rws, replaceCase, inlineTemplate } from '../parse';\nimport { Parser, parser as makeParser, rep, rep1, seq, alt, map, read1To, chars, str, readTo, check, andNot, name } from 'sprunge';\nimport { ws } from 'sprunge/lib/json';\n\nconst endTxt = '\\\\{';\n\nconst txtEsc = alt(map(str('\\\\{{'), () => '{{'), map(seq(str('\\\\'), chars(1)), ([, c]) => c));\nconst text = map(rep1(alt(read1To(endTxt, true), txtEsc, andNot(str('{'), str('{')))), txts => ({ v: txts.join('') }), 'text');\nconst nestedText = map(rep1(alt(read1To(endTxt + '$'), txtEsc, andNot(str('$'), str('$$')), andNot(str('{'), str('{')))), txts => ({ v: txts.join('') }), 'text');\n\nfunction tag_value(names: string[]): Parser<[string, Value]> {\n  return map(seq(str('{{'), ws, str(...names), rws, value, ws, str('}}')), arr => [arr[2], arr[4]], 'tag');\n}\n\nfunction case_value(names: string[]): Parser<[string, Value, Value]> {\n  return map(seq(str('{{'), ws, str(...names), rws, value, rws, str('when'), rws, value, str('}}')), arr => [arr[2], arr[4], arr[8]], 'tag');\n}\n\nconst tag_end = name(check(seq(str('{{/'), readTo('}'), str('}}'))), 'tag end');\n\nconst content: Parser<Value> = {};\n\ninterface Branch {\n  name: string;\n  value?: Value;\n}\n\ntype Content = Value|Branch;\n\nfunction branch(names: string[], value?: boolean): Parser<Branch> {\n  if (value) return map(tag_value(names), ([name, value]) => ({ name, value }));\n  else return map(seq(str('{{'), ws, str(...names), ws, str('}}')), ([, , name]) => ({ name }), 'tag');\n}\n\nfunction min_one<T>(values: Parser<Array<T>>): Parser<Array<T|Value>> {\n  return map(values, v => v.length < 1 ? [{ v: '' }] : v);\n}\n\nconst else_tag = branch(['else']);\nconst branch_tag = branch(['else if', 'elseif', 'elsif', 'elif'], true);\n\nconst each_op = map(seq(tag_value(['each']), min_one(rep(alt<Content>(branch_tag, else_tag, content))), tag_end), ([tag, content]) => ({ op: 'each', args: [tag[1]].concat(apply_first(cond_branches(content))) }), { primary: true, name: 'each-block' });\nconst if_op = map(seq(tag_value(['if']), min_one(rep(alt<Content>(branch_tag, else_tag, content))), tag_end), ([tag, content]) => ({ op: 'if', args: [tag[1]].concat(cond_branches(content)) }), { primary: true, name: 'if-block' });\nconst with_op = map(seq(tag_value(['with']), min_one(rep(alt<Content>(else_tag, content))), tag_end), ([tag, content]) => ({ op: 'with', args: [tag[1]].concat(apply_first(cond_branches(content))) }), { primary: true, name: 'with-block' });\nconst unless_op = map(seq(tag_value(['unless']), min_one(rep(content)), tag_end), ([tag, content]) => ({ op: 'unless', args: [tag[1]].concat(concat(content)) }), { primary: true, name: 'unless-block' });\nconst case_op = map(seq(case_value(['case']), min_one(rep(alt<Content>(branch(['when'], true), else_tag, content))), tag_end), ([tag, content]) => {\n  const op = { op: 'case', args: tag.slice(1).concat(cond_branches(content)) };\n  for (let i = 1; i < op.args.length; i += 2) {\n    const arg = op.args[i];\n    if (typeof arg === 'object' && 'op' in arg) replaceCase(arg);\n  }\n  return op;\n}, { primary: true, name: 'case-block' });\n\nconst interpolator = map(seq(str('{{'), ws, value, ws, str('}}')), ([, , value]) => ({ op: 'string', args: [value] }), { primary: true, name: 'interpolator' });\n\ncontent.parser = alt<Value>({ primary: true, name: 'content' }, text, each_op, if_op, with_op, case_op, unless_op, interpolator);\n\nfunction apply_first(content: Value[]): Value[] {\n  if (content.length) content[0] = { a: content[0] };\n  return content;\n}\n\nfunction cond_branches(content: Array<Value|Branch>): Value[] {\n  const res: Value[] = [];\n  let args = [];\n  let hasTag = false;\n\n  for (let i = 0; i < content.length; i++) {\n    const c = content[i];\n    if ('name' in c) {\n      hasTag = true;\n      if (args.length) res.push(concat(args));\n      else res.push({ v: '' });\n      if (c.value) res.push(c.value);\n      args = [];\n    } else args.push(c);\n  }\n  if (args.length) res.push(concat(args));\n  else if (hasTag) res.push({ v: '' });\n\n  if (res.length % 2) res.push({ v: '' });\n\n  return res;\n}\n\nfunction concat(values: Value[]): Value {\n  if (values.length === 1) return values[0];\n  return { op: 'cat', args: values, meta: '$' };\n}\n\nconst _parse = makeParser(alt<Value>(map(rep1(content), args => concat(args)), map(ws, () => ({ v: '' }))), { trim: true });\n(_parse as any).namespace = 'template';\nexport const parse: typeof _parse & { namespace: string } = _parse as any;\n\n(inlineTemplate as { parser?: Parser<Value> }).parser = map(rep1(alt<Value>({ name: 'inline-template' }, nestedText, each_op, if_op, with_op, case_op, unless_op, interpolator)), args => concat(args));\n","import { parse, parsePath, parseLetPath, isTimespanMS } from './parse';\nimport { parse as parseTemplate } from './parse/template';\nimport { ParseError } from 'sprunge/lib';\n\nexport interface TypeMap {\n  [name: string]: Schema;\n}\n\n// Data\nexport interface Schema {\n  /** An optional type for the value */\n  type?: Type;\n  /** Child fields belonging to the field */\n  fields?: Field[];\n  /** Types of unnamed fields in object prototypes */\n  rest?: Schema;\n  /** Types of tuple or union */\n  types?: Schema[];\n  /** Literal value of field */\n  literal?: string|number|boolean|undefined|null;\n  /** Addition validators on the value */\n  checks?: ValueOrExpr[];\n  /** An optional map of named types */\n  defs?: TypeMap;\n  /** If the type is 'any', this may be a name in a type map */\n  ref?: string;\n  /** Additional comments about the type */\n  desc?: string[];\n}\n\nexport interface DataSource<T = any, R = any> {\n  schema?: Schema;\n  values(parms?: T): Promise<DataSet<R>>;\n}\n\nexport interface DataSet<R = any> {\n  schema?: Schema;\n  value: R;\n}\n\nexport function toDataSet(value: any): DataSet {\n  if (Array.isArray(value)) return { value };\n  if (value && typeof value === 'object') {\n    for (const k in value) if (k !== 'schema' && k !== 'value') return { value };\n    return value;\n  }\n  return { value };\n}\n\nexport class CachedDataSource<R = any> implements DataSource<any, R> {\n  _schema: Schema;\n  _value: R;\n\n  constructor(value: R, schema?: Schema) {\n    this._value = value;\n    this._schema = schema;\n  }\n\n  values(): Promise<DataSet<R>> { return Promise.resolve({ schema: this._schema, value: this._value }); }\n}\n\nexport interface SourceMap { [key: string]: DataSet }\n\nexport type ValueType = 'string'|'number'|'boolean'|'date'|'object'|'literal';\nexport type ArrayType = 'string[]'|'number[]'|'boolean[]'|'date[]'|'object[]'|'tuple[]'|'union[]';\nexport type Type = ValueType|ArrayType|'value'|'array'|'union'|'tuple'|'any';\n\nexport interface Field extends Schema {\n  /** The property name for the field */\n  name: string;\n  /** Whether this field is required */\n  required?: true;\n  /** A user-friendly name for the field */\n  label?: string;\n  /** Additional information for special use cases */\n  meta?: any;\n}\n\nexport interface Operation {\n  op: string;\n  args?: ValueOrExpr[];\n  c?: string[];\n  opts?: ValueOrExpr;\n  meta?: any;\n}\n\nexport type Sort = ValueOrExpr|SortBy;\nexport type SortBy = SortBySQL|SortByDir;\nexport interface SortByBase {\n  by: ValueOrExpr;\n}\nexport interface SortBySQL extends SortByBase {\n  desc?: ValueOrExpr|boolean;\n}\nexport interface SortByDir extends SortByBase {\n  dir?: ValueOrExpr|'asc'|'desc';\n}\n\nexport type Operator = AggregateOperator | ValueOperator | CheckedOperator;\n\nexport interface OperatorOptions {\n  [key: string]: any;\n  // this is a dirty hack to make ts acknowledge that this isn't just any old object\n  __options: 1;\n}\n\nexport interface BaseOperator {\n  names: string[];\n}\nexport interface ValueOperator extends BaseOperator {\n  type: 'value';\n  apply(name: string, values: any[], opts: OperatorOptions, context: Context): any;\n}\n\nexport interface CheckedOperator extends BaseOperator {\n  type: 'checked';\n  apply(name: string, values: any[], opts: OperatorOptions, context: Context): any;\n  checkArg: (name: string, num: number, last: number, value: any, opts: OperatorOptions, context: Context, expr: ValueOrExpr) => CheckResult;\n  extend?: true;\n}\n\nexport interface AggregateOperator extends BaseOperator {\n  type: 'aggregate';\n  apply(name: string, values: any[], args: ValueOrExpr[], opts: OperatorOptions, context: Context): any;\n  extend?: true;\n  value?: true;\n}\n\nexport type CheckResult = 'continue'|{ result: any }|{ skip: number, value?: any };\n\nexport interface Group<R = any> {\n  grouped: number;\n  group: string;\n  value: R;\n  all: R[];\n  level: number;\n}\n\n// eval\nexport function getKeypath(ref: Reference): Keypath {\n  if (typeof ref.r === 'object') return ref.r;\n  const path = parsePath(ref.r);\n  if ('k' in path) return path;\n  else return { k: [] };\n}\n\nexport function safeGet(root: Context, path: string|Keypath): any {\n  if (!path) return root.value;\n  const p = typeof path === 'string' ? parsePath(path) : path;\n\n  if ('error' in p) return;\n  else if ('k' in p) {\n    let parts = p.k;\n    const prefix = p.p;\n    let idx = 0;\n    let ctx = root;\n    let o: any = root.value;\n\n    for (let i = 0; i < p.u; i++) ctx && (ctx = ctx.parent);\n    o = ctx ? ctx.value : undefined;\n\n    if (prefix) {\n      if (prefix === '!') o = root.root.parameters;\n      else if (prefix === '~') o = root.root.value;\n      else if (prefix === '*') {\n        o = root.root.sources[parts[idx++] as string];\n        if (o && idx < parts.length + 1 && parts[idx] !== 'value') o = o.value;\n      } else if (prefix === '@') {\n        const which = parts[idx++] as string;\n        if (which === 'locals' || which === 'specials') {\n          const key = which === 'locals' ? which : 'special';\n          while (ctx) {\n            if (ctx[key]) break;\n            ctx = ctx.parent;\n          }\n          if (ctx) o = ctx[key];\n        } else if (which === 'local' || which === 'special') {\n          const key = which === 'local' ? 'locals' : which;\n          o = ctx[key] || (ctx[key] = {});\n        } else if (which === 'parameters' || which === 'sources') {\n          o = root.root[which];\n        } else if (which !== 'value') {\n          while (ctx && (!ctx.special || !(which in ctx.special))) ctx = ctx.parent;\n          o = ctx && ctx.special[which];\n\n          if (o && which === 'source' && parts[idx] !== undefined && parts[idx] !== 'value' && o.value) o = o.value;\n          if (!o && which === 'date') o = root.root.special.date = new Date();\n        }\n      }\n    } else {\n      const first = parts[0];\n      if (first === '_') {\n        if (ctx.special && ctx.special.pipe) o = ctx.special.pipe;\n        idx++;\n      } else if (typeof first === 'string') {\n        let lctx = ctx;\n        while (lctx && (!lctx.locals || !(first in lctx.locals))) lctx = lctx.parent;\n        if (lctx && first in lctx.locals) {\n          o = lctx.locals[first];\n          idx++;\n        }\n      }\n    }\n\n    for (let i = idx; i < parts.length; i++) {\n      const part = parts[i];\n      const v = typeof part !== 'object' ? part : evalValue(root, part);\n      if (Array.isArray(o) && typeof v === 'number' && v < 0) o = o[o.length + v];\n      else o = o && o[v];\n      if (o === null || o === undefined) return;\n    }\n\n    return o;\n  }\n}\n\nexport function safeSet(root: Context, path: string|Keypath, value: any, islet?: boolean): any {\n  if (!path) return;\n  const p = typeof path === 'string' ? (islet ? parseLetPath(path) : parsePath(path)) : path;\n\n  if ('error' in p) return;\n  else if ('k' in p) {\n    let parts = p.k;\n    const prefix = p.p;\n    let ctx = root;\n    let o: any = root.value;\n\n    for (let i = 0; i < p.u; i++) ctx && (ctx = ctx.parent);\n    o = ctx ? ctx.value : undefined;\n\n    const keys = parts.map(p => typeof p !== 'object' ? p : evalValue(root, p));\n\n    if (islet) {\n      o = root.locals || (root.locals = {});\n    } else if (prefix) {\n      if (prefix === '~') o = root.root.value;\n      else return;\n    }\n\n    if (!islet) {\n      const first = keys[0];\n      while (ctx) {\n        if (ctx.locals && first in ctx.locals) break;\n        ctx = ctx.parent;\n      }\n      if (ctx) o = ctx.locals;\n    }\n\n    const last = keys.length - 1;\n    for (let i = 0; i < last; i++) {\n      if (typeof o !== 'object' && typeof o !== 'function' || !o) return;\n      const key = keys[i];\n      const next = keys[i + 1];\n      if (!(key in o) || o[key] == null) o[key] = typeof next === 'number' ? [] : {};\n      o = o[key];\n    }\n    \n    if (o) {\n      const cur = o[keys[last]];\n      o[keys[last]] = value;\n      return cur;\n    }\n  }\n}\n\nexport function evaluate(value: ValueOrExpr): any;\nexport function evaluate(root: Context|{ context: Context }|any, value: ValueOrExpr): any;\nexport function evaluate(root: ValueOrExpr|Context|{ context: Context }|any, value?: ValueOrExpr): any {\n  let r: Context;\n  let e: ValueOrExpr;\n  if (!value && isValueOrExpr(root)) {\n    r = new Root();\n    e = root;\n  } else if (isContext(root)) {\n    r = root;\n    !Array.isArray(value) && (e = value);\n  } else if (root && typeof root === 'object' && 'context' in root && isContext(root.context)) {\n    r = root.context;\n    !Array.isArray(value) && (e = value);\n  } else if (isValueOrExpr(value)) {\n    r = new Root(root);\n    e = value;\n  } else {\n    r = new Root();\n    e = root;\n  }\n  return evalParse(r, e);\n}\n\nexport function template(template: string): string;\nexport function template(root: Context|{ context: Context }|any, template: string): string;\nexport function template(root: string|Context|{ context: Context }|any, template?: string): string {\n  let r: Context;\n  let t: string;\n  if (typeof root === 'string') {\n    r = new Root();\n    t = root;\n  } else if (isContext(root)) {\n    r = root;\n    t = template || '';\n  } else if (root && typeof root === 'object' && 'context' in root && isContext(root.context)) {\n    r = root.context;\n    t = template || '';\n  } else if (root && typeof root !== 'string') {\n    r = new Root(root);\n    t = template || '';\n  } else {\n    r = new Root();\n    t = root;\n  }\n  r = extend(r, { parser: parseTemplate });\n  return evalParse(r, t);\n}\n\n/**\n * Evaluate an applicative with the given locals, naming them if the applicative declares named arguments.\n * If swap is not true, then a new context extension will be used. Otherwise, the context locals will be\n * swapped for the evaluation and replaced afterwards. Swap should only be used for applications that are\n * passing the context value as the first local.\n */\nexport function evalApply(ctx: Context, value: ValueOrExpr, locals: any[], special?: object): any {\n  if (isApplication(value)) {\n    const c = extend(ctx, { value: locals[0], special, fork: !ctx.locals });\n    let res: any;\n    if ('n' in value) {\n      const map = value.n.reduce((a, c, i) => (a[c] = locals[i], a), {} as ParameterMap);\n      c.locals = map;\n    }\n    res = evalValue(c, value.a);\n    return res;\n  } else {\n    const v = evalParse(extend(ctx, { value: locals[0], special, fork: !ctx.locals }), value);\n    if (isApplication(v)) return evalApply(ctx, v, locals, special);\n    else return v;\n  }\n}\n\nexport function evalParse(ctx: Context, expr: ValueOrExpr): any {\n  if (typeof expr === 'string') {\n    const p = ctx.parser || parse;\n    const ns = p.namespace || 'unknown';\n    const cache = ctx.root.exprs[ns] || (ctx.root.exprs[ns] = {});\n    expr = cache[expr] || (cache[expr] = p(expr));\n  }\n  if (typeof expr !== 'object') expr = { v: expr };\n  return evalValue(ctx, expr);\n}\n\nexport function evalValue(ctx: Context, expr: Value): any {\n  if (!expr) return expr;\n  if ('r' in expr) return safeGet(ctx, expr.r);\n  else if ('v' in expr) return expr.v;\n  else if ('op' in expr) return applyOperator(ctx, expr);\n  else if (isApplication(expr)) return expr;\n  else if (isDateRel(expr) || isTimespan(expr)) return expr;\n}\n\nconst opMap: { [key: string]: Operator } = {};\nexport function registerOperator(...ops: Operator[]) {\n  for (const op of ops) {\n    for (const name of op.names) opMap[name] = op;\n  }\n}\nexport function unregisterOperator(...ops: Operator[]) {\n  for (const op of ops) {\n    for (const name of op.names) delete opMap[name];\n  }\n}\nexport function getOperatorMap(): { [key: string]: Operator } {\n  return Object.assign({}, opMap);\n}\nexport function getOperator<T extends Operator = Operator>(name: string): T {\n  return opMap[name] as T;\n}\n\nconst _defaultGetValue = (c: Context, b: ValueOrExpr, v: any) => evalApply(c, b, [v]);\nexport function sort(context: Context, arr: any[], sorts: Sort[]|ValueOrExpr, getValue?: (context: Context, by: ValueOrExpr, v: any) => any): any[] {\n  let sortArr: Sort[];\n  \n  if (Array.isArray(sorts)) {\n    sortArr = sorts;\n  } else if (isApplication(sorts)) {\n    sortArr = [sorts];\n  } else if (typeof sorts === 'object' && sorts && 'by' in sorts) {\n    sortArr = [sorts];\n  } else {\n    const s = evalParse(context, sorts);\n    if (Array.isArray(s)) sortArr = s;\n    else if (typeof s === 'string') sortArr = [{ v: s }];\n    else if (typeof sorts === 'string') sortArr = [sorts]\n  }\n\n  if (sortArr) {\n    let el: any;\n    for (let i = 0; i < sortArr.length; i++) {\n      el = sortArr[i];\n      const by = isLiteral(el) ? el.v : el;\n      if (typeof by === 'string') {\n        if (by[0] === '-') sortArr[i] = { by: by.slice(1), desc: true };\n        else sortArr[i] = { by: by[0] === '+' ? by.slice(1) : by, desc: false };\n      }\n    }\n  }\n\n  getValue = getValue || _defaultGetValue;\n  if (sortArr && sortArr.length) {\n    const dirs = sortArr.map(s => {\n      if (typeof s === 'object') {\n        if ('by' in s) {\n          if ('desc' in s) {\n            if (typeof s.desc === 'boolean') return s.desc;\n            return evalParse(context, s.desc);\n          } else if ('dir' in s) {\n            const lower = typeof s.dir === 'string' ? s.dir.toLowerCase() : s.dir;\n            const dir = lower === 'asc' || lower === 'desc' ? lower : evalParse(context, s.dir);\n            const val = typeof dir === 'string' ? dir.toLowerCase() : dir;\n            if (val === 'desc') return true;\n          }\n        }\n      }\n      // default to asc\n      return false;\n    });\n\n    arr.sort((a, b) => {\n      for (let i = 0; i < sortArr.length; i++) {\n        const s = sortArr[i];\n        const desc = dirs[i];\n        const by: ValueOrExpr = typeof s === 'string' ? s : s && (s as any).by ? (s as any).by : s;\n        const l = getValue(context, by, a);\n        const r = getValue(context, by, b);\n        const cmp = l == null && r != null ? -1 \n          : l != null && r == null ? 1\n          : (l < r) === (r < l) ? 0\n          : l < r ? -1\n          : l > r ? 1\n          : 0;\n        if (cmp) return (desc ? -1 : 1) * cmp;\n      }\n      return 0;\n    });\n  }\n\n  return arr;\n}\n\nexport function filter(arr: any[], filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): any[];\nexport function filter(ds: DataSet, filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): DataSet;\nexport function filter(ds: DataSet|any[], filter?: ValueOrExpr, sorts?: Sort[]|ValueOrExpr, groups?: Array<ValueOrExpr>|ValueOrExpr, context?: Context|any): DataSet|any[] {\n  const _ds = Array.isArray(ds) ? { value: ds } : ds;\n  if (!_ds || !Array.isArray(_ds.value)) return _ds;\n  let _context: Context;\n  if (!context) _context = new Root(_ds.value, { special: { source: _ds } });\n  else if (isContext(context)) _context = extend(context, { special: { source: _ds.value } });\n  else _context = new Root(context);\n  const values = filter ? [] : _ds.value.slice();\n\n  if (filter) {\n    let flt: Value = typeof filter === 'string' ? parse(filter) : filter;\n    if ('m' in flt) flt = { v: true };\n    _ds.value.forEach((row, index) => {\n      if (!!evalApply(extend(_context, { value: row, special: { value: row, index } }), flt, [row, index])) values.push(row);\n    });\n  }\n\n  if (sorts) sort(_context, values, sorts);\n\n  if (groups && !Array.isArray(groups)) groups = [groups];\n\n  if (Array.isArray(groups) && groups.length) {\n    return { value: { schema: _ds.schema, grouped: groups.length, level: 0, value: group(values, groups, _context, 1), all: values } };\n  }\n\n  if (Array.isArray(ds)) return values;\n  else return { schema: _ds.schema, value: values };\n}\n\ninterface GroupCache {\n  [group: string]: any[];\n}\n\nfunction group(arr: any[], groups: Array<ValueOrExpr>, ctx: Context, level: number = 0): Group[] {\n  const cache: GroupCache = {};\n  const res: Group[] = [];\n  const order: string[] = [];\n  for (const e of arr) {\n    const g = isApplication(groups[0]) ? `${evalApply(ctx, groups[0], [e])}` : `${evalParse(extend(ctx, { value: e }), groups[0])}`;\n    if (!cache[g]) {\n      order.push(g);\n      cache[g] = [];\n    }\n    cache[g].push(e);\n  }\n\n  for (const k of order) {\n    res.push({ group: k, grouped: groups.length - 1, value: groups.length > 1 ? group(cache[k], groups.slice(1), ctx, level + 1) : cache[k], all: cache[k], level });\n  }\n\n  return res;\n}\n\nfunction hasPipeRef(ref: Reference): boolean {\n  const path = getKeypath(ref);\n  return path.k[0] === '_' || path.p === '@' && path.k[0] === 'pipe';\n}\n\nexport function applyOperator(root: Context, operation: Operation): any {\n  const op = opMap[operation.op];\n\n  // if the operator doesn't exist, try a local, pipe, or skip\n  if (!op) {\n    const local = safeGet(root, operation.op) || safeGet(root.root, operation.op);\n    if (isApplication(local)) {\n      return evalApply(root, local, (operation.args || []).map(a => evalParse(root, a)));\n    } else if (operation.op === 'pipe') { // handle the special built-in pipe operator\n      if (!operation.args || !operation.args.length) return true;\n      let v = evalParse(root, operation.args[0]);\n      for (let i = 1; i < operation.args.length; i++) {\n        let a = operation.args[i];\n        if (isOperation(a) && (!a.args || !a.args.find(a => isReference(a) && hasPipeRef(a)))) a = Object.assign({}, a, { args: [{ r: { k: ['pipe'], p: '@' } } as ValueOrExpr].concat(a.args || []) });\n        \n        if (isApplication(a)) v = evalApply(root, a, [v]);\n        else v = evalParse(extend(root, { special: { pipe: v } }), a);\n      }\n      return v;\n    }\n    return true;\n  }\n\n  let args: any[];\n  if (op.type === 'checked') {\n    args = [];\n    const flts = operation.args || [];\n    const ctx = op.extend ? extend(root, {}) : root;\n    const opts = operation.opts ? evalParse(ctx, operation.opts) : undefined;\n    for (let i = 0; i < flts.length; i++) {\n      const a = flts[i];\n      const arg = evalParse(ctx, a);\n      const res = op.checkArg(operation.op, i, flts.length - 1, arg, opts, ctx, a);\n      if (res === 'continue') args.push(arg);\n      else if ('skip' in res) {\n        i += res.skip;\n        if ('value' in res) args.push(res.value);\n      } else if ('result' in res) return res.result;\n    }\n\n    return op.apply(operation.op, args, opts, ctx);\n  } else if (op.type === 'value') {\n    args = (operation.args || []).map(a => evalParse(root, a));\n    return op.apply(operation.op, args, operation.opts ? evalParse(root, operation.opts) : undefined, root);\n  } else {\n    let arr: any[];\n    const ctx = op.extend ? extend(root, {}) : root;\n    const args = (operation.args || []).slice();\n    const opts = operation.opts ? evalParse(ctx, operation.opts) : undefined;\n    let arg: any;\n    if (!op.value) {\n      arg = evalParse(ctx, args[0]);\n      if (Array.isArray(arg)) {\n        args.shift();\n        arr = arg;\n      } else if (typeof arg === 'object' && 'value' in arg && Array.isArray(arg.value)) {\n        args.shift();\n        arr = arg.value;\n      }\n      if (!arr) {\n        const src = evalValue(ctx, { r: '@source' });\n        if (Array.isArray(src)) arr = src;\n        else if (typeof src === 'object' && 'value' in src && Array.isArray(src.value)) arr = src.value;\n        else arr = [];\n      }\n    }\n    return op.apply(operation.op, Array.isArray(arr) ? arr : [], args, opts, ctx);\n  }\n}\n\nexport interface Keypath {\n  u?: number;\n  p?: '!'|'~'|'*'|'@';\n  k: Array<string|number|Value>;\n}\n\nexport function isKeypath(v: any): v is string|Keypath {\n  return typeof v === 'string' || (typeof v === 'object' && Array.isArray(v.k));\n}\n\nexport function isLiteral(v: any): v is Literal {\n  return typeof v === 'object' && 'v' in v;\n}\n\nexport function isReference(v: any): v is Reference {\n  return typeof v === 'object' && 'r' in v;\n}\n\nexport function isOperation(v: any): v is Operation {\n  return typeof v === 'object' && typeof v.op === 'string';\n}\n\nexport interface Reference { r: string|Keypath; c?: string[] };\nexport interface Application { a: Value; n?: string[]; c?: string[] };\nexport interface Literal { v: any; s?: 1; c?: string[] };\n\nexport function isApplication(v: any): v is Application {\n  if (typeof v !== 'object' || !('a' in v) || typeof v.a !== 'object') return false;\n  const len = Object.keys(v).length;\n  return len === 1 || len === 2 && 'n' in v;\n}\n\n/** A timespan specified in milliseconds */\nexport interface DateRelSpanMS {\n  /** Starting point (now) */\n  f: 'n';\n  /** Offset in ms */\n  o: number;\n  /** Timezone offset */\n  z?: number;\n}\n/** A timespan specified in individual units years, months, days, hours, minutes, seconds, and/or milliseconds */\nexport interface DateRelSpanFull {\n  /** Starting point (now) */\n  f: 'n';\n  /** Offset array [years, months, days, hours, minutes, seconds, milliseconds] */\n  o: [number?, number?, number?, number?, number?, number?, number?];\n  /** Offset direction is before starting point */\n  d?: -1;\n  /** Timezone offset */\n  z?: number;\n}\nexport type DateRelSpan = DateRelSpanMS | DateRelSpanFull;\n\n/** A date span covering last|this|next day|week|month|year */\nexport interface DateRelRange {\n  /** Starting point (d: day, w: week, m: month, y: year) */\n  f: 'd'|'w'|'m'|'y';\n  /** Offset in units (-1: last, 0: this, 1: next) */\n  o: -1|0|1;\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n  /** Timezone offset */\n  z?: number;\n}\n/** A date span by time relative to yesterday, today, or tomorrow */\nexport interface DateRelTimeRange {\n  /** Starting point (day) */\n  f: 'd';\n  /** Offset in units (-1: yesterday, 0: today, 1: tomorrow) */\n  o: -1|0|1;\n  /** Time array [hour, minute, second, millisecond, timezone offset] */\n  t: [number, number?, number?, number?, number?];\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n}\n/** A date span covering this year, month, or week to the current date */\nexport interface DateRelToDate {\n  /** Starting point */\n  f: 'w'|'m'|'y';\n  /** Offset */\n  o: 0;\n  /** Relative to current date */\n  d: 1;\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n  /** Timezone offset */\n  z?: number;\n}\n/** A date range covering a specific range in time at most a year, optionally more specific by scoping farther\n * down with a month, date, hour, minute, second, and millisecond. It may also specify a timezone. */\nexport interface DateExactRange {\n  /** Starting point [year, month, date, hour, minute, second, millisecond, timezone] */\n  f: [number, number?, number?, number?, number?, number?, number?, number?];\n  /** Anchor to the end for non-range usage */\n  e?: 1;\n}\nexport type DateRel = Date | DateRelSpan | DateRelRange | DateRelTimeRange | DateRelToDate | DateExactRange;\n\nexport type TimeSpan = number|TimeSpanMS|FullTimeSpan;\nexport interface TimeSpanMS {\n  ms: number;\n}\nexport interface FullTimeSpan {\n  s?: number;\n  d: [number?, number?, number?, number?, number?, number?, number?];\n}\n\nexport type ValueOrExpr = string|Value;\nexport type Value = Reference | Literal | Operation | Application | ParseError;\n\nexport function isValueOrExpr(o: any): o is ValueOrExpr {\n  return typeof o === 'string' || isValue(o);\n}\n\nexport function isValue(o: any): o is Value {\n  return typeof o === 'object' && o && (\n    ('r' in o && typeof o.r === 'string') ||\n    ('op' in o && typeof o.op === 'string') ||\n    ('v' in o) ||\n    (isApplication(o))\n  );\n}\n\nexport type Parameter<T = any> = ParameterBase & T;\nexport interface ParameterBase {\n  name: string;\n  label?: string;\n  type?: Type;\n  required?: boolean;\n  refine?: string;\n  init?: ValueOrExpr;\n  options?: Array<string|{ label: string; value: any }>;\n}\n\nexport interface ParameterMap {\n  [name: string]: any;\n}\n\nexport function isContext(v: any): v is Context {\n  return typeof v === 'object' && typeof v.path === 'string' && typeof v.root == 'object' && 'value' in v && (typeof v.parent === 'object' || v.root === v);\n}\nexport interface Context {\n  path: string;\n  root: RootContext;\n  parent?: Context;\n  special?: ParameterMap;\n  locals?: ParameterMap;\n  value: any;\n  parser?: ((txt: string) => Value) & { namespace: string };\n}\n\nexport interface RootContext extends Context {\n  parameters: ParameterMap;\n  sources: SourceMap;\n  parent: undefined;\n  exprs: { [ns: string]: { [key: string]: Value } };\n  log: (...v: any[]) => void;\n}\n\nexport class Root implements RootContext {\n  value: any;\n  root: RootContext = this;\n  parameters: ParameterMap = {};\n  sources: SourceMap = {};\n  special: ParameterMap = {};\n  parent: undefined;\n  exprs = {} as { [ns: string]: { [key: string]: Value } };\n  parser?: ((txt: string) => Value) & { namespace: string };\n  path: '' = '';\n  log(v: any[]) {\n    console.log(...v);\n  }\n\n  constructor(root: any = {}, opts?: ExtendOptions & { parameters?: ParameterMap; log?: (...v: any[]) => void }) {\n    this.value = root;\n    if (opts) {\n      Object.assign(this.parameters, opts.parameters);\n      Object.assign(this.special, opts.special);\n      if (opts.parser) this.parser = opts.parser;\n      if (opts.log && typeof opts.log === 'function') this.log = opts.log;\n    }\n  }\n}\n\nexport function join(context: Context, path: string): Context {\n  return {\n    parent: context,\n    root: context.root,\n    path: context.path ? `${context.path}.${path}` : path,\n    value: safeGet(context, path)\n  };\n}\n\nexport interface ExtendOptions {\n  value?: any;\n  special?: any;\n  locals?: ParameterMap,\n  parser?: ((txt: string) => Value) & { namespace: string };\n  path?: string;\n  fork?: boolean;\n}\n\nexport function extend(context: Context, opts: ExtendOptions): Context {\n  return {\n    parent: opts.fork ? (context.parent || context.root) : context,\n    root: context.root,\n    path: opts.path || '',\n    value: 'value' in opts ? opts.value : context.value,\n    special: opts.fork ? Object.assign({}, context.special, { pipe: undefined }, opts.special) : (opts.special || {}),\n    parser: opts.parser,\n    locals: opts.locals,\n  };\n}\n\nexport const formats: { [name: string]: { apply: (value: any, args?: any[], opts?: OperatorOptions) => string, defaults: { [key: string]: any } } } = {};\nexport const virtualFormats: { [name: string]: { defaults: { [key: string]: any } } } = {};\nexport function registerFormat<T = any>(name: string|string[], format: (value: T, args?: any[], opts?: OperatorOptions) => string, defaults: { [key: string]: any } = {}) {\n  if (Array.isArray(name)) name.forEach(n => formats[n] = { apply: format, defaults });\n  else formats[name] = { apply: format, defaults };\n}\nexport function unregisterFormat(name: string) {\n  delete formats[name];\n}\n\nexport function dateRelToRange(rel: DateRel): [Date, Date] {\n  if (rel instanceof Date) return [rel, rel];\n\n  let from = new Date();\n  let to: Date = 'd' in rel && rel.d ? new Date() : undefined;\n  from.setUTCFullYear(from.getFullYear(), from.getMonth(), from.getDate());\n  from.setUTCHours(0, 0, 0, 0);\n  let tz: number = 'z' in rel && rel.z != null ? rel.z : null;\n\n  if (rel.f === 'n') { // DateRelSpan (MS or Full)\n    from = typeof rel.o === 'number' ? new Date(+new Date() + rel.o) : dateAndTimespan(new Date(), { d: rel.o }, 'd' in rel ? rel.d : 1);\n    to = from;\n    tz = undefined;\n  } else if (rel.f === 'd') { // DateRelRange - day\n    from.setUTCDate(from.getUTCDate() + rel.o);\n    if (!to) to = new Date(from);\n    if ('t' in rel) { // DateRelTimeRange\n      const t = rel.t;\n      from.setUTCHours(t[0], t[1] || 0, t[2] || 0, t[3] || 0);\n      to.setUTCHours(t[0], t[1] == null ? 59 : t[1], t[2] == null ? 59 : t[2], t[3] == null ? 999 : t[3]);\n      if (t[4] != null) tz = t[4];\n    }\n  } else if (rel.f === 'w') { // DateRelRange - week\n    from.setUTCDate(from.getUTCDate() - (from.getUTCDay() + (rel.o === -1 ? 7 : rel.o === 1 ? -7 : 0)));\n    if (!to) {\n      to = new Date(from);\n      to.setDate(from.getUTCDate() + 6);\n    }\n    if ('z' in rel && rel.z != null) tz = rel.z;\n  } else if (rel.f === 'm') { // DateRelRange - month\n    from.setUTCDate(1);\n    from.setUTCMonth(from.getUTCMonth() + rel.o);\n    if (!to) {\n      to = new Date(from);\n      to.setUTCMonth(from.getUTCMonth() + 1);\n      to.setUTCDate(0);\n    }\n  } else if (rel.f === 'y') { // DateRelRange - year\n    from.setUTCDate(1);\n    from.setUTCMonth(0);\n    from.setUTCDate(1);\n    if (!to) {\n      to = new Date(from);\n      to.setUTCFullYear(from.getUTCFullYear() + 1);\n      to.setUTCDate(0);\n    }\n  } else if (Array.isArray(rel.f)) { // DateExactRange\n    const v = rel.f.slice();\n    from = new Date(Date.UTC(v[0], v[1] || 0, v[2] || 1, v[3] || 0, v[4] || 0, v[5] || 0, v[6] || 0));\n    for (let i = 1; i < 7; i++) {\n      if (v[i] == null) {\n        v[i - 1]++;\n        break;\n      }\n    }\n    if (v[6] != null) v[6]++;\n    to = new Date(Date.UTC(v[0], v[1] || 0, v[2] || 1, v[3] || 0, v[4] || 0, v[5] || 0, v[6] || 0));\n    to.setUTCMilliseconds(to.getUTCMilliseconds() - 1);\n    if (v[7] != null) tz = v[7];\n  }\n\n  if (rel.f === 'd' || rel.f === 'w' || rel.f === 'm' || rel.f === 'y') to.setUTCHours(23, 59, 59, 999);\n\n  if (tz !== undefined) {\n    if (tz != null) {\n      from.setUTCMinutes(from.getUTCMinutes() - tz);\n      if (from !== to) to.setUTCMinutes(to.getUTCMinutes() - tz);\n    } else { // shift to local time\n      const offset = from.getTimezoneOffset();\n      from.setUTCMinutes(from.getUTCMinutes() + offset);\n      if (from !== to) to.setUTCMinutes(to.getUTCMinutes() + offset);\n    }\n  }\n\n  return [from, to];\n}\n\nexport function isDateRel(v: any): v is DateRel {\n  return v && typeof v === 'object' && (('f' in v && (Array.isArray(v.f) || 'o' in v)) || v instanceof Date);\n}\n\nexport function isDateExactRange(v: any): v is DateExactRange {\n  return v && typeof v === 'object' && 'f' in v && Array.isArray(v.f);\n}\n\nexport function dateRelToDate(rel: DateRel): Date {\n  const range = dateRelToRange(rel);\n  if ('e' in rel && rel.e != null) return range[1];\n  else return range[0];\n}\n\nexport function dateRelToExactRange(rel: DateRel): DateExactRange {\n  if (!rel) return;\n  if (isDateExactRange(rel)) return rel;\n  const dt = dateRelToDate(rel);\n  const offset = dt.getTimezoneOffset();\n  const z = 'z' in rel && rel.z != null ? rel.z : 'f' in rel && rel.f === 'd' && 't' in rel && rel.t[4] != null ? rel.t[4] : null;\n  if (rel instanceof Date && z != null) dt.setMinutes(dt.getMinutes() - (offset + z));\n  return {\n    f: [dt.getFullYear(), dt.getMonth(), dt.getDate(), dt.getHours(), dt.getMinutes(), dt.getSeconds(), dt.getMilliseconds(), z != null ? z : -offset],\n  };\n}\n\nexport function isTimespan(v: any): v is TimeSpan {\n  return typeof v === 'number' || (typeof v === 'object' && Array.isArray(v.d)) || isTimespanMS(v);\n}\n\nexport function addTimespan(l: TimeSpan, r: TimeSpan): TimeSpan {\n  if (typeof l === 'number' && typeof r === 'number') return l + r;\n  else {\n    const res: TimeSpan = { d: [] };\n    if (typeof l === 'number') res.d[6] = l;\n    else if (isTimespanMS(l)) res.d[6] = l.ms;\n    else for (let i = 0; i < 7; i++) if (l.d[i]) res.d[i] = l.d[i];\n\n    if (typeof r === 'number') res.d[6] = (res.d[6] || 0) + r;\n    else if (isTimespanMS(r)) res.d[6] = (res.d[6] || 0) + r.ms;\n    else for (let i = 0; i < 7; i++) if (r.d[i]) res.d[i] = (res.d[i] || 0) + r.d[i];\n    return res;\n  }\n}\n\nexport function subtractTimespan(l: TimeSpan, r: TimeSpan): TimeSpan {\n  if (typeof l === 'number' && typeof r === 'number') return l - r;\n  else {\n    if (isTimespanMS(l)) l = l.ms;\n    if (isTimespanMS(r)) r = r.ms;\n    if (typeof l === 'number') {\n      const res = ({ d: (r as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      for (let i = 0; i < 7; i++) if (res.d[i]) res.d[i] = 0 - res.d[i];\n      res.d[6] = (res.d[6] || 0) + l;\n      return res;\n    } else if (typeof r === 'number') {\n      const res = ({ d: (l as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      res.d[6] = (res.d[6] || 0) - r;\n      return res;\n    } else {\n      const res = ({ d: (l as FullTimeSpan).d.slice() }) as FullTimeSpan;\n      for (let i = 0; i < 7; i++) if (r.d[i]) l.d[i] = (l.d[i] || 0) - r.d[i];\n      return res;\n    }\n  }\n}\n\nexport function datesDiff(l: Date, r: Date): FullTimeSpan {\n  if (isNaN(+l) || isNaN(+r)) return { d: [] };\n  if (r < l) {\n    const s = r;\n    r = l;\n    l = s;\n  }\n  const a = new Date(l);\n  const b = r;\n  const res: FullTimeSpan = { d: [0, 0, 0, 0, 0, 0, 0], s: +a };\n  let num = b.getFullYear() - a.getFullYear() - 1;\n  let tmp1: number, tmp2: number;\n  if (num > 0) {\n    res.d[0] += num;\n    a.setFullYear(b.getFullYear() - 1);\n  }\n  a.setFullYear(a.getFullYear() + 1);\n  if (a > b) a.setFullYear(a.getFullYear() - 1);\n  else res.d[0]++;\n\n  // watch out for leap year\n  if (l.getMonth() === 1 && l.getDate() === 29 && a.getMonth() !== 1) {\n    a.setDate(29);\n    a.setMonth(1);\n  }\n\n  // jumping months can make days get weird\n  while (true) {\n    num = a.getDate();\n    tmp1 = a.getMonth();\n    tmp2 = a.getFullYear();\n    a.setDate(num + 1);\n    if (a.getMonth() !== tmp1) {\n      a.setDate(1);\n      a.setFullYear(tmp2);\n      a.setMonth(tmp1 + 2);\n      a.setDate(0);\n    } else {\n      a.setDate(num);\n      a.setMonth(tmp1 + 1);\n      if (tmp1 === 11 ? a.getMonth() !== 0 : a.getMonth() !== tmp1 + 1) {\n        a.setDate(1);\n        a.setFullYear(tmp2);\n        a.setMonth(tmp1 + 2);\n        a.setDate(0);\n      }\n    }\n    if (a > b) {\n      // make sure we stay in the correct year\n      a.setFullYear(tmp2);\n      a.setDate(1);\n      a.setMonth(tmp1);\n      a.setDate(num);\n      break;\n    } else res.d[1]++;\n  }\n\n  while (true) {\n    a.setDate(a.getDate() + 1);\n    if (a > b) {\n      a.setDate(a.getDate() - 1);\n      break;\n    } else res.d[2]++;\n  }\n\n  while (true) {\n    a.setHours(a.getHours() + 1);\n    if (a > b) {\n      a.setHours(a.getHours() - 1);\n      break;\n    } else res.d[3]++;\n  }\n\n  while (true) {\n    a.setMinutes(a.getMinutes() + 1);\n    if (a > b) {\n      a.setMinutes(a.getMinutes() - 1);\n      break;\n    } else res.d[4]++;\n  }\n\n  while (true) {\n    a.setSeconds(a.getSeconds() + 1);\n    if (a > b) {\n      a.setSeconds(a.getSeconds() - 1);\n      break;\n    } else res.d[5]++;\n  }\n\n  if (a.getMilliseconds() <= b.getMilliseconds()) res.d[6] = b.getMilliseconds() - a.getMilliseconds();\n  else res.d[6] = (1000 - a.getMilliseconds()) + b.getMilliseconds();\n\n  return res;\n}\n\nexport function dateAndTimespan(l: Date, r: TimeSpan, m: 1|-1): Date {\n  if (typeof r === 'number') return new Date(+l + r * m);\n  else if (isTimespanMS(r)) return new Date(+l + r.ms * m);\n  else {\n    let d = new Date(l);\n    if (r.d[0]) d.setFullYear(d.getFullYear() + r.d[0] * m);\n    if (r.d[1]) {\n      const dd = d.getDate();\n      d.setDate(1);\n      d.setMonth(d.getMonth() + r.d[1] * m);\n      const mm = d.getMonth();\n      d.setDate(dd);\n      if (mm !== d.getMonth()) d.setDate(0);\n    }\n    if (r.d[2]) d.setDate(d.getDate() + r.d[2] * m);\n    if (r.d[3]) d.setHours(d.getHours() + r.d[3] * m);\n    if (r.d[4]) d.setMinutes(d.getMinutes() + r.d[4] * m);\n    if (r.d[5]) d.setSeconds(d.getSeconds() + r.d[5] * m);\n    if (r.d[6]) d.setMilliseconds(d.getMilliseconds() + r.d[6] * m);\n    return d;\n  }\n}\n","import { Displayed, Placement } from '../report';\nimport { Context } from '../data/index';\n\nexport interface RenderContext {\n  parent?: RenderContext;\n  report: Displayed;\n  styles: StyleRegistry;\n  styleMap: StyleMap;\n  context: Context;\n  commit?: { [name: string]: any };\n}\n\nexport interface StyleRegistry {\n  [id: string]: string;\n}\n\ninterface StyleMap {\n  ids: { [id: string]: number };\n  styles: StyleRegistry;\n}\n\nexport function addStyle(context: RenderContext, id: string, style: string) {\n  if (!context.styles[id]) context.styles[id] = style;\n}\n\nexport function error(context: RenderContext, placement: Placement, message: string = 'Widget overflow error') {\n    addStyle(context, 'error', `.error { position: absolute; box-sizing: border-box; color: red; border: 1px dotted; width: 100%; height: 2rem; padding: 0.5rem; }`);\n    return { output: `<div class=\"error\" style=\"top: ${placement.y}rem;\">${message}</div>`, height: 2 };\n}\n","import { Displayed, Layout, Placement, Widget, Margin, MeasureFont, Computed, Borders } from '../report';\nimport { extend as extendContext, Context, ExtendOptions as ContextExtendOptions, evaluate, isValueOrExpr } from '../data/index';\nimport { error, RenderContext, addStyle } from './error';\n\nexport { RenderContext, error, addStyle } from './error';\n\nexport function isComputed(v: any): v is Computed {\n  return v && typeof v === 'object' && isValueOrExpr(v.x);\n}\n\nexport function maybeComputed<V, T = Exclude<V, Computed>>(v: V, context: RenderContext): T {\n  if (!isComputed(v)) return v as any;\n  else if (v.x) return evaluate(context, v.x);\n}\n\nexport interface ExtendOptions extends ContextExtendOptions {\n  commit?: { [key: string]: any };\n}\n\nexport function extend(context: RenderContext, opts: ExtendOptions): RenderContext {\n  return { parent: context, report: context.report, context: extendContext(context.context, opts), styles: context.styles, styleMap: context.styleMap, commit: opts.commit };\n}\n\nconst htmlChars = /[><&]/g;\nconst htmlReplace = { '<': '&lt;', '>': '&gt;', '&': '&amp;' };\nexport function escapeHTML(html: string): string {\n  return ('' + html).replace(htmlChars, m => htmlReplace[m] || '');\n}\n\nconst renderers: { [type: string]: Renderer } = {};\nexport function registerRenderer<T extends Widget = Widget, S = any>(type: string, renderer: ((widget: T, context: RenderContext, placement: Placement, state?: RenderState<S>) => RenderResult<S>) | Renderer<T, S>, options?: RendererOptions) {\n  renderers[type] = typeof renderer === 'function' ? { render: renderer } : renderer;\n  if (options) Object.assign(renderers[type], options);\n}\n\n/** Decent guesstimates for char width at 16px/em */\nconst avgs = {\n  sans: 7.4,\n  serif: 6.7,\n  mono: 7.85,\n  narrow: 5.9,\n}\n\n/** Text height measurement function for the given text, font, available width in rem, and line height in rem.\n * The text is assumed to be rendered as white-space: pre-wrap.\n */\nexport function measureEstimate(text: string, width: number, context: RenderContext, font?: MeasureFont): number {\n  const family = (font && maybeComputed(font.family, context)) || 'sans';\n  const size = (font && maybeComputed(font.size, context)) || 0.83;\n  const line = (font && maybeComputed(font.line, context)) || size;\n  const brw = font && 'break-word' in font ? font['break-word'] : true;\n  const avg = (((font && maybeComputed(font.metric, context)) || ((family === 'mono' || /fixed|mono/i.test(family) ? avgs.mono :\n    family === 'narrow' || /narrow|condensed/i.test(family) ? avgs.narrow :\n      family === 'sans' || /sans|arial|helvetica/i.test(family) ? avgs.sans :\n        avgs.serif))) * size) / 16;\n  \n  const lines = text.split(/\\r?\\n/g);\n  return lines.reduce((a, c) => {\n    const [word, lines] = c.split(/\\s|-/g).reduce((a, c) => {\n      const wlen = (c.length + 1) * avg;\n      if (a[0] + wlen > width) {\n        if (a[0] === 0 || wlen > width) {\n          if (brw) {\n            a[0] = (wlen - (width - a[0])) % width;\n            if (wlen > width) a[1] += Math.floor(wlen / width);\n          }\n          a[1]++;\n        } else {\n          a[0] = wlen;\n          a[1]++;\n        }\n      } else {\n        a[0] += wlen;\n      }\n      return a;\n    }, [0, 0]);\n    return a + ((lines + (word > 0 ? 1 : 0)) || 1);\n  }, 0) * line;\n}\n\n/** Text height measurement function for the given text, font, available width in rem, and line height in rem.\n * The text is assumed to be rendered as white-space: pre-wrap.\n */\nexport let measure: (text: string, width: number, context: RenderContext, font?: MeasureFont) => number = measureEstimate;\n\nexport interface RenderContinuation<T = any> {\n  output: string;\n  continue?: RenderState<T>;\n  height?: number;\n  width?: number;\n  cancel?: boolean;\n}\n\nexport type RenderResult<T = any> = string|RenderContinuation<T>;\n\nexport interface Renderer<T extends Widget = Widget, S = any> extends RendererOptions {\n  render(widget: T, context: RenderContext, placement: Placement, state?: RenderState<S>): RenderResult;\n}\n\nexport interface RendererOptions {\n  container?: boolean;\n}\n\nexport interface RenderState<T = any> {\n  child?: RenderState;\n  last?: number;\n  state?: T;\n  offset: number;\n  attempt?: number;\n}\n\n/** Render the given widget to string or a continuation using a registered renderer */\nexport function renderWidget(w: Widget, context: RenderContext, placement: Placement, state?: RenderState): RenderContinuation {\n  const renderer = renderers[w.type];\n  if (!renderer || (w.hide && evaluate(extendContext(context.context, { special: { widget: w, placement } }), w.hide))) return { output: '', height: 0 };\n\n  if (!('height' in w) && renderer.container) w.height = 'auto'; \n  const h = getHeightWithMargin(w, placement, context);\n\n  if (placement.maxY && !isNaN(h) && h > placement.maxY) return error(context, placement);\n\n  if (placement.availableY != null && h > placement.availableY) return { output: '', continue: { offset: 0 }, cancel: true };\n\n  let extraHeight = 0;\n\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    extraHeight += m[0] + m[2];\n    if (placement.availableY != null) placement.availableY -= m[0] + m[2];\n  }\n\n  if (w.border && !h && w.box === 'expand') {\n    const b = expandBorder(w, context, placement)\n    extraHeight += b[0] + b[2];\n    if (placement.availableY != null) placement.availableY -= b[0] + b[2];\n  }\n\n  const r = renderer.render(w, context, placement, state);\n  if (typeof r === 'string') return { output: r, height: h, width: getWidthWithMargin(w, placement, context) };\n\n  if (typeof r.height === 'number') r.height = +r.height.toFixed(6);\n  if (typeof r.width === 'number') r.width = +r.width.toFixed(6);\n  if (placement.availableY != null) placement.availableY = +placement.availableY.toFixed(6);\n  \n  if (placement.maxY && r.height > placement.maxY) return error(context, placement);\n\n  if (isNaN(h) && placement.availableY != null && r.height > placement.availableY) return { output: '', continue: { offset: 0 }, height: r.height || 0, cancel: true };\n\n  r.height = r.height || 0;\n\n  r.height += extraHeight;\n\n  r.height = +(r.height.toFixed(6));\n\n  return r;\n}\n\nconst layouts: { [name: string]: (widget: Widget, offset: number, margin: [number, number, number, number], placement: Placement, placements: Array<[number, number, number, number]>, context: RenderContext) => Placement } = {};\n\nexport function registerLayout(name: string, layout: (widget: Widget, offset: number, margin: [number, number, number, number], placement: Placement, placements: Array<[number, number, number, number]>, context: RenderContext) => Placement) {\n  layouts[name] = layout;\n}\n\nregisterLayout('row', (w, o, m, p, ps, context) => {\n  let n: Placement;\n  let br = isComputed(w.br) ? evaluate(extendContext(context.context, { special: { placement: p, widget: w } }), w.br.x) : w.br;\n  let availableX = p.maxX - ps[0][0] - ps[0][2] + ps[ps.length - 1][0];\n  if (availableX <= 0) {\n    availableX = p.maxX;\n    br = true;\n  }\n  if (br || ps[0][0] + ps[0][2] + getWidthWithMargin(w, { x: p.x, y: p.y, maxX: p.maxX, maxY: p.maxY, availableY: p.availableY, availableX }, context) - ps[ps.length - 1][0] > p.maxX) {\n    n = { x: m[3], y: maxYOffset(ps), availableX: p.maxX, maxX: p.maxX };\n    n.availableY = p.availableY - (n.y - o);\n  } else {\n    n = { x: ps[0][0] + ps[0][2], y: ps[0][1], availableX, maxX: p.maxX, availableY: p.availableY };\n  }\n\n  n.y -= o;\n\n  return n;\n});\n\n/** Render child widgets handling continuation across pages */\nexport function renderWidgets(widget: Widget, context: RenderContext, placement: Placement, state?: RenderState, layout?: Layout): RenderContinuation {\n  if (Array.isArray(widget.widgets)) {\n    let s = '';\n    const offset = (state || { offset: 0 }).offset;\n    const ps: Array<[number, number, number, number]> = [[0, offset, 0, 0]];\n\n    const m = expandMargin(widget, context, placement);\n    ps[0][0] += m[3];\n    ps[0][1] += m[0];\n\n    // placement starts with availableY shrunk for margins, so offset y by the top margin\n    const yo = m[0] || 0;\n\n    if (widget.border && widget.box === 'expand') {\n      const b = expandBorder(widget, context, placement);\n      if (placement.availableX != null) placement.availableX -= b[1] + b[3];\n      if (placement.availableY != null) placement.availableY -= b[0] + b[2];\n    }\n\n    for (let i = state && state.last || 0; i < widget.widgets.length; i++) {\n      let w: Widget = widget.widgets[i];\n      if (w.macro) w = expandMacro(w.macro, w, context, placement, state);\n      if (w.hide && evaluate(extendContext(context.context, { special: { widget: w, placement } }), w.hide)) continue;\n\n      // allow widgets that are taller than max height to be dropped\n      let h = placement && getHeightWithMargin(w, placement, context);\n      if (h > placement.maxY) h = 1;\n\n      if (placement && placement.availableY != null && h > placement.availableY) {\n        const offset = maxYOffset(ps);\n        state = state || { offset };\n        state.last = i;\n        return { output: s, continue: state, height: offset };\n      } else {\n        let lp = Array.isArray(layout) && (layout[i] || [0, 0]);\n        if (!lp || !Array.isArray(lp)) lp = [0, 0];\n        if (!lp[0]) lp[0] = 0;\n        if (!lp[1]) lp[1] = 0;\n        let p: Placement = Array.isArray(lp) ? { x: lp[0] < 0 ? lp[0] : lp[0] + m[3], y: lp[1] < 0 ? lp[1] : lp[1] + m[0], maxX: placement.maxX } : (lp || placement);\n        if (Array.isArray(lp)) p.availableX = p.maxX;\n\n        if (!layout || typeof layout === 'string') {\n          const l = layout ? layouts[layout as string] || layouts.row : layouts.row;\n          p = l(w, offset, m, placement, ps, context);\n          if (h > p.availableY) {\n            if (w.height === 'grow') h = getHeightWithMargin(w, p, context);\n            if (h > p.availableY) {\n              const offset = maxYOffset(ps);\n              state = state || { offset };\n              state.last = i;\n              return { output: s, continue: state, height: offset };\n            }\n          }\n        }\n\n        p.maxX = p.maxX || placement.maxX;\n        p.maxY = p.maxY || placement.maxY;\n\n        if (p.x < 0) {\n          p.offsetX = m[3];\n          p.x = (placement.availableX || 1) + p.x - getWidthWithMargin(w, placement, context) + 1;\n        }\n        if (p.y < 0) {\n          p.offsetY = m[0];\n          if (placement.availableY == null) p.y = 0;\n          else p.y = (placement.availableY || 1) + p.y - h + 1;\n        }\n\n        const { x, y } = p;\n        const r = renderWidget(w, context, p, state && state.child);\n\n        // skip empty output\n        if (typeof r === 'string' && !r || (!r.cancel && !r.output && !r.continue && !r.height)) continue;\n\n        if (typeof r === 'string') {\n          s += r;\n          ps.unshift([x, y, getWidthWithMargin(w, placement, context), getHeightWithMargin(w, placement, context)]);\n        } else {\n          if (r.cancel) return { output: '', cancel: true };\n          const h = r.height || getHeightWithMargin(w, placement, context) || 0;\n          if (y - yo + h > placement.availableY) {\n            const offset = maxYOffset(ps);\n            state = state || { offset };\n            state.last = i;\n            state.attempt = (+state.attempt || 0) + 1;\n            if (state.attempt > 1) return error(context, placement);\n            return { output: s, continue: state, height: offset };\n          }\n          s += r.output;\n          ps.unshift([x, y, r.width || getWidthWithMargin(w, placement, context), h]);\n          if (r.continue) {\n            state = state || { offset: 0 };\n            state.child = r.continue;\n            state.last = i;\n            state.offset = maxYOffset(ps);\n            return { output: s, continue: state, height: maxYOffset(ps), width: maxXOffset(ps) };\n          }\n        }\n\n        if (p.availableX === 0) ps[0][2] = p.maxX;\n      }\n    }\n\n    return { output: s, height: getHeightWithMargin(widget, placement, context) || maxYOffset(ps) - m[0], width: getWidthWithMargin(widget, placement, context) || maxXOffset(ps) - m[3] };\n  }\n  return { output: '', height: 0 };\n}\n\nexport function getWidth(w: Widget, placement: Placement, context: RenderContext): number {\n  let width = isComputed(w.width) ? evaluate(extendContext(context.context, { special: { widget: w, placement} }), w.width.x) : w.width;\n  const m = w.margin && expandMargin(w, context, placement);\n  let pct = false;\n  if (width === 'grow') width = placement.availableX || placement.maxX;\n  else if (!width && width !== 0) width = placement.maxX || 51;\n  else if (typeof width === 'number') width;\n  else {\n    width = +((width.percent / 100) * (placement.maxX || 51)).toFixed(4);\n    pct = true;\n  }\n  if (typeof width === 'number' && (w.box === 'contain' || (pct || width === placement.availableX) && w.box !== 'expand')) {\n    if (m) width -= m[1] + m[3];\n    else if (w.font && w.font.right) width -= w.font.right;\n  }\n  return width;\n}\n\nexport function getWidthWithMargin(w: Widget, placement: Placement, context: RenderContext): number {\n  let r = getWidth(w, placement, context);\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    r += m[1] + m[3];\n  } else if (w.font && w.font.right) {\n    r += w.font.right;\n  }\n  return r;\n}\n\nfunction maxFontSize(w: Widget) {\n  let n = w.height || 1;\n  if (w.font && w.font.size > n) n = w.font.size;\n  if ('text' in w && Array.isArray(w.text)) {\n    for (let i = 0; i < w.text.length; i++) {\n      const t = w.text[i];\n      if (typeof t === 'object' && 'font' in t && t.font && t.font.size > n) n = t.font.size;\n    }\n  }\n  return n;\n}\n\nexport function getHeight(w: Widget, placement: Placement, context: RenderContext, computed?: number, linesize?: boolean): number {\n  let r = 1;\n  let h = isComputed(w.height) ? evaluate(extendContext(context.context, { special: { widget: w, placement, computed, linesize } }), w.height.x) : w.height;\n  const m = w.margin && expandMargin(w, context, placement);\n  const b = w.border && expandBorder(w, context, placement);\n  let pct = false;\n  if (h == null && linesize) h = maxFontSize(w);\n\n  if (typeof h === 'number') r = h;\n  else if (h && typeof h === 'object' && 'percent' in h && h.percent && placement.maxY) {\n    r = +(placement.maxY * (h.percent / 100)).toFixed(4);\n    pct = true;\n  } else if (h === 'grow') {\n    r = placement.availableY || 0;\n  } else if (h === 'auto' || typeof h === 'string' || (h == null && w.type === 'container') || (computed && !h)) {\n    if (b && w.box === 'expand') return computed + b[0] + b[2] || NaN;\n    return computed || NaN;\n  }\n\n  if (typeof r === 'number' && (w.box === 'contain' || (pct || r === placement.availableY) && w.box !== 'expand')) {\n    if (m) r -= m[0] + m[2];\n  }\n\n  return r;\n}\n\nexport function getHeightWithMargin(w: Widget, placement: Placement, context: RenderContext, computed?: number, linesize?: boolean): number {\n  let h = getHeight(w, placement, context, computed, linesize);\n  if (typeof h === 'number' && w.margin) {\n    const m = expandMargin(w, context, placement);\n    h += m[0] + m[2];\n  }\n  return h;\n}\n\nfunction maxYOffset(points: Array<[number, number, number, number]>): number {\n  return points.reduce((a, c) => a > c[1] + c[3] ? a : c[1] + c[3], 0);\n}\n\nfunction maxXOffset(points: Array<[number, number, number, number]>): number {\n  return points.reduce((a, c) => a > c[0] + c[2] ? a : c[0] + c[2], 0);\n}\n\nexport function expandMargin(w: { margin?: Margin|Computed }, context: RenderContext, placement: Placement): [number, number, number, number] {\n  if (w.margin) {\n    const m = isComputed(w.margin) ? evaluate(extendContext(context.context, { special: { widget: w, placement} }), w.margin.x) : w.margin;\n    if (Array.isArray(m)) {\n      if (m.length === 4) return m.map(e => +e) as [number, number, number, number];\n      else if (m.length === 2) return [+m[0], +m[1], +m[0], +m[1]];\n    } else if (typeof m === 'number') return [m, m, m, m];\n  }\n\n  return [0, 0, 0, 0];\n}\n\nexport function expandBorder(w: { border?: number|number[]|Borders|string }, context: RenderContext, placement: Placement): [number, number, number, number] {\n  let b = w.border;\n  let res: [number, number, number, number] = [0, 0, 0, 0];\n  if (typeof b === 'string' || (b && !Array.isArray(b) && typeof b === 'object' && ('v' in b || 'r' in b || 'op' in b))) b = evaluate(extendContext(context.context, { special: { widget: w, placement } }), b as string);\n  if (typeof b === 'number') res = [0, 0, b, 0];\n  else if (Array.isArray(b)) {\n    if (b.length === 1) res = [b[0], b[0], b[0], b[0]];\n    else if (b.length === 2) res = [b[0], b[1], b[0], b[1]];\n    else if (b.length === 3) res = [b[0], b[1], b[2], b[1]];\n    else if (b.length >= 4) res = [b[0], b[1], b[2], b[3]];\n  } else if (b && typeof b === 'object') res = [b.top || 0, b.right || 0, b.bottom || 0, b.left || 0]\n\n  for (let i = 0; i < 4; i++) res[i] = res[i] * 0.0625;\n  return res;\n}\n\nexport function expandMacro(macro: string, w: Widget, ctx: RenderContext, placement: Placement, state: RenderState): Widget {\n  const res = evaluate(extendContext(ctx.context, { special: { widget: w, placement, state } }), macro);\n  const orig = w;\n  if (res && !Array.isArray(res) && typeof res === 'object') {\n    if ('content' in res || 'props' in res || 'properties' in res) w = Object.assign({}, w, res.props, res.properties, { widgets: Array.isArray(res.content) ? res.content : res.content ? [res.content] : w.widgets, macro: undefined });\n    else if ('replace' in res && res.replace && typeof res.replace === 'object' && 'type' in res.replace) return res.replace;\n    else w = Object.assign({}, w, { widgets: [res], macro: undefined });\n  } else if (Array.isArray(res)) w = Object.assign({}, w, { widgets: res, macro: undefined });\n  return w;\n}\n","import { Borders, Font, Placement, Widget } from '../report';\nimport { expandMargin, expandBorder, getHeightWithMargin, maybeComputed, getWidthWithMargin, RenderContext } from './index';\nimport { ValueOrExpr } from '../data/index';\n\nexport interface StyleOptions {\n  computedHeight?: number;\n  container?: boolean;\n  lineSize?: boolean;\n  font?: Font;\n}\n\nexport function nextStyleId(ctx: RenderContext, prefix: string): number {\n  if (!ctx.styleMap.ids[prefix]) ctx.styleMap.ids[prefix] = 0;\n  return ctx.styleMap.ids[prefix]++;\n}\n\nexport function mapStyle(ctx: RenderContext, style: string, prefix: string): string {\n  if (!style) return '';\n  const mapped = ctx.styleMap.styles[style];\n  if (mapped) return mapped;\n  const id = `${prefix}${nextStyleId(ctx, prefix)}`;\n  return ctx.styleMap.styles[style] = id;\n}\n\nexport function styleClass(ctx: RenderContext, cls: string[], [style, inline]: [string, string], inlineStyle?: string, classPrefix?: string): string {\n  if (ctx.report.classifyStyles !== false) {\n    const cs = [];\n    if (inline) cs.push(mapStyle(ctx, inline, 'h'));\n    cs.push(mapStyle(ctx, style, classPrefix || 's'));\n    return ` class=\"${cls.concat(cs).join(' ')}\"${inlineStyle ? ` style=\"${inlineStyle}\"` : ''}`;\n  } else {\n    const s = `${style}${inlineStyle || ''}${inline || ''}`;\n    const c = `${cls.length ? ` class=\"${cls.join(' ')}\"` : ''}`;\n    return `${c}${s ? ` style=\"${s}\"` : ''}`;\n  }\n}\n\nexport function style(w: Widget, placement: Placement, context: RenderContext, opts?: StyleOptions): [string, string] {\n  let s = `left:${(placement.x || 0) + (placement.offsetX || 0)}rem;top:${((placement.y || 0) + (placement.offsetY || 0))}rem;`;\n  let i = ``;\n\n  s += `width:${getWidthWithMargin(w, placement, context)}rem;`;\n\n  let h = getHeightWithMargin(w, placement, context, opts && opts.computedHeight, opts && opts.lineSize) || 1;\n  if (w.height === 'grow' && w.margin) {\n    const m = expandMargin(w, context, placement);\n    h += m[0] + m[2];\n  }\n  if (opts && opts.container && opts.computedHeight) i = `height:${h}rem;`;\n  else s += `height:${h}rem;`;\n\n  const line = w.font && maybeComputed(w.font.line, context);\n  const size = w.font && maybeComputed(w.font.size, context);\n  if (line != null || size != null) s += `line-height: ${line ?? size}rem;`;\n\n  if (w.margin) {\n    const m = expandMargin(w, context, placement);\n    if (m[0] || m[1] || m[2] || m[3]) s += `padding:${m[0]}rem ${m[1]}rem ${m[2]}rem ${m[3]}rem;`;\n  } else if (w.font && w.font.right) {\n    s += `padding-right:${w.font.right}rem;`;\n  }\n  \n  if ((opts && opts.font) || w.font) s += styleFont((opts && opts.font) || w.font, context);\n  if (w.border) s += styleBorder(w, context, placement);\n\n  s += styleExtra(w, context);\n\n  return [s, i];\n}\n\nexport function styleExtra(w: { bg?: ValueOrExpr; radius?: ValueOrExpr }, context: RenderContext): string {\n  let s = '';\n\n  const bg = maybeComputed(w.bg, context);\n  if (bg) s += `background-color:${bg};`;\n\n  const radius = maybeComputed(w.radius, context);\n  if (radius) s += `border-radius:${radius};`;\n\n  return s;\n}\n\nexport function styleFont(f: Font, context: RenderContext): string {\n  if (!f) return '';\n  let t: any;\n  let size: any;\n  let s = '';\n  if (t = maybeComputed(f.family, context)) s += `font-family:${t};`;\n  if (t = maybeComputed(f.color, context)) s += `color:${t};`;\n  if (t = maybeComputed(f.align, context)) s += `text-align:${t};`;\n  if (t = maybeComputed(f.size, context)) {\n    s += `font-size:${t}rem;`;\n    size = t;\n  }\n\n  t = maybeComputed(f.line, context);\n  if (t === 0) s += `line-height:initial;`;\n  else if (t != null) s += `line-height:${t}rem;`;\n  else if (size) s += `line-height:${size}rem;`;\n\n  if (t = maybeComputed(f.weight, context)) s += `font-weight:${t};`;\n  if (t = maybeComputed(f.pre, context)) s += `white-space:pre-wrap;word-break:break-word;`;\n  const pre = t;\n  if (t = maybeComputed(f.clamp, context)) s += `${pre ? '' : 'white-space:nowrap;'}overflow:hidden;`;\n  return s;\n}\n\nexport function styleBorder(w: { border?: number|Borders|number[]|string }, context: RenderContext, placement: Placement): string {\n  const b = expandBorder(w, context, placement);\n  if (b[0] + b[1] + b[2] + b[3]) return `border-style:solid;border-width:${b[0]}rem ${b[1]}rem ${b[2]}rem ${b[3]}rem;`;\n  return '';\n}\n\nexport function styleImage(fit?: string): [string, string] {\n  const s = `background-size:${!fit || fit === 'contain' ? 'contain;background-position:center' : fit === 'stretch' ? '100% 100%' : 'cover'};`;\n  \n  return [s, ''];\n}\n","import { Sort, ValueOrExpr, Parameter, ParameterMap, SourceMap, Root, Context, RootContext, extend, evaluate, filter, toDataSet } from './data/index';\n\nimport { renderWidget, RenderContext, RenderResult, RenderState, expandMargin, expandMacro } from './render/index';\nimport { styleClass, styleFont } from './render/style';\n\nimport { parse } from './data/parse';\nimport { parse as parseTemplate } from './data/parse/template';\n\nexport type ReportType = 'delimited'|'flow'|'page';\n\nexport type Report<T = {}> = Delimited<T> | Flow<T> | Page<T>;\n\nexport interface PartSource {\n  /** Filters to apply to the base value of the data source */\n  filter?: ValueOrExpr;\n  /** Sorts to apply to the base value of the data source */\n  sort?: Sort[]|ValueOrExpr;\n  /** Groupings to apply to the base data source */\n  group?: Array<ValueOrExpr>|ValueOrExpr;\n  /** An expression to apply to the base data source before filtering, sorting, or grouping */\n  base?: ValueOrExpr;\n  /** The name of the data source to be pulled from the root context */\n  source: string;\n}\n\nexport interface ReportSource extends PartSource {\n  /** The destination for the applied source, defaults to the source */\n  name?: string;\n  /** A user-friendly name for the source */\n  label?: string;\n  parameters?: { [name: string]: ValueOrExpr };\n}\n\ninterface BaseReport<T = {}> {\n  type: ReportType;\n  name?: string;\n  parameters?: Parameter<T>[];\n  sources?: ReportSource[];\n  /** An initial value for the root context. */\n  context?: ParameterMap;\n  /** An additional context expression to be merged with any fixed context just before the report is run. */\n  extraContext?: ValueOrExpr;\n  classifyStyles?: boolean;\n  defaultParams?: ParameterMap;\n}\n\n// delimited\nexport interface Delimited<T = {}> extends BaseReport<T> {\n  type: 'delimited';\n  source?: string;\n  fields: ValueOrExpr[];\n  headers?: ValueOrExpr[];\n  record?: string;\n  field?: string;\n  quote?: string;\n  rowContext?: ValueOrExpr;\n}\n\nexport interface Displayed<T = {}> extends BaseReport<T> {\n  widgets: Widget[];\n  font?: {\n    family?: string;\n    color?: string;\n    size?: number;\n    line?: number;\n  };\n  watermark?: Container;\n  overlay?: Container;\n}\n\n// flow\nexport interface Flow<T = {}> extends Displayed<T> {\n  type: 'flow';\n  width?: number;\n  margin?: Margin;\n  size?: PageSize;\n  orientation?: PageOrientation;\n}\n\n// page\nexport interface Page<T = {}> extends Displayed<T> {\n  type: 'page';\n  header?: Container & { outer?: boolean };\n  footer?: Container & { outer?: boolean };\n  size: PageSize;\n  orientation?: PageOrientation;\n  margin?: Margin;\n}\n\nexport type Dimension = number|{ percent: number };\n\nexport interface PageSize {\n  width: number;\n  height: number;\n  margin: [number, number];\n}\n\nexport type PageOrientation = 'portrait'|'landscape';\nexport const PageSizes: { [name: string]: PageSize } = {\n  letter: {\n    width: 51,\n    height: 66,\n    margin: [1.5, 1.5],\n  },\n  legal: {\n    width: 51,\n    height: 84,\n    margin: [1.5, 1.5],\n  },\n  tabloid: {\n    width: 66,\n    height: 102,\n    margin: [1.5, 1.5],\n  },\n  a4: {\n    width: 49.606302,\n    height: 70.15746,\n    margin: [1.5, 1.5],\n  }\n};\n\nexport function pageOffset(num: number, size: PageSize): number {\n  return num * size.height + size.margin[0];\n}\n\n// Attributes\nexport interface Font {\n  size?: number|Computed;\n  family?: string|Computed;\n  weight?: number|Computed;\n  color?: string|Computed;\n  align?: 'left'|'right'|'center'|'justify'|Computed;\n  line?: number|Computed;\n  right?: number;\n  pre?: boolean|Computed;\n  clamp?: boolean|Computed;\n}\n\nexport interface Placement {\n  x: number;\n  y: number;\n  availableX?: number;\n  availableY?: number;\n  maxX?: number;\n  maxY?: number;\n  offsetX?: number;\n  offsetY?: number;\n}\nexport type Layout = Array<[number, number]>|Placement[]|'row'|string;\n\nexport interface Borders {\n  top?: number;\n  left?: number;\n  bottom?: number;\n  right?: number;\n}\n\nexport interface Style {\n  font?: Font;\n  border?: number|Borders|number[]|string;\n}\n\nexport type Margin = number|[number, number]|[number, number, number, number];\n\nexport interface Computed {\n  x: ValueOrExpr;\n}\n\n// Widgets\nexport interface Widget extends Style {\n  type: string;\n  width?: Dimension|Computed|'grow'; // default 100%\n  height?: Dimension|'auto'|Computed|'grow'; // optional, defaulting to 1\n  margin?: Margin|Computed;\n  box?: 'expand'|'contain';\n  hide?: ValueOrExpr;\n  br?: boolean|Computed;\n  bg?: ValueOrExpr;\n  radius?: ValueOrExpr;\n\n  // container\n  widgets?: Widget[];\n  layout?: Layout;\n  context?: ValueOrExpr;\n  bridge?: boolean;\n  macro?: string;\n\n  // label\n  text?: ValueOrExpr|Array<ValueOrExpr|Span>;\n  format?: LabelFormat;\n  id?: string;\n  styled?: boolean;\n\n  // image\n  url?: ValueOrExpr;\n  fit?: 'cover'|'stretch'|Computed;\n\n  // html\n  html?: ValueOrExpr;\n\n  // repeater\n  source?: PartSource|ValueOrExpr;\n  header?: Container;\n  group?: Container[];\n  groupEnds?: boolean[];\n  groupHeaders?: boolean[];\n  row?: Container;\n  footer?: Container;\n  alternate?: Container;\n  headerPerPage?: boolean;\n\n  // repeater row\n  elide?: boolean|Computed;\n}\n\nexport interface Container extends Widget {\n  widgets: Widget[];\n  layout?: Layout;\n  context?: ValueOrExpr;\n  bridge?: boolean;\n  elide?: boolean|Computed;\n  macro?: string;\n}\n\nexport interface Image extends Widget {\n  url: ValueOrExpr;\n  fit?: 'cover'|'stretch'|Computed;\n}\n\nexport interface Span {\n  text: ValueOrExpr;\n  font?: Font;\n  bg?: ValueOrExpr;\n  radius?: ValueOrExpr;\n  id?: string;\n}\nexport interface LabelFormat {\n  name: string;\n  args?: ValueOrExpr[];\n}\nexport interface Label extends Widget {\n  text: ValueOrExpr|Array<ValueOrExpr|Span>;\n  format?: LabelFormat;\n  id?: string;\n  styled?: boolean;\n}\n\nexport interface HTML extends Widget {\n  html: ValueOrExpr;\n}\n\nexport interface Repeater extends Widget {\n  source: PartSource|ValueOrExpr;\n  header?: Container;\n  group?: Container[];\n  groupEnds?: boolean[];\n  groupHeaders?: boolean[];\n  row: Container;\n  footer?: Container;\n  alternate?: Container;\n  headerPerPage?: boolean;\n  headerRepeat?: number;\n}\n\nexport interface MeasureFont {\n  /** The font family for the label. The built-in estimator only works with sans, serif, narrow, and mono fonts, which should be relatively metric-compatible with Arial, Times New Roman, Arial Narrow, and, well, any fixed-width font. */\n  family?: 'sans'|'serif'|'narrow'|'mono'|string|Computed;\n  /** Font size in rem, where 1rem is 16px or 12pt based on the report html element style */\n  size?: number|Computed;\n  /** The line-height of the rendered font in rem */\n  line?: number|Computed;\n  /** Average width in px at font-size 16px. If this is supplied, it won't be guessed based on the font name. */\n  metric?: number|Computed;\n  /** Break words that exceed the line length */\n  'break-word'?: boolean;\n}\n\nexport interface MeasuredLabel extends Widget {\n  font?: MeasureFont;\n  text: ValueOrExpr;\n}\n\n// execution\ninterface ReportExtras {\n  /** Extra content to be rendered at the bottom of the <head> */\n  head?: string;\n  /** Extra content to be rendered at the bottom of the <body> */\n  foot?: string;\n  /** Run a delimited report to a table instead of using the defined delimiters */\n  table?: boolean;\n  /** Run a rendered report as a delimited report */\n  delimited?: boolean;\n  /** Record delimiter if running a rendered report as a delimited report */\n  record?: string;\n  /** Field delimiter if running a rendered report as a delimited report */\n  field?: string;\n  /** Field quoter if running a rendered report as a delimited report */\n  quote?: string;\n}\n\n/** Initialize a parameter map based on the parameters defined by the given report. */\nexport function initParameters(report: Report, sources: SourceMap, parameters?: ParameterMap|Root): ParameterMap {\n  const ctx = parameters && 'root' in parameters && parameters.root === parameters ? parameters as Root : new Root(Object.assign({}, report.context), { parameters });\n  ctx.parameters = Object.assign({}, report.defaultParams, ctx.parameters);\n  const inits: ParameterMap = {};\n\n  if (report.sources) applySources(ctx, report.sources, sources);\n\n  if (Array.isArray(report.parameters)) {\n    for (const p of report.parameters) {\n      if (p.init && p.name) {\n        inits[p.name] = evaluate(ctx, p.init);\n      }\n    }\n  }\n\n  return inits;\n}\n\n/** Run the given report to string. If the report is displayed, the result will be HTML. Otherwise, it will be plain text. */\nexport function run(report: Report, sources: SourceMap, parameters?: ParameterMap|Root, extra?: ReportExtras): string {\n  const ctx = parameters && 'root' in parameters && parameters.root === parameters ? parameters as Root : new Root(Object.assign({}, report.context), { parameters });\n\n  if (report.sources) applySources(ctx, report.sources, sources);\n  ctx.parameters = Object.assign({}, initParameters(report, sources), ctx.parameters);\n\n  if (report.extraContext) {\n    const res = evaluate(ctx, report.extraContext);\n    if (res && typeof res === 'object') ctx.value = Object.assign(ctx.value, res);\n  }\n\n  if (report.type === 'delimited') return runDelimited(report, ctx, { table: extra?.table });\n  else if (extra?.delimited) return runAsDelimited(report, ctx, extra);\n  else if (report.type === 'flow') return runFlow(report, ctx, extra);\n  else return runPage(report, ctx, extra);\n}\n\n/** Apply multiple sources to a context together. Each source base is available before filter/sort/group is applied in case a source needs to reference a later source for those purposes. */\nexport function applySources(context: RootContext, sources: ReportSource[], map: SourceMap) {\n  const srcs = context.sources;\n  for (const source of sources) {\n    let base = map[source.source || source.name] || { value: [] };\n    if (source.base) base = evaluate(extend(context, { value: base.value, special: { source: base } }), source.base);\n    srcs[source.name || source.source] = toDataSet(base);\n  }\n\n  for (const source of sources) {\n    if (source.filter || source.sort || source.group) srcs[source.name || source.source] = filter(srcs[source.name || source.source], source.filter, source.sort, source.group, context);\n  }\n}\n\nexport function applySource(context: RootContext, source: ReportSource, sources: SourceMap) {\n  let base = sources[source.source || source.name] || { value: [] };\n  if (source.base) base = { value: evaluate(extend(context, { value: base.value, special: { source: base } }), source.base) };\n  if (source.filter || source.sort || source.group) context.sources[source.name || source.source] = filter(base, source.filter, source.sort, source.group, context);\n  else context.sources[source.name || source.source] = toDataSet(base);\n}\n\nfunction runDelimited(report: Delimited, context: Context, options?: { table?: boolean }): string {\n  const source = context.root.sources[report.source ? report.source : (report.sources[0].name || report.sources[0].source)];\n  const values = Array.isArray(source.value) ?\n    source.value :\n    typeof source.value === 'object' && 'grouped' in source.value && Array.isArray(source.value.all) ? // watch out for grouped sources\n      source.value.all :\n      [source.value];\n  let fields = report.fields;\n  let headers = report.headers;\n\n  if (!fields || !fields.length && values.length) {\n    fields = Object.keys(values[0]);\n    if (!headers || !headers.length) headers = Object.keys(values[0]);\n  }\n\n  let res = '';\n  if (headers) {\n    const ctx = extend(context, { parser: parseTemplate });\n    if (options?.table) res += `<tr class=header><th style=\"border-right: 2px solid;\"></th>${headers.map(h => `<th>${evaluate(ctx, h)}</th>`).join('')}</tr>`;\n    else res += headers.map(h => `${report.quote || ''}${evaluate(ctx, h)}${report.quote || ''}`).join(report.field || ',') + (report.record || '\\n');\n  }\n\n  if (options?.table) {\n    let idx = 1;\n    for (const value of values) {\n      const c = extend(context, { value, special: { index: idx - 1 } });\n      if (report.rowContext) {\n        if (!c.locals) c.locals = {};\n        const v = evaluate(c, report.rowContext);\n        if (v) c.value = v;\n      }\n      res += `<tr class=row><th>${idx}</th>${fields.map(f => {\n        let val = f ? evaluate(c, f) : '';\n        if (val === undefined) val = '';\n        if (typeof val !== 'string') {\n          const v = val;\n          val = `${v}`;\n          if (val.slice(0, 7) === '[object') val = JSON.stringify(v);\n        }\n        return `<td>${val}</td>`;\n      }).join('')}</tr>`;\n      idx++;\n    }\n    res = `<table>${res}</table>`;\n  } else {\n    const unquote: RegExp = report.quote ? new RegExp(report.quote, 'g') : undefined;\n    let index = 0;\n    for (const value of values) {\n      const c = extend(context, { value, special: { index } });\n      if (report.rowContext) {\n        if (!c.locals) c.locals = {};\n        const v = evaluate(c, report.rowContext);\n        if (v) c.value = v;\n      }\n      res += fields.map(f => {\n        let val = f ? evaluate(c, f) : '';\n        if (val === undefined) val = '';\n        if (typeof val !== 'string') {\n          const v = val;\n          val = `${v}`;\n          if (val.slice(0, 7) === '[object') val = JSON.stringify(v);\n        }\n        if (unquote) val = val.replace(unquote, report.quote + report.quote);\n        return `${report.quote || ''}${val}${report.quote || ''}`;\n      }).join(report.field || ',') + (report.record || '\\n');\n      index++;\n    }\n  }\n\n  return res;\n}\n\nfunction runPage(report: Page, context: Context, extras?: ReportExtras): string {\n  let size: PageSize = report.orientation !== 'portrait' ? { width: report.size.height, height: report.size.width, margin: [report.size.margin[1], report.size.margin[0]] } : report.size;\n\n  const ctx: RenderContext = { context, report, styles: {}, styleMap: { ids: {}, styles: {} } };\n  const margin = expandMargin(report, ctx, { x: 0, y: 0 });\n  context.special = context.special || {};\n  context.special.page = 0;\n  context.special.pages = 0;\n\n  const pages: string[] = [''];\n  let page = 0;\n  const printX = size.width - 2 * size.margin[1];\n  const printY = size.height - 2 * size.margin[0];\n  let availableY = printY - margin[0] - margin[2];\n  const pageY = availableY;\n  let maxY = availableY;\n  let y = 0;\n  const availableX = printX - margin[1] - margin[3];\n  let state: RenderState<any> = null;\n\n  let headSize = 0;\n  if (report.header) {\n    const r = renderWidget(report.header, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY });\n    headSize = r.height;\n    if (!report.header?.outer) {\n      availableY -= headSize;\n      maxY -= headSize;\n      y += headSize;\n    }\n  }\n\n  let footSize = 0;\n  if (report.footer) {\n    const r = renderWidget(report.footer, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY });\n    footSize = r.height;\n    if (!report.footer?.outer) {\n      availableY -= footSize;\n      maxY -= footSize;\n    }\n  }\n\n  for (let w of report.widgets || []) {\n    if (w.macro) w = expandMacro(w.macro, w, ctx, { x: 0, y: 0, availableX, availableY, maxX: availableX, maxY }, state);\n    let r: RenderResult;\n    do {\n      context.special.page = page + 1;\n      r = renderWidget(w, ctx, { x: 0, y, availableX, availableY, maxX: availableX, maxY }, state);\n      pages[page] += r.output;\n      if (r.continue) {\n        page++;\n        pages[page] = '';\n        y = report.header?.outer ? 0 : headSize;\n        availableY = printY - (report.header?.outer ? 0 : headSize) - (report.footer?.outer ? 0 : footSize) - margin[0] - margin[2];\n        state = r.continue;\n      } else {\n        y += r.height;\n        availableY -= r.height;\n        state = null;\n      }\n    } while (state !== null)\n  }\n\n  context.special.pages = pages.length;\n  const footPlace = report.footer?.outer ?\n    { x: 0, y: printY - footSize, maxX: printX, maxY: printY } :\n    { x: 0 + margin[3], y: printY - margin[0] - footSize, maxX: printX - margin[3] - margin[1], maxY: printY - margin[0] - margin[2] };\n  const headPlace = report.header?.outer ?\n    { x: 0, y: 0, maxX: printX, maxY: printY } :\n    { x: 0 + margin[3], y: margin[0], maxX: printX - margin[3] - margin[1], maxY: printY - margin[0] - margin[2] };\n\n  context.special.size = { x: availableX, y: pageY };\n  pages.forEach((p, i) => {\n    let n = `<div class=\"page-back pb${i}\"><div${styleClass(ctx, ['page', `ps${i}`], ['', ''], '', 'p')}>\\n`;\n    context.special.page = i + 1;\n    if (report.watermark) {\n      const r = renderWidget(report.watermark, ctx, { x: 0, y: 0, maxX: printX, availableX: printX, maxY: printY, availableY: printY });\n      n += r.output + '\\n';\n    }\n    if (report.header) {\n      const r = renderWidget(report.header, ctx, headPlace);\n      n += r.output + '\\n';\n    }\n    n += `<div class=\"page-inner\">${p}</div>`;\n    if (report.footer) {\n      const r = renderWidget(report.footer, ctx, footPlace);\n      n += r.output + '\\n';\n    }\n    if (report.overlay) {\n      const r = renderWidget(report.overlay, ctx, { x: 0, y: 0, maxX: printX, availableX: printX, maxY: printY, availableY: printY });\n      n += r.output + '\\n';\n    }\n    n += '\\n</div></div>';\n    pages[i] = n;\n  });\n\n  return `<html style=\"font-size:100%;margin:0;padding:0;\"><head><style>\n    .page { width: ${printX}rem; height: ${printY}rem; position: absolute; overflow: hidden; left: ${size.margin[1]}rem; top: ${size.margin[0]}rem; ${report.font ? styleFont(report.font, ctx) : ''} }\n    .page-inner { position: absolute; width: ${printX - margin[1] - margin[3]}rem; height: ${printY - margin[0] - margin[2]}rem; left: ${margin[3]}rem; top: ${margin[0]}rem; }\n    .page-back { width: ${size.width}rem; height: ${size.height}rem; }\n    body { font-size: 0.83rem; }\n    @media screen {\n      html { min-width: ${size.width + 2}rem; }\n      body { background-color: #999; display: flex; flex-direction: column; align-items: center; }\n      .page-back { background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); position: relative; overflow: hidden; box-sizing: border-box; margin: 0.5em; }\n    }\n    @media print {\n      body { margin: 0; padding: 0; ${size ? `width:${size.width}rem;` : ''}background-color: none; display: block; height: ${pages.length * size.height}rem }\n      .page-back { position: absolute; box-shadow: none; background-color: none; margin: 0; padding: 0; left: 0rem; }\n      ${pages.map((_p, i) => `.pb${i} { top: ${i * size.height}rem; }`).join('')}\n    }\n    @page {\n      size: ${size.width}em ${size.height}em;\n    }${Object.entries(ctx.styles).map(([_k, v]) => v).join('\\n')}${Object.entries(ctx.styleMap.styles).map(([style, id]) => `.${id} { ${style} }`).join('\\n')}\n  </style>${extras && extras.head || ''}</head><body>\\n${pages.reduce((a, c) => a + c, '')}${extras && extras.foot || ''}</body></html>`;\n}\n\nfunction runFlow(report: Flow, context: Context, extras?: ReportExtras): string {\n  const ctx: RenderContext = { context, report, styles: {}, styleMap: { ids: {}, styles: {} } };\n  let html = '';\n  let y = 0;\n  let state: RenderState<any> = null;\n\n  let width: number;\n\n  if (report.width) width = report.width;\n  else if (report.size) width = report.orientation !== 'portrait' ? report.size.height : report.size.width;\n\n  let margin: [number, number, number, number];\n  if (report.margin != null) margin = expandMargin(report, ctx, { x: 0, y: 0, availableX: width, maxX: width });\n  if (!margin && report.size && report.size.margin) margin = expandMargin(report.size, ctx, { x: 0, y: 0, availableX: width, maxX: width });\n  if (!margin) margin = [0, 0, 0, 0];\n\n  // account for margins\n  if (width) width -= (margin[1] || 0) + (margin[3] || 0);\n\n  function render(w: Widget, cls: string) {\n    html += `<div${styleClass(ctx, cls ? [cls] : [], [`position:absolute;right:0rem;left:0rem;${width ? `width:${width}rem;` : ''}`, ''], `top:${y}rem;`, 'p')}>\\n`;\n    let r: RenderResult;\n    let yy = 0;\n    do {\n      r = renderWidget(w, ctx, { x: 0, y: yy, availableX: width, maxX: width }, state);\n      if (typeof r === 'string') throw new Error(`Container widget didn't specify used height`);\n      else {\n        html += r.output;\n        yy += r.height;\n        if (r.continue) {\n          state = r.continue;\n        } else {\n          state = null;\n        }\n      }\n    } while (state !== null)\n    y += yy;\n    html += `</div>\\n`;\n  }\n\n  if (report.watermark) render(report.watermark, 'watermark');\n  let maxY = y || 0;\n  y = 0;\n  for (const w of report.widgets || []) render(w, 'main');\n  if (y > maxY) maxY = y;\n  y = 0;\n  if (report.overlay) render(report.overlay, 'overlay');\n  if (y > maxY) maxY = y;\n\n  return `<html><head><style>\n    html { font-size: 100%; margin: 0; padding: 0; }\n    body { font-size: 0.83rem; padding: 0; margin: 0;${width ? ` width: ${width}rem;` : ''}; height: ${maxY}rem; position: relative; }\n    .page-back { ${width ? `width: ${width}rem; ` : 'width: 100%; box-sizing: border-box; '}padding: ${margin[0] || 0}rem ${margin[1] || 0}rem ${margin[2] || 0}rem ${margin[3] || 0}rem; position: absolute; left: 0; top: 0; }\n    #wrapper { height:${maxY}rem; position: relative; ${report.font ? styleFont(report.font, ctx) : ''} }\n    .watermark { z-index: 0; }\n    .main { z-index: 5; }\n    .overlay { z-index: 10; }\n    @media screen {\n      body { margin: 1rem${width ? ' auto' : ''}; background-color: #fff; box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.4); padding: ${margin[0]}rem ${margin[1]}rem ${margin[2]}rem ${margin[3]}rem !important; }\n    }${Object.entries(ctx.styles).map(([_k, v]) => v).join('\\n')}${Object.entries(ctx.styleMap.styles).map(([style, id]) => `.${id} { ${style} }`).join('\\n')}\n  </style>${extras && extras.head || ''}</head><body>\\n<div class=page-back><div id=wrapper>${html}</div></div>${extras && extras.foot || ''}</body></html>`;\n}\n\nfunction findWidgets(from: Widget, type: string, first?: boolean, results?: Widget[]): Widget[] {\n  results = results || [];\n  if (from.type === type) results.push(from);\n  if (first && results.length) return results;\n  if (from.widgets) for (const w of from.widgets) findWidgets(w, type, first, results);\n  return results;\n}\n\n// TODO: this could try harder to carry context forward and use non-named sources if it seems necessary\nfunction runAsDelimited(report: Flow|Page, context: RootContext, extra?: ReportExtras): string {\n  const [repeater] = findWidgets({ type: 'container', widgets: report.widgets }, 'repeater', true) as Repeater[];\n  if (repeater && typeof (repeater?.source as any)?.source === 'string') {\n    let headers: ValueOrExpr[];\n    let fields: ValueOrExpr[];\n    const rowContext = repeater.row.context;\n\n    if (repeater.header) {\n      const labels = findWidgets(repeater.header, 'label') as Label[];\n      headers = labels.map(l => typeof l.text === 'string' ? parse(l.text) : l.text) as ValueOrExpr[];\n    }\n\n    fields = (findWidgets(repeater.row, 'label') as Label[]).map(l => l.text) as ValueOrExpr[];\n\n    const source = '_tmp';\n    if (typeof repeater.source === 'object') {\n      const src = repeater.source;\n      let data;\n      if ('source' in src) {\n        const s = src as ReportSource;\n        let base = context.sources[s.source] || { value: [] };\n        if (s.base) base = { value: evaluate(extend(context, { value: base.value, special: { source: base } }), s.base) };\n        if (s.filter || s.sort || s.group) base = filter(base, s.filter, s.sort, s.group, context);\n        data = toDataSet(base);\n      } else data = toDataSet(evaluate(context, src));\n      context.sources._tmp = data;\n    }\n\n    return runDelimited(Object.assign({ type: 'delimited', headers, fields, source, rowContext }, extra) as Delimited, context, extra?.table ? { table: true } : {});\n  }\n  return '';\n}\n","import { Parser, parser as makeParser, opt, rep1sep, seq, alt, map, readTo, read1To, rep1, rep, str, read, read1, chars } from 'sprunge';\n\ntype Style = BoolStyle | ValueStyle<any>;\ninterface BoolStyle {\n  tag: string;\n}\ninterface ValueStyle<T> {\n  tag: string;\n  value: T|null;\n}\n\n// zero width space\nconst zwsp = '&#8203;';\n\nconst sp = read1(' \\r\\n\\t');\nconst ws = read(' \\r\\n\\t');\nconst hex = '0123456789abcdef';\nconst integer = map(read1('0123456789'), v => +v);\nconst number = map(seq(opt(str('-')), read1('0123456789'), opt(seq(str('.'), read1('0123456789')))), ([m, n, d]) => +[m, n, d?.[0], d?.[1]].filter(v => v).join(''));\nconst color = map(seq(opt(str('#')), alt(chars(8, hex), chars(6, hex), chars(4, hex), chars(3, hex))), ([, color]) => `#${color}`);\nconst remOrPercent = map(seq(number, opt(str('%'))), ([n, p]) => `${n}${p ? '%' : 'rem'}`);\nconst places = str('left', 'right', 'top', 'bottom', 'center');\n\nconst align = map(seq(str('align'), opt(seq(str('='), alt(\n  seq(str('top', 'middle', 'bottom', 'base'), opt(seq(sp, str('left', 'right', 'center')))),\n  seq(str('left', 'right', 'center'), opt(seq(sp, str('top', 'middle', 'bottom', 'base'))))\n)))), ([,v]) => ({ tag: 'align', value: v ? [v[1][0], v[1][1]?.[1]].filter(v => v) : null }));\nconst valign = map(seq(str('valign'), opt(seq(str('='), str('top', 'middle', 'bottom', 'base')))), ([, v]) => ({ tag: 'valign', value: v ? v[1] : null }));\n\nconst pad = map(seq(str('pad'), opt(seq(str('='), rep1sep(number, sp)))), ([, v]) => ({ tag: 'pad', value: v ? v[1] : null }));\nconst margin = map(seq(str('margin'), opt(seq(str('='), rep1sep(number, sp)))), ([, v]) => ({ tag: 'margin', value: v ? v[1] : null }));\nconst width = map(seq(str('width', 'w'), opt(seq(str('='), remOrPercent))), ([,v]) => ({ tag: 'width', value: v ? v[1] : null }));\nconst height = map(seq(str('height', 'h'), opt(seq(str('='), remOrPercent))), ([,v]) => ({ tag: 'height', value: v ? v[1] : null }));\nconst line = map(seq(str('line'), opt(seq(str('='), number))), ([,v]) => ({ tag: 'line', value: v ? v[1] : null }));\nconst fg = map(seq(str('fg', 'color', 'fore'), opt(seq(str('='), color))), ([,v]) => ({ tag: 'fg', value: v ? v[1] : null }));\nconst bg = map(seq(str('bg', 'background', 'back'), opt(seq(str('='), color))), ([,v]) => ({ tag: 'bg', value: v ? v[1] : null }));\nconst size = map(seq(str('size'), opt(seq(str('='), number))), ([,v]) => ({ tag: 'size', value: v ? v[1] : null }));\nconst font = map(seq(str('font'), opt(seq(str('='), read1To(',|')))), ([,v]) => ({ tag: 'font', value: v ? v[1] : null }));\nconst rotate = map(seq(str('rotate'), opt(seq(str('='), number, ws, opt(str('left', 'right')), opt(seq(sp, alt(remOrPercent, places), sp, alt(remOrPercent, places)))))), ([,v]) => ({ tag: 'rotate', value: v ? { turn: v[1] * (v[3] === 'left' ? -1 : 1), origin: v[4] ? [v[4][1], v[4][3]] : undefined } : null }));\nconst move = map(seq(str('move'), opt(seq(str('='), remOrPercent, sp, remOrPercent))), ([,v]) => ({ tag: 'move', value: v ? { x: v[1], y: v[3] } : null }));\n\nconst trash = map(readTo(',|'), v => ({ tag: 'trash', value: v }));\n\nconst border = map(seq(\n  str('border'), opt(seq(str('='),opt(str('solid', 'dot', 'dash', 'double')), ws,\n  rep1sep(integer, sp), ws, opt(seq(str('/'), ws, rep1sep(number, sp))), ws, opt(color),\n  ))), ([, v]) => ({ tag: 'border', value: v ? { style: v[1] || 'solid', width: v[3], radius: v[5]?.[2], color: v[7] } : null }));\n\nconst bools = map(alt(str('sub', 'sup', 'bold', 'italic', 'underline', 'strike', 'overline', 'overflow', 'nowrap', 'pre', 'br', 'b', 'i', 'u')), tag => ({ tag }));\n\nconst tag: Parser<Style[]> = map(seq(str('|'), ws, rep1sep(alt(border, align, fg, bg, valign, size, line, font, pad, margin, width, height, bools, rotate, move, trash), seq(ws, str(','), ws), 'allow'), readTo('|'), str('|')), ([, , tags]) => tags.filter(t => t.tag !== 'trash'));\nconst text = map(rep1(alt(read1To('\\\\|', true), map(str('\\\\|'), () => '|'))), txts => txts.join(''));\n\nconst all = rep(alt<Style[]|string>(text, tag))\n\nconst parser = makeParser(all, { consumeAll: true, undefinedOnError: true });\n\ninterface State {\n  bool: { [key: string]: boolean }\n  value: { [key: string]: any[] }\n}\n\nconst blocks = ['border', 'width', 'height', 'pad', 'margin', 'align', 'overflow', 'nowrap', 'rotate', 'move'];\n\nconst aliases = {\n  b: 'bold',\n  i: 'italic',\n  u: 'underline',\n}\n\nfunction process(stuff: Array<Style[]|string>): string {\n  let res = '';\n  let open = false;\n  const state: State = { bool: {}, value: {} };\n  const blockstack: string[][] = [];\n  for (const s of stuff) {\n    if (typeof s === 'string') {\n      if (!state.bool.pre && /^\\s/.test(s)) res += zwsp;\n      res += s;\n      if (!state.bool.pre && /\\s$/.test(s)) res += zwsp;\n    } else {\n      let drop = false;\n      let block: string[];\n      for (const style of s) {\n        const tag = aliases[style.tag] || style.tag;\n        if ('value' in style) {\n          if (style.value !== null) {\n            (state.value[tag] || (state.value[tag] = [])).push(style.value);\n            if (blocks.includes(tag) || block && tag === 'bg') (block || (block = [])).push(tag);\n          } else {\n            if (blocks.includes(tag)) drop = true;\n            else if (tag === 'bg' && (drop || blockstack && blockstack.length && blockstack[blockstack.length - 1].includes('bg'))) drop = true;\n            else (state.value[tag] || (state.value[tag] = [])).pop();\n          }\n        } else {\n          if (tag === 'br') res += '<br/>';\n          else if (blocks.includes(tag) && block.length) block.push(tag);\n          else state.bool[tag] = !state.bool[tag];\n        }\n      }\n      if (open) res += `</span>`;\n      open = true;\n      if (drop) {\n        const frame = blockstack.pop();\n        if (frame) {\n          res += '</span>';\n          for (const b of frame) (state.value[b] || (state.value[b] = [])).pop();\n        }\n      }\n      if (block) {\n        blockstack.push(block);\n        res += `<span style=\"${getStyle(state, block)}\">`;\n      }\n      res += `<span style=\"${getStyle(state, 'inline')}\">`;\n    }\n  }\n  if (open) res += `</span>`;\n  for (const f of blockstack) res += '</span>';\n  return res;\n}\n\nexport function style(str: string): string {\n  const parsed = parser(str);\n  if (Array.isArray(parsed)) return process(parsed);\n  return str;\n}\n\nconst flexAlign = { top: 'start', middle: 'center', bottom: 'end', base: 'baseline' };\nconst borderStyle = { dot: 'dotted', dash: 'dashed' };\nfunction getStyle(state: State, which: 'inline'|string[]) {\n  let res = '';\n\n  if (which === 'inline') {\n    const bs = state.bool;\n    if (bs.underline || bs.overline || bs.strike) res += `text-decoration-line:${[bs.underline && 'underline', bs.overline && 'overline', bs.strike && 'line-through'].filter(v => v).join(' ')};`\n    if (bs.sup || bs.sub) {\n      res += `font-size:70%;`;\n      if (bs.sup) res += `vertical-align:super;`;\n      if (bs.sub) res += `vertical-align:sub;`;\n    }\n    if (bs.italic) res += `font-style:italic;`;\n    if (bs.bold) res += `font-weight:bold;`;\n    if (bs.pre) res += `white-space:pre-wrap;`;\n\n    const vs = state.value;\n    if (Array.isArray(vs.valign)) {\n      const v = vs.valign[vs.valign.length - 1];\n      if (v) res += `vertical-align:${v === 'base' ? 'baseline' : v};`;\n    }\n\n    if (Array.isArray(vs.fg)) {\n      const v = vs.fg[vs.fg.length - 1];\n      if (v) res += `color:${v};`;\n    }\n\n    if (Array.isArray(vs.bg)) {\n      const v = vs.bg[vs.bg.length - 1];\n      if (v) res += `background-color:${v};`;\n    }\n\n    if (Array.isArray(vs.size)) {\n      const v = vs.size[vs.size.length - 1];\n      if (v != null) res += `font-size:${v}rem;`;\n    }\n\n    if (Array.isArray(vs.font)) {\n      const v = vs.font[vs.font.length - 1];\n      if (v != null) res += `font-family:${v};`;\n    }\n\n    if (Array.isArray(vs.line)) {\n      const v = vs.line[vs.line.length - 1];\n      if (v != null) res += `line-height:${v}rem;`;\n    }\n  } else {\n    res += `display:inline-flex;box-sizing:content-box;overflow:hidden;`;\n    const vs = state.value;\n\n    let transforms: string[];\n\n    if (which.includes('align') && Array.isArray(vs.align)) {\n      const v = vs.align[vs.align.length - 1];\n      if (Array.isArray(v)) {\n        let vv = v.find(v => ['top', 'middle', 'bottom', 'base'].includes(v));\n        if (vv) res += `align-items:${flexAlign[vv]};`;\n        vv = v.find(v => ['left', 'right', 'center'].includes(v));\n        if (vv) res += `justify-content:${vv};`;\n      }\n    }\n\n    if (which.includes('width') && Array.isArray(vs.width)) {\n      const v = vs.width[vs.width.length - 1];\n      if (v != null) res += `width:${v};`;\n    }\n\n    if (which.includes('height') && Array.isArray(vs.height)) {\n      const v = vs.height[vs.height.length - 1];\n      if (v != null) res += `height:${v};`;\n    }\n\n    if (which.includes('pad') && Array.isArray(vs.pad)) {\n      const v: number[] = vs.pad[vs.pad.length - 1];\n      if (Array.isArray(v) && v.length) {\n        res += `padding:${v[0]}rem`;\n        if (v.length > 1) res += ` ${v[1]}rem`;\n        if (v.length > 2) res += ` ${v[2]}rem`;\n        if (v.length > 3) res += ` ${v[3]}rem`;\n        res += ';';\n      }\n    }\n\n    if (which.includes('margin') && Array.isArray(vs.margin)) {\n      const v: number[] = vs.margin[vs.margin.length - 1];\n      if (Array.isArray(v) && v.length) {\n        res += `margin:${v[0]}rem`;\n        if (v.length > 1) res += ` ${v[1]}rem`;\n        if (v.length > 2) res += ` ${v[2]}rem`;\n        if (v.length > 3) res += ` ${v[3]}rem`;\n        res += ';';\n      }\n    }\n\n    if (which.includes('border') && Array.isArray(vs.border)) {\n      const v: { style: string; color?: string; width: number[]; radius: number[] } = vs.border[vs.border.length - 1];\n      if (v) {\n        res += `border-style:${borderStyle[v.style] || v.style};border-width:${v.width[0]}px`;\n        if (v.width.length > 1) res += ` ${v.width[1]}px`;\n        if (v.width.length > 2) res += ` ${v.width[2]}px`;\n        if (v.width.length > 3) res += ` ${v.width[3]}px`;\n        res += ';';\n        if (v.color) res += `border-color:${v.color};`;\n        if (v.radius) {\n          res += `border-radius:${v.radius[0]}rem`;\n          if (v.radius.length > 1) res += ` ${v.radius[1]}rem`;\n          if (v.radius.length > 2) res += ` ${v.radius[2]}rem`;\n          if (v.radius.length > 3) res += ` ${v.radius[3]}rem`;\n          res += ';';\n        }\n      }\n    }\n\n    if (which.includes('bg') && Array.isArray(vs.bg)) {\n      const v = vs.bg[vs.bg.length - 1];\n      if (v) res += `background-color:${v};`;\n    }\n\n    if (which.includes('rotate') && Array.isArray(vs.rotate)) {\n      const v: { turn: number; origin?: [string, string] } = vs.rotate[vs.rotate.length - 1];\n      if (v) {\n        if (v.origin) res += `transform-origin:${v.origin[0]} ${v.origin[1]};`;\n        (transforms || (transforms = []))[which.indexOf('rotate')] = `rotate(${v.turn}turn)`;\n      }\n    }\n\n    if (which.includes('move') && Array.isArray(vs.move)) {\n      const v: { x: string; y: string } = vs.move[vs.move.length - 1];\n      if (v) (transforms || (transforms = []))[which.indexOf('move')] = `translate(${v.x}, ${v.y})`;\n    }\n\n    if (transforms) res += `transform:${transforms.filter(v => v).join(' ')};`;\n\n    if (which.includes('nowrap')) res += `white-space:nowrap;`;\n    if (which.includes('overflow')) res += `overflow:visible;`;\n  }\n\n  return res;\n}\n","import { Container, Label, Repeater, Image, MeasuredLabel, HTML } from '../report';\nimport { evaluate, filter, Group, ValueOrExpr, isValueOrExpr, extend as extendData } from '../data/index';\nimport { parse as parseTemplate } from '../data/parse/template';\nimport { style as styleText } from '../data/parse/style';\nimport { error } from './error';\n\nimport { addStyle, escapeHTML, extend, getWidth, measure, registerRenderer, renderWidget, renderWidgets, RenderContinuation, RenderState, RenderContext, getHeightWithMargin, expandMargin, getWidthWithMargin, isComputed } from './index';\nimport { styleClass, style, styleFont, styleImage, styleExtra } from './style';\n\nfunction onCommit(ctx: RenderContext, key: string, value: any) {\n  let c = ctx;\n  while (c) {\n    if (c.commit) {\n      c.commit[key] = value;\n      return;\n    }\n    c = c.parent;\n  }\n}\n\nfunction commitContext(ctx: RenderContext) {\n  for (const k in ctx.commit) {\n    let l = ctx.context;\n    while (l) {\n      if (l.special && l.special.values) (l.special.values[k] || (l.special.values[k] = [])).push(ctx.commit[k]);\n      l = l.parent;\n    }\n  }\n}\n\nregisterRenderer<Label>('label', (w, ctx, placement) => {\n  addStyle(ctx, 'label', `.label {position:absolute;box-sizing:border-box;white-space:normal;}`);\n  let str = '';\n  let sval: any;\n  let val = (Array.isArray(w.text) ? w.text : [w.text]).map(v => {\n    let val = evaluate(ctx, typeof v === 'object' && 'text' in v ? v.text : v);\n    if (typeof val === 'string') val = escapeHTML(val);\n    if (typeof v === 'object' && 'id' in v) onCommit(ctx, v.id, val);\n    str += val;\n    sval = val;\n\n    if (w.styled) val = styleText(val);\n\n    if (typeof v === 'object' && 'text' in v) {\n      return `<span${styleClass(ctx, [], [styleFont(v.font, ctx) + styleExtra(v, ctx), ''])}>${val}</span>`;\n    } else {\n      return val\n    };\n  }).join('');\n\n  if (w.id) onCommit(ctx, w.id, str);\n\n  if (w.format && w.format.name) {\n    const args: ValueOrExpr[] = [{ v: !Array.isArray(w.text) || w.text.length === 1 ? sval : val }, { v: w.format.name }];\n    val = evaluate(ctx, { op: 'format', args: args.concat(w.format.args || []) });\n  }\n\n  return `<span${styleClass(ctx, ['label'], style(w, placement, ctx, { lineSize: true }))}>${val}</span>`\n});\n\nregisterRenderer<Container>('container', (w, ctx, placement, state) => {\n  addStyle(ctx, 'container', `.container {position:absolute;box-sizing:border-box;}`);\n  let h: number;\n  if (!w.height) w.height = 'auto';\n  else if (w.height !== 'auto') h = getHeightWithMargin(w, placement, ctx);\n  const wctx = ((state || {}).state || {}).ctx ? Object.assign({}, ctx, { context: state.state.ctx }) : ctx;\n  if (w.context && !((state || {}).state || {}).ctx) {\n    if (!wctx.context.locals) wctx.context.locals = {};\n    const value = evaluate(extend(wctx, { special: { placement, widget: w }, locals: wctx.context.locals }), w.context);\n    if (value) wctx.context = extendData(wctx.context, { value, special: { placement, widget: w } });\n  }\n  const cw = getWidth(w, placement, ctx) || placement.availableX;\n  const r = renderWidgets(w, wctx, { x: 0, y: 0, availableX: cw, availableY: h || placement.availableY, maxX: cw, maxY: h != null && !isNaN(h) ? h : placement.maxY }, state, w.layout);\n  if (!r.cancel) {\n    r.output = `<div${styleClass(ctx, ['container'], style(w, placement, ctx, { computedHeight: h || r.height, container: true }))}>${r.output}</div>`;\n    r.height = h || r.height;\n    r.width = getWidthWithMargin(w, placement, ctx);\n  }\n  if ((r.cancel || r.continue) && !w.bridge) {\n    const state = r.continue || {} as RenderState;\n    state.offset = 0;\n    // must start over\n    delete state.last;\n    state.attempt = (state.attempt || 0) + 1;\n    if (state.attempt > 1) return error(ctx, placement);\n    return { continue: state, output: '' };\n  } else if (r.continue) {\n    if (w.context) r.continue.state = { ctx: wctx.context };\n    r.continue.offset = 0;\n  }\n  return r;\n}, { container: true });\n\ntype RepeatState = { part: 'group'|'header'|'body'|'footer'; group?: 'header'|'body'; src: Group|any[]; current: number; context?: RenderContext; newPage?: boolean };\nregisterRenderer<Repeater, RepeatState>('repeater', (w, ctx, placement, state) => {\n  addStyle(ctx, 'container', `.container {position:absolute;box-sizing:border-box;}`);\n  if (!w.height) w.height = 'auto';\n  let availableY = placement.availableY;\n  let availableX = placement.availableX;\n\n  let r: RenderContinuation;\n  let html = '';\n  let commit = false;\n  const m = expandMargin(w, ctx, placement);\n  let y = !state || !state.state || state.state.part === 'header' ? m[0] : 0;\n  if (availableY != null) {\n    availableY -= y;\n    availableY = +availableY.toFixed(6)\n  }\n  let group: Group;\n  let groupNo: number|boolean = false;\n  const newPage = state && state.state && state.state.newPage;\n\n  let src: Group|any[] = state && state.state && state.state.src;\n  if (!src) {\n    if (!w.source) return '';\n    src = isValueOrExpr(w.source) ?\n      evaluate(ctx, w.source) :\n      filter(ctx.context.root.sources[w.source.source] || { value: [] }, w.source.filter, w.source.sort, w.source.group, ctx.context).value;\n    (ctx.context.special || (ctx.context.special = {})).values || (ctx.context.special.values = {});\n  }\n    \n  let arr: any[];\n\n  if (!Array.isArray(src)) {\n    if (!src || !Array.isArray(src.value)) return { output: '', height: 0 };\n    group = src;\n    arr = group.value;\n    if (w.group) {\n      groupNo = w.group.length > group.grouped ? w.group.length - group.grouped - 1 : false;\n    }\n  } else {\n    arr = src;\n  }\n\n  if ((w.header || w.group) && (newPage || !state || !state.state || state.state.part === 'header' || state.state.part === 'group')) {\n    const hctx = state && state.state && state.state.context && state.state.context.context;\n\n    if (group) {\n      const c = extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: (hctx && hctx.special || {}).values } });\n\n      if (w.group && groupNo !== false && (!state || !state.state || state.state.part === 'group')) {\n        r = renderWidget(w.group[groupNo], extend(ctx, { value: group, special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: true, group: group.group } }), { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n\n        if (r) {\n          if (r.height > availableY) {\n            if (html) html = `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`;\n            return { output: html, height: y, continue: { offset: 0, state: { part: 'group', src, current: 0, newPage: true } } }\n          } else if (availableY != null) {\n            availableY -= r.height;\n            availableY = +availableY.toFixed(6);\n          }\n\n          html += r.output;\n          y += r.height;\n        }\n      }\n\n      if (w.header && (w.groupHeaders && w.groupHeaders[group.grouped] && (!state || !state.state || !state.state.current) || newPage && w.headerPerPage !== false)) r = renderWidget(w.header, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n      else r = { output: '', height: 0 };\n\n      if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'header', src, current: 0, context: ctx, newPage: true } } }\n      else if (availableY != null) {\n        availableY -= r.height;\n        availableY = +availableY.toFixed(6);\n      }\n\n      html += r.output;\n      y += r.height;\n    } else if (w.header) {\n      if (!state || newPage && w.headerPerPage !== false) r = renderWidget(w.header, ctx, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n      else r = { output: '', height: 0 };\n\n      if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'header', src, current: 0, context: ctx, newPage: true } } }\n      else if (availableY != null) {\n        availableY -= r.height;\n        availableY = +availableY.toFixed(6);\n      }\n\n      html += r.output;\n      y += r.height;\n    }\n  }\n\n  if (newPage) state.state.newPage = false;\n  if (state && state.child && state.child.state) state.child.state.newPage = false;\n\n  let rctx: RenderContext = state && state.state && state.state.context || extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: {}, last: arr.length - 1, count: arr.length } });\n  const elide = w.row && (isComputed(w.row.elide) ? evaluate(extend(rctx, { special: { placement, widget: w } }), w.row.elide.x) : w.row.elide);\n\n  if (!state || !state.state || state.state.part !== 'footer') {\n    let usedX = 0;\n    let usedY = 0;\n    let initY = y;\n    if (!elide && !arr.length && w.alternate) {\n      if (w.alternate) {\n        r = renderWidget(w.alternate, rctx, { x: usedX, y, availableX: availableX - usedX, maxX: placement.maxX, availableY, maxY: placement.maxY }, state ? state.child : undefined);\n        if (r.height > availableY) return { output: html, height: 0, continue: { offset: 0, state: { part: 'body', src, current: 0, newPage: true } } }\n        else if (availableY != null) {\n          availableY -= r.height;\n          availableY = +availableY.toFixed(6);\n        }\n\n        html += r.output;\n        y += r.height;\n      }\n    } else {\n      for (let i = (state && state.state && state.state.current) || 0; i < arr.length; i++) {\n        let row = false;\n        const c = group && group.grouped ?\n          extend(rctx, { value: arr[i], special: { index: i, values: {} }, commit: {} }) :\n          extend(rctx, { value: arr[i], special: { index: i } });\n\n        if (group && group.grouped) {\n          const s: RenderState<RepeatState> = (state && state.child) || { offset: 0, state: { current: 0, src: arr[i], part: 'group' } };\n          r = renderWidget(w, c, { x: 0, y, availableX: availableX - usedX, availableY, maxX: placement.maxX, maxY: placement.maxY }, s);\n        } else {\n          c.commit = {};\n          if (elide) {\n            renderWidget(w.row, c, { x: 0, y: 0, availableX: placement.maxX, maxX: placement.maxX, availableY: placement.maxY, maxY: placement.maxY }, state ? state.child : undefined);\n            commitContext(c);\n            continue;\n          } else {\n            r = renderWidget(w.row, c, { x: usedX, y, availableX: availableX - usedX, maxX: placement.maxX, availableY, maxY: placement.maxY }, state ? state.child : undefined);\n            row = true;\n          }\n        }\n\n        if (state) state.child = null;\n\n        if (r.width && r.width <= availableX - usedX && r.width !== availableX) {\n          usedX += r.width;\n          if (r.height > usedY) {\n            usedY = r.height;\n            if (r.height > availableY) initY -= r.height;\n          }\n        } else if (r.width && usedX && r.width > availableX - usedX) {\n          y += usedY;\n          initY = y;\n          if (availableY != null) {\n            availableY -= usedY;\n            availableY = +availableY.toFixed(6);\n          }\n          usedY = 0;\n          usedX = 0;\n          i--;\n          continue;\n        }\n\n        if (r.height > availableY || r.cancel) {\n          if (initY === y && usedY) y += usedY;\n          if (commit) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: r.continue } };\n          else return { output: '', height: y, continue: { offset: y, state: { part: state && state.state && state.state.part || 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: r.continue } };\n        }\n\n        if (!usedY) {\n          y += r.height;\n          if (availableY != null) {\n            availableY -= r.height;\n            availableY = +availableY.toFixed(6);\n          }\n        }\n\n        html += r.output;\n        commit = true;\n\n        if (row && w.header && ctx.report.type === 'flow' && w.headerRepeat > 0 && i + 1 && (i + 1) % w.headerRepeat === 0) {\n          const h = renderWidget(w.header, ctx, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY });\n          html += h.output;\n          y += h.height;\n        }\n\n        if (r.continue) {\n          if (initY === y && usedY) y += usedY;\n          if (w.row.bridge) commitContext(c);\n          return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'body', src, current: i, context: rctx, newPage: !group || groupNo === false }, child: w.row.bridge || (group && group.grouped) ? r.continue : undefined } };\n        }\n\n        commitContext(c);\n      }\n    }\n\n    if (initY === y && usedY) y += usedY;\n  }\n\n  if (w.footer) {\n    const fctx = (rctx && rctx.context) || (state && state.state && state.state.context && state.state.context.context);\n    const c = extend(ctx, { special: { source: group && group.grouped ? group.all : arr, level: group && group.level, grouped: groupNo !== false, group: group && group.group, values: (fctx && fctx.special || {}).values }, commit: {} });\n\n    if (group) {\n      if (w.groupEnds && w.groupEnds[group.grouped]) r = renderWidget(w.footer, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY, availableY });\n      else r = { output: '', height: 0 };\n    } else r = renderWidget(w.footer, c, { x: 0, y, availableX: placement.availableX, maxX: placement.maxX, maxY: placement.maxY, availableY });\n\n    if (r.height > availableY) return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'footer', current: 0, src, context: rctx, newPage: true } } }\n    else if (r.continue) {\n      if (w.footer.bridge) commitContext(c);\n      return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y, continue: { offset: y, state: { part: 'footer', src, current: 0, context: rctx, newPage: true }, child: w.footer.bridge ? r.continue : undefined } }\n    }\n\n    commitContext(c);\n\n    html += r.output;\n    y += r.height;\n  }\n\n  return { output: `<div${styleClass(ctx, ['container', 'repeat'], style(w, placement, ctx, { computedHeight: y, container: true }))}>\\n${html}</div>`, height: y };\n}, { container: true });\n\nregisterRenderer<Image>('image', (w, ctx, placement) => {\n  addStyle(ctx, 'image', `.image {position:absolute;box-sizing:border-box;} .image .inner {background-repeat:no-repeat;height:100%;}`);\n\n  const fit = w.fit && typeof w.fit === 'object' ? evaluate(ctx, w.fit.x) : w.fit;\n  if (fit === 'stretch') {\n    return `<img src=\"${evaluate(ctx, w.url)}\" ${styleClass(ctx, ['image'], style(w, placement, ctx))} />`;\n  } else {\n    return `<div ${styleClass(ctx, ['image'], style(w, placement, ctx))}><div ${styleClass(ctx, ['inner'], styleImage(fit), `background-image:url('${evaluate(ctx, w.url)}');`)}></div></div>`;\n  }\n});\n\nregisterRenderer<MeasuredLabel>('measured', (w, ctx, placement, state) => {\n  addStyle(ctx, 'measured', `.measured {position:absolute;box-sizing:border-box;white-space:pre-wrap;font-family:serif;font-size:0.83rem;word-break:break-word;}`);\n  const text = evaluate(ctx, w.text);\n  const height = measure(text, getWidth(w, placement, ctx) || placement.availableX, ctx, w.font);\n  \n  if (!state && height > placement.availableY) {\n    return { output: '', height: 0, continue: { state: {}, offset: 0 } };\n  } else {\n    let s = style(w, placement, ctx, { computedHeight: height, container: true });\n    s[0] = `line-height:1em;` + s[0];\n    return {\n      height, output: `<span${styleClass(ctx, ['measured', 'label'], s)}>${escapeHTML(text)}</span>`\n    };\n  }\n});\n\nregisterRenderer<HTML>('html', (w, ctx, placement) => {\n  addStyle(ctx, 'html', `.html {position:absolute;box-sizing:border-box;overflow:hidden;line-height:1rem;}`);\n  const html = evaluate(extend(ctx, { parser: parseTemplate }), w.html);\n  return `<div${styleClass(ctx, ['html'], style(w, placement, ctx, { container: true }))}>${html}</div>`;\n});\n","import { DateExactRange } from \"./index\";\n\nconst decRE = /(\\d)(?=(\\d{3})+\\.)/g;\nconst intRE = /(\\d)(?=(\\d{3})+$)/g;\nconst isNumRE = /^[-0-9\\\\.,]+$/;\n\nexport function number(v: string|number, dec: number = 2, group: string = ',', negative: 'sign'|'wrap'|'both' = 'sign'): string {\n  v = typeof v !== 'number' ? parseFloat(v || '') : v;\n  if (isNaN(v)) return '';\n  const neg = v < 0;\n  v = v.toFixed(dec);\n  if (dec === 0) v = v.replace(/\\..*/, '');\n  if (neg && negative !== 'sign') v = `(${negative === 'both' ? v : v.substr(1)})`\n  if (group) return v.replace(v.indexOf('.') === -1 ? intRE : decRE, `$1${group}`);\n  else return v;\n}\n\nexport function dollar(v: string, alt: string, dec: number = 2, group: string = ',', sign: string = '$', negative: 'sign'|'wrap'|'both' = 'sign'): string {\n  if (v != null && isNumRE.test(v)) {\n    if (!isNaN(+v)) return `${sign}${number(v, dec, group, negative)}`;\n    else return alt !== undefined ? alt : v;\n  } else {\n    return alt !== undefined ? alt : v;\n  }\n}\n\nexport function phone(v: string|number): string {\n  if (!v) v = '';\n  if (typeof v !== 'string') v = v.toString();\n  v = v || '';\n  v = v.replace(/[^\\d]/g, '');\n\n  if (v.length === 7) return `${v.substr(0, 3)}-${v.substr(3, 4)}`;\n  else if (v.length === 10) return `(${v.substr(0, 3)}) ${v.substr(3, 3)}-${v.substr(6, 4)}`;\n  else if (v.length === 11) return `${v[0]}-${v.substr(1, 3)}-${v.substr(4, 3)}-${v.substr(7, 4)}`;\n  else return v;\n}\n\nconst dateRE = /\\\\.|y+|M+|d+|E+|H+|m+|s+|k+|h+|a+|S+|z+/g;\nconst months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\nconst days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nlet dateDefault: string;\nexport function date(d: string|Date|DateExactRange, fmt: string): string {\n  if (!d) return '';\n  let Y: number, M: number, D: number, DD: number, H: number, MM: number, S: number, SS: number, Z: number;\n\n  // convert an exact range to numbers\n  if (typeof d === 'object' && 'f' in d && Array.isArray(d.f)) {\n    const f = d.f, l = f.length, e = d.e;\n    Y = f[0], M = l > 1 && f[1] != null ? f[1] : e ? 11 : 0, D = l > 2 && f[2] != null ? f[2] : e ? 0 : 1,\n      H = l > 3 && f[3] != null ? f[3] : e ? 23 : 0, MM = l > 4 && f[4] != null ? f[4] : e ? 59 : 0, S = l > 5 && f[5] != null ? f[5] : e ? 59 : 0,\n      SS = l > 6 && f[6] != null ? f[6] : e ? 999 : 0;\n    let dt = new Date(Y, M, D || 1, H, MM, S, SS);\n    Z = l > 7 && f[7] != null ? -f[7] : dt.getTimezoneOffset();\n    if (!D) {\n      dt.setMonth(M + 1);\n      dt.setDate(0);\n      D = dt.getDate();\n    }\n    DD = dt.getDay();\n  } else {\n    if (typeof d === 'string') d = new Date(d);\n    if (Object.prototype.toString.call(d) !== '[object Date]') return '';\n    if (isNaN(d as any)) return '';\n\n    const v = d as Date;\n    Y = v.getFullYear(), M = v.getMonth(), D = v.getDate(), DD = v.getDay(), H = v.getHours(), MM = v.getMinutes(), S = v.getSeconds(), SS = v.getMilliseconds(), Z = v.getTimezoneOffset();\n  }\n\n\n  if (!fmt) fmt = dateDefault || 'yyyy-MM-dd';\n\n  return fmt.replace(dateRE, m => {\n    if (m[0] === '\\\\') {\n      return m[1];\n    } else if (m[0] === 'y') {\n      return m.length <= 2 ? (`${Y}`).substr(2, 2) : `${Y}`;\n    } else if (m[0] === 'M') {\n      if (m.length === 1) return `${M + 1}`;\n      else if (m.length === 2) return M < 9 ? `0${M + 1}` : `${M + 1}`;\n      else if (m.length === 3) return months[M].substr(0, 3);\n      else return months[M];\n    } else if (m[0] === 'd') {\n      if (m.length === 1) return `${D}`;\n      else if (m.length === 2) return D <= 9 ? `0${D}` : `${D}`;\n      else return ordinal(D);\n    } else if (m[0] === 'E') {\n      if (m.length === 1) return `${DD + 1}`;\n      else if (m.length === 2) return days[DD].substr(0, 3);\n      else return days[DD];\n    } else if (m[0] === 'H') {\n      return m.length === 1 ? `${H}` : H <= 9 ? `0${H}` : `${H}`;\n    } else if (m[0] === 'm') {\n      return m.length === 1 ? `${MM}` : MM <= 9 ? `0${MM}` : `${MM}`;\n    } else if (m[0] === 's') {\n      return m.length === 1 ? `${S}` : S <= 9 ? `0${S}` : `${S}`;\n    } else if (m[0] === 'S') {\n      const ms = SS;\n      if (m.length === 1) return `${ms}`;\n      return ms < 10 ? `00${ms}` : ms < 100 ? `0${ms}` : `${ms}`;\n    } else if (m[0] === 'k' || m[0] === 'h') {\n      let r = `${H % 12}`;\n      if (r === '0') r = '12';\n      return `${r}`;\n    } else if (m[0] === 'a') {\n      return H > 11 ? 'PM' : 'AM';\n    } else if (m[0] === 'z') {\n      let min = 0 - Z;\n      const bit = min < 0 ? '-' : '+';\n      min = Math.abs(min);\n      let r: number = min;\n      if (m.length === 1) {\n        r = Math.floor(min / 60);\n      } else if (m.length === 2) {\n        const mm = min % 60;\n        const h = Math.floor(min / 60);\n        return `${bit}${h < 10 ? '0' : ''}${h}${mm < 10 ? '0' : ''}${mm}`;\n      } else if (m.length === 3) {\n        const mm = min % 60;\n        const h = Math.floor(min / 60);\n        return `${bit}${h < 10 ? '0' : ''}${h}:${mm < 10 ? '0' : ''}${mm}`;\n      } else r = min;\n      return `${bit}${r}`;\n    }\n  });\n}\n\ndate.setDefault = function(format?: string) {\n  dateDefault = format;\n}\n\nexport function ordinal(num: number|string, group?: string): string {\n  num = number(num, 0, group);\n  let n = `${num}`;\n  n = n.substr(-2, 2);\n  if (n.length > 1 && n[0] === '1') return `${num}th`;\n  switch (n[1] || n[0]) {\n    case '1':\n      return `${num}st`;\n    case '2':\n      return `${num}nd`;\n    case '3':\n      return `${num}rd`;\n    default:\n      return `${num}th`;\n  }\n}\n","import { ValueOrExpr, Operation, Literal, DateRel, DateRelRange, isDateRel, isTimespan, TimeSpan, isApplication } from '../index';\nimport { endRef, isTimespanMS, timespans, timeSpanToNumber } from '../parse';\nimport { Schema } from '../index';\n\nconst checkIdent = new RegExp(`[${endRef.split('').map(v => `\\\\${v}`).join('')}]`);\n\nexport interface ListOverride {\n  base: boolean|number;\n  array?: boolean|number;\n  union?: boolean|number;\n  args?: boolean|number;\n  keys?: boolean|number;\n}\n\ninterface _ListOverride {\n  array: number;\n  union: number;\n  args: number;\n  keys: number;\n}\n\nexport type StringifyOpts = SimpleStringifyOpts | SExprStringifyOpts;\nexport interface BaseStringifyOpts {\n  /** Disable the use of symbol style :strings. */\n  noSymbols?: boolean;\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps?: boolean;\n  /** Enable comma separators in lists of values. */\n  listCommas?: boolean;\n  /** Whether to wrap lists of items. `true` wraps every item. A number targets that many characters in the output to cause a wrap. The default is 60 chars. */\n  listWrap?: boolean|number|ListOverride;\n  /** Output template formatted expressions. */\n  template?: boolean;\n  /** Output unindented single line expressions. */\n  noIndent?: boolean;\n  /** Output HTML-friendly syntax */\n  htmlSafe?: boolean;\n  /** Strip checks out of schema types */\n  noChecks?: boolean;\n}\nexport interface SimpleStringifyOpts extends BaseStringifyOpts {\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps?: false;\n}\nexport interface SExprStringifyOpts extends BaseStringifyOpts {\n  /** Render all operations as s-expressions rather than sugary raport expressions. */\n  SExprOps: true;\n  /** Output array function calls rather than sugared array literals. */\n  noArrayLiterals?: boolean;\n  /** Output object function calls rather than sugared object literals. */\n  noObjectLiterals?: boolean;\n}\n\nlet _noSym: boolean = false;\nlet _key: boolean = false;\nlet _sexprops: boolean = false;\nlet _listcommas: boolean = false;\nlet _noarr: boolean = false;\nlet _noobj: boolean = false;\nlet _tpl: boolean = false;\nlet _tplmode: boolean = false;\nlet _noindent: boolean = false;\nlet _listwrap: _ListOverride = { array: 60, union: 60, args: 60, keys: 60 };\nlet _html: boolean = false;\nlet _nochecks: boolean = false;\n\nlet _level = 0;\nlet _first = false;\n\nconst deepops = ['===', '!==', 'deep-is', 'deep-is-not'];\nconst binops = deepops.concat(['**', '*', '/%', '/', '%', '+', '-', '>=', 'gte', '>', 'gt', '<=', 'lte', '<', 'lt', 'in', 'like', 'ilike', 'not-in', 'not-like', 'not-ilike', 'contains', 'does-not-contain', 'is', 'is-not', '==', '!=', 'strict-is', 'strict-is-not', 'and', '&&', 'or', '||', '??']);\nconst unops = ['+', 'not'];\nconst precedence = {\n  '**': 1,\n  '*': 2, '/%': 2, '/': 2, '%': 2,\n  '+': 3, '-': 3,\n  '>=': 4, '>': 4, '<=': 4, '<': 4, in: 4, like: 4, ilike: 4, 'not-in': 4, 'not-like': 4, 'not-ilike': 4, 'contains': 4, 'does-not-contain': 4, gt: 4, gte: 4, lt: 4, lte: 4,\n  'is': 5, 'is-not': 5, '==': 5, '!=': 5, 'strict-is': 5, 'strict-is-not': 5, 'deep-is': 5, 'deep-is-not': 5, '===': 5, '!==': 5,\n  'and': 6, '&&': 6,\n  'or': 7, '||': 7, '??': 7,\n}\n\nconst call_op = /^[-a-zA-Z_$0-9]/;\n\nexport function stringify(value: ValueOrExpr, opts?: StringifyOpts): string {\n  opts = opts || {};\n  _noSym = opts.noSymbols;\n  _sexprops = opts.SExprOps;\n  _listcommas = opts.listCommas;\n  _noarr = opts.SExprOps && opts.noArrayLiterals;\n  _noobj = opts.SExprOps && opts.noObjectLiterals;\n  _key = false;\n  _tpl = _tplmode = opts.template;\n  _noindent = opts.noIndent;\n  _level = 0;\n  _first = true;\n  if ('listWrap' in opts) {\n    const o = opts.listWrap;\n    if (typeof o === 'boolean') _listwrap = !o ? { array: 0, union: 0, args: 0, keys: 0 } : { array: 1, union: 1, args: 1, keys: 1 };\n    else if (typeof o === 'number') _listwrap = { array: o, union: o, args: o, keys: o };\n    else {\n      const b = !o.base ? 0 : o.base === true ? 1 : o.base;\n      _listwrap = Object.keys(_listwrap).reduce((a, c) => (a[c] = c in o && o[c] != null ? (!o[c] ? 0 : o[c] === true ? 1 : o[c]) : b, a), {} as any);\n    }\n  } else _listwrap = { array: 60, union: 60, args: 60, keys: 60 };\n  _html = opts.htmlSafe;\n  _nochecks = opts.noChecks;\n  if (!_sexprops && typeof value === 'object' && value && 'op' in value && value.op === 'block') return stringifyRootBlock(value);\n  else return _stringify(value);\n}\n\nfunction padl(v: any, pad: string, len: number): string {\n  v = `${v}`;\n  if (!pad) return v;\n  for (let i = v.length; i < len; i++) {\n    v = pad + v;\n  }\n  return v;\n}\n\nfunction fill(char: string, len: number): string {\n  let res = '';\n  for (let i = 0; i < len; i++) res += char;\n  return res;\n}\n\nfunction _stringify(value: ValueOrExpr): string {\n  if (typeof value === 'string') return value;\n  let stringed: string;\n  if (value == null || typeof value === 'number' || typeof value === 'boolean') return `${value}`;\n  if (_tpl && ('op' in value || 'r' in value)) {\n    if ('op' in value) {\n      if (value.op === 'if' || value.op === 'with' || value.op === 'unless' || value.op === 'each') {\n        stringed = stringifyTemplateBlock(value);\n      } else if (value.op === 'case') {\n        stringed = stringifyTemplateCase(value);\n      } else if (value.op) {\n        if (value.op === '+') return value.args.map(a => _stringify(a)).join('');\n        else {\n          _tpl = false;\n          const res = `{{${_stringify(value.op === 'string' ? value.args[0] : value)}}}`;\n          _tpl = true;\n          stringed = res;\n        }\n      }\n    } else {\n      _tpl = false;\n      const res = `{{${_stringify(value)}}}`;\n      _tpl = true;\n      stringed = res;\n    }\n  } else if ('r' in value) {\n    if (typeof value.r === 'string') stringed = /^[0-9]/.test(value.r) ? `.${value.r}` : value.r;\n    else {\n      const r = value.r;\n      stringed = `${fill('^', r.u || 0)}${r.p || ''}${r.k.map((p, i) => {\n        if (typeof p === 'string' && checkIdent.test(p)) return `${i ? '' : '_'}[${_stringify({ v: p })}]`;\n        else if (typeof p === 'string' || typeof p === 'number') return `${i ? '.' : ''}${p}`;\n        else return `[${_stringify(p)}]`\n      }).join('')}`;\n    }\n  } else if ('op' in value) {\n    stringed = stringifyOp(value);\n  } else if (isApplication(value)) {\n    const arrow = ((_tplmode && _html !== false) || _html) ? '\\\\' : '>';\n    if ('n' in value) stringed = `|${value.n.join(_listcommas ? ', ' : ' ')}| =${arrow} ${_stringify(value.a)}`;\n    else stringed = `=${arrow}${_stringify(value.a)}`;\n  } else if ('v' in value) {\n    stringed = stringifyLiteral(value);\n  } else if (isDateRel(value)) {\n    stringed = stringifyDate(value);\n  } else if (isTimespan(value)) {\n    stringed = stringifyTimespan(value);\n  }\n\n  if ('c' in value && value.c.length) stringed = (_first ? '' : '\\n') + value.c.map(c => `${padl('', '  ', _level)}// ${c}\\n`).join('') + `${padl('', '  ', _level)}${stringed}`;\n\n  return stringed;\n}\n\nfunction stringifyBinopArg(op: string, arg: ValueOrExpr, pos: 1|2): string {\n  let res: string;\n  if (op === '**' && pos === 1 && typeof arg !== 'string' && 'op' in arg && arg.op === '**') res = `(${_stringify(arg)})`;\n  if (typeof arg !== 'string' && 'op' in arg) {\n    if (binops.includes(arg.op) && precedence[arg.op] > precedence[op]) res = `(${_stringify(arg)})`;\n    else if (arg.op === 'if' || arg.op === 'unless' || arg.op === 'case' || arg.op === 'fmt' || arg.op === 'format') res = `(${_stringify(arg)})`;\n    else res = _stringify(arg);\n  } else res = _stringify(arg);\n  return res;\n}\n\nfunction findNestedStringOpL(op: string, value: Operation): boolean {\n  if (value.args && value.args.find(a => typeof a === 'object' && typeof (a as any).v === 'string')) return true;\n  if (!value.args || !value.args.length) return false;\n  const left = value.args[0];\n  if (typeof left === 'object' && 'op' in left && left.op === op) return findNestedStringOpL(op, left);\n  return false;\n}\n\nfunction flattenNestedBinopsL(op: string, value: Operation, agg: ValueOrExpr[] = []): ValueOrExpr[] {\n  if (value.args && value.args.length) {\n    let i = 0;\n    for (; i < value.args.length; i++) {\n      if (typeof value.args[i] === 'object' && typeof (value.args[i] as any).v === 'string') agg.push(value.args[i]);\n      else break;\n    }\n    const left = value.args[i];\n    if (typeof left === 'object' && 'op' in left && left.op === op) flattenNestedBinopsL(op, left, agg);\n    else agg.push(left);\n    agg.push.apply(agg, value.args.slice(i + 1));\n  }\n  return agg;\n}\n\nfunction stringifyOp(value: Operation): string {\n  let op = value.op;\n  if ((_tplmode && _html !== false) || _html) {\n    if (op === '>') op = 'gt';\n    else if (op === '>=') op = 'gte';\n    else if (op === '<') op = 'lt';\n    else if (op === '<=') op = 'lte';\n    else if (op === '&&') op = 'and';\n  }\n  if (!_noarr && op === 'array' && !value.opts) {\n    return wrapArgs('[', value.args, value.opts, ']');\n  } else if (!_noobj && op === 'object' && value.args && !value.args.find((a, i) => i % 2 === 0 && (typeof a === 'string' || !('v' in a) || typeof a.v !== 'string'))) {\n    if (!value.args || !value.args.length) return '{}';\n    return wrapArgs('{', value.args, value.opts, '}', 2);\n  } else if (_sexprops) {\n    if (!value.args || !value.args.length) return `(${op})`;\n    return wrapArgs(`(${op} `, value.args, value.opts, ')', 0);\n  } else if (op === 'if' || op === 'unless' && value.args && value.args.length > 2) {\n    return stringifyIf(value);\n  } else if (op === 'case' && value.args && value.args.length > 2) {\n    return stringifyCase(value);\n  } else if (op === '+' && value.args && value.args.length > 1 && findNestedStringOpL(op, value)) {\n    const args = flattenNestedBinopsL(op, value);\n    return `'${args.map(a => typeof a !== 'string' && 'v' in a && typeof a.v === 'string' ? a.v.replace(/[{']/g, v => `\\\\${v}`).replace(/\\$$/, '\\\\$') : `{${_stringify(a)}}`).join('')}'`\n  } else if ((op === 'fmt' || op === 'format') && value.args && typeof value.args[1] === 'object' && 'v' in value.args[1] && typeof value.args[1].v === 'string') {\n    const val = value.args[0];\n    let vs = _stringify(val);\n    if (typeof val !== 'string' && 'op' in val && (binops.includes(val.op) || unops.includes(val.op))) vs = `(${vs})`;\n    if (value.opts) return `${vs}#${[value.args[1].v]}${wrapArgs('(', value.args.slice(2), value.opts, ')')}`;\n    else return `${vs}#${[value.args[1].v].concat(value.args.slice(2).map(a => _stringify(a))).join(',')}`;\n  } else if (binops.includes(op) && value.args && value.args.length > 1 && !value.opts && (!deepops.includes(op) || value.args.length === 2)) {\n    let parts = value.args.map((a, i) => stringifyBinopArg(op, a, i === 0 ? 1 : 2));\n    const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || parts.reduce((a, c) => a + c.length, 0) && parts.length > 2;\n    const split = _noindent ? ' ' : long ? `\\n${padl('', '  ', _level + 1)}` : ' ';\n    if (split.length > 1 || (!_noindent && long)) parts = [parts[0]].concat(parts.slice(1).map(p => indentAll('  ', p)));\n    return `${parts[0]} ${op}${split}${parts.slice(1).join(` ${op}${split.length > 1 ? `${split}` : split}`)}`;\n  } else if (unops.includes(op) && value.args && value.args.length === 1) {\n    const arg = value.args[0];\n    if (typeof arg !== 'string' && 'op' in arg && (binops.includes(arg.op) || unops.includes(arg.op))) return `${op}(${_stringify(arg)})`;\n    else return `${op}${call_op.test(op) ? ' ' : ''}${_stringify(arg)}`;\n  } else if (op === 'block') {\n    if (!value.args || !value.args.length) return '';\n\n    _level++;\n    const _f = _first;\n    const parts = value.args.map((a, i) => (_first = i === 0, _stringify(a)));\n    _first = _f;\n    let split = _noindent ? '' : `\\n${padl('', '  ', _level)}`;\n    _level--;\n    if (parts.length === 1 && !~parts[0].indexOf('\\n')) return `{ ${parts[0]} }`;\n    return `{${split}${parts.join(split)}\\n${padl('', '  ', _level)}}`;\n  } else if ((op === 'let' || op === 'set') && value.args && value.args.length === 2) {\n    let path: string;\n    let arg = value.args[0];\n    if (typeof arg === 'string') path = arg;\n    else if ('v' in arg && typeof arg.v === 'string') path = arg.v;\n    else if ('v' in arg && typeof arg.v === 'object' && 'k' in arg.v) path = _stringify({ r: arg.v });\n    else path = _stringify(arg);\n    return `${op} ${path} = ${_stringify(value.args[1])}`;\n  } else if (op === 'get' && value.args.length === 2 && typeof value.args[1] === 'object' && 'v' in value.args[1] && typeof value.args[1].v === 'object' && 'k' in value.args[1].v) {\n    return `${_stringify(value.args[0])}${_stringify({ r: { k: ['r'].concat(value.args[1].v.k) } }).substr(1)}`;\n  } else if (call_op.test(op)) {\n    return wrapArgs(`${op}(`, value.args || [], value.opts, ')', 0);\n  } else {\n    if (!value.args || !value.args.length) return `(${op})`;\n    return wrapArgs(`(${op} `, value.args, value.opts, ')', 0);\n  }\n}\n\nfunction stringifyRootBlock(block: Operation): string {\n  if (!block.args || !block.args.length) return '';\n  return block.args.map((a, i) => (_first = i === 0, _stringify(a))).join('\\n');\n}\n\nfunction stringifyLiteral(value: Literal): string {\n  if (value.s === 1) {\n    _level++;\n    const res = stringifySchema(value.v);\n    _level--;\n    if (~res.indexOf('\\n')) {\n      const level = _noindent ? ' ' : `\\n${padl('', '  ', _level)}`;\n      return `@[${level}${level !== ' ' ? '  ' : ''}${res}${level}]`;\n    } else return `@[${res}]`;\n  } else if (typeof value.v === 'string') {\n    if (_tpl) return value.v.replace(/\\\\(.)/g, '\\\\\\\\$1').replace(/{{/g, '\\\\{{');\n    if ((_key || !_noSym) && !checkIdent.test(value.v) && value.v.length) return `${_key ? '' : ':'}${value.v}`;\n    else if (!~value.v.indexOf(\"'\")) return `'${value.v.replace(/[{']/g, v => `\\\\${v}`).replace(/\\${/g, '\\\\${')}'`;\n    else if (!~value.v.indexOf('`')) return `\\`${value.v.replace(/[{`]/g, v => `\\\\${v}`).replace(/\\${/g, '\\\\${')}\\``;\n    else if (!~value.v.indexOf('\"')) return `\"${value.v}\"`;\n    else return `'${value.v.replace(/['{]/g, s => `\\\\${s}`).replace(/\\${/g, '\\\\${')}'`;\n  } else if (typeof value.v === 'number' || typeof value.v === 'boolean' || value.v === 'true' || value.v === 'false') {\n    return `${value.v}`;\n  } else if (value.v === 'undefined' || value.v === undefined) {\n    return 'undefined';\n  } else if (value.v === 'null' || value.v === null) {\n    return 'null';\n  } else if (Array.isArray(value.v)) {\n    if (_noarr) return wrapArgs('(array', value.v.map(v => ({ v })), null, ')', null, 'array');\n    return wrapArgs('[', value.v.map(v => ({ v })), null, ']', null, 'array');\n  } else if (typeof value.v === 'object') {\n    if (isDateRel(value.v)) {\n      return stringifyDate(value.v);\n    } else {\n      return wrapArgs('{', Object.entries(value.v).reduce((a, c) => (a.push({ v: c[0] }, { v: c[1] }), a), []), null, '}', 2, 'keys');\n    }\n  }\n}\n\nfunction offsetToTimezone(dir: 1|-1, offset?: number): string {\n  if (offset == null) return '';\n  offset = offset * dir;\n  const o = Math.abs(offset);\n  const h = Math.floor(o / 60);\n  const m = o % 60;\n  if (!offset) return 'Z';\n  else return `${offset > 0 ? '-' : '+'}${h}${m ? `:${padl(m, '0', 2)}` : ''}`;\n}\n\nconst spanKeys = ['w', 'd', 'h', 'mm', 's'];\nconst spanExact = ['y', 'm', 'd', 'h', 'mm', 's', 'ms'];\nfunction stringifyDate(value: DateRel): string {\n  let str = '';\n  if (value instanceof Date) { // date object\n    const y = value.getFullYear();\n    const m = value.getMonth() + 1;\n    const d = value.getDate();\n    const h = value.getHours();\n    const mn = value.getMinutes();\n    const s = value.getSeconds();\n    const ms = value.getMilliseconds();\n    str = `${y}-${padl(m, '0', 2)}-${padl(d, '0', 2)}`;\n    if (h + mn + s + ms > 0) {\n      str += ` ${padl(h, '0', 2)}:${padl(mn, '0', 2)}`;\n      if (s + ms > 0) {\n        str += `:${padl(s, '0', 2)}`;\n        if (ms > 0) str += `.${padl(ms, '0', 3)}`;\n      }\n    }\n    return `#${str}${offsetToTimezone(1, value.getTimezoneOffset())}#`;\n  } else if (Array.isArray(value.f)) { // precise date\n    const a = value.f;\n    str = `${a[0]}`;\n    if (a[1] != null) str += `-${padl(a[1] + 1, '0', 2)}`;\n    if (a[2] != null) str += `-${padl(a[2], '0', 2)}`;\n    if (a[3] != null) str += ` ${padl(a[3], '0', 2)}`;\n    if (a[4] != null) str += `:${padl(a[4], '0', 2)}`;\n    if (a[5] != null) str += `:${padl(a[5], '0', 2)}`;\n    if (a[6] != null) str += `.${padl(a[6], '0', 3)}`;\n    if (a[7] != null) str += ` ${offsetToTimezone(-1, a[7])}`;\n    if ('e' in value && value.e) str += '<';\n    return `#${str}#`;\n  } else if (value.f === 'n') { // relative point in time\n    if (Array.isArray(value.o)) { // inconsistent units\n      spanExact.forEach((k, i) => {\n        if (value.o[i] != null) str += `${value.o[i]}${k}`;\n      });\n      str += `${'d' in value && value.d === -1 ? ' ago' : ' from now'}${offsetToTimezone(-1, value.z)}`;\n      return `#${str}#`;\n    } else if (typeof value.o === 'number') { // milliseconds\n      if (value.o === 0) return `#now#`;\n      let rem = Math.abs(value.o);\n      spanKeys.forEach(k => {\n        const t = Math.floor(rem / timespans[k]);\n        rem = rem % timespans[k];\n        if (t) str += `${t}${k}`;\n      });\n      if (rem) str += `${rem}ms`;\n      return `#${str}${value.o < 0 ? ' ago' : value.o > 0 ? ' from now' : ''}${offsetToTimezone(-1, value.z)}#`;\n    }\n  } else if ('d' in value && value.d === 1 && value.o === 0) { // span to date\n    str = `#${value.f === 'w' ? 'week' : value.f === 'm' ? 'month' : 'year'} to date${offsetToTimezone(-1, value.z)}${value.e && '>' || ''}#`;\n  } else if ('t' in value && Array.isArray(value.t)) { // time on relative day\n    const a = value.t;\n    str = `${value.o < 0 ? 'yesterday' : value.o > 0 ? 'tomorrow' : 'today'} at `;\n    if (!a[0] && !a[1] && !a[2] && !a[3]) str += 'midnight';\n    else if (a[0] === 12 && !a[1] && !a[2] && !a[3]) str += 'noon';\n    else {\n      str += a[0];\n      if (a[1] != null) str += `:${padl(a[1], '0', 2)}`;\n      if (a[2] != null) str += `:${padl(a[2], '0', 2)}`;\n      if (a[3] != null) str += `.${padl(a[3], '0', 3)}`;\n    }\n    return `#${str}${offsetToTimezone(-1, a[4])}${value.e ? '>' : ''}#`;\n  } else if (!('t' in value) && !('d' in value) && !Array.isArray(value.f)) { // relative span\n    const v = value as DateRelRange;\n    if (v.f === 'd') {\n      str += `${v.o < 0 ? 'yesterday' : v.o > 0 ? 'tomorrow' : 'today'}`;\n    } else {\n      str += `${v.o < 0 ? 'last' : v.o > 0 ? 'next' : 'this'} ${v.f === 'w' ? 'week' : v.f === 'm' ? 'month' : 'year'}`;\n    }\n    return `#${str}${offsetToTimezone(-1, v.z)}${v.e ? '>' : ''}#`;\n  }\n\n  return str;\n}\n\nfunction stringifyTimespan(value: TimeSpan): string {\n  if (typeof value === 'number' || isTimespanMS(value)) {\n    let str = '';\n    let rem = Math.abs(timeSpanToNumber(value));\n    spanKeys.forEach(k => {\n      const t = Math.floor(rem / timespans[k]);\n      rem = rem % timespans[k];\n      if (t) str += `${t}${k}`;\n    });\n    if (rem) str += `${rem}ms`;\n    return `#${str}#`;\n  } else {\n    const o = value.d;\n    let str = '';\n    spanExact.forEach((k, i) => {\n      if (o[i] != null) str += `${o[i]}${k}`;\n    });\n    return `#${str}#`;\n  }\n}\n\nconst leadingSpace = /^\\s+/;\nconst allLeadingSpace = /^\\s+/gm;\nfunction outdentAll(amount: string, str: string): string {\n  if (amount) return str.replace(allLeadingSpace, s => s.substr(amount.length));\n  else return str;\n}\nfunction indentAll(amount: string, str: string): string {\n  return str.replace(/\\n/gm, `\\n${amount}`);\n}\n\nfunction wrapArgs(open: string, args: ValueOrExpr[], opts: ValueOrExpr, close: string, keyMod?: number, wrapSetting?: keyof _ListOverride): string {\n  if ((!args || !args.length) && !opts) return `${open}${close}`;\n  _level++;\n  const _f = _first;\n  let parts: string[];\n  if (keyMod) {\n    parts = [];\n    for (let i = 0; i < args.length; i++) {\n      if (i % keyMod === 0) {\n        _key = true;\n        parts.push(_stringify(args[i]) + ':');\n        _key = false;\n      } else {\n        _level++;\n        _first = i === 1;\n        const res = _stringify(args[i]);\n        if (res[0] === '\\n')  parts[parts.length - 1] += ' ' + res.replace(leadingSpace, '');\n        else parts[parts.length - 1] += res;\n        _level--;\n      }\n    }\n  } else {\n    parts = args.map((a, i) => {\n      _first = i === 0;\n      return _stringify(a);\n    });\n  }\n  if (opts && typeof opts === 'object') {\n    const args = 'op' in opts && opts.args ? opts.args : 'v' in opts ? Object.entries(opts.v).reduce((a, c) => (a.push({ v: c[0] }, { v: c[1] }), a), []) : [];\n    for (let i = 0; i < args.length; i++) {\n      if (i % 2 === 0) {\n        _key = true;\n        parts.push(_stringify(args[i]) + ':');\n        _key = false;\n      } else {\n        _level++;\n        _first = i === 1;\n        const res = _stringify(args[i]);\n        if (res[0] === '\\n')  parts[parts.length - 1] += ' ' + res.replace(leadingSpace, '');\n        else parts[parts.length - 1] += res;\n        _level--;\n      }\n    }\n  }\n  _level--;\n  _first = _f;\n\n  let join = _listcommas ? ', ' : ' ';\n  if (_noindent || (parts.length == 1 && !~parts[0].indexOf('\\n'))) return `${open}${parts.join(join)}${close}`;\n  let wrap = _listwrap[wrapSetting || 'args'];\n  const base = parts.join(_listcommas ? ', ' : ' ');\n  if (!wrap && ~base.indexOf('\\n')) wrap = 1;\n  if (wrap === 1 && _listcommas) join = ',\\n';\n\n  const level = padl('', '  ', _level);\n\n  if (!wrap) return `${open}${base}${close}`;\n  else if (wrap === 1) return `${open}\\n${parts.map(p => `${level}  ${p}`).join(join)}\\n${level}${close}`;\n  if (base.length <= wrap) return `${open}${base}${close}`;\n\n  let res = `${open}`;\n  let str = '';\n  const last = parts.length - 1;\n  for (let i = 0; i < parts.length; i++) {\n    if (~parts[i].indexOf('\\n')) {\n      if (str) res += str;\n      res += `\\n${parts[i][0] === ' ' ? '' : level + '  '}${parts[i]}${i !== last ? join : ''}`;\n      str = '';\n      continue;\n    }\n    if (!str) str += `\\n${level}  `;\n    str += `${parts[i]}${i !== last ? join : ''}`;\n    if (str.length >= wrap) {\n      res += str;\n      str = '';\n    }\n  }\n  if (str) res += str;\n  return `${res}\\n${level}${close}`;\n}\n\nfunction isBlock(v: any): boolean {\n  return typeof v === 'object' && 'op' in v && v.op === 'block';\n}\n\nfunction stringifyIf(op: Operation): string {\n  if (!op.args || op.args.length < 2) return 'false';\n\n  let str = '';\n\n  const last = op.args.length - 1;\n  const block = !!op.args.find((p, i) => (i % 2 === 1 || i === last) && isBlock(p));\n\n  _level++;\n  const parts = op.args.map((a, i) => _stringify(block && (i % 2 === 1 || i === last) && !isBlock(a) ? { op: 'block', args: [a] } : a));\n  _level--;\n\n  const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || '';\n  let split = _noindent ? '' : parts.length > 3 || long ? `\\n${padl('', '  ', _level)}` : '';\n  const cindent = long && `${split}  ` || ' ';\n  split = split || ' ';\n  for (let i = 0; i <= last; i++) {\n    if (i === 0) {\n      if (block) str += `if ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else {\n        const cond = parts[i++];\n        str += `if ${cond}${~cond.indexOf('\\n') ? split : ' '}then${cindent}${parts[i].trimLeft()}`\n      }\n    } else if (i === last) {\n      if (block) str = str.trimRight() + ` else ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${split}else${cindent}${parts[i].trimLeft()}`;\n    } else {\n      if (block) str = str.trimRight() + ` elif ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${split}elif ${parts[i++]} then${cindent}${parts[i].trimLeft()}`;\n    }\n  }\n  if (!block && _level) str += `${split}end`;\n\n  return str;\n}\n\nconst caseRE = /@case\\b/g;\nfunction stringifyCase(op: Operation): string {\n  if (!op.args || op.args.length < 2) return 'false';\n\n  let str = '';\n\n  const last = op.args.length - 1;\n  const block = !!op.args.find((p, i) => ((i > 1 && i % 2 === 0) || i === last) && isBlock(p));\n\n  _level++;\n  const parts = op.args.map((a, i) => {\n    let res: string;\n    if (i !== 0) _level++;\n\n    if (block && (i > 1 && i % 2 === 0 || i === last)) {\n      res = _stringify(isBlock(a) ? a : { op: 'block', args: [a] });\n    } else if (i % 2 === 0 || i === last) {\n      res = _stringify(a);\n    } else {\n      res = typeof a === 'object' && 'op' in a ? _stringify(a).replace(caseRE, '_') : _stringify(a);\n    }\n\n    if (i !== 0) _level--;\n\n    return res;\n  });\n  _level--;\n\n  const long = parts.find(p => p.length > 30 || ~p.indexOf('\\n')) || '';\n  let split = _noindent ? '' : parts.length > 3 || long ? `\\n${padl('', '  ', _level)}` : '';\n  const wsplit = split ? `${split}  ` : ' ';\n  const cindent = long && `${wsplit}  ` || ' ';\n  split = split || ' ';\n  for (let i = 0; i <= last; i++) {\n    if (i === 0) {\n      if (block) str += `case ${parts[i]}`;\n      else str += `case ${parts[i]}`\n    } else if (i === last) {\n      if (block) str = str.trimRight() + wsplit + `else ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else str += `${wsplit}else${cindent}${parts[i].trimLeft()}`\n    } else {\n      if (block) str = str.trimRight() + wsplit + `when ${parts[i++]} ${outdentAll('  ', parts[i]).trimLeft()}`;\n      else {\n        const cond = parts[i++];\n        str += `${wsplit}when ${cond}${~cond.indexOf('\\n') ? wsplit : ' '}then${cindent}${parts[i].trimLeft()}`;\n      }\n    }\n  }\n  if (!block && _level) str += `${split}end`;\n\n  return str;\n}\n\nfunction stringifyTemplateBlock(op: Operation): string {\n  _tpl = false;\n  const cond = _stringify(op.args[0]);\n  _tpl = true;\n  const first = _stringify(op.args[1]);\n  let res = `{{${op.op} ${cond}}}${op.op === 'with' || op.op === 'each' ? first.slice(2) : first}`;\n  if (op.op === 'unless') return `${res}{{/}}`;\n  for (let i = 2; i < op.args.length; i++) {\n    if (i + 1 >= op.args.length) {\n      const arg = op.args[i];\n      if (typeof arg === 'object' && 'v' in arg && arg.v === '') continue;\n      else res += `{{else}}${_stringify(arg)}`;\n    } else {\n      _tpl = false;\n      res += `{{elseif ${_stringify(op.args[i++])}}}`;\n      _tpl = true;\n      res += _stringify(op.args[i]);\n    }\n  }\n  res += '{{/}}';\n  return res;\n}\n\nfunction stringifyTemplateCase(op: Operation): string {\n  const last = op.args.length - 1;\n  const parts = op.args.map((a, i) => {\n    _tpl = true;\n    if (i === 0 || i % 2 === 1) _tpl = false;\n    if (i === last) _tpl = true;\n    return typeof a === 'object' && 'op' in a ? _stringify(a).replace(caseRE, '_') : _stringify(a);\n  });\n  _tpl = true;\n  let res = `{{${op.op} ${parts[0]} when ${parts[1]}}}`;\n  for (let i = 2; i <= last; i++) {\n    if (i === last) res += `{{else}}${parts[i]}`;\n    else if (i % 2 === 1) res += `{{when ${parts[i]}}}`;\n    else res += parts[i];\n  }\n  res += '{{/}}';\n  return res;\n}\n\nexport function stringifySchema(schema: Schema, noChecks?: boolean): string {\n  if (noChecks !== undefined) _nochecks = noChecks;\n\n  if (!schema) return 'any';\n  const t = schema.type;\n  const ts = schema.types;\n\n  let strs: string[];\n  let fin = '', open = '', close = '', join = '';\n  let wrap: number = _listwrap.array;\n\n  switch (t) {\n    case 'object':\n    case 'object[]':\n      const arr = !!~t.indexOf('[]');\n      if ((!schema.fields || !schema.fields.length) && !schema.rest) {\n        fin = `{}${arr ? '[]' : ''}`;\n        break;\n      }\n      wrap = _listwrap.keys;\n      _level++;\n      strs = schema.fields ? schema.fields.map((f, i) => {\n        const str = stringifySchema(f);\n        return (f.desc && f.desc.length ? (i === 0 ? '' : `\\n${padl('', '  ', _level)}`) + f.desc.map(c => `// ${c}`).join(`\\n${padl('', '  ', _level)}`) + `\\n${padl('', '  ', _level)}` : '') + `${f.name}${f.required ? '' : '?'}: ${str}`;\n      }) : [];\n      if (schema.rest) strs.push(`...: ${stringifySchema(schema.rest)}`);\n      _level--;\n      open = '{';\n      close = `}${arr ? '[]' : ''}`;\n      join = ', ';\n      break;\n    case 'union':\n    case 'union[]':\n      if (~t.indexOf('[]')) open = 'Array<', close = '>';\n      else if (schema.checks && schema.checks.length) open = '(', close = ')';\n      if (open) _level++;\n      strs = ts.map(u => stringifySchema(u));\n      wrap = _listwrap.union;\n      join = strs.length > 6 || strs.find(s => ~s.indexOf('\\n')) ? ' | ' : '|';\n      if (open) _level--;\n      break;\n    case 'literal':\n      if (typeof schema.literal === 'string') fin = `'${schema.literal.replace(/'/g, '\\\\\\'')}'`;\n      else fin = `${schema.literal}`;\n      break;\n    case 'tuple':\n    case 'tuple[]':\n      if (!t || t.length === 0) {\n        fin = '[]';\n        break;\n      }\n\n      _level++;\n      open = '[', close = `]${~t.indexOf('\\n') ? '[]' : ''}`;\n      join = ', ';\n      strs = ts.map(t => stringifySchema(t));\n      _level--;\n      break;\n    default:\n      fin = schema.ref || t || 'any';\n      if (schema.ref && t === 'array') fin += '[]';\n      break;\n  }\n\n  let defs: string;\n  const level = _noindent ? ' ' : padl('', '  ', _level);\n\n  if (schema.defs) {\n    const keys = Object.keys(schema.defs).sort();\n    defs = keys.map((k, i) => {\n      const def = schema.defs[k];\n      return (def.desc && def.desc.length ? (i === 0 ? '' : `\\n${level}`) + def.desc.map(c => `// ${c}`).join(`\\n${level}`) + `\\n${level}` : '') + `type ${k} = ${stringifySchema(def)}`;\n    }).join(`\\n${level}`);\n  }\n\n  if (!fin) {\n    const l2 = open && !_noindent ? `${level}  ` : level;\n    const nl = _noindent ? '' : '\\n';\n    const lopen = open ? `${open}${nl}${l2}` : '';\n    const lclose = close ? `${nl}${level}${close}` : '';\n    if (wrap === 0) fin = `${lopen}${strs.join(join)}${lclose}`;\n    else if (wrap === 1) fin = `${lopen}${strs.join(`${join}${nl}${l2}`)}${lclose}`;\n    else {\n      let line = '';\n      \n      const last = strs.length - 1;\n      for (let i = 0; i < strs.length; i++) {\n        if (~strs[i].indexOf('\\n')) {\n          line = '';\n          fin += (i === 0 ? '' : '\\n' + l2) + strs[i] + (i !== last ? join : '');\n        } else {\n          fin += strs[i], line += strs[i];\n          if (i !== last) fin += join, line += join;\n        }\n\n        if (line.length > wrap && i !== last && !~(strs[i + 1] || '').indexOf('\\n')) {\n          fin += `${nl}${l2}`;\n          line = '';\n          if (~join.indexOf('|')) fin += '  ';\n        }\n      }\n\n      if (~fin.indexOf('\\n')) fin = `${lopen}${fin}${lclose}`;\n      else fin = `${open}${open === '{' ? ' ' : ''}${fin}${open === '{' && fin.substr(-1) !== ' ' ? ' ' : ''}${close}`;\n    }\n  }\n\n  if (!_nochecks && schema.checks && schema.checks.length) {\n    fin += ` ?${schema.checks.map(c => _stringify(c)).join(' ?')} `;\n  }\n\n  if (defs) fin = `${defs}\\n${level}\\n${level}${fin}`;\n\n  return fin;\n}\n","import { parser as makeParser, map, seq, str, opt } from 'sprunge';\nimport { ws } from 'sprunge/lib/json';\nimport { schema } from '../parse';\n\nexport const parseSchema = makeParser(\n  map(seq(opt(str('@[')), ws, schema(), ws, opt(str(']'))), ([, , schema]) => schema),\n  { trim: true, consumeAll: true },\n);\nexport { stringifySchema as unparseSchema } from './stringify';\n","import { parser as makeParser, opt, str, alt, seq, map, rep1sep, read1 } from 'sprunge/lib';\nimport { digits, ws } from 'sprunge/lib/json';\nexport { ParseError } from 'sprunge/lib';\n\nconst space = ' \\t\\r\\n';\n\nconst num = map(seq(opt(str('-')), read1(digits)), ([neg, num]) => neg ? -num : +num);\nconst num_range = map(seq(num, str('-', ':'), num), ([start,, end]) => [start, end].sort((l, r) => l < r ? -1 : l > r ? 1 : 0) as [number, number]);\nconst sign_range = map(seq(str('<', '>'), ws, num), ([sign,, num]) => sign === '<' ? [-Infinity, num - 1] as [number, number] : [num + 1, Infinity] as [number, number]);\nconst star_range = map(str('*'), () => [-Infinity, Infinity] as [number, number]);\nconst not_range = map(seq(str('!'), alt<number|[number, number]>(num_range, sign_range, num)), ([, range]) => ({ not: range }));\n\nconst _range = rep1sep(alt<number|[number, number]|{ not: number|[number, number] }>(star_range, num_range, sign_range, num, not_range), read1(space + ',;'), 'allow');\n\nexport const range = makeParser(_range, { trim: true });\n\nexport default range;\n","import { parseDate } from './parse';\nimport { dateRelToDate } from './index';\n\nexport function join(...strs: string[]): string {\n  return strs.filter(s => s).join('.');\n}\n\nexport interface Diff {\n  [path: string]: [any, any];\n}\n\nconst looseEqual = (v1: any, v2: any) => v1 == v2;\nconst strictEqual = (v1: any, v2: any) => v1 === v2;\nconst isNum = /^[\\d.]+$/;\nconst trueStrings = /^(true|on|yes)$/i;\nconst falseStrings = /^(false|off|no)$/i;\nconst sqlEqual = (v1: any, v2: any) => {\n  let tmp1: any, tmp2: any;\n  if ((typeof v1 === 'number' || typeof v1 === 'string' && isNum.test(v1)) && (typeof v2 === 'number' || typeof v2 === 'string' && isNum.test(v2))) {\n    return +v1 === +v2;\n  } else if ((typeof v1 === 'boolean' || typeof v2 === 'boolean') && (typeof v1 === 'string' || typeof v2 === 'string')) {\n    return trueStrings.test(v1) && trueStrings.test(v2) || falseStrings.test(v1) && falseStrings.test(v2);\n  } else if ((v1 instanceof Date || typeof v1 === 'string' && Array.isArray((tmp1 = parseDate(v1) as any)?.f)) && (v2 instanceof Date || typeof v2 === 'string' && Array.isArray((tmp2 = parseDate(v2) as any)?.f))) {\n    if (tmp1) tmp1 = dateRelToDate(tmp1);\n    else tmp1 = v1;\n    if (tmp2) tmp2 = dateRelToDate(tmp2);\n    else tmp2 = v2;\n    return +tmp1 === +tmp2;\n  }\n\n  else return v1 == v2;\n};\n\ntype Identifier = true|string|((v: any) => any);\nexport interface IdentityMap {\n  [path: string]: Identifier;\n}\n\ntype EqualizerValue = 'strict'|'loose'|'sql'|((v1: any, v2: any) => boolean);\ninterface EqualizerOptions {\n  type?: EqualizerValue;\n  /** A map of identity methods to use when comparing elements within an array, making arrays act as a set */\n  identity?: IdentityMap;\n}\ntype Equalizer = EqualizerOptions | EqualizerValue;\n\nconst fullnum = /^\\d+$/;\nfunction checkIdentity(map: IdentityMap, path: string) {\n  const p = path.split('.').reduce((a, c) => fullnum.test(c) ? `${a}[]` : `${a}${a.length ? '.' : ''}${c}`, '');\n  return map[`${p}[]`];\n}\n\nexport interface DiffOpts {\n  equal?: Equalizer;\n  keys?: 'all'|'common';\n}\n\nexport function diff(v1: any, v2: any, opts?: DiffOpts): Diff {\n  const type = opts?.equal && typeof opts.equal === 'object' ? opts.equal.type : opts?.equal;\n  const eq = typeof type === 'function' ? type : type === 'strict' ? strictEqual : type === 'sql' ? sqlEqual : looseEqual;\n  return _diff(v1, v2, '', {}, eq, typeof opts?.equal === 'object' ? opts?.equal.identity : undefined, opts?.keys || 'all');\n}\n\nfunction _diff(v1: any, v2: any, path: string, diff: Diff, equal: (v1: any, v2: any) => boolean, ident?: IdentityMap, keyMode?: 'all'|'common'): Diff {\n  if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n    if (v1 === v2) return diff;\n    diff[path] = [v1, v2];\n    return diff;\n  }\n\n  let id: Identifier;\n  if (Array.isArray(v1) && Array.isArray(v2) && ident && (id = checkIdentity(ident, path))) {\n    const v1ids = v1.map(v => id === true ? v : typeof id === 'string' ? (v && (typeof v === 'object' || typeof v === 'function') ? v[id] : v) : id(v));\n    const v2ids = v2.map(v => id === true ? v : typeof id === 'string' ? (v && (typeof v === 'object' || typeof v === 'function') ? v[id] : v) : id(v));\n    for (let i = 0; i < v1ids.length; i++) {\n      const idx = v2ids.indexOf(v1ids[i]);\n      if (~idx) {\n        const vv1 = v1[i];\n        const vv2 = v2[idx];\n\n        if (vv1 === vv2) continue;\n        else if (typeof vv1 === 'object' && typeof vv2 === 'object') _diff(vv1, vv2, join(path, `${i}`), diff, equal, ident);\n        else if (!equal(vv1, vv2)) diff[join(path, `${i}`)] = [vv1, vv2];\n      } else diff[join(path, `${i}`)] = [v1[i], undefined];\n    }\n\n    const found = v1ids.slice();\n    for (let i = 0; i < v1ids.length; i++) {\n      if (~found.indexOf(v2ids[i])) continue;\n      diff[join(path, `${i + found.length}`)] = [undefined, v2[i]];\n    }\n  } else {\n    const _v1 = v1 || {};\n    const _v2 = v2 || {};\n    const ks: string[] = [];\n    if (keyMode === 'common') {\n      for (const k of Object.keys(_v1)) if (k in _v2) ks.push(k);\n    } else {\n      ks.push.apply(ks, Object.keys(_v1));\n      for (const k of Object.keys(_v2)) if (!~ks.indexOf(k)) ks.push(k);\n    }\n\n    for (const k of ks) {\n      const vv1 = _v1[k];\n      const vv2 = _v2[k];\n\n      if (vv1 === vv2) continue;\n      else if (typeof vv1 === 'object' && typeof vv2 === 'object') _diff(vv1, vv2, join(path, k), diff, equal, ident);\n      else if (!equal(vv1, vv2)) diff[join(path, k)] = [vv1, vv2];\n    }\n  }\n\n  return diff;\n}\n\nexport function deepEqual(v1: any, v2: any, equal?: EqualizerValue): boolean {\n  const eq = typeof equal === 'function' ? equal : equal === 'strict' ? strictEqual : equal === 'sql' ? sqlEqual : looseEqual;\n  return _deepEqual(v1, v2, eq);\n}\n\nfunction _deepEqual(v1: any, v2: any, equal: (v1: any, v2: any) => boolean): boolean {\n  if (typeof v1 !== 'object' || typeof v2 !== 'object') return equal(v1, v2);\n  if ((!v1 || !v2) && v1 != v2) return false; // eslint-ignore-line eqeqeq\n\n  const ks = Object.keys(v1 || {});\n  for (const k of Object.keys(v2 || {})) if (!~ks.indexOf(k)) ks.push(k);\n\n  for (const k of ks) {\n    const vv1 = v1[k];\n    const vv2 = v2[k];\n\n    if (vv1 === vv2) continue;\n    else if (typeof vv1 === 'object' && typeof vv2 === 'object') {\n      if (!_deepEqual(vv1, vv2, equal)) return false;\n    } else if (!equal(vv1, vv2)) return false;\n  }\n\n  return true;\n}\n\nexport interface LabelOptions {\n  /** Omit keys in the original diff that aren't in the label. */\n  omit?: boolean;\n}\n\nexport function labelDiff(diff: Diff, label: any, opts?: LabelOptions): Diff {\n  const out: Diff = opts?.omit ? {} : Object.assign({}, diff);\n  _labelDiff(diff, label, '', '', out, opts);\n  return out;\n}\n\nconst num = /^\\d+/;\nfunction _labelDiff(diff: Diff, label: any, path: string, str: string, out: Diff, opts?: LabelOptions) {\n  for (const k in label) {\n    if (k.slice(-2) === '[]') {\n      const p = `${path}${path && '.'}${k.slice(0, -2)}`;\n      const l = Array.isArray(label[k]) ? label[k] : [label[k]];\n      const all = Object.keys(diff);\n      const nums: string[] = [];\n      for (const k of all) {\n        if (k.indexOf(p) === 0 && num.test(k.substr(p.length + 1))) {\n          const idx = k.indexOf('.', p.length + 1);\n          const num = k.substring(p.length + 1, ~idx ? idx : undefined);\n          if (!~nums.indexOf(num)) nums.push(num)\n        }\n      }\n      const lbl = `${str}${str && ' '}${l[0]}`;\n      for (const num of nums) {\n        const pp = `${p}${p && '.'}${num}`;\n        if (pp in diff) {\n          out[`${lbl}${lbl && ' '}${+num + 1}`] = diff[pp];\n          if (opts?.omit) delete out[pp];\n        }\n        if (l[1]) _labelDiff(diff, l[1], pp, `${lbl}${lbl && ' '}${+num + 1}`, out, opts);\n      }\n    } else {\n      const p = `${path}${path && '.'}${k}`;\n      let l = Array.isArray(label[k]) ? label[k] : [label[k]];\n      const lbl = `${str}${str && ' '}${l[0]}`;\n      if (p in diff) {\n        out[lbl] = diff[p];\n        if (opts?.omit) delete out[p];\n      }\n      if (l[1]) _labelDiff(diff, l[1], p, lbl, out, opts);\n    }\n  }\n}\n","import { Schema, Field, Type, TypeMap } from './index';\nimport { join } from './diff';\nimport { parseSchema, unparseSchema } from './parse/schema';\nimport { evalApply, Root, Context, safeGet, extend, isDateRel } from './index';\n\nconst date = /^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z$/;\nfunction isDate(v: any) {\n  if (typeof v === 'object') return isDateRel(v);\n  else if (typeof v === 'string' && date.test(v)) return true;\n  return false;\n}\n\nexport function isSchema(what: any): what is Schema {\n  return what && typeof what === 'object' && 'type' in what && typeof what.type === 'string';\n}\n\nexport function inspect(base: any, flat?: boolean): Schema {\n  const root = getType(base);\n  if (Array.isArray(base)) {\n    const fields: Field[] = [];\n    fields.push({ type: 'number', name: 'length' });\n    if (!flat && base.length > 0) {\n      const val = inspect(base[0]);\n      if (val.fields) fields.push({ type: val.type, fields: val.fields, name: '0' });\n      else fields.push({ type: val.type, name: '0' });\n    }\n    return { type: root, fields };\n  } else if (typeof base === 'object' && !isDate(base)) {\n    const fields: Field[] = [];\n    for (const k in base) {\n      fields.push(getField(k, base[k], flat));\n    }\n    return { type: root, fields };\n  }\n  return { type: root };\n}\n\nfunction getField(name: string, v: any, flat?: boolean): Field {\n  const type = getType(v);\n  if (!flat && (~type.indexOf('object') || type === 'array')) {\n    const cs = inspect(v);\n    if (cs.fields) return { type, fields: cs.fields, name };\n    else return { type, name };\n  }\n  return { type: getType(v), name };\n}\n\nfunction getType(v: any): Type {\n  if (typeof v === 'string') {\n    if (isDate(v)) return 'date';\n    else return 'string';\n  }\n  else if (typeof v === 'number') return 'number';\n  else if (typeof v === 'boolean') return 'boolean';\n  else if (Array.isArray(v)) {\n    if (v.length < 1) return 'array';\n    else if (typeof v[0] === 'string') {\n      if (isDate(v[0])) return 'date[]';\n      else return 'string[]';\n    }\n    else if (typeof v[0] === 'number') return 'number[]';\n    else if (typeof v[0] === 'boolean') return 'boolean[]';\n    else if (isDate(v[0])) return 'date[]';\n    else if (typeof v[0] === 'object') return 'object[]';\n    else return 'array';\n  } else if (typeof v === 'object') {\n    if (isDate(v)) return 'date';\n    else return 'object';\n  } else return 'any';\n}\n\nexport type ValidationResult = ValidationError[] | true;\nexport interface ValidationError {\n  error: string;\n  type?: 'strict'|'check'|'missing';\n  path?: string;\n  actual?: string;\n  expected?: string;\n  value?: any;\n  literal?: boolean;\n}\n\nexport function validate(value: any, schema: Schema|string, mode?: 'strict'|'missing'|'loose'): ValidationResult {\n  if (typeof schema === 'string') {\n    const parsed = parseSchema(schema);\n    if ('message' in parsed) return [{ error: 'invalid schema' }];\n    schema = parsed;\n  }\n\n  if (!schema) schema = { type: 'any' };\n  const ctx = new Root(value, { special: { types: schema.defs || {} } });\n  return _validate(value, schema, mode, '', ctx);\n}\n\nfunction _validate(value: any, schema: Schema, mode: 'strict'|'missing'|'loose', path: string, ctx: Context, required?: boolean): ValidationResult {\n  schema = schema || {};\n  let _schema = schema;\n  const errs: ValidationError[] = [];\n  const miss = mode === 'strict' || mode === 'missing';\n  if (_schema.ref) {\n    let s = _schema;\n    while (s && s.ref) s = safeGet(ctx, `@types.${s.ref}`);\n    if (s) _schema = s;\n    else if (miss) errs.push({ error: `missing type definition '${_schema.ref}'`, type: 'missing' });\n  }\n  let { checks } = _schema;\n  const { type, fields, rest, types, literal } = _schema;\n  if (!checkType(value, schema.type === 'array' ? 'array' : type, literal, required)) return [{ error: `type mismatch for${required ? ' required' : ''} ${type}`, actual: unparseSchema(inspect(value)), value, path, expected: unparseSchema(_schema, true), literal: type === 'literal' }];\n\n  if (_schema !== schema && schema.checks) {\n    if (!checks) checks = schema.checks;\n    else checks = checks.concat(schema.checks);\n  }\n\n  let tmp: ValidationResult;\n\n  if ((type === 'tuple' || type === 'tuple[]') && types) {\n    const arr = ~type.indexOf('[]');\n    const val: any[][] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      if (!Array.isArray(v)) {\n        errs.push({ error: 'expected a tuple', path: p, value: v });\n      } else if (v.length < types.length) {\n        const diff = types.length - v.length;\n        errs.push({ error: `missing ${diff} field${diff > 1 ? 's' : ''} in tuple`, path: p, expected: unparseSchema({ type: 'tuple', types }) });\n      } else {\n        for (let i = 0; i < types.length; i++) {\n          if ((tmp = _validate(v[i], types[i], mode, join(p, `${i}`), extend(ctx, { value: v[i], path: join(p, `${i}`) }))) !== true) errs.push.apply(errs, tmp);\n        }\n\n        if (mode === 'strict' && v.length > types.length) errs.push({ error: `too many values for tuple`, type: 'strict', path: p, expected: unparseSchema({ type: 'tuple', types }) });\n      }\n    }\n  } else if ((type === 'union' || type === 'union[]') && types) {\n    const arr = ~type.indexOf('[]');\n    const val: any[] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      let ok = false;\n      let legit: ValidationError[];\n      for (const u of types) {\n        if ((tmp = _validate(v, u, mode, p, ctx)) === true) {\n          ok = true;\n          break;\n        } else if (miss && tmp.find(e => e.type === 'missing') || tmp.find(e => e.type === 'check')) {\n          const t = tmp.filter(e => miss && e.type === 'missing' || e.type === 'check');\n        } else if (tmp.find(e => e.path !== p))  {\n          if (!legit) legit = tmp\n          else if (tmp.length < legit.length) legit = tmp;\n          else if (legit.filter(e => e.literal).length > tmp.filter(e => e.literal).length) legit = tmp;\n        }\n      }\n      if (!ok && !legit) errs.push({ error: `type mismatch for union`, actual: unparseSchema(inspect(v)), expected: unparseSchema({ type: 'union', types }), value: v, path: p });\n      else if (!ok && legit) errs.push.apply(errs, legit);\n    }\n  } else if ((type === 'object' || type === 'object[]' || type === 'any') && fields || rest) {\n    const arr = ~type.indexOf('[]') || schema.type === 'array';\n    const val: object[] = arr ? value : [value];\n    for (let i = 0; i < val.length; i++) {\n      const v = val[i];\n      const p = arr ? join(path, `${i}`) : path;\n      if (typeof v !== 'object' && typeof v !== 'function') {\n        errs.push({ error: 'expected an object', value: v, path: p, actual: unparseSchema(inspect(v), true) });\n        continue;\n      }\n      if (fields) {\n        for (const f of fields) {\n          if (f.required && !(f.name in v)) errs.push({ error: `required field '${f.name}' is missing`, path: join(p, f.name), expected: f.type });\n          else if (v && f.name in v && (tmp = _validate(v[f.name], f, mode, join(p, f.name), extend(ctx, { value: v[f.name], path: join(p, f.name) }), f.required)) !== true) errs.push.apply(errs, tmp);\n        }\n      }\n      if (rest && v) {\n        for (const k in v) {\n          if (fields && fields.find(f => f.name === k)) continue;\n          if (v[k] != null && (tmp = _validate(v[k], rest, mode, join(p, k), extend(ctx, { value: v[k], path: join(p, k) }))) !== true) errs.push.apply(errs, tmp);\n        }\n      } else if (mode === 'strict' && v) {\n        for (const k in v) if (v[k] != null && !fields || !fields.find(f => f.name === k)) errs.push({ error: `unknown field '${k}'`, path: p, type: 'strict', value: v[k] });\n      }\n    }\n  }\n\n  if (!errs.length && checks && checks.length) {\n    let tmp: any;\n    for (let i = 0; i < checks.length; i++) {\n      const c = checks[i];\n      tmp = evalApply(ctx, c, [value]);\n      if (!tmp || typeof tmp == 'string') errs.push({ error: typeof tmp !== 'string' || !tmp ? `check ${i + 1} failed` : tmp, path, value, type: 'check', expected: unparseSchema(schema, true) });\n    }\n  }\n\n  return errs.length ? errs : true;\n}\n\nconst values = ['string', 'number', 'boolean', 'object'];\nexport function checkType(value: any, type?: Type, literal?: any, required?: boolean): boolean {\n  switch (type || 'any') {\n    case 'any':\n    case 'union':\n      return true;\n\n    case 'value': return !Array.isArray(value) && !!~values.indexOf(typeof value) && (typeof value !== 'object' || isDate(value));\n\n    case 'array':\n    case 'tuple':\n    case 'union[]':\n    case 'tuple[]':\n      return Array.isArray(value);\n\n    case 'literal': return value === literal;\n\n    case 'string': return typeof value === 'string';\n    case 'number': return typeof value === 'number';\n    case 'boolean': return typeof value === 'boolean';\n    case 'date': return isDate(value);\n    case 'object': return !Array.isArray(value) && typeof value === 'object' && (!required || value != null);\n    case 'string[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'string', true);\n    case 'number[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'number', true);\n    case 'boolean[]': return Array.isArray(value) && value.reduce((a, c) => a && typeof c === 'boolean', true);\n    case 'date[]': return Array.isArray(value) && value.reduce((a, c) => a && isDate(c), true);\n    case 'object[]': return Array.isArray(value) && value.reduce((a, c) => a && !Array.isArray(c) && typeof c === 'object' && (!required || c != null), true);\n  }\n}\n","import { parser, ParseOptions, ParseNode, ParseError, concat, IParser, bracket, readTo, rep1sep, alt, map, repsep, rep, seq, skip, str, verify } from 'sprunge';\n\nexport const DEFAULTS = {\n  record: '\\n',\n  field: ',',\n  header: false,\n  quote: '\"',\n};\n\nexport function csv(options?: CSVOptions) {\n  const opts: typeof DEFAULTS = Object.assign({}, DEFAULTS, options);\n\n  const ws = skip(' \\t\\r\\n'.replace(opts.field, '').replace(opts.record, '').replace(opts.quote, ''));\n  const quote = str(opts.quote || '\"');\n  const quotedField = bracket(seq(ws, quote), map(rep(alt(readTo(opts.quote), map(seq(quote, quote), () => ''))), r => concat(r)), seq(quote, ws));\n  const unquotedField = readTo(opts.record + opts.field, true);\n  const field: IParser<string> = alt(quotedField, unquotedField);\n  const record = verify(rep1sep(field, seq(ws, str(opts.field), ws)), s => s.length > 1 || s[0].length > 0 || 'empty record');\n  const csv: IParser<string[][]> = repsep(record, str(opts.record), 'allow');\n\n  const _parse = parser(csv, { consumeAll: true });\n\n  return function parse(input: string, options?: ParseOptions) {\n    const res: ParseNode|string[][]|ParseError = _parse(input, options);\n    if (Array.isArray(res) && res.length > 0) {\n      if (opts.header) {\n        const header: Array<[string, number]> = res.shift().map((k, i) => [k, i]);\n        header.sort((a, b) => a < b ? -1 : a > b ? 1 : 0);\n        for (let i = 0; i < res.length; i++) {\n          for (let j = 0; j < header.length; j++) (res[i] as any)[header[j][0]] = res[i][header[j][1]];\n        }\n      }\n    }\n\n    return res;\n  }\n}\n\nexport interface CSVOptions {\n  field: string;\n  record: string;\n  quote: string;\n  fixedSize?: boolean;\n  order?: boolean;\n  header?: boolean;\n}\n\n// TODO: handle ascii curses tables?\n\nexport function table(options?: TableOptions) {\n  const opts = Object.assign({ header: true }, options);\n\n  return function parse(input: string, options?: ParseOptions) {\n    const parts = input.split(/\\r?\\n/).filter(v => v);\n    \n    if (parts[1][0] === '|') {\n      for (let i = 0; i < parts.length; i++) {\n        const p = parts[i];\n        parts[i] = p.replace(/^\\|\\s*|\\s*\\|$/g, '');\n      }\n    }\n\n    return parts.map(p => p.trim().split(/\\s*\\|\\s*/));\n  }\n}\n\nexport interface TableOptions {\n  table: 1;\n  header?: boolean;\n  fixedSize?: boolean;\n  order?: boolean;\n}\n\nexport type DelimitedOptions = CSVOptions | TableOptions;\n\nconst fields = [',', '|', '\\t', ':', ';', '~'];\nconst records = ['\\r\\n', '\\r', '\\n'];\nconst quotes = ['\\'', '\"', '`', '$'];\n\nexport function detect(data: string, amount?: number): DelimitedOptions {\n  if (amount === undefined) {\n    amount = data.indexOf('\\n', data.indexOf('\\n', data.indexOf('\\n', 1) + 1) + 1);\n    amount = amount ?? 2048;\n    if (amount < 2048) amount = 2048;\n  }\n  const sample = data.slice(0, amount);\n  // look for tables\n  if (sample.split(/\\r?\\n/).filter(v => v)[1]?.match(/^[-|+\\s_=]+$/)) {\n    return { table: 1, header: true };\n  }\n\n  const fs = fields.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n  const rs = records.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n  const qs = quotes.reduce((a, c) => (a[c] = sample.replace(new RegExp(`[^${c}]`, 'g'), '').length / c.length, a), {} as { [k: string]: number });\n\n  const res = { field: ',', record: '\\n', quote: '\"' };\n\n  let max = 0;\n  for (const k in fs) if (fs[k] > max) (res.field = k, max = fs[k]);\n  max = 0;\n  for (const k in rs) if (rs[k] > max) (res.record = k, max = rs[k]);\n  max = 0;\n  for (const k in qs) if (qs[k] > max) (res.quote = k, max = qs[k]);\n\n  return res;\n}\n\nfunction isTableOpts(opts?: DelimitedOptions): opts is TableOptions {\n  return opts && 'table' in opts && opts.table === 1;\n}\n\nexport function parse(data: string, options?: DelimitedOptions & { header: true }): any[];\nexport function parse(data: string, options?: DelimitedOptions & { header?: false }): string[][];\nexport function parse(data: string, options?: DelimitedOptions): Array<string[]|any> {\n  let values: string[][];\n  if (isTableOpts(options)) {\n    values = table(options)(data);\n    values.splice(1, 1);\n  } else {\n    const base = csv(Object.assign({}, options, { header: false }))(data);\n    if ('message' in base) return [];\n    values = base;\n  }\n\n  if (options.fixedSize ?? true) {\n    const min = values[0]?.length;\n    values = values.filter(v => v.length >= min);\n  }\n\n  if (options.header && values.length) {\n    const header = values.shift().map((k, i) => [k, i]);\n    if (options.order ?? true) header.sort((a, b) => {\n      const l = `${a}`.toLowerCase();\n      const r = `${b}`.toLowerCase();\n      return l < r ? -1 : l > r ? 1 : 0;\n    });\n    return values.map(v => header.reduce((a, c) => (a[c[0]] = v[c[1]], a), {} as any));\n  }\n  return values;\n}\n","import { Parser, parser as makeParser, opt, repsep, seq, alt, map, readTo, read1To, rep1, rep, str, read, read1, chars } from 'sprunge';\n\nconst ws = read(' \\r\\n\\t');\nconst endTxt = '&<';\n\nconst entities = { amp: '&', gt: '>', lt: '<' };\nconst entity = map(seq(str('&'), str('amp', 'gt', 'lt'), str(';')), ([,which]) => entities[which] || '', 'entity');\n\nconst name = read1('abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-_:$', 'name');\nconst attr = map(seq(name, opt(seq(ws, str('='), ws, alt(name, quoted('\"'), quoted(\"'\"))))), ([name, rest]) => ({ name, value: rest ? rest[3] : true}), 'attr');\n\nfunction quoted(quote: string) {\n  return map(seq(str(quote), readTo(quote), str(quote)), ([,str]) => str);\n}\n\ninterface Attr {\n  name: string;\n  value: string|boolean;\n}\n\ninterface Open {\n  open: true;\n  name: string;\n  attrs?: Attr[];\n  empty?: boolean;\n}\n\ninterface Close {\n  close: true;\n  name: string;\n}\n\nconst open = map(seq(str('<'), ws, name, ws, repsep(attr, ws, 'allow'), opt(str('/')), str('>')), ([,,name,,attrs,close]) => ({ open: true, name, attrs, empty: !!close } as Open), 'open');\nconst close = map(seq(str('</'), ws, name, ws, str('>')), ([,,name]) => ({ close: true, name } as Close), 'close');\n\nconst content = map(rep1(alt(read1To(endTxt, true), entity), 'content'), txts => txts.join('').trim());\n\nconst stream = rep(alt<string|Open|Close>(open, content, close));\n\nconst _parse = makeParser(stream, { trim: true, consumeAll: true, undefinedOnError: true });\n\nfunction put(target: object, prop: string, value: any) {\n  if (prop in target) {\n    if (Array.isArray(target[prop])) target[prop].push(value);\n    else target[prop] = [target[prop], value];\n  } else {\n    target[prop] = value;\n  }\n}\n\nexport function parse(str: string, strict?: boolean): any {\n  const stack: any[] = [];\n  const names: string[] = [];\n  const res: any[] = [];\n  let content = '';\n  const stream = _parse(str) as Array<string|Open|Close>;\n  if (!stream || 'error' in stream) return undefined;\n\n  function close(end: string) {\n    const val = stack.pop();\n    if (!val) return;\n    const name = names.pop();\n    if (!stack.length) {\n      res.push(val);\n    } else {\n      if (!Object.keys(val).length) put(stack[stack.length - 1], name, content || '');\n      else put(stack[stack.length - 1], name, val);\n    }\n    if (end !== name) close(end);\n  }\n\n  for (const p of stream) {\n    if (typeof p === 'string') {\n      if (p) content += p;\n    } else if ('open' in p) {\n      content = '';\n      const val = p.attrs.reduce((a, c) => (put(a, c.name, c.value), a), {});\n      if (p.empty) {\n        if (stack.length) put(stack[stack.length - 1], p.name, val);\n        else res.push(val);\n      } else {\n        names.push(p.name);\n        stack.push(val);\n      }\n    } else if ('close' in p) {\n      if (strict && p.name !== names[names.length - 1]) return;\n      close(p.name);\n    }\n  }\n\n  if (names.length && !strict) close(names[0]);\n\n  return res.length > 1 ? res : res.length === 1 ? res[0] : undefined;\n}\n","import { filter, safeGet, safeSet, registerOperator, CheckResult, ValueOperator, ValueOrExpr, Context, evaluate, evalApply, evalValue, evalParse, template, extend, formats, virtualFormats, registerFormat, dateRelToRange, dateRelToExactRange, dateRelToDate, isDateRel, isKeypath, isTimespan, isApplication, dateAndTimespan, addTimespan, isValue, datesDiff, DateRel, getOperator, applyOperator, OperatorOptions, sort, toDataSet, Root } from './index';\nimport { date, dollar, ordinal, number, phone } from './format';\nimport { timespans, isTimespanMS, timeSpanToNumber, parseTime, parseDate, parseExpr, parse } from './parse';\nimport { parse as parseTemplate } from './parse/template';\nimport { parseSchema, unparseSchema } from './parse/schema';\nimport { stringify } from './parse/stringify';\nimport { range as parseRange, ParseError } from './parse/range';\nimport { validate, inspect, isSchema } from './schema';\nimport { diff, deepEqual, labelDiff } from './diff';\nimport { detect as csvDetect, parse as csvParse } from './csv';\nimport { style } from './parse/style';\nimport { parse as parseXML } from './parse/xml';\nimport { measure, escapeHTML } from '../render/index';\n\nfunction simple(names: string[], apply: (name: string, values: any[], opts: OperatorOptions, ctx: Context) => any): ValueOperator {\n  return {\n    type: 'value', names, apply\n  };\n}\n\nconst spanMap = {\n  y: [0, 12],\n  M: [1, 30],\n  d: [2, 24],\n};\n\nconst generateDefaults = {\n  max: 10000,\n};\n\nfunction stringTimes(str: string, times: number): string {\n  let res = '';\n  for (let i = 0; i < times; i++) res += str;\n  return res;\n}\n\ntype RoundingMethod = 'half-up'|'half-down'|'half-even'|'half-odd'|'half-to-0'|'half-from-0'|'to-0'|'from-0'|'up'|'down';\nconst roundDefaults = {\n  places: 2,\n  'all-numeric': false,\n  method: 'half-even' as RoundingMethod,\n};\nexport function round(amt: string|number, settings?: { places: number; method: RoundingMethod }): string {\n  const place = settings?.places ?? roundDefaults.places;\n  const type = settings?.method ?? roundDefaults.method;\n  if (place > 0) {\n    let str = (+amt || 0).toString();\n    const point = str.indexOf('.');\n    if (!~point) return (+str).toFixed(place);\n    let dec = str.slice(point + 1);\n    if (dec.length <= place) return (+str).toFixed(place);\n    str += '0';\n    dec += '0';\n    const l = +`${str.slice(place - dec.length, place - dec.length + 1)}` || 0;\n    const rest = parseInt(str.slice(place - dec.length) + '0');\n    if (type === 'up' && rest > 0) {\n      if (+amt > 0) return (+str.slice(0, place - dec.length) + +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return str.slice(0, place - dec.length);\n    } else if (type === 'down' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, place - dec.length) - +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return str.slice(0, place - dec.length);\n    } else if (type === 'to-0' && rest > 0) {\n      return str.slice(0, place - dec.length);\n    } else if (type === 'from-0' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, place - dec.length) - +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n      else return (+str.slice(0, place - dec.length) + +`0.${stringTimes('0', place - 1)}1`).toFixed(place);\n    }\n    if (+l < 5) return str.slice(0, place - dec.length);\n    else if (+l > 5 || +`${str.slice(1 + place - dec.length)}`) return (+amt).toFixed(place);\n    else {\n      const pre = `${str.slice(0, place - dec.length)}`;\n      const f = +str.slice(place - dec.length - 1, place - dec.length);\n      if (type === 'half-odd') return (+`${pre}${f % 2 === 0 ? 6 : 4}`).toFixed(place);\n      else if (type === 'half-up') return (+`${pre}${+pre > 0 ? 6 : 4}`).toFixed(place);\n      else if (type === 'half-down') return (+`${pre}${+pre > 0 ? 4 : 6}`).toFixed(place);\n      else if (type === 'half-to-0') return (+`${pre}4`).toFixed(place);\n      else if (type === 'half-from-0') return (+`${pre}6`).toFixed(place);\n      else return (+`${pre}${f % 2 === 0 ? 4 : 6}`).toFixed(place);\n    }\n  } else if (place === 0) {\n    let str = (+amt || 0).toString();\n    const point = str.indexOf('.');\n    if (!~point) return str;\n    str = `${str}00`;\n    const p = +str.slice(point - 1, point);\n    const n = +str.slice(point + 1, point + 2);\n    const rest = parseInt(str.slice(point + 1) + '0');\n    if (type === 'up' && rest > 0) {\n      if (+amt > 0) return (+str.slice(0, point) + 1).toFixed(0);\n      else return str.slice(0, point);\n    } else if (type === 'down' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, point) - 1).toFixed(0);\n      else return str.slice(0, point);\n    } else if (type === 'to-0' && rest > 0) {\n      return str.slice(0, point);\n    } else if (type === 'from-0' && rest > 0) {\n      if (+amt < 0) return (+str.slice(0, point) - 1).toFixed(0);\n      else if (+amt > 0) return (+str.slice(0, point) + 1).toFixed(0);\n    }\n    if (n < 5) return str.slice(0, point);\n    else if (n > 5 || n === 5 && +str.slice(point + 2)) return (+`${str.slice(0, point - 1)}0` + (p + 1) * (+str < 0 ? -1 : 1)).toString();\n    else {\n      const base = +`${str.slice(0, point - 1)}0`;\n      if (type === 'half-odd') return (base + (p % 2 === 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-up') return (base + (+str > 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-down') return (base + (+str < 0 ? p + 1 : p) * (+str < 0 ? -1 : 1)).toString()\n      else if (type === 'half-to-0') return base.toString();\n      else if (type === 'half-from-0') return (base + 1).toString();\n      else return (base + (p % 2 === 0 ? p : p + 1) * (+str < 0 ? -1 : 1)).toString();\n    }\n  } else {\n    let str = `${+amt < 0 ? Math.floor(+amt || 0) : Math.ceil(+amt || 0)}`;\n    if (0 - place > str.length && type !== 'up' && type !== 'down' && type !== 'to-0' && type !== 'from-0') return `0`;\n    const n = +str.slice(place, place === -1 ? undefined : place + 1);\n    const rest = +(str.slice(place) + '0');\n    let p = str.slice(place - 1, place);\n    if (p === '-') p = '';\n    const zeroes = `${Math.pow(10, 0 - place).toString().slice(1)}`\n    if (!p) {\n      const big = `${+str < 0 ? '-' : ''}1${zeroes}`;\n      if (type === 'up') {\n        if (+amt > 0) return big;\n        else return '0';\n      } else if (type === 'down') {\n        if (+amt < 0) return big;\n        else return '0';\n      } else if (type === 'to-0') {\n        return '0';\n      } else if (type === 'from-0') {\n        return big;\n      }\n      if (+str > 0 && +str < 5 || +str < 0 && +str > -5) return '0';\n      else if (+str > 0 && +str > 5 || +str < 0 && +str < -5) return big;\n      else {\n        if (type === 'half-odd') return big;\n        else if (type === 'half-up') return +str > 0 ? big : '0';\n        else if (type === 'half-down') return +str > 0 ? '0' : big;\n        else if (type === 'half-to-0') return '0';\n        else if (type === 'half-from-0') return big;\n        else return '0';\n      }\n    } else {\n      if (type === 'up' && rest > 0) {\n        if (+str > 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) + +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        else return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'down' && rest > 0) {\n        if (+str < 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) - +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        else return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'to-0' && rest > 0) {\n        return str.slice(0, place) + stringTimes('0', place * -1);\n      } else if (type === 'from-0' && rest > 0) {\n        if (+str > 0) return (+(str.slice(0, place) + stringTimes('0', place * -1)) + +`1${stringTimes('0', place * -1)}`).toFixed(0);\n        return (+(str.slice(0, place) + stringTimes('0', place * -1)) - +`1${stringTimes('0', place * -1)}`).toFixed(0);\n      }\n      if (n < 5) return `${str.slice(0, place)}${zeroes}`\n      else if (n > 5 || place < -1 && +`${str.slice(place + 1)}`) return (+`${+str.slice(0, place - 1) || 0}${0}${zeroes}` + +`${+p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n      else {\n        const base = +`${str.slice(0, place - 1) || 0}0${zeroes}`;\n        if (type === 'half-odd') return (base + +`${+p % 2 === 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-up') return (base + +`${+str > 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-down') return (base + +`${+str < 0 ? +p + 1 : +p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-to-0') return (base + +`${+p}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else if (type === 'half-from-0') return (base + +`${+p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n        else return (base + +`${+p % 2 === 0 ? +p : +p + 1}${zeroes}` * (+str < 0 ? -1 : 1)).toString();\n      }\n    }\n  }\n}\n\nconst hasNum = /^[^\\d]*(\\d+(?:\\.\\d*)?)/;\n\nconst space = /^\\s*$/;\nfunction isNum(v: any): v is number {\n  return !isNaN(v) && !space.test(v);\n}\nfunction num(v: any): number {\n  if (isNaN(v) || !v) return 0;\n  return +v;\n}\n\nfunction equals(l: any, r: any): boolean {\n  if (l === r || l == r) return true; // eslint-disable-line eqeqeq\n  if (isDateRel(l) && isDateRel(r)) return +dateRelToDate(l) === +dateRelToDate(r);\n  if (typeof l === 'number' && typeof r === 'number') return isNaN(l) && isNaN(r);\n  return false;\n}\n\n/**\n * Find the first overlapping substring that contains threshhold percent characters of the smallest string length.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the percentage of the smaller string length needed to match\n * @returns - the substring that matches\n */\nexport function overlap(a: string, b: string, threshhold: number = 0.5): string {\n  const res = similar(a, b, threshhold, 0);\n  return res && res[1] || undefined;\n}\n\n/**\n * Finds the percentage similarity between two strings based on a minimum threshhold and a fudge factor. The minimum threshhold determins the earliest that the search can return. The fudge factor allows skipping characters in either string, though there is no backtracking.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the required similarity between two substrings, accounting for the fudge factor\n * @param fudges - the number skippable characters in either string without a match\n * @param whole - adjust the similarity account for the whole string rather than only the first matching substring\n * @returns - the similarity of the first qualifying match\n */\nexport function similarity(a: string, b: string, threshhold: number = 0.5, fudges: number = 2, whole = false): number {\n  const res = similar(a, b, threshhold, fudges);\n  if (res && whole) return (res[2] || 0) * (((res[0].length / a.length) + (res[1].length / b.length)) / 2);\n  return res && res[2] || 0;\n}\n\n/**\n * Finds the similarity between two strings based on a minimum threshhold and a fudge factor. The minimum threshhold determins the earliest that the search can return. The fudge factor allows skipping characters in either string, though there is no backtracking.\n * @param a - the first string\n * @param b - the second string\n * @param threshhold - defaults to 0.5 - the required similarity between two substrings, accounting for the fudge factor\n * @param fudges - the number skippable characters in either string without a match\n * @returns - a tuple of the substrings from each string and the similarity percentage, accounting for the fudge factor\n */\nexport function similar(a: string, b: string, threshhold: number = 0.5, fudges: number = 2): [string, string, number] {\n  if (!a || !b) return;\n  const aa = a.toLowerCase();\n  const bb = b.toLowerCase();\n\n  // check containment\n  if (~aa.indexOf(bb)) bb;\n  if (~bb.indexOf(aa)) aa;\n\n  let i1 = 0;\n  let i2 = 0;\n  let oa = 0;\n  let ob = 0;\n  let f = 0;\n  let f1 = 0;\n  let f2 = 0;\n  let fs = 0;\n  let sim = 0;\n\n  const alen = a.length;\n  const blen = b.length;\n  let aolen = 0;\n  let bolen = 0;\n\n  // walk a\n  for (i1 = 0; i1 < alen; i1++) {\n    // walk b\n    for (i2 = 0; i2 < blen; i2++) {\n      // if there's a match, see how far it goes\n      if (aa[i1] === bb[i2]) {\n        aolen = alen - i1;\n        bolen = blen - i2;\n        fs = 0;\n        // walk the remaining pieces of each string checking for matches\n        matchy: for (oa = 1, ob = 1; oa < aolen && ob < bolen;) {\n          if (aa[i1 + oa] === bb[i2 + ob]) { // nailed it\n            oa++, ob++;\n          } else { // not so much, so compare closer chars in each string, walking outward\n            for (f = 0; f <= fudges; f++) {\n              for (f1 = 0; f1 <= f; f1++) {\n                for (f2 = 0; f2 <= f; f2++) {\n                  if (aa[i1 + oa + f1] === bb[i2 + ob + f2]) {\n                    oa += f1;\n                    ob += f2;\n                    fs += Math.max(f1, f2); // keep track of the fudge factor\n                    continue matchy;\n                  }\n                }\n              }\n            }\n            break matchy; // not even fudge could save it\n          }\n        }\n\n        sim = (Math.max(oa, ob) - fs) / Math.min(aa.length, bb.length); // get approximate similarity\n        if (sim >= threshhold) return [aa.substr(i1, oa), bb.substr(i2, ob), sim]; // and if it exceeds the threshold, we're good\n      }\n    }\n  }\n}\n\nexport function inRange(v: number, range: Array<number|[number, number]|{ not: number|[number, number] }>): boolean {\n  let found = false;\n  let excluded = false;\n  for (const r of range) {\n    if (Array.isArray(r) && v >= r[0] && v <= r[1]) found = true;\n    else if (typeof r === 'object' && 'not' in r) {\n      if (Array.isArray(r.not) && v >= r.not[0] && v <= r.not[1]) excluded = true;\n      else if (v == r.not) excluded = true;\n    } else if (v == r) found = true;\n  }\n  return found && !excluded;\n}\n\n// basic ops\nregisterOperator(\n  simple(['is', 'is-not', '==', '!='], (name: string, values: any[]): boolean => {\n    const [l, r] = values;\n    let cmp = equals(l, r);\n    if (!cmp && (name === 'is' || name === 'is-not') && isSchema(r)) cmp = validate(l, r, 'loose') === true;\n    return name === 'is' || name === '==' ? cmp : !cmp;\n  }),\n  simple(['strict-is', 'strict-is-not'], (name: string, values: any[]): boolean => {\n    const [l, r] = values;\n    let res = l === r;\n    if (!res && isSchema(r)) res = validate(l, r, 'strict') === true;\n    return name === 'strict-is' ? res : !res;\n  }),\n  simple(['deep-is', 'deep-is-not', '===', '!=='], (name: string, [l, r, equal]: any[], opts, ctx: Context): boolean => {\n    equal = equal || opts?.equal;\n    if (equal && isApplication(equal)) {\n      const eq = equal;\n      equal = (l: any, r: any) => evalApply(ctx, eq, [l, r]);\n    }\n    const res = deepEqual(l, r, equal);\n    return name === 'deep-is' || name === '===' ? res : !res;\n  }),\n  simple(['not'], (_name: string, values: any[]) => !values[0]),\n  simple(['<', '>', '<=', '>=', 'gt', 'gte', 'lt', 'lte'], (name: string, values: any[]): boolean => {\n    if (name === 'gt') name = '>';\n    else if (name === 'lt') name = '<';\n    else if (name === 'gte') name = '>=';\n    else if (name === 'lte') name = '<=';\n    let [l, r] = values;\n    if (l instanceof Date || r instanceof Date) {\n      if (typeof l === 'number' || typeof r === 'number') {\n        l = +l; r = +r;\n      } else if (typeof l === 'string' || typeof r === 'string') {\n        l = new Date(l); r = new Date(r);\n      } else if (l && 'f' in l && 'o' in l) {\n        l = dateRelToRange(l)[name[0] === '<' ? 1 : 0];\n        r = new Date(r);\n      } else if (r && 'f' in r && 'o' in r) {\n        r = dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1];\n        l = new Date(l);\n      }\n    } else if (isDateRel(l)) {\n      l = dateRelToRange(l)[name[0] === '<' ? 1 : 0];\n      r = isDateRel(r) ? dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1] : new Date(r);\n    } else if (isDateRel(r)) {\n      r = dateRelToRange(r)[name === '<' || name === '>=' ? 0 : 1];\n      l = new Date(l);\n    }\n    return name === '<' ? l < r :\n      name === '>' ? l > r :\n        name === '<=' ? l <= r :\n          name === '>=' ? l >= r :\n            false;\n  }),\n  simple(['like', 'not-like', 'ilike', 'not-ilike'], (name: string, values: any[]): boolean => {\n    const [target, pattern, arg] = values;\n    let res: boolean = false;\n    const patterns = typeof pattern === 'string' ? [pattern] : pattern;\n    const free = arg === 'free' || (typeof arg === 'object' && arg.free);\n    if (!Array.isArray(patterns)) return false;\n    for (let i = 0; i < patterns.length && !res; i++) {\n      const r = patterns[i];\n      if (typeof r !== 'string') continue;\n      const re = new RegExp(`${free ? '' : '^'}${r.replace(/[\\s\\%\\*]+/g, '[\\\\s\\\\S]*').replace(/\\?/g, '.')}${free ? '' : '$'}`, ~name.indexOf('ilike') ? 'i' : '');\n      if (Array.isArray(target)) res = !!target.find(v => re.test(v));\n      else res = re.test(target);\n    }\n    return name === 'like' || name === 'ilike' ? res : !res;\n  }),\n  simple(['in', 'not-in'], (name: string, values: any[], _opts, ctx: Context): boolean => {\n    const [l, r] = values;\n    let range: any;\n    if (isDateRel(r)) {\n      const range = dateRelToRange(r);\n      const d = isDateRel(l) ? dateRelToRange(l)[0] : new Date(l);\n      const n = d >= range[0] && d <= range[1];\n      return name === 'in' ? n : !n;\n    } else if (typeof l === 'string' && typeof r === 'object' && !Array.isArray(r)) {\n      return l in r;\n    } else if (Array.isArray(l) && l.length > 0 && typeof l[0] === 'string' && !Array.isArray(r) && r && typeof r === 'object') {\n      const keys = Object.keys(r);\n      const found = l.reduce((a, c) => a && ~keys.indexOf(c), true);\n      return name === 'in' ? found : !found;\n    } else if (typeof r === 'string' && isNum(l) && (range = _parseRange(ctx, r), Array.isArray(range))) {\n      const found = inRange(+l, range);\n      return name === 'in' ? found : !found;\n    } else if (isApplication(l)) {\n      let found: any = false;\n      if (Array.isArray(r) || r && typeof r === 'object' && '0' in r) found = Array.prototype.find.call(r, (e: any, i: number) => evalApply(ctx, l, [e, i], { index: i, key: i }));\n      else if (r && typeof r === 'object') found = Object.entries(r).find((e, i) => evalApply(ctx, l, [e[1], i, e[0]], { index: i, key: e[0] }));\n      return name === 'in' ? !!found : !found;\n    } else if (!Array.isArray(r) && typeof r !== 'string') {\n      return name === 'in' ? l == r : l != r;\n    } else if (Array.isArray(l) && Array.isArray(r)) {\n      const b = l.reduce((a, c) => a && ~r.indexOf(c), true);\n      return name === 'in' ? !!b : !b;\n    }\n    const res = !!~r.indexOf(l);\n    return name === 'in' ? res : !res;\n  }), \n  simple(['contains', 'does-not-contain'], (name: string, values: any[], _opts, ctx: Context): boolean => {\n    const [l, r] = values;\n    if (isDateRel(l)) {\n      const range = dateRelToRange(l);\n      const d = isDateRel(r) ? dateRelToRange(r)[0] : new Date(r);\n      const n = d >= range[0] && d <= range[1];\n      return name === 'contains' ? n : !n;\n    } else if (isApplication(r)) {\n      let found: any = false;\n      if (Array.isArray(l) || l && typeof l === 'object' && '0' in l) found = Array.prototype.find.call(l, (e: any, i: number) => evalApply(ctx, r, [e, i], { index: i, key: i }));\n      else if (r && typeof l === 'object') found = Object.entries(l).find((e, i) => evalApply(ctx, r, [e[1], i, e[0]], { index: i, key: e[0] }));\n      return name === 'contains' ? !!found : !found;\n    } else if (!Array.isArray(l) && typeof l !== 'string') {\n      return false;\n    } else if (Array.isArray(r) && Array.isArray(l)) {\n      const b = r.reduce((a, c) => a && ~l.indexOf(c), true);\n      return name === 'contains' ? !!b : !b;\n    }\n    const res = !!~l.indexOf(r);\n    return name === 'contains' ? res : !res;\n  }),\n  simple(['clamp'], (_name, [min, v, max]: any[]): any => {\n    return v < min ? min : v > max ? max : v;\n  }),\n  simple(['get'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    const [l, r] = values;\n    const c = extend(ctx, { value: l });\n    if (isKeypath(r)) return safeGet(c, r);\n    else if (typeof r === 'number') return safeGet(c, '' + r);\n    else return evaluate(c, r);\n  }),\n  simple(['generate'], (_name: string, [apply], opts, ctx) => {\n    let r: ParseError|Array<number|[number, number]|{ not: number|[number, number] }>;\n    if (apply && isApplication(apply)) {\n      const res = [];\n      let state = opts;\n      let it: any;\n      for (let i = 0; i < generateDefaults.max; i++) {\n        it = evalApply(ctx, apply, [state, it, i], { index: i, last: it, state });\n        if (Array.isArray(it)) it.forEach(v => res.push(v));\n        else if (it && typeof it === 'object') {\n          const keys = Object.keys(it);\n          if (keys.find(k => k !== 'value' && k !== 'state')) res.push(it);\n          else {\n            res.push(it.value);\n            state = it.state || state;\n            it = it.value;\n          }\n        } else if (it === undefined) break;\n        else res.push(it);\n      }\n      return res;\n    } else if ((r = parseRange(apply)) && Array.isArray(r)) {\n      r = r.filter(v => typeof v === 'number' || Array.isArray(v) && !v.find(v => v === Infinity || v === -Infinity) || typeof v === 'object' && !Array.isArray(v));\n      const nums: number[] = [];\n      const no: Array<[number, number]> = [];\n      for (const v of r) if (typeof v === 'object' && !Array.isArray(v)) no.push(typeof v.not === 'number' ? [v.not, v.not] : v.not);\n\n      for (const v of r) {\n        if (nums.length >= generateDefaults.max) break;\n        if (typeof v === 'number' && !no.find(([l, r]) => v >= l && v <= r)) nums.push(v);\n        else if (Array.isArray(v)) {\n          for (let i = v[0]; i <= v[1]; i++) {\n            if (!no.find(([l, r]) => i >= l && i <= r)) nums.push(i);\n            if (nums.length >= generateDefaults.max) break;\n          }\n        }\n      }\n\n      return nums;\n    }\n    return [];\n  }),\n  simple(['array'], (_name: string, values: any[], opts) => {\n    if (values.length === 1 && opts?.range) {\n      let range = values[0];\n      if (typeof range === 'string') range = parseRange(range);\n      if (Array.isArray(range)) {\n        const bounds = Array.isArray(opts.bounds) && opts.bounds.length === 2 && opts.bounds.filter(b => typeof b === 'number').length === 2 ? opts.bounds : [-100, 200];\n        bounds.slice().sort((l, r) => l < r ? -1 : l > r ? 1 : 0);\n        let [lower, upper] = bounds;\n        if (upper - lower > 10000) lower = upper - 10000;\n        const res = [];\n        for (let i = lower; i <= upper; i++) if (inRange(i, range)) res.push(i);\n        return res;\n      } else return [];\n    }\n    return values;\n  }),\n  simple(['object'], (_name: string, values: any[]) => {\n    const res: any = {};\n    for (let i = 0; i < values.length; i += 2) {\n      res[values[i]] = values[i + 1];\n    }\n    return res;\n  }),\n  simple(['split'], (_name: string, [str, split]: any[]) => {\n    if (typeof str !== 'string') return [str];\n    else return str.split(split || '');\n  }),\n  simple(['filter'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, flt, sorts, groups] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else if (typeof arr === 'object' && arr) {\n        let step = Object.entries(arr).filter((e, i) => evalApply(ctx, flt, [e[1], i, e[0]], { index: i, key: e[0] }));\n        if (sorts) step = sort(ctx, step, sorts, (c, b, v) => evalApply(c, b, [v[1], v[0]], { key: v[0] }));\n        return step.reduce((a, c) => (a[c[0]] = c[1], a), {});\n      }\n      else return [];\n    }\n    return filter({ value: arr }, flt, sorts, groups, ctx).value;\n  }),\n  simple(['source'], (_name: string, values: any[], _opts, ctx): any => {\n    const [val, app] = values;\n    let source = toDataSet(val);\n    if (isApplication(app)) return evalApply(ctx, app, [], { source });\n    return source;\n  }),\n  simple(['group'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, groups] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else return {};\n    }\n    return filter({ value: arr }, null, null, groups, ctx).value;\n  }),\n  simple(['sort'], (_name: string, values: any[], _opts, ctx: Context): any => {\n    let [arr, sorts] = values;\n    if (!Array.isArray(arr)) {\n      if (arr && Array.isArray(arr.value)) arr = arr.value;\n      else if (arr && typeof arr === 'object') {\n        if (!sorts) sorts = [{ a: { r: { p: '@', k: ['key'] } } }];\n        return sort(ctx, Object.entries(arr), sorts, (c, b, v) => evalApply(c, b, [v[1], v[0]], { key: v[0] })).reduce((a, c) => (a[c[0]] = c[1], a), {});\n      }\n      else return {};\n    }\n    if (!sorts) sorts = [{ a: { r: { k: ['_'] } } }];\n    return sort(ctx, arr.slice(), sorts);\n  }),\n  simple(['time-span', 'time-span-ms'], (_name: string, args: any[], opts: any): any => {\n    const namedArgs = opts || {};\n    const span = isDateRel(args[0]) && isDateRel(args[1]) ? datesDiff(dateRelToDate(args[0]), dateRelToDate(args[1])) : isTimespan(args[0]) ? args[0] : 0;\n\n    // if a unit is specified, break the span up\n    if (namedArgs.unit) {\n      const u = ((Array.isArray(namedArgs.unit) ? namedArgs.unit : [namedArgs.unit]) as string[]).map(u => {\n        if (u[0] === 'y') return 'y'\n        else if (u[0] === 'M' || (u[0] === 'm' && u[1] !== 'i' && u[1] !== 'm')) return 'M';\n        else if (u[0] === 'w') return 'w';\n        else if (u[0] === 'd') return 'd';\n        else if (u[0] === 'h') return 'h';\n        else if (u[0] === 'm' && (!u[1] || u[1] === 'i' || u[1] === 'm')) return 'm';\n        else if (u[0] === 's') return 's'\n        else if (u[0] === 'm' && u[1] === 's') return 'l';\n        return '';\n      }).filter(u => !!u);\n\n      // fraction tracks what would be left for rounding\n      let fraction: number;\n      let res: number[];\n\n      // special case for full spans\n      if (typeof span !== 'number' && !isTimespanMS(span)) {\n        const us = u.join('');\n        if (us === 'd') {\n          if (span.s) {\n            const from = new Date(span.s);\n            from.setHours(0);\n            from.setMinutes(0);\n            from.setSeconds(0);\n            from.setMilliseconds(0);\n            const to = new Date(+from);\n            to.setDate(1);\n            to.setFullYear(to.getFullYear() + span.d[0]);\n            to.setMonth(from.getMonth() + span.d[1]);\n\n            const m = to.getMonth();\n            to.setDate(from.getDate());\n\n            // watch out for last day of month next to longer month\n            const end = new Date(+from);\n            const endM = end.getMonth();\n            end.setDate(end.getDate() + 1);\n            if (endM !== end.getMonth()) {\n              // make sure target date is last day of month\n              to.setMonth(to.getMonth() + 1);\n              to.setDate(0);\n            }\n\n            if (to.getMonth() !== m) to.setDate(0);\n            to.setDate(to.getDate() + span.d[2]);\n            const dist = +to - +from;\n            let d = Math.floor(dist / 86400000);\n            const r = dist % 86400000;\n            if (r >= 82800000) d++;\n            res = [d];\n          } else {\n            // this is an approximation\n            res[0] += span.d[0] * 365;\n            res[0] += span.d[1] * 30;\n          }\n        } else if (u.length < 4 && (us === 'y' || us === 'yM' || us === 'yMd' || us === 'M' || us === 'Md' || us === 'd')) {\n          res = u.map(u => {\n            fraction = span.d[spanMap[u][0] + 1] / spanMap[u][1];\n            return span.d[spanMap[u][0]];\n          });\n          if (u[0] === 'M') res[0] += span.d[0] * 12;\n        }\n      }\n\n      // this isn't special cased, so get a number of ms\n      if (!res) {\n        let ms = typeof span === 'number' || isTimespanMS(span) ? timeSpanToNumber(span) : span && 's' in span ? +dateAndTimespan(new Date(span.s), span, 1) - +new Date(span.s) : (\n          span.d[0] * timespans.y + span.d[1] * timespans.m + span.d[2] * timespans.d +\n          span.d[3] * timespans.h + span.d[4] * timespans.mm + span.d[5] * timespans.s + span.d[6]\n        );\n        res = u.map(() => 0);\n\n        const next = { y: 'm', M: 'w', w: 'd', d: 'h', h: 'mm', m: 's' };\n        const nextDiv = { y: 12, M: 4.3, w: 7, d: 24, h: 60, m: 60 };\n\n        for (let i = 0; i < res.length; i++) {\n          const k = u[i] === 'm' ? 'mm' : u[i] === 'M' ? 'm' : u[i];\n          if (k === 'l') {\n            res[i] = ms;\n            fraction = 0;\n            break;\n          }\n          res[i] = Math.floor(ms / timespans[k]);\n          ms -= res[i] * timespans[k];\n          if (next[u[i]]) fraction = (ms / timespans[next[u[i]]]) / nextDiv[u[i]];\n          else if (u[i] === 's') fraction = ms % 1000;\n        }\n      }\n\n      // check for rounding\n      if (namedArgs.round === true) {\n        if (fraction >= 0.5) res[res.length - 1]++;\n      } else if ((namedArgs.round || '')[0] === 'c') {\n        if (fraction > 0) res[res.length - 1]++;\n        // very special case for months that get rounded to a year\n        if (u[0] === 'y' && u[1] === 'M' && u.length === 2 && res[1] === 12) {\n          res[0]++;\n          res[1] = 0;\n        }\n      }\n\n      // check to see if stringification is needed\n      if (namedArgs.string) {\n        const units = { y: 'year', M: 'month', w: 'week', d: 'day', h: 'hour', m: 'minute', s: 'second', l: 'millisecond' };\n        let str = '';\n        for (let i = 0; i < u.length; i++) {\n          if (!res[i]) continue;\n          str += `${str.length ? ' ' : ''}${res[i]} ${units[u[i]]}${res[i] > 1 ? 's' : ''}`;\n        }\n        return str;\n      } else return Array.isArray(namedArgs.unit) ? res : res[0];\n    } else {\n      if (namedArgs.string) {\n        if (typeof span === 'number' || isTimespanMS(span)) {\n          let ms = timeSpanToNumber(span);\n          let res = '';\n          const order = ['w', 'd', 'h', 'mm', 's'];\n          const units = ['week', 'day', 'hour', 'minute', 'second', 'millisecond'];\n          for (let i = 0; i < order.length; i++) {\n            if (ms > timespans[order[i]]) {\n              const u = Math.floor(ms / timespans[order[i]]);\n              ms -= timespans[order[i]] * u;\n              res += `${res.length ? ' ' : ''}${u} ${units[i]}${u > 1 ? 's' : ''}`;\n            }\n          }\n          if (ms) {\n            res += `${res.length ? ' ' : ''}${ms} millisecond${ms > 1 ? 's' : ''}`;\n          }\n        } else {\n          let res = '';\n          const units = ['year', 'month', 'day', 'hour', 'minute', 'second', 'millisecond'];\n          for (let i = 0; i < span.d.length; i++) {\n            if (span.d[i]) res += `${res.length ? ' ' : ''}${span.d[i]} ${units[i]}${span.d[i] > 1 ? 's' : ''}`;\n          }\n          return res;\n        }\n      } else return span;\n    }\n  }),\n  simple(['string', 'unparse'], (name: string, args: any[], opts: any): string => {\n    const [value] = args;\n    opts = opts || args[1] || {};\n    if (!opts || typeof opts !== 'object') opts = {};\n    if (name === 'unparse') opts = Object.assign({}, opts, { raport: 1 });\n    if (opts.raport && opts.tpl) opts.template = 1;\n    if (!opts && (value === null || value === undefined)) return '';\n\n    if (typeof opts === 'object') {\n      if (opts.json) return JSON.stringify(value);\n      if (opts.schema) return unparseSchema(value);\n      if (opts.base64) return btoa(value);\n      else if (opts.raport) {\n        let v = stringify(value, opts);\n        if (v === undefined) v = stringify({ v: value }, opts);\n        return v;\n      } else if (typeof value === 'string' && opts.styled) return style(value);\n      else if (value == null) return '';\n    }\n\n    if (Array.isArray(value)) return value.join(', ');\n\n    let res = `${value}`;\n    if (res.slice(0, 7) === '[object') return JSON.stringify(value);\n    return res;\n  }),\n  simple(['log'], (_name: string, args: any[], _opts, ctx: Context) => {\n    try {\n      ctx.root.log(args);\n    } catch (e) {\n      console.error(e);\n      console.log(...args);\n    }\n  }),\n  simple(['call'], (_name: string, args: any[], _opts, ctx: Context): any => {\n    if (args[0] != null && typeof args[1] === 'string' && typeof args[0][args[1]] === 'function') {\n      const obj = args.shift();\n      const name = args.shift();\n      return obj[name].apply(obj, args);\n    }\n\n    if (typeof args[0] === 'function') {\n      const fn = args.shift();\n      return fn.apply(null, args);\n    }\n\n    if (isValue(args[0])) {\n      return evalApply(ctx, args[0], args.slice(1));\n    }\n  }),\n  simple(['intersect'], (_name, [left, right]: any[]): any => {\n    if (!Array.isArray(left) || !Array.isArray(right)) return [];\n    const res = [];\n    let el: any;\n    for (let i = 0; i < left.length; i++) {\n      el = left[i];\n      if (~right.indexOf(el) && !~res.indexOf(el)) res.push(el);\n    }\n    for (let i = 0; i < right.length; i++) {\n      el = right[i];\n      if (!~res.indexOf(el) && ~left.indexOf(el)) res.push(el);\n    }\n    return res;\n  }),\n  simple(['let'], (_name, [name, value]: any[], _opts, ctx: Context): any => {\n    return safeSet(ctx, name, value, true);\n  }),\n  simple(['set'], (_name, [name, value]: any[], _opts, ctx: Context): any => {\n    return safeSet(ctx, name, value);\n  }),\n  simple(['similarity'], (_name, [left, right, threshhold, fudges]: any[]): number => {\n    return similarity(`${left || ''}`, `${right || ''}`, threshhold, fudges);\n  }),\n  simple(['similar'], (_name, [left, right, threshhold, fudges]: any[]): any => {\n    return similar(`${left || ''}`, `${right || ''}`, threshhold, fudges);\n  }),\n  simple(['overlap'], (_name, [left, right, threshhold]: any[]): any => {\n    return overlap(`${left || ''}`, `${right || ''}`, threshhold);\n  }),\n  simple(['validate', 'valid'], (name, [left, right, mode], opts) => {\n    const res = validate(left, right, mode || opts?.mode || (opts?.strict && 'strict'));\n    if (name === 'valid') return res === true;\n    else return res;\n  }),\n  simple(['inspect'], (_name, [v, mode], opts) => {\n    if ((mode || opts?.mode) === 'schema') return unparseSchema(inspect(v, opts?.flat));\n    else return inspect(v);\n  }),\n  simple(['diff'], (_, [left, right, equal], opts, ctx: Context) => {\n    equal = equal || opts?.equal;\n    if (equal && isApplication(equal)) {\n      const eq = equal;\n      equal = (l: any, r: any) => evalApply(ctx, eq, [l, r]);\n    }\n    return diff(left, right, { equal, keys: opts?.keys });\n  }),\n  simple(['label-diff'], (_, [diff, label], opts) => {\n    return labelDiff(diff, label, opts as any);\n  }),\n  simple(['patch'], (_, values, opts) => {\n    const dir = opts?.dir || 'forward';\n    const strict = opts?.strict;\n    const base = JSON.parse(JSON.stringify(values.shift() || {}));\n    const r = new Root(base);\n    if (dir === 'backward') {\n      const vals = values.slice().reverse();\n      if (strict) {\n        for (const v of vals) for (const path in v) if (safeGet(r, path) == v[path][1]) safeSet(r, path, v[path][0]);\n      } else {\n        for (const v of vals) for (const path in v) safeSet(r, path, v[path][0]);\n      }\n    } else {\n      if (strict) {\n        for (const v of values) for (const path in v) if (safeGet(r, path) == v[path][0]) safeSet(r, path, v[path][1]);\n      } else {\n        for (const v of values) for (const path in v) safeSet(r, path, v[path][1]);\n      }\n    }\n    return base;\n  }),\n);\n\n// math\nregisterOperator(\n  simple(['+', 'add'], (_name, values: any[], _opts, ctx): any => {\n    if (values.length === 1) {\n      if (isDateRel(values[0])) return +dateRelToDate(values[0]);\n      else if (!values[0]) return 0;\n      return parseFloat(values[0]);\n    }\n    if (Array.isArray(values[0])) return values[0].concat.apply(values[0], values.slice(1));\n    else if (isDateRel(values[0]) && values.length > 1 && values.slice(1).reduce((a, c) => a && isTimespan(c), true)) return values.slice(1).reduce((a, c) => dateAndTimespan(a, c, 1), dateRelToDate(values[0])); \n    else if (typeof values[0] !== 'number' && values.length > 1 && isTimespan(values[0])) return values.slice(1).reduce((a, c) => addTimespan(a, c), values[0]);\n    else if (values.reduce((a, c) => a && typeof c === 'object' && !isDateRel(c), true)) return Object.assign.apply(Object, [{}].concat(values));\n    const num = values.reduce((a, c) => a && isNum(c), true);\n    if (num) {\n      if (ctx.special?.round) return +values.reduce((a, c) => +round(a + +c, ctx.special.round), 0);\n      else return values.reduce((a, c) => a + +c, 0);\n    } else {\n      return values.reduce((a, c) => a + (c === undefined || c === null ? '' : c), '');\n    }\n  }),\n  simple(['cat'], (_name, values: any[]): any => {\n    return values.reduce((a, c) => a + (c === undefined || c === null ? '' : c), '');\n  }),\n  simple(['num'], (_name: string, [v]) => {\n    let match: string[];\n    if (match = hasNum.exec(v)) return +match[1];\n    return parseInt(v);\n  }),\n  simple(['-', 'subtract'], (_name, values: any[], _opts, ctx): number => {\n    const first = values.shift();\n    if (!values.length) return -first;\n    if (isDateRel(first)) {\n      if (values.reduce((a, c) => a && isDateRel(c), true)) return values.reduce((a, c) => a - +dateRelToDate(c), +dateRelToDate(first));\n      if (values.reduce((a, c) => a && isTimespan(c), true)) return values.reduce((a, c) => dateAndTimespan(a, c, -1), dateRelToDate(first));\n    }\n    if (ctx.special?.round) return values.reduce((a, c) => +round(a - (!isNum(c) ? 0 : +c), ctx.special.round), !isNum(first) ? 0 : +first);\n    else return values.reduce((a, c) => a - (!isNum(c) ? 0 : +c), !isNum(first) ? 0 : +first);\n  }),\n  simple(['*', 'multiply'], (_name, values: any[], _opts, ctx): number|string|any[] => {\n    const first = values.shift();\n    if (!isNum(first)) {\n      if (values.length === 1 && isNum(values[0]) && +values[0] > 0) {\n        if (typeof first === 'string') {\n          return stringTimes(first, +values[0]);\n        } else if (Array.isArray(first) && +values[0] < 10000 && first.length < 1000) {\n          const res = [];\n          for (let i = 0; i < values[0]; i++) res.push.apply(res, first);\n          return res;\n        }\n      }\n      return 0;\n    }\n    if (ctx.special.round) return values.reduce((a, c) => +round(a * (!isNum(c) ? 0 : +c), ctx.special.round), +first);\n    else return values.reduce((a, c) => a * (!isNum(c) ? 0 : +c), +first);\n  }),\n  simple(['/', '/%', 'divide', 'intdiv'], (name: string, values: any[], _opts, ctx): number => {\n    const first = values.shift();\n    if (isNaN(first)) return 0;\n    if (name.length > 1 || name === 'intdiv') return values.reduce((a, c) => Math.floor(a / (isNaN(c) ? 1 : +c)), +first);\n    if (ctx.special?.round) return values.reduce((a, c) => +round(a / (isNaN(c) ? 1 : +c), ctx.special.round), +first);\n    else return values.reduce((a, c) => a / (isNaN(c) ? 1 : +c), +first);\n  }),\n  simple(['%', 'modulus'], (_name: string, values: any[]): number => {\n    const first = values.shift();\n    return values.reduce((a, c) => a % (isNaN(c) ? 1 : +c), isNaN(first) ? 0 : +first);\n  }),\n  simple(['pow', '**'], (_name, values: any[], _opts, ctx): number => {\n    const pow = values.pop();\n    const first = Math.pow(values.pop(), pow);\n    if (ctx.special?.round) return values.reverse().reduce((a, c) => +round(Math.pow(c, a), ctx.special.round), first);\n    else return values.reverse().reduce((a, c) => Math.pow(c, a), first);\n  }),\n  simple(['abs'], (_name: string, values: any[]) => {\n    if (typeof values[0] !== 'number') return values[0];\n    return Math.abs(values[0]);\n  }),\n  simple(['round'], (_name: string, [num, precision, method]: [number, number, string], opts): number|string => {\n    precision = precision ?? opts?.places;\n    if (precision !== undefined || roundDefaults['all-numeric']) {\n      const res = round(num, { places: precision, method: (method || opts?.method) as any });\n      if (opts?.string) return res;\n      return +res;\n    } else return Math.round(num);\n  }),\n  simple(['floor'], (_name: string, values: [number]): number => {\n    return Math.floor(values[0]);\n  }),\n  simple(['ceil'], (_name: string, values: [number]): number => {\n    return Math.ceil(values[0]);\n  }),\n  simple(['rand', 'random'], (_name: string, args: any[]): any => {\n    if (!args.length || typeof args[0] === 'number') {\n      const [min, max, dec] = args;\n      let res: number;\n      if (min == null) return Math.random();\n      else if (typeof max !== 'number') res = Math.random() * min;\n      else if (typeof max === 'number') res = Math.random() * (max - min) + min;\n\n      if (max === true || dec === true) return res;\n      else return Math.round(res);\n    } else if (Array.isArray(args[0])) {\n      const arr = args[0];\n      return arr[Math.floor(Math.random() * arr.length)];\n    } else if (typeof args[0] === 'string' && typeof args[1] === 'number') {\n      let res = '';\n      const [str, count] = args;\n      for (let i = 0; i < count; i++) res += str[Math.floor(Math.random() * str.length)];\n      return res;\n    } \n  }),\n);\n\n// string\nfunction pad(where: 'l'|'c'|'r', str: string, count: number, pad: string): string {\n  if (typeof str !== 'string') str = '' + str;\n  if (!isNum(count)) return str;\n  if (typeof pad !== 'string') pad = '' + pad;\n  if (!pad) pad = ' ';\n  if (pad.length !== 1) pad = ' ';\n\n  const ct = (count - str.length) / 2;\n  for (let i = 0; str.length < count; i++) {\n    if (where === 'l') str = pad + str;\n    else if (where === 'r') str = str + pad;\n    else if (i < ct) str = pad + str;\n    else str = str + pad;\n  }\n\n  return str;\n}\nconst triml = /^\\s*/;\nconst trimr = /\\s*$/;\nconst escapeRe = /([\\.\\[\\]\\{\\}\\(\\)\\^\\$\\*\\+\\-])/g;\nregisterOperator(\n  simple(['eval'], (_name: string, [v], opts, ctx: Context): any => {\n    if (opts?.template) return template(opts?.context || ctx, v);\n    else return evaluate(opts?.context || ctx, v);\n  }),\n  simple(['padl', 'padr', 'pad'], (name: string, args: any[]): string => {\n    let [str, count, val] = args;\n    return pad(name === 'padl' ? 'l' : name === 'padr' ? 'r' : 'c', str, count, val);\n  }),\n  simple(['trim', 'triml', 'trimr'], (name: string, args: any[]): string => {\n    let [str] = args;\n    str = '' + str;\n    if (name === 'trim' || name === 'trimr') str = str.replace(trimr, '');\n    if (name === 'trim' || name === 'triml') str = str.replace(triml, '');\n    return str;\n  }),\n  simple(['slice', 'substr'], (_name: string, [src, start, end]: any[], _opts, ctx: Context) => {\n    if (src && typeof src.slice === 'function') return src.slice(start, end);\n    else {\n      const op = getOperator<ValueOperator>('string');\n      if (op) return `${op.apply('string', [src], undefined, ctx)}`.slice(start, end);\n    }\n  }),\n  simple(['len', 'length'], (_name: string, [src]: any[]) => {\n    if (typeof src === 'string' || Array.isArray(src)) return src.length;\n    else if (typeof src === 'object' && Object.keys(src).length === 1 && Array.isArray(src.value)) return src.value.length;\n    else if (typeof src === 'object') return Object.keys(src).length;\n    return 0;\n  }),\n  simple(['replace', 'replace-all'], (name: string, [str, find, rep, flags]: any[]) => {\n    str = `${str}`;\n    const re = typeof flags === 'string';\n    if (name === 'replace-all' || re) {\n      return str.replace(new RegExp(re ? find : find.replace(escapeRe, '\\\\$1'), (name === 'replace' || (flags && ~flags.indexOf('g')) ? flags : `${flags || ''}g`) || 'g'), rep);\n    } else {\n      return str.replace(find, rep);\n    }\n  }),\n  simple(['reverse'], (_name: string, [src]): string|any[] => {\n    if (typeof src === 'string') {\n      let r = '';\n      for (let i = 0; i < src.length; i++) r = src[i] + r;\n      return r;\n    } else if (Array.isArray(src)) {\n      return src.slice().reverse();\n    }\n  }),\n  simple(['wrap-count'], (_name: string, [str, width, font], opts, ctx): number => {\n    let w = width || opts?.width;\n    const avail = safeGet(ctx, '@placement.availableX') || 48;\n    if (ctx.special?.widget) {\n      const ww = ctx.special.widget.width;\n      if (ww) {\n        if (ww === 'grow') w = avail;\n        else if (typeof ww === 'number') w = ww;\n        else if (typeof ww === 'object' && typeof ww.percent === 'number') w = (ww.percent / 100) * avail; \n        else if (typeof ww === 'object' && typeof ww.x === 'string') w = evaluate(ctx, ww.x);\n      }\n    }\n    if (!w) w = avail;\n    font = font || opts?.font || safeGet(ctx, '@widget.font');\n    if (opts) {\n      font = Object.assign({}, font);\n      for (const k of ['family', 'size', 'line', 'metric', 'break-word']) if (k in opts) font[k] = opts[k];\n    }\n    return measure(str, w, { context: ctx } as any, font);\n  }),\n  simple(['keys'], (_name: string, [src, proto]): string[] => {\n    if (!src) return [];\n    if (proto) {\n      const res: string[] = [];\n      for (const k in src) res.push(k);\n      return res;\n    } else {\n      return Object.keys(src);\n    }\n  }),\n  simple(['values'], (_name: string, [src]): any[] => {\n    if (!src) return [];\n    return Object.values(src);\n  }),\n  simple(['date'], (_name: string, args: any[], opts, ctx: Context): Date|DateRel => {\n    let [v, t] = args;\n    if (typeof opts !== 'object' || !opts) opts = {} as any;\n\n    let res: Date|DateRel;\n    if (v !== undefined) {\n      if (isDateRel(v)) res = dateRelToDate(v);\n      else if (typeof v === 'string') {\n        let dt = parseDate(v);\n        if (isDateRel(dt)) {\n          res = dt;\n        } else {\n          if (!dt) dt = new Date(v);\n          if (isNaN(dt as any)) {\n            let val = evaluate(ctx, ~v.indexOf('#') ? v : `#${v}#`);\n            if (isDateRel(val)) {\n              if (opts.rel || opts.parse) res = val;\n              else res = dateRelToDate(val);\n            }\n          }\n        }\n      }\n      if (!res) res = new Date(v);\n    }\n    else res = new Date();\n\n\n    if ((opts.rel || opts.parse) && isDateRel(res)) {\n      let rel = dateRelToExactRange(res);\n      if (typeof t === 'string') t = parseTime(t);\n\n      if (Array.isArray(t)) {\n        const f = rel.f;\n        f[3] = t[0], f[4] = t[1], f[5] = t[2], f[6] = t[3];\n        t = t[4];\n      }\n\n      if (typeof t === 'number') {\n        if (opts.shift) {\n          const diff = (+rel.f[7] || 0) - t;\n          const dt = dateRelToDate(rel);\n          dt.setMinutes(dt.getMinutes() - diff);\n          rel = dateRelToExactRange(dt);\n        }\n\n        rel.f[7] = t;\n        res = rel;\n      }\n    } else {\n      const rdt = isDateRel(res) ? dateRelToDate(res) : res as Date;\n      if ('y' in opts && !isNaN(opts.y)) rdt.setFullYear(opts.y);\n      const y = rdt.getFullYear();\n      if ('m' in opts && !isNaN(opts.m)) {\n        rdt.setMonth(+opts.m - 1);\n        if (opts.clamp && rdt.getFullYear() !== y) {\n          rdt.setFullYear(y);\n          rdt.setMonth(11);\n        }\n      }\n      const m = rdt.getMonth();\n      if ('d' in opts && !isNaN(opts.d)) {\n        rdt.setDate(opts.d);\n        if (opts.clamp && (rdt.getMonth() !== m || rdt.getFullYear() !== y)) {\n          rdt.setDate(1);\n          rdt.setFullYear(y);\n          rdt.setMonth(m + 1);\n          rdt.setDate(0);\n        }\n      }\n\n      if (t) {\n        if (res === v) {\n          if (typeof v === 'string') {\n            const dt = parseDate(v);\n            if (dt && isDateRel(dt)) res = dateRelToDate(dt);\n            else res = new Date(v);\n          } else res = new Date(v);\n        }\n\n        if (typeof t === 'string') t = parseTime(t);\n        if (Array.isArray(t)) {\n          rdt.setHours(t[0] || 0, t[1] || 0, t[2] || 0, t[3] || 0);\n          if (t[4] != null) {\n            const offset = -rdt.getTimezoneOffset() - t[4];\n            rdt.setMinutes(rdt.getMinutes() + offset);\n          }\n        } else if (typeof t === 'number') {\n          const offset = -rdt.getTimezoneOffset() - t;\n          rdt.setMinutes(rdt.getMinutes() + offset);\n        }\n      }\n\n      res = rdt;\n    }\n\n    if (res instanceof Date && isNaN(+res)) return undefined;\n    return res;\n  }),\n  simple(['interval'], (_name: string, [v]: any[], _opts, ctx: Context): DateRel => {\n    return evaluate(ctx, ~v.indexOf('#') ? v : `#${v}#`);\n  }),\n  simple(['upper', 'lower'], (name: string, [v]: any[]): string => {\n    v = v == null ? '' : v;\n    return name === 'upper' ? `${v}`.toUpperCase() : `${v}`.toLowerCase();\n  }),\n  simple(['format', 'fmt'], (_name: string, args: any[], opts, ctx): string => {\n    let [v, fmt, ...s] = args;\n    const op = formats[fmt];\n    if (!op) {\n      let op: any = getOperator(fmt);\n      if (!op) {\n        const o = safeGet(ctx, fmt) || safeGet(ctx.root, fmt);\n        if (isApplication(o)) op = o\n      }\n      if (op) {\n        const args = [v, ...s];\n        return applyOperator(ctx, { op: fmt, args: args.map(v => isApplication(v) ? v : ({ v })), opts: { v: opts || virtualFormats[fmt] } });\n      } else return `${v}`;\n    } else return op.apply(v, s, (opts || op.defaults) as any);\n  }),\n  simple(['set-defaults'], (_name: string, [type, name]: any[], opts, ctx) => {\n    if (type === 'format' && typeof name === 'string') {\n      const fmt = formats[name];\n      if (fmt) return Object.assign(fmt.defaults, opts);\n      const vfmt = virtualFormats[name];\n      if (vfmt) return Object.assign(vfmt.defaults, opts);\n    } else if (type === 'round') {\n      if (opts?.context) {\n        if (opts?.unset) {\n          if (ctx.special) delete ctx.special.round;\n        } else (ctx.special || (ctx.special = {})).round = Object.assign({}, opts, { context: undefined });\n      } else Object.assign(roundDefaults, opts);\n    } else if (type === 'generate') {\n      Object.assign(generateDefaults, opts);\n    }\n  }),\n  simple(['parse'], (_name: string, args: any[], opts: any): any => {\n    opts = opts || args[1] || {};\n    if (!opts || typeof opts !== 'object') opts = {};\n    const [v] = args;\n\n    if (opts.date) return parseDate(v, opts);\n    else if (opts.template || opts.tpl) return parseTemplate(v, opts);\n    else if (opts.time) return parseTime(v, opts);\n    else if (opts.expr) return parseExpr(v, opts);\n    else if (opts.json) return JSON.parse(v);\n    else if (opts.schema) return parseSchema(v);\n    else if (opts.range) return parseRange(v, opts);\n    else if (opts.xml) return parseXML(v, opts.strict);\n    else if (opts.csv || opts.delimited) {\n      if (opts.detect || (!opts.field && !opts.separator && !opts.record && !opts.quote)) opts = Object.assign(csvDetect(v, opts.context), opts);\n      return csvParse(v, opts);\n    } else if (opts.base64) return atob(v);\n    else return parse(v, opts);\n  }),\n  simple(['detect-delimiters'], (_name: string, [data, max]: any[], opts) => {\n    if (typeof data !== 'string') return {};\n    return csvDetect(data, max ?? opts?.context);\n  }),\n);\n\n// short circuiting\nregisterOperator({\n  type: 'checked',\n  names: ['and', '&&'],\n  checkArg(_name: string, _i: number, _total: number, value: any): CheckResult {\n    if (value) return 'continue';\n    else return { result: value };\n  },\n  apply(_name: string, args: any[]): boolean {\n    return args[args.length - 1]; // passed the check, all is well\n  },\n}, {\n  type: 'checked',\n  names: ['or', '||', '??'],\n  checkArg(name: string, _i: number, _total: number, value: any): CheckResult {\n    if (name === '??' ? value != null : value) return { result: value };\n    else return 'continue';\n  },\n  apply(name: string): boolean {\n    return name === '??' ? undefined : false; // if we made it this far, none were true\n  },\n}, {\n  type: 'checked',\n  names: ['if', 'unless'],\n  checkArg(name: string, i: number, last: number, value: any): CheckResult {\n    if (i % 2 === 0) {\n      if (i === last) return { result: value }; // else case\n      else if (name === 'if' ? !value : value) return { skip: 1 }; // non-matching branch, skip next\n      else return 'continue'; // matching, carry on to next\n    }\n    else return { result: value }; // odd branch that wasn't skipped means previous condition matched\n  },\n  apply() {}\n}, {\n  type: 'checked',\n  names: ['case', 'switch'],\n  checkArg(_name: string, i: number, last: number, value: any, _opts, ctx: Context, ast): CheckResult {\n    if (i === 0) { // set the value and move to the next\n      (ctx.special || (ctx.special = {})).case = value;\n      return 'continue';\n    } else if (i % 2 === 1) {\n      if (i === last) return { result: value }; // default case\n      if (equals(value, ctx.special.case)) return 'continue';\n      if (isValue(ast) && 'op' in ast && value === true) return 'continue'; // operators can also check for true\n      if (isValue(value)) {\n        const v = evalValue(ctx, value);\n        if (equals(v, ctx.special.case)) return 'continue';\n        if (v === true) return 'continue';\n      }\n      return { skip: 1 };\n    } else return { result: value }; // odd branch\n  },\n  apply() {},\n  extend: true,\n}, {\n  type: 'checked',\n  names: ['each'],\n  checkArg(_name: string, i: number, last: number, value: any): CheckResult {\n    if (i === 0) {\n      if (Array.isArray(value) && value.length || value && typeof value === 'object' && Object.keys(value).length) return 'continue';\n      else return { skip: 1 };\n    } else if (i === 1) return { skip: last - i, value };\n    else if (i === last) return { result: value };\n    else if (i % 2 === 0) { // condition\n      if (value) return 'continue';\n      else return { skip: 1 };\n    } else return { result: value };\n  },\n  apply(_name: string, [value, body]: [any[]|object, ValueOrExpr], opts, ctx: Context) {\n    if (Array.isArray(value)) {\n      const last = value.length - 1;\n      return value.map((v, i) => evalApply(extend(ctx, { value: v, special: { last, index: i, key: i, 'last-key': last } }), body, [v, i])).join(opts?.join || '');\n    } else if (typeof value === 'object' && value) {\n      const entries = Object.entries(value);\n      const lastKey = entries[entries.length - 1][0];\n      const last = entries.length - 1;\n      return Object.entries(value).map(([k, v], i) => evalApply(extend(ctx, { value: v, special: { last, 'last-key': lastKey, index: i, key: k } }), body, [v, k])).join('');\n    } else {\n      return '';\n    }\n  }\n}, {\n  type: 'checked',\n  names: ['with'],\n  checkArg(_name: string, i: number, last: number, value: any): CheckResult {\n    if (i === 0 && value && typeof value === 'object') return 'continue';\n    else if (i === 1) return { skip: last - i, value };\n    else if (i === last) return { result: value };\n    else if (i % 2 === 0) {\n      if (value) return 'continue';\n      else return { skip: 1 };\n    } else return { result: value };\n  },\n  apply(_name: string, [value, body]: [any, ValueOrExpr], _opts, ctx: Context) {\n    return evalApply(extend(ctx, { value }), body, [value]);\n  }\n}, {\n  type: 'checked',\n  names: ['coalesce', 'coalesce-truth'],\n  checkArg(name: string, _i: number, _last: number, value: any): CheckResult {\n    if (name === 'coalesce' && value !== undefined && value !== null) return { result: value };\n    else if (value) return { result: value };\n    else return 'continue';\n  },\n  apply() {}\n});\n\n// aggregates\nregisterOperator({\n  type: 'aggregate',\n  names: ['avg'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (ctx.special?.round) return +round(arr.reduce((a, c) => +round(a + num(args[0] ? evalApply(ctx, args[0], [c]) : c)), 0) / arr.length)\n    else return arr.reduce((a, c) => a + num(args[0] ? evalApply(ctx, args[0], [c]) : c), 0) / arr.length;\n  },\n}, {\n  type: 'aggregate',\n  names: ['sum'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (ctx.special?.round) return arr.reduce((a, c) => +round(a + num(args[0] ? evalApply(ctx, args[0], [c]) : c)), 0);\n    else return arr.reduce((a, c) => a + num(args[0] ? evalApply(ctx, args[0], [c]) : c), 0);\n  }\n}, {\n  type: 'aggregate',\n  names: ['count'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (args.length) return arr.filter((e, i) => evalApply(ctx, args[0], [e, i])).length;\n    else return arr.length;\n  }\n}, {\n  type: 'aggregate',\n  names: ['min', 'max'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (isApplication(args[0])) arr = arr.map(e => evalApply(ctx, args[0], [e]));\n    else if (args.length && !arr.length) arr = args.map(a => evalParse(ctx, a));\n    if (!arr.length) return 0;\n    return Math[name].apply(Math, arr.filter(e => !isNaN(e)));\n  }\n}, {\n  type: 'aggregate',\n  names: ['first', 'nth', 'last'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    let val: any;\n    let apply = 0;\n    if (name === 'first') val = arr[0];\n    else if (name === 'last') val = arr[arr.length - 1];\n    else if (args[0]) {\n      const i = evalParse(ctx, args[0]);\n      if (typeof i === 'number') {\n        val = i < 0 ? arr[arr.length + i] : arr[i - 1];\n        apply = 1;\n      }\n    }\n    if (args[apply]) val = evalParse(ctx, args[apply]);\n    return val;\n  }\n}, {\n  type: 'aggregate',\n  names: ['map'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (!args[0]) return arr;\n    let v: any[];\n    let app: any;\n    if (isApplication(args[0])) v = arr, app = evalParse(ctx, args[0]);\n    else if (isApplication(args[1])) v = evalParse(ctx, args[0]), app = evalParse(ctx, args[1]);\n    if ((Array.isArray(v) || v && '0' in v) && isApplication(app)) {\n      const res = Array.prototype.map.call(v, (e: any, i: number) => evalApply(ctx, app, [e, i], { index: i, key: i }));\n      if (opts && opts.flat) return flatten(res, opts.flat);\n      return res;\n    }\n    else if (v && typeof v === 'object' && isApplication(app)) {\n      if (opts && opts.array) {\n        const res = Object.entries(v as object).map((p, i) => evalApply(ctx, app, [p[1], i, p[0]], { index: i, key: p[0] }));\n        if (opts && opts.flat) return flatten(res, opts.flat);\n        return res;\n      }\n      if (opts && opts.entries) return Object.entries(v as object).reduce((a, p, i) => {\n        const r = evalApply(ctx, app, [p[1], i, p[0]], { index: i, key: p[0] });\n        if (r === null) return a;\n        if (Array.isArray(r) && r.length === 2 && typeof r[0] === 'string') a.push(r);\n        else a.push([p[0], r]);\n        return a;\n      }, [] as any[]);\n      const res: any = {};\n      Object.entries(v as object).forEach((e, i) => {\n        const r = evalApply(ctx, app, [e[1], i, e[0]], { index: i, key: e[0] });\n        if (Array.isArray(r) && r.length === 2 && typeof r[0] === 'string') res[r[0]] = r[1];\n        else if (r == null) return;\n        else res[e[0]] = r;\n      });\n      return res;\n    }\n  }\n}, {\n  type: 'aggregate',\n  names: ['index'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    if (!args[0]) return {};\n    const many = opts && opts.many;\n    return arr.reduce((a, c, i) => _indexPair(a, evalApply(ctx, args[0], [c, i], { index: i, all: a }), c, many), {});\n  },\n}, {\n  type: 'aggregate',\n  names: ['reduce'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (!args[0]) return arr;\n    return arr.reduce((a, c, i) => evalApply(ctx, args[0], [a, c, i]), evalParse(ctx, args[1]));\n  }\n}, {\n  type: 'aggregate',\n  names: ['unique', 'unique-map'],\n  apply(name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    const seen = [];\n    const res = [];\n    for (const e of arr) {\n      const f = args[0] ? evalApply(ctx, args[0], [e]) : e;\n      if (!~seen.indexOf(f)) {\n        seen.push(f);\n        res.push(e);\n      }\n    }\n    return name === 'unique' ? res : seen;\n  }\n}, {\n  type: 'aggregate',\n  names: ['join'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (isApplication(args[0])) {\n      arr = arr.map(e => evalApply(ctx, args[0], [e]));\n      args = args.slice(1);\n    }\n    if (args.length > 1 && arr.length > 2) return [arr.slice(0, -1).join(evalParse(ctx, args[0])), arr[arr.length - 1]].join(evalParse(ctx, args[1]));\n    else if (args.length > 2 && arr.length === 2) return arr.join(evalParse(ctx, args[2]));\n    return arr.join(evalParse(ctx, args[0]));\n  }\n}, {\n  type: 'aggregate',\n  names: ['find'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], _opts, ctx: Context) {\n    if (!args[0]) return;\n    else if (isApplication(args[0])) return arr.find((e, i) => evalApply(ctx, args[0], [e, i], { index: i, key: i }));\n    else if (isApplication(args[1])) {\n      const v = evalParse(ctx, args[0]);\n      if (Array.isArray(v)) return v.find((e, i) => evalApply(ctx, args[1], [e, i], { index: i, key: i }));\n      else if (typeof v === 'object' && v) {\n        const e = Object.entries(v).find((e, i) => evalApply(ctx, args[1], [e[1], i, e[0]], { index: i, key: e[0] }));\n        if (e) return e[1];\n      }\n    } else {\n      const v = evalParse(ctx, args[0]);\n      return arr.find(e => e == v);\n    }\n  }\n}, {\n  type: 'aggregate',\n  names: ['flatten'],\n  apply(_name: string, arr: any[], args: ValueOrExpr[], opts, ctx) {\n    return flatten(arr, (args.length > 0 ? evalParse(ctx, args[0]) : 0) || opts?.flat);\n  }\n}, {\n  type: 'aggregate',\n  names: ['block'],\n  apply(_name: string, _arr: any[], args: ValueOrExpr[], opts, ctx: Context) {\n    const last = args.length - 1;\n    if (last < 0) return;\n    const c = extend(ctx, { locals: opts && opts.implicit ? ctx.locals || {} : {}, fork: !ctx.locals });\n    for (let i = 0; i < last; i++) evalParse(c, args[i]);\n    const res = evalParse(c, args[last]);\n    if (opts && opts.implicit) ctx.locals = c.locals;\n    return res;\n  },\n  value: true,\n});\n\nfunction flatten(n: any[], levels: any = 1): any[] {\n  let res = n || [];\n  const count = typeof levels !== 'number' ? 1 : levels;\n  for (let i = 0; i < count; i++) {\n    if (res.find(v => Array.isArray(v))) res = [].concat(...res);\n    else return res;\n  }\n  return res;\n}\n\nfunction fmtDate(n: any, fmt: string): string {\n  if (typeof n === 'string') {\n    const d = parseDate(n);\n    if (d) n = d;\n  }\n  return date(isDateRel(n) ? dateRelToExactRange(n) : n, fmt);\n}\n\nfunction _parseRange(ctx: Context, range: string) {\n  const map = (ctx.root as any)._ranges || ((ctx.root as any)._ranges = {})\n  if (range in map) return map[range];\n  return (map[range] = parseRange(range));\n}\n\nfunction _indexPair(res: any, value: any, current: any, many: boolean): any {\n  if (Array.isArray(value)) {\n    if (value.length === 0) return res;\n    else if (value.length === 2) {\n      const [k, v] = value;\n      if (Array.isArray(k)) {\n        for (const kk of k) {\n          if (many) {\n            if (kk in res) res[kk].push(v)\n            else res[kk] = [v];\n          } else res[kk] = v;\n        }\n      } else {\n        if (many) {\n          if (k in res) res[k].push(v);\n          else res[k] = [v];\n        } else res[k] = v;\n      }\n    }\n  } else if (typeof value === 'object') {\n    const v = value as any;\n    if ('many' in v && Array.isArray(v.many)) for (const i of v.many) _indexPair(res, i, current, many);\n    else if ('key' in v || 'keys' in v) _indexPair(res, [v.key || v.keys, v.value || current], current, many);\n  } else {\n    if (many) {\n      if (value in res) res[value].push(current);\n      else res[value] = [current];\n    } else res[value] = current;\n  }\n  return res;\n}\n\n// basic formats\nregisterFormat('dollar', function(n, [dec, group, sign, neg], opts) {\n  return dollar(n, undefined, dec ?? opts?.dec ?? this.defaults.dec, group ?? opts?.group ?? this.defaults.group, sign ?? opts?.sign ?? this.defaults.sign, neg ?? opts?.neg ?? this.defaults.neg);\n}, { dec: 2, group: ',', sign: '$', neg: 'sign' });\n\nregisterFormat('date', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd' });\n\nregisterFormat('time', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'HH:mm:ss' });\n\nregisterFormat('timestamp', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd HH:mm:ss' });\n\nregisterFormat('timestamptz', function(n, [fmt], opts) {\n  return fmtDate(n, fmt ?? opts?.format ?? this.defaults.format);\n}, { format: 'yyyy-MM-dd HH:mm:sszzz' });\n\nregisterFormat('iso8601', n => {\n  return fmtDate(n, 'yyyy-MM-ddTHH:mm:sszzz');\n});\n\nregisterFormat(['integer', 'int'], function(n, [group, neg], opts) {\n  return number(n, 0, group ?? opts?.group ?? this.defaults.group, neg ?? opts?.neg ?? this.defaults.neg);\n}, { group: ',', neg: 'sign' });\n\nregisterFormat(['number', 'num'], function(n, [dec, group, neg], opts) {\n  return number(n, dec ?? opts?.dec ?? this.defaults.dev, group ?? opts?.group ?? this.defaults.group, neg ?? opts?.neg ?? this.defaults.neg);\n}, { dec: 2, group: ',', neg: 'sign' });\n\nregisterFormat('ordinal', function(n, [group], opts) {\n  return ordinal(n, group ?? opts?.group ?? this.defaults.group);\n}, { group: ',' });\n\nregisterFormat('phone', n => {\n  return phone(n);\n});\n\nregisterFormat('styled', n => {\n  return style(n);\n});\n\n{\n  const space = /\\s+/g;\n  const br = /[\\s;,.:\"]\\w/g;\n  const alphaNum = /[^a-zA-Z0-9]+([a-zA-Z0-9])/g;\n  const alphaNumSpace = /[^\\sa-zA-Z0-9]/g;\n  const camelBreak = /([a-z])([A-Z])/g;\n  const spaceChar = /\\s([^\\s])/g;\n  function normalize(s: string) {\n    return s.replace(alphaNum, (_m, c) => c ? ` ${c}` : '').replace(alphaNumSpace, '').replace(camelBreak, (_m, c1, c2) => `${c1} ${c2}`).trim();\n  }\n  registerFormat('case', (n, whiches) => {\n    let str = `${n || ''}`.trim();\n    for (const which of whiches) {\n      if (which === 'upper' || which === 'up') str = str.toUpperCase();\n      else if (which === 'lower' || which === 'down') str = str.toLowerCase();\n      else if (which === 'snake') str = normalize(str).toLowerCase().replace(space, '_');\n      else if (which === 'kebab') str = normalize(str).toLowerCase().replace(space, '-');\n      else if (which === 'pascal') {\n        const s = normalize(str);\n        str = s[0].toUpperCase() + s.toLowerCase().substr(1).replace(spaceChar, (_m, c) => (c || '').toUpperCase());\n      } else if (which === 'camel') {\n        const s = normalize(str);\n        str = s[0].toLowerCase() + s.toLowerCase().substr(1).replace(spaceChar, (_m, c) => (c || '').toUpperCase());\n      } else if (which === 'proper') {\n        if (/[a-z]/.test(str)) str = str.trim().replace(br, m => m.toUpperCase());\n        else str = str.toLowerCase().trim().replace(br, m => m.toUpperCase());\n        str = (str[0] || '').toUpperCase() + str.substr(1);\n      }\n    }\n    return str;\n  });\n}\n\nregisterFormat('hex', val => {\n  if (typeof val === 'number') return val.toString(16);\n  else {\n    const str = `${val}`;\n    const te = new TextEncoder();\n    return Array.from(te.encode(str)).map(c => c.toString(16).padStart(2, '0')).join('');\n  }\n});\n\nregisterFormat('base', (val, [n]) => {\n  try {\n    return val.toString(n);\n  } catch {\n    return val;\n  }\n});\n\nregisterFormat('noxml', val => escapeHTML(`${val}`));\n\nregisterFormat('xml', (val, [n]) => {\n  if (val && typeof val === 'object') return objectToXML(val, n);\n  else return val;\n});\n\nfunction objectToXML(object: object, indent: number|undefined = undefined) {\n  if (Array.isArray(object)) return _objectToXML({ values: { value: object } }, 0, indent);\n  const keys = Object.keys(object);\n  if (keys.length > 1) return _objectToXML({ root: object }, 0, indent);\n  if (keys.length < 1) return '<root />';\n  if (Array.isArray(object[keys[0]])) return _objectToXML({ root: object }, 0, indent);\n  return _objectToXML(object, 0, indent);\n}\n\nfunction _objectToXML(val: any, depth: number, indent: number|undefined, propname: string|undefined = undefined) {\n  if (Array.isArray(val)) {\n    return val.reduce((xml, entry) => {\n      const val = _objectToXML(entry, depth + 1, indent, propname);\n      const tag = val === '' || val === undefined ? `<${propname} />` : `<${propname}>${val}${indent && /\\n/.test(val) ? '\\n' + pad('l', '', depth * indent, ' ') : ''}</${propname}>`;\n      return `${xml}${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}${tag}`;\n    }, '');\n  }\n  if (val && typeof val === 'object') {\n    return Object.entries(val).reduce((xml, [name, value]) => {\n      const val = _objectToXML(value, depth + (Array.isArray(value) ? 0 : 1), indent, name);\n      const tag = val === '' ? `${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}<${name} />` : Array.isArray(value) ? val : `${indent && depth ? '\\n' + pad('l', '', depth * indent, ' ') : ''}<${name}>${val}${indent && /\\n/.test(val) ? '\\n' + pad('l', '', depth * indent, ' ') : ''}</${name}>`;\n      return `${xml}${tag}`;\n    }, '');\n  }\n  return escapeHTML(val);\n}\n\nregisterFormat('base64', val => {\n  return btoa(`${val}`);\n});\n"],"names":["Fail","detailedFail","_cause","_latestCause","getCause","getCauseCopy","name","suggestCauseName","undefined","slice","fail","pos","message","cause","causes","isNodeName","v","openNode","start","end","children","closeNode","node","parent","res","_compact","result","primary","c","length","push","reduce","last","i","extra","l","apply","getLineNum","input","n","lastIndexOf","getParseError","context","lines","first","t","unshift","substring","markerOffset","indexOf","source","marker","len","column","line","position","marked","join","map","parser","findLatestCause","startSpace","shared","error","mps","oerror","det","detailed","consume","consumeAll","trim","exec","seq","skip","a","d","tree","compact","unwrap","parse","undefinedOnError","ctx","contextLines","err","getLatestCause","latest","throw","ex","Error","Object","assign","uninit","_s","p","lazy","init","s","r","nop","concat","strings","outer","f","max","cs","contains0","contains1","str","x","contains2","contains3","contains4","contains5","contains6","contains7","contains8","contains9","contains10","containsFor","containsBinary","mid","getSearch","sorted","charList","chars","split","sort","seekWhileChar","contains","read","read1","JSON","stringify","count","allowed","search","substr","readTo","stop","skipped","seekUntilChar","read1To","op","resin","j","nlen","istr","copy","toLowerCase","toUpperCase","idx","opt","ps","not","alt","parsers","nm","lps","fails","overrideCauseName","verify","fn","e","cur","rep","empty","rep1","repsep","sep","trail","ps1","ps2","rr","m","rep1sep","bracket","content","right","Array","isArray","ends","ps3","r1","r2","r3","addCause","check","andNot","np","_hex","digits","identStart","hex","escmap","b","underscores","JNum","replace","JStringEscape","disallowed","notchars","JStringUnicode","String","fromCharCode","parseInt","JStringHex","JString","JBool","JNull","JIdentifier","ws","JArray","JObject","JValue","JKeyPair","pairs","pair","timespans","y","w","h","mm","isTimespanMS","ms","timeSpanToNumber","Math","floor","space","endSym","endRef","_comment","comment","prop","rws","skip1","keywords","ident","sexprop","args","array","block","object","value","values","application","inlineTemplate","pathesc","char","pathident","parts","dotpath","part","bracketpath","keypath","prefix","k","u","localpath","parsePath","makeParser","parseLetPath","illegalRefs","ref","includes","stringInterp","timespan","span","timezone","timeexact","parseTime","tm","z","dateend","daterel","o","tz","val","setIndex","index","dateexact","time","date","typelit","schema","parseDate","string","literal","Date","sexp","opts","bracket_op","binop","if_op","case_op","opName","call_op","operand","fmt","fmt_op","postfix_path","unop","arg","leftassoc","left","binop_e","arg1","more","pop","reverse","rightassoc","binop_md","binop_as","binop_cmp","binop_eq","binop_and","binop_or","replaceCase","found","cond1","block1","elifs","el","cond","val1","hit","miss","case_branch","branches","operation","objectOp","filter","namedArg","names","plain","obj","letter","setter","parseBlock","implicit","parseExpr","namespace","type","conditions","typedef","typedefs","defs","desc","arr","key","required","rest","keys","rests","fields","tuple","types","maybe_union","union_array","list","checks","union","root","txtEsc","text","txts","nestedText","endTxt","tag_value","tag_end","branch","min_one","else_tag","branch_tag","each_op","tag","apply_first","cond_branches","with_op","unless_op","interpolator","hasTag","meta","_parse","toDataSet","safeGet","path","parameters","sources","which","special","pipe","lctx","locals","evalValue","safeSet","islet","next","evaluate","isValueOrExpr","Root","isContext","evalParse","template","extend","parseTemplate","evalApply","isApplication","fork","expr","ns","cache","exprs","applyOperator","isDateRel","isTimespan","opMap","registerOperator","ops","getOperator","_defaultGetValue","sorts","getValue","sortArr","by","dirs","lower","dir","cmp","ds","groups","_ds","_context","flt","forEach","row","grouped","level","group","all","order","g","hasPipeRef","getKeypath","local","isOperation","find","isReference","flts","checkArg","shift","src","isValue","constructor","this","log","console","formats","virtualFormats","registerFormat","format","defaults","dateRelToRange","rel","from","to","setUTCFullYear","getFullYear","getMonth","getDate","setUTCHours","dateAndTimespan","setUTCDate","getUTCDate","getUTCDay","setDate","setUTCMonth","getUTCMonth","getUTCFullYear","UTC","setUTCMilliseconds","getUTCMilliseconds","setUTCMinutes","getUTCMinutes","offset","getTimezoneOffset","dateRelToDate","range","dateRelToExactRange","dt","setMinutes","getMinutes","getHours","getSeconds","getMilliseconds","setFullYear","dd","setMonth","setHours","setSeconds","setMilliseconds","addStyle","id","style","styles","placement","output","height","isComputed","maybeComputed","report","extendContext","styleMap","commit","htmlChars","htmlReplace","escapeHTML","html","renderers","registerRenderer","renderer","options","render","avgs","measure","width","font","family","size","brw","avg","metric","test","word","wlen","renderWidget","state","hide","widget","container","getHeightWithMargin","maxY","isNaN","availableY","continue","cancel","extraHeight","margin","expandMargin","border","box","expandBorder","getWidthWithMargin","toFixed","layouts","registerLayout","layout","getWidth","pct","availableX","maxX","percent","getHeight","computed","linesize","maxFontSize","NaN","maxYOffset","points","maxXOffset","top","bottom","expandMacro","macro","props","properties","widgets","mapStyle","mapped","ids","nextStyleId","styleClass","cls","inline","inlineStyle","classPrefix","classifyStyles","offsetX","offsetY","computedHeight","lineSize","styleFont","styleBorder","styleExtra","bg","radius","color","align","weight","pre","clamp","br","initParameters","defaultParams","inits","applySources","srcs","base","runDelimited","headers","table","quote","field","record","rowContext","unquote","RegExp","findWidgets","results","zwsp","sp","integer","number","remOrPercent","places","valign","pad","fg","rotate","turn","origin","move","trash","bools","tags","blocks","aliases","parsed","stuff","open","bool","blockstack","drop","frame","getStyle","process","flexAlign","middle","borderStyle","dot","dash","bs","underline","overline","strike","sup","sub","italic","bold","vs","transforms","vv","onCommit","commitContext","sval","styled","styleText","wctx","extendData","cw","yo","lp","child","attempt","renderWidgets","bridge","groupNo","newPage","header","hctx","current","groupHeaders","headerPerPage","rctx","elide","usedX","usedY","initY","alternate","headerRepeat","footer","fctx","groupEnds","fit","url","styleImage","decRE","intRE","isNumRE","dec","negative","parseFloat","neg","dateRE","months","days","dateDefault","Y","M","D","DD","H","MM","S","SS","Z","getDay","prototype","toString","call","ordinal","min","bit","abs","num","setDefault","checkIdent","_noSym","_key","_sexprops","_listcommas","_noarr","_noobj","_tpl","_tplmode","_noindent","_listwrap","_html","_nochecks","_level","_first","deepops","binops","unops","precedence","in","like","ilike","gt","gte","lt","lte","is","and","or","noSymbols","SExprOps","listCommas","noArrayLiterals","noObjectLiterals","noIndent","listWrap","htmlSafe","noChecks","_stringify","stringifyRootBlock","padl","stringed","stringifyTemplateBlock","caseRE","stringifyTemplateCase","fill","wrapArgs","isBlock","long","cindent","outdentAll","trimLeft","trimRight","stringifyIf","wsplit","stringifyCase","findNestedStringOpL","flattenNestedBinopsL","_f","stringifyBinopArg","amount","indentAll","stringifyOp","arrow","stringifySchema","stringifyDate","entries","stringifyLiteral","rem","spanKeys","spanExact","stringifyTimespan","agg","offsetToTimezone","mn","leadingSpace","allLeadingSpace","close","keyMod","wrapSetting","wrap","ts","strs","fin","def","l2","nl","lopen","lclose","parseSchema","num_range","sign_range","sign","Infinity","star_range","not_range","looseEqual","v1","v2","strictEqual","isNum","trueStrings","falseStrings","sqlEqual","tmp1","tmp2","fullnum","diff","equal","_diff","identity","keyMode","checkIdentity","v1ids","v2ids","vv1","vv2","_v1","_v2","ks","deepEqual","_deepEqual","labelDiff","label","out","omit","_labelDiff","nums","lbl","pp","isDate","isSchema","what","inspect","flat","getType","getField","validate","mode","_validate","_schema","errs","checkType","actual","unparseSchema","expected","tmp","legit","ok","DEFAULTS","csv","quotedField","records","quotes","detect","data","sample","match","fs","rs","qs","splice","fixedSize","entities","amp","entity","attr","quoted","attrs","put","target","strict","stack","stream","simple","spanMap","generateDefaults","stringTimes","times","roundDefaults","method","round","amt","settings","place","point","ceil","zeroes","pow","big","hasNum","equals","overlap","threshhold","similar","similarity","fudges","whole","aa","bb","i1","i2","oa","ob","f1","f2","sim","alen","blen","aolen","bolen","matchy","inRange","excluded","where","ct","eq","_name","pattern","patterns","free","re","_opts","_parseRange","it","parseRange","no","bounds","upper","step","app","namedArgs","datesDiff","unit","fraction","us","endM","dist","nextDiv","units","raport","tpl","json","base64","btoa","_","vals","addTimespan","precision","random","triml","trimr","escapeRe","flatten","levels","fmtDate","_ranges","_indexPair","many","kk","flags","avail","ww","proto","rdt","vfmt","unset","xml","parseXML","delimited","separator","csvDetect","csvParse","atob","_i","_total","ast","case","body","lastKey","_last","seen","_arr","dollar","dev","alphaNum","alphaNumSpace","camelBreak","spaceChar","normalize","_m","c1","c2","whiches","_objectToXML","depth","indent","propname","entry","te","TextEncoder","encode","padStart","objectToXML","legal","tabloid","a4","extraContext","repeater","_tmp","runAsDelimited","extras","orientation","yy","watermark","overlay","_k","head","foot","runFlow","page","pages","printX","printY","pageY","headSize","footSize","footPlace","headPlace","_p","runPage"],"mappings":"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"}